import{S as e,i as t,s as n,h as i,e as s,b as r,j as a,c as o,l,k as h,m as c,o as d,p as u,q as f,f as m,r as g,a as p,t as v,d as w,v as b,n as _,w as y,x as I,y as x,z as P,A as C,B as k,C as T,D as A,E as $,g as E,F as S,G as M,H as R,I as D,J as O,K as N,L as z,M as L,N as V,O as B,P as U,Q as X,R as F,T as G,U as H,V as j,W as Z,X as J,Y as K,Z as W,_ as Y,$ as q,a0 as Q,a1 as ee,a2 as te,a3 as ne,a4 as ie,a5 as se,a6 as re,a7 as ae,a8 as oe,a9 as le,aa as he,ab as ce}from"./main.js";import{g as de,i as ue,c as fe,a as me,P as ge,C as pe,b as ve,I as we,G as be,d as _e,e as ye,M as Ie,L as xe,f as Pe,Q as Ce,V as ke,h as Te,B as Ae,N as $e,S as Ee,j as Se,k as Me,l as Re,m as De,T as Oe,E as Ne,X as ze,n as Le,o as Ve,p as Be,q as Ue,r as Xe,s as Fe,A as Ge}from"./sha256-806d8515.js";var He=de(ue),je=fe((function(e,t){!function(e,t){var n={name:"@zeainc/zea-ux",version:"4.1.0",description:"Zea UX",main:"dist/index.cjs.js",module:"dist/index.esm.js",browser:"dist/index.umd.js",types:"dist/zea-ux.d.ts",files:["dist/","css/"],keywords:["Zea","UX"],scripts:{"build:tsc":"npx tsc","build:tsc:watch":"npx tsc --watch","clean:build":"rm -Rf dist/ buildcache","build:rollup":"rollup -c","build:rollup:watch":"rollup -w -c",build:"npm-run-all clean:build build:rollup",dev:"npm-run-all --parallel build:rollup:watch start:watch",start:"es-dev-server --app-index testing-e2e/index.html --open","start:watch":"es-dev-server --app-index testing-e2e/index.html --open --watch",release:"standard-version",dist:"yarn publish --access=public",docs:"adg --config adg.config.json","docs-w":"adg -w --config=adg.config.json","docs:serve":"docsify serve docs/",lint:"eslint src/",prepare:"yarn run build",test:"jest",generate:"plop","test:coverage":"jest --coverage","test:debug":"node --inspect ./node_modules/jest/bin/jest.js --runInBand --watch","test:watch":"jest --watch","test:e2e":"percy exec cypress run --browser chrome --headless","test:e2e:watch":"percy exec cypress open","to-cleanup":"rm -Rf dist/ node_modules/ yarn.lock","to-link-packages":"yarn link @zeainc/zea-engine"},repository:{type:"git",url:"git+ssh://git@github.com/ZeaInc/zea-ux.git"},bugs:{url:"https://github.com/ZeaInc/zea-ux/issues"},homepage:"https://github.com/ZeaInc/zea-ux#readme",author:"Zea Inc.",license:"MIT",devDependencies:{"@babel/preset-env":"^7.12.7","@percy/cypress":"^2.3.1","@rollup/plugin-commonjs":"^21.0.1","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.6","@zeainc/jsdocs2md":"^0.0.7","@zeainc/zea-collab":"^6.0.1","@zeainc/zea-engine":"^4",canvas:"^2.6.1",copyfiles:"^2.4.1",cypress:"^5.6.0","docsify-cli":"^4.4.2",documentation:"^13.1.0","es-dev-server":"^1.60.1",eslint:"^7.14.0","eslint-config-google":"^0.14.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prettier":"^3.2.0",husky:"^4.3.0","husky-run":"^0.0.0",jest:"^26.6.3","npm-run-all":"^4.1.5",plop:"^2.7.4",prettier:"^2.2.1",rollup:"^2.34.1","rollup-plugin-commonjs":"^10.1.0","rollup-plugin-dts":"^4.1.0","rollup-plugin-node-resolve":"^5.2.0","rollup-plugin-terser":"^7.0.2","rollup-plugin-typescript":"^1.0.1","standard-version":"^9.0.0","ts-node":"^10.4.0",tslib:"^2.3.1",typescript:"^4.4.4"},dependencies:{"dom-to-image":"^2.6.0"},husky:{hooks:{"disabled=pre-commit":"npm test","disabled=pre-push":"npm test"}}};function i(e){if(void 0!==e){if(e instanceof t.ZeaMouseEvent)return e.pointerRay;if(e instanceof t.ZeaTouchEvent)return e.touches[0].touchRay;if(e instanceof t.XRControllerEvent){const n=e.controller.getTipXfo(),i=n.ori.getZaxis().negate();return new t.Ray(n.tr,i)}return console.warn("unhandled pointer event"),new t.Ray}console.warn("undefined event")}class s extends t.TreeItem{constructor(e){super(e),this.captured=!1,this.colorParam=new t.ColorParameter("Color",new t.Color),this.highlightColorParam=new t.ColorParameter("HighlightColor",new t.Color(1,1,1)),this.addParameter(this.colorParam),this.addParameter(this.highlightColorParam)}highlight(){this.emit("highlight")}unhighlight(){this.emit("unhighlight")}getManipulationPlane(){const e=this.globalXfoParam.value;return new t.Ray(e.tr,e.ori.getZaxis())}onPointerEnter(e){this.highlight()}onPointerLeave(e){this.unhighlight()}onPointerDown(e){e.setCapture(this),e.stopPropagation(),this.captured=!0,this.changedTouches&&this.highlight(),"mouse"==e.pointerType||"touch"==e.pointerType?this.handlePointerDown(e):"xr"==e.pointerType&&this.onVRControllerButtonDown(e)}onPointerMove(e){this.captured&&(e.stopPropagation(),"mouse"==e.pointerType||"touch"==e.pointerType?this.handlePointerMove(e):"xr"==e.pointerType&&this.onVRPoseChanged(e)),e.preventDefault()}onPointerUp(e){this.captured&&(e.releaseCapture(),e.stopPropagation(),this.captured=!1,this.changedTouches&&this.unhighlight(),"mouse"==e.pointerType||"touch"==e.pointerType?this.handlePointerUp(e):"xr"==e.pointerType&&this.onVRControllerButtonUp(e))}onWheel(e){}handlePointerDown(e){this.gizmoRay=this.getManipulationPlane();const t=i(e),n=t.intersectRayPlane(this.gizmoRay);this.grabPos=t.pointAtDist(n),this.onDragStart(e)}handlePointerMove(e){const t=i(e),n=t.intersectRayPlane(this.gizmoRay);this.holdPos=t.pointAtDist(n),this.onDrag(e)}handlePointerUp(e){const t=i(e);if(t){const e=t.intersectRayPlane(this.gizmoRay);this.releasePos=t.pointAtDist(e)}this.onDragEnd(e)}onVRControllerButtonDown(e){this.activeController=e.controller;const t=this.activeController.getTipXfo().clone(),n=this.getManipulationPlane(),i=t.tr.subtract(n.start),s=t.tr.subtract(n.dir.scale(i.dot(n.dir)));this.grabPos=s,this.onDragStart(e)}onVRPoseChanged(e){if(this.activeController){const t=this.activeController.getTipXfo(),n=this.getManipulationPlane(),i=t.tr.subtract(n.start),s=t.tr.subtract(n.dir.scale(i.dot(n.dir)));this.holdPos=s,this.onDrag(e)}}onVRControllerButtonUp(e){this.activeController==e.controller&&(this.activeController.getTipXfo(),this.onDragEnd(e),this.activeController=void 0)}onDragStart(e){console.warn("@Handle#onDragStart - Implement me!",e)}onDrag(e){console.warn("@Handle#onDrag - Implement me!",e)}onDragEnd(e){console.warn("@Handle#onDragEnd - Implement me!",e)}setTargetParam(e,t){console.warn("setTargetParam not implemented")}}class r extends s{constructor(e){super(e)}handlePointerDown(e){this.gizmoRay=this.getManipulationPlane();const t=i(e);this.grabDist=t.intersectRayVector(this.gizmoRay)[1];const n=this.gizmoRay.pointAtDist(this.grabDist);this.grabPos=n,this.onDragStart(e)}handlePointerMove(e){const t=i(e).intersectRayVector(this.gizmoRay)[1];this.holdPos=this.gizmoRay.pointAtDist(t),this.holdDist=t,this.value=t,this.delta=t-this.grabDist,this.onDrag(e)}handlePointerUp(e){const t=i(e);if(t){const e=t.intersectRayVector(this.gizmoRay)[1],n=this.gizmoRay.pointAtDist(e);this.releasePos=n}this.onDragEnd(e)}onVRControllerButtonDown(e){this.gizmoRay=this.getManipulationPlane(),this.activeController=e.controller;const t=this.activeController.getTipXfo();this.grabDist=t.tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir),this.grabPos=this.gizmoRay.start.add(this.gizmoRay.dir.scale(this.grabDist)),this.onDragStart(e)}onVRPoseChanged(e){const t=this.activeController.getTipXfo().tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir);this.holdPos=this.gizmoRay.start.add(this.gizmoRay.dir.scale(t)),this.value=t,this.delta=t-this.grabDist,this.onDrag(e)}onVRControllerButtonUp(e){this.activeController==e.controller&&(this.onDragEnd(),this.activeController=void 0)}}class a extends t.EventEmitter{constructor(){super(),this.__undoStack=[],this.__redoStack=[],this.__currChange=null,this.__currChangeUpdated=this.__currChangeUpdated.bind(this)}flush(){for(const e of this.__undoStack)e.destroy();this.__undoStack=[];for(const e of this.__redoStack)e.destroy();this.__redoStack=[],this.__currChange&&(this.__currChange.off("updated",this.__currChangeUpdated),this.__currChange=null)}addChange(e){this.__currChange&&this.__currChange.off&&this.__currChange.off("updated",this.__currChangeUpdated),this.__undoStack.push(e),this.__currChange=e,this.__currChange.on&&this.__currChange.on("updated",this.__currChangeUpdated);for(const e of this.__redoStack)e.destroy();this.__redoStack=[],this.emit("changeAdded",{change:e})}getCurrentChange(){return this.__currChange}__currChangeUpdated(e){this.emit("changeUpdated",e)}undo(e=!0){if(this.__undoStack.length>0){this.__currChange&&(this.__currChange.off("updated",this.__currChangeUpdated),this.__currChange=null);const t=this.__undoStack.pop();t.undo(),e&&(this.__redoStack.push(t),this.emit("changeUndone"))}}cancel(){this.__undoStack.length>0&&(this.__currChange&&(this.__currChange.off("updated",this.__currChangeUpdated),this.__currChange=null),this.__undoStack.pop().undo())}redo(){if(this.__redoStack.length>0){const e=this.__redoStack.pop();e.redo(),this.__undoStack.push(e),this.emit("changeRedone")}}constructChange(e){return t.Registry.constructClass(e)}static isChangeClassRegistered(e){try{return t.Registry.getClassName(Object.getPrototypeOf(e).constructor),!0}catch(e){return!1}}static getChangeClassName(e){return t.Registry.getClassName(Object.getPrototypeOf(e).constructor)}static registerChange(e,n){t.Registry.register(e,n)}static getInstance(){return o||(o=new a),o}}let o;class l extends t.EventEmitter{constructor(e){super(),this.secondaryChanges=[],this.suppressPrimaryChange=!1,this.name=e||a.getChangeClassName(this)}addSecondaryChange(e){const t=this.secondaryChanges.length;return this.secondaryChanges.push(e),t}undo(){this.secondaryChanges.forEach((e=>e.undo()))}redo(){this.secondaryChanges.forEach((e=>e.redo()))}update(e){throw new Error("Implement me")}toJSON(e){return{}}fromJSON(e,t){}updateFromJSON(e){this.update(e)}destroy(){}}class h extends l{constructor(e,t){e?(super(e?e.getName()+" Changed":"ParameterValueChange"),this.prevValue=e.getValue(),this.param=e,null!=t&&(this.nextValue=t,this.param.value=this.nextValue)):super()}undo(){this.param&&!this.suppressPrimaryChange&&(this.param.value=this.prevValue),super.undo()}redo(){this.param&&!this.suppressPrimaryChange&&(this.param.value=this.nextValue),super.redo()}update(e){this.param&&(this.nextValue=e.value,this.param.value=this.nextValue,this.emit("updated",e))}toJSON(e){const t={name:this.name,paramPath:this.param.getPath()};return null!=this.nextValue&&(this.nextValue.toJSON?t.value=this.nextValue.toJSON():t.value=this.nextValue),t}fromJSON(e,n){const i=n.appData.scene.getRoot().resolvePath(e.paramPath,1);i&&i instanceof t.Parameter?(this.param=i,this.prevValue=this.param.getValue(),this.prevValue.clone?this.nextValue=this.prevValue.clone():this.nextValue=this.prevValue,this.name=e.name,null!=e.value&&this.updateFromJSON(e)):console.warn("resolvePath is unable to resolve",e.paramPath)}updateFromJSON(e){this.param&&(this.nextValue.fromJSON?this.nextValue.fromJSON(e.value):this.nextValue=e.value,this.param.value=this.nextValue)}}a.registerChange("ParameterValueChange",h);class c extends t.Material{constructor(e){super(e),this.baseColorParam=new t.MaterialColorParam("BaseColor",new t.Color(1,1,.5)),this.maintainScreenSizeParam=new t.NumberParameter("MaintainScreenSize",0),this.overlayParam=new t.NumberParameter("Overlay",0,[0,1]),this.__shaderName="HandleShader",this.addParameter(this.baseColorParam),this.addParameter(this.maintainScreenSizeParam),this.addParameter(this.overlayParam)}}t.Registry.register("HandleMaterial",c);class d extends t.GLShader{constructor(e){super(e),this.__shaderStages.VERTEX_SHADER=t.shaderLibrary.parseShader("HandleShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n#ifdef ENABLE_MULTI_DRAW\n<%include file="materialparams.glsl"/>\n#else\nuniform int MaintainScreenSize;\nuniform float Overlay;\n#endif\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  v_drawItemId = float(drawItemId);\n  v_geomItemData  = getInstanceData(drawItemId);\n\n  //////////////////////////////////////////////\n  // Material\n\n#ifdef ENABLE_MULTI_DRAW\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 materialValue1 = getMaterialValue(materialCoords, 1);\n  int maintainScreenSize = int(materialValue1.x + 0.5);\n  float overlay = materialValue1.y;\n#else\n  int maintainScreenSize = MaintainScreenSize;\n  float overlay = Overlay;\n#endif\n\n  //////////////////////////////////////////////\n  // Matrix\n  \n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  if (maintainScreenSize != 0) {\n    // Remove the scale from the model matrix.\n    vec3 row0 = normalize(vec3(modelMatrix[0][0], modelMatrix[0][1], modelMatrix[0][2]));\n    vec3 row1 = normalize(vec3(modelMatrix[1][0], modelMatrix[1][1], modelMatrix[1][2]));\n    vec3 row2 = normalize(vec3(modelMatrix[2][0], modelMatrix[2][1], modelMatrix[2][2]));\n    modelMatrix = mat4(\n      row0.x, row0.y, row0.z, 0.0,\n      row1.x, row1.y, row1.z, 0.0,\n      row2.x, row2.y, row2.z, 0.0,\n      modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2], 1.0\n    );\n  }\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  if (maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = abs(dist); // Note: items in front of the camera will have a negative value here.\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  if(overlay > 0.0){\n    gl_Position.z = mix(gl_Position.z, -gl_Position.w, overlay);\n  }\n\n  v_viewPos = viewPos.xyz;\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),this.__shaderStages.FRAGMENT_SHADER=t.shaderLibrary.parseShader("HandleShader.fragmentShader",'\nprecision highp float;\n\n<%include file="GLSLUtils.glsl"/>\n<%include file="math/constants.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n\n#if defined(DRAW_COLOR)\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n#elif defined(DRAW_GEOMDATA)\n\nuniform int isOrthographic;\nimport \'surfaceGeomData.glsl\'\n\n#elif defined(DRAW_HIGHLIGHT)\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else // ENABLE_FLOAT_TEXTURES\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif // ENABLE_FLOAT_TEXTURES\n\n#endif // DRAW_HIGHLIGHT\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int drawItemId = int(v_drawItemId + 0.5);\n\n  //////////////////////////////////////////////\n  // Color\n#if defined(DRAW_COLOR)\n\n\n#ifdef ENABLE_MULTI_DRAW\n\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 baseColor = toLinear(getMaterialValue(materialCoords, 0));\n\n#else // ENABLE_MULTI_DRAW\n\n#ifndef ENABLE_TEXTURES\n  vec4 baseColor = toLinear(BaseColor);\n#else\n  vec4 baseColor = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif // ENABLE_TEXTURES\n\n#endif // ENABLE_MULTI_DRAW\n\n  fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n  //////////////////////////////////////////////\n  // GeomData\n#elif defined(DRAW_GEOMDATA)\n\n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_drawItemId, isOrthographic);\n  //////////////////////////////////////////////\n  // Highlight\n#elif defined(DRAW_HIGHLIGHT)\n  \n  fragColor = getHighlightColor(drawItemId);\n\n#endif // DRAW_HIGHLIGHT\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n')}static getPackedMaterialData(e){const t=new Float32Array(8),n=e.getParameter("BaseColor").getValue();return t[0]=n.r,t[1]=n.g,t[2]=n.b,t[3]=n.a,t[4]=e.getParameter("MaintainScreenSize").getValue(),t[5]=e.getParameter("Overlay").getValue(),t}static isOverlay(){return!0}static getMaterialTemplate(){return u}}const u=new c("HandleShader_template");t.Registry.register("HandleShader",d);const f=(e,t)=>{e.update();const n=e.getVertexAttribute("positions");for(let e=0;e<n.getCount();e++){const i=n.getValueRef(e),s=t.transformVec3(i);i.set(s.x,s.y,s.z)}};class m extends l{constructor(e,t){super("SelectionXfoChange"),this.treeItems=[],this.localXfos=[],this.prevValues=[],this.newValues=[],this.treeItems=e,this.baseXfo=t;const n=t.inverse();this.treeItems.forEach((e=>{this.localXfos.push(n.multiply(e.globalXfoParam.value)),this.prevValues.push(e.globalXfoParam.value),this.newValues.push(e.globalXfoParam.value)}))}setDeltaXfo(e){const t=this.baseXfo.clone();t.tr=e.tr.add(t.tr),t.ori=e.ori.multiply(t.ori),t.sc=e.sc.multiply(t.sc),this.prevValues.forEach(((e,n)=>{const i=t.multiply(this.localXfos[n]);this.newValues[n]=i,this.treeItems[n].globalXfoParam.value=this.newValues[n].clone()})),this.emit("updated")}setDone(){this.emit("done")}undo(){this.treeItems.forEach(((e,t)=>{e.globalXfoParam.value=this.prevValues[t]})),super.undo()}redo(){this.treeItems.forEach(((e,t)=>{e.globalXfoParam.value=this.newValues[t]})),super.redo()}update(e){this.newValues=e.newValues,this.treeItems.forEach(((e,t)=>{e.globalXfoParam.value=this.newValues[t]})),this.emit("updated",e)}toJSON(e){const t={name:this.name,treeItems:[],prevValues:[],newValues:[]};return this.treeItems.forEach(((e,n)=>{t.treeItems[n]=this.treeItems[n].getPath(),t.prevValues[n]=this.prevValues[n].toJSON(),t.newValues[n]=this.newValues[n].toJSON()})),t}fromJSON(e,n){const i=n.appData.scene.getRoot().resolvePath(e.paramPath,1);i&&i instanceof t.Parameter?e.treeItems.forEach(((i,s)=>{this.treeItems[s]=n.appData.scene.getRoot().resolvePath(i,1),this.prevValues[s]||(this.prevValues[s]=new t.Xfo),this.prevValues[s].fromJSON(e.prevValues[s]),this.newValues[s]||(this.newValues[s]=new t.Xfo),this.newValues[s].fromJSON(e.newValues[s])})):console.warn("resolvePath is unable to resolve",e.paramPath)}updateFromJSON(e){e.treeItems.forEach(((t,n)=>{this.prevValues[n].fromJSON(e.prevValues[n]),this.newValues[n].fromJSON(e.newValues[n])}))}}a.registerChange("SelectionXfoChange",m);class g extends r{constructor(e,n=.1,i=.003,s=new t.Color){super(e),this.colorParam.value=s,this.handleMat=new t.Material("handle","HandleShader"),this.handleMat.getParameter("BaseColor").value=s,this.handleMat.getParameter("MaintainScreenSize").value=1,this.handleMat.getParameter("Overlay").value=.9;const r=new t.Cylinder(i,n,64);r.baseZAtZeroParam.value=!0;const a=new t.Cone(4*i,10*i,64,!0),o=new t.GeomItem("handle",r,this.handleMat),l=new t.GeomItem("tip",a,this.handleMat),h=new t.Xfo;h.tr.set(0,0,n),f(a,h),this.colorParam.on("valueChanged",(()=>{this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()})),this.addChild(o),this.addChild(l)}highlight(){super.highlight(),this.handleMat.getParameter("BaseColor").value=this.highlightColorParam.getValue()}unhighlight(){super.unhighlight(),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()}setSelectionGroup(e){this.selectionGroup=e}setTargetParam(e,t=!0){if(this.param=e,t){const t=()=>{this.globalXfoParam.value=e.getValue()};t(),e.on("valueChanged",t)}}getTargetParam(){return this.param?this.param:this.globalXfoParam}onDragStart(e){const t=this.getTargetParam();if(this.baseXfo=t.getValue(),this.selectionGroup){const e=this.selectionGroup.getItems();this.change=new m(Array.from(e),this.globalXfoParam.value),a.getInstance().addChange(this.change)}else this.change=new h(t),a.getInstance().addChange(this.change)}onDrag(e){const n=this.holdPos.subtract(this.grabPos);if(this.selectionGroup){const e=this.change,i=new t.Xfo(n);e.setDeltaXfo(i)}else{const e=this.baseXfo.clone();e.tr.addInPlace(n),this.change.update({value:e})}}onDragEnd(e){this.selectionGroup&&this.change.setDone(),this.change=null}}class p extends s{constructor(e){super(e)}setSelectionGroup(e){this.selectionGroup=e}setTargetParam(e,t=!0){if(this.param=e,t){const t=()=>{this.globalXfoParam.value=e.getValue()};t(),e.on("valueChanged",t)}}getTargetParam(){return this.param?this.param:this.globalXfoParam}onDragStart(e){if(this.baseXfo=this.globalXfoParam.value.clone(),this.vec0=this.grabPos.subtract(this.baseXfo.tr),this.grabCircleRadius=this.vec0.length(),this.vec0.normalizeInPlace(),this.selectionGroup){const e=this.selectionGroup.getItems();this.change=new m(Array.from(e),this.baseXfo),a.getInstance().addChange(this.change)}else{const e=this.getTargetParam();this.change=new h(e),a.getInstance().addChange(this.change)}}onDrag(e){const n=this.holdPos.subtract(this.baseXfo.tr);n.normalizeInPlace();let i=1*this.vec0.angleTo(n);if(this.vec0.cross(n).dot(this.baseXfo.ori.getZaxis())<0&&(i=-i),this.range&&(i=t.MathFunctions.clamp(i,this.range[0],this.range[1])),(e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.shiftKey){const e=Math.PI/180*22.5;i=Math.floor(i/e)*e}const s=new t.Xfo;if(s.ori.setFromAxisAndAngle(this.baseXfo.ori.getZaxis(),i),this.selectionGroup)this.change.setDeltaXfo(s);else{const e=this.baseXfo.clone();e.ori=s.ori.multiply(e.ori),this.change.update({value:e})}}onDragEnd(e){this.selectionGroup&&this.change.setDone(),this.change=null}}class v extends p{constructor(e,n,i,s=new t.Color(1,1,0)){super(e),this.radiusParam=new t.NumberParameter("Radius",n),this.colorParam.value=s,this.addParameter(this.radiusParam),this.handleMat=new t.Material("handle","HandleShader"),this.handleMat.getParameter("BaseColor").value=s,this.handleMat.getParameter("MaintainScreenSize").value=1,this.handleMat.getParameter("Overlay").value=.9;const r=new t.Torus(i,n,64,.5*Math.PI);this.handle=new t.GeomItem("handle",r,this.handleMat),this.handleXfo=new t.Xfo,this.radiusParam.on("valueChanged",(()=>{n=this.radiusParam.getValue(),r.outerRadiusParam.value=n,r.innerRadiusParam.value=.02*n})),this.colorParam.on("valueChanged",(()=>{this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()})),this.addChild(this.handle)}highlight(){super.highlight(),this.handleMat.getParameter("BaseColor").value=this.highlightColorParam.getValue()}unhighlight(){super.unhighlight(),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()}getBaseXfo(){return this.globalXfoParam.value}onDragStart(e){super.onDragStart(e)}onDrag(e){super.onDrag(e)}onDragEnd(e){super.onDragEnd(e)}}class w extends s{constructor(e){super(e),this.fullXfoManipulationInVR=!0}setSelectionGroup(e){this.selectionGroup=e}setTargetParam(e,t=!0){if(this.param=e,t){const t=()=>{this.globalXfoParam.value=e.getValue()};t(),e.on("valueChanged",t)}}getTargetParam(){return this.param?this.param:this.globalXfoParam}onDragStart(e){this.grabPos=this.grabPos;const t=this.getTargetParam();if(this.baseXfo=t.value,this.selectionGroup){const e=this.selectionGroup.getItems();this.change=new m(Array.from(e),this.globalXfoParam.value),a.getInstance().addChange(this.change)}else this.change=new h(t),a.getInstance().addChange(this.change)}onDrag(e){const n=this.holdPos.subtract(this.grabPos);if(this.selectionGroup){const e=this.change,i=new t.Xfo(n);e.setDeltaXfo(i)}else{const e=this.baseXfo.clone();e.tr.addInPlace(n),this.change.update({value:e})}}onDragEnd(e){this.selectionGroup&&this.change.setDone(),this.change=null}onVRControllerButtonDown(e){if(this.fullXfoManipulationInVR){this.activeController=e.controller;const t=this.activeController.getTipXfo(),n=this.globalXfoParam.value;this.grabOffset=t.inverse().multiply(n)}else super.onVRControllerButtonDown(e)}onVRPoseChanged(e){if(this.fullXfoManipulationInVR){const e=this.activeController.getTipXfo().multiply(this.grabOffset);this.change?this.change.update({value:e}):this.getTargetParam().value=e}else super.onVRPoseChanged(e)}onVRControllerButtonUp(e){this.fullXfoManipulationInVR?this.change=null:super.onVRControllerButtonUp(e)}}class b extends w{constructor(e,n,i,s=new t.Color){super(e),this.sizeParam=new t.NumberParameter("Size",n),this.addParameter(this.sizeParam),this.colorParam.value=s,this.handleMat=new t.Material("handle","HandleShader"),this.handleMat.getParameter("BaseColor").value=s,this.handleMat.getParameter("MaintainScreenSize").value=1,this.handleMat.getParameter("Overlay").value=.9;const r=new t.Cuboid(n,n,.02*n),a=new t.Xfo;a.tr=i,f(r,a),this.handle=new t.GeomItem("handle",r,this.handleMat),this.sizeParam.on("valueChanged",(()=>{n=this.sizeParam.getValue(),r.sizeXParam.value=n,r.sizeYParam.value=n,r.sizeZParam.value=.02*n})),this.colorParam.on("valueChanged",(()=>{this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()})),this.addChild(this.handle)}highlight(){super.highlight(),this.handleMat.getParameter("BaseColor").value=this.highlightColorParam.getValue()}unhighlight(){super.unhighlight(),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()}}class _ extends t.TreeItem{constructor(e=.1,n=.003){super("XfoHandle"),this.highlightColorParam=new t.ColorParameter("HighlightColor",new t.Color(1,1,1)),this.highlightColorParam.on("valueChanged",(()=>{const e=this.highlightColorParam.getValue();this.traverse((t=>{t instanceof s&&(t.highlightColorParam.value=e)}))})),this.addParameter(this.highlightColorParam);const i=new t.TreeItem("Translate");this.addChild(i);const r=new t.Color(1,.1,.1),a=new t.Color("#32CD32"),o=new t.Color("#1E90FF");r.a=1,a.a=1,o.a=1;{const s=new g("linearX",e,n,r),a=new t.Xfo;a.ori.setFromAxisAndAngle(new t.Vec3(0,1,0),.5*Math.PI),s.localXfoParam.value=a,i.addChild(s)}{const s=new g("linearY",e,n,a),r=new t.Xfo;r.ori.setFromAxisAndAngle(new t.Vec3(1,0,0),-.5*Math.PI),s.localXfoParam.value=r,i.addChild(s)}{const t=new g("linearZ",e,n,o);i.addChild(t)}const l=.35*e;{const e=new b("planarXY",l,new t.Vec3(.5*l,.5*l,0),o),n=new t.Xfo;e.localXfoParam.value=n,i.addChild(e)}{const e=new b("planarYZ",l,new t.Vec3(-.5*l,.5*l,0),r),n=new t.Xfo;n.ori.setFromAxisAndAngle(new t.Vec3(0,1,0),.5*Math.PI),e.localXfoParam.value=n,i.addChild(e)}{const e=new b("planarXZ",l,new t.Vec3(.5*l,.5*l,0),a),n=new t.Xfo;n.ori.setFromAxisAndAngle(new t.Vec3(1,0,0),.5*Math.PI),e.localXfoParam.value=n,i.addChild(e)}const h=new t.TreeItem("Rotate");this.addChild(h);{const i=new v("rotationX",.75*e,n,r),s=new t.Xfo;s.ori.setFromEulerAngles(new t.EulerAngles(-.5*Math.PI,-.5*Math.PI,0)),i.localXfoParam.value=s,h.addChild(i)}{const i=new v("rotationY",.75*e,n,a),s=new t.Xfo;s.ori.setFromAxisAndAngle(new t.Vec3(1,0,0),-.5*Math.PI),i.localXfoParam.value=s,h.addChild(i)}{const i=new v("rotationZ",.75*e,n,o),s=new t.Xfo;s.ori.setFromAxisAndAngle(new t.Vec3(0,0,1),.5*Math.PI),i.localXfoParam.value=s,h.addChild(i)}}showHandles(e){e?this.setVisible(!0):this.setVisible(!1)}setTargetParam(e,t=!0){this.param=e,this.traverse((t=>{t instanceof s&&t.setTargetParam(e,!1)}))}setSelectionGroup(e){this.traverse((t=>{(t instanceof g||t instanceof b||t instanceof v)&&t.setSelectionGroup(e)}))}}class y extends t.Operator{constructor(e,n){super(),this.xfoModeInput=new t.NumberOperatorInput("InitialXfoMode"),this.xfoOutput=new t.XfoOperatorOutput("GroupGlobalXfo"),this.addInput(this.xfoModeInput).setParam(e),this.addOutput(this.xfoOutput).setParam(n),this.currGroupXfo=new t.Xfo}addItem(e){const n=new t.XfoOperatorInput("MemberGlobalXfo"+this.getNumInputs());n.setParam(e.globalXfoParam),this.addInput(n),this.setDirty()}removeItem(e){const t=e.globalXfoParam;for(let e=1;e<this.getNumInputs();e++){const n=this.getInputByIndex(e);if(n.getParam()==t)return this.removeInput(n),void this.setDirty()}throw new Error("Item not found in SelectionGroupXfoOperator")}backPropagateValue(e){const t=this.currGroupXfo.inverse(),n=e.multiply(t);n.ori.normalizeInPlace(),this.currGroupXfo=n.multiply(this.currGroupXfo);for(let e=1;e<this.getNumInputs();e++){const t=this.getInputByIndex(e),i=t.getValue(),s=n.multiply(i);t.setValue(s)}}evaluate(){if(this.currGroupXfo=new t.Xfo,1==this.getNumInputs())return void this.xfoOutput.setClean(this.currGroupXfo);const e=this.xfoModeInput.getValue();if(e!=t.KinematicGroup.INITIAL_XFO_MODES.manual){if(e==t.KinematicGroup.INITIAL_XFO_MODES.first){const e=this.getInputByIndex(1).getValue();this.currGroupXfo.tr=e.tr.clone(),this.currGroupXfo.ori=e.ori.clone()}else if(e==t.KinematicGroup.INITIAL_XFO_MODES.average){this.currGroupXfo.ori.set(0,0,0,0);let e=0;for(let t=1;t<this.getNumInputs();t++){const n=this.getInputByIndex(t).getValue();this.currGroupXfo.tr.addInPlace(n.tr),0==e&&this.currGroupXfo.ori.addInPlace(n.ori),e++}this.currGroupXfo.tr.scaleInPlace(1/e)}else{if(e!=t.KinematicGroup.INITIAL_XFO_MODES.globalOri)throw new Error("Invalid KinematicGroup.INITIAL_XFO_MODES.");{let e=0;for(let t=1;t<this.getNumInputs();t++){const n=this.getInputByIndex(t).getValue();this.currGroupXfo.tr.addInPlace(n.tr),e++}this.currGroupXfo.tr.scaleInPlace(1/e)}}this.currGroupXfo.ori.normalizeInPlace(),this.xfoOutput.setClean(this.currGroupXfo)}else this.currGroupXfo=this.xfoOutput.getValue().clone()}}const I={disabled:0,manual:1,first:2,average:3,globalOri:4};class x extends t.SelectionSet{constructor(e){super(),this.initialXfoModeParam=new t.MultiChoiceParameter("InitialXfoMode",I.average,["manual","first","average","global"]);const n=e.selectionOutlineColor?e.selectionOutlineColor:new t.Color(3/255,227/255,172/255,.1);this.highlightColorParam.value=n,this.itemsParam.setFilterFn((e=>e instanceof t.BaseItem)),this.addParameter(this.initialXfoModeParam),this.selectionGroupXfoOp=new y(this.initialXfoModeParam,this.globalXfoParam)}static get INITIAL_XFO_MODES(){return I}clone(){const e=new x;return e.copyFrom(this),e}bindItem(e,n){if(e instanceof t.TreeItem){const t=this.highlightColorParam.value;t.a=this.highlightFillParam.value,e.addHighlight("selected"+this.getId(),t,!0),this.selectionGroupXfoOp.addItem(e)}}unbindItem(e,n){e instanceof t.TreeItem&&(e.removeHighlight("selected"+this.getId(),!0),this.selectionGroupXfoOp.removeItem(e))}}class P extends l{constructor(e,t,n){super("SelectionChange"),this.__selectionManager=e,this.__prevSelection=t,this.__newSelection=n}undo(){this.__selectionManager.setSelection(this.__prevSelection,!1)}redo(){this.__selectionManager.setSelection(this.__newSelection,!1)}toJSON(e){const t=super.toJSON(e),n=[];for(const e of this.__newSelection)n.push(e.getPath());return t.itemPaths=n,t}fromJSON(e,t){super.fromJSON(e,t),this.__selectionManager=t.appData.selectionManager,this.__prevSelection=new Set(this.__selectionManager.getSelection());const n=t.appData.scene.getRoot(),i=new Set;for(const t of e.itemPaths)i.add(n.resolvePath(t,1));this.__newSelection=i,this.__selectionManager.setSelection(this.__newSelection,!1)}}a.registerChange("SelectionChange",P);class C extends l{constructor(e,t){super("Selection Visibility Change"),this.selection=e,this.state=t,this._changeItemsVisibility(this.state)}undo(){this._changeItemsVisibility(!this.state)}redo(){this._changeItemsVisibility(this.state)}_changeItemsVisibility(e){for(const t of this.selection)t.getParameter("Visible").value=e}}a.registerChange("ToggleSelectionVisibility",C);class k extends t.EventEmitter{constructor(e,n={}){if(super(),this.leadSelection=void 0,this.appData=e,this.selectionGroup=new x(n),!0===n.enableXfoHandles){const e=.1,n=.02*e;this.xfoHandle=new _(e,n),this.xfoHandle.setSelectionGroup(this.selectionGroup),this.xfoHandle.setVisible(!1),this.xfoHandle.highlightColorParam.value=new t.Color(1,1,0),this.xfoHandleVisible=!0,this.selectionGroup.addChild(this.xfoHandle)}this.appData.renderer&&this.setRenderer(this.appData.renderer)}setRenderer(e){this.__renderer!=e?(this.__renderer=e,this.__renderer.addTreeItem(this.selectionGroup)):console.warn("Renderer already set on SelectionManager")}setXfoMode(e){this.xfoHandle&&(this.selectionGroup.initialXfoModeParam.value=e)}showHandles(e){this.xfoHandleVisible=e}updateHandleVisibility(){if(!this.xfoHandle)return;const e=this.selectionGroup.getItems(),t=Array.from(e).length>0;this.xfoHandle.setVisible(t&&this.xfoHandleVisible),this.__renderer.requestRedraw()}getSelection(){return this.selectionGroup.getItems()}setSelection(e,t=!0){const n=new Set(this.selectionGroup.getItems()),i=new Set(n);for(const t of e)n.has(t)||(t.setSelected(!0),n.add(t));for(const t of n)e.has(t)||(t.setSelected(!1),n.delete(t));if(this.selectionGroup.setItems(n),n.size>0?this.__setLeadSelection(n.values().next().value):this.__setLeadSelection(),this.updateHandleVisibility(),t){const e=new P(this,i,n);a.getInstance().addChange(e)}this.emit("selectionChanged",{prevSelection:i,selection:n})}__setLeadSelection(e){this.leadSelection!=e&&(this.leadSelection=e,this.emit("leadSelectionChanged",{treeItem:e}))}toggleItemSelection(e,t=!0){const n=new Set(this.selectionGroup.getItems()),i=new Set(n);if(t&&(1!=n.size||!n.has(e))){let t=!0;if(n.has(e)){let i=1;e.traverse((e=>{n.has(e)&&i++})),t=i!=n.size}t&&(Array.from(n).forEach((e=>{e.setSelected(!1)})),n.clear())}let s;n.has(e)?(e.setSelected(!1),n.delete(e),s=!1):(e.setSelected(!0),n.add(e),s=!0),this.selectionGroup.setItems(n),s&&1===n.size?this.__setLeadSelection(e):s||(1===n.size?this.__setLeadSelection(n.values().next().value):0===n.size&&this.__setLeadSelection());const r=new P(this,i,n);a.getInstance().addChange(r),this.updateHandleVisibility(),this.emit("selectionChanged",{prevSelection:i,selection:n})}clearSelection(e=!0){const t=new Set(this.selectionGroup.getItems());if(0==t.size)return!1;let n;e&&(n=new Set(t));for(const e of t)e.setSelected(!1);if(t.clear(),this.selectionGroup.setItems(t),this.__setLeadSelection(),this.updateHandleVisibility(),e){const e=new P(this,n,t);a.getInstance().addChange(e),this.emit("selectionChanged",{selection:t,prevSelection:n})}return!0}selectItems(e,t=!0){const n=new Set(this.selectionGroup.getItems()),i=new Set(n);t&&n.clear();for(const t of e)n.has(t)||(t.setSelected(!0),n.add(t));const s=new P(this,i,n);a.getInstance().addChange(s),this.selectionGroup.setItems(n),1===n.size?this.__setLeadSelection(n.values().next().value):0===n.size&&this.__setLeadSelection(),this.updateHandleVisibility(),this.emit("selectionChanged",{prevSelection:i,selection:n})}deselectItems(e){const t=new Set(this.selectionGroup.getItems()),n=new Set(t);for(const n of e)t.has(n)&&(n.setSelected(!1),t.delete(n));this.selectionGroup.setItems(t);const i=new P(this,n,t);a.getInstance().addChange(i),1===t.size?this.__setLeadSelection(t.values().next().value):0===t.size&&this.__setLeadSelection(),this.updateHandleVisibility(),this.emit("selectionChanged",{prevSelection:n,selection:t})}toggleSelectionVisibility(){if(this.leadSelection){const e=this.selectionGroup.getItems(),t=!this.leadSelection.getVisible(),n=new C(e,t);a.getInstance().addChange(n)}}startPickingMode(e,t,n,i){console.log(e),this.__pickCB=t,this.__pickFilter=n,this.__pickCount=i,this.__picked=[]}pickingFilter(e){return this.__pickFilter(e)}pickingModeActive(){return null!=this.__pickCB}cancelPickingMode(){this.__pickCB=void 0}pick(e){if(this.__pickCB){if(Array.isArray(e))this.__pickFilter?this.__picked=this.__picked.concat(e.filter(this.__pickFilter)):this.__picked=this.__picked.concat(e);else{if(this.__pickFilter&&!this.__pickFilter(e))return;this.__picked.push(e)}this.__picked.length==this.__pickCount&&(this.__pickCB(this.__picked),this.__pickCB=void 0)}}}class T extends l{constructor(e,t,n){e?(super(e.getName()+" Added"),this.treeItem=e,this.owner=t,this.selectionManager=n,this.prevSelection=new Set(this.selectionManager.getSelection()),this.treeItemIndex=this.owner.getChildIndex(this.owner.addChild(this.treeItem)),this.selectionManager.setSelection(new Set([this.treeItem]),!1)):super()}undo(){this.treeItem instanceof t.Operator?this.treeItem.detach():this.treeItem instanceof t.TreeItem&&this.treeItem.traverse((e=>{e instanceof t.Operator&&e.detach()}),!1),this.owner.removeChild(this.treeItemIndex),this.selectionManager&&this.selectionManager.setSelection(this.prevSelection,!1)}redo(){this.treeItem instanceof t.Operator?this.treeItem.reattach():this.treeItem instanceof t.TreeItem&&this.treeItem.traverse((e=>{e instanceof t.Operator&&e.reattach()}),!1),this.owner.addChild(this.treeItem),this.selectionManager&&this.selectionManager.setSelection(new Set([this.treeItem]),!1)}toJSON(e){return{name:this.name,treeItem:this.treeItem.toJSON(e),treeItemPath:this.treeItem.getPath(),treeItemIndex:this.treeItemIndex}}fromJSON(e,n){const i=t.Registry.constructClass(e.treeItem.type);i?(this.name=e.name,this.treeItem=i,this.treeItem.fromJSON(e.treeItem,n),this.treeItemIndex=this.owner.getChildIndex(this.owner.addChild(this.treeItem))):console.warn("resolvePath is unable to construct",e.treeItem)}destroy(){}}a.registerChange("TreeItemAddChange",T);class A extends l{constructor(e,t){e?(super(e.getName()+" Moved"),this.treeItem=e,this.oldOwner=this.treeItem.getOwner(),this.oldOwnerIndex=this.oldOwner.getChildIndex(this.treeItem),this.newOwner=t,this.newOwner.addChild(this.treeItem,!0)):super()}undo(){this.oldOwner.insertChild(this.treeItem,this.oldOwnerIndex,!0)}redo(){this.newOwner.addChild(this.treeItem,!0)}toJSON(e){return{name:this.name,treeItemPath:this.treeItem.getPath(),newOwnerPath:this.newOwner.getPath()}}fromJSON(e,t){if(!t||!t.scene)return;const n=t.scene.getRoot().resolvePath(e.treeItemPath,1);if(!n)return void console.warn("resolvePath is unable to resolve",e.treeItemPath);const i=t.scene.getRoot().resolvePath(e.newOwnerPath,1);i?(this.name=e.name,this.treeItem=n,this.newOwner=i,this.oldOwner=this.treeItem.getOwner(),this.oldOwnerIndex=this.oldOwner.getChildIndex(this.treeItem),this.newOwner.addChild(this.treeItem,!0)):console.warn("resolvePath is unable to resolve",e.newOwnerPath)}}a.registerChange("TreeItemMoveChange",A);class $ extends l{constructor(e,n){if(super(),this.items=[],this.itemOwners=[],this.itemPaths=[],this.itemIndices=[],e){this.selectionManager=n.selectionManager,this.prevSelection=new Set(this.selectionManager.getSelection()),this.items=e,this.newSelection=new Set(this.prevSelection);const i=[];this.items.forEach((e=>{const n=e.getOwner(),s=n.getChildIndex(e);i.push(e.getName()),this.itemOwners.push(n),this.itemPaths.push(e.getPath()),this.itemIndices.push(s),this.selectionManager&&this.newSelection.has(e)&&this.newSelection.delete(e),e instanceof t.Operator?e.detach():e instanceof t.TreeItem&&e.traverse((e=>{e instanceof t.Operator&&e.detach(),this.selectionManager&&this.newSelection.has(e)&&this.newSelection.delete(e)}),!1),n.removeChild(s)})),this.selectionManager.setSelection(this.newSelection,!1),this.name=i+" Deleted"}}undo(){this.items.forEach(((e,n)=>{this.itemOwners[n].insertChild(e,this.itemIndices[n],!1,!1),e instanceof t.Operator?e.reattach():e instanceof t.TreeItem&&e.traverse((e=>{e instanceof t.Operator&&e.reattach()}),!1)})),this.selectionManager&&this.selectionManager.setSelection(this.prevSelection,!1)}redo(){this.selectionManager&&this.selectionManager.setSelection(this.newSelection,!1),this.items.forEach(((e,n)=>{this.itemOwners[n].removeChild(this.itemIndices[n]),e instanceof t.Operator?e.detach():e instanceof t.TreeItem&&e.traverse((e=>{e instanceof t.Operator&&e.detach()}),!1)}))}toJSON(e){const t={name:this.name,items:[],itemPaths:this.itemPaths,itemIndices:this.itemIndices};return this.items.forEach((e=>{t.items.push(e.toJSON())})),t}fromJSON(e,t){this.name=e.name,e.itemPaths.forEach((e=>{const n=t.scene.getRoot().resolvePath(e,1);if(!n)return void console.warn("resolvePath is unable to resolve",e);const i=n.getOwner();this.itemOwners.push(i),this.itemPaths.push(n.getPath()),this.itemIndices.push(i.getChildIndex(n))}))}destroy(){}}a.registerChange("TreeItemsRemoveChange",$);class E extends t.BaseTool{constructor(e){super(),e||console.error("App data not provided to tool"),this.appData=e,this.dragging=!1,e.selectionManager||console.error("`SelectionTool` requires `SelectionManager` to be provided in the `appData` object"),this.selectionManager=e.selectionManager,this.selectionRect=new t.Rect(1,1),this.selectionRectMat=new t.Material("marker","ScreenSpaceShader"),this.selectionRectMat.getParameter("BaseColor").value=new t.Color("#03E3AC"),this.selectionRectXfo=new t.Xfo,this.selectionRectXfo.tr.set(.5,.5,0),this.selectionRectXfo.sc.set(0,0,0),this.rectItem=new t.GeomItem("selectionRect",this.selectionRect,this.selectionRectMat),this.rectItem.getParameter("Visible").value=!1,this.appData.renderer.addTreeItem(this.rectItem)}activateTool(){super.activateTool()}deactivateTool(){super.deactivateTool(),this.selectionRectXfo.sc.set(0,0,0),this.rectItem.globalXfoParam.value=this.selectionRectXfo,this.rectItem.getParameter("Visible").value=!1}setSelectionManager(e){this.selectionManager=e}setSelectionFilter(e){this.__selectionFilterFn=e}__resizeRect(e,n){const i=new t.Vec2(1/e.getWidth()*2,1/e.getHeight()*2),s=n.multiply(i);this.selectionRectXfo.sc.set(Math.abs(s.x),Math.abs(s.y),1);const r=this.pointerDownPos.subtract(n.scale(.5)).multiply(i).subtract(new t.Vec2(1,1));this.selectionRectXfo.tr.x=r.x,this.selectionRectXfo.tr.y=-r.y,this.rectItem.globalXfoParam.value=this.selectionRectXfo}onPointerDoublePress(e){}onPointerDown(e){(e instanceof t.ZeaTouchEvent||e instanceof t.ZeaMouseEvent&&0==e.button)&&(this.pointerDownPos=e.pointerPos,this.dragging=!1,e.stopPropagation())}onPointerMove(e){if(e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent){if(this.pointerDownPos){const t=this.pointerDownPos.subtract(e.pointerPos);t.length()>4&&(this.dragging=!0,this.rectItem.getParameter("Visible").value=!0,this.__resizeRect(e.viewport,t)),e.stopPropagation()}}else console.warn("not handling VR")}onPointerUp(e){if((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&this.pointerDownPos){if(this.dragging){this.rectItem.getParameter("Visible").value=!1;const n=e.pointerPos,i=new t.Vec2(Math.min(this.pointerDownPos.x,n.x),Math.min(this.pointerDownPos.y,n.y)),r=new t.Vec2(Math.max(this.pointerDownPos.x,n.x),Math.max(this.pointerDownPos.y,n.y)),a=e.viewport;let o=Array.from(a.getGeomItemsInRect(i,r));if(this.__selectionFilterFn){const e=[];for(let t=0;t<o.length;t++){const n=this.__selectionFilterFn(o[t]);e.includes(n)||e.push(n)}o=e}if(!this.selectionManager)throw"Please set the Selection Manager on the Selection Tool before using it.";if(this.selectionManager.pickingModeActive())this.selectionManager.pick(o);else{const t=new Set([...o].filter((e=>!(e.getOwner()instanceof s))));e.shiftKey?this.selectionManager.deselectItems(t):this.selectionManager.selectItems(t,!e.ctrlKey),this.selectionRectXfo.sc.set(0,0,0),this.rectItem.globalXfoParam.value=this.selectionRectXfo}}else{const t=e.viewport.getGeomDataAtPos(e.pointerPos,void 0);if(null==t||t.geomItem.getOwner()instanceof s)this.selectionManager.clearSelection();else{let n=t.geomItem;if(this.__selectionFilterFn&&(n=this.__selectionFilterFn(n)),this.selectionManager.pickingModeActive())this.selectionManager.pick(n);else if(e.shiftKey){const e=new Set;e.add(n),this.selectionManager.deselectItems(e)}else this.selectionManager.toggleItemSelection(n,!e.ctrlKey)}}this.pointerDownPos=void 0,e.stopPropagation()}}onVRControllerButtonDown(e){if(1==e.button){if(!this.selectionManager)throw"Please set the Selection Manager on the Selection Tool before using it.";const t=e.controller.getGeomItemAtTip();null==t||t.geomItem.getOwner()instanceof s||(this.selectionManager.toggleItemSelection(t.geomItem),e.stopPropagation())}}}const S=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){const n=e(t).toLowerCase();return function(){const e="application/font-woff",t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[n]||""},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){const n=window.atob(e.toDataURL().split(",")[1]),i=n.length,s=new Uint8Array(i);for(let e=0;e<i;e++)s[e]=n.charCodeAt(e);t(new Blob([s],{type:"image/png"}))}))}(e)},resolveUrl:function(e,t){const n=document.implementation.createHTMLDocument(),i=n.createElement("base");n.head.appendChild(i);const s=n.createElement("a");return n.body.appendChild(s),i.href=t,s.href=e,s.href},getAndEncode:function(e){const t=3e4;return N.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),new Promise((function(n){const i=new XMLHttpRequest;let s;if(i.onreadystatechange=r,i.ontimeout=a,i.responseType="blob",i.timeout=t,i.open("GET",e,!0),i.send(),N.impl.options.imagePlaceholder){const e=N.impl.options.imagePlaceholder.split(/,/);e&&e[1]&&(s=e[1])}function r(){if(4!==i.readyState)return;if(200!==i.status)return void(s?n(s):o("cannot fetch resource: "+e+", status: "+i.status));const t=new FileReader;t.onloadend=function(){if("string"==typeof t.result){const e=t.result.split(/,/)[1];n(e)}else console.warn("encoder.result is not of string type")},t.readAsDataURL(i.response)}function a(){s?n(s):o("timeout of "+t+"ms occured while fetching resource: "+e)}function o(e){console.error(e),n("")}}))},uid:function(){let e=0;return function(){return"u"+t()+e++;function t(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}(),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){const t=[],n=e.length;for(let i=0;i<n;i++)t.push(e[i]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise((function(t,n){const i=new Image;i.onload=function(){t(i)},i.onerror=n,i.src=e}))},width:function(e){const n=t(e,"border-left-width"),i=t(e,"border-right-width");return e.scrollWidth+n+i},height:function(e){const n=t(e,"border-top-width"),i=t(e,"border-bottom-width");return e.scrollHeight+n+i}};function e(e){const t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function t(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}(),M=function(){const e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,s,r){return a()?Promise.resolve(e):Promise.resolve(e).then(n).then((function(t){let n=Promise.resolve(e);return t.forEach((function(e){n=n.then((function(t){return i(t,e,s,r)}))})),n}));function a(){return!t(e)}},shouldProcess:t,impl:{readUrls:n,inline:i}};function t(t){return-1!==t.search(e)}function n(t){const n=[];let i;for(;null!==(i=e.exec(t));)n.push(i[1]);return n.filter((function(e){return!S.isDataUrl(e)}))}function i(e,t,n,i){return Promise.resolve(t).then((function(e){return n?S.resolveUrl(e,n):e})).then(i||S.getAndEncode).then((function(e){return S.dataAsUrl(e,S.mimeType(t))})).then((function(n){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+S.escape(e)+")(['\"]?\\))","g")}(t),"$1"+n+"$3")}))}}(),R=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join("\n")}))},impl:{readAll:e}};function e(e){return Promise.resolve(S.asArray(e.styleSheets)).then((function(e){const t=[];return e.forEach((function(e){try{S.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return M.shouldProcess(e.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(e){return{resolve:function(){const t=(e.parentStyleSheet||{}).href;return M.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),D=function(){return{inlineAll:function t(n){return n instanceof Element?i(n).then((function(){return n instanceof HTMLImageElement?e(n).inline():Promise.all(S.asArray(n.childNodes).map((function(e){return t(e)})))})):Promise.resolve(n);function i(e){const t=e.style.getPropertyValue("background");return t?M.inlineAll(t).then((function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))})).then((function(){return e})):Promise.resolve(e)}},impl:{newImage:e}};function e(e){return{inline:function(t){return S.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||S.getAndEncode).then((function(t){return S.dataAsUrl(t,S.mimeType(e.src))})).then((function(t){return new Promise((function(n,i){e.onload=n,e.onerror=i,e.src=t}))}))}}}}(),O={imagePlaceholder:void 0,cacheBust:!1},N={toSvg:z,toPng:function(e,t){return L(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return L(e,t=t||{}).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))},toBlob:function(e,t){return L(e,t||{}).then(S.canvasToBlob)},toPixelData:function(e,t){return L(e,t||{}).then((function(t){return t.getContext("2d").getImageData(0,0,S.width(e),S.height(e)).data}))},toCanvas:function(e,t){return L(e,t||{}).then((function(e){return e}))},impl:{fontFaces:R,images:D,util:S,inliner:M,options:{cacheBust:void 0,imagePlaceholder:void 0}}};function z(e,t){return function(e){void 0===e.imagePlaceholder?N.impl.options.imagePlaceholder=O.imagePlaceholder:N.impl.options.imagePlaceholder=e.imagePlaceholder,void 0===e.cacheBust?N.impl.options.cacheBust=O.cacheBust:N.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return V(e,t.filter,!0)})).then(B).then(U).then((function(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]})),e})).then((function(n){return function(e,t,n){return Promise.resolve(e).then((function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)})).then(S.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+n+'">'+e+"</svg>"})).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))}(n,t.width||S.width(e),t.height||S.height(e))}))}function L(e,t){return z(e,t).then(S.makeImage).then(S.delay(100)).then((function(n){const i=function(e){const n=document.createElement("canvas");if(n.width=t.width||S.width(e),n.height=t.height||S.height(e),t.bgcolor){const e=n.getContext("2d");e.fillStyle=t.bgcolor,e.fillRect(0,0,n.width,n.height)}return n}(e);return i.getContext("2d").drawImage(n,0,0),i}))}function V(e,t,n){return n||!t||t(e)?Promise.resolve(e).then((function(e){return e instanceof HTMLCanvasElement?S.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(n){return function(e,t,n){const i=e.childNodes;return 0===i.length?Promise.resolve(t):s(t,S.asArray(i),n).then((function(){return t}));function s(e,t,n){let i=Promise.resolve();return t.forEach((function(t){i=i.then((function(){return V(t,n)})).then((function(t){t&&e.appendChild(t)}))})),i}}(e,n,t)})).then((function(t){return function(e,t){return t instanceof Element?Promise.resolve().then(n).then(i).then(s).then(r).then((function(){return t})):t;function n(){function n(e,t){function n(e,t){S.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}e.cssText?t.cssText=e.cssText:n(e,t)}n(window.getComputedStyle(e),t.style)}function i(){function n(n){const i=window.getComputedStyle(e,n),s=i.getPropertyValue("content");if(""===s||"none"===s)return;const r=S.uid();t.className=t.className+" "+r;const a=document.createElement("style");function o(e,t,n){const i="."+e+":"+t,s=n.cssText?r(n):a(n);return document.createTextNode(i+"{"+s+"}");function r(e){const t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function a(e){return S.asArray(e).map(t).join("; ")+";";function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}}}a.appendChild(o(r,n,i)),t.appendChild(a)}[":before",":after"].forEach((function(e){n(e)}))}function s(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function r(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach((function(e){const n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))}}(e,t)})):Promise.resolve()}function B(e){return R.resolveAll().then((function(t){const n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function U(e){return D.inlineAll(e).then((function(){return e}))}function X(e,t,n){if(n(e,t))for(e=e.firstChild;e;)X(e,t+1,n),e=e.nextSibling}const F='data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"'.length,G=(e,t,n,i)=>{N.toSvg(e).then((e=>{const s=e.substring(0,F)+` viewBox="0 0 ${t.width} ${t.height}"`+e.substring(F),r=new Image;r.onload=function(){i(r,n)},r.src=s}))},H=new t.Plane(1,1);class j extends t.TreeItem{constructor(e,n){super("VRControllerUI"),this.setSelectable(!1),this.appData=e,this.__vrUIDOMElement=n,this.__vrUIDOMElement.style.display="none";const i=new t.TreeItem("Offset");this.addChild(i,!1),this.ready=!1;const s=new ResizeObserver((e=>{s.disconnect();const r=new t.Xfo,a=5e-4;r.sc.set(a,a,a),r.ori.setFromEulerAngles(new t.EulerAngles(Math.PI,Math.PI,0)),i.localXfoParam.value=r,this.size=new t.Vec3(n.clientWidth*a,n.clientHeight*a,1),X(n,0,((e,s)=>{if("button"==e.className){const r=function(e){const t=e.computedStyleMap();return{width:t.get("width").value+(t.get("margin-left").value+t.get("margin-right").value),height:t.get("height").value+(t.get("margin-top").value+t.get("margin-bottom").value)}}(e),a=new t.Xfo;a.sc.set(r.width,-r.height,1),a.tr.set(e.offsetLeft+.5*r.width-.5*n.clientWidth,e.offsetTop+.5*r.height-.5*n.clientHeight,-s);const o=new t.Material("element-vr-ui-mat","FlatSurfaceShader");o.getParameter("BaseColor").value=new t.Color(.3,.3,.3);const l=new t.DataImage;o.getParameter("BaseColor").value=l;const h=new t.GeomItem("element-vr-ui",H,o,a);h.setSelectable(!1),i.addChild(h,!1);const c={};return r.width>0&&r.height>0&&G(e,r,e.id+e.className,((e,t)=>{c[t]=e,l.setData(r.width,r.height,e)})),new MutationObserver((t=>{if(0==r.width||0==r.height)return;const n=e.id+e.className;c[n]?l.setData(r.width,r.height,c[n]):G(e,r,n,((e,t)=>{c[t]=e,l.setData(r.width,r.height,e)}))})).observe(e,{attributes:!0,characterData:!1,childList:!1,subtree:!1}),!1}return!0})),this.ready=!0,this.emit("ready")}));s.observe(n)}activate(){this.__vrUIDOMElement.style.display="block"}deactivate(){this.__vrUIDOMElement.style.display="none"}sendMouseEvent(e,t,n){const i=new MouseEvent(e,Object.assign({target:n,view:window,bubbles:!0,cancelable:!0},t));return n.dispatchEvent(i),i}}class Z extends t.BaseTool{constructor(e,n){super(),this.appData=e,this.__vrUIDOMElement=n,this.controllerUI=new j(e,this.__vrUIDOMElement);const i=new t.Material("pointermat","LinesShader");i.setSelectable(!1),i.getParameter("BaseColor").value=new t.Color(1.2,0,0);const s=new t.Lines;s.setNumVertices(2),s.setNumSegments(1),s.setSegmentVertexIndices(0,0,1);const r=s.getVertexAttribute("positions");r.getValueRef(0).set(0,0,0),r.getValueRef(1).set(0,0,-1),s.setBoundingBoxDirty(),this.__pointerLocalXfo=new t.Xfo,this.__pointerLocalXfo.sc.set(1,1,.1),this.__pointerLocalXfo.ori.setFromAxisAndAngle(new t.Vec3(1,0,0),-.2*Math.PI),this.__uiPointerItem=new t.GeomItem("VRControllerPointer",s,i),this.__uiPointerItem.setSelectable(!1),this.__triggerHeld=!1,this.uiOpen=!1,this.appData.renderer.getXRViewport().then((e=>{e.on("presentingChanged",(e=>{this.uiOpen&&!e.state&&this.closeUI()}))}))}getName(){return"VRUITool"}activateTool(){super.activateTool()}deactivateTool(){this.uiOpen&&this.closeUI(),super.deactivateTool()}displayUI(e,n,i){this.controllerUI.activate(),this.uiController=e,this.pointerController=n;const s=this.controllerUI.localXfoParam.getValue();if(s.ori.setFromAxisAndAngle(new t.Vec3(1,0,0),-.6*Math.PI),this.pointerController){const e=this.uiController.getTreeItem().globalXfoParam.value,t=this.pointerController.getTreeItem().globalXfoParam.value,n=e.tr.subtract(i.tr),r=t.tr.subtract(i.tr);n.cross(r).dot(i.ori.getYaxis())>0?s.tr.set(.05,-.05,.08):s.tr.set(-.05,-.05,.08)}else s.tr.set(0,-.05,.08);if(this.controllerUI.localXfoParam.value=s,this.uiController&&(this.uiController.getTipItem().addChild(this.controllerUI,!1),this.pointerController&&this.pointerController.getTipItem().addChild(this.__uiPointerItem,!1),this.appData.session)){const e=()=>{this.appData.session.pub("pose-message",{interfaceType:"VR",showUIPanel:{controllerId:this.uiController.getId(),localXfo:s.toJSON(),size:this.controllerUI.size.toJSON()}})};this.controllerUI.ready?e():this.controllerUI.on("ready",e)}this.uiOpen=!0}closeUI(){this.controllerUI.deactivate(),this.uiController&&(this.uiController.getTipItem().removeChildByHandle(this.controllerUI),this.pointerController&&this.pointerController.getTipItem().removeChildByHandle(this.__uiPointerItem),this.appData.session&&this.appData.session.pub("pose-message",{interfaceType:"VR",closehideUIPanel:{controllerId:this.uiController.getId()}})),this.uiOpen=!1}setPointerLength(e){this.__pointerLocalXfo.sc.set(1,1,e),this.__uiPointerItem.localXfoParam.value=this.__pointerLocalXfo}calcUIIntersection(){const e=this.__uiPointerItem.globalXfoParam.value,n=e.ori.getZaxis().negate(),i=new t.Ray(e.tr,n),s=this.controllerUI.globalXfoParam.value,r=this.controllerUI.size.multiply(s.sc),a=new t.Ray(s.tr,s.ori.getZaxis().negate()),o=i.intersectRayPlane(a);if(o<=0)return void this.setPointerLength(.5);const l=e.tr.add(n.scale(o)).subtract(a.start),h=l.dot(s.ori.getXaxis())/r.x,c=l.dot(s.ori.getYaxis())/r.y;if(Math.abs(h)>.5||Math.abs(c)>.5)return void this.setPointerLength(.5);this.setPointerLength(o/s.sc.z);const d=this.__vrUIDOMElement.getBoundingClientRect();return{clientX:Math.round(h*-d.width+d.width/2),clientY:Math.round(c*-d.height+d.height/2)}}sendEventToUI(e,t){const n=this.calcUIIntersection();if(n){n.offsetX=n.pageX=n.pageX=n.screenX=n.clientX,n.offsetY=n.pageY=n.pageY=n.screenY=n.clientY;let i=document.elementFromPoint(n.clientX,n.clientY);return i?(i.shadowRoot&&(i=i.shadowRoot.elementFromPoint(n.clientX,n.clientY)),i!=this._element&&(this._element&&this.controllerUI.sendMouseEvent("mouseleave",Object.assign(t,n),this._element),this._element=i,this.controllerUI.sendMouseEvent("mouseenter",Object.assign(t,n),this._element)),this.controllerUI.sendMouseEvent(e,Object.assign(t,n),this._element)):this._element=null,this._element}this._element&&(this.controllerUI.sendMouseEvent("mouseleave",Object.assign(t,n),this._element),this._element=null)}onPointerDown(e){if(e.pointerType===t.POINTER_TYPES.xr&&e.controller==this.pointerController&&this.uiOpen){this.__triggerHeld=!0;const t=this.sendEventToUI("mousedown",{button:e.button-1});this.__triggerDownElem=t||null,e.stopPropagation()}}onPointerUp(e){if(e.pointerType===t.POINTER_TYPES.xr&&e.controller==this.pointerController&&this.uiOpen){this.__triggerHeld=!1;const t=this.sendEventToUI("mouseup",{button:e.button-1});t&&this.__triggerDownElem==t&&this.sendEventToUI("mouseup",{button:e.button-1}),this.__triggerDownElem=null,e.stopPropagation()}}onPointerMove(e){if(e.pointerType===t.POINTER_TYPES.xr)if(this.uiOpen){const t=e.viewXfo;(()=>{const n=this.uiController.getTreeItem().globalXfoParam.value,i=n.tr.subtract(t.tr);return i.normalizeInPlace(),!(i.angleTo(n.ori.getYaxis())>.5*Math.PI&&(this.closeUI(),e.getCapture()==this&&e.releaseCapture(),1))})()&&this.sendEventToUI("mousemove",{}),e.stopPropagation()}else{if(!e.controllers[0]||e.controllers[0].buttonPressed||!e.controllers[1]||e.controllers[1].buttonPressed)return;const t=e.viewXfo,n=(n,i)=>{const s=n.getTreeItem().globalXfoParam.value,r=s.tr.subtract(t.tr);return r.normalizeInPlace(),r.angleTo(s.ori.getYaxis())<.25*Math.PI&&(this.displayUI(n,i,t),e.setCapture(this),e.stopPropagation(),!0)};if(n(e.controllers[0],e.controllers[1]))return;if(n(e.controllers[1],e.controllers[0]))return}}}class J extends l{constructor(e){super("HoldObjectsChange"),this.__selection=[],this.__prevXfos=[],this.__newXfos=[],e&&this.update(e)}undo(){for(let e=0;e<this.__selection.length;e++)this.__selection[e]&&this.__prevXfos[e]&&(this.__selection[e].globalXfoParam.value=this.__prevXfos[e])}redo(){for(let e=0;e<this.__selection.length;e++)this.__selection[e]&&this.__newXfos[e]&&(this.__selection[e].globalXfoParam.value=this.__newXfos[e])}update(e){if(e.newItem)this.__selection[e.newItemId]=e.newItem,this.__prevXfos[e.newItemId]=e.newItem.globalXfoParam.value;else if(e.changeXfos)for(let t=0;t<e.changeXfoIds.length;t++){const n=e.changeXfoIds[t];this.__selection[n]&&(this.__selection[n].globalXfoParam.value=e.changeXfos[t],this.__newXfos[n]=e.changeXfos[t])}this.emit("updated",e)}toJSON(e){const t=super.toJSON(e),n=[];for(let e=0;e<this.__selection.length;e++)this.__selection[e]?n[e]=this.__selection[e].getPath():n.push(null);return t.itemPaths=n,t}fromJSON(e,t){super.fromJSON(e,t);const n=t.appData.scene.getRoot();this.__selection=[];for(let t=0;t<e.itemPaths.length;t++){const i=e.itemPaths[t];if(i&&""!=i){const e=n.resolvePath(i,1);e!=n&&(this.__selection[t]=e,this.__prevXfos[t]=e.globalXfoParam.value)}}}updateFromJSON(e){this.update(e)}}a.registerChange("HoldObjectsChange",J);class K extends t.BaseTool{constructor(e){super(),this.__pressedButtonCount=0,this.__freeIndices=[],this.__vrControllers=[],this.__heldObjectCount=0,this.__heldGeomItems=[],this.__highlightedGeomItemIds=[],this.__heldGeomItemIds=[],this.__heldGeomItemRefs=[],this.__heldGeomItemOffsets=[],this.appData=e}activateTool(){super.activateTool(),this.appData.renderer.getGLCanvas().style.cursor="crosshair";const e=e=>{this.__activated};this.appData.renderer.getXRViewport().then((t=>{for(const n of t.getControllers())e();this.addIconToControllerId=t.on("controllerAdded",(t=>e(t.controller)))}))}deactivateTool(){super.deactivateTool(),this.appData.renderer.getXRViewport().then((e=>{e.removeListenerById("controllerAdded",this.addIconToControllerId)}))}computeGrabXfo(e){let n;if(1==e.length)n=this.__vrControllers[e[0]].getTipXfo();else if(2==e.length){const i=this.__vrControllers[e[0]].getTipXfo(),s=this.__vrControllers[e[1]].getTipXfo();i.ori.alignWith(s.ori),n=new t.Xfo,n.tr=i.tr.lerp(s.tr,.5),n.ori=i.ori.lerp(s.ori,.5);let r=s.tr.subtract(i.tr);r.normalizeInPlace();const a=n.ori.getXaxis();r.dot(a)<0&&(r=r.negate());const o=r.angleTo(a);if(o>0){const e=a.cross(r);e.normalizeInPlace();const i=new t.Quat;i.setFromAxisAndAngle(e,o),n.ori=i.multiply(n.ori)}}return n}initAction(){for(let e=0;e<this.__heldGeomItems.length;e++){const t=this.__heldGeomItems[e];if(!t)continue;const n=this.computeGrabXfo(this.__heldGeomItemRefs[e]);this.__heldGeomItemOffsets[e]=n.inverse().multiply(t.globalXfoParam.value)}}onPointerDown(e){if(e.pointerType===t.POINTER_TYPES.xr){const t=e.controller.getId();this.__vrControllers[t]=e.controller;const n=this.__highlightedGeomItemIds[t];if(n){let i=this.__heldGeomItems.indexOf(n);if(-1==i){i=this.__heldGeomItems.length,this.__heldObjectCount++,this.__heldGeomItems.push(n),this.__heldGeomItemRefs[i]=[t],this.__heldGeomItemIds[t]=i;const e={newItem:n,newItemId:i};this.change?this.change.update(e):(this.change=new J(e),a.getInstance().addChange(this.change))}else this.__heldGeomItemIds[t]=i,this.__heldGeomItemRefs[i].push(t);this.initAction(),e.stopPropagation()}}}onPointerUp(e){if(e.pointerType===t.POINTER_TYPES.xr){const t=e.controller.getId();if(this.__pressedButtonCount--,void 0!==this.__heldGeomItemIds[t]){const n=this.__heldGeomItemIds[t],i=this.__heldGeomItemRefs[n];i.splice(i.indexOf(t),1),0==i.length&&(this.__heldObjectCount--,this.__heldGeomItems[n]=void 0,this.change=void 0),this.__heldGeomItemIds[t]=void 0,this.initAction(),e.stopPropagation()}}}onPointerMove(e){if(e.pointerType===t.POINTER_TYPES.xr){if(!this.change)return void e.controllers.forEach((e=>{const n=e.getId(),i=e.getGeomItemAtTip();if(i){const e=i.geomItem;this.__highlightedGeomItemIds[n]!=e&&(this.__highlightedGeomItemIds[n]&&this.__highlightedGeomItemIds[n].removeHighlight("vrHoldObject"),e.addHighlight("vrHoldObject",new t.Color(1,0,0,.2)),this.__highlightedGeomItemIds[n]=e)}else this.__highlightedGeomItemIds[n]&&(this.__highlightedGeomItemIds[n].removeHighlight("vrHoldObject"),this.__highlightedGeomItemIds[n]=null)}));const n=[],i=[];for(let e=0;e<this.__heldGeomItems.length;e++){if(!this.__heldGeomItems[e])continue;const t=this.computeGrabXfo(this.__heldGeomItemRefs[e]);n.push(t.multiply(this.__heldGeomItemOffsets[e])),i.push(e)}this.change.update({changeXfos:n,changeXfoIds:i}),e.stopPropagation()}}onPointerDoublePress(e){e.pointerType,t.POINTER_TYPES.xr}}class W extends t.BaseTool{constructor(e){super(),this.appData=e}}class Y extends W{constructor(e){super(e),this.colorParam=new t.ColorParameter("Color",new t.Color(.7,.2,.2)),e||console.error("App data not provided to tool"),this.appData=e,this.stage=0,this.removeToolOnRightClick=!0,this.parentItem="parentItem"in e?e.parentItem:e.scene.getRoot(),this.addParameter(this.colorParam),this.controllerAddedHandler=this.controllerAddedHandler.bind(this)}addIconToVRController(e){this.vrControllerToolTip||(this.vrControllerToolTip=new t.Cross(.05),this.vrControllerToolTipMat=new t.Material("VRController Cross","LinesShader"),this.vrControllerToolTipMat.getParameter("BaseColor").value=this.colorParam.getValue(),this.vrControllerToolTipMat.setSelectable(!1));const n=new t.GeomItem("CreateGeomToolTip",this.vrControllerToolTip,this.vrControllerToolTipMat);n.setSelectable(!1),e.getTipItem().addChild(n,!1)}controllerAddedHandler(e){this.addIconToVRController(e.controller)}activateTool(){super.activateTool(),this.prevCursor=this.appData.renderer.getGLCanvas().style.cursor,this.appData.renderer.getGLCanvas().style.cursor="crosshair",this.appData.renderer.getXRViewport().then((e=>{for(const t of e.getControllers())this.addIconToVRController(t);e.on("controllerAdded",this.controllerAddedHandler)}))}deactivateTool(){super.deactivateTool(),this.appData.renderer.getGLCanvas().style.cursor=this.prevCursor,this.appData.renderer.getXRViewport().then((e=>{e.off("controllerAdded",this.controllerAddedHandler)}))}screenPosToXfo(e){if(!(e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent))return void console.warn("not handling VR");if(e.intersectionData){const t=i(e),n=this.constructionPlane.clone();return n.tr=t.pointAtDist(e.intersectionData.dist),n}const n=i(e),s=new t.Ray(this.constructionPlane.tr,this.constructionPlane.ori.getZaxis()),r=n.intersectRayPlane(s);if(r>0){const e=this.constructionPlane.clone();return e.tr=n.pointAtDist(r),e}const a=e.viewport.getCamera(),o=a.globalXfoParam.value.clone();return o.tr=n.pointAtDist(a.getFocalDistance()),o}createStart(e,t){this.stage=1}createPoint(e){}createMove(e){}createRelease(e){}onPointerDown(e){if(e instanceof t.XRControllerEvent)this.onVRControllerButtonDown(e);else if(e instanceof t.ZeaMouseEvent){if(e.altKey)return;if(0==this.stage)if(0==e.button||"mouse"!==e.pointerType){this.constructionPlane=new t.Xfo;const n=this.screenPosToXfo(e);this.createStart(n),e.stopPropagation()}else e.button;else 2==e.button&&(a.getInstance().cancel(),this.stage=0);e.stopPropagation(),e.preventDefault()}else console.warn("Touch event not handled")}onPointerMove(e){if("xr"===e.pointerType)this.onVRPoseChanged(e);else if(this.stage>0){const t=this.screenPosToXfo(e);this.createMove(t.tr),e.stopPropagation(),e.preventDefault()}}onPointerUp(e){if(e instanceof t.XRControllerEvent)this.onVRControllerButtonUp(e);else if(this.stage>0){const t=this.screenPosToXfo(e);this.createRelease(t.tr),e.stopPropagation()}}onWheel(e){}onKeyPressed(e){}onKeyDown(e){}onKeyUp(e){}onTouchCancel(e){}onVRControllerButtonDown(e){if(!this.__activeController){this.__activeController=e.controller,this.constructionPlane=new t.Xfo;const n=this.constructionPlane.clone();n.tr=this.__activeController.getTipXfo().tr,this.createStart(n,this.appData.scene.getRoot())}e.stopPropagation()}onVRPoseChanged(e){if(this.__activeController&&this.stage>0){const t=this.__activeController.getTipXfo();this.createMove(t.tr),e.stopPropagation()}}onVRControllerButtonUp(e){if(this.stage>0&&this.__activeController==e.controller){const t=this.__activeController.getTipXfo();this.createRelease(t.tr),0==this.stage&&(this.__activeController=void 0),e.stopPropagation()}}}class q extends l{constructor(e,t){super(e),this.parentItem=t||null}setParentAndXfo(e,t){this.parentItem=e;const n=this.parentItem.generateUniqueName(this.geomItem.getName());this.geomItem.setName(n),this.geomItem.globalXfoParam.value=t,this.parentItem.addChild(this.geomItem)}undo(){this.parentItem.removeChild(this.parentItem.getChildIndex(this.geomItem))}redo(){this.parentItem.addChild(this.geomItem,!1,!1)}toJSON(e){const t=super.toJSON(e);t.parentItemPath=this.parentItem.getPath(),t.geomItemName=this.geomItem.getName(),t.geomItemXfo=this.geomItem.localXfoParam.getValue();const n=this.geomItem.getParameter("Material").getValue();return t.color=n.getParameter("BaseColor").getValue(),t}fromJSON(e,n){const i=n.appData.scene.getRoot();this.parentItem=i.resolvePath(e.parentItemPath,1),this.geomItem.setName(this.parentItem.generateUniqueName(e.geomItemName));const s=new t.Xfo;if(s.fromJSON(e.geomItemXfo),this.geomItem.localXfoParam.value=s,this.childIndex=this.parentItem.getChildIndex(this.parentItem.addChild(this.geomItem,!1)),e.color){const n=new t.Color(.7,.2,.2);n.fromJSON(e.color),this.geomItem.getParameter("Material").getValue().getParameter("BaseColor").value=n}}destroy(){}}class Q extends q{constructor(e,n,i,s=.001){super("Create Line"),this.line=new t.Lines,this.line.setNumVertices(2),this.line.setNumSegments(1),this.line.getVertexAttribute("positions").setValue(0,new t.Vec3),this.line.setSegmentVertexIndices(0,0,1);const r=new t.FatLinesMaterial("Line");i&&(r.baseColorParam.value=i),r.lineThicknessParam&&(r.lineThicknessParam.value=s),this.geomItem=new t.GeomItem("Line",this.line,r),e&&n&&this.setParentAndXfo(e,n)}update(e){e.p1&&(this.line.positions.getValueRef(1).setFromOther(e.p1),this.line.setBoundingBoxDirty(),this.line.emit("geomDataChanged")),this.emit("updated",e)}fromJSON(e,n){if(super.fromJSON(e,n),e.color){const n=new t.Color;n.fromJSON(e.color),this.geomItem.materialParam.value.getParameter("BaseColor").value=n}}}a.registerChange("CreateLineChange",Q);class ee extends Y{constructor(e){super(e),this.lineThickness=new t.NumberParameter("LineThickness",.01,[0,.1]),this.addParameter(this.lineThickness)}createStart(e){const t=this.colorParam.getValue(),n=this.lineThickness.getValue();this.change=new Q(this.parentItem,e,t,n),a.getInstance().addChange(this.change),this.xfo=e.inverse(),this.stage=1,this.length=0}createMove(e){const t=this.xfo.transformVec3(e);this.length=t.length(),this.change.update({p1:t})}createRelease(e){0==this.length&&a.getInstance().cancel(),this.stage=0,this.emit("actionFinished")}onVRControllerButtonDown(e){if(0==this.stage){const t=e.viewport.__stageScale;this.lineThickness.value=.003*t}super.onVRControllerButtonDown(e)}}class te extends q{constructor(e,n,i){super("Create Cone");const s=new t.Cone(0,0);s.heightParam.value=0;const r=new t.Material("Cone","SimpleSurfaceShader");this.geomItem=new t.GeomItem("Cone",s,r),e&&n&&(r.getParameter("BaseColor").value=i,this.setParentAndXfo(e,n))}update(e){e.radius&&(this.geomItem.getParameter("Geometry").getValue().radiusParam.value=e.radius),e.height&&(this.geomItem.getParameter("Geometry").getValue().getParameter("Height").value=e.height),this.emit("updated",e)}}a.registerChange("CreateConeChange",te);class ne extends q{constructor(e,n){super("CreateCircle"),this.circle=new t.Circle(0,64);const i=new t.Material("circle","FatLinesShader");i.getParameter("BaseColor").value=new t.Color(.7,.2,.2),this.geomItem=new t.GeomItem("Circle",this.circle,i),e&&n&&this.setParentAndXfo(e,n)}update(e){this.circle.radiusParam.value=e.radius,this.emit("updated",e)}toJSON(){const e=super.toJSON();return e.radius=this.circle.radiusParam.value,e}updateFromJSON(e){console.log("CreateCircleChange:",e),e.radius&&(this.circle.radiusParam.value=e.radius)}}a.registerChange("CreateCircleChange",ne);class ie extends q{constructor(e,n){super("CreateRect"),this.rect=new t.Rect(0,0);const i=new t.Material("circle","FatLinesShader");i.getParameter("BaseColor").value=new t.Color(.7,.2,.2),this.geomItem=new t.GeomItem("Rect",this.rect,i),e&&n&&this.setParentAndXfo(e,n)}update(e){if(e.baseSize&&(this.rect.sizeXParam.value=e.baseSize[0],this.rect.sizeYParam.value=e.baseSize[1]),e.tr){const t=this.geomItem.localXfoParam.getValue();t.tr.fromJSON(e.tr),this.geomItem.localXfoParam.value=t}this.emit("updated",e)}}a.registerChange("CreateRectChange",ie);class se extends q{constructor(e,n,i,s=.001){super("CreateFreehandLine"),this.vertexCount=100,this.used=0,this.line=new t.Lines,this.line.setNumVertices(this.vertexCount),this.line.setNumSegments(this.vertexCount-1),this.line.getVertexAttribute("positions").setValue(0,new t.Vec3);const r=new t.FatLinesMaterial("freeHandLine");i&&(r.baseColorParam.value=i),r.lineThicknessParam&&(r.lineThicknessParam.value=s),this.geomItem=new t.GeomItem("freeHandLine",this.line,r),e&&n&&this.setParentAndXfo(e,n)}update(e){this.used++;let t=!1;this.used>=this.line.getNumSegments()&&(this.vertexCount=this.vertexCount+100,this.line.setNumVertices(this.vertexCount),this.line.setNumSegments(this.vertexCount-1),t=!0),this.line.getVertexAttribute("positions").setValue(this.used,e.point),this.line.setSegmentVertexIndices(this.used-1,this.used-1,this.used),this.line.setBoundingBoxDirty(),t?this.line.emit("geomDataTopologyChanged",{topologyChanged:!0}):this.line.emit("geomDataChanged",{topologyChanged:!0}),this.emit("updated",e)}toJSON(e){const t=super.toJSON(e),n=this.geomItem.materialParam.value;return t.lineThickness=n.lineThicknessParam.value,t.color=n.baseColorParam.value,t}fromJSON(e,n){if(e.lineThickness&&(this.geomItem.materialParam.value.lineThicknessParam.value=e.lineThickness),e.color){const n=new t.Color(.7,.2,.2);n.fromJSON(e.color),this.geomItem.materialParam.value.baseColorParam.value=n}super.fromJSON(e,n)}}a.registerChange("CreateFreehandLineChange",se);class re extends q{constructor(e,n,i){super("CreateSphere",e),this.sphere=new t.Sphere(0,24,12);const s=new t.Material("Sphere","SimpleSurfaceShader");this.geomItem=new t.GeomItem("Sphere",this.sphere,s),this.geomItem.setSelectable(!1),e&&n&&i&&(s.getParameter("BaseColor").value=i,this.setParentAndXfo(e,n))}update(e){this.sphere.radiusParam.value=e.radius,this.emit("updated",e)}toJSON(){const e=super.toJSON();return e.radius=this.sphere.radiusParam.getValue(),e}updateFromJSON(e){e.radius&&(this.sphere.radiusParam.value=e.radius)}}a.registerChange("CreateSphereChange",re);class ae extends q{constructor(e,n,i){super("CreateCuboid"),this.cuboid=new t.Cuboid(0,0,0,!0);const s=new t.Material("Cuboid","SimpleSurfaceShader");this.geomItem=new t.GeomItem("Cuboid",this.cuboid,s),e&&n&&(s.getParameter("BaseColor").value=i,this.setParentAndXfo(e,n))}update(e){if(e.baseSize&&(this.cuboid.sizeXParam.value=e.baseSize[0],this.cuboid.sizeYParam.value=e.baseSize[1]),e.tr){const t=this.geomItem.localXfoParam.getValue();t.tr.fromJSON(e.tr),this.geomItem.localXfoParam.value=t}e.height&&(this.cuboid.sizeZParam.value=e.height),this.emit("updated",e)}}a.registerChange("CreateCuboidChange",ae);class oe extends t.BaseTool{constructor(){super(),this.tools={},this.toolStack=[]}registerTool(e,t){this.tools[e]=t}pushTool(e){const t=this.tools[e];if(!t)throw Error("Tool not found"+e);t.activateTool&&t.activateTool(),this.toolStack.push(this.tools[e])}popTool(){if(0==this.toolStack.length)throw Error("Tool stack is empty");const e=this.toolStack[this.toolStack.length-1];e.deactivateTool&&e.deactivateTool(),this.toolStack.pop()}activeTool(){if(this.toolStack.length>0)return this.toolStack[this.toolStack.length-1]}activeToolName(){if(this.toolStack.length>0){const e=this.toolStack[this.toolStack.length-1];for(const t in this.tools)if(this.tools[t]==e)return t}return""}onPointerDown(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onPointerDown&&(n.onPointerDown(e),!e.propagating))break}}onPointerMove(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onPointerMove&&(n.onPointerMove(e),!e.propagating))break}}onPointerUp(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onPointerUp&&(n.onPointerUp(e),!e.propagating))break}}onPointerDoublePress(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onPointerDoublePress&&(n.onPointerDoublePress(e),!e.propagating))break}}onWheel(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onWheel&&(n.onWheel(e),!e.propagating))break}}onKeyPressed(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onKeyPressed&&(n.onKeyPressed(e),!e.propagating))break}}onKeyDown(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onKeyDown&&(n.onKeyDown(e),!e.propagating))break}}onKeyUp(e){for(let t=this.toolStack.length-1;t>=0;t--){const n=this.toolStack[t];if(n.onKeyUp&&(n.onKeyUp(e),!e.propagating))break}}}class le extends r{constructor(e,n=.5,i=.02,s=new t.Color("#F9CE03")){super(e),this.handleXfo=new t.Xfo,this.baseBarXfo=new t.Xfo,this.topBarXfo=new t.Xfo,this.lengthParam=new t.NumberParameter("Length",n),this.handleRadiusParam=new t.NumberParameter("HandleRadius",i),this.barRadiusParam=new t.NumberParameter("BarRadius",.25*i),this.addParameter(this.lengthParam),this.addParameter(this.handleRadiusParam),this.addParameter(this.barRadiusParam),this.colorParam.value=s,this.handleMat=new t.Material("handle","FlatSurfaceShader"),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue();const r=new t.Material("topBar","FlatSurfaceShader");r.getParameter("BaseColor").value=new t.Color(.5,.5,.5);const a=new t.Cylinder(.25*i,1,64,2,!0,!0),o=new t.Sphere(i,64);this.handle=new t.GeomItem("handle",o,this.handleMat),this.baseBar=new t.GeomItem("baseBar",a,this.handleMat),this.topBar=new t.GeomItem("topBar",a,r),this.barRadiusParam.on("valueChanged",(()=>{a.radiusParam.value=this.barRadiusParam.getValue()})),this.handleRadiusParam.on("valueChanged",(()=>{o.radiusParam.value=this.handleRadiusParam.getValue()})),this.lengthParam.on("valueChanged",(()=>{this.__updateSlider(this.value)})),this.colorParam.on("valueChanged",(()=>{this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()})),this.addChild(this.handle),this.addChild(this.baseBar),this.addChild(this.topBar),this.__updateSlider(0)}highlight(){super.highlight(),this.handleMat.getParameter("BaseColor").value=this.highlightColorParam.getValue()}unhighlight(){super.unhighlight(),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()}setTargetParam(e){this.param=e;const t=()=>{this.__updateSlider(e.getValue())};t(),e.on("valueChanged",t)}__updateSlider(e){this.value=e;const n=this.param,i=n&&n.getRange()?n.getRange():[0,1],s=t.MathFunctions.remap(e,i[0],i[1],0,1),r=this.lengthParam.getValue();this.baseBarXfo.sc.z=s*r,this.handleXfo.tr.z=s*r,this.topBarXfo.tr.z=s*r,this.topBarXfo.sc.z=(1-s)*r,this.handle.localXfoParam.value=this.handleXfo,this.baseBar.localXfoParam.value=this.baseBarXfo,this.topBar.localXfoParam.value=this.topBarXfo}onDragStart(e){this.handleXfo.sc.x=this.handleXfo.sc.y=this.handleXfo.sc.z=1.2,this.handle.localXfoParam.value=this.handleXfo,this.param&&(this.change=new h(this.param),a.getInstance().addChange(this.change))}onDrag(e){const n=this.lengthParam.getValue(),i=this.param,s=i&&i.getRange()?i.getRange():[0,1],r=t.MathFunctions.clamp(t.MathFunctions.remap(this.value,0,n,s[0],s[1]),s[0],s[1]);if(!this.param)return this.__updateSlider(r),void(this.value=r);this.change.update({value:r})}onDragEnd(e){this.change=null,this.handleXfo.sc.x=this.handleXfo.sc.y=this.handleXfo.sc.z=1,this.handle.localXfoParam.value=this.handleXfo}toJSON(e){const t=super.toJSON(e);return this.param&&(t.targetParam=this.param.getPath()),t}fromJSON(e,t){super.fromJSON(e,t),e.targetParam&&t.resolvePath(e.targetParam).then((e=>{this.setTargetParam(e)}))}}t.Registry.register("SliderHandle",le);class he extends p{constructor(e,n=1,i=1,s=.02,r=new t.Color(1,1,0)){super(e),this.handleXfo=new t.Xfo,this.handleGeomOffsetXfo=new t.Xfo,this.arcRadiusParam=new t.NumberParameter("ArcRadius",n),this.arcAngleParam=new t.NumberParameter("ArcAngle",i),this.handleRadiusParam=new t.NumberParameter("HandleRadius",s),this.addParameter(this.arcRadiusParam),this.addParameter(this.arcAngleParam),this.addParameter(this.handleRadiusParam),this.colorParam.value=r,this.handleMat=new t.Material("handleMat","HandleShader"),this.handleMat.getParameter("BaseColor").value=r;const a=new t.Circle(n,64,i),o=new t.Sphere(s,64);this.handle=new t.GeomItem("handle",o,this.handleMat),this.arc=new t.GeomItem("arc",a,this.handleMat),this.handleGeomOffsetXfo.tr.x=n,this.handle.geomOffsetXfoParam.value=this.handleGeomOffsetXfo,this.range=[0,i],this.arcAngleParam.on("valueChanged",(()=>{const e=this.arcAngleParam.getValue();a.angleParam.value=e,this.range=[0,e]})),this.arcRadiusParam.on("valueChanged",(()=>{const e=this.arcRadiusParam.getValue();a.radiusParam.value=e,this.handleGeomOffsetXfo.tr.x=e,this.handle.geomOffsetXfoParam.value=this.handleGeomOffsetXfo})),this.handleRadiusParam.on("valueChanged",(()=>{o.radiusParam.value=this.handleRadiusParam.getValue()})),this.colorParam.on("valueChanged",(()=>{this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()})),this.addChild(this.handle),this.addChild(this.arc),this.setTargetParam(this.handle.globalXfoParam,!1)}onPointerEnter(e){e.intersectionData&&e.intersectionData.geomItem==this.handle&&this.highlight()}onPointerLeave(e){this.unhighlight()}onPointerDown(e){e.intersectionData&&e.intersectionData.geomItem==this.handle&&super.onPointerDown(e)}highlight(){super.highlight(),this.handleMat.getParameter("BaseColor").value=this.highlightColorParam.getValue()}unhighlight(){super.unhighlight(),this.handleMat.getParameter("BaseColor").value=this.colorParam.getValue()}setTargetParam(e,n=!0){if(this.param=e,n)if(this.param instanceof t.XfoParameter){const t=()=>{this.globalXfoParam.value=e.value};t(),e.on("valueChanged",t)}else if(this.param instanceof t.NumberParameter){const n=()=>{this.handleXfo.ori.setFromAxisAndAngle(new t.Vec3(0,0,1),e.getValue()),this.handle.globalXfoParam.value=this.handleXfo};n(),e.on("valueChanged",n)}}getBaseXfo(){return this.handle.globalXfoParam.value}onDragStart(e){this.baseXfo=this.globalXfoParam.value.clone(),this.baseXfo.sc.set(1,1,1),this.vec0=this.globalXfoParam.value.ori.getXaxis(),this.vec0.normalizeInPlace(),this.change=new h(this.param),a.getInstance().addChange(this.change),this.handleGeomOffsetXfo.sc.x=this.handleGeomOffsetXfo.sc.y=this.handleGeomOffsetXfo.sc.z=1.2,this.handle.geomOffsetXfoParam.value=this.handleGeomOffsetXfo,this.emit("dragStart")}onDrag(e){const n=this.holdPos.subtract(this.baseXfo.tr);n.normalizeInPlace();let i=this.vec0.angleTo(n);if(this.vec0.cross(n).dot(this.baseXfo.ori.getZaxis())<0&&(i=-i),this.range&&(i=t.MathFunctions.clamp(i,this.range[0],this.range[1])),(e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.shiftKey){const e=Math.PI/180*22.5;i=Math.floor(i/e)*e}const s=new t.Xfo;s.ori.setFromAxisAndAngle(new t.Vec3(0,0,1),i);const r=this.baseXfo.multiply(s);this.change?this.param instanceof t.XfoParameter?this.change.update({value:r}):this.param instanceof t.NumberParameter&&this.change.update({value:i}):this.param instanceof t.XfoParameter?this.param.value=r:this.param instanceof t.NumberParameter&&(this.param.value=i)}onDragEnd(e){this.change=null,this.handleGeomOffsetXfo.sc.x=this.handleGeomOffsetXfo.sc.y=this.handleGeomOffsetXfo.sc.z=1,this.handle.geomOffsetXfoParam.value=this.handleGeomOffsetXfo,this.emit("dragEnd")}toJSON(e){const t=super.toJSON(e);return this.param&&(t.targetParam=this.param.getPath()),t}fromJSON(e,t){super.fromJSON(e,t),e.targetParam&&t.resolvePath(e.targetParam).then((e=>{this.setTargetParam(e)}))}}t.Registry.register("ArcSlider",he);const ce=new t.Sphere(.003,24,12,!1);class de extends t.TreeItem{constructor(e="Measure",n=new t.Color("#F9CE03")){super(e),this.colorParam=this.addParameter(new t.ColorParameter("Color",n)),this.markerMaterial=new c("Marker"),this.markerMaterial.getParameter("BaseColor").value=new t.Color(0,0,0),this.markerMaterial.getParameter("MaintainScreenSize").value=1,this.markerMaterial.getParameter("Overlay").value=.5,this.lineMaterial=new t.LinesMaterial("Line"),this.lineMaterial.baseColorParam.value=new t.Color(0,0,0),this.lineMaterial.overlayParam.value=.5,this.markerA=new t.GeomItem("markerA",ce,this.markerMaterial),this.markerB=new t.GeomItem("markerB",ce,this.markerMaterial),this.addChild(this.markerA),this.addChild(this.markerB),this.colorParam.on("valueChanged",(()=>{const e=this.colorParam.getValue();this.label.getParameter("BackgroundColor").value=e}))}}const ue=new t.Lines;ue.setNumVertices(2),ue.setNumSegments(1),ue.setSegmentVertexIndices(0,0,1),ue.getVertexAttribute("positions").setValue(0,new t.Vec3),ue.getVertexAttribute("positions").setValue(1,new t.Vec3(0,0,1)),ue.setBoundingBoxDirty();class fe extends de{constructor(e="MeasureDistance",n=new t.Color("#F9CE03"),i="Meters"){super(e,n),this.lineGeomItem=null,this.sceneUnits=null,this.sceneUnits=i}updateMeasurement(){const e=this.markerA.globalXfoParam.value,n=this.markerB.globalXfoParam.value.tr.subtract(e.tr),i=n.length();if(0==i)return;const s=this.colorParam.getValue();let r=1;switch(this.sceneUnits){case"Millimeters":break;case"Meters":r=1e3}const a=`${parseFloat((i*r).toFixed(3))}mm`;this.label?this.label.getParameter("Text").value=a:(this.label=new t.Label("Distance"),this.label.getParameter("FontSize").value=20,this.label.getParameter("BackgroundColor").value=s,this.label.getParameter("Text").value=a,this.billboard=new t.BillboardItem("DistanceBillboard",this.label),this.billboard.localXfoParam.value=new t.Xfo,this.billboard.getParameter("PixelsPerMeter").value=1500,this.billboard.getParameter("AlignedToCamera").value=!0,this.billboard.getParameter("DrawOnTop").value=!0,this.billboard.getParameter("FixedSizeOnscreen").value=!0,this.billboard.getParameter("Alpha").value=1,this.addChild(this.billboard),this.lineMaterial=new t.LinesMaterial("Line"),this.lineMaterial.getParameter("BaseColor").value=new t.Color(0,0,0),this.lineMaterial.getParameter("Overlay").value=.5,this.lineGeomItem=new t.GeomItem("Line",ue,this.lineMaterial),this.lineGeomItem.setSelectable(!1),this.addChild(this.lineGeomItem));const o=e.clone();o.ori.setFromDirectionAndUpvector(n,new t.Vec3(n.z,n.x,n.y)),o.sc.z=i,this.lineGeomItem.globalXfoParam.value=o,n.normalizeInPlace();const l=e.tr.add(n.scale(.5*i)),h=new t.Xfo(l);h.ori.setFromDirectionAndUpvector(n,new t.Vec3(n.z,n.x,n.y)),this.billboard.globalXfoParam.value=h}setStartMarkerPos(e){const t=this.markerA.globalXfoParam.value;t.tr=e,this.markerA.globalXfoParam.value=t,this.label&&this.updateMeasurement()}setEndMarkerPos(e){const t=this.markerB.globalXfoParam.value;t.tr=e,this.markerB.globalXfoParam.value=t,this.updateMeasurement()}setGeomBuffersVisibility(e){this.markerA.setSelectable(!e),this.markerB.setSelectable(!e)}getMeasurementText(){return this.label.getParameter("Text").getValue()}}t.Registry.register("MeasureDistance",fe);const me=new t.Lines;me.setNumVertices(2),me.setNumSegments(1),me.setSegmentVertexIndices(0,0,1);const ge=me.getVertexAttribute("positions");ge.setValue(0,new t.Vec3),ge.setValue(1,new t.Vec3(0,0,1)),me.setBoundingBoxDirty();class pe extends de{constructor(e="MeasureAngle",n=new t.Color("#F9CE03")){super(e,n)}createLinesAndLabel(){const e=this.markerA.globalXfoParam.value,n=this.markerB.globalXfoParam.value,i=e.ori.getZaxis(),s=n.ori.getZaxis(),r=i.cross(s).normalize(),a=r.cross(i).normalize(),o=r.cross(s).normalize(),l=new t.Ray(e.tr,a),h=new t.Ray(n.tr,o),c=l.intersectRayVector(h),d=i.angleTo(s),u=new t.GeomItem("Line",me,this.lineMaterial),f=new t.GeomItem("Line",me,this.lineMaterial);this.markerA.addChild(u,!1),this.markerB.addChild(f,!1),this.label=new t.Label("Distance"),this.label.fontSizeParam.value=20,this.label.backgroundColorParam.value=this.colorParam.getValue(),this.label.textParam.value=`${(d/(Math.PI/180)).toFixed(3)} `,this.billboard=new t.BillboardItem("DistanceBillboard",this.label),this.billboard.localXfoParam.value=new t.Xfo,this.billboard.pixelsPerMeterParam.value=1500,this.billboard.alignedToCameraParam.value=!0,this.billboard.drawOnTopParam.value=!0,this.billboard.fixedSizeOnscreenParam.value=!0,this.billboard.alphaParam.value=1,this.addChild(this.billboard),this.colorParam.on("valueChanged",(()=>{const e=this.colorParam.getValue();this.markerMaterial.getParameter("BaseColor").value=e,this.lineMaterial.baseColorParam.value=e,this.label.backgroundColorParam.value=e}));const m=new t.Xfo;m.tr.addInPlace(l.pointAtDist(c[0])),m.tr.addInPlace(h.pointAtDist(c[1])),m.tr.scaleInPlace(.5),e.ori.setFromDirectionAndUpvector(a,i),this.markerA.globalXfoParam.value=e,n.ori.setFromDirectionAndUpvector(o,i),this.markerB.globalXfoParam.value=n;const g=new t.Xfo;g.sc.z=c[0],u.localXfoParam.value=g;const p=new t.Xfo;p.sc.z=c[1],f.localXfoParam.value=p,this.billboard.globalXfoParam.value=m}setXfoA(e){this.markerA.globalXfoParam.value=e,this.markerB.globalXfoParam.value=e}getXfoA(){return this.markerA.globalXfoParam.value}setXfoB(e){this.markerB.globalXfoParam.value=e,this.createLinesAndLabel()}}t.Registry.register("MeasureAngle",pe);class ve extends l{constructor(e){super("MeasurementChange"),e&&(this.measurement=e)}update(e){this.measurement.fromJSON(e.measurementData),this.emit("updated",e)}end(){this.measurement.setGeomBuffersVisibility(!0)}undo(){console.log("undo MeasurementChange"),this.parentItem=this.measurement.getOwner(),this.childIndex=this.parentItem.getChildIndex(this.measurement),this.parentItem.removeChild(this.childIndex)}redo(){console.log("redo MeasurementChange"),this.parentItem.insertChild(this.measurement,this.childIndex)}toJSON(e){const n=super.toJSON(e);return n.parentItemPath=this.measurement.getOwner().getPath(),n.measurementType=t.Registry.getClassName(Object.getPrototypeOf(this.measurement).constructor),n.measurementData=this.measurement.toJSON(e),n}fromJSON(e,n){const i=n.appData.scene.getRoot().resolvePath(e.parentItemPath,1);i&&(this.measurement=t.Registry.constructClass(e.measurementType),this.measurement.fromJSON(e.measurementData),i.addChild(this.measurement))}destroy(){}}a.registerChange("MeasurementChange",ve);class we extends t.BaseTool{constructor(e){super(),this.stage=0,this.numStages=1,this.geomConstraints={},this.colorParam=new t.ColorParameter("Color",new t.Color("#F9CE03")),this.addParameter(this.colorParam),e||console.error("App data not provided to tool"),this.appData=e,this.measurementChange=null,this.highlightedItemA=null,this.highlightedItemB=null,this.stage=0}activateTool(){super.activateTool(),this.appData&&this.appData.renderer&&(this.prevCursor=this.appData.renderer.getGLCanvas().style.cursor,this.appData.renderer.getGLCanvas().style.cursor="crosshair")}deactivateTool(){if(super.deactivateTool(),this.appData&&this.appData.renderer&&(this.appData.renderer.getGLCanvas().style.cursor=this.prevCursor),0!=this.stage){const e=this.measurement.getOwner();e.removeChild(e.getChildIndex(this.measurement)),this.measurement=null,this.highlightedItemB&&(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB=null),this.highlightedItemA&&(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA=null),this.stage=0}}getGeomParams(e,n=-1){return new Promise((i=>{const s=e.geomParam.value;e instanceof t.CADBody&&s instanceof t.CompoundGeom?e.assetItem.loadMetadata().then((()=>{i(s.subGeoms[n])})):i(e)}))}getGeomParamsSync(e,n=-1){const i=e.geomParam.value;return e instanceof t.CADBody&&i instanceof t.CompoundGeom?i.subGeoms[n]:e}getGeomXfo(e,n=-1){const i=e.geomParam.value;if(i instanceof t.CompoundGeom){const t=i.subGeoms[n].getParameter("Xfo").value,s=e.globalXfoParam.value,r=e.geomOffsetXfoParam.value;return s.multiply(r).multiply(t)}return e.globalXfoParam.value}checkGeom(e,t=-1){return new Promise((n=>{this.getGeomParams(e,t).then((e=>{if(e){for(let t in this.geomConstraints){const i=e.getParameter(t);i&&this.geomConstraints[t].includes(i.value)&&n(e)}n(null)}else n(null)}))}))}onPointerMove(e){if(!((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.altKey||e instanceof t.ZeaMouseEvent&&0!==e.button))if(0==this.stage){if(e.intersectionData&&e.intersectionData.geomItem instanceof t.GeomItem){const n=e.intersectionData.geomItem,i=e.intersectionData.componentId;if(n instanceof t.CADBody&&n.geomParam.value instanceof t.CompoundGeom){const e=n;if(!e.shattered)return void e.setShatterState(!0)}this.checkGeom(n,i).then((e=>{if(e&&(n!=this.highlightedItemA||i!=this.highlightedItemA_componentId)){this.highlightedItemA&&this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA=n,this.highlightedItemA_params=e,this.highlightedItemA_componentId=i,this.highlightedItemA_highlightKey="measure:"+i;const t=this.colorParam.getValue();t.a=.2,this.highlightedItemA.addHighlight(this.highlightedItemA_highlightKey,t,!0)}}))}else if(this.highlightedItemA){if(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA_componentId>=0){const e=this.highlightedItemA;e.shattered&&e.setShatterState(!1)}this.highlightedItemA=null}e.stopPropagation()}else{if(e.intersectionData&&e.intersectionData.geomItem instanceof t.GeomItem){const n=e.intersectionData.geomItem,i=e.intersectionData.componentId;if(n instanceof t.CADBody&&n.geomParam.value instanceof t.CompoundGeom){const e=n;if(!e.shattered)return void e.setShatterState(!0)}n==this.highlightedItemA&&i==this.highlightedItemA_componentId||n==this.highlightedItemB&&i==this.highlightedItemB_componentId||this.checkGeom(n,i).then((e=>{if(e){this.highlightedItemB&&(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB=null),this.highlightedItemB=n,this.highlightedItemB_params=e,this.highlightedItemB_componentId=i,this.highlightedItemB_highlightKey="measure:"+i;const t=this.colorParam.value.clone();t.a=.2,this.highlightedItemB.addHighlight(this.highlightedItemB_highlightKey,t,!0)}}))}else if(this.highlightedItemB){if(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemA_componentId>=0){const e=this.highlightedItemA;e.shattered&&e.setShatterState(!1)}this.highlightedItemB=null}e.stopPropagation()}}onPointerUp(e){if(this.stage==this.numStages){if(this.measurementChange=null,this.highlightedItemA){if(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA_componentId>=0){const e=this.highlightedItemA;e.shattered&&e.setShatterState(!1)}this.highlightedItemA=null}if(this.highlightedItemB){if(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB_componentId>=0){const e=this.highlightedItemB;e.shattered&&e.setShatterState(!1)}this.highlightedItemB=null}e.stopPropagation()}}}class be extends HTMLElement{constructor(){var e,n,i;super(),this.perspective=!0,this.attachShadow({mode:"open"}),this.scene=document.createElement("div"),this.scene.classList.add("scene"),null===(e=this.shadowRoot)||void 0===e||e.appendChild(this.scene),this.cube=document.createElement("div"),this.cube.classList.add("cube"),this.scene.appendChild(this.cube);const s=(e,t)=>{const n=document.createElement("div");n.classList.add("cube__face"),n.classList.add("cube__face_"+e),n.textContent=e,n.addEventListener("click",(()=>{this.alignFace(t)})),this.cube.appendChild(n)};s("X",new t.Vec3(1,0,0)),s("-X",new t.Vec3(-1,0,0)),s("Y",new t.Vec3(0,1,0)),s("-Y",new t.Vec3(0,-1,0)),s("Z",new t.Vec3(0,0,1)),s("-Z",new t.Vec3(0,0,-1));const r=document.createElement("div");r.classList.add("home"),null===(n=this.shadowRoot)||void 0===n||n.appendChild(r);const a=document.createElement("label"),o=document.createElement("input"),l=document.createElement("span");o.setAttribute("type","checkbox"),a.classList.add("switch"),l.classList.add("slider"),l.classList.add("round"),a.appendChild(o);const h=document.createElement("span");h.classList.add("switch-label"),h.textContent="Persp",r.appendChild(h),a.appendChild(l),r.appendChild(a),o.checked=!0,o.addEventListener("change",(()=>{this.perspective=!this.perspective;const e=this.viewport.getCamera().globalXfoParam.getValue().ori.getZaxis();this.alignFace(e)}));const c=document.createElement("style");c.appendChild(document.createTextNode('\n\n      \n      .home {\n        position: absolute;\n        bottom: 0px;\n        right: 10px;\n        font-family: sans-serif;\n      }\n\n      /* The switch - the box around the slider */\n.switch {\n  position: relative;\n  display: inline-block;\n  width: 40px;\n  height: 20px;\n}\n\n.switch-label {\n  position: absolute;\n  left: -50px;\n}\n\n/* Hide default HTML checkbox */\n.switch input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n/* The slider */\n.slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: #ccc;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\n.slider:before {\n  position: absolute;\n  content: "";\n  height: 16px;\n  width: 16px;\n  left: 2px;\n  bottom: 2px;\n  background-color: white;\n  -webkit-transition: .4s;\n  transition: .4s;\n}\n\ninput:checked + .slider {\n  background-color: #2196F3;\n}\n\ninput:focus + .slider {\n  box-shadow: 0 0 1px #2196F3;\n}\n\ninput:checked + .slider:before {\n  -webkit-transform: translateX(20px);\n  -ms-transform: translateX(20px);\n  transform: translateX(20px);\n}\n\n/* Rounded sliders */\n.slider.round {\n  border-radius: 10px;\n}\n\n.slider.round:before {\n  border-radius: 50%;\n}\n\n      .scene {\n        width: 80px;\n        height: 95px;\n        border: 0px;\n        margin: 20px;\n        perspective: 800px;\n        font-family: sans-serif;\n        -webkit-touch-callout: none; /* iOS Safari */\n        -webkit-user-select: none; /* Safari */\n        user-select: none; /* Non-prefixed version, currently\n                                  supported by Chrome, Edge, Opera and Firefox */\n      }\n      \n      .cube {\n        width: 80px;\n        height: 80px;\n        position: relative;\n        transform-style: preserve-3d;\n        transform: translateZ(-80px);\n      }\n      \n      .cube__face {\n        position: absolute;\n        width: 76px;\n        height: 76px;\n        border: 2px solid black;\n        line-height: 76px;\n        font-size: 20px;\n        font-weight: bold;\n        color: black;\n        text-align: center;\n      }\n      \n      .cube__face:hover {\n        border: 2px solid white;\n        color: white;\n      }\n      \n      .cube__face_X   { background: rgba(255, 0, 0, 0.85); }\n      .cube__face_-X  { background: rgba(255, 0, 0, 0.85); }\n      .cube__face_Y  { background: rgba(  0, 255, 0, 0.85); }\n      .cube__face_-Y   { background: rgba(  0, 255, 0, 0.85); }\n      .cube__face_Z    { background: rgba(0, 0, 255, 0.85); }\n      .cube__face_-Z { background: rgba(0, 0, 255, 0.85); }\n      \n      .cube__face_X   { transform: rotateY(-90deg) translateZ(40px); }\n      .cube__face_-X  { transform: rotateY( 90deg) translateZ(40px); }\n      .cube__face_Y  { transform: rotateY(  0deg) translateZ(40px); }\n      .cube__face_-Y   { transform: rotateY(180deg) translateZ(40px); }\n      .cube__face_Z    { transform: rotateX( 90deg) translateZ(40px); }\n      .cube__face_-Z { transform: rotateX(-90deg) translateZ(40px); }\n      \n')),null===(i=this.shadowRoot)||void 0===i||i.appendChild(c)}alignFace(e,n=400){const i=this.viewport.getCamera(),s=i.getTargetPosition(),r=i.getFocalDistance(),a=i.globalXfoParam.getValue(),o=a.ori.getYaxis(),l=i.isOrthographicParam.value;o.subtractInPlace(e.scale(o.dot(e)));const h=new t.Vec3,c=()=>{Math.abs(o.x)>Math.abs(o.y)&&Math.abs(o.x)>Math.abs(o.z)?o.x>0?h.x=1:h.x=-1:Math.abs(o.y)>Math.abs(o.x)&&Math.abs(o.y)>Math.abs(o.z)?o.y>0?h.y=1:h.y=-1:Math.abs(o.z)>Math.abs(o.x)&&Math.abs(o.z)>Math.abs(o.y)?o.z>0?h.z=1:h.z=-1:(console.warn("Invalid Starting Camera Xfo"),h.z=1)};let d=this.viewport.getManipulator();if(d instanceof oe){const e=d;if("CameraManipulator"in e.tools)d=e.tools.CameraManipulator;else for(let n in e.tools)if(e.tools[n]instanceof t.CameraManipulator){d=e.tools[n];break}}d instanceof t.CameraManipulator&&(d.defaultManipulationState==t.CameraManipulator.MANIPULATION_MODES.turntable?e.approxEqual(new t.Vec3(0,0,1))||e.approxEqual(new t.Vec3(0,0,-1))?c():h.z=1:c());const u=new t.Quat;u.setFromDirectionAndUpvector(e,h),u.alignWith(a.ori);const f=s.clone(),m=r,g=this.perspective?0:1;g>.5&&l<.5&&(i.viewHeight=Math.sin(.5*i.fovParam.value)*r*2);const p=Math.round(n/20);let v=1;const w=()=>{const e=t.MathFunctions.smoothStep(0,1,v/p),n=new t.Xfo;n.ori=a.ori.slerp(u,e).normalize();const o=s.lerp(f,e),h=t.MathFunctions.lerp(r,m,e),c=n.ori.getZaxis().negate();if(n.tr=o.subtract(c.scale(h)),i.globalXfoParam.setValue(n),i.setFocalDistance(h),g>.5&&l<.5||g<.5&&l>.5){const n=t.MathFunctions.lerp(l,g,e);this.scene.style.perspective=g>.5?"none":"800px",i.setIsOrthographic(n,0)}v++,v<=p?setTimeout(w,20):i.emit("movementFinished")};w()}updateViewCubeTransform(e){const t=e.inverse().toMat4(),n=`translateZ(-80px) rotateY(180deg) matrix3d(${t.m00},${t.m01},${t.m02},${t.m03},${t.m10},${t.m11},${t.m12},${t.m13},${t.m20},${t.m21},${t.m22},${t.m23},0,0,0,1) rotateX( 90deg)`;this.cube.style.transform=n}setViewport(e){this.viewport=e;const t=this.viewport.getCamera();this.updateViewCubeTransform(t.globalXfoParam.value),t.globalXfoParam.on("valueChanged",(()=>{this.updateViewCubeTransform(t.globalXfoParam.value)}))}}customElements.define("zea-view-cube",be),t.libsRegistry?t.libsRegistry.registerLib(n):console.warn("The version of the Zea Engine that you're using doesn't support the libraries registry. Please upgrade to the latest Zea Engine version."),e.ArcSlider=he,e.AxialRotationHandle=v,e.Change=l,e.CreateCircleChange=ne,e.CreateCircleTool=class extends Y{constructor(e){super(e)}createStart(e){this.change=new ne(this.parentItem,e),a.getInstance().addChange(this.change),this.xfo=e,this.stage=1,this.radius=0}createMove(e){this.radius=e.distanceTo(this.xfo.tr),this.change.update({radius:this.radius}),this.appData.renderer.forceRender()}createRelease(e){0==this.radius&&a.getInstance().cancel(),this.change=null,this.stage=0,this.emit("actionFinished")}},e.CreateConeChange=te,e.CreateConeTool=class extends Y{constructor(e){super(e)}createStart(e){this.xfo=e,this.invXfo=e.inverse(),this.change=new te(this.parentItem,e,this.colorParam.getValue()),this.change.geomItem.setSelectable(!1),a.getInstance().addChange(this.change),this.stage=1,this._radius=0,this._height=0}createMove(e){if(1==this.stage){const t=e.subtract(this.xfo.tr);this._radius=t.length(),this.change.update({radius:this._radius})}else this._height=this.invXfo.transformVec3(e).y,this.change.update({height:this._height})}createRelease(e){if(0==this._radius&&(a.getInstance().cancel(),this.stage=0,this.emit("actionFinished")),1==this.stage){this.stage=2;const n=new t.Quat;n.setFromAxisAndAngle(new t.Vec3(1,0,0),.5*Math.PI),this.constructionPlane.ori=this.constructionPlane.ori.multiply(n),this.constructionPlane.tr=e,this.invXfo=this.constructionPlane.inverse()}else 2==this.stage&&(this.stage=0,this.change.geomItem.setSelectable(!0),this.emit("actionFinished"))}},e.CreateCuboidChange=ae,e.CreateCuboidTool=class extends Y{constructor(e){super(e)}createStart(e){this.change=new ae(this.parentItem,e,this.colorParam.getValue()),this.change.geomItem.setSelectable(!1),a.getInstance().addChange(this.change),this.xfo=e,this.invXfo=e.inverse(),this.stage=1,this._height=0}createMove(e){if(1==this.stage){const t=this.invXfo.transformVec3(e);this.change.update({baseSize:[Math.abs(t.x),Math.abs(t.y)],tr:this.xfo.tr.add(t.scale(.5))})}else{const t=this.invXfo.transformVec3(e);this.change.update({height:t.y})}}createRelease(e){if(1==this.stage){this.stage=2,this.pt1=e;const n=new t.Quat;n.setFromAxisAndAngle(new t.Vec3(1,0,0),.5*Math.PI),this.constructionPlane.ori=this.constructionPlane.ori.multiply(n),this.constructionPlane.tr=e,this.invXfo=this.constructionPlane.inverse()}else 2==this.stage&&(this.stage=0,this.change.geomItem.setSelectable(!0),this.emit("actionFinished"))}},e.CreateFreehandLineChange=se,e.CreateFreehandLineTool=class extends ee{constructor(e){super(e),this.mp=new t.BooleanParameter("Modulate Thickness By Stroke Speed",!1),this.addParameter(this.mp)}createStart(e){const t=this.colorParam.getValue(),n=this.lineThickness.getValue();this.change=new se(this.parentItem,e,t,n),a.getInstance().addChange(this.change),this.xfo=e,this.invXfo=e.inverse(),this.stage=1,this.prevP=e.tr,this.length=0}createMove(e){const t=this.invXfo.transformVec3(e),n=t.subtract(this.prevP).length();this.change.update({point:t}),this.length+=n,this.prevP=t}createRelease(e){0==this.length&&a.getInstance().cancel(),this.stage=0,this.emit("actionFinished")}},e.CreateLineChange=Q,e.CreateLineTool=ee,e.CreateRectChange=ie,e.CreateRectTool=class extends Y{constructor(e){super(e)}createStart(e){this.change=new ie(this.parentItem,e),this.change.geomItem.setSelectable(!1),a.getInstance().addChange(this.change),this.xfo=e,this.invXfo=e.inverse(),this.stage=1,this._size=0}createMove(e){if(1==this.stage){const t=this.invXfo.transformVec3(e);this._size=Math.abs(t.x),Math.abs(t.y),this.change.update({baseSize:[Math.abs(t.x),Math.abs(t.y)],tr:this.xfo.tr.add(t.scale(.5))})}else{const t=this.invXfo.transformVec3(e);this.change.update({height:t.y})}}createRelease(e){0==this._size&&a.getInstance().cancel(),this.change.geomItem.setSelectable(!0),this.stage=0,this.emit("actionFinished")}},e.CreateSphereChange=re,e.CreateSphereTool=class extends Y{constructor(e){super(e)}createStart(e){this.change=new re(this.parentItem,e,this.colorParam.getValue()),this.change.geomItem.setSelectable(!1),a.getInstance().addChange(this.change),this.xfo=e,this.stage=1,this.radius=0}createMove(e){this.radius=e.distanceTo(this.xfo.tr),this.change.update({radius:this.radius})}createRelease(e){0==this.radius&&a.getInstance().cancel(),this.change.geomItem.setSelectable(!0),this.stage=0,this.emit("actionFinished")}},e.HandleMaterial=c,e.LinearMovementHandle=g,e.MeasureAngle=pe,e.MeasureAngleTool=class extends we{constructor(e){super(e),this.highlightedItemAHitPos=null,this.geomConstraints={SurfaceType:["Plane","Cylinder","Cone"]},this.numStages=2}snapToSurface(e,n,i,s,r){const a=new t.Xfo;if(n){const o=n.getParameter("SurfaceType").value;switch(o){case"Plane":{const n=i.subtract(e.tr);let o=e.ori.getZaxis();o.dot(s.dir)>0&&(o=o.negate());const l=i;if(r){const e=o,t=r.ori.getZaxis(),n=r.tr.subtract(i),s=e.cross(t).normalize();l.addInPlace(s.scale(n.dot(s)))}a.ori.setFromDirectionAndUpvector(o,new t.Vec3(o.z,o.x,o.y)),a.tr=l.subtract(o.scale(n.dot(o)));break}case"Cone":{const o=n.getParameter("SemiAngle").getValue(),l=n.getParameter("StartRadius").getValue()*e.sc.x,h=e.ori.getZaxis(),c=i.subtract(e.tr).dot(h),d=l+Math.tan(o)*c;let u=i;if(r){const t=r.tr.subtract(e.tr);t.subtractInPlace(h.scale(t.dot(h))),u=e.tr.add(t.normalize().scale(d)),u.addInPlace(h.scale(c))}const f=u.subtract(e.tr);a.ori.setFromDirectionAndUpvector(h,f);const m=new t.Quat;if(m.setFromAxisAndAngle(new t.Vec3(1,0,0),.5*Math.PI-o),a.ori.multiplyInPlace(m),a.ori.getZaxis().dot(s.dir)>0){const e=new t.Quat;e.setFromAxisAndAngle(new t.Vec3(0,1,0),Math.PI),a.ori.multiplyInPlace(e)}a.tr=u;break}case"Cylinder":{const o=n.getParameter("Radius").getValue()*e.sc.x,l=e.ori.getZaxis(),h=i.subtract(e.tr).dot(l),c=e.tr.add(l.scale(h)),d=i.subtract(c),u=d.length();let f=c.add(d.scale(o/u));if(r){const t=r.tr.subtract(e.tr);t.subtractInPlace(l.scale(t.dot(l))),f=e.tr.add(t.normalize().scale(o)),f.addInPlace(l.scale(h))}const m=f.subtract(c);a.ori.setFromDirectionAndUpvector(l,m);const g=new t.Quat;if(g.setFromAxisAndAngle(new t.Vec3(1,0,0),.5*Math.PI),a.ori.multiplyInPlace(g),a.ori.getZaxis().dot(s.dir)>0){const e=new t.Quat;e.setFromAxisAndAngle(new t.Vec3(0,1,0),Math.PI),a.ori.multiplyInPlace(e)}a.tr=f;break}default:console.log("Unhandled Surface Type: ",o)}}return a}onPointerDown(e){if(!((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.altKey||e instanceof t.ZeaMouseEvent&&0!==e.button)&&e.intersectionData)if(0==this.stage){if(this.highlightedItemA){const t=this.colorParam.getValue(),n=new pe("MeasureAngle",t);this.appData.scene.getRoot().addChild(n);const i=e.pointerRay,s=i.start.add(i.dir.scale(e.intersectionData.dist)),r=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),a=this.snapToSurface(r,this.highlightedItemA_params,s,i);n.setXfoA(a),this.measurement=n,this.hitPosA=s,this.stage++,e.stopPropagation()}}else if(1==this.stage&&this.highlightedItemB){const t=e.pointerRay,n=t.start.add(t.dir.scale(e.intersectionData.dist)),i=this.getGeomXfo(this.highlightedItemB,this.highlightedItemB_componentId),s=this.snapToSurface(i,this.highlightedItemB_params,n,t),r=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),o=this.snapToSurface(r,this.highlightedItemA_params,this.hitPosA,t,s),l=this.measurement;l.setXfoA(o),l.setXfoB(s);const h=new ve(l);a.getInstance().addChange(h),this.highlightedItemA&&(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA=null),this.highlightedItemB&&(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB=null),this.stage=0,e.stopPropagation()}}},e.MeasureCenterDistancesTool=class extends we{constructor(e){super(e),this.geomConstraints={CurveType:["Circle"],SurfaceType:["Cylinder"]},this.numStages=2}snapToParametricCenter(e,t,n){if(t.hasParameter("CurveType")){const i=t.getParameter("CurveType").value;if("Circle"===i){const t=n.subtract(e.tr),i=e.ori.getZaxis();return e.tr.add(i.scale(t.dot(i)))}console.log("Unhandled Edge Type: ",i)}else if(t.hasParameter("SurfaceType")){const i=t.getParameter("SurfaceType").value;switch(i){case"Cylinder":case"Cone":{const t=n.subtract(e.tr),i=e.ori.getZaxis();return e.tr.add(i.scale(t.dot(i)))}default:console.log("Unhandled Surface Type: ",i)}}}onPointerDown(e){if(!((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.altKey||e instanceof t.ZeaMouseEvent&&0!==e.button)&&e.intersectionData)if(0==this.stage){if(this.highlightedItemA){const n=i(e);let s;if(e.intersectionData)s=n.start.add(n.dir.scale(e.intersectionData.dist));else{const e=new t.Ray(new t.Vec3,new t.Vec3(0,0,1)),i=n.intersectRayPlane(e);s=n.start.add(n.dir.scale(i))}const r=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),o=this.snapToParametricCenter(r,this.highlightedItemA_params,s),l=this.colorParam.value,h=new fe("Measure Distance",l,this.appData.sceneUnits);h.setStartMarkerPos(o),h.setEndMarkerPos(o),this.appData.scene.getRoot().addChild(h),this.measurementChange=new ve(h),a.getInstance().addChange(this.measurementChange),this.measurement=h,this.stage++,e.stopPropagation()}}else if(1==this.stage&&this.highlightedItemB){const t=i(e),n=t.start.add(t.dir.scale(e.intersectionData.dist)),s=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),r=this.getGeomXfo(this.highlightedItemB,this.highlightedItemB_componentId);let a=this.snapToParametricCenter(r,this.highlightedItemB_params,n);const o=this.snapToParametricCenter(s,this.highlightedItemA_params,a);a=this.snapToParametricCenter(r,this.highlightedItemB_params,o);const l=this.measurement;l.setStartMarkerPos(o),l.setEndMarkerPos(a),this.highlightedItemA&&(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA=null),this.highlightedItemB&&(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB=null),this.stage=0,this.measurement=null,e.stopPropagation()}}},e.MeasureDistance=fe,e.MeasureDistanceTool=class extends we{constructor(e){super(e),this.geomConstraints={CurveType:["Line","Circle"],SurfaceType:["Plane","Cylinder"]},this.numStages=2}snapToParametricEdge(e,t,n){if(t.hasParameter("CurveType")){const i=t.getParameter("CurveType").getValue();switch(i){case"Line":{const t=n.subtract(e.tr),i=e.ori.getXaxis();return e.tr.add(i.scale(t.dot(i)))}case"Circle":{const i=n.subtract(e.tr),s=t.getParameter("Radius").getValue()*e.sc.x,r=e.ori.getZaxis();i.subtractInPlace(r.scale(i.dot(r)));const a=i.length();return e.tr.add(i.scale(s/a))}default:console.log("Unhandled Edge Type: ",i)}}else if(t.hasParameter("SurfaceType")){const i=t.getParameter("SurfaceType").getValue();switch(i){case"Plane":{const t=n.subtract(e.tr),i=e.ori.getZaxis();return n.subtract(i.scale(t.dot(i)))}case"Cylinder":{const i=n.subtract(e.tr),s=e.ori.getZaxis(),r=e.tr.add(s.scale(i.dot(s))),a=t.getParameter("Radius").getValue()*e.sc.x,o=n.subtract(r),l=o.length();return r.add(o.scale(a/l))}default:console.log("Unhandled Surface Type: ",i)}}}onPointerDown(e){if(!((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.altKey||e instanceof t.ZeaMouseEvent&&0!==e.button)&&e.intersectionData)if(0==this.stage){if(this.highlightedItemA){const n=i(e);let s;if(e.intersectionData)s=n.start.add(n.dir.scale(e.intersectionData.dist));else{const e=new t.Ray(new t.Vec3,new t.Vec3(0,0,1)),i=n.intersectRayPlane(e);s=n.start.add(n.dir.scale(i))}const r=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),o=this.snapToParametricEdge(r,this.highlightedItemA_params,s),l=this.colorParam.getValue(),h=new fe("Measure Distance",l,this.appData.sceneUnits);h.setStartMarkerPos(o),h.setEndMarkerPos(o),this.appData.scene.getRoot().addChild(h),this.measurementChange=new ve(h),a.getInstance().addChange(this.measurementChange),this.measurement=h,this.stage++,e.stopPropagation()}}else if(1==this.stage&&this.highlightedItemB){const t=i(e),n=t.start.add(t.dir.scale(e.intersectionData.dist)),s=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId),r=this.getGeomXfo(this.highlightedItemB,this.highlightedItemB_componentId),a=this.snapToParametricEdge(s,this.highlightedItemA_params,n),o=this.snapToParametricEdge(r,this.highlightedItemB_params,n),l=this.measurement;l.setStartMarkerPos(a),l.setEndMarkerPos(o),this.highlightedItemA&&(this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),this.highlightedItemA=null),this.highlightedItemB&&(this.highlightedItemB.removeHighlight(this.highlightedItemB_highlightKey,!0),this.highlightedItemB=null),this.stage=0,this.measurement=null,e.stopPropagation()}}},e.MeasureRadiusTool=class extends we{constructor(e){super(e),this.geomConstraints={CurveType:["Circle"],SurfaceType:["Cylinder"]}}onPointerDown(e){if(!((e instanceof t.ZeaMouseEvent||e instanceof t.ZeaTouchEvent)&&e.altKey||e instanceof t.ZeaMouseEvent&&0!==e.button)&&e.intersectionData&&this.highlightedItemA){const n=i(e);let s;if(e.intersectionData)s=n.start.add(n.dir.scale(e.intersectionData.dist));else{const e=new t.Ray(new t.Vec3,new t.Vec3(0,0,1)),i=n.intersectRayPlane(e);s=n.start.add(n.dir.scale(i))}const r=this.getGeomXfo(this.highlightedItemA,this.highlightedItemA_componentId);let o,l;const h=this.highlightedItemA_params;if(h.hasParameter("CurveType")){const e=h.getParameter("CurveType").getValue();switch(e){case"Circle":{const e=s.subtract(r.tr),t=h.getParameter("Radius").getValue()*r.sc.x,n=r.ori.getZaxis();e.subtractInPlace(n.scale(e.dot(n)));const i=e.length();o=r.tr,l=o.add(e.scale(t/i));break}default:console.log("Unhandled Edge Type: ",e)}}else if(h.hasParameter("SurfaceType")){const e=h.getParameter("SurfaceType").getValue();switch(e){case"Cylinder":{const e=s.subtract(r.tr),t=r.ori.getZaxis();o=r.tr.add(t.scale(e.dot(t)));const n=h.getParameter("Radius").getValue()*r.sc.x,i=s.subtract(o),a=i.length();l=o.add(i.scale(n/a));break}default:console.log("Unhandled Surface Type: ",e)}}const c=this.colorParam.getValue(),d=new fe("MeasureRadius",c,this.appData.sceneUnits);d.setStartMarkerPos(o),d.setEndMarkerPos(l),d.setGeomBuffersVisibility(!1),this.appData.scene.getRoot().addChild(d);const u=new ve(d);a.getInstance().addChange(u),this.highlightedItemA&&this.highlightedItemA.removeHighlight(this.highlightedItemA_highlightKey,!0),e.stopPropagation()}}},e.MeasurementChange=ve,e.ParameterValueChange=h,e.PlanarMovementHandle=w,e.ScreenSpaceMovementHandle=class extends s{constructor(e){super(e)}setSelectionGroup(e){this.selectionGroup=e}setTargetParam(e,t=!0){if(this.param=e,t){const t=()=>{this.globalXfoParam.value=e.getValue()};t(),e.on("valueChanged",t)}}getTargetParam(){return this.param?this.param:this.globalXfoParam}handlePointerDown(e){this.gizmoRay=new t.Ray;const n=i(e),s=e.viewport.getCamera().globalXfoParam.value;this.gizmoRay.dir=s.ori.getZaxis();const r=this.getTargetParam().value;this.gizmoRay.start=r.tr;const a=n.intersectRayPlane(this.gizmoRay);this.grabPos=n.pointAtDist(a),this.onDragStart(e)}handlePointerMove(e){const t=i(e),n=t.intersectRayPlane(this.gizmoRay);this.holdPos=t.pointAtDist(n),this.onDrag(e)}handlePointerUp(e){const t=i(e);if(t){const e=t.intersectRayPlane(this.gizmoRay);this.releasePos=t.pointAtDist(e)}this.onDragEnd(e)}onDragStart(e){this.grabPos=this.grabPos;const t=this.getTargetParam();if(this.baseXfo=t.value,this.selectionGroup){const e=this.selectionGroup.getItems();this.change=new m(Array.from(e),this.globalXfoParam.value),a.getInstance().addChange(this.change)}else this.change=new h(t),a.getInstance().addChange(this.change)}onDrag(e){const n=this.holdPos.subtract(this.grabPos);if(this.selectionGroup){const e=this.change,i=new t.Xfo(n);e.setDeltaXfo(i)}else{const e=this.baseXfo.clone();e.tr.addInPlace(n),this.change.update({value:e})}}onDragEnd(e){this.change=null}},e.SelectionChange=P,e.SelectionManager=k,e.SelectionTool=E,e.SelectionVisibilityChange=C,e.SelectionXfoChange=m,e.SliderHandle=le,e.ToolManager=oe,e.TreeItemAddChange=T,e.TreeItemMoveChange=A,e.TreeItemsRemoveChange=$,e.UndoRedoManager=a,e.VRHoldObjectsTool=K,e.VRUITool=Z,e.XfoHandle=_,Object.defineProperty(e,"__esModule",{value:!0})}(t,He)}));function Ze(e){let t,n,g,p;const v=e[3].default,w=i(v,e,e[2],null);return{c(){t=s("div"),w&&w.c(),r(t,"class","Menu absolute border border-gray-500 bg-background flex-col rounded p-2 shadow w-max"),a(t,"flex",e[0]),a(t,"hidden",e[1])},m(i,s){o(i,t,s),w&&w.m(t,null),n=!0,g||(p=l(t,"mouseenter",e[4]),g=!0)},p(e,[i]){w&&w.p&&(!n||4&i)&&h(w,v,e,e[2],n?d(v,e[2],i,null):c(e[2]),null),1&i&&a(t,"flex",e[0]),2&i&&a(t,"hidden",e[1])},i(e){n||(u(w,e),n=!0)},o(e){f(w,e),n=!1},d(e){e&&m(t),w&&w.d(e),g=!1,p()}}}function Je(e,t,n){let i,{$$slots:s={},$$scope:r}=t,{isOpen:a=!1}=t;return e.$$set=e=>{"isOpen"in e&&n(0,a=e.isOpen),"$$scope"in e&&n(2,r=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&n(1,i=!a)},[a,i,r,s,function(t){g.call(this,e,t)}]}class Ke extends e{constructor(e){super(),t(this,e,Je,Ze,n,{isOpen:0})}}function We(e){let t,n,i=e[6].length>1&&function(e){let t,n,i,a=e[6].includes("shift"),l=e[6].includes("ctrl"),h=e[6].includes("alt"),c=a&&function(e){let t;return{c(){t=s("span"),t.textContent="",r(t,"class","text-xs text-gray-400")},m(e,n){o(e,t,n)},d(e){e&&m(t)}}}(),d=l&&function(e){let t;return{c(){t=s("span"),t.textContent="^",r(t,"class","text-xs text-gray-400")},m(e,n){o(e,t,n)},d(e){e&&m(t)}}}(),u=h&&function(e){let t;return{c(){t=s("span"),t.textContent="",r(t,"class","text-xs text-gray-400")},m(e,n){o(e,t,n)},d(e){e&&m(t)}}}();return{c(){c&&c.c(),t=p(),d&&d.c(),n=p(),u&&u.c(),i=x()},m(e,s){c&&c.m(e,s),o(e,t,s),d&&d.m(e,s),o(e,n,s),u&&u.m(e,s),o(e,i,s)},p:_,d(e){c&&c.d(e),e&&m(t),d&&d.d(e),e&&m(n),u&&u.d(e),e&&m(i)}}}(e);return{c(){i&&i.c(),t=p(),n=s("span"),n.textContent=`${e[6].slice(-1)[0].toUpperCase()}`,r(n,"class","text-xs text-gray-400 mr-1")},m(e,s){i&&i.m(e,s),o(e,t,s),o(e,n,s)},p(e,t){e[6].length>1&&i.p(e,t)},d(e){i&&i.d(e),e&&m(t),e&&m(n)}}}function Ye(e){let t,n;return{c(){t=s("span"),n=v(e[2]),r(t,"class","material-icons md-18 pointer-events-none")},m(e,i){o(e,t,i),w(t,n)},p(e,t){4&t&&b(n,e[2])},d(e){e&&m(t)}}}function qe(e){let t,n,i,a,h,c,d,u,f,g,I,x,P=(e[1]||"block")+"",C=e[4]&&We(e),k=e[2]&&Ye(e);return{c(){t=s("button"),n=s("span"),i=v(P),h=p(),c=s("span"),d=v(e[3]),u=p(),C&&C.c(),f=p(),k&&k.c(),r(n,"class",a="material-icons md-18 pointer-events-none ml-1 "+(e[1]||"text-transparent")),r(c,"class","flex-1 text-left mr-5 ml-3 pointer-events-none"),r(t,"class",g="MenuItem cursor-default flex items-center w-full rounded hover:bg-gray-700 justify-between "+(e[0]&&"text-gray-500")),t.disabled=e[0]},m(s,r){o(s,t,r),w(t,n),w(n,i),w(t,h),w(t,c),w(c,d),w(t,u),C&&C.m(t,null),w(t,f),k&&k.m(t,null),e[10](t),I||(x=[l(t,"click",e[7]),l(t,"mouseenter",e[8]),l(t,"mouseleave",e[9])],I=!0)},p(e,[s]){2&s&&P!==(P=(e[1]||"block")+"")&&b(i,P),2&s&&a!==(a="material-icons md-18 pointer-events-none ml-1 "+(e[1]||"text-transparent"))&&r(n,"class",a),8&s&&b(d,e[3]),e[4]?C?C.p(e,s):(C=We(e),C.c(),C.m(t,f)):C&&(C.d(1),C=null),e[2]?k?k.p(e,s):(k=Ye(e),k.c(),k.m(t,null)):k&&(k.d(1),k=null),1&s&&g!==(g="MenuItem cursor-default flex items-center w-full rounded hover:bg-gray-700 justify-between "+(e[0]&&"text-gray-500"))&&r(t,"class",g),1&s&&(t.disabled=e[0])},i:_,o:_,d(n){n&&m(t),C&&C.d(),k&&k.d(),e[10](null),I=!1,y(x)}}}function Qe(e,t,n){let i,{disabled:s=!1}=t,{iconLeft:r=null}=t,{iconRight:a=null}=t,{label:o}=t,{shortcut:l=""}=t;const h=l.toLowerCase(),c=h.split("+"),d=e=>{if(e.target instanceof HTMLInputElement)return;const t=[];e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.metaKey&&t.push("ctrl"),e.ctrlKey&&t.push("ctrl"),"Alt"!=e.key&&"Control"!=e.key&&"Ctrl"!=e.key&&"Shift"!=e.key&&t.push(e.key);t.join("+").toLowerCase()===h&&(e.preventDefault(),i.dispatchEvent(new MouseEvent("click")))};return I((()=>(l&&window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}))),e.$$set=e=>{"disabled"in e&&n(0,s=e.disabled),"iconLeft"in e&&n(1,r=e.iconLeft),"iconRight"in e&&n(2,a=e.iconRight),"label"in e&&n(3,o=e.label),"shortcut"in e&&n(4,l=e.shortcut)},[s,r,a,o,l,i,c,function(t){g.call(this,e,t)},function(t){g.call(this,e,t)},function(t){g.call(this,e,t)},function(e){P[e?"unshift":"push"]((()=>{i=e,n(5,i)}))}]}class et extends e{constructor(e){super(),t(this,e,Qe,qe,n,{disabled:0,iconLeft:1,iconRight:2,label:3,shortcut:4})}}function tt(e){let t,n;return t=new et({props:{disabled:e[1],iconLeft:e[0]?"check":"",label:e[2],shortcut:e[3]}}),t.$on("click",e[4]),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,[n]){const i={};2&n&&(i.disabled=e[1]),1&n&&(i.iconLeft=e[0]?"check":""),4&n&&(i.label=e[2]),8&n&&(i.shortcut=e[3]),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function nt(e,t,n){let{disabled:i=!1}=t,{label:s}=t,{shortcut:r=""}=t,{checked:a=!1}=t;const o=A();return e.$$set=e=>{"disabled"in e&&n(1,i=e.disabled),"label"in e&&n(2,s=e.label),"shortcut"in e&&n(3,r=e.shortcut),"checked"in e&&n(0,a=e.checked)},[a,i,s,r,()=>{n(0,a=!a),o("change")}]}class it extends e{constructor(e){super(),t(this,e,nt,tt,n,{disabled:1,label:2,shortcut:3,checked:0})}}function st(e){let t,n;const a=e[1].default,l=i(a,e,e[0],null);return{c(){t=s("div"),l&&l.c(),r(t,"class","MenuBar flex overflow-x-auto")},m(e,i){o(e,t,i),l&&l.m(t,null),n=!0},p(e,[t]){l&&l.p&&(!n||1&t)&&h(l,a,e,e[0],n?d(a,e[0],t,null):c(e[0]),null)},i(e){n||(u(l,e),n=!0)},o(e){f(l,e),n=!1},d(e){e&&m(t),l&&l.d(e)}}}function rt(e,t,n){let{$$slots:i={},$$scope:s}=t;return e.$$set=e=>{"$$scope"in e&&n(0,s=e.$$scope)},[s,i]}class at extends e{constructor(e){super(),t(this,e,rt,st,n,{})}}new URLSearchParams(window.location.search).has("embedded");const ot=$({currentMenuBarItem:null,shouldShowDrawer:!1,shouldShowParameterOwnerWidget:!1,asmExplodeEnabled:!1}),lt=e=>({isOpen:8&e}),ht=e=>({isOpen:e[3]});function ct(e){let t,n,a,g,_,I,x;const P=e[8].default,C=i(P,e,e[7],ht);return{c(){t=s("div"),n=s("button"),a=v(e[0]),g=p(),C&&C.c(),r(n,"class","cursor-default h-full px-3 hover:bg-gray-700 transition-colors rounded"),r(t,"class","MenuBarItem")},m(i,s){o(i,t,s),w(t,n),w(n,a),e[9](n),w(t,g),C&&C.m(t,null),e[10](t),_=!0,I||(x=[l(n,"click",e[4]),l(n,"mouseenter",e[5])],I=!0)},p(e,[t]){(!_||1&t)&&b(a,e[0]),C&&C.p&&(!_||136&t)&&h(C,P,e,e[7],_?d(P,e[7],t,lt):c(e[7]),ht)},i(e){_||(u(C,e),_=!0)},o(e){f(C,e),_=!1},d(n){n&&m(t),e[9](null),C&&C.d(n),e[10](null),I=!1,y(x)}}}const dt=()=>{ot.update((e=>({...e,currentMenuBarItem:null})))};function ut(e,t,n){let i,s;E(e,ot,(e=>n(6,s=e)));let r,a,{$$slots:o={},$$scope:l}=t,{label:h}=t;return e.$$set=e=>{"label"in e&&n(0,h=e.label),"$$scope"in e&&n(7,l=e.$$scope)},e.$$.update=()=>{66&e.$$.dirty&&n(3,i=s.currentMenuBarItem===a)},[h,a,r,i,()=>{S(ot,s.currentMenuBarItem=i?null:a,s)},()=>{s.currentMenuBarItem&&(S(ot,s.currentMenuBarItem=a,s),r.focus())},s,l,o,function(e){P[e?"unshift":"push"]((()=>{r=e,n(2,r)}))},function(e){P[e?"unshift":"push"]((()=>{a=e,n(1,a)}))}]}window.addEventListener("click",(e=>{if(!e.target.parentElement)return;const t=e.target.parentElement.classList.contains("MenuItemDropDown"),n=e.target.parentElement.classList.contains("MenuBarItem");t||n||dt()})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&dt()}));class ft extends e{constructor(e){super(),t(this,e,ut,ct,n,{label:0})}}function mt(e,{delay:t=0,duration:n=400,easing:i=M}={}){const s=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:i,css:e=>"opacity: "+e*s}}function gt(e){let t,n;const r=e[2].default,a=i(r,e,e[1],null);return{c(){t=s("div"),a&&a.c()},m(i,s){o(i,t,s),a&&a.m(t,null),e[3](t),n=!0},p(e,[t]){a&&a.p&&(!n||2&t)&&h(a,r,e,e[1],n?d(r,e[1],t,null):c(e[1]),null)},i(e){n||(u(a,e),n=!0)},o(e){f(a,e),n=!1},d(n){n&&m(t),a&&a.d(n),e[3](null)}}}function pt(e,t,n){let i,s,{$$slots:r={},$$scope:a}=t;return I((()=>(s=document.createElement("div"),s.setAttribute("data-svelte-dialog-portal","true"),document.body.appendChild(s),s.appendChild(i),()=>{document.body.removeChild(s)}))),e.$$set=e=>{"$$scope"in e&&n(1,a=e.$$scope)},[i,a,r,function(e){P[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class vt extends e{constructor(e){super(),t(this,e,pt,gt,n,{})}}function wt(e){let t;const n=e[2].default,s=i(n,e,e[1],null);return{c(){s&&s.c()},m(e,n){s&&s.m(e,n),t=!0},p(e,[i]){s&&s.p&&(!t||2&i)&&h(s,n,e,e[1],t?d(n,e[1],i,null):c(e[1]),null)},i(e){t||(u(s,e),t=!0)},o(e){f(s,e),t=!1},d(e){s&&s.d(e)}}}function bt(e,t,n){let{$$slots:i={},$$scope:s}=t,{enabled:r}=t,a=[];const o=e=>{a.push({ariaHidden:e.getAttribute("aria-hidden"),inert:e.getAttribute("inert")}),e.setAttribute("aria-hidden","true"),e.setAttribute("inert","true")},l=(e,t)=>{const{ariaHidden:n,inert:i}=a[t];n?e.setAttribute("aria-hidden",n):e.removeAttribute("aria-hidden"),i||e.removeAttribute("inert")};return I((()=>{if(!r)return;const e=document.querySelectorAll("body > *:not([data-svelte-dialog-portal])");return e.forEach(o),()=>{e.forEach(l)}})),e.$$set=e=>{"enabled"in e&&n(0,r=e.enabled),"$$scope"in e&&n(1,s=e.$$scope)},[r,s,i]}class _t extends e{constructor(e){super(),t(this,e,bt,wt,n,{enabled:0})}}function yt(e){let t,n,r,a;const g=e[5].default,p=i(g,e,e[4],null);return{c(){t=s("div"),p&&p.c()},m(i,s){o(i,t,s),p&&p.m(t,null),e[6](t),n=!0,r||(a=l(window,"keydown",e[1]),r=!0)},p(e,[t]){p&&p.p&&(!n||16&t)&&h(p,g,e,e[4],n?d(g,e[4],t,null):c(e[4]),null)},i(e){n||(u(p,e),n=!0)},o(e){f(p,e),n=!1},d(n){n&&m(t),p&&p.d(n),e[6](null),r=!1,a()}}}function It(e,t,n){let i,s,r,a,o,{$$slots:l={},$$scope:h}=t,{initialFocusElement:c}=t,{returnFocusElement:d}=t;I((()=>{o=d||document.activeElement,s=[...i.querySelectorAll("*")].filter((e=>e.tabIndex>=0)),r=s[0],a=s[s.length-1],R().then((()=>{if(c)c.focus();else{(i.querySelector("[autofocus]")||r||i.querySelector("[data-svelte-dialog-content]")).focus()}}))})),D((()=>{o&&o.focus()}));return e.$$set=e=>{"initialFocusElement"in e&&n(2,c=e.initialFocusElement),"returnFocusElement"in e&&n(3,d=e.returnFocusElement),"$$scope"in e&&n(4,h=e.$$scope)},[i,e=>{"Tab"===e.key&&(0===s.length&&e.preventDefault(),e.shiftKey?document.activeElement===r&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),r.focus()))},c,d,h,l,function(e){P[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class xt extends e{constructor(e){super(),t(this,e,It,yt,n,{initialFocusElement:2,returnFocusElement:3})}}function Pt(e){let t;const n=e[1].default,s=i(n,e,e[0],null);return{c(){s&&s.c()},m(e,n){s&&s.m(e,n),t=!0},p(e,[i]){s&&s.p&&(!t||1&i)&&h(s,n,e,e[0],t?d(n,e[0],i,null):c(e[0]),null)},i(e){t||(u(s,e),t=!0)},o(e){f(s,e),t=!1},d(e){s&&s.d(e)}}}function Ct(e,t,n){let{$$slots:i={},$$scope:s}=t;return I((()=>{const{body:e,documentElement:t}=document,n=window.innerWidth-t.clientWidth,i=parseInt(window.getComputedStyle(e).getPropertyValue("padding-right"))||0;return t.style.position="relative",t.style.overflow="hidden",e.style.position="relative",e.style.overflow="hidden",e.style.paddingRight=`${i+n}px`,()=>{t.style.position="",t.style.overflow="",e.style.position="",e.style.overflow="",e.style.paddingRight=""}})),e.$$set=e=>{"$$scope"in e&&n(0,s=e.$$scope)},[s,i]}class kt extends e{constructor(e){super(),t(this,e,Ct,Pt,n,{})}}function Tt(e){let t,n,r,g;const p=e[7].default,v=i(p,e,e[8],null);let w=[e[5],{"data-svelte-dialog-overlay":""}],b={};for(let e=0;e<w.length;e+=1)b=N(b,w[e]);return{c(){t=s("div"),v&&v.c(),L(t,b),a(t,"svelte-1c5s5dv",!0)},m(i,s){o(i,t,s),v&&v.m(t,null),n=!0,r||(g=l(t,"click",V(B(e[3]))),r=!0)},p(e,i){v&&v.p&&(!n||256&i)&&h(v,p,e,e[8],n?d(p,e[8],i,null):c(e[8]),null),L(t,b=U(w,[32&i&&e[5],{"data-svelte-dialog-overlay":""}])),a(t,"svelte-1c5s5dv",!0)},i(e){n||(u(v,e),n=!0)},o(e){f(v,e),n=!1},d(e){e&&m(t),v&&v.d(e),r=!1,g()}}}function At(e){let t,n;return t=new kt({props:{$$slots:{default:[Tt]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};288&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function $t(e){let t,n;return t=new xt({props:{initialFocusElement:e[0],returnFocusElement:e[1],$$slots:{default:[At]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};1&n&&(i.initialFocusElement=e[0]),2&n&&(i.returnFocusElement=e[1]),288&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Et(e){let t,n,i,s;return t=new _t({props:{enabled:e[2],$$slots:{default:[$t]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(r,a){k(t,r,a),n=!0,i||(s=l(window,"keydown",e[4]),i=!0)},p(e,[n]){const i={};4&n&&(i.enabled=e[2]),291&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e),i=!1,s()}}}function St(e,t,n){const i=["onDismiss","initialFocusElement","returnFocusElement","ariaModalLegacy"];let s=O(t,i),{$$slots:r={},$$scope:a}=t,{onDismiss:o}=t,{initialFocusElement:l}=t,{returnFocusElement:h}=t,{ariaModalLegacy:c}=t;return e.$$set=e=>{t=N(N({},t),z(e)),n(5,s=O(t,i)),"onDismiss"in e&&n(6,o=e.onDismiss),"initialFocusElement"in e&&n(0,l=e.initialFocusElement),"returnFocusElement"in e&&n(1,h=e.returnFocusElement),"ariaModalLegacy"in e&&n(2,c=e.ariaModalLegacy),"$$scope"in e&&n(8,a=e.$$scope)},[l,h,c,()=>{o()},e=>{"Escape"===e.key&&o()},s,o,r,a]}class Mt extends e{constructor(e){super(),t(this,e,St,Et,n,{onDismiss:6,initialFocusElement:0,returnFocusElement:1,ariaModalLegacy:2})}}function Rt(e){let t,n;return t=new vt({props:{$$slots:{default:[Ot]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};190&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Dt(e){let t;const n=e[6].default,s=i(n,e,e[7],null);return{c(){s&&s.c()},m(e,n){s&&s.m(e,n),t=!0},p(e,i){s&&s.p&&(!t||128&i)&&h(s,n,e,e[7],t?d(n,e[7],i,null):c(e[7]),null)},i(e){t||(u(s,e),t=!0)},o(e){f(s,e),t=!1},d(e){s&&s.d(e)}}}function Ot(e){let t,n;const i=[e[5],{onDismiss:e[1]},{initialFocusElement:e[2]},{returnFocusElement:e[3]},{ariaModalLegacy:e[4]}];let s={$$slots:{default:[Dt]},$$scope:{ctx:e}};for(let e=0;e<i.length;e+=1)s=N(s,i[e]);return t=new Mt({props:s}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const s=62&n?U(i,[32&n&&G(e[5]),2&n&&{onDismiss:e[1]},4&n&&{initialFocusElement:e[2]},8&n&&{returnFocusElement:e[3]},16&n&&{ariaModalLegacy:e[4]}]):{};128&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Nt(e){let t,n,i=e[0]&&Rt(e);return{c(){i&&i.c(),t=x()},m(e,s){i&&i.m(e,s),o(e,t,s),n=!0},p(e,[n]){e[0]?i?(i.p(e,n),1&n&&u(i,1)):(i=Rt(e),i.c(),u(i,1),i.m(t.parentNode,t)):i&&(X(),f(i,1,1,(()=>{i=null})),F())},i(e){n||(u(i),n=!0)},o(e){f(i),n=!1},d(e){i&&i.d(e),e&&m(t)}}}function zt(e,t,n){const i=["isOpen","onDismiss","initialFocusElement","returnFocusElement","ariaModalLegacy"];let s=O(t,i),{$$slots:r={},$$scope:a}=t,{isOpen:o}=t,{onDismiss:l}=t,{initialFocusElement:h=null}=t,{returnFocusElement:c=null}=t,{ariaModalLegacy:d=!1}=t;return e.$$set=e=>{t=N(N({},t),z(e)),n(5,s=O(t,i)),"isOpen"in e&&n(0,o=e.isOpen),"onDismiss"in e&&n(1,l=e.onDismiss),"initialFocusElement"in e&&n(2,h=e.initialFocusElement),"returnFocusElement"in e&&n(3,c=e.returnFocusElement),"ariaModalLegacy"in e&&n(4,d=e.ariaModalLegacy),"$$scope"in e&&n(7,a=e.$$scope)},[o,l,h,c,d,s,r,a]}class Lt extends e{constructor(e){super(),t(this,e,zt,Nt,n,{isOpen:0,onDismiss:1,initialFocusElement:2,returnFocusElement:3,ariaModalLegacy:4})}}function Vt(e){let t,n;const r=e[2].default,l=i(r,e,e[1],null);let g=[e[0],{"data-svelte-dialog-content":""},{"aria-modal":"true"},{role:"dialog"},{tabindex:"-1"}],p={};for(let e=0;e<g.length;e+=1)p=N(p,g[e]);return{c(){t=s("div"),l&&l.c(),L(t,p),a(t,"svelte-lv7yuj",!0)},m(e,i){o(e,t,i),l&&l.m(t,null),n=!0},p(e,[i]){l&&l.p&&(!n||2&i)&&h(l,r,e,e[1],n?d(r,e[1],i,null):c(e[1]),null),L(t,p=U(g,[1&i&&e[0],{"data-svelte-dialog-content":""},{"aria-modal":"true"},{role:"dialog"},{tabindex:"-1"}])),a(t,"svelte-lv7yuj",!0)},i(e){n||(u(l,e),n=!0)},o(e){f(l,e),n=!1},d(e){e&&m(t),l&&l.d(e)}}}function Bt(e,t,n){const i=[];let s=O(t,i),{$$slots:r={},$$scope:a}=t;return e.$$set=e=>{t=N(N({},t),z(e)),n(0,s=O(t,i)),"$$scope"in e&&n(1,a=e.$$scope)},[s,a,r]}class Ut extends e{constructor(e){super(),t(this,e,Bt,Vt,n,{})}}const Xt=$();function Ft(e){let t,n,i,a,h,c,d,u,f,g,_,y,I,x,P,C,k,T,A,$,E,S,M=e[2].ASSEMBLIES+"",R=e[2].PARTS+"",D=e[2].BODIES+"",O=e[2].GEOMS+"",N=e[2].TRIANGLES+"",z=e[2].LINES+"";return{c(){t=s("section"),n=s("header"),n.textContent="Scene Stats",i=p(),a=s("main"),h=s("pre"),c=v("Assemblies:"),d=v(M),u=v("\r\nParts:"),f=v(R),g=v("\r\nBodies:"),_=v(D),y=v("\r\nGeometries:"),I=v(O),x=v("\r\nTriangles:"),P=v(N),C=v("\r\nLines:"),k=v(z),T=p(),A=s("div"),$=s("button"),$.textContent="Close",r(h,"class","text-gray-100 my-3 py-3"),r($,"class","bg-gray-700 border rounded px-2 text-white"),r(A,"class","text-right"),r(t,"class","p-2 svelte-6vpp6e")},m(s,r){o(s,t,r),w(t,n),w(t,i),w(t,a),w(a,h),w(h,c),w(h,d),w(h,u),w(h,f),w(h,g),w(h,_),w(h,y),w(h,I),w(h,x),w(h,P),w(h,C),w(h,k),w(t,T),w(t,A),w(A,$),E||(S=l($,"click",(function(){j(e[1])&&e[1].apply(this,arguments)})),E=!0)},p(t,n){e=t,4&n&&M!==(M=e[2].ASSEMBLIES+"")&&b(d,M),4&n&&R!==(R=e[2].PARTS+"")&&b(f,R),4&n&&D!==(D=e[2].BODIES+"")&&b(_,D),4&n&&O!==(O=e[2].GEOMS+"")&&b(I,O),4&n&&N!==(N=e[2].TRIANGLES+"")&&b(P,N),4&n&&z!==(z=e[2].LINES+"")&&b(k,z)},d(e){e&&m(t),E=!1,S()}}}function Gt(e){let t,n;return t=new Ut({props:{class:"content",$$slots:{default:[Ft]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};22&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ht(e){let t,n;return t=new Lt({props:{isOpen:e[0],onDismiss:e[1],class:"overlay",$$slots:{default:[Gt]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,[n]){const i={};1&n&&(i.isOpen=e[0]),2&n&&(i.onDismiss=e[1]),22&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function jt(e,t,n){let i;E(e,Xt,(e=>n(3,i=e)));let s,{isOpen:r}=t,{close:a}=t;return H((()=>{if(r){const{assets:e}=i;n(2,s=(e=>{const t={ASSEMBLIES:0,INSTANCE_ITEMS:0,PARTS:0,BODIES:0,GEOMS:0,TRIANGLES:0,LINES:0};return e.traverse((e=>{if(e instanceof ge)return!1;if(e instanceof pe)t.ASSEMBLIES++;else if(e instanceof ve)t.PARTS++;else if(e instanceof we)t.INSTANCE_ITEMS++;else if(e instanceof be){t.GEOMS++,e instanceof _e&&t.BODIES++;const n=e.geomParam.value;n&&(n instanceof ye?(t.TRIANGLES+=n.getNumTriangles(),t.LINES+=n.getNumLineSegments()):n instanceof Ie?t.TRIANGLES+=n.getNumTriangles():n instanceof xe&&(t.LINES+=n.getNumLineSegments()))}})),console.log(t),t})(e))}})),e.$$set=e=>{"isOpen"in e&&n(0,r=e.isOpen),"close"in e&&n(1,a=e.close)},[r,a,s]}class Zt extends e{constructor(e){super(),t(this,e,jt,Ht,n,{isOpen:0,close:1})}}function Jt(e){let t,n,i,s,r,a,l,h,c,d,g,v,w,b,_,y;function I(t){e[27](t)}t=new et({props:{label:"Frame All",iconLeft:"crop_free",shortcut:"F"}}),t.$on("click",e[20]);let x={label:"Camera Mode: TurnTable"};function A(t){e[28](t)}void 0!==e[4]&&(x.checked=e[4]),i=new it({props:x}),P.push((()=>K(i,"checked",I))),i.$on("change",e[13]);let $={label:"Camera Mode: Tumbler"};function E(t){e[29](t)}void 0!==e[3]&&($.checked=e[3]),a=new it({props:$}),P.push((()=>K(a,"checked",A))),a.$on("change",e[12]);let S={label:"Viewport Background: Light"};function M(t){e[30](t)}void 0!==e[5]&&(S.checked=e[5]),c=new it({props:S}),P.push((()=>K(c,"checked",E))),c.$on("change",e[14]);let R={label:"Viewport Background: Dark"};return void 0!==e[6]&&(R.checked=e[6]),v=new it({props:R}),P.push((()=>K(v,"checked",M))),v.$on("change",e[15]),_=new et({props:{label:"Display Scene Stats"}}),_.$on("click",e[19]),{c(){C(t.$$.fragment),n=p(),C(i.$$.fragment),r=p(),C(a.$$.fragment),h=p(),C(c.$$.fragment),g=p(),C(v.$$.fragment),b=p(),C(_.$$.fragment)},m(e,s){k(t,e,s),o(e,n,s),k(i,e,s),o(e,r,s),k(a,e,s),o(e,h,s),k(c,e,s),o(e,g,s),k(v,e,s),o(e,b,s),k(_,e,s),y=!0},p(e,t){const n={};!s&&16&t[0]&&(s=!0,n.checked=e[4],W((()=>s=!1))),i.$set(n);const r={};!l&&8&t[0]&&(l=!0,r.checked=e[3],W((()=>l=!1))),a.$set(r);const o={};!d&&32&t[0]&&(d=!0,o.checked=e[5],W((()=>d=!1))),c.$set(o);const h={};!w&&64&t[0]&&(w=!0,h.checked=e[6],W((()=>w=!1))),v.$set(h)},i(e){y||(u(t.$$.fragment,e),u(i.$$.fragment,e),u(a.$$.fragment,e),u(c.$$.fragment,e),u(v.$$.fragment,e),u(_.$$.fragment,e),y=!0)},o(e){f(t.$$.fragment,e),f(i.$$.fragment,e),f(a.$$.fragment,e),f(c.$$.fragment,e),f(v.$$.fragment,e),f(_.$$.fragment,e),y=!1},d(e){T(t,e),e&&m(n),T(i,e),e&&m(r),T(a,e),e&&m(h),T(c,e),e&&m(g),T(v,e),e&&m(b),T(_,e)}}}function Kt(e){let t,n;return t=new Ke({props:{isOpen:e[48],$$slots:{default:[Jt]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};131072&n[1]&&(i.isOpen=e[48]),120&n[0]|262144&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Wt(e){let t,n,i,s,r,a,l,h,c,d,g,v,w;function b(t){e[31](t)}t=new et({props:{label:"Undo",iconLeft:"undo",shortcut:"Ctrl+Z"}}),t.$on("click",e[21]),i=new et({props:{label:"Redo",iconLeft:"redo",shortcut:"Ctrl+Y"}}),i.$on("click",e[22]);let _={label:"Enable Selection Tool",shortcut:"S"};function y(t){e[32](t)}void 0!==e[7]&&(_.checked=e[7]),r=new it({props:_}),P.push((()=>K(r,"checked",b))),r.$on("change",e[16]);let I={label:"Enable Transform Handles",shortcut:"T"};function x(t){e[33](t)}void 0!==e[8]&&(I.checked=e[8]),h=new it({props:I}),P.push((()=>K(h,"checked",y))),h.$on("change",e[17]);let A={label:"Enable Walk Mode (WASD)"};return void 0!==e[0]&&(A.checked=e[0]),g=new it({props:A}),P.push((()=>K(g,"checked",x))),{c(){C(t.$$.fragment),n=p(),C(i.$$.fragment),s=p(),C(r.$$.fragment),l=p(),C(h.$$.fragment),d=p(),C(g.$$.fragment)},m(e,a){k(t,e,a),o(e,n,a),k(i,e,a),o(e,s,a),k(r,e,a),o(e,l,a),k(h,e,a),o(e,d,a),k(g,e,a),w=!0},p(e,t){const n={};!a&&128&t[0]&&(a=!0,n.checked=e[7],W((()=>a=!1))),r.$set(n);const i={};!c&&256&t[0]&&(c=!0,i.checked=e[8],W((()=>c=!1))),h.$set(i);const s={};!v&&1&t[0]&&(v=!0,s.checked=e[0],W((()=>v=!1))),g.$set(s)},i(e){w||(u(t.$$.fragment,e),u(i.$$.fragment,e),u(r.$$.fragment,e),u(h.$$.fragment,e),u(g.$$.fragment,e),w=!0)},o(e){f(t.$$.fragment,e),f(i.$$.fragment,e),f(r.$$.fragment,e),f(h.$$.fragment,e),f(g.$$.fragment,e),w=!1},d(e){T(t,e),e&&m(n),T(i,e),e&&m(s),T(r,e),e&&m(l),T(h,e),e&&m(d),T(g,e)}}}function Yt(e){let t,n;return t=new Ke({props:{isOpen:e[48],$$slots:{default:[Wt]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};131072&n[1]&&(i.isOpen=e[48]),385&n[0]|262144&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function qt(e){let t,n;return t=new et({props:{disabled:e[2],label:e[1]}}),t.$on("click",e[24]),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};4&n[0]&&(i.disabled=e[2]),2&n[0]&&(i.label=e[1]),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Qt(e){let t,n;return t=new Ke({props:{isOpen:e[48],$$slots:{default:[qt]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};131072&n[1]&&(i.isOpen=e[48]),6&n[0]|262144&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function en(e){let t,n;return t=new et({props:{label:"Explode"}}),t.$on("click",e[23]),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p:_,i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function tn(e){let t,n;return t=new Ke({props:{isOpen:e[48],$$slots:{default:[en]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};131072&n[1]&&(i.isOpen=e[48]),262144&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function nn(e){let t,n,i,s,r,a,l,h;return t=new ft({props:{label:"View",$$slots:{default:[Kt,({isOpen:e})=>({48:e}),({isOpen:e})=>[0,e?131072:0]]},$$scope:{ctx:e}}}),i=new ft({props:{label:"Edit",$$slots:{default:[Yt,({isOpen:e})=>({48:e}),({isOpen:e})=>[0,e?131072:0]]},$$scope:{ctx:e}}}),r=new ft({props:{label:"VR",$$slots:{default:[Qt,({isOpen:e})=>({48:e}),({isOpen:e})=>[0,e?131072:0]]},$$scope:{ctx:e}}}),l=new ft({props:{label:"Asm",$$slots:{default:[tn,({isOpen:e})=>({48:e}),({isOpen:e})=>[0,e?131072:0]]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment),n=p(),C(i.$$.fragment),s=p(),C(r.$$.fragment),a=p(),C(l.$$.fragment)},m(e,c){k(t,e,c),o(e,n,c),k(i,e,c),o(e,s,c),k(r,e,c),o(e,a,c),k(l,e,c),h=!0},p(e,n){const s={};120&n[0]|393216&n[1]&&(s.$$scope={dirty:n,ctx:e}),t.$set(s);const a={};385&n[0]|393216&n[1]&&(a.$$scope={dirty:n,ctx:e}),i.$set(a);const o={};6&n[0]|393216&n[1]&&(o.$$scope={dirty:n,ctx:e}),r.$set(o);const h={};393216&n[1]&&(h.$$scope={dirty:n,ctx:e}),l.$set(h)},i(e){h||(u(t.$$.fragment,e),u(i.$$.fragment,e),u(r.$$.fragment,e),u(l.$$.fragment,e),h=!0)},o(e){f(t.$$.fragment,e),f(i.$$.fragment,e),f(r.$$.fragment,e),f(l.$$.fragment,e),h=!1},d(e){T(t,e),e&&m(n),T(i,e),e&&m(s),T(r,e),e&&m(a),T(l,e)}}}function sn(e){let t,n,i=!e[11]&&function(e){let t,n,i,a,h,c,d,g,_,y,I,x,P,A,$,E,S=e[10].shouldShowDrawer?"menu_open":"menu";return c=new at({props:{$$slots:{default:[nn]},$$scope:{ctx:e}}}),P=new Zt({props:{isOpen:e[9],close:e[18]}}),{c(){t=s("header"),n=s("img"),a=p(),h=s("div"),C(c.$$.fragment),d=p(),g=s("button"),_=s("span"),y=v(S),x=p(),C(P.$$.fragment),r(n,"class","h-6 ml-8"),Z(n.src,i="/images/logo-zea.svg")||r(n,"src","/images/logo-zea.svg"),r(n,"alt","logo"),r(t,"class","gap-2 items-center px-1 sm:px-2 py-1 text-gray-200 z-50 hidden sm:flex"),r(_,"class","material-icons"),r(g,"class","cursor-default flex justify-center rounded z-50 fixed bg-background top-1 left-1"),r(g,"title",I=(e[10].shouldShowDrawer?"Close":"Open")+" drawer")},m(i,s){o(i,t,s),w(t,n),w(t,a),w(t,h),k(c,h,null),o(i,d,s),o(i,g,s),w(g,_),w(_,y),o(i,x,s),k(P,i,s),A=!0,$||(E=l(g,"click",e[25]),$=!0)},p(e,t){const n={};511&t[0]|262144&t[1]&&(n.$$scope={dirty:t,ctx:e}),c.$set(n),(!A||1024&t[0])&&S!==(S=e[10].shouldShowDrawer?"menu_open":"menu")&&b(y,S),(!A||1024&t[0]&&I!==(I=(e[10].shouldShowDrawer?"Close":"Open")+" drawer"))&&r(g,"title",I);const i={};512&t[0]&&(i.isOpen=e[9]),P.$set(i)},i(e){A||(u(c.$$.fragment,e),u(P.$$.fragment,e),A=!0)},o(e){f(c.$$.fragment,e),f(P.$$.fragment,e),A=!1},d(e){e&&m(t),T(c),e&&m(d),e&&m(g),e&&m(x),T(P,e),$=!1,E()}}}(e);return{c(){i&&i.c(),t=x()},m(e,s){i&&i.m(e,s),o(e,t,s),n=!0},p(e,t){e[11]||i.p(e,t)},i(e){n||(u(i),n=!0)},o(e){f(i),n=!1},d(e){i&&i.d(e),e&&m(t)}}}function rn(e,t,n){let i,s;E(e,ot,(e=>n(10,i=e))),E(e,J,(e=>n(41,e))),E(e,Xt,(e=>n(42,s=e)));const r=new URLSearchParams(window.location.search),a=r.has("embedded");r.has("roomId");let o,l,h,c,d,u,f="Detecting VR...",m=!0,g=!0,p=!1,v=!0,w=!1,b=!1,_=!1;document.addEventListener("keydown",(e=>{if(!e.target.contains(l.getGLCanvas()))return;switch(e.key.toLowerCase()){case"f":l&&l.frameAll();break;case"z":e.ctrlKey&&u&&u.undo();break;case"y":e.ctrlKey&&u&&u.redo()}}));let y=!1;I((()=>{h&&h.leaveRoom(),n(1,f="VR Device Not Detected"),Xt.subscribe((e=>{if(e&&!l){l=e.renderer,c=e.selectionManager,d=e.toolManager,n(26,o=e.cameraManipulator),u=e.undoRedoManager;{const{renderer:e}=s;e.getXRViewport().then((e=>{e.spectatorMode=!1,n(1,f="Launch VR"),n(2,m=!1),e.on("presentingChanged",(e=>{const{state:t}=e;n(1,f=t?"Exit VR":"Launch VR")}))})).catch((e=>{console.warn("Unable to setup XR:"+e)}))}}})),Xt.subscribe((e=>{e&&!h&&e.session&&e.sessionSync&&(h=e.session,window.addEventListener("zeaUserClicked",(e=>{})))}))}));let x=!1;return e.$$.update=()=>{67108865&e.$$.dirty[0]&&o&&n(26,o.enabledWASDWalkMode=x,o)},[x,f,m,g,p,v,w,b,_,y,i,a,()=>{o.setDefaultManipulationMode(Pe.MANIPULATION_MODES.tumbler),n(3,g=!0),n(4,p=!1)},()=>{o.setDefaultManipulationMode(Pe.MANIPULATION_MODES.turntable);const e=l.getViewport().getCamera().getParameter("GlobalXfo").getValue(),t=e.ori.getZaxis();let i=0;const s=setInterval((()=>{i+=.1;const n=new Ce,r=e.clone();n.setFromDirectionAndUpvector(t,new ke(0,0,1)),r.ori=e.ori.lerp(n,Math.min(i,1)),l.getViewport().getCamera().getParameter("GlobalXfo").setValue(r),i>=1&&clearInterval(s)}),20);n(4,p=!0),n(3,g=!1)},()=>{l.getViewport().backgroundColorParam.value=new Te(.85,.85,.85),n(5,v=!0),n(6,w=!1)},()=>{l.getViewport().backgroundColorParam.value=new Te(.25,.25,.25),n(5,v=!1),n(6,w=!0)},()=>{d&&(b?d.pushTool("SelectionTool"):d.popTool())},()=>{console.log("showHandles"),c&&(c.showHandles(_),c.updateHandleVisibility())},()=>{n(9,y=!1)},()=>{n(9,y=!0)},()=>{const{renderer:e}=s;e.frameAll()},()=>{const{undoRedoManager:e}=s;e.undo()},()=>{const{undoRedoManager:e}=s;e.redo()},()=>{S(ot,i.asmExplodeEnabled=!i.asmExplodeEnabled,i)},()=>{const{renderer:e}=s;e.getXRViewport().then((e=>{e.togglePresenting()})).catch((e=>{console.warn("Unable to setup XR:"+e)}))},()=>{S(ot,i.shouldShowDrawer=!i.shouldShowDrawer,i)},o,function(e){p=e,n(4,p)},function(e){g=e,n(3,g)},function(e){v=e,n(5,v)},function(e){w=e,n(6,w)},function(e){b=e,n(7,b)},function(e){_=e,n(8,_)},function(e){x=e,n(0,x)}]}class an extends e{constructor(e){super(),t(this,e,rn,sn,n,{},null,[-1,-1])}}class on extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"});this.div=document.createElement("div"),this.div.classList.add("fps-display"),e.appendChild(this.div);const t=document.createElement("style");t.appendChild(document.createTextNode("\n      .fps-display {\n        position: absolute;\n        bottom: 10px;\n        right: 10px;\n        color: #000000;\n      }\n    ")),e.appendChild(t)}set renderer(e){let t=0,n=0;e.on("redrawOccurred",(()=>{t++})),setInterval((()=>{n!=2*t&&(n=2*t,this.div.textContent=`FPS: ${n}`),t=0}),500)}}customElements.define("fps-display",on);const ln={};function hn(e){let t,n,a,g,v,w;const b=e[5].default,_=i(b,e,e[4],null);return{c(){t=p(),n=s("div"),_&&_.c(),r(n,"class","Menu svelte-1lqkg4w"),Y(n,"top",e[1]+"px"),Y(n,"left",e[0]+"px")},m(i,s){o(i,t,s),o(i,n,s),_&&_.m(n,null),e[6](n),g=!0,v||(w=l(document.body,"click",e[3]),v=!0)},p(e,[t]){_&&_.p&&(!g||16&t)&&h(_,b,e,e[4],g?d(b,e[4],t,null):c(e[4]),null),(!g||2&t)&&Y(n,"top",e[1]+"px"),(!g||1&t)&&Y(n,"left",e[0]+"px")},i(e){g||(u(_,e),q((()=>{a||(a=Q(n,mt,{duration:100},!0)),a.run(1)})),g=!0)},o(e){f(_,e),a||(a=Q(n,mt,{duration:100},!1)),a.run(0),g=!1},d(i){i&&m(t),i&&m(n),_&&_.d(i),e[6](null),i&&a&&a.end(),v=!1,w()}}}function cn(e,t,n){let{$$slots:i={},$$scope:s}=t,{x:r}=t,{y:a}=t;const o=A();let l;ee(ln,{dispatchClick:()=>o("click")});return e.$$set=e=>{"x"in e&&n(0,r=e.x),"y"in e&&n(1,a=e.y),"$$scope"in e&&n(4,s=e.$$scope)},e.$$.update=()=>{7&e.$$.dirty&&(()=>{if(!l)return;const e=l.getBoundingClientRect();n(0,r=Math.min(window.innerWidth-e.width,r)),a>window.innerHeight-e.height&&n(1,a-=e.height)})()},[r,a,l,e=>{e.target===l||l.contains(e.target)||o("clickoutside")},s,i,function(e){P[e?"unshift":"push"]((()=>{l=e,n(2,l)}))}]}class dn extends e{constructor(e){super(),t(this,e,cn,hn,n,{x:0,y:1})}}function un(e){let t;const n=e[3].default,s=i(n,e,e[2],null);return{c(){s&&s.c()},m(e,n){s&&s.m(e,n),t=!0},p(e,i){s&&s.p&&(!t||4&i)&&h(s,n,e,e[2],t?d(n,e[2],i,null):c(e[2]),null)},i(e){t||(u(s,e),t=!0)},o(e){f(s,e),t=!1},d(e){s&&s.d(e)}}}function fn(e){let t;return{c(){t=v(e[0])},m(e,n){o(e,t,n)},p(e,n){1&n&&b(t,e[0])},i:_,o:_,d(e){e&&m(t)}}}function mn(e){let t,n,i,a,h,c;const d=[fn,un],g=[];function p(e,t){return e[0]?0:1}return n=p(e),i=g[n]=d[n](e),{c(){t=s("div"),i.c(),r(t,"class","MenuOption text-gray svelte-13rtpoe")},m(i,s){o(i,t,s),g[n].m(t,null),a=!0,h||(c=l(t,"click",e[1]),h=!0)},p(e,[s]){let r=n;n=p(e),n===r?g[n].p(e,s):(X(),f(g[r],1,1,(()=>{g[r]=null})),F(),i=g[n],i?i.p(e,s):(i=g[n]=d[n](e),i.c()),u(i,1),i.m(t,null))},i(e){a||(u(i),a=!0)},o(e){f(i),a=!1},d(e){e&&m(t),g[n].d(),h=!1,c()}}}function gn(e,t,n){let{$$slots:i={},$$scope:s}=t,{text:r=""}=t;const a=A(),{dispatchClick:o}=te(ln);return e.$$set=e=>{"text"in e&&n(0,r=e.text),"$$scope"in e&&n(2,s=e.$$scope)},[r,e=>{a("click"),o()},s,i]}class pn extends e{constructor(e){super(),t(this,e,gn,mn,n,{text:0})}}function vn(e){let t,n,i,a,h,c,d,u,f,g,_,y,I,x=e[2].getName()+"",P=e[2].getPath()+"";return{c(){t=s("section"),n=s("header"),n.textContent="Properties",i=p(),a=s("main"),h=s("pre"),c=v(x),d=v("\r\n"),u=v(P),f=p(),g=s("div"),_=s("button"),_.textContent="Close",r(h,"class","text-gray-100 my-3 py-3"),r(_,"class","bg-gray-700 border rounded px-2 text-white"),r(g,"class","text-right"),r(t,"class","p-2 svelte-6vpp6e")},m(s,r){o(s,t,r),w(t,n),w(t,i),w(t,a),w(a,h),w(h,c),w(h,d),w(h,u),w(t,f),w(t,g),w(g,_),y||(I=l(_,"click",(function(){j(e[1])&&e[1].apply(this,arguments)})),y=!0)},p(t,n){e=t,4&n&&x!==(x=e[2].getName()+"")&&b(c,x),4&n&&P!==(P=e[2].getPath()+"")&&b(u,P)},d(e){e&&m(t),y=!1,I()}}}function wn(e){let t,n;return t=new Ut({props:{class:"content",$$slots:{default:[vn]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};14&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function bn(e){let t,n;return t=new Lt({props:{isOpen:e[0],onDismiss:e[1],class:"overlay",$$slots:{default:[wn]},$$scope:{ctx:e}}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,[n]){const i={};1&n&&(i.isOpen=e[0]),2&n&&(i.onDismiss=e[1]),14&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function _n(e,t,n){let{isOpen:i}=t,{close:s}=t,{contextItem:r}=t;return e.$$set=e=>{"isOpen"in e&&n(0,i=e.isOpen),"close"in e&&n(1,s=e.close),"contextItem"in e&&n(2,r=e.contextItem)},[i,s,r]}class yn extends e{constructor(e){super(),t(this,e,_n,bn,n,{isOpen:0,close:1,contextItem:2})}}const In=[];const xn=new class{registerComponent(e,t){In.push({queryCb:e,component:t})}selectComponent(e){for(let t=In.length-1;t>=0;t--)if(In[t].queryCb(e))return In[t].component}};function Pn(e){let t,n,i;return{c(){t=s("input"),r(t,"type","checkbox"),t.readOnly=!0,t.checked=e[0]},m(s,r){o(s,t,r),n||(i=l(t,"input",e[1]),n=!0)},p(e,[n]){1&n&&(t.checked=e[0])},i:_,o:_,d(e){e&&m(t),n=!1,i()}}}function Cn(e,t,n){let{parameter:i}=t,s=i.getValue(),r=!1;return i.on("valueChanged",(e=>{r||n(0,s=i.getValue())})),e.$$set=e=>{"parameter"in e&&n(2,i=e.parameter)},[s,e=>{n(0,s=e.target.checked),r=!0,i.setValue(s),r=!1},i]}class kn extends e{constructor(e){super(),t(this,e,Cn,Pn,n,{parameter:2})}}function Tn(e){let t,n,i;return{c(){t=s("input"),r(t,"step",e[1]),r(t,"type","number"),t.readOnly=!0,t.value=e[0],r(t,"class","NumberParameterWidget text-black rounded p-1 w-full")},m(s,r){o(s,t,r),n||(i=l(t,"input",e[2]),n=!0)},p(e,[n]){1&n&&(t.value=e[0])},i:_,o:_,d(e){e&&m(t),n=!1,i()}}}function An(e,t,n){let{parameter:i}=t,s=i.getStep(),r=i.getValue(),a=!1;return i.on("valueChanged",(e=>{a||n(0,r=i.getValue())})),e.$$set=e=>{"parameter"in e&&n(3,i=e.parameter)},[r,s,e=>{n(0,r=e.target.valueAsNumber),a=!0,i.setValue(r),a=!1},i]}class $n extends e{constructor(e){super(),t(this,e,An,Tn,n,{parameter:3})}}function En(e){let t,n,i,a,h;return{c(){t=s("input"),n=p(),i=s("input"),r(t,"max",Mn),r(t,"min",Sn),r(t,"type","range"),r(t,"step",e[3]),t.value=e[2],r(i,"max",Mn),r(i,"min",Sn),r(i,"step",e[0]),r(i,"type","number"),i.readOnly=!0,i.value=e[1],r(i,"class","RangedNumberParameterWidget text-black rounded p-1")},m(s,r){o(s,t,r),o(s,n,r),o(s,i,r),a||(h=[l(t,"input",e[4]),l(i,"input",e[5])],a=!0)},p(e,[n]){8&n&&r(t,"step",e[3]),4&n&&(t.value=e[2]),1&n&&r(i,"step",e[0]),2&n&&(i.value=e[1])},i:_,o:_,d(e){e&&m(t),e&&m(n),e&&m(i),a=!1,y(h)}}}const Sn=0,Mn=200;function Rn(e,t,n){let{parameter:i}=t;const s=(e,t,n,i,s)=>i+(e-t)/(n-t)*(s-i);let r=i.getRange()[0],a=i.getRange()[1],o=i.getStep()||s(1,Sn,Mn,r,a),l=i.getValue(),h=Math.round(s(l,r,a,Sn,Mn)),c=Math.round(s(o,r,a,Sn,Mn)),d=!1;return i.on("valueChanged",(e=>{d||(n(1,l=i.getValue()),n(2,h=s(l,r,a,Sn,Mn)))})),i.on("rangeChanged",(e=>{r=i.getMin(),a=i.getMax(),n(0,o=i.getStep()),n(3,c=Math.round(s(o,r,a,Sn,Mn)))})),e.$$set=e=>{"parameter"in e&&n(6,i=e.parameter)},[o,l,h,c,e=>{n(2,h=e.target.valueAsNumber),n(1,l=((e,t=6)=>Number(Math.round(Number(`${e}e${t}`))+`e-${t}`))(Math.round(s(h,Sn,Mn,r,a)/o)*o)),d=!0,i.setValue(l),d=!1},e=>{n(1,l=e.target.valueAsNumber),n(2,h=s(l,r,a,Sn,Mn)),d=!0,i.setValue(l),d=!1},i]}class Dn extends e{constructor(e){super(),t(this,e,Rn,En,n,{parameter:6})}}function On(e){let t,n,i;return{c(){t=s("input"),t.value=e[0],t.readOnly=!0,r(t,"class","StringParameterWidget text-black rounded p-1 w-full")},m(s,r){o(s,t,r),n||(i=l(t,"input",e[1]),n=!0)},p(e,[n]){1&n&&t.value!==e[0]&&(t.value=e[0])},i:_,o:_,d(e){e&&m(t),n=!1,i()}}}function Nn(e,t,n){let{parameter:i}=t,s=i.getValue(),r=!1;return i.on("valueChanged",(e=>{r||n(0,s=i.getValue())})),e.$$set=e=>{"parameter"in e&&n(2,i=e.parameter)},[s,e=>{n(0,s=e.target.value),r=!0,i.setValue(s),r=!1},i]}class zn extends e{constructor(e){super(),t(this,e,Nn,On,n,{parameter:2})}}function Ln(e){let t,n,i,a;return{c(){t=s("input"),r(t,"type","color"),t.readOnly=!0,t.value=n=e[0].toHex(),r(t,"class","text-black rounded h-full")},m(n,s){o(n,t,s),i||(a=l(t,"input",e[1]),i=!0)},p(e,[i]){1&i&&n!==(n=e[0].toHex())&&(t.value=n)},i:_,o:_,d(e){e&&m(t),i=!1,a()}}}function Vn(e,t,n){let{parameter:i}=t,s=i.getValue(),r=!1;return i.on("valueChanged",(e=>{r||n(0,s=i.getValue())})),e.$$set=e=>{"parameter"in e&&n(2,i=e.parameter)},[s,e=>{r=!0,s.setFromHex(e.target.value),i.setValue(s),r=!1},i]}class Bn extends e{constructor(e){super(),t(this,e,Vn,Ln,n,{parameter:2})}}function Un(e,t,n){const i=e.slice();return i[3]=t[n],i}function Xn(e,t){let n,i,a,l,h,c,d,g=t[3].parameter.getName()+"";var _=t[3].component;function y(e){return{props:{parameter:e[3].parameter}}}return _&&(h=new _(y(t))),{key:e,first:null,c(){n=s("div"),i=v(g),a=p(),l=s("div"),h&&C(h.$$.fragment),c=p(),r(n,"class","flex items-center justify-end mr-2 text-black"),r(l,"class","pointer-events-auto"),this.first=n},m(e,t){o(e,n,t),w(n,i),o(e,a,t),o(e,l,t),h&&k(h,l,null),w(l,c),d=!0},p(e,n){t=e,(!d||1&n)&&g!==(g=t[3].parameter.getName()+"")&&b(i,g);const s={};if(1&n&&(s.parameter=t[3].parameter),_!==(_=t[3].component)){if(h){X();const e=h;f(e.$$.fragment,1,0,(()=>{T(e,1)})),F()}_?(h=new _(y(t)),C(h.$$.fragment),u(h.$$.fragment,1),k(h,l,c)):h=null}else _&&h.$set(s)},i(e){d||(h&&u(h.$$.fragment,e),d=!0)},o(e){h&&f(h.$$.fragment,e),d=!1},d(e){e&&m(n),e&&m(a),e&&m(l),h&&T(h)}}}function Fn(e){let t,n,i=[],a=new Map,l=e[0];const h=e=>e[3].index;for(let t=0;t<l.length;t+=1){let n=Un(e,l,t),s=h(n);a.set(s,i[t]=Xn(s,n))}return{c(){t=s("div");for(let e=0;e<i.length;e+=1)i[e].c();r(t,"class","absolute top-36 right-0 p-2 overflow-hidden pointer-events-none ParameterOwnerWidget grid w-120 space-y-2  svelte-nhv82b")},m(e,s){o(e,t,s);for(let e=0;e<i.length;e+=1)i[e].m(t,null);n=!0},p(e,[n]){1&n&&(l=e[0],X(),i=ne(i,n,h,1,e,l,a,t,ie,Xn,null,Un),F())},i(e){if(!n){for(let e=0;e<l.length;e+=1)u(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)f(i[e]);n=!1},d(e){e&&m(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function Gn(e,t,n){let{parameterOwner:i}=t,s=[];xn.registerComponent((e=>e instanceof Ae),kn),xn.registerComponent((e=>e instanceof $e),$n),xn.registerComponent((e=>e instanceof $e&&e.getRange()),Dn),xn.registerComponent((e=>e instanceof Ee),zn),xn.registerComponent((e=>e instanceof Se),Bn);let r=0;return se((async()=>{n(0,s=[])})),e.$$set=e=>{"parameterOwner"in e&&n(1,i=e.parameterOwner)},e.$$.update=()=>{7&e.$$.dirty&&i.getParameters().forEach((e=>{if("Visible"==e.getName())return;if("DisplayEdges"==e.getName())return;if("Color"==e.getName())return;if("EdgeColor"==e.getName())return;const t=xn.selectComponent(e);t&&(s.push({index:r,component:t,parameter:e}),n(2,r++,r))}))},[s,i,r]}class Hn extends e{constructor(e){super(),t(this,e,Gn,Fn,n,{parameterOwner:1})}}function jn(e){let t,n,g,p;const v=e[3].default,w=i(v,e,e[2],null);return{c(){t=s("button"),w&&w.c(),r(t,"class","ToolbarItem border border-gray-500 shadow cursor-default rounded transform hover:scale-105 transition-all h-10 w-10 p-1 bg-background bg-opacity-40 hover:opacity-100"),r(t,"title",e[1]),a(t,"ring-4",e[0]),a(t,"ring-primary",e[0])},m(i,s){o(i,t,s),w&&w.m(t,null),n=!0,g||(p=l(t,"click",e[4]),g=!0)},p(e,[i]){w&&w.p&&(!n||4&i)&&h(w,v,e,e[2],n?d(v,e[2],i,null):c(e[2]),null),(!n||2&i)&&r(t,"title",e[1]),1&i&&a(t,"ring-4",e[0]),1&i&&a(t,"ring-primary",e[0])},i(e){n||(u(w,e),n=!0)},o(e){f(w,e),n=!1},d(e){e&&m(t),w&&w.d(e),g=!1,p()}}}function Zn(e,t,n){let{$$slots:i={},$$scope:s}=t,{isHighlighted:r=!1}=t,{title:a=""}=t;return e.$$set=e=>{"isHighlighted"in e&&n(0,r=e.isHighlighted),"title"in e&&n(1,a=e.title),"$$scope"in e&&n(2,s=e.$$scope)},[r,a,s,i,function(t){g.call(this,e,t)}]}class Jn extends e{constructor(e){super(),t(this,e,Zn,jn,n,{isHighlighted:0,title:1})}}const Kn=e=>({}),Wn=e=>({});function Yn(e){let t;const n=e[4].default,s=i(n,e,e[5],null);return{c(){s&&s.c()},m(e,n){s&&s.m(e,n),t=!0},p(e,i){s&&s.p&&(!t||32&i)&&h(s,n,e,e[5],t?d(n,e[5],i,null):c(e[5]),null)},i(e){t||(u(s,e),t=!0)},o(e){f(s,e),t=!1},d(e){s&&s.d(e)}}}function qn(e){let t,n,l,g,v;n=new Jn({props:{isHighlighted:e[1],title:e[2],$$slots:{default:[Yn]},$$scope:{ctx:e}}}),n.$on("click",e[3]);const b=e[4].popup,_=i(b,e,e[5],Wn);return{c(){t=s("button"),C(n.$$.fragment),l=p(),g=s("div"),_&&_.c(),a(g,"hidden",!e[0]),r(t,"class","ToolbarItemPopup relative")},m(e,i){o(e,t,i),k(n,t,null),w(t,l),w(t,g),_&&_.m(g,null),v=!0},p(e,[t]){const i={};2&t&&(i.isHighlighted=e[1]),4&t&&(i.title=e[2]),32&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i),_&&_.p&&(!v||32&t)&&h(_,b,e,e[5],v?d(b,e[5],t,Kn):c(e[5]),Wn),1&t&&a(g,"hidden",!e[0])},i(e){v||(u(n.$$.fragment,e),u(_,e),v=!0)},o(e){f(n.$$.fragment,e),f(_,e),v=!1},d(e){e&&m(t),T(n),_&&_.d(e)}}}function Qn(e,t,n){let{$$slots:i={},$$scope:s}=t,{isHighlighted:r=!1}=t,{isOpen:a=!1}=t,{title:o=""}=t;const l=()=>{n(0,a=!1),window.removeEventListener("click",l)};return e.$$set=e=>{"isHighlighted"in e&&n(1,r=e.isHighlighted),"isOpen"in e&&n(0,a=e.isOpen),"title"in e&&n(2,o=e.title),"$$scope"in e&&n(5,s=e.$$scope)},[a,r,o,e=>{e.stopPropagation(),n(0,a=!a),window.addEventListener("click",l)},i,s]}class ei extends e{constructor(e){super(),t(this,e,Qn,qn,n,{isHighlighted:1,isOpen:0,title:2})}}function ti(e){let t,n,i,s,a,l,h,c,d,u,f,g,p;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#f9ce03"),r(l,"d","m13.020997 56.51719l0 0c0 -3.5631065 2.8884678 -6.4515724 6.4515734 -6.4515724l75.978745 0c1.7110596 0 3.3520432 0.679718 4.5619507 1.8896217c1.2098999 1.2099037 1.8896179 2.8508873 1.8896179 4.5619507l0 25.80552c0 3.5631027 -2.888466 6.4515686 -6.4515686 6.4515686l-75.978745 0l0 0c-3.5631056 0 -6.4515734 -2.888466 -6.4515734 -6.4515686z"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m13.020997 56.51719l0 0c0 -3.5631065 2.8884678 -6.4515724 6.4515734 -6.4515724l75.978745 0c1.7110596 0 3.3520432 0.679718 4.5619507 1.8896217c1.2098999 1.2099037 1.8896179 2.8508873 1.8896179 4.5619507l0 25.80552c0 3.5631027 -2.888466 6.4515686 -6.4515686 6.4515686l-75.978745 0l0 0c-3.5631056 0 -6.4515734 -2.888466 -6.4515734 -6.4515686z"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m31.444708 33.401573l57.16535 0"),r(c,"fill-rule","evenodd"),r(d,"stroke","#000000"),r(d,"stroke-width","3.0"),r(d,"stroke-linejoin","round"),r(d,"stroke-linecap","butt"),r(d,"d","m31.444708 33.401573l57.16535 0"),r(d,"fill-rule","evenodd"),r(u,"fill","#f9ce03"),r(u,"d","m82.81548 27.070866l19.086617 6.3307076l-19.086617 6.3307114z"),r(u,"fill-rule","evenodd"),r(f,"stroke","#000000"),r(f,"stroke-width","3.0"),r(f,"stroke-linejoin","round"),r(f,"stroke-linecap","butt"),r(f,"d","m82.81548 27.070866l19.086617 6.3307076l-19.086617 6.3307114z"),r(f,"fill-rule","evenodd"),r(g,"fill","#f9ce03"),r(g,"d","m31.444708 39.732285l-19.086615 -6.3307114l19.086615 -6.3307076z"),r(g,"fill-rule","evenodd"),r(p,"stroke","#000000"),r(p,"stroke-width","3.0"),r(p,"stroke-linejoin","round"),r(p,"stroke-linecap","butt"),r(p,"d","m31.444708 39.732285l-19.086615 -6.3307114l19.086615 -6.3307076z"),r(p,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p)},p:_,i:_,o:_,d(e){e&&m(t)}}}class ni extends e{constructor(e){super(),t(this,e,null,ti,n,{})}}function ii(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m31.444708 81.40157l57.16535 0"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m31.444708 81.40157l57.16535 0"),r(h,"fill-rule","evenodd"),r(c,"fill","#f9ce03"),r(c,"d","m78.59998 63.178192l11.307091 18.566933l-21.763786 -0.51969147z"),r(c,"fill-rule","evenodd"),r(d,"stroke","#000000"),r(d,"stroke-width","3.0"),r(d,"stroke-linejoin","round"),r(d,"stroke-linecap","butt"),r(d,"d","m78.59998 63.178192l11.307091 18.566933l-21.763786 -0.51969147z"),r(d,"fill-rule","evenodd"),r(u,"fill","#f9ce03"),r(u,"d","m21.238846 81.40157l0 0c0 -2.817955 2.2844048 -5.1023636 5.1023617 -5.1023636l0 0c1.3532295 0 2.6510353 0.53757477 3.607914 1.4944534c0.95687866 0.95687866 1.4944477 2.2546844 1.4944477 3.6079102l0 0c0 2.817955 -2.2844048 5.1023636 -5.1023617 5.1023636l0 0c-2.817957 0 -5.1023617 -2.2844086 -5.1023617 -5.1023636z"),r(u,"fill-rule","evenodd"),r(f,"stroke","#000000"),r(f,"stroke-width","3.0"),r(f,"stroke-linejoin","round"),r(f,"stroke-linecap","butt"),r(f,"d","m21.238846 81.40157l0 0c0 -2.817955 2.2844048 -5.1023636 5.1023617 -5.1023636l0 0c1.3532295 0 2.6510353 0.53757477 3.607914 1.4944534c0.95687866 0.95687866 1.4944477 2.2546844 1.4944477 3.6079102l0 0c0 2.817955 -2.2844048 5.1023636 -5.1023617 5.1023636l0 0c-2.817957 0 -5.1023617 -2.2844086 -5.1023617 -5.1023636z"),r(f,"fill-rule","evenodd"),r(g,"fill","#000000"),r(g,"fill-opacity","0.0"),r(g,"d","m60.99301 31.920135l28.566933 49.480316"),r(g,"fill-rule","evenodd"),r(p,"stroke","#000000"),r(p,"stroke-width","3.0"),r(p,"stroke-linejoin","round"),r(p,"stroke-linecap","butt"),r(p,"d","m60.99301 31.920135l28.566933 49.480316"),r(p,"fill-rule","evenodd"),r(v,"fill","#f9ce03"),r(v,"d","m55.899406 23.0816l0 0c2.4352722 -1.4089794 5.551651 -0.5770035 6.9606323 1.8582668l0 0c0.67661285 1.1694584 0.86095047 2.559805 0.5124588 3.8651752c-0.34849167 1.3053722 -1.201271 2.4188404 -2.3707275 3.0954552l0 0c-2.4352722 1.4089775 -5.551651 0.5770035 -6.9606285 -1.8582668l0 0c-1.4089813 -2.4352722 -0.5770073 -5.551653 1.8582649 -6.9606304z"),r(v,"fill-rule","evenodd"),r(b,"stroke","#000000"),r(b,"stroke-width","3.0"),r(b,"stroke-linejoin","round"),r(b,"stroke-linecap","butt"),r(b,"d","m55.899406 23.0816l0 0c2.4352722 -1.4089794 5.551651 -0.5770035 6.9606323 1.8582668l0 0c0.67661285 1.1694584 0.86095047 2.559805 0.5124588 3.8651752c-0.34849167 1.3053722 -1.201271 2.4188404 -2.3707275 3.0954552l0 0c-2.4352722 1.4089775 -5.551651 0.5770035 -6.9606285 -1.8582668l0 0c-1.4089813 -2.4352722 -0.5770073 -5.551653 1.8582649 -6.9606304z"),r(b,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b)},p:_,i:_,o:_,d(e){e&&m(t)}}}class si extends e{constructor(e){super(),t(this,e,null,ii,n,{})}}function ri(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C,k,T,A;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),k=re("path"),T=re("path"),A=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m44.812416 33.401573l26.362206 0"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m44.812416 33.401573l26.362206 0"),r(h,"fill-rule","evenodd"),r(c,"fill","#f9ce03"),r(c,"d","m71.15952 27.070866l19.086617 6.3307076l-19.086617 6.3307114z"),r(c,"fill-rule","evenodd"),r(d,"stroke","#000000"),r(d,"stroke-width","3.0"),r(d,"stroke-linejoin","round"),r(d,"stroke-linecap","butt"),r(d,"d","m71.15952 27.070866l19.086617 6.3307076l-19.086617 6.3307114z"),r(d,"fill-rule","evenodd"),r(u,"fill","#f9ce03"),r(u,"d","m44.812416 39.732285l-19.086613 -6.3307114l19.086613 -6.3307076z"),r(u,"fill-rule","evenodd"),r(f,"stroke","#000000"),r(f,"stroke-width","3.0"),r(f,"stroke-linejoin","round"),r(f,"stroke-linecap","butt"),r(f,"d","m44.812416 39.732285l-19.086613 -6.3307114l19.086613 -6.3307076z"),r(f,"fill-rule","evenodd"),r(g,"fill","#f9ce03"),r(g,"d","m7.0835776 68.06037l0 0c0 3.1136627 8.171684 5.6377945 18.251968 5.6377945c10.080282 0 18.251966 -2.5241318 18.251966 -5.6377945l0 11.275589c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945z"),r(g,"fill-rule","evenodd"),r(p,"fill","#fbe167"),r(p,"d","m7.0835776 68.06037l0 0c0 -3.1136703 8.171684 -5.6377983 18.251968 -5.6377983c10.080282 0 18.251966 2.524128 18.251966 5.6377983l0 0c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945z"),r(p,"fill-rule","evenodd"),r(v,"fill","#000000"),r(v,"fill-opacity","0.0"),r(v,"d","m43.587513 68.06037l0 0c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945l0 0c0 -3.1136703 8.171684 -5.6377983 18.251968 -5.6377983c10.080282 0 18.251966 2.524128 18.251966 5.6377983l0 11.275589c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945l0 -11.275589"),r(v,"fill-rule","evenodd"),r(b,"stroke","#000000"),r(b,"stroke-width","2.0"),r(b,"stroke-linejoin","round"),r(b,"stroke-linecap","butt"),r(b,"d","m43.587513 68.06037l0 0c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945l0 0c0 -3.1136703 8.171684 -5.6377983 18.251968 -5.6377983c10.080282 0 18.251966 2.524128 18.251966 5.6377983l0 11.275589c0 3.1136627 -8.171684 5.6377945 -18.251966 5.6377945c-10.080284 0 -18.251968 -2.5241318 -18.251968 -5.6377945l0 -11.275589"),r(b,"fill-rule","evenodd"),r(y,"fill","#f9ce03"),r(y,"d","m78.23173 69.87139l0 0c0 2.1221619 5.5559006 3.8425217 12.409454 3.8425217c6.853546 0 12.409447 -1.7203598 12.409447 -3.8425217l0 7.6850357c0 2.1221695 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203522 -12.409454 -3.8425217z"),r(y,"fill-rule","evenodd"),r(I,"fill","#fbe167"),r(I,"d","m78.23173 69.87139l0 0c0 -2.1221619 5.5559006 -3.8425217 12.409454 -3.8425217c6.853546 0 12.409447 1.7203598 12.409447 3.8425217l0 0c0 2.1221619 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203598 -12.409454 -3.8425217z"),r(I,"fill-rule","evenodd"),r(x,"fill","#000000"),r(x,"fill-opacity","0.0"),r(x,"d","m103.05063 69.87139l0 0c0 2.1221619 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203598 -12.409454 -3.8425217l0 0c0 -2.1221619 5.5559006 -3.8425217 12.409454 -3.8425217c6.853546 0 12.409447 1.7203598 12.409447 3.8425217l0 7.6850357c0 2.1221695 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203522 -12.409454 -3.8425217l0 -7.6850357"),r(x,"fill-rule","evenodd"),r(P,"stroke","#000000"),r(P,"stroke-width","2.0"),r(P,"stroke-linejoin","round"),r(P,"stroke-linecap","butt"),r(P,"d","m103.05063 69.87139l0 0c0 2.1221619 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203598 -12.409454 -3.8425217l0 0c0 -2.1221619 5.5559006 -3.8425217 12.409454 -3.8425217c6.853546 0 12.409447 1.7203598 12.409447 3.8425217l0 7.6850357c0 2.1221695 -5.5559006 3.8425217 -12.409447 3.8425217c-6.853554 0 -12.409454 -1.7203522 -12.409454 -3.8425217l0 -7.6850357"),r(P,"fill-rule","evenodd"),r(C,"fill","#000000"),r(C,"fill-opacity","0.0"),r(C,"d","m25.448423 67.05249l0 -33.63779"),r(C,"fill-rule","evenodd"),r(k,"stroke","#000000"),r(k,"stroke-width","2.0"),r(k,"stroke-linejoin","round"),r(k,"stroke-linecap","butt"),r(k,"stroke-dasharray","8.0,6.0"),r(k,"d","m25.448423 67.05249l0 -33.63779"),r(k,"fill-rule","evenodd"),r(T,"fill","#000000"),r(T,"fill-opacity","0.0"),r(T,"d","m90.763084 67.05249l0 -33.63779"),r(T,"fill-rule","evenodd"),r(A,"stroke","#000000"),r(A,"stroke-width","2.0"),r(A,"stroke-linejoin","round"),r(A,"stroke-linecap","butt"),r(A,"stroke-dasharray","8.0,6.0"),r(A,"d","m90.763084 67.05249l0 -33.63779"),r(A,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C),w(s,k),w(s,T),w(s,A)},p:_,i:_,o:_,d(e){e&&m(t)}}}class ai extends e{constructor(e){super(),t(this,e,null,ri,n,{})}}function oi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#f9ce03"),r(l,"d","m10.385827 41.390194l0 0c0 7.7189407 20.214169 13.976379 45.14961 13.976379c24.935436 0 45.1496 -6.2574387 45.1496 -13.976379l0 27.952755c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379z"),r(l,"fill-rule","evenodd"),r(h,"fill","#fbe167"),r(h,"d","m10.385827 41.390194l0 0c0 -7.7189407 20.214169 -13.9763775 45.14961 -13.9763775c24.935436 0 45.1496 6.2574368 45.1496 13.9763775l0 0c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379z"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m100.685036 41.390194l0 0c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379l0 0c0 -7.7189407 20.214169 -13.9763775 45.14961 -13.9763775c24.935436 0 45.1496 6.2574368 45.1496 13.9763775l0 27.952755c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379l0 -27.952755"),r(c,"fill-rule","evenodd"),r(d,"stroke","#000000"),r(d,"stroke-width","2.0"),r(d,"stroke-linejoin","round"),r(d,"stroke-linecap","butt"),r(d,"d","m100.685036 41.390194l0 0c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379l0 0c0 -7.7189407 20.214169 -13.9763775 45.14961 -13.9763775c24.935436 0 45.1496 6.2574368 45.1496 13.9763775l0 27.952755c0 7.7189407 -20.214165 13.976379 -45.1496 13.976379c-24.93544 0 -45.14961 -6.2574387 -45.14961 -13.976379l0 -27.952755"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.0"),r(u,"d","m55.719162 40.670383l32.88189 0"),r(u,"fill-rule","evenodd"),r(f,"stroke","#000000"),r(f,"stroke-width","3.0"),r(f,"stroke-linejoin","round"),r(f,"stroke-linecap","butt"),r(f,"d","m55.719162 40.670383l32.88189 0"),r(f,"fill-rule","evenodd"),r(g,"fill","#f9ce03"),r(g,"d","m84.94488 35.749123l14.8346405 4.9291344l-14.8346405 4.9291344z"),r(g,"fill-rule","evenodd"),r(p,"stroke","#000000"),r(p,"stroke-width","3.0"),r(p,"stroke-linejoin","round"),r(p,"stroke-linecap","butt"),r(p,"d","m84.94488 35.749123l14.8346405 4.9291344l-14.8346405 4.9291344z"),r(p,"fill-rule","evenodd"),r(v,"fill","#f9ce03"),r(v,"d","m51.771652 40.670383l0 0c0 -2.1830482 1.7697105 -3.952755 3.9527588 -3.952755l0 0c1.048336 0 2.0537338 0.4164505 2.7950172 1.1577339c0.74128723 0.74128723 1.1577377 1.746685 1.1577377 2.795021l0 0c0 2.1830482 -1.7697105 3.952755 -3.952755 3.952755l0 0c-2.1830482 0 -3.9527588 -1.7697067 -3.9527588 -3.952755z"),r(v,"fill-rule","evenodd"),r(b,"stroke","#000000"),r(b,"stroke-width","3.0"),r(b,"stroke-linejoin","round"),r(b,"stroke-linecap","butt"),r(b,"d","m51.771652 40.670383l0 0c0 -2.1830482 1.7697105 -3.952755 3.9527588 -3.952755l0 0c1.048336 0 2.0537338 0.4164505 2.7950172 1.1577339c0.74128723 0.74128723 1.1577377 1.746685 1.1577377 2.795021l0 0c0 2.1830482 -1.7697105 3.952755 -3.952755 3.952755l0 0c-2.1830482 0 -3.9527588 -1.7697067 -3.9527588 -3.952755z"),r(b,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b)},p:_,i:_,o:_,d(e){e&&m(t)}}}class li extends e{constructor(e){super(),t(this,e,null,oi,n,{})}}function hi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m7.0183725 30.921259l69.35433 0l0 69.35433l-69.35433 0z"),r(l,"fill-rule","evenodd"),r(h,"fill","#000000"),r(h,"fill-opacity","0.0"),r(h,"d","m76.3727 30.921259l23.11811 -23.118109l0 69.35433l-23.11811 23.11811z"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m7.0183725 30.921259l23.11811 -23.118109l69.35433 0l-23.11811 23.118109z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m7.0183725 30.921259l23.11811 -23.118109l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.118109m-23.11811 23.118109l0 69.35433"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.2"),r(u,"d","m76.3727 30.921259l23.11811 -23.118109l0 69.35433l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#ffffff"),r(f,"fill-opacity","0.2"),r(f,"d","m7.0183725 30.921259l23.11811 -23.118109l69.35433 0l-23.11811 23.118109z"),r(f,"fill-rule","evenodd"),r(g,"stroke","#000000"),r(g,"stroke-width","4.0"),r(g,"stroke-linejoin","round"),r(g,"stroke-linecap","butt"),r(g,"d","m7.0183725 30.921259l23.11811 -23.118109l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.118109m-23.11811 23.118109l0 69.35433"),r(g,"fill-rule","evenodd"),r(p,"fill","#000000"),r(p,"fill-opacity","0.0"),r(p,"d","m6.9160104 101.20479l25.417322 -25.417328"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","3.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m6.9160104 101.20479l25.417322 -25.417328"),r(v,"fill-rule","evenodd"),r(b,"fill","#000000"),r(b,"fill-opacity","0.0"),r(b,"d","m99.386765 77.27097l-68.125984 0"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","3.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m99.386765 77.27097l-68.125984 0"),r(y,"fill-rule","evenodd"),r(I,"fill","#000000"),r(I,"fill-opacity","0.0"),r(I,"d","m29.96828 8.349007l0 69.13386"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","3.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m29.96828 8.349007l0 69.13386"),r(x,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x)},p:_,i:_,o:_,d(e){e&&m(t)}}}class ci extends e{constructor(e){super(),t(this,e,null,hi,n,{})}}function di(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m30.911938 7.158131l0 69.5748"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m30.911938 7.158131l0 69.5748"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m6.6742845 31.222435l69.35433 0l0 69.35433l-69.35433 0z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.0"),r(u,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#000000"),r(f,"fill-opacity","0.0"),r(f,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(f,"fill-rule","evenodd"),r(g,"fill","#000000"),r(g,"fill-opacity","0.2"),r(g,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(g,"fill-rule","evenodd"),r(p,"fill","#ffffff"),r(p,"fill-opacity","0.2"),r(p,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","4.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(v,"fill-rule","evenodd"),r(b,"class","viewIconColoredFace"),r(b,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","1.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(y,"fill-rule","evenodd"),r(I,"class","viewIconColoredFace"),r(I,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","3.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(x,"fill-rule","evenodd"),r(P,"class","viewIconColoredFace"),r(P,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(P,"fill-rule","evenodd"),r(C,"stroke","#000000"),r(C,"stroke-width","3.0"),r(C,"stroke-linejoin","round"),r(C,"stroke-linecap","butt"),r(C,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(C,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C)},p:_,i:_,o:_,d(e){e&&m(t)}}}class ui extends e{constructor(e){super(),t(this,e,null,di,n,{})}}function fi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m30.911938 7.158131l0 69.5748"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m30.911938 7.158131l0 69.5748"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m6.6742845 31.222435l69.35433 0l0 69.35433l-69.35433 0z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.0"),r(u,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#000000"),r(f,"fill-opacity","0.0"),r(f,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(f,"fill-rule","evenodd"),r(g,"fill","#000000"),r(g,"fill-opacity","0.2"),r(g,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(g,"fill-rule","evenodd"),r(p,"fill","#ffffff"),r(p,"fill-opacity","0.2"),r(p,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","4.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(v,"fill-rule","evenodd"),r(b,"fill","#DDDDDD"),r(b,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","1.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(y,"fill-rule","evenodd"),r(I,"fill","#DDDDDD"),r(I,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","3.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(x,"fill-rule","evenodd"),r(P,"fill","#DDDDDD"),r(P,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(P,"fill-rule","evenodd"),r(C,"stroke","#000000"),r(C,"stroke-width","3.0"),r(C,"stroke-linejoin","round"),r(C,"stroke-linecap","butt"),r(C,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(C,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C)},p:_,i:_,o:_,d(e){e&&m(t)}}}class mi extends e{constructor(e){super(),t(this,e,null,fi,n,{})}}function gi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C,k,T,A,$,E,S,M;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),k=re("path"),T=re("path"),A=re("path"),$=re("path"),E=re("path"),S=re("path"),M=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m6.945533 31.111237l69.35433 0l0 69.35433l-69.35433 0z"),r(l,"fill-rule","evenodd"),r(h,"fill","#000000"),r(h,"fill-opacity","0.0"),r(h,"d","m76.299866 31.111237l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.2"),r(u,"d","m76.299866 31.111237l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#ffffff"),r(f,"fill-opacity","0.2"),r(f,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(f,"fill-rule","evenodd"),r(g,"stroke","#000000"),r(g,"stroke-width","4.0"),r(g,"stroke-linejoin","round"),r(g,"stroke-linecap","butt"),r(g,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(g,"fill-rule","evenodd"),r(p,"fill","#000000"),r(p,"fill-opacity","0.0"),r(p,"d","m31.183187 7.0469313l0 69.57481"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","3.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m31.183187 7.0469313l0 69.57481"),r(v,"fill-rule","evenodd"),r(b,"class","viewIconFrontFace"),r(b,"d","m8.084177 32.13528l67.18111 0l0 67.401566l-67.18111 0z"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","1.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m8.084177 32.13528l67.18111 0l0 67.401566l-67.18111 0z"),r(y,"fill-rule","evenodd"),r(I,"class","viewIconColoredFace"),r(I,"d","m29.262121 7.4483647l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","1.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m29.262121 7.4483647l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(x,"fill-rule","evenodd"),r(P,"class","viewIconDarkerFace"),r(P,"d","m75.66239 31.009153l0.42572784 69.36592l23.830978 -23.61866l0 -69.15305z"),r(P,"fill-rule","evenodd"),r(C,"stroke","#000000"),r(C,"stroke-width","1.0"),r(C,"stroke-linejoin","round"),r(C,"stroke-linecap","butt"),r(C,"d","m75.66239 31.009153l0.42572784 69.36592l23.830978 -23.61866l0 -69.15305z"),r(C,"fill-rule","evenodd"),r(k,"fill","#000000"),r(k,"fill-opacity","0.0"),r(k,"d","m7.2652955 31.068003l69.35433 0l0 69.35433l-69.35433 0z"),r(k,"fill-rule","evenodd"),r(T,"fill","#000000"),r(T,"fill-opacity","0.0"),r(T,"d","m76.61963 31.068003l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(T,"fill-rule","evenodd"),r(A,"fill","#000000"),r(A,"fill-opacity","0.0"),r(A,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(A,"fill-rule","evenodd"),r($,"fill","#000000"),r($,"fill-opacity","0.0"),r($,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r($,"fill-rule","evenodd"),r(E,"fill","#000000"),r(E,"fill-opacity","0.2"),r(E,"d","m76.61963 31.068003l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(E,"fill-rule","evenodd"),r(S,"fill","#ffffff"),r(S,"fill-opacity","0.2"),r(S,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(S,"fill-rule","evenodd"),r(M,"stroke","#000000"),r(M,"stroke-width","4.0"),r(M,"stroke-linejoin","round"),r(M,"stroke-linecap","butt"),r(M,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(M,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C),w(s,k),w(s,T),w(s,A),w(s,$),w(s,E),w(s,S),w(s,M)},p:_,i:_,o:_,d(e){e&&m(t)}}}class pi extends e{constructor(e){super(),t(this,e,null,gi,n,{})}}function vi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C,k,T,A,$,E,S,M,R,D,O,N,z,L,V,B,U,X,F,G,H,j,Z,J,K,W,Y,q,Q;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),k=re("path"),T=re("path"),A=re("path"),$=re("path"),E=re("path"),S=re("path"),M=re("path"),R=re("path"),D=re("path"),O=re("path"),N=re("path"),z=re("path"),L=re("path"),V=re("path"),B=re("path"),U=re("path"),X=re("path"),F=re("path"),G=re("path"),H=re("path"),j=re("path"),Z=re("path"),J=re("path"),K=re("path"),W=re("path"),Y=re("path"),q=re("path"),Q=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m6.945533 31.111237l69.35433 0l0 69.35433l-69.35433 0z"),r(l,"fill-rule","evenodd"),r(h,"fill","#000000"),r(h,"fill-opacity","0.0"),r(h,"d","m76.299866 31.111237l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.2"),r(u,"d","m76.299866 31.111237l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#ffffff"),r(f,"fill-opacity","0.2"),r(f,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(f,"fill-rule","evenodd"),r(g,"stroke","#000000"),r(g,"stroke-width","4.0"),r(g,"stroke-linejoin","round"),r(g,"stroke-linecap","butt"),r(g,"d","m6.945533 31.111237l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(g,"fill-rule","evenodd"),r(p,"fill","#000000"),r(p,"fill-opacity","0.0"),r(p,"d","m31.183187 7.0469313l0 69.57481"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","3.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m31.183187 7.0469313l0 69.57481"),r(v,"fill-rule","evenodd"),r(b,"class","viewIconFrontFace"),r(b,"d","m8.084177 32.13528l67.18111 0l0 67.401566l-67.18111 0z"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","1.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m8.084177 32.13528l67.18111 0l0 67.401566l-67.18111 0z"),r(y,"fill-rule","evenodd"),r(I,"class","viewIconColoredFace"),r(I,"d","m29.262121 7.4483647l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","1.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m29.262121 7.4483647l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(x,"fill-rule","evenodd"),r(P,"class","viewIconDarkerFace"),r(P,"d","m75.66239 31.009153l0.42572784 69.36592l23.830978 -23.61866l0 -69.15305z"),r(P,"fill-rule","evenodd"),r(C,"stroke","#000000"),r(C,"stroke-width","1.0"),r(C,"stroke-linejoin","round"),r(C,"stroke-linecap","butt"),r(C,"d","m75.66239 31.009153l0.42572784 69.36592l23.830978 -23.61866l0 -69.15305z"),r(C,"fill-rule","evenodd"),r(k,"fill","#000000"),r(k,"fill-opacity","0.0"),r(k,"d","m7.2652955 31.068003l69.35433 0l0 69.35433l-69.35433 0z"),r(k,"fill-rule","evenodd"),r(T,"fill","#000000"),r(T,"fill-opacity","0.0"),r(T,"d","m76.61963 31.068003l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(T,"fill-rule","evenodd"),r(A,"fill","#000000"),r(A,"fill-opacity","0.0"),r(A,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(A,"fill-rule","evenodd"),r($,"fill","#000000"),r($,"fill-opacity","0.0"),r($,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r($,"fill-rule","evenodd"),r(E,"fill","#000000"),r(E,"fill-opacity","0.2"),r(E,"d","m76.61963 31.068003l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(E,"fill-rule","evenodd"),r(S,"fill","#ffffff"),r(S,"fill-opacity","0.2"),r(S,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(S,"fill-rule","evenodd"),r(M,"stroke","#000000"),r(M,"stroke-width","4.0"),r(M,"stroke-linejoin","round"),r(M,"stroke-linecap","butt"),r(M,"d","m7.2652955 31.068003l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(M,"fill-rule","evenodd"),r(R,"fill","#000000"),r(R,"fill-opacity","0.0"),r(R,"d","m5.7087536 31.953627l69.35433 0l0 69.35433l-69.35433 0z"),r(R,"fill-rule","evenodd"),r(D,"fill","#000000"),r(D,"fill-opacity","0.0"),r(D,"d","m75.06309 31.953627l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(D,"fill-rule","evenodd"),r(O,"fill","#000000"),r(O,"fill-opacity","0.0"),r(O,"d","m5.7087536 31.953627l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(O,"fill-rule","evenodd"),r(N,"fill","#000000"),r(N,"fill-opacity","0.0"),r(N,"d","m5.7087536 31.953627l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(N,"fill-rule","evenodd"),r(z,"fill","#000000"),r(z,"fill-opacity","0.2"),r(z,"d","m75.06309 31.953627l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(z,"fill-rule","evenodd"),r(L,"fill","#ffffff"),r(L,"fill-opacity","0.2"),r(L,"d","m5.7087536 31.953627l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(L,"fill-rule","evenodd"),r(V,"stroke","#000000"),r(V,"stroke-width","1.0"),r(V,"stroke-linejoin","round"),r(V,"stroke-linecap","butt"),r(V,"d","m5.7087536 31.953627l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(V,"fill-rule","evenodd"),r(B,"fill","#000000"),r(B,"fill-opacity","0.0"),r(B,"d","m99.36328 7.8893228l0 69.57481"),r(B,"fill-rule","evenodd"),r(U,"stroke","#000000"),r(U,"stroke-width","3.0"),r(U,"stroke-linejoin","round"),r(U,"stroke-linecap","butt"),r(U,"d","m99.36328 7.8893228l0 69.57481"),r(U,"fill-rule","evenodd"),r(X,"fill","#000000"),r(X,"fill-opacity","0.0"),r(X,"d","m98.33496 8.093365l-68.12599 0"),r(X,"fill-rule","evenodd"),r(F,"stroke","#000000"),r(F,"stroke-width","3.0"),r(F,"stroke-linejoin","round"),r(F,"stroke-linecap","butt"),r(F,"d","m98.33496 8.093365l-68.12599 0"),r(F,"fill-rule","evenodd"),r(G,"fill","#000000"),r(G,"fill-opacity","0.0"),r(G,"d","m6.2755904 31.435696l24.598425 -24.220472"),r(G,"fill-rule","evenodd"),r(H,"stroke","#000000"),r(H,"stroke-width","3.0"),r(H,"stroke-linejoin","round"),r(H,"stroke-linecap","butt"),r(H,"d","m6.2755904 31.435696l24.598425 -24.220472"),r(H,"fill-rule","evenodd"),r(j,"fill","#000000"),r(j,"fill-opacity","0.0"),r(j,"d","m6.569554 30.706038l0.25196838 70.45669"),r(j,"fill-rule","evenodd"),r(Z,"stroke","#000000"),r(Z,"stroke-width","3.0"),r(Z,"stroke-linejoin","round"),r(Z,"stroke-linecap","butt"),r(Z,"d","m6.569554 30.706038l0.25196838 70.45669"),r(Z,"fill-rule","evenodd"),r(J,"fill","#000000"),r(J,"fill-opacity","0.0"),r(J,"d","m75.88714 101.04462l24.472443 -24.157478"),r(J,"fill-rule","evenodd"),r(K,"stroke","#000000"),r(K,"stroke-width","3.0"),r(K,"stroke-linejoin","round"),r(K,"stroke-linecap","butt"),r(K,"d","m75.88714 101.04462l24.472443 -24.157478"),r(K,"fill-rule","evenodd"),r(W,"fill","#000000"),r(W,"fill-opacity","0.0"),r(W,"d","m76.32546 101.04462l-69.51181 -0.12598419"),r(W,"fill-rule","evenodd"),r(Y,"stroke","#000000"),r(Y,"stroke-width","3.0"),r(Y,"stroke-linejoin","round"),r(Y,"stroke-linecap","butt"),r(Y,"d","m76.32546 101.04462l-69.51181 -0.12598419"),r(Y,"fill-rule","evenodd"),r(q,"fill","#ffe599"),r(q,"d","m51.459316 33.11811l18.240559 -3.9169273l3.9169235 -18.240555l3.9169235 18.240555l18.240555 3.9169273l-18.240555 3.9169273l-3.9169235 18.240551l-3.9169235 -18.240551z"),r(q,"fill-rule","evenodd"),r(Q,"stroke","#000000"),r(Q,"stroke-width","1.0"),r(Q,"stroke-linejoin","round"),r(Q,"stroke-linecap","butt"),r(Q,"d","m51.459316 33.11811l18.240559 -3.9169273l3.9169235 -18.240555l3.9169235 18.240555l18.240555 3.9169273l-18.240555 3.9169273l-3.9169235 18.240551l-3.9169235 -18.240551z"),r(Q,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C),w(s,k),w(s,T),w(s,A),w(s,$),w(s,E),w(s,S),w(s,M),w(s,R),w(s,D),w(s,O),w(s,N),w(s,z),w(s,L),w(s,V),w(s,B),w(s,U),w(s,X),w(s,F),w(s,G),w(s,H),w(s,j),w(s,Z),w(s,J),w(s,K),w(s,W),w(s,Y),w(s,q),w(s,Q)},p:_,i:_,o:_,d(e){e&&m(t)}}}class wi extends e{constructor(e){super(),t(this,e,null,vi,n,{})}}function bi(e){let t,n,i,s,a,l,h,c,d,u,f,g,p,v,b,y,I,x,P,C,k,T,A,$,E,S;return{c(){t=re("svg"),n=re("clipPath"),i=re("path"),s=re("g"),a=re("path"),l=re("path"),h=re("path"),c=re("path"),d=re("path"),u=re("path"),f=re("path"),g=re("path"),p=re("path"),v=re("path"),b=re("path"),y=re("path"),I=re("path"),x=re("path"),P=re("path"),C=re("path"),k=re("path"),T=re("path"),A=re("path"),$=re("path"),E=re("path"),S=re("path"),r(i,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0l0 -108.94751z"),r(i,"clip-rule","nonzero"),r(n,"id","p.0"),r(a,"fill","#000000"),r(a,"fill-opacity","0.0"),r(a,"d","m0 0l108.92388 0l0 108.94751l-108.92388 0z"),r(a,"fill-rule","evenodd"),r(l,"fill","#000000"),r(l,"fill-opacity","0.0"),r(l,"d","m30.911938 7.158131l0 69.5748"),r(l,"fill-rule","evenodd"),r(h,"stroke","#000000"),r(h,"stroke-width","3.0"),r(h,"stroke-linejoin","round"),r(h,"stroke-linecap","butt"),r(h,"d","m30.911938 7.158131l0 69.5748"),r(h,"fill-rule","evenodd"),r(c,"fill","#000000"),r(c,"fill-opacity","0.0"),r(c,"d","m6.6742845 31.222435l69.35433 0l0 69.35433l-69.35433 0z"),r(c,"fill-rule","evenodd"),r(d,"fill","#000000"),r(d,"fill-opacity","0.0"),r(d,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(d,"fill-rule","evenodd"),r(u,"fill","#000000"),r(u,"fill-opacity","0.0"),r(u,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(u,"fill-rule","evenodd"),r(f,"fill","#000000"),r(f,"fill-opacity","0.0"),r(f,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(f,"fill-rule","evenodd"),r(g,"fill","#000000"),r(g,"fill-opacity","0.2"),r(g,"d","m76.02862 31.222435l23.11811 -23.11811l0 69.35433l-23.11811 23.11811z"),r(g,"fill-rule","evenodd"),r(p,"fill","#ffffff"),r(p,"fill-opacity","0.2"),r(p,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l-23.11811 23.11811z"),r(p,"fill-rule","evenodd"),r(v,"stroke","#000000"),r(v,"stroke-width","4.0"),r(v,"stroke-linejoin","round"),r(v,"stroke-linecap","butt"),r(v,"d","m6.6742845 31.222435l23.11811 -23.11811l69.35433 0l0 69.35433l-23.11811 23.11811l-69.35433 0zm0 0l69.35433 0l23.11811 -23.11811m-23.11811 23.11811l0 69.35433"),r(v,"fill-rule","evenodd"),r(b,"class","viewIconColoredFace"),r(b,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(b,"fill-rule","evenodd"),r(y,"stroke","#000000"),r(y,"stroke-width","1.0"),r(y,"stroke-linejoin","round"),r(y,"stroke-linecap","butt"),r(y,"d","m7.8129287 32.24648l67.18111 0l0 67.40158l-67.18111 0z"),r(y,"fill-rule","evenodd"),r(I,"class","viewIconColoredFace"),r(I,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(I,"fill-rule","evenodd"),r(x,"stroke","#000000"),r(x,"stroke-width","3.0"),r(x,"stroke-linejoin","round"),r(x,"stroke-linecap","butt"),r(x,"d","m28.990873 7.5595646l-22.749775 22.97511l68.47466 0.45067215l23.501457 -23.599335z"),r(x,"fill-rule","evenodd"),r(P,"class","viewIconColoredFace"),r(P,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(P,"fill-rule","evenodd"),r(C,"stroke","#000000"),r(C,"stroke-width","3.0"),r(C,"stroke-linejoin","round"),r(C,"stroke-linecap","butt"),r(C,"d","m75.39114 31.120354l0.42572784 69.36592l23.830978 -23.618652l0 -69.15306z"),r(C,"fill-rule","evenodd"),r(k,"fill","#000000"),r(k,"fill-opacity","0.0"),r(k,"d","m7.3956966 101.59434l25.417322 -25.41732"),r(k,"fill-rule","evenodd"),r(T,"stroke","#000000"),r(T,"stroke-width","3.0"),r(T,"stroke-linejoin","round"),r(T,"stroke-linecap","butt"),r(T,"stroke-dasharray","12.0,9.0"),r(T,"d","m7.3956966 101.59434l25.417322 -25.41732"),r(T,"fill-rule","evenodd"),r(A,"fill","#000000"),r(A,"fill-opacity","0.0"),r(A,"d","m99.86645 77.66052l-68.125984 0"),r(A,"fill-rule","evenodd"),r($,"stroke","#000000"),r($,"stroke-width","3.0"),r($,"stroke-linejoin","round"),r($,"stroke-linecap","butt"),r($,"stroke-dasharray","12.0,9.0"),r($,"d","m99.86645 77.66052l-68.125984 0"),r($,"fill-rule","evenodd"),r(E,"fill","#000000"),r(E,"fill-opacity","0.0"),r(E,"d","m30.447966 8.738557l0 69.13386"),r(E,"fill-rule","evenodd"),r(S,"stroke","#000000"),r(S,"stroke-width","3.0"),r(S,"stroke-linejoin","round"),r(S,"stroke-linecap","butt"),r(S,"stroke-dasharray","12.0,9.0"),r(S,"d","m30.447966 8.738557l0 69.13386"),r(S,"fill-rule","evenodd"),r(s,"clip-path","url(#p.0)"),r(t,"version","1.1"),r(t,"viewBox","0.0 0.0 108.9238845144357 108.94750656167979"),r(t,"fill","none"),r(t,"stroke","none"),r(t,"stroke-linecap","square"),r(t,"stroke-miterlimit","10"),r(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),r(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){o(e,t,r),w(t,n),w(n,i),w(t,s),w(s,a),w(s,l),w(s,h),w(s,c),w(s,d),w(s,u),w(s,f),w(s,g),w(s,p),w(s,v),w(s,b),w(s,y),w(s,I),w(s,x),w(s,P),w(s,C),w(s,k),w(s,T),w(s,A),w(s,$),w(s,E),w(s,S)},p:_,i:_,o:_,d(e){e&&m(t)}}}class _i extends e{constructor(e){super(),t(this,e,null,bi,n,{})}}const yi={WIREFRAME:"WIREFRAME",FLAT:"FLAT",FLAT_WHITE:"FLAT_WHITE",HIDDEN_LINE:"HIDDEN_LINE",SHADED:"SHADED",SHADED_AND_EDGES:"SHADED_AND_EDGES",PBR:"PBR"};let Ii=yi.PBR;const xi=()=>{if(Ii==yi.SHADED_AND_EDGES)return;Ii=yi.SHADED_AND_EDGES;const{renderer:e}=ae(Xt);e.renderMode="hiddenline",e.hiddenLineColor.a=0,e.requestRedraw()},Pi=e=>{e===yi.WIREFRAME?(()=>{if(Ii==yi.WIREFRAME)return;Ii=yi.WIREFRAME;const{renderer:e}=ae(Xt);e.renderMode="wireframe",e.requestRedraw()})():e===yi.FLAT?(()=>{if(Ii==yi.FLAT)return;Ii=yi.FLAT;const{renderer:e}=ae(Xt);e.renderMode="flat",e.hiddenLineColor.a=0,e.requestRedraw()})():e===yi.FLAT_WHITE?((e=!0)=>{if(Ii==yi.FLAT_WHITE)return;Ii=yi.FLAT_WHITE;const{renderer:t}=ae(Xt);t.renderMode="hiddenline",t.hiddenLineColor.a=.2,t.requestRedraw()})():e===yi.HIDDEN_LINE?(()=>{if(Ii==yi.HIDDEN_LINE)return;Ii=yi.HIDDEN_LINE;const{renderer:e}=ae(Xt);e.renderMode="flat",e.hiddenLineColor.a=.1,e.requestRedraw()})():e===yi.SHADED||e===yi.SHADED_AND_EDGES?xi():e===yi.PBR&&(()=>{if(Ii==yi.PBR)return;Ii=yi.PBR;const{renderer:e}=ae(Xt);e.renderMode="pbr",e.hiddenLineColor.a=0,e.requestRedraw()})()},Ci={NONE:Symbol(),MEASURE_DISTANCE:Symbol(),MEASURE_RADIUS:Symbol(),MEASURE_CENTER_DISTANCE:Symbol(),MEASURE_ANGLE:Symbol()};let ki=Ci.NONE;const Ti=e=>{const{toolManager:t}=ae(Xt);return ki==Ci.NONE||(ki==Ci.MEASURE_DISTANCE||ki==Ci.MEASURE_RADIUS||ki==Ci.MEASURE_CENTER_DISTANCE||ki==Ci.MEASURE_ANGLE)&&t.popTool(),e==Ci.NONE||(e==Ci.MEASURE_DISTANCE?t.pushTool("measureDistanceTool"):e==Ci.MEASURE_RADIUS?t.pushTool("measureRadiusTool"):e==Ci.MEASURE_CENTER_DISTANCE?t.pushTool("measureCenterDistancesTool"):e==Ci.MEASURE_ANGLE&&t.pushTool("measureAngleTool")),ki=e,ki},Ai=e=>{if(ki==e&&e!=Ci.NONE)return Ai(Ci.NONE);console.log("toggleMeasureTool");const{scene:t}=ae(Xt);let n;if(t.getRoot().traverse((e=>!n&&(e instanceof Me?(n=e,!1):void 0))),console.log("assetItem:",n),n)if(n.getEngineDataVersion().compare([3,9,1])>=0){if(n.url.startsWith("blob"))return void(n.metadataLoaded?Ti(e):new Promise((e=>{let t=document.createElement("input");t.addEventListener("change",(t=>{const n=URL.createObjectURL(t.target.files[0]);e(n)})),t.setAttribute("type","file"),t.setAttribute("accept",".zmetadata"),t.click()})).then((t=>{n.loadMetadata(t).then((()=>{Ti(e)})).catch((e=>{console.error(e)}))})));n.loadMetadata().then((()=>{Ti(e)})).catch((e=>{console.error(e)}))}else Ti(e)};function $i(e){let t,n;return t=new ni({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ei(e){let t,n;return t=new ni({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Si(e){let t,n;return t=new li({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Mi(e){let t,n;return t=new ai({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ri(e){let t,n;return t=new si({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Di(e){let t,n,i,a,l,h,c,d,g;return n=new Jn({props:{isHighlighted:e[1]===Ci.MEASURE_DISTANCE,title:"MEASURE_DISTANCE",$$slots:{default:[Ei]},$$scope:{ctx:e}}}),n.$on("click",e[3]),a=new Jn({props:{isHighlighted:e[1]===Ci.MEASURE_RADIUS,title:"MEASURE_RADIUS",$$slots:{default:[Si]},$$scope:{ctx:e}}}),a.$on("click",e[4]),h=new Jn({props:{isHighlighted:e[1]===Ci.MEASURE_CENTER_DISTANCE,title:"MEASURE_CENTER_DISTANCE",$$slots:{default:[Mi]},$$scope:{ctx:e}}}),h.$on("click",e[5]),d=new Jn({props:{isHighlighted:e[1]===Ci.MEASURE_ANGLE,title:"MEASURE_ANGLE",$$slots:{default:[Ri]},$$scope:{ctx:e}}}),d.$on("click",e[6]),{c(){t=s("div"),C(n.$$.fragment),i=p(),C(a.$$.fragment),l=p(),C(h.$$.fragment),c=p(),C(d.$$.fragment),r(t,"class","flex flex-col absolute bottom-full gap-1 mb-1"),r(t,"slot","popup")},m(e,s){o(e,t,s),k(n,t,null),w(t,i),k(a,t,null),w(t,l),k(h,t,null),w(t,c),k(d,t,null),g=!0},p(e,t){const i={};2&t&&(i.isHighlighted=e[1]===Ci.MEASURE_DISTANCE),4096&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i);const s={};2&t&&(s.isHighlighted=e[1]===Ci.MEASURE_RADIUS),4096&t&&(s.$$scope={dirty:t,ctx:e}),a.$set(s);const r={};2&t&&(r.isHighlighted=e[1]===Ci.MEASURE_CENTER_DISTANCE),4096&t&&(r.$$scope={dirty:t,ctx:e}),h.$set(r);const o={};2&t&&(o.isHighlighted=e[1]===Ci.MEASURE_ANGLE),4096&t&&(o.$$scope={dirty:t,ctx:e}),d.$set(o)},i(e){g||(u(n.$$.fragment,e),u(a.$$.fragment,e),u(h.$$.fragment,e),u(d.$$.fragment,e),g=!0)},o(e){f(n.$$.fragment,e),f(a.$$.fragment,e),f(h.$$.fragment,e),f(d.$$.fragment,e),g=!1},d(e){e&&m(t),T(n),T(a),T(h),T(d)}}}function Oi(e){let t,n;return t=new pi({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ni(e){let t,n;return t=new ci({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function zi(e){let t,n;return t=new ui({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Li(e){let t,n;return t=new mi({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Vi(e){let t,n;return t=new _i({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Bi(e){let t,n;return t=new wi({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ui(e){let t,n,i,a,l,h,c,d,g,v,b;return n=new Jn({props:{isHighlighted:e[2]===yi.WIREFRAME,title:"Wireframe",$$slots:{default:[Ni]},$$scope:{ctx:e}}}),n.$on("click",e[7]),a=new Jn({props:{isHighlighted:e[2]===yi.FLAT,title:"Flat",$$slots:{default:[zi]},$$scope:{ctx:e}}}),a.$on("click",e[8]),h=new Jn({props:{isHighlighted:e[2]===yi.FLAT_WHITE,title:"FlatWhite",$$slots:{default:[Li]},$$scope:{ctx:e}}}),h.$on("click",e[9]),d=new Jn({props:{isHighlighted:e[2]===yi.HIDDEN_LINE,title:"HiddenLine",$$slots:{default:[Vi]},$$scope:{ctx:e}}}),d.$on("click",e[10]),v=new Jn({props:{isHighlighted:e[2]===yi.PBR,title:"PBR",$$slots:{default:[Bi]},$$scope:{ctx:e}}}),v.$on("click",e[11]),{c(){t=s("div"),C(n.$$.fragment),i=p(),C(a.$$.fragment),l=p(),C(h.$$.fragment),c=p(),C(d.$$.fragment),g=p(),C(v.$$.fragment),r(t,"class","flex flex-col absolute bottom-full gap-1 mb-1"),r(t,"slot","popup")},m(e,s){o(e,t,s),k(n,t,null),w(t,i),k(a,t,null),w(t,l),k(h,t,null),w(t,c),k(d,t,null),w(t,g),k(v,t,null),b=!0},p(e,t){const i={};4&t&&(i.isHighlighted=e[2]===yi.WIREFRAME),4096&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i);const s={};4&t&&(s.isHighlighted=e[2]===yi.FLAT),4096&t&&(s.$$scope={dirty:t,ctx:e}),a.$set(s);const r={};4&t&&(r.isHighlighted=e[2]===yi.FLAT_WHITE),4096&t&&(r.$$scope={dirty:t,ctx:e}),h.$set(r);const o={};4&t&&(o.isHighlighted=e[2]===yi.HIDDEN_LINE),4096&t&&(o.$$scope={dirty:t,ctx:e}),d.$set(o);const l={};4&t&&(l.isHighlighted=e[2]===yi.PBR),4096&t&&(l.$$scope={dirty:t,ctx:e}),v.$set(l)},i(e){b||(u(n.$$.fragment,e),u(a.$$.fragment,e),u(h.$$.fragment,e),u(d.$$.fragment,e),u(v.$$.fragment,e),b=!0)},o(e){f(n.$$.fragment,e),f(a.$$.fragment,e),f(h.$$.fragment,e),f(d.$$.fragment,e),f(v.$$.fragment,e),b=!1},d(e){e&&m(t),T(n),T(a),T(h),T(d),T(v)}}}function Xi(e){let t,n,i,l,h;return n=new ei({props:{isHighlighted:e[1]!==Ci.NONE,title:"Measure Tools",$$slots:{popup:[Di],default:[$i]},$$scope:{ctx:e}}}),l=new ei({props:{isHighlighted:e[2]!==yi.PBR,title:"Renderer modes",$$slots:{popup:[Ui],default:[Oi]},$$scope:{ctx:e}}}),{c(){t=s("div"),C(n.$$.fragment),i=p(),C(l.$$.fragment),r(t,"class","Toolbar flex gap-1"),a(t,"flex-col","vertical"===e[0])},m(e,s){o(e,t,s),k(n,t,null),w(t,i),k(l,t,null),h=!0},p(e,[i]){const s={};2&i&&(s.isHighlighted=e[1]!==Ci.NONE),4098&i&&(s.$$scope={dirty:i,ctx:e}),n.$set(s);const r={};4&i&&(r.isHighlighted=e[2]!==yi.PBR),4100&i&&(r.$$scope={dirty:i,ctx:e}),l.$set(r),1&i&&a(t,"flex-col","vertical"===e[0])},i(e){h||(u(n.$$.fragment,e),u(l.$$.fragment,e),h=!0)},o(e){f(n.$$.fragment,e),f(l.$$.fragment,e),h=!1},d(e){e&&m(t),T(n),T(l)}}}function Fi(e,t,n){let{orientation:i="horizontal"}=t,s=Ci.NONE;let r=yi.PBR;return e.$$set=e=>{"orientation"in e&&n(0,i=e.orientation)},[i,s,r,()=>{n(1,s=Ai(Ci.MEASURE_DISTANCE))},()=>{n(1,s=Ai(Ci.MEASURE_RADIUS))},()=>{n(1,s=Ai(Ci.MEASURE_CENTER_DISTANCE))},()=>{n(1,s=Ai(Ci.MEASURE_ANGLE))},()=>{Pi(yi.WIREFRAME),n(2,r=yi.WIREFRAME)},()=>{Pi(yi.FLAT),n(2,r=yi.FLAT)},()=>{Pi(yi.FLAT_WHITE),n(2,r=yi.FLAT_WHITE)},()=>{Pi(yi.HIDDEN_LINE),n(2,r=yi.HIDDEN_LINE)},()=>{Pi(yi.PBR),n(2,r=yi.PBR)}]}class Gi extends e{constructor(e){super(),t(this,e,Fi,Xi,n,{orientation:0})}}function Hi(e){let t,n,a,g,v,b,_,y;const I=e[4].default,x=i(I,e,e[3],null);return{c(){t=s("nav"),n=s("div"),x&&x.c(),a=p(),g=s("div"),g.innerHTML='<span class="material-icons transform rotate-90">drag_handle</span>',r(n,"class","DrawerContent flex-1 overflow-hidden"),r(g,"class","DrawerHandle flex items-center justify-center text-gray-400 w-2"),Y(g,"cursor","col-resize"),r(t,"class",v="absolute bg-background flex h-full shadow w-72 top-0 transition transform "+(e[1].shouldShowDrawer||"-translate-x-full"))},m(i,s){o(i,t,s),w(t,n),x&&x.m(n,null),w(t,a),w(t,g),e[5](t),b=!0,_||(y=l(g,"mousedown",e[2]),_=!0)},p(e,[n]){x&&x.p&&(!b||8&n)&&h(x,I,e,e[3],b?d(I,e[3],n,null):c(e[3]),null),(!b||2&n&&v!==(v="absolute bg-background flex h-full shadow w-72 top-0 transition transform "+(e[1].shouldShowDrawer||"-translate-x-full")))&&r(t,"class",v)},i(e){b||(u(x,e),b=!0)},o(e){f(x,e),b=!1},d(n){n&&m(t),x&&x.d(n),e[5](null),_=!1,y()}}}function ji(e,t,n){let i;E(e,ot,(e=>n(1,i=e)));let s,r,a,{$$slots:o={},$$scope:l}=t;const h=e=>{const t=r.clientX-e.clientX,i=a.width-t;n(0,s.style.width=`${i}px`,s)},c=e=>{window.getSelection().removeAllRanges(),h(e)},d=()=>{document.body.style.cursor=null,window.removeEventListener("mousemove",c)};return e.$$set=e=>{"$$scope"in e&&n(3,l=e.$$scope)},[s,i,e=>{r={clientX:e.clientX},a={width:s.offsetWidth},h(e),document.body.style.cursor="col-resize",window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)},l,o,function(e){P[e?"unshift":"push"]((()=>{s=e,n(0,s)}))}]}class Zi extends e{constructor(e){super(),t(this,e,ji,Hi,n,{})}}function Ji(e){let t,n;return{c(){t=s("div"),n=s("div"),r(n,"class","bg-primary h-1"),Y(n,"width",e[0]+"%"),r(t,"class","ProgressBar")},m(e,i){o(e,t,i),w(t,n)},p(e,[t]){1&t&&Y(n,"width",e[0]+"%")},i:_,o:_,d(e){e&&m(t)}}}function Ki(e,t,n){let{progress:i=0}=t;return e.$$set=e=>{"progress"in e&&n(0,i=e.progress)},[i]}class Wi extends e{constructor(e){super(),t(this,e,Ki,Ji,n,{progress:0})}}const Yi=$();function qi(e){let t,n,i,a,h,c,d;return{c(){t=s("div"),n=s("form"),i=s("input"),a=p(),h=s("ul"),r(i,"class","rounded w-full text-black px-1"),r(i,"type","search"),r(h,"class","py-3"),r(h,"id","searchResults"),r(t,"class","h-full w-full px-3")},m(s,r){o(s,t,r),w(t,n),w(n,i),e[4](i),oe(i,e[0]),w(t,a),w(t,h),e[6](h),c||(d=[l(i,"input",e[5]),l(n,"submit",le(e[3]))],c=!0)},p(e,[t]){1&t&&oe(i,e[0])},i:_,o:_,d(n){n&&m(t),e[4](null),e[6](null),c=!1,y(d)}}}function Qi(e,t,n){let i,s,r;E(e,Yi,(e=>n(8,i=e)));let a="";const o=new Set,l=new Re;l.setShaderName("FlatSurfaceShader"),l.getParameter("BaseColor").setValue(new Te(0,0,1,.1));const h={},c=new Set,d=new Te(1,0,0,.2);return I((()=>{s.focus()})),e.$$.update=()=>{1&e.$$.dirty&&(()=>{if(i){for(;r.firstChild;)r.removeChild(r.lastChild);if(o.forEach((e=>{e instanceof be&&h[e.getId()]&&e.getParameter("Material").setValue(h[e.getId()])})),o.clear(),c.forEach((e=>{e.removeHighlight("searchResult",!0)})),c.clear(),a.length>=2){const e=new RegExp(a,"i");i.getRoot().traverse((t=>{if(t instanceof De||!(t instanceof Oe))return!1;if(e.test(t.getName())){const e=document.createElement("li");return e.classList.add("truncate"),e.textContent=t.getName(),r.appendChild(e),c.add(t),t.addHighlight("searchResult",d,!0),!1}t instanceof be&&o.add(t)}))}}})()},[a,s,r,()=>{o.forEach((e=>{if(e instanceof be){const t=e.getParameter("Material");h[e.getId()]=t.getValue(),t.setValue(l)}})),c.forEach((e=>{e.removeHighlight("searchResult",!0)}))},function(e){P[e?"unshift":"push"]((()=>{s=e,n(1,s)}))},function(){a=this.value,n(0,a)},function(e){P[e?"unshift":"push"]((()=>{r=e,n(2,r)}))}]}class es extends e{constructor(e){super(),t(this,e,Qi,qi,n,{})}}function ts(e,t,n){const i=e.slice();return i[4]=t[n],i}function ns(e){let t,n,i,h,c,d=e[4]+"";function u(){return e[3](e[4])}return{c(){t=s("button"),n=v(d),i=p(),r(t,"class","flex-1 leading-9 rounded-t"),a(t,"bg-gray-600",e[0]===e[4]),a(t,"bg-gray-800",e[0]!==e[4]),a(t,"hover:bg-gray-700",e[0]!==e[4]),a(t,"text-primary",e[0]===e[4])},m(e,s){o(e,t,s),w(t,n),w(t,i),h||(c=l(t,"click",u),h=!0)},p(i,s){e=i,2&s&&d!==(d=e[4]+"")&&b(n,d),3&s&&a(t,"bg-gray-600",e[0]===e[4]),3&s&&a(t,"bg-gray-800",e[0]!==e[4]),3&s&&a(t,"hover:bg-gray-700",e[0]!==e[4]),3&s&&a(t,"text-primary",e[0]===e[4])},d(e){e&&m(t),h=!1,c()}}}function is(e){let t,n=e[1],i=[];for(let t=0;t<n.length;t+=1)i[t]=ns(ts(e,n,t));return{c(){t=s("div");for(let e=0;e<i.length;e+=1)i[e].c();r(t,"class","TabsBar flex border-b border-gray-600 mb-2")},m(e,n){o(e,t,n);for(let e=0;e<i.length;e+=1)i[e].m(t,null)},p(e,[s]){if(7&s){let r;for(n=e[1],r=0;r<n.length;r+=1){const a=ts(e,n,r);i[r]?i[r].p(a,s):(i[r]=ns(a),i[r].c(),i[r].m(t,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},i:_,o:_,d(e){e&&m(t),he(i,e)}}}function ss(e,t,n){let{tabs:i=[]}=t,{selectedTab:s=i[0]}=t;const r=e=>{n(0,s=e)};return e.$$set=e=>{"tabs"in e&&n(1,i=e.tabs),"selectedTab"in e&&n(0,s=e.selectedTab)},[s,i,r,e=>{r(e)}]}class rs extends e{constructor(e){super(),t(this,e,ss,is,n,{tabs:1,selectedTab:0})}}function as(e){let t,n,i;return{c(){t=re("svg"),n=re("path"),i=re("path"),r(n,"d","M10 12a2 2 0 100-4 2 2 0 000 4z"),r(i,"fill-rule","evenodd"),r(i,"d","M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"),r(i,"clip-rule","evenodd"),r(t,"class",e[0]),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"viewBox","0 0 20 20"),r(t,"fill","currentColor")},m(e,s){o(e,t,s),w(t,n),w(t,i)},p(e,[n]){1&n&&r(t,"class",e[0])},i:_,o:_,d(e){e&&m(t)}}}function os(e,t,n){let{design:i=""}=t;return e.$$set=e=>{"design"in e&&n(0,i=e.design)},[i]}class ls extends e{constructor(e){super(),t(this,e,os,as,n,{design:0})}}function hs(e){let t,n,i;return{c(){t=re("svg"),n=re("path"),i=re("path"),r(n,"fill-rule","evenodd"),r(n,"d","M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"),r(n,"clip-rule","evenodd"),r(i,"d","M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"),r(t,"class",e[0]),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"viewBox","0 0 20 20"),r(t,"fill","currentColor")},m(e,s){o(e,t,s),w(t,n),w(t,i)},p(e,[n]){1&n&&r(t,"class",e[0])},i:_,o:_,d(e){e&&m(t)}}}function cs(e,t,n){let{design:i=""}=t;return e.$$set=e=>{"design"in e&&n(0,i=e.design)},[i]}class ds extends e{constructor(e){super(),t(this,e,cs,hs,n,{design:0})}}function us(e){let t,n;return{c(){t=re("svg"),n=re("path"),r(n,"fill-rule","evenodd"),r(n,"d","M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"),r(n,"clip-rule","evenodd"),r(t,"class",e[0]),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"viewBox","0 0 20 20"),r(t,"fill","currentColor")},m(e,i){o(e,t,i),w(t,n)},p(e,[n]){1&n&&r(t,"class",e[0])},i:_,o:_,d(e){e&&m(t)}}}function fs(e,t,n){let{design:i=""}=t;return e.$$set=e=>{"design"in e&&n(0,i=e.design)},[i]}class ms extends e{constructor(e){super(),t(this,e,fs,us,n,{design:0})}}function gs(e){let t,n;return{c(){t=re("svg"),n=re("path"),r(n,"fill-rule","evenodd"),r(n,"d","M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"),r(n,"clip-rule","evenodd"),r(t,"class",e[0]),r(t,"xmlns","http://www.w3.org/2000/svg"),r(t,"viewBox","0 0 20 20"),r(t,"fill","currentColor")},m(e,i){o(e,t,i),w(t,n)},p(e,[n]){1&n&&r(t,"class",e[0])},i:_,o:_,d(e){e&&m(t)}}}function ps(e,t,n){let{design:i=""}=t;return e.$$set=e=>{"design"in e&&n(0,i=e.design)},[i]}class vs extends e{constructor(e){super(),t(this,e,ps,gs,n,{design:0})}}function ws(e,t,n){const i=e.slice();return i[31]=t[n],i[32]=t,i[33]=n,i}function bs(e){let t,n,i,h,c,d,g,_,y,I,x,P,C=e[12](e[0]).name+"";const k=[ys,_s],T=[];function A(e,t){return e[8]?0:1}i=A(e),h=T[i]=k[i](e);let $=e[11]&&Ps(e),E=e[8]&&e[3]&&Ts(e);return{c(){t=s("div"),n=s("div"),h.c(),c=p(),$&&$.c(),d=p(),g=s("span"),_=v(C),y=p(),E&&E.c(),r(g,"class","flex-1 border rounded px-1"),Y(g,"background-color",e[4]?e[9]:"transparent"),Y(g,"border-color",e[4]?e[10]:"transparent"),r(n,"class","TreeItem__header flex items-center cursor-default hover:bg-gray-800 transition-colors mb-1"),r(t,"class","TreeItem"),a(t,"text-gray-500",!e[5])},m(s,r){o(s,t,r),w(t,n),T[i].m(n,null),w(n,c),$&&$.m(n,null),w(n,d),w(n,g),w(g,_),w(t,y),E&&E.m(t,null),e[19](t),I=!0,x||(P=l(g,"click",e[16]),x=!0)},p(e,s){let r=i;i=A(e),i===r?T[i].p(e,s):(X(),f(T[r],1,1,(()=>{T[r]=null})),F(),h=T[i],h?h.p(e,s):(h=T[i]=k[i](e),h.c()),u(h,1),h.m(n,c)),e[11]?$?($.p(e,s),2048&s[0]&&u($,1)):($=Ps(e),$.c(),u($,1),$.m(n,d)):$&&(X(),f($,1,1,(()=>{$=null})),F()),(!I||1&s[0])&&C!==(C=e[12](e[0]).name+"")&&b(_,C),(!I||528&s[0])&&Y(g,"background-color",e[4]?e[9]:"transparent"),(!I||1040&s[0])&&Y(g,"border-color",e[4]?e[10]:"transparent"),e[8]&&e[3]?E?(E.p(e,s),264&s[0]&&u(E,1)):(E=Ts(e),E.c(),u(E,1),E.m(t,null)):E&&(X(),f(E,1,1,(()=>{E=null})),F()),32&s[0]&&a(t,"text-gray-500",!e[5])},i(e){I||(u(h),u($),u(E),I=!0)},o(e){f(h),f($),f(E),I=!1},d(n){n&&m(t),T[i].d(),$&&$.d(),E&&E.d(),e[19](null),x=!1,P()}}}function _s(e){let t;return{c(){t=s("div"),r(t,"class","w-8 md:w-6")},m(e,n){o(e,t,n)},p:_,i:_,o:_,d(e){e&&m(t)}}}function ys(e){let t,n,i,a,h,c;const d=[xs,Is],g=[];function p(e,t){return e[3]?0:1}return n=p(e),i=g[n]=d[n](e),{c(){t=s("button"),i.c(),r(t,"class","cursor-default hover:bg-gray-700 rounded w-8 md:w-6")},m(i,s){o(i,t,s),g[n].m(t,null),a=!0,h||(c=l(t,"click",e[14]),h=!0)},p(e,s){let r=n;n=p(e),n!==r&&(X(),f(g[r],1,1,(()=>{g[r]=null})),F(),i=g[n],i||(i=g[n]=d[n](e),i.c()),u(i,1),i.m(t,null))},i(e){a||(u(i),a=!0)},o(e){f(i),a=!1},d(e){e&&m(t),g[n].d(),h=!1,c()}}}function Is(e){let t,n;return t=new vs({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function xs(e){let t,n;return t=new ms({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ps(e){let t,n,i,a,h,c;const d=[ks,Cs],g=[];function p(e,t){return e[5]?0:1}return n=p(e),i=g[n]=d[n](e),{c(){t=s("button"),i.c(),r(t,"class","cursor-default hover:bg-gray-700 rounded p-1 w-8 md:w-6")},m(i,s){o(i,t,s),g[n].m(t,null),a=!0,h||(c=l(t,"click",e[15]),h=!0)},p(e,s){let r=n;n=p(e),n!==r&&(X(),f(g[r],1,1,(()=>{g[r]=null})),F(),i=g[n],i||(i=g[n]=d[n](e),i.c()),u(i,1),i.m(t,null))},i(e){a||(u(i),a=!0)},o(e){f(i),a=!1},d(e){e&&m(t),g[n].d(),h=!1,c()}}}function Cs(e){let t,n;return t=new ds({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function ks(e){let t,n;return t=new ls({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Ts(e){let t,n,i=e[11]&&As(e);return{c(){t=s("div"),i&&i.c(),r(t,"class","TreeItem__body ml-4 pl-4 md:ml-3 md:pl-3 border-dotted border-l-2 md:border-l")},m(e,s){o(e,t,s),i&&i.m(t,null),n=!0},p(e,n){e[11]?i?(i.p(e,n),2048&n[0]&&u(i,1)):(i=As(e),i.c(),u(i,1),i.m(t,null)):i&&(X(),f(i,1,1,(()=>{i=null})),F())},i(e){n||(u(i),n=!0)},o(e){f(i),n=!1},d(e){e&&m(t),i&&i.d()}}}function As(e){let t,n,i=e[13](e[0]),s=[];for(let t=0;t<i.length;t+=1)s[t]=$s(ws(e,i,t));const r=e=>f(s[e],1,1,(()=>{s[e]=null}));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=x()},m(e,i){for(let t=0;t<s.length;t+=1)s[t].m(e,i);o(e,t,i),n=!0},p(e,n){if(8263&n[0]){let a;for(i=e[13](e[0]),a=0;a<i.length;a+=1){const r=ws(e,i,a);s[a]?(s[a].p(r,n),u(s[a],1)):(s[a]=$s(r),s[a].c(),u(s[a],1),s[a].m(t.parentNode,t))}for(X(),a=i.length;a<s.length;a+=1)r(a);F()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)u(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)f(s[e]);n=!1},d(e){he(s,e),e&&m(t)}}}function $s(e){let t,n,i=e[33];const s=()=>e[18](t,i),r=()=>e[18](null,i);let a={item:e[31],selectionManager:e[1],undoRedoManager:e[2]};return t=new Ms({props:a}),s(),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){i!==e[33]&&(r(),i=e[33],s());const a={};1&n[0]&&(a.item=e[31]),2&n[0]&&(a.selectionManager=e[1]),4&n[0]&&(a.undoRedoManager=e[2]),t.$set(a)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){r(),T(t,e)}}}function Es(e){let t,n,i=e[0]&&bs(e);return{c(){i&&i.c(),t=x()},m(e,s){i&&i.m(e,s),o(e,t,s),n=!0},p(e,n){e[0]?i?(i.p(e,n),1&n[0]&&u(i,1)):(i=bs(e),i.c(),u(i,1),i.m(t.parentNode,t)):i&&(X(),f(i,1,1,(()=>{i=null})),F())},i(e){n||(u(i),n=!0)},o(e){f(i),n=!1},d(e){i&&i.d(e),e&&m(t)}}}function Ss(e,t,n){let{item:i}=t,{selectionManager:s=null}=t,{undoRedoManager:r=null}=t;const a=e=>e instanceof we&&1==e.getNumChildren()&&(e.getChild(0)instanceof pe||e.getChild(0)instanceof ve);let o,l,h=!1,c=!1,d=!1,u=[];function f(e){if(e.length>1){let t,n=-1;if(a(i)?(n=i.getChild(0).getChildIndex(e[2]),t=e.slice(2)):(n=i.getChildIndex(e[1]),t=e.slice(1)),-1!=n){const e=u[n];e&&e.expandTree(t)}}}let m,g,p,v,w,b,_,y=!1;const I=()=>{if(i&&"isHighlighted"in i&&(n(4,c=i.isHighlighted()),c&&"getHighlight"in i)){const e=i.getHighlight(),t=e.lerp(new Te(.75,.75,.75,0),.5);n(10,g=e.toHex()),n(9,m=`${t.toHex()}60`)}},x=()=>{p&&n(5,d=i.isVisible())},C=()=>{n(0,i)};return H((()=>{i&&(n(0,i.elemRef=l,i),n(11,p=i instanceof Oe),I(),x(),p&&(v>-1&&i.off("childAdded",C),v=i.on("childAdded",C),w>-1&&(w=i.off("childRemoved",C)),w=i.on("childRemoved",C),_>-1&&i.off("visibilityChanged",x),_=i.on("visibilityChanged",x),n(8,y=i.getNumChildren()>0)),b>-1&&i.off("highlightChanged",I),b=i.on("highlightChanged",I))})),se((()=>{o&&(f(o),o=null)})),e.$$set=e=>{"item"in e&&n(0,i=e.item),"selectionManager"in e&&n(1,s=e.selectionManager),"undoRedoManager"in e&&n(2,r=e.undoRedoManager)},[i,s,r,h,c,d,u,l,y,m,g,p,e=>{let t;const n=e.getParameter("DisplayName");if(t=n?n.getValue():e.getName(),a(e)){const n=e.getChild(0);if(""==t){const e=n.getParameter("DisplayName");t=e?e.getValue():n.getName()}return{name:t+` (Instance of ${n.getClassName()})`,tooltip:`(Instance of ${n.getClassName()})`}}return{name:t+` (${e.getClassName()})`,tooltip:`(${e.getClassName()})`}},e=>{if(e instanceof we&&1==e.getNumChildren()){return e.getChild(0).getChildren()}return e.getChildren()},()=>{n(3,h=!h)},()=>{const e=i.getParameter("Visible");if(n(5,d=!e.getValue()),r){const t=new je.ParameterValueChange(e,d);r.addChange(t)}else e.setValue(d)},e=>{if(!s)return void i.setSelected(!i.getSelected());if(s.pickingModeActive())return void s.pick(i);s.toggleItemSelection(i,!e.ctrlKey);const t=s.getSelection();i.setSelected(t.has(i))},function(e){e[e.length-1]!=i?(n(3,h=!0),u.length>0?f(e):o=e):l.scrollIntoView({behavior:"auto",block:"center",inline:"center"})},function(e,t){P[e?"unshift":"push"]((()=>{u[t]=e,n(6,u)}))},function(e){P[e?"unshift":"push"]((()=>{l=e,n(7,l)}))}]}class Ms extends e{constructor(e){super(),t(this,e,Ss,Es,n,{item:0,selectionManager:1,undoRedoManager:2,expandTree:17},null,[-1,-1])}get expandTree(){return this.$$.ctx[17]}}function Rs(e,t,n){const i=e.slice();return i[12]=t[n],i[13]=t,i[14]=n,i}function Ds(e){let t,n,i=e[14];const s=()=>e[8](t,i),r=()=>e[8](null,i);let a={item:e[12],selectionManager:e[1],undoRedoManager:e[2]};return t=new Ms({props:a}),s(),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){i!==e[14]&&(r(),i=e[14],s());const a={};1&n&&(a.item=e[12]),2&n&&(a.selectionManager=e[1]),4&n&&(a.undoRedoManager=e[2]),t.$set(a)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){r(),T(t,e)}}}function Os(e){let t,n,i=e[0],a=[];for(let t=0;t<i.length;t+=1)a[t]=Ds(Rs(e,i,t));const l=e=>f(a[e],1,1,(()=>{a[e]=null}));return{c(){t=s("div");for(let e=0;e<a.length;e+=1)a[e].c();r(t,"class","TreeView min-w-max noselect")},m(i,s){o(i,t,s);for(let e=0;e<a.length;e+=1)a[e].m(t,null);e[9](t),n=!0},p(e,[n]){if(23&n){let s;for(i=e[0],s=0;s<i.length;s+=1){const r=Rs(e,i,s);a[s]?(a[s].p(r,n),u(a[s],1)):(a[s]=Ds(r),a[s].c(),u(a[s],1),a[s].m(t,null))}for(X(),s=i.length;s<a.length;s+=1)l(s);F()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)u(a[e]);n=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)f(a[e]);n=!1},d(n){n&&m(t),he(a,n),e[9](null)}}}function Ns(e,t,n){let i,{rootTreeItems:s}=t,{selectionManager:r=null}=t,{undoRedoManager:a=null}=t,{isMouseOver:o=null}=t,l=[],{onKeyDownRegistered:h=!1}=t,{selectionChangedRegistered:c=!1}=t;const d=e=>{if(o&&r){if("ArrowLeft"==e.key){const t=r.getSelection(),n=new Set;return Array.from(t).forEach((e=>{s.includes(e)||n.add(e.getOwner())})),n.size>0&&r.setSelection(n),e.preventDefault(),void e.stopPropagation()}if("ArrowRight"==e.key){const t=r.getSelection(),n=new Set;return Array.from(t).forEach((e=>{e instanceof Oe&&e.getNumChildren()>0&&!(e instanceof _e)&&n.add(e.getChild(0))})),n.size>0&&r.setSelection(n),e.preventDefault(),void e.stopPropagation()}if("ArrowUp"==e.key){const t=r.getSelection(),n=new Set;return Array.from(t).forEach((e=>{const t=e.getOwner().getChildIndex(e);0==t?n.add(e.getOwner()):n.add(e.getOwner().getChild(t-1))})),n.size>0&&r.setSelection(n),e.preventDefault(),void e.stopPropagation()}if("ArrowDown"==e.key){const t=r.getSelection(),n=new Set;return Array.from(t).forEach((e=>{const t=e.getOwner().getChildIndex(e);if(t<e.getOwner().getNumChildren()-1)n.add(e.getOwner().getChild(t+1));else{const t=e.getOwner().getChildIndex(e);e.getOwner().getNumChildren()>t+1&&n.add(e.getOwner().getChild(t+1))}})),n.size>0&&r.setSelection(n),e.preventDefault(),void e.stopPropagation()}}};h||(document.addEventListener("keydown",d),h=!0),H((()=>{r&&!c&&(r.on("leadSelectionChanged",(()=>{const e=r.getSelection();u(e,!0)})),n(6,c=!0))}));const u=(e,t=!0)=>{Array.from(e).forEach((e=>{const n=[];for(;n.splice(0,0,e),!s.includes(e)&&e;)e=e.getOwner();s.forEach(((e,i)=>{if(e!=n[0])return;l[i].expandTree(n,t)}))}))};return e.$$set=e=>{"rootTreeItems"in e&&n(0,s=e.rootTreeItems),"selectionManager"in e&&n(1,r=e.selectionManager),"undoRedoManager"in e&&n(2,a=e.undoRedoManager),"isMouseOver"in e&&n(7,o=e.isMouseOver),"onKeyDownRegistered"in e&&n(5,h=e.onKeyDownRegistered),"selectionChangedRegistered"in e&&n(6,c=e.selectionChangedRegistered)},[s,r,a,i,l,h,c,o,function(e,t){P[e?"unshift":"push"]((()=>{l[t]=e,n(4,l)}))},function(e){P[e?"unshift":"push"]((()=>{i=e,n(3,i)}))}]}class zs extends e{constructor(e){super(),t(this,e,Ns,Os,n,{rootTreeItems:0,selectionManager:1,undoRedoManager:2,isMouseOver:7,onKeyDownRegistered:5,selectionChangedRegistered:6})}}const Ls=$(),Vs=$();function Bs(e){let t,n,i,h,c,d,g,v,b,_,I,x,A;function $(t){e[9](t)}let E={tabs:e[5]};return void 0!==e[0]&&(E.selectedTab=e[0]),n=new rs({props:E}),P.push((()=>K(n,"selectedTab",$))),g=new zs({props:{rootTreeItems:e[2],isMouseOver:e[1],selectionManager:e[3],undoRedoManager:e[4]&&e[4].undoRedoManager}}),_=new es({}),{c(){t=s("div"),C(n.$$.fragment),h=p(),c=s("div"),d=s("div"),C(g.$$.fragment),v=p(),b=s("div"),C(_.$$.fragment),r(d,"class","h-full"),a(d,"hidden",e[0]!==e[5][0]),a(b,"hidden",e[0]!==e[5][1]),r(c,"class","flex-1 overflow-auto"),r(t,"class","Sidebar h-full w-full flex flex-col")},m(i,s){o(i,t,s),k(n,t,null),w(t,h),w(t,c),w(c,d),k(g,d,null),w(c,v),w(c,b),k(_,b,null),I=!0,x||(A=[l(d,"mouseenter",e[6]),l(d,"mouseleave",e[7])],x=!0)},p(e,[t]){const s={};!i&&1&t&&(i=!0,s.selectedTab=e[0],W((()=>i=!1))),n.$set(s);const r={};4&t&&(r.rootTreeItems=e[2]),2&t&&(r.isMouseOver=e[1]),8&t&&(r.selectionManager=e[3]),16&t&&(r.undoRedoManager=e[4]&&e[4].undoRedoManager),g.$set(r),33&t&&a(d,"hidden",e[0]!==e[5][0]),33&t&&a(b,"hidden",e[0]!==e[5][1])},i(e){I||(u(n.$$.fragment,e),u(g.$$.fragment,e),u(_.$$.fragment,e),I=!0)},o(e){f(n.$$.fragment,e),f(g.$$.fragment,e),f(_.$$.fragment,e),I=!1},d(e){e&&m(t),T(n),T(g),T(_),x=!1,y(A)}}}function Us(e,t,n){let i,s,r,a;E(e,Ls,(e=>n(8,s=e))),E(e,Vs,(e=>n(3,r=e))),E(e,Xt,(e=>n(4,a=e)));let o,l;return e.$$.update=()=>{256&e.$$.dirty&&n(2,i=[s])},[o,l,i,r,a,["Assembly","Search"],()=>{n(1,l=!0)},()=>{n(1,l=!1)},s,function(e){o=e,n(0,o)}]}class Xs extends e{constructor(e){super(),t(this,e,Us,Bs,n,{})}}function Fs(e){let t;return{c(){t=s("div"),t.innerHTML='<div class="m-auto"><div class="flex flex-col items-center justify-center space-y-2"><i class="fas fa-cloud-upload-alt fa-3x text-currentColor"></i> \n          <p class="text-center text-gray-700">Drag your gltf or zcad files here or click in this area.</p></div></div>',r(t,"class","items-center justify-center w-3/12 p-4 py-12 m-auto text-black bg-gray-200 border-2 border-gray-400 rounded-lg h-1/3 bg-opacity-25 hover:bg-blue-200 hover:bg-opacity-25 grid justify-items-center")},m(e,n){o(e,t,n)},d(e){e&&m(t)}}}function Gs(e){let t,n,i,h,c,d=!e[0]&&Fs();return{c(){t=s("div"),n=s("input"),i=p(),d&&d.c(),r(n,"accept",".zcad, .gltf, .glb"),n.multiple=!0,r(n,"type","file"),r(n,"class","absolute inset-0 z-50 w-full h-full p-0 m-0 outline-none opacity-0"),r(t,"class","DropZone absolute inset-0 flex"),a(t,"pointer-events-none",e[1])},m(s,r){o(s,t,r),w(t,n),w(t,i),d&&d.m(t,null),h||(c=[l(n,"drop",le(e[2])),l(n,"change",e[4])],h=!0)},p(e,[n]){e[0]?d&&(d.d(1),d=null):d||(d=Fs(),d.c(),d.m(t,null)),2&n&&a(t,"pointer-events-none",e[1])},i:_,o:_,d(e){e&&m(t),d&&d.d(),h=!1,y(c)}}}function Hs(e,t,n){const i=A();let{fileLoaded:s}=t,r=!1;const a=e=>{i("changeFile",{files:e})},o=()=>{s&&n(1,r=!1)};document.body.addEventListener("dragover",o),document.body.addEventListener("dragenter",o);const l=e=>{const t=[];for(var i=0;i<e.target.files.length;i++)t.push(e.target.files[i]);a(t),n(0,s=!0),n(1,r=!0)};return e.$$set=e=>{"fileLoaded"in e&&n(0,s=e.fileLoaded)},[s,r,e=>{const t=[];for(var i=0;i<e.dataTransfer.items.length;i++)"file"===e.dataTransfer.items[i].kind&&t.push(e.dataTransfer.items[i].getAsFile());a(t),n(0,s=!0),n(1,r=!0)},l,e=>{l(e)}]}class js extends e{constructor(e){super(),t(this,e,Hs,Gs,n,{fileLoaded:0})}}const Zs=()=>new class extends Ne{constructor(){super(),console.log("iframe ChannelMessenger");let e=!1,t=!1;window.addEventListener("message",(i=>{if("ping"==i.data)e||t||(e=!0,i.source.postMessage("ping","*"));else if("initPort"==i.data){if(console.log("=====initPort========="),t=!0,this.port2=i.ports[0],!this.port2)return;this.port2.onmessage=n,this.port2.postMessage("ready")}}));const n=e=>{if(console.info("Message received by IFrame:"),console.info(e.data),!Array.isArray(e.data)||2!=e.data.length)throw new Error(`Invalid message: ${e.data}`);const t=e.data[0],n=e.data[1];this.emit(t,n)}}send(e,t){this.port2&&this.port2.postMessage([e,t])}},Js=e=>{const t=(e,n,i)=>{const s=[...i,e.getName()],r={name:e.getName()};if(["Revision","Rev","InstanceName"].forEach((t=>{e.hasParameter(t)&&(r[t]=e.getParameter(t).getValue())})),e instanceof ve)return r;if(e.getNumChildren()>0){const i=e.getChildren();r.children=[];for(const e of i)e&&r.children.push(t(e,n+1,s))}return r};return t(e,1,[])};function Ks(e){let t,n,i;return{c(){t=s("input"),r(t,"type","range"),r(t,"min","0"),r(t,"max","1000"),r(t,"class","svelte-1ynbs2x")},m(s,r){o(s,t,r),oe(t,e[0]),n||(i=[l(t,"change",e[1]),l(t,"input",e[1])],n=!0)},p(e,[n]){1&n&&oe(t,e[0])},i:_,o:_,d(e){e&&m(t),n=!1,y(i)}}}function Ws(e,t,n){let i;E(e,Yi,(e=>n(7,i=e)));let s=0,r=!1,a=new ze,o=new ke,l=new Le,h=new Map;I((async()=>{console.log("Asm Explode onMount called;"),c(),r=!0}));const c=()=>{new ke,new ke;const e=i.getRoot(),t=e.boundingBoxParam.value;let n=t.center();t.size(),a.sc=t.diagonal();let s=Number.MAX_SAFE_INTEGER;e.traverse((e=>{if(e instanceof ve){if("M10X25g"==e.getName())return;const t=e.boundingBoxParam.value.center();l.addPoint(t);let i=t.distanceTo(n);i<s&&(s=i,o=t);let r=e.globalXfoParam.value;h.set(e,{gXfo:r,center:t})}})),a.sc=l.diagonal().normalize(),a.sc.x>.8&&(a.sc.x=.1),a.sc.y>.8&&(a.sc.y=.1),a.sc.z>.8&&(a.sc.z=.1)};return e.$$.update=()=>{var t;1&e.$$.dirty&&(t=s,r&&i.getRoot().traverse((e=>{if(e instanceof ve){if("M10X25g"==e.getName())return;const n=h.get(e);let i=n.center.subtract(o);i=a.transformVec3(i);let s=t;i.scaleInPlace(s*s/1e5);let r=new ze;r.setFromOther(n.gXfo),r.tr=n.gXfo.tr.add(i),e.globalXfoParam.value=r}})))},[s,function(){s=ce(this.value),n(0,s)}]}class Ys extends e{constructor(e){super(),t(this,e,Ws,Ks,n,{})}}var qs=fe((function(e){function t(e){var t,n,i,s,r,a=Math.floor,o=new Array(64),l=new Array(64),h=new Array(64),c=new Array(64),d=new Array(65535),u=new Array(65535),f=new Array(64),m=new Array(64),g=[],p=0,v=7,w=new Array(64),b=new Array(64),_=new Array(64),y=new Array(256),I=new Array(2048),x=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],P=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],T=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],S=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function M(e,t){for(var n=0,i=0,s=new Array,r=1;r<=16;r++){for(var a=1;a<=e[r];a++)s[t[i]]=[],s[t[i]][0]=n,s[t[i]][1]=r,i++,n++;n*=2}return s}function R(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(p|=1<<v),n--,--v<0&&(255==p?(D(255),D(0)):D(p),v=7,p=0)}function D(e){g.push(e)}function O(e){D(e>>8&255),D(255&e)}function N(e,t,n,i,s){for(var r,a=s[0],o=s[240],l=function(e,t){var n,i,s,r,a,o,l,h,c,d,u=0;for(c=0;c<8;++c){n=e[u],i=e[u+1],s=e[u+2],r=e[u+3],a=e[u+4],o=e[u+5],l=e[u+6];var m=n+(h=e[u+7]),g=n-h,p=i+l,v=i-l,w=s+o,b=s-o,_=r+a,y=r-a,I=m+_,x=m-_,P=p+w,C=p-w;e[u]=I+P,e[u+4]=I-P;var k=.707106781*(C+x);e[u+2]=x+k,e[u+6]=x-k;var T=.382683433*((I=y+b)-(C=v+g)),A=.5411961*I+T,$=1.306562965*C+T,E=.707106781*(P=b+v),S=g+E,M=g-E;e[u+5]=M+A,e[u+3]=M-A,e[u+1]=S+$,e[u+7]=S-$,u+=8}for(u=0,c=0;c<8;++c){n=e[u],i=e[u+8],s=e[u+16],r=e[u+24],a=e[u+32],o=e[u+40],l=e[u+48];var R=n+(h=e[u+56]),D=n-h,O=i+l,N=i-l,z=s+o,L=s-o,V=r+a,B=r-a,U=R+V,X=R-V,F=O+z,G=O-z;e[u]=U+F,e[u+32]=U-F;var H=.707106781*(G+X);e[u+16]=X+H,e[u+48]=X-H;var j=.382683433*((U=B+L)-(G=N+D)),Z=.5411961*U+j,J=1.306562965*G+j,K=.707106781*(F=L+N),W=D+K,Y=D-K;e[u+40]=Y+Z,e[u+24]=Y-Z,e[u+8]=W+J,e[u+56]=W-J,u++}for(c=0;c<64;++c)d=e[c]*t[c],f[c]=d>0?d+.5|0:d-.5|0;return f}(e,t),h=0;h<64;++h)m[x[h]]=l[h];var c=m[0]-n;n=m[0],0==c?R(i[0]):(R(i[u[r=32767+c]]),R(d[r]));for(var g=63;g>0&&0==m[g];g--);if(0==g)return R(a),n;for(var p,v=1;v<=g;){for(var w=v;0==m[v]&&v<=g;++v);var b=v-w;if(b>=16){p=b>>4;for(var _=1;_<=p;++_)R(o);b&=15}r=32767+m[v],R(s[(b<<4)+u[r]]),R(d[r]),v++}return 63!=g&&R(a),n}function z(e){if(e<=0&&(e=1),e>100&&(e=100),r!=e){(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var i=a((t[n]*e+50)/100);i<1?i=1:i>255&&(i=255),o[x[n]]=i}for(var s=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],r=0;r<64;r++){var d=a((s[r]*e+50)/100);d<1?d=1:d>255&&(d=255),l[x[r]]=d}for(var u=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,m=0;m<8;m++)for(var g=0;g<8;g++)h[f]=1/(o[x[f]]*u[m]*u[g]*8),c[f]=1/(l[x[f]]*u[m]*u[g]*8),f++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),r=e}}this.encode=function(e,r){(new Date).getTime(),r&&z(r),g=new Array,p=0,v=7,O(65496),O(65504),O(16),D(74),D(70),D(73),D(70),D(0),D(1),D(1),D(0),O(1),O(1),D(0),D(0),function(e){if(e){O(65505),69===e[0]&&120===e[1]&&105===e[2]&&102===e[3]?O(e.length+2):(O(e.length+5+2),D(69),D(120),D(105),D(102),D(0));for(var t=0;t<e.length;t++)D(e[t])}}(e.exifBuffer),function(){O(65499),O(132),D(0);for(var e=0;e<64;e++)D(o[e]);D(1);for(var t=0;t<64;t++)D(l[t])}(),function(e,t){O(65472),O(17),D(8),O(t),O(e),D(3),D(1),D(17),D(0),D(2),D(17),D(1),D(3),D(17),D(1)}(e.width,e.height),function(){O(65476),O(418),D(0);for(var e=0;e<16;e++)D(P[e+1]);for(var t=0;t<=11;t++)D(C[t]);D(16);for(var n=0;n<16;n++)D(k[n+1]);for(var i=0;i<=161;i++)D(T[i]);D(1);for(var s=0;s<16;s++)D(A[s+1]);for(var r=0;r<=11;r++)D($[r]);D(17);for(var a=0;a<16;a++)D(E[a+1]);for(var o=0;o<=161;o++)D(S[o])}(),O(65498),O(12),D(3),D(1),D(0),D(2),D(17),D(3),D(17),D(0),D(63),D(0);var a=0,d=0,u=0;p=0,v=7,this.encode.displayName="_encode_";for(var f,m,y,x,M,L,V,B,U,X=e.data,F=e.width,G=e.height,H=4*F,j=0;j<G;){for(f=0;f<H;){for(L=M=H*j+f,V=-1,B=0,U=0;U<64;U++)L=M+(B=U>>3)*H+(V=4*(7&U)),j+B>=G&&(L-=H*(j+1+B-G)),f+V>=H&&(L-=f+V-H+4),m=X[L++],y=X[L++],x=X[L++],w[U]=(I[m]+I[y+256>>0]+I[x+512>>0]>>16)-128,b[U]=(I[m+768>>0]+I[y+1024>>0]+I[x+1280>>0]>>16)-128,_[U]=(I[m+1280>>0]+I[y+1536>>0]+I[x+1792>>0]>>16)-128;a=N(w,h,a,t,i),d=N(b,c,d,n,s),u=N(_,c,u,n,s),f+=32}j+=8}if(v>=0){var Z=[];Z[1]=v+1,Z[0]=(1<<v+1)-1,R(Z)}return O(65497),Buffer.from(g)},(new Date).getTime(),e||(e=50),function(){for(var e=String.fromCharCode,t=0;t<256;t++)y[t]=e(t)}(),t=M(P,C),n=M(A,$),i=M(k,T),s=M(E,S),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var i=e;i<t;i++)u[32767+i]=n,d[32767+i]=[],d[32767+i][1]=n,d[32767+i][0]=i;for(var s=-(t-1);s<=-e;s++)u[32767+s]=n,d[32767+s]=[],d[32767+s][1]=n,d[32767+s][0]=t-1+s;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)I[e]=19595*e,I[e+256>>0]=38470*e,I[e+512>>0]=7471*e+32768,I[e+768>>0]=-11059*e,I[e+1024>>0]=-21709*e,I[e+1280>>0]=32768*e+8421375,I[e+1536>>0]=-27439*e,I[e+1792>>0]=-5329*e}(),z(e),(new Date).getTime()}e.exports=function(e,n){void 0===n&&(n=50);return{data:new t(n).encode(e,n),width:e.width,height:e.height}}})),Qs=fe((function(e){var t=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,i=3406,s=2276,r=1567,a=3784,o=5793,l=2896;function h(){}function c(e,t){for(var n,i,s=0,r=[],a=16;a>0&&!e[a-1];)a--;r.push({children:[],index:0});var o,l=r[0];for(n=0;n<a;n++){for(i=0;i<e[n];i++){for((l=r.pop()).children[l.index]=t[s];l.index>0;){if(0===r.length)throw new Error("Could not recreate Huffman Table");l=r.pop()}for(l.index++,r.push(l);r.length<=n;)r.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;s++}n+1<a&&(r.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return r[0].children}function d(t,n,i,s,r,a,o,l,h,c){i.precision,i.samplesPerLine,i.scanLines;var d=i.mcusPerLine,u=i.progressive;i.maxH,i.maxV;var f=n,m=0,g=0;function p(){if(g>0)return g--,m>>g&1;if(255==(m=t[n++])){var e=t[n++];if(e)throw new Error("unexpected marker: "+(m<<8|e).toString(16))}return g=7,m>>>7}function v(e){for(var t,n=e;null!==(t=p());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw new Error("invalid huffman sequence")}return null}function w(e){for(var t=0;e>0;){var n=p();if(null===n)return;t=t<<1|n,e--}return t}function b(e){var t=w(e);return t>=1<<e-1?t:t+(-1<<e)+1}var _=0;var y,I=0;function x(e,t,n,i,s){var r=n%d,a=(n/d|0)*e.v+i,o=r*e.h+s;void 0===e.blocks[a]&&c.tolerantDecoding||t(e,e.blocks[a][o])}function P(e,t,n){var i=n/e.blocksPerLine|0,s=n%e.blocksPerLine;void 0===e.blocks[i]&&c.tolerantDecoding||t(e,e.blocks[i][s])}var C,k,T,A,$,E,S=s.length;E=u?0===a?0===l?function(e,t){var n=v(e.huffmanTableDC),i=0===n?0:b(n)<<h;t[0]=e.pred+=i}:function(e,t){t[0]|=p()<<h}:0===l?function(t,n){if(_>0)_--;else for(var i=a,s=o;i<=s;){var r=v(t.huffmanTableAC),l=15&r,c=r>>4;if(0!==l)n[e[i+=c]]=b(l)*(1<<h),i++;else{if(c<15){_=w(c)+(1<<c)-1;break}i+=16}}}:function(t,n){for(var i=a,s=o,r=0;i<=s;){var l=e[i],c=n[l]<0?-1:1;switch(I){case 0:var d=v(t.huffmanTableAC),u=15&d;if(r=d>>4,0===u)r<15?(_=w(r)+(1<<r),I=4):(r=16,I=1);else{if(1!==u)throw new Error("invalid ACn encoding");y=b(u),I=r?2:3}continue;case 1:case 2:n[l]?n[l]+=(p()<<h)*c:0==--r&&(I=2==I?3:0);break;case 3:n[l]?n[l]+=(p()<<h)*c:(n[l]=y<<h,I=0);break;case 4:n[l]&&(n[l]+=(p()<<h)*c)}i++}4===I&&0==--_&&(I=0)}:function(t,n){var i=v(t.huffmanTableDC),s=0===i?0:b(i);n[0]=t.pred+=s;for(var r=1;r<64;){var a=v(t.huffmanTableAC),o=15&a,l=a>>4;if(0!==o)n[e[r+=l]]=b(o),r++;else{if(l<15)break;r+=16}}};var M,R,D,O,N=0;for(R=1==S?s[0].blocksPerLine*s[0].blocksPerColumn:d*i.mcusPerColumn,r||(r=R);N<R;){for(k=0;k<S;k++)s[k].pred=0;if(_=0,1==S)for(C=s[0],$=0;$<r;$++)P(C,E,N),N++;else for($=0;$<r;$++){for(k=0;k<S;k++)for(D=(C=s[k]).h,O=C.v,T=0;T<O;T++)for(A=0;A<D;A++)x(C,E,N,T,A);if(++N===R)break}if(N===R)do{if(255===t[n]&&0!==t[n+1])break;n+=1}while(n<t.length-2);if(g=0,(M=t[n]<<8|t[n+1])<65280)throw new Error("marker was not found");if(!(M>=65488&&M<=65495))break;n+=2}return n-f}function u(e,h){var c,d,u=[],f=h.blocksPerLine,m=h.blocksPerColumn,g=f<<3,v=new Int32Array(64),w=new Uint8Array(64);function b(e,c,d){var u,f,m,g,p,v,w,b,_,y,I=h.quantizationTable,x=d;for(y=0;y<64;y++)x[y]=e[y]*I[y];for(y=0;y<8;++y){var P=8*y;0!=x[1+P]||0!=x[2+P]||0!=x[3+P]||0!=x[4+P]||0!=x[5+P]||0!=x[6+P]||0!=x[7+P]?(u=o*x[0+P]+128>>8,f=o*x[4+P]+128>>8,m=x[2+P],g=x[6+P],p=l*(x[1+P]-x[7+P])+128>>8,b=l*(x[1+P]+x[7+P])+128>>8,v=x[3+P]<<4,w=x[5+P]<<4,_=u-f+1>>1,u=u+f+1>>1,f=_,_=m*a+g*r+128>>8,m=m*r-g*a+128>>8,g=_,_=p-w+1>>1,p=p+w+1>>1,w=_,_=b+v+1>>1,v=b-v+1>>1,b=_,_=u-g+1>>1,u=u+g+1>>1,g=_,_=f-m+1>>1,f=f+m+1>>1,m=_,_=p*s+b*i+2048>>12,p=p*i-b*s+2048>>12,b=_,_=v*n+w*t+2048>>12,v=v*t-w*n+2048>>12,w=_,x[0+P]=u+b,x[7+P]=u-b,x[1+P]=f+w,x[6+P]=f-w,x[2+P]=m+v,x[5+P]=m-v,x[3+P]=g+p,x[4+P]=g-p):(_=o*x[0+P]+512>>10,x[0+P]=_,x[1+P]=_,x[2+P]=_,x[3+P]=_,x[4+P]=_,x[5+P]=_,x[6+P]=_,x[7+P]=_)}for(y=0;y<8;++y){var C=y;0!=x[8+C]||0!=x[16+C]||0!=x[24+C]||0!=x[32+C]||0!=x[40+C]||0!=x[48+C]||0!=x[56+C]?(u=o*x[0+C]+2048>>12,f=o*x[32+C]+2048>>12,m=x[16+C],g=x[48+C],p=l*(x[8+C]-x[56+C])+2048>>12,b=l*(x[8+C]+x[56+C])+2048>>12,v=x[24+C],w=x[40+C],_=u-f+1>>1,u=u+f+1>>1,f=_,_=m*a+g*r+2048>>12,m=m*r-g*a+2048>>12,g=_,_=p-w+1>>1,p=p+w+1>>1,w=_,_=b+v+1>>1,v=b-v+1>>1,b=_,_=u-g+1>>1,u=u+g+1>>1,g=_,_=f-m+1>>1,f=f+m+1>>1,m=_,_=p*s+b*i+2048>>12,p=p*i-b*s+2048>>12,b=_,_=v*n+w*t+2048>>12,v=v*t-w*n+2048>>12,w=_,x[0+C]=u+b,x[56+C]=u-b,x[8+C]=f+w,x[48+C]=f-w,x[16+C]=m+v,x[40+C]=m-v,x[24+C]=g+p,x[32+C]=g-p):(_=o*d[y+0]+8192>>14,x[0+C]=_,x[8+C]=_,x[16+C]=_,x[24+C]=_,x[32+C]=_,x[40+C]=_,x[48+C]=_,x[56+C]=_)}for(y=0;y<64;++y){var k=128+(x[y]+8>>4);c[y]=k<0?0:k>255?255:k}}p(g*m*8);for(var _=0;_<m;_++){var y=_<<3;for(c=0;c<8;c++)u.push(new Uint8Array(g));for(var I=0;I<f;I++){b(h.blocks[_][I],w,v);var x=0,P=I<<3;for(d=0;d<8;d++){var C=u[y+d];for(c=0;c<8;c++)C[P+c]=w[x++]}}}return u}function f(e){return e<0?0:e>255?255:e}h.prototype={load:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(t.response||t.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),t.send(null)},parse:function(t){var n=1e3*this.opts.maxResolutionInMP*1e3,i=0;function s(){var e=t[i]<<8|t[i+1];return i+=2,e}function r(e){var t,n,i=0,s=0;for(n in e.components)e.components.hasOwnProperty(n)&&(i<(t=e.components[n]).h&&(i=t.h),s<t.v&&(s=t.v));var r=Math.ceil(e.samplesPerLine/8/i),a=Math.ceil(e.scanLines/8/s);for(n in e.components)if(e.components.hasOwnProperty(n)){t=e.components[n];var o=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/i),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/s),h=r*t.h,c=a*t.v,d=[];p(256*(c*h));for(var u=0;u<c;u++){for(var f=[],m=0;m<h;m++)f.push(new Int32Array(64));d.push(f)}t.blocksPerLine=o,t.blocksPerColumn=l,t.blocks=d}e.maxH=i,e.maxV=s,e.mcusPerLine=r,e.mcusPerColumn=a}t.length;var a,o,l,h,f=null,m=null,g=[],v=[],w=[],b=[],_=s(),y=-1;if(this.comments=[],65496!=_)throw new Error("SOI not found");for(_=s();65497!=_;){switch(_){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var I=(l=void 0,h=void 0,l=s(),h=t.subarray(i,i+l-2),i+=h.length,h);if(65534===_){var x=String.fromCharCode.apply(null,I);this.comments.push(x)}65504===_&&74===I[0]&&70===I[1]&&73===I[2]&&70===I[3]&&0===I[4]&&(f={version:{major:I[5],minor:I[6]},densityUnits:I[7],xDensity:I[8]<<8|I[9],yDensity:I[10]<<8|I[11],thumbWidth:I[12],thumbHeight:I[13],thumbData:I.subarray(14,14+3*I[12]*I[13])}),65505===_&&69===I[0]&&120===I[1]&&105===I[2]&&102===I[3]&&0===I[4]&&(this.exifBuffer=I.subarray(5,I.length)),65518===_&&65===I[0]&&100===I[1]&&111===I[2]&&98===I[3]&&101===I[4]&&0===I[5]&&(m={version:I[6],flags0:I[7]<<8|I[8],flags1:I[9]<<8|I[10],transformCode:I[11]});break;case 65499:for(var P=s()+i-2;i<P;){var C=t[i++];p(256);var k=new Int32Array(64);if(C>>4==0)for(J=0;J<64;J++){k[e[J]]=t[i++]}else{if(C>>4!=1)throw new Error("DQT: invalid table spec");for(J=0;J<64;J++){k[e[J]]=s()}}g[15&C]=k}break;case 65472:case 65473:case 65474:s(),(a={}).extended=65473===_,a.progressive=65474===_,a.precision=t[i++],a.scanLines=s(),a.samplesPerLine=s(),a.components={},a.componentsOrder=[];var T=a.scanLines*a.samplesPerLine;if(T>n){var A=Math.ceil((T-n)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${A}MP`)}var $,E=t[i++];for(j=0;j<E;j++){$=t[i];var S=t[i+1]>>4,M=15&t[i+1],R=t[i+2];a.componentsOrder.push($),a.components[$]={h:S,v:M,quantizationIdx:R},i+=3}r(a),v.push(a);break;case 65476:var D=s();for(j=2;j<D;){var O=t[i++],N=new Uint8Array(16),z=0;for(J=0;J<16;J++,i++)z+=N[J]=t[i];p(16+z);var L=new Uint8Array(z);for(J=0;J<z;J++,i++)L[J]=t[i];j+=17+z,(O>>4==0?b:w)[15&O]=c(N,L)}break;case 65501:s(),o=s();break;case 65500:s(),s();break;case 65498:s();var V=t[i++],B=[];for(j=0;j<V;j++){K=a.components[t[i++]];var U=t[i++];K.huffmanTableDC=b[U>>4],K.huffmanTableAC=w[15&U],B.push(K)}var X=t[i++],F=t[i++],G=t[i++],H=d(t,i,a,B,o,X,F,G>>4,15&G,this.opts);i+=H;break;case 65535:255!==t[i]&&i--;break;default:if(255==t[i-3]&&t[i-2]>=192&&t[i-2]<=254){i-=3;break}if(224===_||225==_){if(-1!==y)throw new Error(`first unknown JPEG marker at offset ${y.toString(16)}, second unknown JPEG marker ${_.toString(16)} at offset ${(i-1).toString(16)}`);y=i-1;const e=s();if(255===t[i+e-2]){i+=e-2;break}}throw new Error("unknown JPEG marker "+_.toString(16))}_=s()}if(1!=v.length)throw new Error("only single frame JPEGs supported");for(var j=0;j<v.length;j++){var Z=v[j].components;for(var J in Z)Z[J].quantizationTable=g[Z[J].quantizationIdx],delete Z[J].quantizationIdx}this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=f,this.adobe=m,this.components=[];for(j=0;j<a.componentsOrder.length;j++){var K=a.components[a.componentsOrder[j]];this.components.push({lines:u(0,K),scaleX:K.h/a.maxH,scaleY:K.v/a.maxV})}},getData:function(e,t){var n,i,s,r,a,o,l,h,c,d,u,m,g,v,w,b,_,y,I,x,P,C=this.width/e,k=this.height/t,T=0,A=e*t*this.components.length;p(A);var $=new Uint8Array(A);switch(this.components.length){case 1:for(n=this.components[0],d=0;d<t;d++)for(a=n.lines[0|d*n.scaleY*k],c=0;c<e;c++)u=a[0|c*n.scaleX*C],$[T++]=u;break;case 2:for(n=this.components[0],i=this.components[1],d=0;d<t;d++)for(a=n.lines[0|d*n.scaleY*k],o=i.lines[0|d*i.scaleY*k],c=0;c<e;c++)u=a[0|c*n.scaleX*C],$[T++]=u,u=o[0|c*i.scaleX*C],$[T++]=u;break;case 3:for(P=!0,this.adobe&&this.adobe.transformCode?P=!0:void 0!==this.opts.colorTransform&&(P=!!this.opts.colorTransform),n=this.components[0],i=this.components[1],s=this.components[2],d=0;d<t;d++)for(a=n.lines[0|d*n.scaleY*k],o=i.lines[0|d*i.scaleY*k],l=s.lines[0|d*s.scaleY*k],c=0;c<e;c++)P?(u=a[0|c*n.scaleX*C],m=o[0|c*i.scaleX*C],y=f(u+1.402*((g=l[0|c*s.scaleX*C])-128)),I=f(u-.3441363*(m-128)-.71413636*(g-128)),x=f(u+1.772*(m-128))):(y=a[0|c*n.scaleX*C],I=o[0|c*i.scaleX*C],x=l[0|c*s.scaleX*C]),$[T++]=y,$[T++]=I,$[T++]=x;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(P=!1,this.adobe&&this.adobe.transformCode?P=!0:void 0!==this.opts.colorTransform&&(P=!!this.opts.colorTransform),n=this.components[0],i=this.components[1],s=this.components[2],r=this.components[3],d=0;d<t;d++)for(a=n.lines[0|d*n.scaleY*k],o=i.lines[0|d*i.scaleY*k],l=s.lines[0|d*s.scaleY*k],h=r.lines[0|d*r.scaleY*k],c=0;c<e;c++)P?(u=a[0|c*n.scaleX*C],m=o[0|c*i.scaleX*C],g=l[0|c*s.scaleX*C],v=h[0|c*r.scaleX*C],w=255-f(u+1.402*(g-128)),b=255-f(u-.3441363*(m-128)-.71413636*(g-128)),_=255-f(u+1.772*(m-128))):(w=a[0|c*n.scaleX*C],b=o[0|c*i.scaleX*C],_=l[0|c*s.scaleX*C],v=h[0|c*r.scaleX*C]),$[T++]=255-w,$[T++]=255-b,$[T++]=255-_,$[T++]=255-v;break;default:throw new Error("Unsupported color mode")}return $},copyToImageData:function(e,t){var n,i,s,r,a,o,l,h,c,d=e.width,u=e.height,m=e.data,g=this.getData(d,u),p=0,v=0;switch(this.components.length){case 1:for(i=0;i<u;i++)for(n=0;n<d;n++)s=g[p++],m[v++]=s,m[v++]=s,m[v++]=s,t&&(m[v++]=255);break;case 3:for(i=0;i<u;i++)for(n=0;n<d;n++)l=g[p++],h=g[p++],c=g[p++],m[v++]=l,m[v++]=h,m[v++]=c,t&&(m[v++]=255);break;case 4:for(i=0;i<u;i++)for(n=0;n<d;n++)a=g[p++],o=g[p++],s=g[p++],l=255-f(a*(1-(r=g[p++])/255)+r),h=255-f(o*(1-r/255)+r),c=255-f(s*(1-r/255)+r),m[v++]=l,m[v++]=h,m[v++]=c,t&&(m[v++]=255);break;default:throw new Error("Unsupported color mode")}}};var m=0,g=0;function p(e=0){var t=m+e;if(t>g){var n=Math.ceil((t-g)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${n}MB`)}m=t}return h.resetMaxMemoryUsage=function(e){m=0,g=e},h.getBytesAllocated=function(){return m},h.requestMemoryAllocation=p,h}();e.exports=function(e,n={}){var i={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...n},s=new Uint8Array(e),r=new t;r.opts=i,t.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),r.parse(s);var a=i.formatAsRGBA?4:3,o=r.width*r.height*a;try{t.requestMemoryAllocation(o);var l={width:r.width,height:r.height,exifBuffer:r.exifBuffer,data:i.useTArray?new Uint8Array(o):Buffer.alloc(o)};r.comments.length>0&&(l.comments=r.comments)}catch(e){throw e instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+o):e}return r.copyToImageData(l,i.formatAsRGBA),l}})),er={encode:qs,decode:Qs};!function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function t(e="utf-8"){if("utf-8"!==e)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${e}') is invalid.`)}function n(e="utf-8",t={fatal:!1}){if("utf-8"!==e)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${e}') is invalid.`);if(t.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t={stream:!1}){if(t.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let n=0;const i=e.length;let s=0,r=Math.max(32,i+(i>>1)+7),a=new Uint8Array(r>>3<<3);for(;n<i;){let t=e.charCodeAt(n++);if(t>=55296&&t<=56319){if(n<i){const i=e.charCodeAt(n);56320==(64512&i)&&(++n,t=((1023&t)<<10)+(1023&i)+65536)}if(t>=55296&&t<=56319)continue}if(s+4>a.length){r+=8,r*=1+n/e.length*2,r=r>>3<<3;const t=new Uint8Array(r);t.set(a),a=t}if(0!=(4294967168&t)){if(0==(4294965248&t))a[s++]=t>>6&31|192;else if(0==(4294901760&t))a[s++]=t>>12&15|224,a[s++]=t>>6&63|128;else{if(0!=(4292870144&t))continue;a[s++]=t>>18&7|240,a[s++]=t>>12&63|128,a[s++]=t>>6&63|128}a[s++]=63&t|128}else a[s++]=t}return a.slice(0,s)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1}),n.prototype.decode=function(e,t={stream:!1}){if(t.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const n=new Uint8Array(e);let i=0;const s=n.length,r=[];for(;i<s;){const e=n[i++];if(0===e)break;if(0==(128&e))r.push(e);else if(192==(224&e)){const t=63&n[i++];r.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&n[i++],s=63&n[i++];r.push((31&e)<<12|t<<6|s)}else if(240==(248&e)){let t=(7&e)<<18|(63&n[i++])<<12|(63&n[i++])<<6|63&n[i++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}}return String.fromCharCode.apply(null,r)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);const tr=new TextDecoder("utf-8");const nr=new TextEncoder;class ir{constructor(e=8192,t={}){let n=!1;"number"==typeof e?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const i=t.offset?t.offset>>>0:0,s=e.byteLength-i;let r=i;(ArrayBuffer.isView(e)||e instanceof ir)&&(e.byteLength!==e.buffer.byteLength&&(r=e.byteOffset+i),e=e.buffer),this.lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=r,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,r,s),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){const t=new Uint8Array(e);for(let n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return t=this.readBytes(e),tr.decode(t);var t}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return nr.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */function sr(e){let t=e.length;for(;--t>=0;)e[t]=0}const rr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ar=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),or=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),lr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hr=new Array(576);sr(hr);const cr=new Array(60);sr(cr);const dr=new Array(512);sr(dr);const ur=new Array(256);sr(ur);const fr=new Array(29);sr(fr);const mr=new Array(30);function gr(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let pr,vr,wr;function br(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}sr(mr);const _r=e=>e<256?dr[e]:dr[256+(e>>>7)],yr=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ir=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,yr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},xr=(e,t,n)=>{Ir(e,n[2*t],n[2*t+1])},Pr=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Cr=(e,t,n)=>{const i=new Array(16);let s,r,a=0;for(s=1;s<=15;s++)i[s]=a=a+n[s-1]<<1;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=Pr(i[t]++,t))}},kr=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Tr=e=>{e.bi_valid>8?yr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ar=(e,t,n,i)=>{const s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]},$r=(e,t,n)=>{const i=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Ar(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!Ar(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i},Er=(e,t,n)=>{let i,s,r,a,o=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0===i?xr(e,s,t):(r=ur[s],xr(e,r+256+1,t),a=rr[r],0!==a&&(s-=fr[r],Ir(e,s,a)),i--,r=_r(i),xr(e,r,n),a=ar[r],0!==a&&(i-=mr[r],Ir(e,i,a)))}while(o<e.last_lit);xr(e,256,t)},Sr=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,o,l,h=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<r;a++)0!==n[2*a]?(e.heap[++e.heap_len]=h=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=i[2*l+1]);for(t.max_code=h,a=e.heap_len>>1;a>=1;a--)$r(e,n,a);l=r;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],$r(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,n[2*l]=n[2*a]+n[2*o],e.depth[l]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,n[2*a+1]=n[2*o+1]=l,e.heap[1]=l++,$r(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let h,c,d,u,f,m,g=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(n[2*e.heap[e.heap_max]+1]=0,h=e.heap_max+1;h<573;h++)c=e.heap[h],u=n[2*n[2*c+1]+1]+1,u>l&&(u=l,g++),n[2*c+1]=u,c>i||(e.bl_count[u]++,f=0,c>=o&&(f=a[c-o]),m=n[2*c],e.opt_len+=m*(u+f),r&&(e.static_len+=m*(s[2*c+1]+f)));if(0!==g){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(u=l;0!==u;u--)for(c=e.bl_count[u];0!==c;)d=e.heap[--h],d>i||(n[2*d+1]!==u&&(e.opt_len+=(u-n[2*d+1])*n[2*d],n[2*d+1]=u),c--)}})(e,t),Cr(n,h,e.bl_count)},Mr=(e,t,n)=>{let i,s,r=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=a,a=t[2*(i+1)+1],++o<l&&s===a||(o<h?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===a?(l=138,h=3):s===a?(l=6,h=3):(l=7,h=4))},Rr=(e,t,n)=>{let i,s,r=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),i=0;i<=n;i++)if(s=a,a=t[2*(i+1)+1],!(++o<l&&s===a)){if(o<h)do{xr(e,s,e.bl_tree)}while(0!=--o);else 0!==s?(s!==r&&(xr(e,s,e.bl_tree),o--),xr(e,16,e.bl_tree),Ir(e,o-3,2)):o<=10?(xr(e,17,e.bl_tree),Ir(e,o-3,3)):(xr(e,18,e.bl_tree),Ir(e,o-11,7));o=0,r=s,0===a?(l=138,h=3):s===a?(l=6,h=3):(l=7,h=4)}};let Dr=!1;const Or=(e,t,n,i)=>{Ir(e,0+(i?1:0),3),((e,t,n,i)=>{Tr(e),i&&(yr(e,n),yr(e,~n)),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n})(e,t,n,!0)};var Nr=(e,t,n,i)=>{let s,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Sr(e,e.l_desc),Sr(e,e.d_desc),a=(e=>{let t;for(Mr(e,e.dyn_ltree,e.l_desc.max_code),Mr(e,e.dyn_dtree,e.d_desc.max_code),Sr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*lr[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?Or(e,t,n,i):4===e.strategy||r===s?(Ir(e,2+(i?1:0),3),Er(e,hr,cr)):(Ir(e,4+(i?1:0),3),((e,t,n,i)=>{let s;for(Ir(e,t-257,5),Ir(e,n-1,5),Ir(e,i-4,4),s=0;s<i;s++)Ir(e,e.bl_tree[2*lr[s]+1],3);Rr(e,e.dyn_ltree,t-1),Rr(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Er(e,e.dyn_ltree,e.dyn_dtree)),kr(e),i&&Tr(e)},zr={_tr_init:e=>{Dr||((()=>{let e,t,n,i,s;const r=new Array(16);for(n=0,i=0;i<28;i++)for(fr[i]=n,e=0;e<1<<rr[i];e++)ur[n++]=i;for(ur[n-1]=i,s=0,i=0;i<16;i++)for(mr[i]=s,e=0;e<1<<ar[i];e++)dr[s++]=i;for(s>>=7;i<30;i++)for(mr[i]=s<<7,e=0;e<1<<ar[i]-7;e++)dr[256+s++]=i;for(t=0;t<=15;t++)r[t]=0;for(e=0;e<=143;)hr[2*e+1]=8,e++,r[8]++;for(;e<=255;)hr[2*e+1]=9,e++,r[9]++;for(;e<=279;)hr[2*e+1]=7,e++,r[7]++;for(;e<=287;)hr[2*e+1]=8,e++,r[8]++;for(Cr(hr,287,r),e=0;e<30;e++)cr[2*e+1]=5,cr[2*e]=Pr(e,5);pr=new gr(hr,rr,257,286,15),vr=new gr(cr,ar,0,30,15),wr=new gr(new Array(0),or,0,19,7)})(),Dr=!0),e.l_desc=new br(e.dyn_ltree,pr),e.d_desc=new br(e.dyn_dtree,vr),e.bl_desc=new br(e.bl_tree,wr),e.bi_buf=0,e.bi_valid=0,kr(e)},_tr_stored_block:Or,_tr_flush_block:Nr,_tr_tally:(e,t,n)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ur[n]+256+1)]++,e.dyn_dtree[2*_r(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{Ir(e,2,3),xr(e,256,hr),(e=>{16===e.bi_valid?(yr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Lr=(e,t,n,i)=>{let s=65535&e|0,r=e>>>16&65535|0,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{s=s+t[i++]|0,r=r+s|0}while(--a);s%=65521,r%=65521}return s|r<<16|0};const Vr=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Br=(e,t,n,i)=>{const s=Vr,r=i+n;e^=-1;for(let n=i;n<r;n++)e=e>>>8^s[255&(e^t[n])];return-1^e},Ur={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Xr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Fr,_tr_stored_block:Gr,_tr_flush_block:Hr,_tr_tally:jr,_tr_align:Zr}=zr,{Z_NO_FLUSH:Jr,Z_PARTIAL_FLUSH:Kr,Z_FULL_FLUSH:Wr,Z_FINISH:Yr,Z_BLOCK:qr,Z_OK:Qr,Z_STREAM_END:ea,Z_STREAM_ERROR:ta,Z_DATA_ERROR:na,Z_BUF_ERROR:ia,Z_DEFAULT_COMPRESSION:sa,Z_FILTERED:ra,Z_HUFFMAN_ONLY:aa,Z_RLE:oa,Z_FIXED:la,Z_DEFAULT_STRATEGY:ha,Z_UNKNOWN:ca,Z_DEFLATED:da}=Xr,ua=(e,t)=>(e.msg=Ur[t],t),fa=e=>(e<<1)-(e>4?9:0),ma=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let ga=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const pa=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},va=(e,t)=>{Hr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,pa(e.strm)},wa=(e,t)=>{e.pending_buf[e.pending++]=t},ba=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},_a=(e,t,n,i)=>{let s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=Lr(e.adler,t,s,n):2===e.state.wrap&&(e.adler=Br(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},ya=(e,t)=>{let n,i,s=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,h=e.window,c=e.w_mask,d=e.prev,u=e.strstart+258;let f=h[r+a-1],m=h[r+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,h[n+a]===m&&h[n+a-1]===f&&h[n]===h[r]&&h[++n]===h[r+1]){r+=2,n++;do{}while(h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&h[++r]===h[++n]&&r<u);if(i=258-(u-r),r=u-258,i>a){if(e.match_start=t,a=i,i>=o)break;f=h[r+a-1],m=h[r+a]}}}while((t=d[t&c])>l&&0!=--s);return a<=e.lookahead?a:e.lookahead},Ia=e=>{const t=e.w_size;let n,i,s,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-262)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,n=i;do{s=e.head[--n],e.head[n]=s>=t?s-t:0}while(--i);i=t,n=i;do{s=e.prev[--n],e.prev[n]=s>=t?s-t:0}while(--i);r+=t}if(0===e.strm.avail_in)break;if(i=_a(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ga(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ga(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},xa=(e,t)=>{let n,i;for(;;){if(e.lookahead<262){if(Ia(e),e.lookahead<262&&t===Jr)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ga(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=ya(e,n)),e.match_length>=3)if(i=jr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ga(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ga(e,e.ins_h,e.window[e.strstart+1]);else i=jr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(va(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Yr?(va(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?1:2},Pa=(e,t)=>{let n,i,s;for(;;){if(e.lookahead<262){if(Ia(e),e.lookahead<262&&t===Jr)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ga(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=ya(e,n),e.match_length<=5&&(e.strategy===ra||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=jr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=ga(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(va(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=jr(e,0,e.window[e.strstart-1]),i&&va(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=jr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Yr?(va(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?1:2};function Ca(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}const ka=[new Ca(0,0,0,0,((e,t)=>{let n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ia(e),0===e.lookahead&&t===Jr)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,va(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(va(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yr?(va(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(va(e,!1),e.strm.avail_out),1)})),new Ca(4,4,8,4,xa),new Ca(4,5,16,8,xa),new Ca(4,6,32,32,xa),new Ca(4,4,16,16,Pa),new Ca(8,16,32,32,Pa),new Ca(8,16,128,128,Pa),new Ca(8,32,128,256,Pa),new Ca(32,128,258,1024,Pa),new Ca(32,258,258,4096,Pa)];function Ta(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=da,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ma(this.dyn_ltree),ma(this.dyn_dtree),ma(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ma(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ma(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Aa=e=>{if(!e||!e.state)return ua(e,ta);e.total_in=e.total_out=0,e.data_type=ca;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=Jr,Fr(t),Qr},$a=e=>{const t=Aa(e);var n;return t===Qr&&((n=e.state).window_size=2*n.w_size,ma(n.head),n.max_lazy_match=ka[n.level].max_lazy,n.good_match=ka[n.level].good_length,n.nice_match=ka[n.level].nice_length,n.max_chain_length=ka[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Ea=(e,t,n,i,s,r)=>{if(!e)return ta;let a=1;if(t===sa&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),s<1||s>9||n!==da||i<8||i>15||t<0||t>9||r<0||r>la)return ua(e,ta);8===i&&(i=9);const o=new Ta;return e.state=o,o.strm=e,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=r,o.method=n,$a(e)};var Sa={deflateInit:(e,t)=>Ea(e,t,da,15,8,ha),deflateInit2:Ea,deflateReset:$a,deflateResetKeep:Aa,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?ta:(e.state.gzhead=t,Qr):ta,deflate:(e,t)=>{let n,i;if(!e||!e.state||t>qr||t<0)return e?ua(e,ta):ta;const s=e.state;if(!e.output||!e.input&&0!==e.avail_in||666===s.status&&t!==Yr)return ua(e,0===e.avail_out?ia:ta);s.strm=e;const r=s.last_flush;if(s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,wa(s,31),wa(s,139),wa(s,8),s.gzhead?(wa(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),wa(s,255&s.gzhead.time),wa(s,s.gzhead.time>>8&255),wa(s,s.gzhead.time>>16&255),wa(s,s.gzhead.time>>24&255),wa(s,9===s.level?2:s.strategy>=aa||s.level<2?4:0),wa(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(wa(s,255&s.gzhead.extra.length),wa(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=Br(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(wa(s,0),wa(s,0),wa(s,0),wa(s,0),wa(s,0),wa(s,9===s.level?2:s.strategy>=aa||s.level<2?4:0),wa(s,3),s.status=113);else{let t=da+(s.w_bits-8<<4)<<8,n=-1;n=s.strategy>=aa||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=n<<6,0!==s.strstart&&(t|=32),t+=31-t%31,s.status=113,ba(s,t),0!==s.strstart&&(ba(s,e.adler>>>16),ba(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(n=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),pa(e),n=s.pending,s.pending!==s.pending_buf_size));)wa(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),pa(e),n=s.pending,s.pending===s.pending_buf_size)){i=1;break}i=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,wa(s,i)}while(0!==i);s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),0===i&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){n=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),pa(e),n=s.pending,s.pending===s.pending_buf_size)){i=1;break}i=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,wa(s,i)}while(0!==i);s.gzhead.hcrc&&s.pending>n&&(e.adler=Br(e.adler,s.pending_buf,s.pending-n,n)),0===i&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&pa(e),s.pending+2<=s.pending_buf_size&&(wa(s,255&e.adler),wa(s,e.adler>>8&255),e.adler=0,s.status=113)):s.status=113),0!==s.pending){if(pa(e),0===e.avail_out)return s.last_flush=-1,Qr}else if(0===e.avail_in&&fa(t)<=fa(r)&&t!==Yr)return ua(e,ia);if(666===s.status&&0!==e.avail_in)return ua(e,ia);if(0!==e.avail_in||0!==s.lookahead||t!==Jr&&666!==s.status){let n=s.strategy===aa?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Ia(e),0===e.lookahead)){if(t===Jr)return 1;break}if(e.match_length=0,n=jr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(va(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yr?(va(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===oa?((e,t)=>{let n,i,s,r;const a=e.window;for(;;){if(e.lookahead<=258){if(Ia(e),e.lookahead<=258&&t===Jr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,i=a[s],i===a[++s]&&i===a[++s]&&i===a[++s])){r=e.strstart+258;do{}while(i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<r);e.match_length=258-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=jr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=jr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(va(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yr?(va(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(va(e,!1),0===e.strm.avail_out)?1:2})(s,t):ka[s.level].func(s,t);if(3!==n&&4!==n||(s.status=666),1===n||3===n)return 0===e.avail_out&&(s.last_flush=-1),Qr;if(2===n&&(t===Kr?Zr(s):t!==qr&&(Gr(s,0,0,!1),t===Wr&&(ma(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),pa(e),0===e.avail_out))return s.last_flush=-1,Qr}return t!==Yr?Qr:s.wrap<=0?ea:(2===s.wrap?(wa(s,255&e.adler),wa(s,e.adler>>8&255),wa(s,e.adler>>16&255),wa(s,e.adler>>24&255),wa(s,255&e.total_in),wa(s,e.total_in>>8&255),wa(s,e.total_in>>16&255),wa(s,e.total_in>>24&255)):(ba(s,e.adler>>>16),ba(s,65535&e.adler)),pa(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Qr:ea)},deflateEnd:e=>{if(!e||!e.state)return ta;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?ua(e,ta):(e.state=null,113===t?ua(e,na):Qr)},deflateSetDictionary:(e,t)=>{let n=t.length;if(!e||!e.state)return ta;const i=e.state,s=i.wrap;if(2===s||1===s&&42!==i.status||i.lookahead)return ta;if(1===s&&(e.adler=Lr(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===s&&(ma(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(n-i.w_size,n),0),t=e,n=i.w_size}const r=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Ia(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=ga(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Ia(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=a,e.input=o,e.avail_in=r,i.wrap=s,Qr},deflateInfo:"pako deflate (from Nodeca project)"};const Ma=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ra=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ma(n,t)&&(e[t]=n[t])}}return e},Da=e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,s=e.length;t<s;t++){let s=e[t];n.set(s,i),i+=s.length}return n};let Oa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Oa=!1}const Na=new Uint8Array(256);for(let e=0;e<256;e++)Na[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Na[254]=Na[254]=1;var za=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,s,r,a=e.length,o=0;for(s=0;s<a;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<a&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<a&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},La=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const r=new Array(2*n);for(s=0,i=0;i<n;){let t=e[i++];if(t<128){r[s++]=t;continue}let a=Na[t];if(a>4)r[s++]=65533,i+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&i<n;)t=t<<6|63&e[i++],a--;a>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Oa)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n})(r,s)},Va=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Na[e[n]]>t?n:t};var Ba=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ua=Object.prototype.toString,{Z_NO_FLUSH:Xa,Z_SYNC_FLUSH:Fa,Z_FULL_FLUSH:Ga,Z_FINISH:Ha,Z_OK:ja,Z_STREAM_END:Za,Z_DEFAULT_COMPRESSION:Ja,Z_DEFAULT_STRATEGY:Ka,Z_DEFLATED:Wa}=Xr;function Ya(e){this.options=Ra({level:Ja,method:Wa,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ka},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ba,this.strm.avail_out=0;let n=Sa.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==ja)throw new Error(Ur[n]);if(t.header&&Sa.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?za(t.dictionary):"[object ArrayBuffer]"===Ua.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Sa.deflateSetDictionary(this.strm,e),n!==ja)throw new Error(Ur[n]);this._dict_set=!0}}function qa(e,t){const n=new Ya(t);if(n.push(e,!0),n.err)throw n.msg||Ur[n.err];return n.result}Ya.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Ha:Xa,"string"==typeof e?n.input=za(e):"[object ArrayBuffer]"===Ua.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(r===Fa||r===Ga)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=Sa.deflate(n,r),s===Za)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=Sa.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ja;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Ya.prototype.onData=function(e){this.chunks.push(e)},Ya.prototype.onEnd=function(e){e===ja&&(this.result=Da(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qa={Deflate:Ya,deflate:qa,deflateRaw:function(e,t){return(t=t||{}).raw=!0,qa(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,qa(e,t)},constants:Xr};var eo=function(e,t){let n,i,s,r,a,o,l,h,c,d,u,f,m,g,p,v,w,b,_,y,I,x,P,C;const k=e.state;n=e.next_in,P=e.input,i=n+(e.avail_in-5),s=e.next_out,C=e.output,r=s-(t-e.avail_out),a=s+(e.avail_out-257),o=k.dmax,l=k.wsize,h=k.whave,c=k.wnext,d=k.window,u=k.hold,f=k.bits,m=k.lencode,g=k.distcode,p=(1<<k.lenbits)-1,v=(1<<k.distbits)-1;e:do{f<15&&(u+=P[n++]<<f,f+=8,u+=P[n++]<<f,f+=8),w=m[u&p];t:for(;;){if(b=w>>>24,u>>>=b,f-=b,b=w>>>16&255,0===b)C[s++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=m[(65535&w)+(u&(1<<b)-1)];continue t}if(32&b){k.mode=12;break e}e.msg="invalid literal/length code",k.mode=30;break e}_=65535&w,b&=15,b&&(f<b&&(u+=P[n++]<<f,f+=8),_+=u&(1<<b)-1,u>>>=b,f-=b),f<15&&(u+=P[n++]<<f,f+=8,u+=P[n++]<<f,f+=8),w=g[u&v];n:for(;;){if(b=w>>>24,u>>>=b,f-=b,b=w>>>16&255,!(16&b)){if(0==(64&b)){w=g[(65535&w)+(u&(1<<b)-1)];continue n}e.msg="invalid distance code",k.mode=30;break e}if(y=65535&w,b&=15,f<b&&(u+=P[n++]<<f,f+=8,f<b&&(u+=P[n++]<<f,f+=8)),y+=u&(1<<b)-1,y>o){e.msg="invalid distance too far back",k.mode=30;break e}if(u>>>=b,f-=b,b=s-r,y>b){if(b=y-b,b>h&&k.sane){e.msg="invalid distance too far back",k.mode=30;break e}if(I=0,x=d,0===c){if(I+=l-b,b<_){_-=b;do{C[s++]=d[I++]}while(--b);I=s-y,x=C}}else if(c<b){if(I+=l+c-b,b-=c,b<_){_-=b;do{C[s++]=d[I++]}while(--b);if(I=0,c<_){b=c,_-=b;do{C[s++]=d[I++]}while(--b);I=s-y,x=C}}}else if(I+=c-b,b<_){_-=b;do{C[s++]=d[I++]}while(--b);I=s-y,x=C}for(;_>2;)C[s++]=x[I++],C[s++]=x[I++],C[s++]=x[I++],_-=3;_&&(C[s++]=x[I++],_>1&&(C[s++]=x[I++]))}else{I=s-y;do{C[s++]=C[I++],C[s++]=C[I++],C[s++]=C[I++],_-=3}while(_>2);_&&(C[s++]=C[I++],_>1&&(C[s++]=C[I++]))}break}}break}}while(n<i&&s<a);_=f>>3,n-=_,f-=_<<3,u&=(1<<f)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<a?a-s+257:257-(s-a),k.hold=u,k.bits=f};const to=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),no=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),io=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),so=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ro=(e,t,n,i,s,r,a,o)=>{const l=o.bits;let h,c,d,u,f,m,g=0,p=0,v=0,w=0,b=0,_=0,y=0,I=0,x=0,P=0,C=null,k=0;const T=new Uint16Array(16),A=new Uint16Array(16);let $,E,S,M=null,R=0;for(g=0;g<=15;g++)T[g]=0;for(p=0;p<i;p++)T[t[n+p]]++;for(b=l,w=15;w>=1&&0===T[w];w--);if(b>w&&(b=w),0===w)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(v=1;v<w&&0===T[v];v++);for(b<v&&(b=v),I=1,g=1;g<=15;g++)if(I<<=1,I-=T[g],I<0)return-1;if(I>0&&(0===e||1!==w))return-1;for(A[1]=0,g=1;g<15;g++)A[g+1]=A[g]+T[g];for(p=0;p<i;p++)0!==t[n+p]&&(a[A[t[n+p]]++]=p);if(0===e?(C=M=a,m=19):1===e?(C=to,k-=257,M=no,R-=257,m=256):(C=io,M=so,m=-1),P=0,p=0,g=v,f=r,_=b,y=0,d=-1,x=1<<b,u=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){$=g-y,a[p]<m?(E=0,S=a[p]):a[p]>m?(E=M[R+a[p]],S=C[k+a[p]]):(E=96,S=0),h=1<<g-y,c=1<<_,v=c;do{c-=h,s[f+(P>>y)+c]=$<<24|E<<16|S|0}while(0!==c);for(h=1<<g-1;P&h;)h>>=1;if(0!==h?(P&=h-1,P+=h):P=0,p++,0==--T[g]){if(g===w)break;g=t[n+a[p]]}if(g>b&&(P&u)!==d){for(0===y&&(y=b),f+=v,_=g-y,I=1<<_;_+y<w&&(I-=T[_+y],!(I<=0));)_++,I<<=1;if(x+=1<<_,1===e&&x>852||2===e&&x>592)return 1;d=P&u,s[d]=b<<24|_<<16|f-r|0}}return 0!==P&&(s[f+P]=g-y<<24|64<<16|0),o.bits=b,0};const{Z_FINISH:ao,Z_BLOCK:oo,Z_TREES:lo,Z_OK:ho,Z_STREAM_END:co,Z_NEED_DICT:uo,Z_STREAM_ERROR:fo,Z_DATA_ERROR:mo,Z_MEM_ERROR:go,Z_BUF_ERROR:po,Z_DEFLATED:vo}=Xr,wo=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function bo(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const _o=e=>{if(!e||!e.state)return fo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ho},yo=e=>{if(!e||!e.state)return fo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,_o(e)},Io=(e,t)=>{let n;if(!e||!e.state)return fo;const i=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?fo:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,yo(e))},xo=(e,t)=>{if(!e)return fo;const n=new bo;e.state=n,n.window=null;const i=Io(e,t);return i!==ho&&(e.state=null),i};let Po,Co,ko=!0;const To=e=>{if(ko){Po=new Int32Array(512),Co=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ro(1,e.lens,0,288,Po,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ro(2,e.lens,0,32,Co,0,e.work,{bits:5}),ko=!1}e.lencode=Po,e.lenbits=9,e.distcode=Co,e.distbits=5},Ao=(e,t,n,i)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(t.subarray(n-i,n-i+s),r.wnext),(i-=s)?(r.window.set(t.subarray(n-i,n),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var $o={inflateReset:yo,inflateReset2:Io,inflateResetKeep:_o,inflateInit:e=>xo(e,15),inflateInit2:xo,inflate:(e,t)=>{let n,i,s,r,a,o,l,h,c,d,u,f,m,g,p,v,w,b,_,y,I,x,P=0;const C=new Uint8Array(4);let k,T;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return fo;n=e.state,12===n.mode&&(n.mode=13),a=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,h=n.hold,c=n.bits,d=o,u=l,x=ho;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(2&n.wrap&&35615===h){n.check=0,C[0]=255&h,C[1]=h>>>8&255,n.check=Br(n.check,C,2,0),h=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",n.mode=30;break}if((15&h)!==vo){e.msg="unknown compression method",n.mode=30;break}if(h>>>=4,c-=4,I=8+(15&h),0===n.wbits)n.wbits=I;else if(I>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&h?10:12,h=0,c=0;break;case 2:for(;c<16;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(n.flags=h,(255&n.flags)!==vo){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&(C[0]=255&h,C[1]=h>>>8&255,n.check=Br(n.check,C,2,0)),h=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.head&&(n.head.time=h),512&n.flags&&(C[0]=255&h,C[1]=h>>>8&255,C[2]=h>>>16&255,C[3]=h>>>24&255,n.check=Br(n.check,C,4,0)),h=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&(C[0]=255&h,C[1]=h>>>8&255,n.check=Br(n.check,C,2,0)),h=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&(C[0]=255&h,C[1]=h>>>8&255,n.check=Br(n.check,C,2,0)),h=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(r,r+f),I)),512&n.flags&&(n.check=Br(n.check,i,f,r)),o-=f,r+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===o)break e;f=0;do{I=i[r+f++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I))}while(I&&f<o);if(512&n.flags&&(n.check=Br(n.check,i,f,r)),o-=f,r+=f,I)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===o)break e;f=0;do{I=i[r+f++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I))}while(I&&f<o);if(512&n.flags&&(n.check=Br(n.check,i,f,r)),o-=f,r+=f,I)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(h!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}h=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;c<32;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}e.adler=n.check=wo(h),h=0,c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=l,e.next_in=r,e.avail_in=o,n.hold=h,n.bits=c,uo;e.adler=n.check=1,n.mode=12;case 12:if(t===oo||t===lo)break e;case 13:if(n.last){h>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}switch(n.last=1&h,h>>>=1,c-=1,3&h){case 0:n.mode=14;break;case 1:if(To(n),n.mode=20,t===lo){h>>>=2,c-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}h>>>=2,c-=2;break;case 14:for(h>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&h,h=0,c=0,n.mode=15,t===lo)break e;case 15:n.mode=16;case 16:if(f=n.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;s.set(i.subarray(r,r+f),a),o-=f,r+=f,l-=f,a+=f,n.length-=f;break}n.mode=12;break;case 17:for(;c<14;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(n.nlen=257+(31&h),h>>>=5,c-=5,n.ndist=1+(31&h),h>>>=5,c-=5,n.ncode=4+(15&h),h>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.lens[A[n.have++]]=7&h,h>>>=3,c-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},x=ro(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,x){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;P=n.lencode[h&(1<<n.lenbits)-1],p=P>>>24,v=P>>>16&255,w=65535&P,!(p<=c);){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(w<16)h>>>=p,c-=p,n.lens[n.have++]=w;else{if(16===w){for(T=p+2;c<T;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(h>>>=p,c-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}I=n.lens[n.have-1],f=3+(3&h),h>>>=2,c-=2}else if(17===w){for(T=p+3;c<T;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}h>>>=p,c-=p,I=0,f=3+(7&h),h>>>=3,c-=3}else{for(T=p+7;c<T;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}h>>>=p,c-=p,I=0,f=11+(127&h),h>>>=7,c-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;f--;)n.lens[n.have++]=I}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,k={bits:n.lenbits},x=ro(1,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,x){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},x=ro(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,x){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,t===lo)break e;case 20:n.mode=21;case 21:if(o>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=r,e.avail_in=o,n.hold=h,n.bits=c,eo(e,u),a=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,h=n.hold,c=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;P=n.lencode[h&(1<<n.lenbits)-1],p=P>>>24,v=P>>>16&255,w=65535&P,!(p<=c);){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(v&&0==(240&v)){for(b=p,_=v,y=w;P=n.lencode[y+((h&(1<<b+_)-1)>>b)],p=P>>>24,v=P>>>16&255,w=65535&P,!(b+p<=c);){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}h>>>=b,c-=b,n.back+=b}if(h>>>=p,c-=p,n.back+=p,n.length=w,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(T=n.extra;c<T;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;P=n.distcode[h&(1<<n.distbits)-1],p=P>>>24,v=P>>>16&255,w=65535&P,!(p<=c);){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(0==(240&v)){for(b=p,_=v,y=w;P=n.distcode[y+((h&(1<<b+_)-1)>>b)],p=P>>>24,v=P>>>16&255,w=65535&P,!(b+p<=c);){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}h>>>=b,c-=b,n.back+=b}if(h>>>=p,c-=p,n.back+=p,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=w,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(T=n.extra;c<T;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(f=u-l,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}f>n.wnext?(f-=n.wnext,m=n.wsize-f):m=n.wnext-f,f>n.length&&(f=n.length),g=n.window}else g=s,m=a-n.offset,f=n.length;f>l&&(f=l),l-=f,n.length-=f;do{s[a++]=g[m++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;s[a++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===o)break e;o--,h|=i[r++]<<c,c+=8}if(u-=l,e.total_out+=u,n.total+=u,u&&(e.adler=n.check=n.flags?Br(n.check,s,u,a-u):Lr(n.check,s,u,a-u)),u=l,(n.flags?h:wo(h))!==n.check){e.msg="incorrect data check",n.mode=30;break}h=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===o)break e;o--,h+=i[r++]<<c,c+=8}if(h!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}h=0,c=0}n.mode=29;case 29:x=co;break e;case 30:x=mo;break e;case 31:return go;default:return fo}return e.next_out=a,e.avail_out=l,e.next_in=r,e.avail_in=o,n.hold=h,n.bits=c,(n.wsize||u!==e.avail_out&&n.mode<30&&(n.mode<27||t!==ao))&&Ao(e,e.output,e.next_out,u-e.avail_out),d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,n.total+=u,n.wrap&&u&&(e.adler=n.check=n.flags?Br(n.check,s,u,e.next_out-u):Lr(n.check,s,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===u||t===ao)&&x===ho&&(x=po),x},inflateEnd:e=>{if(!e||!e.state)return fo;let t=e.state;return t.window&&(t.window=null),e.state=null,ho},inflateGetHeader:(e,t)=>{if(!e||!e.state)return fo;const n=e.state;return 0==(2&n.wrap)?fo:(n.head=t,t.done=!1,ho)},inflateSetDictionary:(e,t)=>{const n=t.length;let i,s,r;return e&&e.state?(i=e.state,0!==i.wrap&&11!==i.mode?fo:11===i.mode&&(s=1,s=Lr(s,t,n,0),s!==i.check)?mo:(r=Ao(e,t,n,n),r?(i.mode=31,go):(i.havedict=1,ho))):fo},inflateInfo:"pako inflate (from Nodeca project)"};var Eo=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const So=Object.prototype.toString,{Z_NO_FLUSH:Mo,Z_FINISH:Ro,Z_OK:Do,Z_STREAM_END:Oo,Z_NEED_DICT:No,Z_STREAM_ERROR:zo,Z_DATA_ERROR:Lo,Z_MEM_ERROR:Vo}=Xr;function Bo(e){this.options=Ra({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ba,this.strm.avail_out=0;let n=$o.inflateInit2(this.strm,t.windowBits);if(n!==Do)throw new Error(Ur[n]);if(this.header=new Eo,$o.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=za(t.dictionary):"[object ArrayBuffer]"===So.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=$o.inflateSetDictionary(this.strm,t.dictionary),n!==Do)))throw new Error(Ur[n])}function Uo(e,t){const n=new Bo(t);if(n.push(e),n.err)throw n.msg||Ur[n.err];return n.result}Bo.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Ro:Mo,"[object ArrayBuffer]"===So.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),r=$o.inflate(n,a),r===No&&s&&(r=$o.inflateSetDictionary(n,s),r===Do?r=$o.inflate(n,a):r===Lo&&(r=No));n.avail_in>0&&r===Oo&&n.state.wrap>0&&0!==e[n.next_in];)$o.inflateReset(n),r=$o.inflate(n,a);switch(r){case zo:case Lo:case No:case Vo:return this.onEnd(r),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||r===Oo))if("string"===this.options.to){let e=Va(n.output,n.next_out),t=n.next_out-e,s=La(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==Do||0!==o){if(r===Oo)return r=$o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Bo.prototype.onData=function(e){this.chunks.push(e)},Bo.prototype.onEnd=function(e){e===Do&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Da(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xo={Inflate:Bo,inflate:Uo,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Uo(e,t)},ungzip:Uo,constants:Xr};const{Deflate:Fo,deflate:Go,deflateRaw:Ho,gzip:jo}=Qa,{Inflate:Zo,inflate:Jo,inflateRaw:Ko,ungzip:Wo}=Xo;var Yo=Go,qo=Zo,Qo=Jo;const el=[137,80,78,71,13,10,26,10],tl=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;tl[e]=t}function nl(e,t){return(4294967295^function(e,t,n){let i=e;for(let e=0;e<n;e++)i=tl[255&(i^t[e])]^i>>>8;return i}(4294967295,e,t))>>>0}var il,sl,rl,al;!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(il||(il={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"}(sl||(sl={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"}(rl||(rl={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"}(al||(al={}));const ol=new Uint8Array(0),ll=new Uint16Array([255]),hl=255===new Uint8Array(ll.buffer)[0];class cl extends ir{constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new qo,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=sl.UNKNOWN,this._filterMethod=rl.UNKNOWN,this._interlaceMethod=al.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let e=0;e<el.length;e++)if(this.readUint8()!==el[e])throw new Error(`wrong PNG signature. Byte at ${e} should be ${el[e]}.`)}decodeChunk(){const e=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case"tEXt":this.decodetEXt(e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const n=this.readUint32(),i=e+4,s=nl(new Uint8Array(this.buffer,this.byteOffset+this.offset-i-4,i),i);if(s!==n)throw new Error(`CRC mismatch for chunk ${t}. Expected ${n}, found ${s}`)}else this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error(`invalid bit depth: ${e}`);return e}(this.readUint8());const t=this.readUint8();let n;switch(this._colorType=t,t){case il.GREYSCALE:n=1;break;case il.TRUECOLOUR:n=3;break;case il.INDEXED_COLOUR:n=1;break;case il.GREYSCALE_ALPHA:n=2;break;case il.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==sl.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(e){if(e%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let e=0;e<t;e++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,e)),this.skip(e)}decodetRNS(e){if(3===this._colorType){if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255)}}decodeiCCP(e){let t,n="";for(;"\0"!==(t=this.readChar());)n+=t;const i=this.readUint8();if(i!==sl.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const s=this.readBytes(e-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:Qo(s)}}decodetEXt(e){let t,n="";for(;"\0"!==(t=this.readChar());)n+=t;this._png.text[n]=this.readChars(e-n.length-1)}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._inflator.result;if(this._filterMethod!==rl.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==al.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(e)}decodeInterlaceNull(e){const t=this._png.height,n=this._png.channels*this._png.depth/8,i=this._png.width*n,s=new Uint8Array(this._png.height*i);let r,a,o=ol,l=0;for(let h=0;h<t;h++){switch(r=e.subarray(l+1,l+1+i),a=s.subarray(h*i,(h+1)*i),e[l]){case 0:dl(r,a,i);break;case 1:ul(r,a,i,n);break;case 2:fl(r,a,o,i);break;case 3:ml(r,a,o,i,n);break;case 4:gl(r,a,o,i,n);break;default:throw new Error(`Unsupported filter: ${e[l]}`)}o=a,l+=i+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const e=new Uint16Array(s.buffer);if(hl)for(let t=0;t<e.length;t++)e[t]=(255&(h=e[t]))<<8|h>>8&255;this._png.data=e}else this._png.data=s;var h}}function dl(e,t,n){for(let i=0;i<n;i++)t[i]=e[i]}function ul(e,t,n,i){let s=0;for(;s<i;s++)t[s]=e[s];for(;s<n;s++)t[s]=e[s]+t[s-i]&255}function fl(e,t,n,i){let s=0;if(0===n.length)for(;s<i;s++)t[s]=e[s];else for(;s<i;s++)t[s]=e[s]+n[s]&255}function ml(e,t,n,i,s){let r=0;if(0===n.length){for(;r<s;r++)t[r]=e[r];for(;r<i;r++)t[r]=e[r]+(t[r-s]>>1)&255}else{for(;r<s;r++)t[r]=e[r]+(n[r]>>1)&255;for(;r<i;r++)t[r]=e[r]+(t[r-s]+n[r]>>1)&255}}function gl(e,t,n,i,s){let r=0;if(0===n.length){for(;r<s;r++)t[r]=e[r];for(;r<i;r++)t[r]=e[r]+t[r-s]&255}else{for(;r<s;r++)t[r]=e[r]+n[r]&255;for(;r<i;r++)t[r]=e[r]+pl(t[r-s],n[r],n[r-s])&255}}function pl(e,t,n){const i=e+t-n,s=Math.abs(i-e),r=Math.abs(i-t),a=Math.abs(i-n);return s<=r&&s<=a?e:r<=a?t:n}const vl={level:3};class wl extends ir{constructor(e,t={}){super(),this._colorType=il.UNKNOWN,this._zlibOptions=Object.assign({},vl,t.zlib),this._png=this._checkData(e),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(el)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(sl.DEFLATE),this.writeByte(rl.ADAPTIVE),this.writeByte(al.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(e){this.writeUint32(e.length),this.writeChars("IDAT"),this.writeBytes(e),this.writeCrc(e.length+4)}encodeData(){const{width:e,height:t,channels:n,depth:i,data:s}=this._png,r=n*e,a=(new ir).setBigEndian();let o=0;for(let e=0;e<t;e++)if(a.writeByte(0),8===i)o=_l(s,a,r,o);else{if(16!==i)throw new Error("unreachable");o=yl(s,a,r,o)}const l=a.toArray(),h=Yo(l,this._zlibOptions);this.encodeIDAT(h)}_checkData(e){const{colorType:t,channels:n,depth:i}=function(e){const{channels:t=4,depth:n=8}=e;if(4!==t&&3!==t&&2!==t&&1!==t)throw new RangeError(`unsupported number of channels: ${t}`);if(8!==n&&16!==n)throw new RangeError(`unsupported bit depth: ${n}`);const i={channels:t,depth:n,colorType:il.UNKNOWN};switch(t){case 4:i.colorType=il.TRUECOLOUR_ALPHA;break;case 3:i.colorType=il.TRUECOLOUR;break;case 1:i.colorType=il.GREYSCALE;break;case 2:i.colorType=il.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return i}(e),s={width:bl(e.width,"width"),height:bl(e.height,"height"),channels:n,data:e.data,depth:i,text:{}};this._colorType=t;const r=s.width*s.height*n;if(s.data.length!==r)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${r}`);return s}writeCrc(e){this.writeUint32(nl(new Uint8Array(this.buffer,this.byteOffset+this.offset-e,e),e))}}function bl(e,t){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${t} must be a positive integer`)}function _l(e,t,n,i){for(let s=0;s<n;s++)t.writeByte(e[i++]);return i}function yl(e,t,n,i){for(let s=0;s<n;s++)t.writeUint16(e[i++]);return i}var Il;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(Il||(Il={}));var xl=de(Object.freeze({__proto__:null,decode:function(e,t){return new cl(e,t).decode()},encode:function(e,t){return new wl(e,t).encode()},get ResolutionUnitSpecifier(){return Il}})),Pl=fe((function(e,t){!function(e,t,n,i){function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=s(n),a=s(i),o={name:"@zeainc/gltf-loader",libraryName:"GLTFLoader",author:"Philip Taylor",description:"A plugin to load GLTF files in Zea Engine.",version:"4.0.7",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.esm.js",browser:"dist/index.umd.js",files:["dist/"],keywords:["WebGL","ES6","Zea","GLTF","Draco"],repository:{type:"git",url:"https://github.com/ZeaInc/gltf-loader"},scripts:{build:"rollup -c","build:watch":"rollup -w -c",dev:"npm-run-all --parallel build:watch start:watch",dist:"yarn publish --access=public",generate:"plop",prepare:"yarn run build",release:"standard-version",start:"es-dev-server","start:watch":"es-dev-server --app-index testing-e2e/index.html --open --watch","test:e2e":"percy exec cypress run --browser chrome --headless","test:e2e:watch":"percy exec cypress open"},devDependencies:{"@percy/cypress":"^2.3.2","@rollup/plugin-json":"^4.1.0","@zeainc/zea-engine":"^4",cypress:"^5.4.0","es-dev-server":"^1.57.8",eslint:"^6.5.1","eslint-config-google":"^0.14.0","eslint-config-prettier":"^6.3.0","eslint-plugin-prettier":"^3.1.1","npm-run-all":"^4.1.5",plop:"^2.7.4",prettier:"^2.1.1",rollup:"^2.2.0","rollup-plugin-terser":"^5.3.0","rollup-plugin-web-worker-loader":"^0.9.0","standard-version":"^9.0.0",yargs:"12.0.2"},dependencies:{"fast-png":"^6.1.0","jpeg-js":"^0.4.3"}};const l={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};function h(e,t,n){let i=new glMatrix.ARRAY_TYPE(n);for(let s=0;s<n;++s)i[s]=e[t+s];return i}function c(e,t,n){for(const i of Object.keys(e)){const s=e[i];if(null!=s&&"string"!=typeof a_string&&(void 0!==s.initGl&&s.initGl(t,n),Array.isArray(s)))for(const e of s)null!=e&&void 0!==e.initGl&&e.initGl(t,n)}}function d(e,t){if(void 0===e)return[];const n=[];for(const i of e)n.push(u(i,t));return n}function u(e,t){const n=new t;return n.fromJson(e),n}function f(e,t,n=[]){for(let i of Object.keys(e))n&&void 0!==n.find((function(e){return e==i}))||void 0===t[i]||(e[i.replace("^@","")]=t[i])}function m(e,t,n){return Math.min(Math.max(e,t),n)}function g(e){return"glb"==function(e){const t=e.toLowerCase().split(".");if(1!=t.length)return t[t.length-1]}(e)}function p(e){return e.substring(0,e.lastIndexOf("/")+1)}class v{constructor(){this.extensions=void 0,this.extras=void 0}fromJson(e){f(this,e)}initGl(e,t){c(this,e,t)}}class w extends v{constructor(){super(),this.bufferView=void 0,this.byteOffset=0,this.componentType=void 0,this.normalized=!1,this.count=void 0,this.type=void 0,this.max=void 0,this.min=void 0,this.sparse=void 0,this.name=void 0,this.glBuffer=void 0,this.typedView=void 0,this.filteredView=void 0,this.normalizedFilteredView=void 0,this.normalizedTypedView=void 0}getTypedView(e){if(void 0!==this.typedView)return this.typedView;if(void 0!==this.bufferView){const t=e.bufferViews[this.bufferView],n=e.buffers[t.buffer],i=this.byteOffset+t.byteOffset,s=this.getComponentSize(this.componentType);let r=this.getComponentCount(this.type),a=0;switch(0!==t.byteStride?0!==s?a=t.byteStride/s*(this.count-1)+r:console.warn("Invalid component type in accessor '"+(this.name?this.name:"")+"'"):a=this.count*r,a*s>n.buffer.byteLength-i&&(a=(n.buffer.byteLength-i)/s,console.warn("Count in accessor '"+(this.name?this.name:"")+"' is too large.")),this.componentType){case l.BYTE:this.typedView=new Int8Array(n.buffer,i,a);break;case l.UNSIGNED_BYTE:this.typedView=new Uint8Array(n.buffer,i,a);break;case l.SHORT:this.typedView=new Int16Array(n.buffer,i,a);break;case l.UNSIGNED_SHORT:this.typedView=new Uint16Array(n.buffer,i,a);break;case l.UNSIGNED_INT:this.typedView=new Uint32Array(n.buffer,i,a);break;case l.FLOAT:this.typedView=new Float32Array(n.buffer,i,a)}}return void 0===this.typedView?console.warn("Failed to convert buffer view to typed view!: "+this.bufferView):void 0!==this.sparse&&this.applySparse(e,this.typedView),this.typedView}getNormalizedTypedView(e){if(void 0!==this.normalizedTypedView)return this.normalizedTypedView;const t=this.getTypedView(e);return this.normalizedTypedView=this.normalized?w.dequantize(t,this.componentType):t,this.normalizedTypedView}getDeinterlacedView(e){if(void 0!==this.filteredView)return this.filteredView;if(void 0!==this.bufferView){const t=e.bufferViews[this.bufferView],n=e.buffers[t.buffer],i=this.byteOffset+t.byteOffset,s=this.getComponentSize(this.componentType),r=this.getComponentCount(this.type),a=this.count*r;let o=0!==t.byteStride?t.byteStride:r*s;const h=n.buffer.byteLength-i;let c=new DataView(n.buffer,i,Math.min(h,this.count*o)),d=c.getFloat32.bind(c);switch(this.componentType){case l.BYTE:this.filteredView=new Int8Array(a),d=c.getInt8.bind(c);break;case l.UNSIGNED_BYTE:this.filteredView=new Uint8Array(a),d=c.getUint8.bind(c);break;case l.SHORT:this.filteredView=new Int16Array(a),d=c.getInt16.bind(c);break;case l.UNSIGNED_SHORT:this.filteredView=new Uint16Array(a),d=c.getUint16.bind(c);break;case l.UNSIGNED_INT:this.filteredView=new Uint32Array(a),d=c.getUint32.bind(c);break;case l.FLOAT:this.filteredView=new Float32Array(a),d=c.getFloat32.bind(c)}for(let e=0;e<a;++e){let t=Math.floor(e/r)*o+e%r*s;this.filteredView[e]=d(t,!0)}}return void 0===this.filteredView?console.warn("Failed to convert buffer view to filtered view!: "+this.bufferView):void 0!==this.sparse&&this.applySparse(e,this.filteredView),this.filteredView}getNormalizedDeinterlacedView(e){if(void 0!==this.normalizedFilteredView)return this.normalizedFilteredView;const t=this.getDeinterlacedView(e);return this.normalizedFilteredView=this.normalized?w.dequantize(t,this.componentType):t,this.normalizedFilteredView}applySparse(e,t){const n=e.bufferViews[this.sparse.indices.bufferView],i=e.buffers[n.buffer],s=this.sparse.indices.byteOffset+n.byteOffset,r=this.getComponentSize(this.sparse.indices.componentType);let a=1;0!==n.byteStride&&(a=n.byteStride/r);const o=this.sparse.count*a;let h;switch(this.sparse.indices.componentType){case l.UNSIGNED_BYTE:h=new Uint8Array(i.buffer,s,o);break;case l.UNSIGNED_SHORT:h=new Uint16Array(i.buffer,s,o);break;case l.UNSIGNED_INT:h=new Uint32Array(i.buffer,s,o)}const c=e.bufferViews[this.sparse.values.bufferView],d=e.buffers[c.buffer],u=this.sparse.values.byteOffset+c.byteOffset,f=this.getComponentSize(this.componentType);let m=this.getComponentCount(this.type);0!==c.byteStride&&(m=c.byteStride/f);const g=this.sparse.count*m;let p;switch(this.componentType){case l.BYTE:p=new Int8Array(d.buffer,u,g);break;case l.UNSIGNED_BYTE:p=new Uint8Array(d.buffer,u,g);break;case l.SHORT:p=new Int16Array(d.buffer,u,g);break;case l.UNSIGNED_SHORT:p=new Uint16Array(d.buffer,u,g);break;case l.UNSIGNED_INT:p=new Uint32Array(d.buffer,u,g);break;case l.FLOAT:p=new Float32Array(d.buffer,u,g)}for(let e=0;e<this.sparse.count;++e)for(let n=0;n<m;++n)t[h[e]*m+n]=p[e*m+n]}static dequantize(e,t){switch(t){case l.BYTE:return new Float32Array(e).map((e=>Math.max(e/127,-1)));case l.UNSIGNED_BYTE:return new Float32Array(e).map((e=>e/255));case l.SHORT:return new Float32Array(e).map((e=>Math.max(e/32767,-1)));case l.UNSIGNED_SHORT:return new Float32Array(e).map((e=>e/65535));default:return e}}getComponentCount(e){return b.get(e)}getComponentSize(e){switch(e){case l.BYTE:case l.UNSIGNED_BYTE:return 1;case l.SHORT:case l.UNSIGNED_SHORT:return 2;case l.UNSIGNED_INT:case l.FLOAT:return 4;default:return 0}}destroy(){void 0!==this.glBuffer&&WebGl.context.deleteBuffer(this.glBuffer),this.glBuffer=void 0}}const b=new Map([["SCALAR",1],["VEC2",2],["VEC3",3],["VEC4",4],["MAT2",4],["MAT3",9],["MAT4",16]]);class _ extends v{constructor(){super(),this.uri=void 0,this.byteLength=void 0,this.name=void 0,this.buffer=void 0}load(e,t){if(void 0!==this.buffer)return void console.error("buffer has already been loaded");const n=this;return new Promise((function(i){n.setBufferFromFiles(t,i)||n.setBufferFromUri(e,i)||(console.error("Was not able to resolve buffer with uri '%s'",n.uri),i())}))}setBufferFromUri(e,n){if(void 0===this.uri)return!1;const i=this;return this.uri.startsWith("data:application")?t.resourceLoader.loadFile("binary",this.uri).then((function(e){i.buffer=e,n()})):t.resourceLoader.loadFile("binary",p(e.path)+this.uri).then((function(e){i.buffer=e,n()})),!0}setBufferFromFiles(e,t){if(void 0===this.uri||void 0===e)return!1;const n=e.find((function(e){if(e.name===this.uri||e.fullPath===this.uri)return!0}),this);if(void 0===n)return!1;const i=this,s=new FileReader;return s.onloadend=function(e){i.buffer=e.target.result,t()},s.readAsArrayBuffer(n),!0}}class y extends v{constructor(){super(),this.buffer=void 0,this.byteOffset=0,this.byteLength=void 0,this.byteStride=0,this.target=void 0,this.name=void 0}}class I extends v{constructor(e="perspective",t=.01,n=1/0,i=45*Math.PI/180,s,r=1,a=1,o,l){super(),this.type=e,this.znear=t,this.zfar=n,this.yfov=i,this.xmag=r,this.ymag=a,this.aspectRatio=s,this.name=o,this.node=l}initGl(e,t){let n;super.initGl(e,t);for(let t=0;t<e.nodes.length;t++)if(n=e.nodes[t].camera,void 0!==n&&e.cameras[n]===this){this.node=t;break}void 0===this.node&&void 0!==n&&console.error("Invalid node for camera "+n)}fromJson(e){this.name=name,void 0!==e.perspective?(this.type="perspective",f(this,e.perspective)):void 0!==e.orthographic&&(this.type="orthographic",f(this,e.orthographic))}sortPrimitivesByDepth(e,t){for(const n of t){const t=mat4.create();mat4.multiply(t,this.getViewMatrix(e),n.node.worldTransform);const i=vec3.transformMat4(vec3.create(),vec3.clone(n.primitive.centroid),t);n.depth=i[2]}return t.filter((e=>e.depth<=0)).sort(((e,t)=>e.depth-t.depth))}getProjectionMatrix(){const e=mat4.create();return"perspective"===this.type?mat4.perspective(e,this.yfov,this.aspectRatio,this.znear,this.zfar):"orthographic"===this.type&&(e[0]=1/this.xmag,e[5]=1/this.ymag,e[10]=2/(this.znear-this.zfar),e[14]=(this.zfar+this.znear)/(this.znear-this.zfar)),e}getViewMatrix(e){const t=mat4.create(),n=this.getPosition(e),i=this.getTarget(e);return mat4.lookAt(t,n,i,vec3.fromValues(0,1,0)),t}getTarget(e){const t=vec3.create(),n=this.getPosition(e),i=this.getLookDirection(e);return vec3.add(t,i,n),t}getPosition(e){const t=vec3.create(),n=this.getNode(e);return mat4.getTranslation(t,n.worldTransform),t}getLookDirection(e){const t=vec3.create(),n=this.getRotation(e);return vec3.transformQuat(t,vec3.fromValues(0,0,-1),n),t}getRotation(e){const t=quat.create(),n=this.getNode(e);return mat4.getRotation(t,n.worldTransform),t}clone(){return new I(this.type,this.znear,this.zfar,this.yfov,this.aspectRatio,this.xmag,this.ymag,this.name,this.node)}getNode(e){return e.nodes[this.node]}getTransformMatrix(e){const t=this.getNode(e);return void 0!==t&&void 0!==t.worldTransform?t.worldTransform:mat4.create()}getDescription(e){const t={type:this.type};void 0!==this.name&&(t.name=this.name),"perspective"===this.type?(t.perspective={},void 0!==this.aspectRatio&&(t.perspective.aspectRatio=this.aspectRatio),t.perspective.yfov=this.yfov,this.zfar!=1/0&&(t.perspective.zfar=this.zfar),t.perspective.znear=this.znear):"orthographic"===this.type&&(t.orthographic={},t.orthographic.xmag=this.xmag,t.orthographic.ymag=this.ymag,t.orthographic.zfar=this.zfar,t.orthographic.znear=this.znear);const n=this.getTransformMatrix(e),i={camera:0,matrix:[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]]};return void 0!==this.nodeIndex&&void 0!==e.nodes[this.nodeIndex].name&&(i.name=e.nodes[this.nodeIndex].name),{asset:{generator:"gltf-sample-viewer",version:"2.0"},cameras:[t],nodes:[i]}}}class x{static async readAsArrayBuffer(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n,i.readAsArrayBuffer(e)}))}static async readAsText(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n,i.readAsText(e)}))}static async readAsDataURL(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n,i.readAsDataURL(e)}))}}const P="image/jpeg",C="image/png",k="image/ktx2",T="image/texture";class A extends v{constructor(e,t=l.TEXTURE_2D,n=0,i,s,r=P,a){super(),this.uri=e,this.bufferView=i,this.mimeType=r,this.image=a,this.name=s,this.type=t,this.miplevel=n}fromJson(e){super.fromJson(e)}resolveRelativePath(e){("string"==typeof this.uri||this.uri instanceof String)&&(this.uri.startsWith("./")&&(this.uri=this.uri.substr(2)),this.uri=e+this.uri)}async load(e,t){void 0===this.image?await this.setImageFromBufferView(e)||await this.setImageFromFiles(t,e)||await this.setImageFromUri(e)||console.error("Was not able to resolve image with uri '%s'",this.uri):this.mimeType!==T&&console.error("image has already been loaded")}static loadHTMLImage(e){return new Promise(((n,i)=>{const s=new t.FileImage(this.name);s.load(e).then((()=>{n(s)}),(()=>{i()}))}))}async setImageFromUri(e){return void 0!==this.uri&&("undefined"==typeof Image||this.mimeType!==P&&this.mimeType!==C?(console.error("Unsupported image type "+this.mimeType),!1):(this.zeaImage=await A.loadHTMLImage(this.uri).catch((e=>{console.error(e)})),!0))}async setImageFromBufferView(e){const t=e.bufferViews[this.bufferView];if(void 0===t)return!1;const n=e.buffers[t.buffer].buffer,i=new Uint8Array(n,t.byteOffset,t.byteLength);if(this.mimeType===k)void 0!==e.ktxDecoder?this.image=await e.ktxDecoder.loadKtxFromBuffer(i):console.warn("Loading of ktx images failed: KtxDecoder not initalized");else if("undefined"==typeof Image||this.mimeType!==P&&this.mimeType!==C)if(this.mimeType===P)this.image=r.decode(i,{useTArray:!0});else{if(this.mimeType!==C)return console.error("Unsupported image type "+this.mimeType),!1;this.image=a.decode(i)}else{const e=new Blob([i],{type:this.mimeType}),t=URL.createObjectURL(e);this.image=await A.loadHTMLImage(t).catch((()=>{console.error("Could not load image from buffer view")}))}return!0}async setImageFromFiles(e,t){if(void 0===this.uri||void 0===e)return!1;let n=e.find((function(e){const t=this.uri.split("\\").pop().split("/").pop();if(e.name===t)return!0}),this);if(void 0===n)return!1;if(this.mimeType===k)if(void 0!==t.ktxDecoder){const e=new Uint8Array(await n.arrayBuffer());this.image=await t.ktxDecoder.loadKtxFromBuffer(e)}else console.warn("Loading of ktx images failed: KtxDecoder not initalized");else{if("undefined"==typeof Image||this.mimeType!==P&&this.mimeType!==C)return console.error("Unsupported image type "+this.mimeType),!1;{const e=await x.readAsDataURL(n).catch((()=>{console.error("Could not load image with FileReader")}));this.image=await A.loadHTMLImage(e).catch((()=>{console.error("Could not create image from FileReader image data")}))}}return!0}}class $ extends v{constructor(e="directional",t=[1,1,1],n=1,i=0,s=Math.PI/4,r=-1,a,o){super(),this.type=e,this.color=t,this.intensity=n,this.innerConeAngle=i,this.outerConeAngle=s,this.range=r,this.name=a,this.node=o,this.direction=void 0}initGl(e,t){super.initGl(e,t);for(let t=0;t<e.nodes.length;t++){const n=e.nodes[t].extensions;if(void 0===n)continue;const i=n.KHR_lights_punctual;if(void 0===i)continue;const s=i.light;if(e.lights[s]===this){this.node=t;break}}}fromJson(e){super.fromJson(e),void 0!==e.spot&&f(this,e.spot)}toUniform(e){const t=new R;if(void 0!==this.node){const r=e.nodes[this.node].worldTransform;var n=vec3.fromValues(1,1,1);mat4.getScaling(n,r);const a=mat4.create();for(const e of[0,1,2])a[e]=r[e]/n[0],a[e+4]=r[e+4]/n[1],a[e+8]=r[e+8]/n[2];var i=quat.create();mat4.getRotation(i,a),quat.normalize(i,i);const o=vec3.fromValues(0,0,-1);vec3.transformQuat(t.direction,o,i);var s=vec3.fromValues(0,0,0);mat4.getTranslation(s,r),t.position=s}switch(void 0!==this.direction&&(t.direction=this.direction),t.range=this.range,t.color=this.color,t.intensity=this.intensity,t.innerConeCos=Math.cos(this.innerConeAngle),t.outerConeCos=Math.cos(this.outerConeAngle),this.type){case"spot":t.type=M;break;case"point":t.type=S;break;default:t.type=E}return t}}const E=0,S=1,M=2;class R extends class{}{constructor(){super();const e=vec3.fromValues(-.7399,-.6428,-.1983);this.direction=e,this.range=-1,this.color=[1,1,1],this.intensity=1,this.position=[0,0,0],this.innerConeCos=0,this.outerConeCos=Math.PI/4,this.type=E,this.padding1=0,this.padding2=0}}class D extends v{constructor(){super(),this.rotation=[0,0,0,1],this.brightnessFactor=1,this.brightnessOffset=0,this.specularEnvironmentTexture=void 0,this.diffuseEnvironmentTexture=void 0,this.sheenEnvironmentTexture=void 0,this.levelCount=1}fromJson(e){super.fromJson(e),void 0!==e.extensions&&this.fromJsonExtensions(e.extensions)}fromJsonExtensions(e){void 0!==e.KHR_materials_sheen&&(this.sheenEnvironmentTexture=e.KHR_materials_sheen.sheenEnvironmentTexture)}initGl(e,t){if(void 0!==this.diffuseEnvironmentTexture&&(e.textures[this.diffuseEnvironmentTexture].type=l.TEXTURE_CUBE_MAP),void 0!==this.specularEnvironmentTexture){const t=e.textures[this.specularEnvironmentTexture];t.type=l.TEXTURE_CUBE_MAP;const n=e.images[t.source];this.levelCount=n.image.levelCount}if(void 0!==this.sheenEnvironmentTexture){const t=e.textures[this.sheenEnvironmentTexture];t.type=l.TEXTURE_CUBE_MAP;const n=e.images[t.source];this.levelCount!==n.image.levelCount&&console.error("Specular and sheen do not have same level count")}}}class O extends v{constructor(e,t,n=l.TEXTURE_2D){super(),this.sampler=e,this.source=t,this.glTexture=void 0,this.type=n,this.initialized=!1,this.mipLevelCount=0}initGl(e,t){void 0===this.sampler&&(this.sampler=e.samplers.length-1),c(this,e,t)}fromJson(e){super.fromJson(e),void 0!==e.extensions&&void 0!==e.extensions.KHR_texture_basisu&&void 0!==e.extensions.KHR_texture_basisu.source&&(this.source=e.extensions.KHR_texture_basisu.source)}destroy(){}}class N{constructor(e,t=0,n=!0,i="",s=!0){this.index=e,this.texCoord=t,this.linear=n,this.samplerName=i,this.strength=1,this.scale=1,this.generateMips=s,this.extensions=void 0}initGl(e,t){c(this,e,t)}fromJson(e){f(this,e)}}class z extends v{constructor(){super(),this.name=void 0,this.pbrMetallicRoughness=void 0,this.normalTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.emissiveFactor=[0,0,0],this.alphaMode="OPAQUE",this.alphaCutoff=.5,this.doubleSided=!1,this.hasClearcoat=!1,this.hasSheen=!1,this.hasTransmission=!1,this.hasIOR=!1,this.hasVolume=!1,this.type="unlit",this.textures=[],this.properties=new Map,this.defines=[]}static createDefault(){const e=new z;e.type="MR",e.name="Default Material",e.defines.push("MATERIAL_METALLICROUGHNESS 1");const n=new t.Vec4(1,1,1,1);return e.properties.set("u_BaseColorFactor",n),e.properties.set("u_MetallicFactor",1),e.properties.set("u_RoughnessFactor",1),e}getShaderIdentifier(){return this.type,"pbr.frag"}getDefines(e){const t=Array.from(this.defines);return this.hasClearcoat&&e.enabledExtensions.KHR_materials_clearcoat&&t.push("MATERIAL_CLEARCOAT 1"),this.hasSheen&&e.enabledExtensions.KHR_materials_sheen&&t.push("MATERIAL_SHEEN 1"),this.hasTransmission&&e.enabledExtensions.KHR_materials_transmission&&t.push("MATERIAL_TRANSMISSION 1"),this.hasVolume&&e.enabledExtensions.KHR_materials_volume&&t.push("MATERIAL_VOLUME 1"),this.hasIOR&&e.enabledExtensions.KHR_materials_ior&&t.push("MATERIAL_IOR 1"),this.hasSpecular&&e.enabledExtensions.KHR_materials_specular&&t.push("MATERIAL_SPECULAR 1"),t}getProperties(){return this.properties}getTextures(){return this.textures}parseTextureInfoExtensions(e,n){if(void 0!==e.extensions&&void 0!==e.extensions.KHR_texture_transform){const i=e.extensions.KHR_texture_transform;void 0!==i.texCoord&&(e.texCoord=i.texCoord);let s=new t.Mat3,r=new t.Mat3,a=new t.Mat3;if(void 0!==i.rotation){const e=Math.sin(i.rotation),n=Math.cos(i.rotation);s=new t.Mat3([n,e,0,-e,n,0,0,0,1])}void 0!==i.scale&&(r=new t.Mat3([i.scale[0],0,0,0,i.scale[1],0,0,0,1])),void 0!==i.offset&&(a=new t.Mat3([1,0,i.offset[0],0,1,i.offset[1],0,0,1]));const o=s.multiply(r);o.multiplyInPlace(a),this.defines.push("HAS_"+n.toUpperCase()+"_UV_TRANSFORM 1"),this.properties.set("u_"+n+"UVTransform",o)}}initGl(e,n){this.zeaMaterial=new t.Material(this.name,"StandardSurfaceShader");const i=(t,n)=>{const i=e.textures[t.index],s=e.samplers[i.sampler],r=e.images[i.source];r.zeaImage.wrapS=s.wrapS,r.zeaImage.wrapT=s.wrapT,n.setImage(r.zeaImage)};if(void 0!==this.normalTexture&&i(this.normalTexture,this.zeaMaterial.getParameter("Normal")),void 0!==this.occlusionTexture&&i(this.occlusionTexture,this.zeaMaterial.getParameter("AmbientOcclusion")),this.properties.set("u_EmissiveFactor",this.emissiveFactor),void 0!==this.emissiveTexture&&i(this.emissiveTexture,this.zeaMaterial.getParameter("EmissiveStrength")),void 0!==this.baseColorTexture&&i(this.baseColorTexture,this.zeaMaterial.getParameter("BaseColor")),void 0!==this.metallicRoughnessTexture&&i(this.metallicRoughnessTexture,this.zeaMaterial.getParameter("Metallic")),void 0!==this.diffuseTexture&&i(this.diffuseTexture,this.zeaMaterial.getParameter("BaseColor")),void 0!==this.specularGlossinessTexture&&i(this.specularGlossinessTexture,this.zeaMaterial.getParameter("Reflectance")),"MASK"===this.alphaMode?(this.defines.push("ALPHAMODE_MASK 1"),this.properties.set("u_AlphaCutoff",this.alphaCutoff)):"OPAQUE"===this.alphaMode&&this.defines.push("ALPHAMODE_OPAQUE 1"),void 0!==this.pbrMetallicRoughness&&"SG"!==this.type){this.defines.push("MATERIAL_METALLICROUGHNESS 1");let e=new t.Color(1,1,1,1),n=1,i=1;void 0!==this.pbrMetallicRoughness.baseColorFactor&&e.set(...this.pbrMetallicRoughness.baseColorFactor),void 0!==this.pbrMetallicRoughness.metallicFactor&&(n=this.pbrMetallicRoughness.metallicFactor),void 0!==this.pbrMetallicRoughness.roughnessFactor&&(i=this.pbrMetallicRoughness.roughnessFactor),this.properties.set("u_BaseColorFactor",e),this.properties.set("u_MetallicFactor",n),this.properties.set("u_RoughnessFactor",i),this.zeaMaterial.getParameter("BaseColor").setValue(e),this.zeaMaterial.getParameter("Metallic").setValue(n),this.zeaMaterial.getParameter("Roughness").setValue(i)}if(void 0!==this.extensions&&(void 0!==this.extensions.KHR_materials_unlit&&this.defines.push("MATERIAL_UNLIT 1"),void 0!==this.extensions.KHR_materials_pbrSpecularGlossiness)){this.defines.push("MATERIAL_SPECULARGLOSSINESS 1");let e=new t.Color(1,1,1,1),n=new t.Vec3(1,1,1),i=1;void 0!==this.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor&&(e=this.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor),void 0!==this.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor&&(n=this.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor),void 0!==this.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor&&(i=this.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor),this.properties.set("u_DiffuseFactor",e),this.properties.set("u_SpecularFactor",n),this.properties.set("u_GlossinessFactor",i)}c(this,e,n)}fromJson(e){if(super.fromJson(e),void 0!==e.emissiveFactor&&(this.emissiveFactor=e.emissiveFactor),void 0!==e.normalTexture){const t=new N;t.fromJson(e.normalTexture),this.normalTexture=t}if(void 0!==e.occlusionTexture){const t=new N;t.fromJson(e.occlusionTexture),this.occlusionTexture=t}if(void 0!==e.emissiveTexture){const t=new N(void 0,0,!1);t.fromJson(e.emissiveTexture),this.emissiveTexture=t}void 0!==e.extensions&&this.fromJsonMaterialExtensions(e.extensions),void 0!==e.pbrMetallicRoughness&&"SG"!==this.type&&(this.type="MR",this.fromJsonMetallicRoughness(e.pbrMetallicRoughness))}fromJsonMaterialExtensions(e){void 0!==e.KHR_materials_pbrSpecularGlossiness&&(this.type="SG",this.fromJsonSpecularGlossiness(e.KHR_materials_pbrSpecularGlossiness)),void 0!==e.KHR_materials_unlit&&(this.type="unlit"),void 0!==e.KHR_materials_clearcoat&&this.fromJsonClearcoat(e.KHR_materials_clearcoat),void 0!==e.KHR_materials_sheen&&this.fromJsonSheen(e.KHR_materials_sheen),void 0!==e.KHR_materials_transmission&&this.fromJsonTransmission(e.KHR_materials_transmission),void 0!==e.KHR_materials_specular&&this.fromJsonSpecular(e.KHR_materials_specular),void 0!==e.KHR_materials_volume&&this.fromJsonVolume(e.KHR_materials_volume)}fromJsonMetallicRoughness(e){if(void 0!==e.baseColorTexture){const t=new N(void 0,0,!1);t.fromJson(e.baseColorTexture),this.baseColorTexture=t}if(void 0!==e.metallicRoughnessTexture){const t=new N;t.fromJson(e.metallicRoughnessTexture),this.metallicRoughnessTexture=t}}fromJsonSpecularGlossiness(e){if(void 0!==e.diffuseTexture){const t=new N(void 0,0,!1);t.fromJson(e.diffuseTexture),this.diffuseTexture=t}if(void 0!==e.specularGlossinessTexture){const t=new N(void 0,0,!1);t.fromJson(e.specularGlossinessTexture),this.specularGlossinessTexture=t}}fromJsonClearcoat(e){if(void 0!==e.clearcoatTexture){const t=new N;t.fromJson(e.clearcoatTexture),this.clearcoatTexture=t}if(void 0!==e.clearcoatRoughnessTexture){const t=new N;t.fromJson(e.clearcoatRoughnessTexture),this.clearcoatRoughnessTexture=t}if(void 0!==e.clearcoatNormalTexture){const t=new N;t.fromJson(e.clearcoatNormalTexture),this.clearcoatNormalTexture=t}}fromJsonSheen(e){if(void 0!==e.sheenColorTexture){const t=new N(void 0,0,!1);t.fromJson(e.sheenColorTexture),this.sheenColorTexture=t}if(void 0!==e.sheenRoughnessTexture){const t=new N;t.fromJson(e.sheenRoughnessTexture),this.sheenRoughnessTexture=t}}fromJsonTransmission(e){if(void 0!==e.transmissionTexture){const t=new N;t.fromJson(e.transmissionTexture),this.transmissionTexture=t}}fromJsonSpecular(e){if(void 0!==e.specularTexture){const t=new N;t.fromJson(e.specularTexture),this.specularTexture=t}if(void 0!==e.specularTexture){const t=new N;t.fromJson(e.specularTexture),this.specularTexture=t}}fromJsonVolume(e){if(void 0!==e.thicknessTexture){const t=new N;t.fromJson(e.thicknessTexture),this.thicknessTexture=t}}}class L{constructor(e){if(!L.instance&&void 0===e){if(void 0===DracoDecoderModule)return void console.error("Failed to initalize DracoDecoder: draco library undefined");e=DracoDecoderModule}return L.instance||(L.instance=this,this.module=null,this.initializingPromise=new Promise((t=>{let n={};n.onModuleLoaded=e=>{this.module=e,t()},e(n)}))),L.instance}async ready(){await this.initializingPromise,Object.freeze(L.instance)}}class V extends v{constructor(){super(),this.attributes=[],this.targets=[],this.indices=void 0,this.material=void 0,this.mode="TRIANGLES",this.glAttributes=[],this.defines=[],this.skip=!0,this.hasWeights=!1,this.hasJoints=!1,this.hasNormals=!1,this.hasTangents=!1,this.hasTexcoord=!1,this.hasColor=!1,this.centroid=void 0}initGl(e,n){if(void 0===this.material&&(this.material=e.materials.length-1),void 0!==this.extensions&&void 0!==this.extensions.KHR_draco_mesh_compression){const t=new L;if(void 0!==t&&Object.isFrozen(t)){let t=this.decodeDracoBufferToIntermediate(this.extensions.KHR_draco_mesh_compression,e);this.copyDataFromDecodedGeometry(e,t,this.attributes)}else console.warn("Failed to load draco compressed mesh: DracoDecoder not initialized")}for(const t of Object.keys(this.attributes)){const n=this.attributes[t];switch(t){case"POSITION":this.skip=!1,this.glAttributes.push({attribute:t,name:"a_Position",accessor:n});break;case"NORMAL":this.hasNormals=!0,this.defines.push("HAS_NORMALS 1"),this.glAttributes.push({attribute:t,name:"a_Normal",accessor:n});break;case"TANGENT":this.hasTangents=!0,this.defines.push("HAS_TANGENTS 1"),this.glAttributes.push({attribute:t,name:"a_Tangent",accessor:n});break;case"TEXCOORD_0":this.hasTexcoord=!0,this.defines.push("HAS_UV_SET1 1"),this.glAttributes.push({attribute:t,name:"a_UV1",accessor:n});break;case"TEXCOORD_1":this.hasTexcoord=!0,this.defines.push("HAS_UV_SET2 1"),this.glAttributes.push({attribute:t,name:"a_UV2",accessor:n});break;case"COLOR_0":this.hasColor=!0;const i=e.accessors[n];this.defines.push("HAS_VERTEX_COLOR_"+i.type+" 1"),this.glAttributes.push({attribute:t,name:"a_Color",accessor:n});break;case"JOINTS_0":this.hasJoints=!0,this.defines.push("HAS_JOINT_SET1 1"),this.glAttributes.push({attribute:t,name:"a_Joint1",accessor:n});break;case"WEIGHTS_0":this.hasWeights=!0,this.defines.push("HAS_WEIGHT_SET1 1"),this.glAttributes.push({attribute:t,name:"a_Weight1",accessor:n});break;case"JOINTS_1":this.hasJoints=!0,this.defines.push("HAS_JOINT_SET2 1"),this.glAttributes.push({attribute:t,name:"a_Joint2",accessor:n});break;case"WEIGHTS_1":this.hasWeights=!0,this.defines.push("HAS_WEIGHT_SET2 1"),this.glAttributes.push({attribute:t,name:"a_Weight2",accessor:n});break;default:console.log("Unknown attribute: "+t)}}const i=e.materials[this.material];let s=i.zeaMaterial;const r=e.accessors[this.attributes.POSITION],a={geomBuffers:{numVertices:r.count,attrBuffers:{}},bbox:new t.Box3(new t.Vec3(...r.min),new t.Vec3(...r.max))};if(void 0!==this.indices){const t=e.accessors[this.indices].getTypedView(e);a.geomBuffers.indices=t}for(const n of Object.keys(this.attributes)){const i=this.attributes[n],r=e.accessors[i],o=e.bufferViews[r.bufferView],l=r.getComponentSize(r.componentType),h=r.getComponentCount(r.type);let c;switch(c=0==o.byteStride||o.byteStride==l*h?r.getTypedView(e):r.getDeinterlacedView(e),n){case"POSITION":a.geomBuffers.attrBuffers.positions={dataType:"Vec3",normalized:!1,values:c};break;case"NORMAL":a.geomBuffers.attrBuffers.normals={dataType:"Vec3",normalized:!0,values:c};break;case"TEXCOORD_0":a.geomBuffers.attrBuffers.texCoords={dataType:"Vec2",normalized:!1,values:c};break;case"COLOR_0":let n=!0;for(let e=1;e<c.length/h;e++)for(let t=0;t<h;t++)c[t]!=c[e*h+t]&&(n=!1);if(n){const n=`Material [R=${c[0]}, G=${c[1]}, B=${c[2]}]`;if(e.materialsMap[n])s=e.materialsMap[n];else{const i=new t.Color;1==l?i.set(c[0]/256,c[1]/256,c[2]/256,4==h?c[3]/256:1):4==l&&i.set(c[0],c[1],c[2],4==h?c[3]:1),s=s.clone(),s.getParameter("BaseColor").setValue(i),e.materialsMap[n]=s}}else a.geomBuffers.attrBuffers.vertexColors={dataType:"Color",normalized:!1,values:c}}}let o;switch(this.mode){case"POINTS":case 0:{a.name="GLTFPoints",o=new t.PointsProxy(a);const n=s.getParameter("BaseColor").getValue(),i=`PointsMaterial [${n.r.toFixed(2)}, ${n.g.toFixed(2)}, ${n.b.toFixed(2)}]`;e.materialsMap[i]?s=e.materialsMap[i]:(s=s.clone(),s.setShaderName("PointsShader"),e.materialsMap[i]=s);break}case"LINES":case 1:{a.name="GLTFLines",o=new t.LinesProxy(a);const n=s.getParameter("BaseColor").getValue(),i=`LinesMaterial [R=${n.r.toFixed(2)}, G=${n.g.toFixed(2)}, B=${n.b.toFixed(2)}]`;e.materialsMap[i]?s=e.materialsMap[i]:(s=s.clone(),s.setShaderName("LinesShader"),e.materialsMap[i]=s);break}case"LINE_LOOP":case 2:{if(a.name="GLTFLineLoop",null==a.geomBuffers.indices){const e=new Uint32Array(2*a.geomBuffers.numVertices);for(let t=0;t<a.geomBuffers.numVertices;t++)e[2*t]=t,e[2*t+1]=(t+1)%e.length;a.geomBuffers.indices=e}else{const e=a.geomBuffers.indices,t=new Uint32Array(2*e.length);t[0]=e[0],t[1]=e[1];let n=1;for(let i=2;i<=e.length;i++)t[2*n]=e[i-1],t[2*n+1]=e[i%e.length],n++;1209==t[0]&&console.log(a.name,a.geomBuffers.indices.toString()),a.geomBuffers.indices=t}o=new t.LinesProxy(a);const n=s.getParameter("BaseColor").getValue(),i=`LinesMaterial [R=${n.r.toFixed(2)}, G=${n.g.toFixed(2)}, B=${n.b.toFixed(2)}]`;e.materialsMap[i]?s=e.materialsMap[i]:(s=s.clone(),s.setShaderName("LinesShader"),e.materialsMap[i]=s);break}case"LINE_STRIP":case 3:{if(a.name="GLTFLineStrip",null==a.geomBuffers.indices){const e=new Uint32Array(2*(a.geomBuffers.numVertices-1));for(let t=0;t<a.geomBuffers.numVertices-1;t++)e[2*t]=t,e[2*t+1]=t+1;a.geomBuffers.indices=e}else{const e=a.geomBuffers.indices,t=new Uint32Array(2*(e.length-1));t[0]=e[0],t[1]=e[1];let n=1;for(let i=2;i<e.length;i++)t[2*n]=e[i-1],t[2*n+1]=e[i],n++;1209==t[0]&&console.log(a.name,a.geomBuffers.indices.toString()),a.geomBuffers.indices=t}o=new t.LinesProxy(a);const n=s.getParameter("BaseColor").getValue(),i=`LinesMaterial [R=${n.r.toFixed(2)}, G=${n.g.toFixed(2)}, B=${n.b.toFixed(2)}]`;e.materialsMap[i]?s=e.materialsMap[i]:(s=s.clone(),s.setShaderName("LinesShader"),e.materialsMap[i]=s);break}case"TRIANGLES":case 4:if(a.name="GLTFMesh",null==a.geomBuffers.indices){const e=new Uint32Array(a.geomBuffers.numVertices);for(let t=0;t<a.geomBuffers.numVertices;t++)e[t]=t;a.geomBuffers.indices=e}o=new t.MeshProxy(a);break;case"TRIANGLE_STRIP":case 5:if(a.name="GLTFMesh",null==a.geomBuffers.indices){const e=new Uint32Array(3*a.geomBuffers.numVertices-2);e[0]=0,e[1]=1,e[2]=2;for(let t=3;t<e.length;t+=3)e[t-2]=e[t-1],e[t-1]=e[t-2],e[t]=t;a.geomBuffers.indices=e}else{const e=a.geomBuffers.indices,t=e.length-2,n=new Uint32Array(3*t);n[0]=e[0],n[1]=e[1],n[2]=e[2];let i=1;for(let t=3;t<e.length;t++)n[3*i]=e[t-2],n[3*i+1]=e[t-1],n[3*i+2]=e[t],i++;a.geomBuffers.indices=n}o=new t.MeshProxy(a);break;case"TRIANGLE_FAN":case 6:if(a.name="GLTFMesh",null==a.geomBuffers.indices){const e=new Uint32Array(3*a.geomBuffers.numVertices-2);e[0]=0,e[1]=1,e[2]=2;for(let t=3;t<e.length;t+=3)e[t-2]=e[0],e[t-1]=e[t-1],e[t]=t;a.geomBuffers.indices=e}else{const e=a.geomBuffers.indices,t=e.length-2,n=new Uint32Array(3*t);n[0]=e[0],n[1]=e[1],n[2]=e[2];let i=1;for(let t=3;t<e.length;t++)n[3*i]=e[0],n[3*i+1]=e[t-1],n[3*i+2]=e[t],i++;a.geomBuffers.indices=n}o=new t.MeshProxy(a)}if(o){if("OPAQUE"==i.alphaMode){const e=s.getParameter("BaseColor").getValue();e.a=1,s.getParameter("BaseColor").setValue(e)}const e=new t.GeomItem(a.name,o,s);n.addChild(e,!1)}}computeCentroid(e,t){const n=e.accessors[this.attributes.POSITION].getTypedView(e);if(void 0!==this.indices){const t=e.accessors[this.indices].getTypedView(e),i=new Float32Array(3);for(let e=0;e<t.length;e++){const s=3*t[e];i[0]+=n[s],i[1]+=n[s+1],i[2]+=n[s+2]}const s=new Float32Array([i[0]/t.length,i[1]/t.length,i[2]/t.length]);this.centroid=s}else{const e=new Float32Array(3);for(let t=0;t<n.length;t+=3)e[0]+=n[t],e[1]+=n[t+1],e[2]+=n[t+2];const t=n.length/3,i=new Float32Array([e[0]/t,e[1]/t,e[2]/t]);this.centroid=i}}getShaderIdentifier(){return"primitive.vert"}getDefines(){return this.defines}fromJson(e){super.fromJson(e),void 0!==e.extensions&&this.fromJsonPrimitiveExtensions(e.extensions)}fromJsonPrimitiveExtensions(e){void 0!==e.KHR_materials_variants&&this.fromJsonVariants(e.KHR_materials_variants)}fromJsonVariants(e){void 0!==e.mappings&&(this.mappings=e.mappings)}copyDataFromDecodedGeometry(e,t,n){let i=t.index.array;if(this.loadBufferIntoGltf(i,e,this.indices,34963,"index buffer view"),void 0!==t.attributes.POSITION){let i=this.loadArrayIntoArrayBuffer(t.attributes.POSITION.array,t.attributes.POSITION.componentType);this.loadBufferIntoGltf(i,e,n.POSITION,34962,"position buffer view")}if(void 0!==t.attributes.NORMAL){let i=this.loadArrayIntoArrayBuffer(t.attributes.NORMAL.array,t.attributes.NORMAL.componentType);this.loadBufferIntoGltf(i,e,n.NORMAL,34962,"normal buffer view")}if(void 0!==t.attributes.TEXCOORD_0){let i=this.loadArrayIntoArrayBuffer(t.attributes.TEXCOORD_0.array,t.attributes.TEXCOORD_0.componentType);this.loadBufferIntoGltf(i,e,n.TEXCOORD_0,34962,"TEXCOORD_0 buffer view")}if(void 0!==t.attributes.TEXCOORD_1){let i=this.loadArrayIntoArrayBuffer(t.attributes.TEXCOORD_1.array,t.attributes.TEXCOORD_1.componentType);this.loadBufferIntoGltf(i,e,n.TEXCOORD_1,34962,"TEXCOORD_1 buffer view")}if(void 0!==t.attributes.TANGENT){let i=this.loadArrayIntoArrayBuffer(t.attributes.TANGENT.array,t.attributes.TANGENT.componentType);this.loadBufferIntoGltf(i,e,n.TANGENT,34962,"Tangent buffer view")}if(void 0!==t.attributes.COLOR_0){let i=this.loadArrayIntoArrayBuffer(t.attributes.COLOR_0.array,t.attributes.COLOR_0.componentType);this.loadBufferIntoGltf(i,e,n.COLOR_0,34962,"color buffer view")}if(void 0!==t.attributes.JOINTS_0){let i=this.loadArrayIntoArrayBuffer(t.attributes.JOINTS_0.array,t.attributes.JOINTS_0.componentType);this.loadBufferIntoGltf(i,e,n.JOINTS_0,34963,"JOINTS_0 buffer view")}if(void 0!==t.attributes.WEIGHTS_0){let i=this.loadArrayIntoArrayBuffer(t.attributes.WEIGHTS_0.array,t.attributes.WEIGHTS_0.componentType);this.loadBufferIntoGltf(i,e,n.WEIGHTS_0,34963,"WEIGHTS_0 buffer view")}if(void 0!==t.attributes.JOINTS_1){let i=this.loadArrayIntoArrayBuffer(t.attributes.JOINTS_1.array,t.attributes.JOINTS_1.componentType);this.loadBufferIntoGltf(i,e,n.JOINTS_1,34963,"JOINTS_1 buffer view")}if(void 0!==t.attributes.WEIGHTS_1){let i=this.loadArrayIntoArrayBuffer(t.attributes.WEIGHTS_1.array,t.attributes.WEIGHTS_1.componentType);this.loadBufferIntoGltf(i,e,n.WEIGHTS_1,34963,"WEIGHTS_1 buffer view")}}loadBufferIntoGltf(e,t,n,i,s){const r=new _;r.byteLength=e.byteLength,r.buffer=e,t.buffers.push(r);const a=new y;a.buffer=t.buffers.length-1,a.byteLength=e.byteLength,void 0!==s&&(a.name=s),a.target=i,t.bufferViews.push(a),t.accessors[n].byteOffset=0,t.accessors[n].bufferView=t.bufferViews.length-1}loadArrayIntoArrayBuffer(e,t){let n;switch(t){case"Int8Array":n=new ArrayBuffer(e.length),new Int8Array(n).set(e);break;case"Uint8Array":n=new ArrayBuffer(e.length),new Uint8Array(n).set(e);break;case"Int16Array":n=new ArrayBuffer(2*e.length),new Int16Array(n).set(e);break;case"Uint16Array":n=new ArrayBuffer(2*e.length),new Uint16Array(n).set(e);break;case"Int32Array":n=new ArrayBuffer(4*e.length),new Int32Array(n).set(e);break;case"Uint32Array":n=new ArrayBuffer(4*e.length),new Uint32Array(n).set(e);break;default:n=new ArrayBuffer(4*e.length),new Float32Array(n).set(e)}return n}decodeDracoBufferToIntermediate(e,t){let n=e.bufferView;const i=t.bufferViews[n],s=t.buffers[i.buffer],r=new Int8Array(s.buffer).slice(i.byteOffset,i.byteOffset+i.byteLength);let a=(new L).module,o=new a.Decoder,l=new a.DecoderBuffer;l.Init(r,i.byteLength);let h=this.decodeGeometry(a,o,l,e.attributes,t);return a.destroy(l),h}getDracoArrayTypeFromComponentType(e){switch(e){case l.BYTE:return"Int8Array";case l.UNSIGNED_BYTE:return"Uint8Array";case l.SHORT:return"Int16Array";case l.UNSIGNED_SHORT:return"Uint16Array";case l.INT:return"Int32Array";case l.UNSIGNED_INT:return"Uint32Array";case l.FLOAT:default:return"Float32Array"}}decodeGeometry(e,t,n,i,s){let r,a,o=t.GetEncodedGeometryType(n);if(o!==e.TRIANGULAR_MESH)throw new Error("DRACOLoader: Unexpected geometry type.");if(r=new e.Mesh,a=t.DecodeBufferToMesh(n,r),!a.ok()||0===r.ptr)throw new Error("DRACOLoader: Decoding failed: "+a.error_msg());let h={index:null,attributes:{}},c=r.num_points();for(let n in i){let a,o=l.BYTE;for(const[e,t]of Object.entries(this.attributes))if(e===n){o=s.accessors[t].componentType,a=s.accessors[t].count;break}if(c!==a)throw new Error(`DRACOLoader: Accessor vertex count ${a} does not match draco decoder vertex count  ${c}`);o=this.getDracoArrayTypeFromComponentType(o);let u=t.GetAttributeByUniqueId(r,i[n]);var d=this.decodeAttribute(e,t,r,n,u,o);h.attributes[d.name]=d}if(o===e.TRIANGULAR_MESH){let n=3*r.num_faces(),i=4*n,s=e._malloc(i);t.GetTrianglesUInt32Array(r,i,s);let a=new Uint32Array(e.HEAPU32.buffer,s,n).slice();e._free(s),h.index={array:a,itemSize:1}}return e.destroy(r),h}decodeAttribute(e,t,n,i,s,r){let a,o,l,h=s.num_components(),c=n.num_points()*h;switch(r){case"Float32Array":l=4*c,a=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_FLOAT32,l,a),o=new Float32Array(e.HEAPF32.buffer,a,c).slice(),e._free(a);break;case"Int8Array":a=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_INT8,c,a),o=new Int8Array(e.HEAP8.buffer,a,c).slice(),e._free(a);break;case"Int16Array":l=2*c,a=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_INT16,l,a),o=new Int16Array(e.HEAP16.buffer,a,c).slice(),e._free(a);break;case"Int32Array":l=4*c,a=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_INT32,l,a),o=new Int32Array(e.HEAP32.buffer,a,c).slice(),e._free(a);break;case"Uint8Array":a=e._malloc(c),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_UINT8,c,a),o=new Uint8Array(e.HEAPU8.buffer,a,c).slice(),e._free(a);break;case"Uint16Array":l=2*c,a=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_UINT16,l,a),o=new Uint16Array(e.HEAPU16.buffer,a,c).slice(),e._free(a);break;case"Uint32Array":l=4*c,a=e._malloc(l),t.GetAttributeDataArrayForAllPoints(n,s,e.DT_UINT32,l,a),o=new Uint32Array(e.HEAPU32.buffer,a,c).slice(),e._free(a);break;default:throw new Error("DRACOLoader: Unexpected attribute type.")}return{name:i,array:o,itemSize:h,componentType:r}}}class B extends v{constructor(){super(),this.primitives=[],this.name=void 0,this.weights=[],this.weightsAnimated=void 0}fromJson(e){super.fromJson(e),void 0!==e.name&&(this.name=e.name),this.primitives=d(e.primitives,V),void 0!==e.weights&&(this.weights=e.weights)}getWeightsAnimated(){return void 0!==this.weightsAnimated?this.weightsAnimated:this.weights}initGl(e,t){this.primitives.forEach((n=>{n.initGl(e,t)}))}}class U extends v{constructor(){super(),this.camera=void 0,this.children=[],this.matrix=void 0,this.rotation=[0,0,0,1],this.scale=[1,1,1],this.translation=[0,0,0],this.name=void 0,this.mesh=void 0,this.skin=void 0,this.light=void 0,this.changed=!0,this.animationRotation=void 0,this.animationTranslation=void 0,this.animationScale=void 0}fromJson(e){super.fromJson(e)}initGl(e,n){let i;if(this.extras){if(window.zeaCad){const{CADBody:e}=zeaCad;i=new e(this.name)}else i=new t.TreeItem(this.name);for(let e in this.extras){const n=this.extras[e];"string"==typeof n?i.addParameter(new t.StringParameter(e,n)):"boolean"==typeof n?i.addParameter(new t.BooleanParameter(e,n)):"number"==typeof n?i.addParameter(new t.NumberParameter(e,n)):"object"==typeof n&&i.addParameter(new t.Parameter(e,n,"json"))}i.extras=this.extras}else i=new t.TreeItem(this.name);const s=new t.Xfo;if(void 0!==this.matrix){const e=new t.Mat4(Float32Array.from(this.matrix));s.setFromMat4(e)}else void 0!==this.scale&&s.sc.set(...this.scale),void 0!==this.rotation&&s.ori.set(...this.rotation),void 0!==this.translation&&s.tr.set(...this.translation);i.getParameter("LocalXfo").setValue(s),this.children.forEach((t=>{e.nodes[t].initGl(e,i)})),null!=this.mesh&&e.meshes[this.mesh].initGl(e,i),n.addChild(i,!1),t.resourceLoader.incrementWorkDone(1)}applyMatrix(e){this.matrix=e,mat4.getScaling(this.scale,this.matrix);const t=mat4.create();for(const e of[0,1,2])t[e]=this.matrix[e]/this.scale[0],t[e+4]=this.matrix[e+4]/this.scale[1],t[e+8]=this.matrix[e+8]/this.scale[2];mat4.getRotation(this.rotation,t),quat.normalize(this.rotation,this.rotation),mat4.getTranslation(this.translation,this.matrix),this.changed=!0}applyTranslationAnimation(e){this.animationTranslation=e,this.changed=!0}applyRotationAnimation(e){this.animationRotation=e,this.changed=!0}applyScaleAnimation(e){this.animationScale=e,this.changed=!0}resetTransform(){this.rotation=[0,0,0,1],this.scale=[1,1,1],this.translation=[0,0,0],this.changed=!0}getLocalTransform(){if(void 0===this.transform||this.changed){this.transform=mat4.create();const e=void 0!==this.animationTranslation?this.animationTranslation:this.translation,t=void 0!==this.animationRotation?this.animationRotation:this.rotation,n=void 0!==this.animationScale?this.animationScale:this.scale;mat4.fromRotationTranslationScale(this.transform,t,e,n),this.changed=!1}return mat4.clone(this.transform)}}class X extends v{constructor(e="LINEAR",t="LINEAR_MIPMAP_LINEAR",n="REPEAT",i="REPEAT"){super(),this.magFilter=e,this.minFilter=t,this.wrapS=n,this.wrapT=i,this.name=void 0}static createDefault(){return new X}}class F extends v{constructor(e=[],t){super(),this.nodes=e,this.name=t,this.imageBasedLight=void 0}initGl(e,t){if(void 0!==this.extensions&&void 0!==this.extensions.KHR_lights_image_based){const t=this.extensions.KHR_lights_image_based.imageBasedLight;this.imageBasedLight=e.imageBasedLights[t]}this.nodes.forEach((n=>{e.nodes[n].initGl(e,t)}))}gatherNodes(e){const t=[];function n(i){const s=e.nodes[i];t.push(s);for(const e of s.children)n(e)}for(const e of this.nodes)n(e);return t}includesNode(e,t){let n=[...this.nodes];for(;n.length>0;){const i=n.pop();if(i===t)return!0;n=n.concat(e.nodes[i].children)}return!1}}class G extends v{constructor(){super(),this.copyright=void 0,this.generator=void 0,this.version=void 0,this.minVersion=void 0}}class H extends v{constructor(){super(),this.target={node:void 0,path:void 0},this.sampler=void 0}}const j="translation",Z="rotation",J="scale",K="weights";class W extends v{constructor(){super(),this.input=void 0,this.interpolation=void 0,this.output=void 0}}const Y="LINEAR",q="STEP",Q="CUBICSPLINE";class ee{constructor(){this.prevKey=0,this.prevT=0}slerpQuat(e,t,n){const i=quat.create(),s=quat.create();quat.normalize(i,e),quat.normalize(s,t);const r=quat.create();return quat.slerp(r,i,s,n),quat.normalize(r,r),r}step(e,t,n){const i=new glMatrix.ARRAY_TYPE(n);for(let s=0;s<n;++s)i[s]=t[e*n+s];return i}linear(e,t,n,i,s){const r=new glMatrix.ARRAY_TYPE(s);for(let a=0;a<s;++a)r[a]=n[e*s+a]*(1-i)+n[t*s+a]*i;return r}cubicSpline(e,t,n,i,s,r){const a=e*r*3,o=t*r*3,l=1*r,h=2*r,c=new glMatrix.ARRAY_TYPE(r),d=s**2,u=s**3;for(let e=0;e<r;++e){const t=n[a+e+l],r=i*n[o+e+0],f=i*n[a+e+h],m=n[o+e+l];c[e]=(2*u-3*d+1)*t+(u-2*d+s)*f+(-2*u+3*d)*m+(u-d)*r}return c}resetKey(){this.prevKey=0}interpolate(e,t,n,i,s,r){if(void 0===i)return;const a=e.accessors[n.input].getNormalizedDeinterlacedView(e),o=e.accessors[n.output].getNormalizedDeinterlacedView(e);if(o.length===s)return h(o,0,s);i=m(i%=r,a[0],a[a.length-1]),this.prevT>i&&(this.prevKey=0),this.prevT=i;let l=null;for(let e=this.prevKey;e<a.length;++e)if(i<=a[e]){l=m(e,1,a.length-1);break}this.prevKey=m(l-1,0,l);const c=a[l]-a[this.prevKey],d=(i-a[this.prevKey])/c;if(t.target.path===Z){if(Q===n.interpolation){const e=this.cubicSpline(this.prevKey,l,o,c,d,4);return quat.normalize(e,e),e}if(n.interpolation===Y){const e=this.getQuat(o,this.prevKey),t=this.getQuat(o,l);return this.slerpQuat(e,t,d)}if(n.interpolation===q)return this.getQuat(o,this.prevKey)}switch(n.interpolation){case q:return this.step(this.prevKey,o,s);case Q:return this.cubicSpline(this.prevKey,l,o,c,d,s);default:return this.linear(this.prevKey,l,o,d,s)}}getQuat(e,t){const n=e[4*t],i=e[4*t+1],s=e[4*t+2],r=e[4*t+3];return quat.fromValues(n,i,s,r)}}class te extends v{constructor(){super(),this.channels=[],this.samplers=[],this.name="",this.interpolators=[],this.maxTime=0,this.disjointAnimations=[]}fromJson(e){if(super.fromJson(e),this.channels=d(e.channels,H),this.samplers=d(e.samplers,W),this.name=e.name,void 0!==this.channels)for(let e=0;e<this.channels.length;++e)this.interpolators.push(new ee);else console.error("No channel data found for skin")}advance(e,t){if(void 0!==this.channels){if(0==this.maxTime)for(let t=0;t<this.channels.length;++t){const n=this.channels[t],i=this.samplers[n.sampler],s=e.accessors[i.input].getDeinterlacedView(e),r=s[s.length-1];r>this.maxTime&&(this.maxTime=r)}for(let n=0;n<this.interpolators.length;++n){const i=this.channels[n],s=this.samplers[i.sampler],r=this.interpolators[n],a=e.nodes[i.target.node];switch(i.target.path){case j:a.applyTranslationAnimation(r.interpolate(e,i,s,t,3,this.maxTime));break;case Z:a.applyRotationAnimation(r.interpolate(e,i,s,t,4,this.maxTime));break;case J:a.applyScaleAnimation(r.interpolate(e,i,s,t,3,this.maxTime));break;case K:{const n=e.meshes[a.mesh];n.weightsAnimated=r.interpolate(e,i,s,t,n.weights.length,this.maxTime);break}}}}}}class ne extends v{constructor(){super(),this.name="",this.inverseBindMatrices=void 0,this.joints=[],this.skeleton=void 0,this.jointMatrices=[],this.jointNormalMatrices=[]}computeJoints(e,t){const n=e.accessors[this.inverseBindMatrices].getDeinterlacedView(e);this.jointMatrices=[],this.jointNormalMatrices=[];let i=0;for(const s of this.joints){const r=e.nodes[s];let a=mat4.create(),o=h(n,16*i++,16);mat4.mul(a,r.worldTransform,o),mat4.mul(a,t.inverseWorldTransform,a),this.jointMatrices.push(a);let l=mat4.create();mat4.invert(l,a),mat4.transpose(l,l),this.jointNormalMatrices.push(l)}}}class ie extends v{constructor(){super(),this.name=void 0}fromJson(e){void 0!==e.name&&(this.name=e.name)}}class se extends v{constructor(e){super(),this.asset=void 0,this.accessors=[],this.nodes=[],this.scene=void 0,this.scenes=[],this.cameras=[],this.lights=[],this.imageBasedLights=[],this.textures=[],this.images=[],this.samplers=[],this.meshes=[],this.buffers=[],this.bufferViews=[],this.materials=[],this.materialsMap={},this.animations=[],this.skins=[],this.path=e}initGl(e){const t=this;for(const n of this.images)null!=n&&void 0!==n.initGl&&n.initGl(t,e);for(const n of this.samplers)null!=n&&void 0!==n.initGl&&n.initGl(t,e);for(const n of this.textures)null!=n&&void 0!==n.initGl&&n.initGl(t,e);for(const n of this.materials)null!=n&&void 0!==n.initGl&&n.initGl(t,e);this.scenes[this.scene].initGl(this,e)}fromJson(e){super.fromJson(e),this.asset=u(e.asset,G),this.cameras=d(e.cameras,I),this.accessors=d(e.accessors,w),this.meshes=d(e.meshes,B),this.samplers=d(e.samplers,X),this.materials=d(e.materials,z),this.buffers=d(e.buffers,_),this.bufferViews=d(e.bufferViews,y),this.scenes=d(e.scenes,F),this.textures=d(e.textures,O),this.nodes=d(e.nodes,U),this.lights=d(function(e){return void 0===e||void 0===e.KHR_lights_punctual?[]:e.KHR_lights_punctual.lights}(e.extensions),$),this.imageBasedLights=d(function(e){return void 0===e||void 0===e.KHR_lights_image_based?[]:e.KHR_lights_image_based.imageBasedLights}(e.extensions),D),this.images=d(e.images,A),this.animations=d(e.animations,te),this.skins=d(e.skins,ne),this.variants=d(function(e){return void 0===e||void 0===e.KHR_materials_variants?[]:e.KHR_materials_variants.variants}(e.extensions),ie),this.variants=function(e){for(let t=0;t<e.length;t++){const n=e[t].name;for(let i=t+1;i<e.length;i++)e[i].name==n&&(e[i].name+="0")}return e}(this.variants),this.materials.push(z.createDefault()),this.samplers.push(X.createDefault()),void 0!==e.scenes&&(void 0===e.scene&&e.scenes.length>0?this.scene=0:this.scene=e.scene),this.computeDisjointAnimations()}computeDisjointAnimations(){for(let e=0;e<this.animations.length;e++){this.animations[e].disjointAnimations=[];for(let t=0;t<this.animations.length;t++){if(e==t)continue;let n=!0;for(const i of this.animations[e].channels)for(const e of this.animations[t].channels)if(i.target.node===e.target.node&&i.target.path===e.target.path){n=!1;break}n&&this.animations[e].disjointAnimations.push(t)}}}nonDisjointAnimations(e){const t=this.animations,n=[];for(let i=0;i<t.length;i++){let s=!0;for(const n of e)i!=n&&(t[n].disjointAnimations.includes(i)||(s=!1));s||n.push(i)}return n}}class re{constructor(e){this.data=e,this.glbHeaderInts=3,this.glbChunkHeaderInts=2,this.glbMagic=1179937895,this.glbVersion=2,this.jsonChunkType=1313821514,this.binaryChunkType=5130562}extractGlbData(){if(void 0===this.getCheckedGlbInfo())return;let e,t=[];const n=this.getAllChunkInfos();for(let i of n)i.type!=this.jsonChunkType||e?i.type==this.binaryChunkType&&t.push(this.getBufferFromChunk(i)):e=this.getJsonFromChunk(i);return{json:e,buffers:t}}getCheckedGlbInfo(){const e=new Uint32Array(this.data,0,this.glbHeaderInts),t=e[0],n=e[1],i=e[2];if(this.checkEquality(t,this.glbMagic,"glb magic")&&this.checkEquality(n,this.glbVersion,"glb header version")&&this.checkEquality(i,this.data.byteLength,"glb byte length"))return{magic:t,version:n,length:i}}getAllChunkInfos(){let e=[],t=4*this.glbHeaderInts;for(;t<this.data.byteLength;){const n=this.getChunkInfo(t);e.push(n),t+=n.length+4*this.glbChunkHeaderInts}return e}getChunkInfo(e){const t=new Uint32Array(this.data,e,this.glbChunkHeaderInts);return{start:e+4*this.glbChunkHeaderInts,length:t[0],type:t[1]}}getJsonFromChunk(e){const t=e.length,n=4*(this.glbHeaderInts+this.glbChunkHeaderInts),i=new Uint8Array(this.data,n,t),s=new TextDecoder("utf-8").decode(i);return JSON.parse(s)}getBufferFromChunk(e){return this.data.slice(e.start,e.start+e.length)}checkEquality(e,t,n){return e==t||(console.error("Found invalid/unsupported "+n+", expected: "+t+", but was: "+e),!1)}}class ae{static async load(e,t,n){const i=ae.getBuffers(n),s=ae.getAdditionalFiles(n),r=ae.loadBuffers(e,i,s);await r;const a=ae.loadImages(e,s);return await Promise.all([r,a]).then((()=>{e.initGl(t)}))}static unload(e){for(let t of e.images)t.image=void 0;e.images=[];for(let t of e.textures)t.destroy();e.textures=[];for(let t of e.accessors)t.destroy();e.accessors=[]}static getBuffers(e){return ae.getTypedAppendix(e,ArrayBuffer)}static getAdditionalFiles(e){return"undefined"!=typeof File?ae.getTypedAppendix(e,File):void 0}static getTypedAppendix(e,t){if(e&&e.length>0&&e[0]instanceof t)return e}static loadBuffers(e,t,n){const i=[];if(void 0!==t&&void 0!==t[0]){t.length>1&&console.warn("Too many buffer chunks in GLB file. Only one or zero allowed"),e.buffers[0].buffer=t[0];for(let t=1;t<e.buffers.length;++t)i.push(e.buffers[t].load(e,n))}else for(const t of e.buffers)i.push(t.load(e,n));return Promise.all(i)}static loadImages(e,t){const n=[];for(let i of e.images)n.push(i.load(e,t));return Promise.all(n)}}async function oe(e){let t="",n=0;const i=e;let s;for(;!t.match(/\n\n[^\n]+\n/g);)t+=String.fromCharCode(i[n++]);if(s=t.match(/FORMAT=(.*)$/m),s.length<2)return;if(s=s[1],"32-bit_rle_rgbe"!=s)return console.warn("unknown format : "+s),this.onerror();let r=t.split(/\n/).reverse();if(r.length<2)return;if(r=r[1].split(" "),r.length<4)return;const a=1*r[3],o=1*r[1],l=new Uint8Array(a*o*4);let h=0;for(let e=0;e<o;e++){const e=[];let t=i.slice(n,n+=4);if(2==t[0]&&2==t[1]&&t[2]==(a>>8&255)&&t[3]==(255&a)&&a>=8&&a<32768){for(let t=0;t<4;t++){let s=t*a;const r=(t+1)*a;let o,l;for(;s<r;)if(o=i.slice(n,n+=2),o[0]>128)for(l=o[0]-128;l-- >0;)e[s++]=o[1];else for(l=o[0]-1,e[s++]=o[1];l-- >0;)e[s++]=i[n++]}for(let t=0;t<a;t++)l[h++]=e[t+0*a],l[h++]=e[t+1*a],l[h++]=e[t+2*a],l[h++]=e[t+3*a]}else{n-=4;for(let e=0;e<a;e++)t=i.slice(n,n+=4),l[h++]=t[0],l[h++]=t[1],l[h++]=t[2],l[h++]=t[3]}}return{dataFloat:function(e){const t=e.byteLength>>2,n=new Float32Array(3*t);for(let i=0;i<t;i++){const t=Math.pow(2,e[4*i+3]-136);n[3*i]=e[4*i]*t,n[3*i+1]=e[4*i+1]*t,n[3*i+2]=e[4*i+2]*t}return n}(l),width:a,height:o}}class le extends t.TreeItem{constructor(e){super(e),this.init()}init(e,t){this.initKtxLib(t),this.initDracoLib(e)}async load(e,n){let i,s,r,a;if(await this.init(),n||(n=e),t.resourceLoader.incrementWorkload(1),"string"==typeof e){i=g(n);let s=await t.resourceLoader.loadFile(i?"binary":"json",e);r=s,a=s}else console.error("Passed invalid type to loadGltf "+typeof gltfFile);if(i){const e=new re(a).extractGlbData();r=e.json,s=e.buffers}const o=new se(n);o.fromJson(r);for(const e of o.images)e.resolveRelativePath(p(o.path));return t.resourceLoader.incrementWorkload(o.nodes.length),await ae.load(o,this,s),t.resourceLoader.incrementWorkDone(1),o}async loadEnvironment(e,n){let i;if("string"==typeof e){let n=await t.resourceLoader.loadFile(e?"binary":"json",url);i=await oe(new Uint8Array(n.data))}else if(e instanceof ArrayBuffer)i=await oe(new Uint8Array(e));else if("undefined"!=typeof File&&e instanceof File){const t=await x.readAsArrayBuffer(e).catch((()=>{console.error("Could not load image with FileReader")}));i=await oe(new Uint8Array(t))}else console.error("Passed invalid type to loadEnvironment "+typeof gltfFile);if(void 0!==i)return _loadEnvironmentFromPanorama(i,this.view,n)}initKtxLib(e){}async initDracoLib(e){const t=new L(e);void 0!==t&&await t.ready()}}t.Registry.register("GLTFAsset",le),t.libsRegistry?t.libsRegistry.registerLib(o):console.warn("The version of the Zea Engine that you're using doesn't support the libraries registry. Please upgrade to the latest Zea Engine version."),e.GLTFAsset=le,Object.defineProperty(e,"__esModule",{value:!0})}(t,He,er,xl)}));function Cl(e){let t,n,i;return n=new Ys({}),{c(){t=s("div"),C(n.$$.fragment),r(t,"id","asmSlider"),r(t,"class","svelte-j5667")},m(e,s){o(e,t,s),k(n,t,null),i=!0},i(e){i||(u(n.$$.fragment,e),i=!0)},o(e){f(n.$$.fragment,e),i=!1},d(e){e&&m(t),T(n)}}}function kl(e){let t,n;return t=new js({props:{fileLoaded:e[3]}}),t.$on("changeFile",e[12]),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};8&n&&(i.fileLoaded=e[3]),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Tl(e){let t,n;return t=new Xs({}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Al(e){let t,n;return t=new Hn({props:{parameterOwner:e[8]}}),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const i={};256&n&&(i.parameterOwner=e[8]),t.$set(i)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function $l(e){let t,n,i;return n=new Wi({props:{progress:e[2]}}),{c(){t=s("div"),C(n.$$.fragment),r(t,"class","fixed bottom-0 w-full")},m(e,s){o(e,t,s),k(n,t,null),i=!0},p(e,t){const i={};4&t&&(i.progress=e[2]),n.$set(i)},i(e){i||(u(n.$$.fragment,e),i=!0)},o(e){f(n.$$.fragment,e),i=!1},d(e){e&&m(t),T(n)}}}function El(e){let t,n;const i=[e[5]];let s={$$slots:{default:[Sl]},$$scope:{ctx:e}};for(let e=0;e<i.length;e+=1)s=N(s,i[e]);return t=new dn({props:s}),t.$on("click",e[10]),t.$on("clickoutside",e[10]),{c(){C(t.$$.fragment)},m(e,i){k(t,e,i),n=!0},p(e,n){const s=32&n?U(i,[G(e[5])]):{};1073742016&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){f(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function Sl(e){let t,n,i,s;return t=new pn({props:{text:"Hide"}}),t.$on("click",e[15]),i=new pn({props:{text:"Properties"}}),i.$on("click",e[16]),{c(){C(t.$$.fragment),n=p(),C(i.$$.fragment)},m(e,r){k(t,e,r),o(e,n,r),k(i,e,r),s=!0},p:_,i(e){s||(u(t.$$.fragment,e),u(i.$$.fragment,e),s=!0)},o(e){f(t.$$.fragment,e),f(i.$$.fragment,e),s=!1},d(e){T(t,e),e&&m(n),T(i,e)}}}function Ml(e){let t,n,i,a,l,h,c,d,g,v,b,_,y,I,P,A,$,E,S=e[9].asmExplodeEnabled&&Cl(),M=!e[3]&&kl(e);c=new Gi({}),b=new Zi({props:{$$slots:{default:[Tl]},$$scope:{ctx:e}}});let R=e[9].shouldShowParameterOwnerWidget&&Al(e),D=e[2]<100&&$l(e);P=new yn({props:{isOpen:e[7],close:e[11],contextItem:e[6]}});let O=e[4]&&El(e);return{c(){t=s("main"),S&&S.c(),n=p(),i=s("canvas"),a=p(),M&&M.c(),l=p(),h=s("div"),C(c.$$.fragment),d=p(),g=s("div"),v=p(),C(b.$$.fragment),_=p(),R&&R.c(),y=p(),D&&D.c(),I=p(),C(P.$$.fragment),A=p(),O&&O.c(),$=x(),r(i,"class","absolute w-full h-full svelte-j5667"),r(h,"class","absolute flex justify-center w-full bottom-3"),r(t,"class","relative flex-1 Main")},m(s,r){o(s,t,r),S&&S.m(t,null),w(t,n),w(t,i),e[13](i),w(t,a),M&&M.m(t,null),w(t,l),w(t,h),k(c,h,null),w(t,d),w(t,g),e[14](g),w(t,v),k(b,t,null),w(t,_),R&&R.m(t,null),o(s,y,r),D&&D.m(s,r),o(s,I,r),k(P,s,r),o(s,A,r),O&&O.m(s,r),o(s,$,r),E=!0},p(e,[i]){e[9].asmExplodeEnabled?S?512&i&&u(S,1):(S=Cl(),S.c(),u(S,1),S.m(t,n)):S&&(X(),f(S,1,1,(()=>{S=null})),F()),e[3]?M&&(X(),f(M,1,1,(()=>{M=null})),F()):M?(M.p(e,i),8&i&&u(M,1)):(M=kl(e),M.c(),u(M,1),M.m(t,l));const s={};1073741824&i&&(s.$$scope={dirty:i,ctx:e}),b.$set(s),e[9].shouldShowParameterOwnerWidget?R?(R.p(e,i),512&i&&u(R,1)):(R=Al(e),R.c(),u(R,1),R.m(t,null)):R&&(X(),f(R,1,1,(()=>{R=null})),F()),e[2]<100?D?(D.p(e,i),4&i&&u(D,1)):(D=$l(e),D.c(),u(D,1),D.m(I.parentNode,I)):D&&(X(),f(D,1,1,(()=>{D=null})),F());const r={};128&i&&(r.isOpen=e[7]),64&i&&(r.contextItem=e[6]),P.$set(r),e[4]?O?(O.p(e,i),16&i&&u(O,1)):(O=El(e),O.c(),u(O,1),O.m($.parentNode,$)):O&&(X(),f(O,1,1,(()=>{O=null})),F())},i(e){E||(u(S),u(M),u(c.$$.fragment,e),u(b.$$.fragment,e),u(R),u(D),u(P.$$.fragment,e),u(O),E=!0)},o(e){f(S),f(M),f(c.$$.fragment,e),f(b.$$.fragment,e),f(R),f(D),f(P.$$.fragment,e),f(O),E=!1},d(n){n&&m(t),S&&S.d(),e[13](null),M&&M.d(),T(c),e[14](null),T(b),R&&R.d(),n&&m(y),D&&D.d(n),n&&m(I),T(P,n),n&&m(A),O&&O.d(n),n&&m($)}}}function Rl(e,t,n){let i,s,r,a,o,l,h;E(e,Ls,(e=>n(18,s=e))),E(e,ot,(e=>n(9,r=e))),E(e,Vs,(e=>n(19,a=e))),E(e,Yi,(e=>n(20,o=e)));const c=new URLSearchParams(window.location.search),d=c.has("embedded");let u;c.has("roomId");let f,m=!1;const g=e=>{let t=e;for(;e&&!(e instanceof ge);)e=e.getOwner();return e||t},p=(e,t)=>{const i=new Me,r=new Ge;return r.resources=t,r.camera=f.getViewport().getCamera(),i.load(e,r).then((()=>{console.log("Loading CAD File version:",i.cadfileVersion," exported using SDK:",i.sdk);i.getMaterialLibrary().getMaterials().forEach((e=>{if("LinesShader"==e.getShaderName()){e.getParameter("Opacity").value=1}else if("StandardSurfaceShader"==e.getShaderName()){e.getParameter("EdgeColor").value=f.outlineColor}})),f.frameAll()})),s.addChild(i),n(3,m=!0),i},v=(e,t)=>{const i=new Pl.GLTFAsset;return i.load(e,t).then((()=>{f.frameAll()})),s.addChild(i),n(3,m=!0),i};I((async()=>{const{isMobileDevice:e}=Ue;if(f=new Ve(l,{debugGeomIds:c.has("debugGeomIds"),enableFrustumCulling:!0,enableOcclusionCulling:!1,disableMultiDraw:"Android"==ZeaSystemDesc.OS}),S(Yi,o=new Be,o),!e&&Ue.gpuDesc.supportsWebGL2){const e=new Xe("envMap");e.load("data/StudioG.zenv"),e.headlightModeParam.value=!0,S(Yi,o.envMapParam.value=e,o)}f.outlineThickness=1.5,f.outlineSensitivity=5,f.highlightOutlineThickness=1.75,f.outlineColor=new Te(0,0,0,.6),f.hiddenLineColor=new Te(.2,.2,.2,0),o.setupGrid(10,10),f.getViewport().backgroundColorParam.value=new Te(.85,.85,.85,1),f.setScene(o);const t={};t.renderer=f,t.scene=o,S(Ls,s=new Oe("Assets"),s),t.assets=s,o.getRoot().addChild(s);const m=je.UndoRedoManager.getInstance();t.undoRedoManager=m;const w=f.getViewport().getManipulator();w.setDefaultManipulationMode(Pe.MANIPULATION_MODES.tumbler),w.aimFocusOnTouchTap=2,w.aimFocusOnMouseClick=2,t.cameraManipulator=w;const _=new je.ToolManager(t);S(Vs,a=new je.SelectionManager(t,{enableXfoHandles:!0}),a),a.showHandles(!1),t.selectionManager=a;const I=new je.SelectionTool(t);I.setSelectionFilter(g),_.registerTool("SelectionTool",I),_.registerTool("CameraManipulator",w),f.getViewport().setManipulator(_),_.pushTool("CameraManipulator"),t.toolManager=_,((e,t)=>{const{renderer:n}=t,i=new je.MeasureDistanceTool(t),s=new je.MeasureRadiusTool(t),r=new je.MeasureAngleTool(t),a=new je.MeasureCenterDistancesTool(t),o=n.getViewport().getManipulator();e.registerTool("cameraManipulator",o),e.registerTool("measureDistanceTool",i),e.registerTool("measureRadiusTool",s),e.registerTool("measureAngleTool",r),e.registerTool("measureCenterDistancesTool",a)})(_,t);const P=new Te("#F9CE03");P.a=.1,a.selectionGroup.getParameter("HighlightColor").setValue(P);const C=new Te(0,0,0,1);I.rectItem.getParameter("Material").getValue().getParameter("BaseColor").setValue(C);var k=0;const T=f.getViewport().getCamera(),A=()=>{clearTimeout(k),k=0,T.getParameter("GlobalXfo").off("valueChanged",A)};f.getViewport().on("pointerDown",(e=>{if(b&&x(),"touch"==e.pointerType&&e.intersectionData){((e,t)=>{k=setTimeout((function(){y(e,t),k=0,T.getParameter("GlobalXfo").off("valueChanged",A)}),1e3),T.getParameter("GlobalXfo").on("valueChanged",A)})(e,g(e.intersectionData.geomItem))}})),f.getViewport().on("pointerUp",(e=>{if(k&&A(),"touch"==e.pointerType&&e.intersectionData&&b&&e.stopPropagation(),"touch"==e.pointerType&&0==e.touches.length&&1==e.changedTouches.length||"mouse"==e.pointerType&&0==e.button){const t=_.toolStack;if(t[t.length-1]==I)return;if(e.intersectionData){const t=g(e.intersectionData.geomItem);if(t)if(e.shiftKey){const e=new Set;e.add(t),a.deselectItems(e)}else a.toggleItemSelection(t,!e.ctrlKey)}else a.setSelection(new Set,!0)}else if(2==e.button&&e.intersectionData){const t=g(e.intersectionData.geomItem);y(e,t),e.stopPropagation()}})),f.getViewport().on("pointerDoublePressed",(e=>{"touch"==e.pointerType&&2==e.touches.length||e.intersectionData||f.frameAll()})),Fe.on("progressIncremented",(e=>{n(2,u=e.percent)}));const $=document.createElement("fps-display");let E;if($.renderer=f,h.appendChild($),c.has("zcad")&&(E=c.get("zcad"),p(E,E)),c.has("gltf")&&(E=c.get("gltf"),v(E,E)),d){const e=Zs();let t;e.on("setBackgroundColor",(e=>{const t=new Te(e.color);o.getSettings().getParameter("BackgroundColor").setValue(t)})),e.on("setHighlightColor",(e=>{const t=new Te(e.color);t.a=.1,a.selectionGroup.getParameter("HighlightColor").setValue(t),a.selectionGroup.getParameter("SubtreeHighlightColor").setValue(t)})),e.on("setRenderMode",(e=>{Pi(yi[e.mode])})),e.on("setCameraManipulationMode",(e=>{const t=e.mode.toLowerCase();w.setDefaultManipulationMode(Pe.MANIPULATION_MODES[t])})),e.on("loadCADFile",(n=>{console.log("loadCADFile",n),n.addToCurrentScene||s.removeAllChildren();const i=p(n.url,n.resources);if(!n.convertZtoY){const e=i.getParameter("LocalXfo").getValue();e.ori.setFromAxisAndAngle(new ke(1,0,0),.5*Math.PI),i.getParameter("LocalXfo").setValue(e)}i.once("loaded",(()=>{if(console.log("loadCADFile",n._id),n._id){const t=Js(i);e.send(n._id,{modelStructure:t})}})),t=i})),e.on("getModelStructure",(t=>{if(t._id){const n=Js(s);e.send(t._id,{modelStructure:n})}}));let n=!1;e.on("selectItems",(e=>{n=!0;const i=[];e.paths.forEach((e=>{const n=t.resolvePath(e);n&&i.push(n)})),a.selectItems(i,!1),n=!1})),e.on("deselectItems",(e=>{n=!0,console.log("deselectItems",e.paths);const i=[];e.paths.forEach((e=>{const n=t.resolvePath(e);n&&i.push(n)})),a.deselectItems(i),n=!1})),e.on("unloadCADFile",(t=>{console.log("unloadCADFile",t),s.removeChildByName(t.name),t._id&&e.send(t._id,{done:!0})}));const i=e=>{for(;e&&!(e instanceof ve);)e=e.getOwner();return e};a.on("selectionChanged",(t=>{if(n)return;const{selection:s,prevSelection:r}=t,a=[];s.forEach((e=>{if(!r.has(e)){const t=i(e);if(t){const e=t.getPath().slice(2);a.push(e)}}}));const o=[];r.forEach((e=>{if(!s.has(e)){const t=i(e);if(t){const e=t.getPath().slice(2);o.push(e)}}})),console.log(a,o),e.send("selectionChanged",{selection:a,deselection:o})}))}a.on("leadSelectionChanged",(e=>{n(8,i=e.treeItem),S(ot,r.shouldShowParameterOwnerWidget=i,r)})),Xt.set(t)}));let w,b=!1,_={x:0,y:0};const y=(e,t)=>{n(6,w=t),n(5,_=e.touches?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}),n(4,b=!0)},x=()=>{console.log("closeMenu:"),n(4,b=!1)};let C=!1;return n(8,i=null),[l,h,u,m,b,_,w,C,i,r,x,()=>{n(7,C=!1)},e=>{const{files:t}=e.detail;s.removeAllChildren();const n={};t.forEach((e=>{const t=e.name,i=URL.createObjectURL(e);n[t]=i})),t.forEach((e=>{if(e.name.endsWith(".zcad")){const t=e.name,i=((e,t)=>t.endsWith("zcad")?p(e):t.endsWith("gltf")||t.endsWith("glb")?v(e,t):void 0)(n[t],t),s=t.slice(0,t.length-5)+".zmetadata";s in n&&i.geomLibrary.once("loaded",(()=>{i.loadMetadata(n[s])}))}}))},function(e){P[e?"unshift":"push"]((()=>{l=e,n(0,l)}))},function(e){P[e?"unshift":"push"]((()=>{h=e,n(1,h)}))},()=>{w.getParameter("Visible").setValue(!1)},()=>{w&&(n(7,C=!0),x())}]}class Dl extends e{constructor(e){super(),t(this,e,Rl,Ml,n,{})}}function Ol(e){let t,n,i,a,l;return n=new an({}),a=new Dl({}),{c(){t=s("div"),C(n.$$.fragment),i=p(),C(a.$$.fragment),r(t,"class","flex flex-col h-full")},m(e,s){o(e,t,s),k(n,t,null),w(t,i),k(a,t,null),l=!0},p:_,i(e){l||(u(n.$$.fragment,e),u(a.$$.fragment,e),l=!0)},o(e){f(n.$$.fragment,e),f(a.$$.fragment,e),l=!1},d(e){e&&m(t),T(n),T(a)}}}class Nl extends e{constructor(e){super(),t(this,e,null,Ol,n,{})}}export{Nl as default};
//# sourceMappingURL=index-bbf8bb5b.js.map
