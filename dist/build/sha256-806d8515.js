const A=()=>{const A=window.navigator.userAgent;let g=null;return/macintosh/i.test(A)?g="macOS":/ios/i.test(A)?g="iOS":/win/i.test(A)?g="Windows":/android/i.test(A)?g="Android":/linux/i.test(A)&&(g="Linux"),g},g=function(){if(!globalThis.navigator)return{OS:"Node",isMobileDevice:!1,isIOSDevice:!1,browserName:"Node",webGLSupported:!1,deviceCategory:"High",hardwareConcurrency:4};const g=null!=(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Pixel/i)||navigator.userAgent.match(/Windows Phone/i)),I=function(){const A=navigator.userAgent;let g,I,C,i=navigator.appName,e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10);return navigator.brave?(i="Brave",I=A.indexOf("Chrome"),e=A.substring(I+7,A.indexOf(" ",I+7))):-1!=(I=A.indexOf("Opera"))?(i="Opera",e=A.substring(I+6),-1!=(I=A.indexOf("Version"))&&(e=A.substring(I+8))):-1!=(I=A.indexOf("MSIE"))?(i="Microsoft Internet Explorer",e=A.substring(I+5)):-1!=(I=A.indexOf("Edge"))?(i="Edge",e=A.substring(I+4)):-1!=(I=A.indexOf("Chrome"))?(i="Chrome",e=A.substring(I+7,A.indexOf(" ",I+7))):-1!=(I=A.indexOf("Safari"))?(i="Safari",e=A.substring(I+7),-1!=(I=A.indexOf("Version"))&&(e=A.substring(I+8))):-1!=(I=A.indexOf("Firefox"))?(i="Firefox",e=A.substring(I+8)):(g=A.lastIndexOf(" ")+1)<(I=A.lastIndexOf("/"))&&(i=A.substring(g,I),e=A.substring(I+1),i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)),-1!=(C=e.indexOf(";"))&&(e=e.substring(0,C)),-1!=(C=e.indexOf(" "))&&(e=e.substring(0,C)),t=parseInt(""+e,10),isNaN(t)&&(e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10)),{browserName:i,fullVersion:e,majorVersion:t,appName:navigator.appName,userAgent:navigator.userAgent}}(),C=function(){let A,g;try{A=document.createElement("canvas").getContext("webgl")}catch(A){}if(!A)return{vendor:"Unknown",renderer:"Unknown",gpuVendor:"Unknown",maxTextureSize:0,supportsWebGL:!1,supportsWebGL2:!1};try{g=document.createElement("canvas").getContext("webgl2")}catch(A){}const I=A.getExtension("WEBGL_debug_renderer_info");if(!I)return console.warn("Unable to determine GPU Info:"),{vendor:"Unknown",renderer:"Unknown",gpuVendor:"Unknown",maxTextureSize:0,supportsWebGL:null!=A,supportsWebGL2:null!=g};const C=A.getParameter(I.UNMASKED_VENDOR_WEBGL),i=A.getParameter(I.UNMASKED_RENDERER_WEBGL),e=A.getParameter(A.MAX_TEXTURE_SIZE);let t;return i.match(/NVIDIA/i)?t="NVidia":i.match(/AMD/i)||i.match(/Radeon/i)?t="AMD":i.match(/Intel/i)?t="Intel":i.match(/Mali/i)?t="ARM":i.match(/Apple/i)?t="Apple":i.match(/Adreno/i)?t="Adreno":i.match(/Swiftshader/i)?(t="Google",console.warn("Hardware rendering is disabled or not working on your system. Falling back to the Swiftshader. Expect poor performance:",i)):console.warn("Unable to determine GPU vendor:",i),{vendor:C,renderer:i,gpuVendor:t,maxTextureSize:e,supportsWebGL:!0,supportsWebGL2:null!=g}}();let i="Low";if(C.supportsWebGL)if(g)i="Low";else{const A=C.renderer.replace(/[()]/g,"").split(" ");if("NVidia"==C.gpuVendor){const g=A.indexOf("GTX");if(-1!=g){const I=A[g+1];if(I.endsWith("M")){i=parseInt(I.substring(0,I.length-2))>=900?"Medium":"Low"}else{i=parseInt(I)>=1030?"High":"Medium"}}else i=A.includes("RTX")||A.includes("TITAN")||A.includes("Quadro")?"High":"Low"}else if("AMD"==C.gpuVendor){const g=A.indexOf("Radeon");if(-1!=g){const I=A.indexOf("RX");if(-1!=I)if("Vega"==A[I+1])i="High";else{const g=A[I+1];let C;g.endsWith("X")?(C=parseInt(g.substring(0,g.length-2)),i="High"):C=parseInt(g),i=C>=480?"High":"Medium"}else if("Pro"==A[g+1]){i=parseInt(A[I+1])>=450?"Medium":"Low"}else if("Sky"==A[g+1]){i=parseInt(A[I+1])>=700?"Medium":"Low"}else i="Low"}else i=A.includes("FirePro")||A.includes("Quadro")?"High":"Low"}else("Adreno"==C.gpuVendor||"Intel"==C.gpuVendor||"Google"==C.gpuVendor)&&(i="Low")}let e=globalThis.navigator.hardwareConcurrency;return e||(e=g?4:6),{OS:A(),isMobileDevice:g,isIOSDevice:null!=(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)),browserName:I.browserName,fullVersion:I.fullVersion,majorVersion:I.majorVersion,appName:I.appName,userAgent:I.userAgent,webGLSupported:C.supportsWebGL,gpuDesc:C,deviceCategory:i,hardwareConcurrency:e}}();globalThis.ZeaSystemDesc||(globalThis.ZeaSystemDesc=g);let I={},C={},i=[];class e{static register(A,g){if(A in I)return void console.warn(`There's a class registered with '${A}' name. Second registration failed.`);const e=i.length;i.push(g),C[e]=A,I[A]=e}static getClassDefinition(A){if(!(A in I))throw new Error(`${A} class is not registered`);return i[I[A]]}static getClassName(A){const g=i.indexOf(A);if(g>=0&&C[g])return C[g];throw new Error("class is not registered")}static constructClass(A){const g=i[I[A]];if(!g)throw new Error(`${A} class is not registered`);return new g}static flush(){I={},C={},i=[]}}class t{static replaceAll(A,g,I){return A.replace(new RegExp(g,"g"),I)}static stringifyJSONWithFixedPrecision(A,g=0,I=5){return JSON.stringify(A,((A,g)=>g&&g.toFixed?Number(g.toFixed(I)):g),g)}static hashStr(A){let g,I,C,i=0;if(0===A.length)return i;for(g=0,C=A.length;g<C;g++)I=A.charCodeAt(g),i=(i<<5)-i+I,i|=0;return Math.abs(i)}}class B{constructor(A=0,g=0){A instanceof Float32Array||A instanceof Uint32Array||A instanceof Int32Array?this.__data=A:"number"==typeof A&&"number"==typeof g?(this.__data=new Float32Array(2),this.__data[0]=A,this.__data[1]=g):"object"==typeof A?(this.__data=new Float32Array(2),this.fromJSON(A)):this.__data=new Float32Array(2)}get x(){return this.__data[0]}set x(A){this.__data[0]=A}get y(){return this.__data[1]}set y(A){this.__data[1]=A}set(A,g){this.__data[0]=A,this.__data[1]=g}setFromOther(A){this.x=A.x,this.y=A.y}isEqual(A){return this.x==A.x&&this.y==A.y}notEqual(A){return this.x!=A.x&&this.y!=A.y}approxEqual(A,g=Number.EPSILON){return Math.abs(this.x-A.x)<g&&Math.abs(this.y-A.y)<g}add(A){return new B(this.x+A.x,this.y+A.y)}addInPlace(A){this.x+=A.x,this.y+=A.y}subtract(A){return new B(this.x-A.x,this.y-A.y)}subtractInPlace(A){return this.x-=A.x,this.y-=A.y,this}scale(A){return new B(this.x*A,this.y*A)}scaleInPlace(A){this.x*=A,this.y*=A}invert(){return new B(1/this.x,1/this.y)}invertInPlace(){return this.x=1/this.x,this.y=1/this.y,this}multiply(A){return new B(this.x*A.x,this.y*A.y)}multiplyInPlace(A){this.x*=A.x,this.y*=A.y}lengthSquared(){const A=this.__data[0],g=this.__data[1];return A*A+g*g}length(){return Math.sqrt(this.lengthSquared())}distanceTo(A){const g=this.__data[0]-A.x,I=this.__data[1]-A.y;return Math.sqrt(g*g+I*I)}normalize(){const A=this.__data[0],g=this.__data[1];let I=A*A+g*g;return I<Number.EPSILON?new B:(I=1/Math.sqrt(I),new B(A*I,g*I))}normalizeInPlace(){const A=this.__data[0],g=this.__data[1];let I=A*A+g*g;I<Number.EPSILON||(I=1/Math.sqrt(I),this.set(A*I,g*I))}dot(A){return this.x*A.x+this.y*A.y}cross(A){return this.x*A.y-this.y*A.x}angleTo(A){const g=this.normalize().dot(A.normalize());return g>1?0:g<-1?Math.PI:Math.acos(g)}signedAngleTo(A){const g=this.angleTo(A);return this.cross(A)<0?-g:g}rotate(A){const g=Math.cos(A),I=Math.sin(A);return new B(this.x*g-this.y*I,this.x*I+this.y*g)}lerp(A,g){const I=this.x,C=this.y;return new B(I+g*(A.x-I),C+g*(A.y-C))}setRandomDir(A=1){const g=2*Math.random()*Math.PI;return this.__data[0]=Math.cos(g)*A,this.__data[1]=Math.sin(g)*A,this}setRandom(A=1){return this.__data[0]=Math.random()*A,this.__data[1]=Math.random()*A,this}clone(){return new B(this.__data[0],this.__data[1])}asArray(){return this.__data}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return{x:this.x,y:this.y}}fromJSON(A){this.x=A.x,this.y=A.y}readBinary(A){this.x=A.loadFloat32(),this.y=A.loadFloat32()}static intersectionOfLines(A,g,I,C){const i=(A.x-g.x)*(I.y-C.y)-(A.y-g.y)*(I.x-C.x);if(0==i)return null;const e=A.x*g.y-A.y*g.x,t=I.x*C.y-I.y*C.x,o=I.x-C.x,s=A.x-g.x,a=I.y-C.y,l=A.y-g.y;return new B((e*o-s*t)/i,(e*a-l*t)/i)}isValid(){for(const A of this.__data)if(A==1/0||isNaN(A))return!1;return!0}}class o{constructor(A=0,g=0,I=0){if(A instanceof Float32Array||A instanceof Uint32Array)this.__data=A;else if(A instanceof ArrayBuffer){console.warn("deprecated, please use new Vec3(new Float32Array(buffer, byteOffset, 3))");const I=A,C=g;this.__data=new Float32Array(I,C,3)}else"number"==typeof A&&"number"==typeof g&&"number"==typeof I?(this.__data=new Float32Array(3),this.__data[0]=A,this.__data[1]=g,this.__data[2]=I):null!=A&&"object"==typeof A?(this.__data=new Float32Array(3),this.fromJSON(A)):this.__data=new Float32Array(3)}get x(){return this.__data[0]}set x(A){this.__data[0]=A}get y(){return this.__data[1]}set y(A){this.__data[1]=A}get z(){return this.__data[2]}set z(A){this.__data[2]=A}get xy(){return new B(this.__data[0],this.__data[1])}get yz(){return new B(this.__data[1],this.__data[2])}set(A,g,I){this.x=A,this.y=void 0!==g?g:A,this.z=void 0!==I?I:A}setDataArray(A){this.__data=A}setFromOther(A){this.x=A.x,this.y=A.y,this.z=A.z}isNull(){return Math.abs(this.x)<Number.EPSILON&&Math.abs(this.y)<Number.EPSILON&&Math.abs(this.z)<Number.EPSILON}is111(){return Math.abs(1-this.x)<Number.EPSILON&&Math.abs(1-this.y)<Number.EPSILON&&Math.abs(1-this.z)<Number.EPSILON}isEqual(A){return this.x==A.x&&this.y==A.y&&this.z==A.z}notEqual(A){return this.x!=A.x&&this.y!=A.y&&this.z!=A.z}approxEqual(A,g=Number.EPSILON){return Math.abs(this.x-A.x)<g&&Math.abs(this.y-A.y)<g&&Math.abs(this.z-A.z)<g}add(A){return new o(this.x+A.x,this.y+A.y,this.z+A.z)}addInPlace(A){this.x+=A.x,this.y+=A.y,this.z+=A.z}subtract(A){return new o(this.x-A.x,this.y-A.y,this.z-A.z)}subtractInPlace(A){this.x-=A.x,this.y-=A.y,this.z-=A.z}multiply(A){return new o(this.x*A.x,this.y*A.y,this.z*A.z)}multiplyInPlace(A){this.x*=A.x,this.y*=A.y,this.z*=A.z}divide(A){return new o(this.x/A.x,this.y/A.y,this.z/A.z)}divideInPlace(A){this.x/=A.x,this.y/=A.y,this.z/=A.z}scale(A){return new o(this.x*A,this.y*A,this.z*A)}scaleInPlace(A){this.x*=A,this.y*=A,this.z*=A}negate(){return new o(-this.x,-this.y,-this.z)}inverse(){return new o(1/this.x,1/this.y,1/this.z)}lengthSquared(){const A=this.__data[0],g=this.__data[1],I=this.__data[2];return A*A+g*g+I*I}length(){return Math.sqrt(this.lengthSquared())}distanceTo(A){const g=this.__data[0]-A.x,I=this.__data[1]-A.y,C=this.__data[2]-A.z;return Math.sqrt(g*g+I*I+C*C)}normalize(){let A=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];return A<Number.EPSILON?new o:(A=1/Math.sqrt(A),new o(this.__data[0]*A,this.__data[1]*A,this.__data[2]*A))}normalizeInPlace(){let A=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(A<Number.EPSILON)return;A=Math.sqrt(A);const g=1/A;return this.__data[0]*=g,this.__data[1]*=g,this.__data[2]*=g,A}resize(A){const g=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(g<Number.EPSILON)return;const I=A/Math.sqrt(g);return new o(this.__data[0]*I,this.__data[1]*I,this.__data[2]*I)}resizeInPlace(A){const g=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(g<Number.EPSILON)return;const I=A/Math.sqrt(g);this.__data[0]*=I,this.__data[1]*=I,this.__data[2]*=I}dot(A){return this.x*A.x+this.y*A.y+this.z*A.z}cross(A){const g=this.x,I=this.y,C=this.z,i=A.x,e=A.y,t=A.z;return new o(I*t-C*e,C*i-g*t,g*e-I*i)}angleTo(A){const g=this.dot(A);return g>1?0:Math.acos(g)}lerp(A,g){const I=this.x,C=this.y,i=this.z;return new o(I+g*(A.x-I),C+g*(A.y-C),i+g*(A.z-i))}abs(){return new o(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}setRandomDir(A=1){const g=2*Math.random()*Math.PI,I=2*Math.random()-1,C=Math.sqrt(1-I*I)*A;return this.__data[0]=Math.cos(g)*C,this.__data[1]=Math.sin(g)*C,this.__data[2]=I*A,this}setRandom(A=1){return this.__data[0]=(Math.random()-.5)*A,this.__data[1]=(Math.random()-.5)*A,this.__data[2]=(Math.random()-.5)*A,this}clone(){return new o(this.__data[0],this.__data[1],this.__data[2])}asArray(){return this.__data}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return{x:this.x,y:this.y,z:this.z}}fromJSON(A){this.x=A.x,this.y=A.y,this.z=A.z}readBinary(A){this.x=A.loadFloat32(),this.y=A.loadFloat32(),this.z=A.loadFloat32()}isValid(){for(const A of this.__data)if(A==1/0||isNaN(A))return!1;return!0}}class s{constructor(A=0,g=0,I=0,C=0){if(A instanceof Float32Array||A instanceof Uint32Array)this.__data=A;else if(A instanceof ArrayBuffer){console.warn("deprecated, please use new Vec4(new Float32Array(buffer, byteOffset, 4))");const I=A,C=g;this.__data=new Float32Array(I,C,4)}else"number"==typeof A&&"number"==typeof g&&"number"==typeof I&&"number"==typeof C?(this.__data=new Float32Array(4),this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C):null!=A&&"object"==typeof A?(this.__data=new Float32Array(4),this.fromJSON(A)):this.__data=new Float32Array(4)}get x(){return this.__data[0]}set x(A){this.__data[0]=A}get y(){return this.__data[1]}set y(A){this.__data[1]=A}get z(){return this.__data[2]}set z(A){this.__data[2]=A}get t(){return this.__data[3]}set t(A){this.__data[3]=A}get w(){return this.__data[3]}set w(A){this.__data[3]=A}get xyz(){return new o(this.__data[0],this.__data[1],this.__data[2])}set(A,g,I,C){this.x=A,this.y=g,this.z=I,this.t=C}setFromOther(A){this.x=A.x,this.y=A.y,this.z=A.z,this.t=A.t}isEqual(A){return this.x==A.x&&this.y==A.y&&this.z==A.z&&this.t==A.t}notEqual(A){return this.x!=A.x&&this.y!=A.y&&this.z!=A.z&&this.t!=A.t}approxEqual(A,g=Number.EPSILON){return Math.abs(this.x-A.x)<g&&Math.abs(this.y-A.y)<g&&Math.abs(this.z-A.z)<g&&Math.abs(this.t-A.t)<g}add(A){return new s(this.x+A.x,this.y+A.y,this.z+A.z,this.t+A.t)}addInPlace(A){this.x+=A.x,this.y+=A.y,this.z+=A.z,this.t+=A.t}subtract(A){return new s(this.x-A.x,this.y-A.y,this.z-A.z,this.t-A.t)}subtractInPlace(A){this.x-=A.x,this.y-=A.y,this.z-=A.z,this.t-=A.t}multiply(A){return new s(this.x*A.x,this.y*A.y,this.z*A.z,this.t*A.t)}multiplyInPlace(A){this.x*=A.x,this.y*=A.y,this.z*=A.z,this.t*=A.t}divide(A){return new s(this.x/A.x,this.y/A.y,this.z/A.z,this.t/A.t)}divideInPlace(A){this.x/=A.x,this.y/=A.y,this.z/=A.z,this.t/=A.t}scale(A){return new s(this.x*A,this.y*A,this.z*A,this.t*A)}scaleInPlace(A){this.set(this.x*A,this.y*A,this.z*A,this.t*A)}length(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[2];return Math.sqrt(A*A+g*g+I*I+C*C)}lengthSquared(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];return A*A+g*g+I*I+C*C}normalize(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];let i=A*A+g*g+I*I+C*C;return i<Number.EPSILON?new s:(i=1/Math.sqrt(i),new s(A*i,g*i,I*i))}normalizeInPlace(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];let i=A*A+g*g+I*I+C*C;i<Number.EPSILON||(i=1/Math.sqrt(i),this.set(A*i,g*i,I*i,C*i))}dot(A){return this.x*A.x+this.y*A.y+this.z*A.z+this.t*A.t}cross(A){const g=this.x,I=this.y,C=this.z,i=this.t,e=A.x,t=A.y,B=A.z,o=A.t;return new s(I*B-C*t,C*o-i*B,i*e-g*o,g*t-I*e)}angleTo(A){const g=this.normalize(),I=A.normalize(),C=g.dot(I);return C>1?0:Math.acos(C)}lerp(A,g){const I=this.x,C=this.y,i=this.z,e=this.t;return new s(I+g*(A.x-I),C+g*(A.y-C),i+g*(A.z-i),e+g*(A.t-e))}clone(){return new s(this.__data[0],this.__data[1],this.__data[2],this.__data[3])}toVec3(){return new o(this.__data[0],this.__data[1],this.__data[2])}asArray(){return this.__data}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return{x:this.x,y:this.y,z:this.z,t:this.t}}fromJSON(A){this.x=A.x,this.y=A.y,this.z=A.z,this.t=A.t}readBinary(A){this.x=A.loadFloat32(),this.y=A.loadFloat32(),this.z=A.loadFloat32(),this.t=A.loadFloat32()}isValid(){for(const A of this.__data)if(A==1/0||isNaN(A))return!1;return!0}}class a{constructor(A=0,g=0,I=0,C=255){if(A instanceof Uint8Array)this.__data=A;else if(A instanceof ArrayBuffer){const I=A,C=g;this.__data=new Uint8Array(I,C,4)}else this.__data=new Uint8Array(4),"string"==typeof A?A.startsWith("#")?this.setFromHex(A):this.setFromCSSColorName(A):(this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C)}get r(){return this.__data[0]}set r(A){this.__data[0]=A}get g(){return this.__data[1]}set g(A){this.__data[1]=A}get b(){return this.__data[2]}set b(A){this.__data[2]=A}get a(){return this.__data[3]}set a(A){this.__data[3]=A}set(A,g,I,C=255){this.r=A,this.g=g,this.b=I,this.a=C}setFromOther(A){this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a}setFromArray(A){this.r=A[0],this.g=A[1],this.b=A[2],this.a=4==A.length?A[3]:1}setFromHex(A){const g=function(A){const g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(A);return g?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16)}:null}(A);g?this.set(g.r,g.g,g.b):console.warn("Invalid hex code:"+A)}setFromCSSColorName(A){if(A.startsWith("#"))this.setFromHex(A);else{const g={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}[A.toLowerCase()];g&&this.setFromHex(g)}}toHex(){function A(A){const g=A.toString(16);return 1==g.length?"0"+g:g}return"#"+A(this.r)+A(this.g)+A(this.b)}equal(A){return this.r==A.r&&this.g==A.g&&this.b==A.b&&this.a==A.a}notEquals(A){return this.r!=A.r&&this.g!=A.g&&this.b!=A.b&&this.a!=A.a}approxEqual(A,g=Number.EPSILON){return Math.abs(this.r-A.r)<g&&Math.abs(this.g-A.g)<g&&Math.abs(this.b-A.b)<g&&Math.abs(this.a-A.a)<g}add(A){return new a(this.r+A.r,this.g+A.g,this.b+A.b,this.a+A.a)}subtract(A){return new a(this.r-A.r,this.g-A.g,this.b-A.b,this.a-A.a)}scale(A){return new a(this.r*A,this.g*A,this.b*A,this.a*A)}scaleInPlace(A){this.r*=A,this.g*=A,this.b*=A,this.a*=A}applyGamma(A){this.set(Math.pow(this.r,A),Math.pow(this.g,A),Math.pow(this.b,A),this.a)}toLinear(A=2.2){return new a(Math.pow(this.r,A),Math.pow(this.g,A),Math.pow(this.b,A),this.a)}toGamma(A=2.2){return new a(Math.pow(this.r,1/A),Math.pow(this.g,1/A),Math.pow(this.b,1/A),this.a)}luminance(){return.2126*this.r+.7152*this.g+.0722*this.b}lerp(A,g){const I=this.r,C=this.g,i=this.b,e=this.a;return new a(I+g*(A.r-I),C+g*(A.g-C),i+g*(A.b-i),e+g*(A.a-e))}static random(A=0,g=!1){return A>0?new a(A+Math.random()*(1-A),A+Math.random()*(1-A),A+Math.random()*(1-A),g?A+Math.random()*(1-A):1):A<0?new a(Math.random()*(1+A),Math.random()*(1+A),Math.random()*(1+A),g?Math.random()*(1+A):1):new a(Math.random(),Math.random(),Math.random(),g?Math.random():1)}clone(){return new a(this.__data[0],this.__data[1],this.__data[2],this.__data[3])}asArray(){return this.__data}as3ComponentArray(){return[this.__data[0],this.__data[1],this.__data[2]]}toJSON(){return{r:this.r,g:this.g,b:this.b,a:this.a}}fromJSON(A){this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a}toCSSString(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"}}class l{constructor(A=0,g=0,I=0,C=1){if(A instanceof Float32Array)this.__data=A;else if(A instanceof ArrayBuffer){console.warn("deprecated, please use new Vec4(new Float32Array(buffer, byteOffset, 4))");const I=A,C=g;this.__data=new Float32Array(I,C,4)}else this.__data=new Float32Array(4),"string"==typeof A?A.startsWith("#")?this.setFromHex(A):this.setFromCSSColorName(A):(this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C)}get r(){return this.__data[0]}set r(A){this.__data[0]=A}get g(){return this.__data[1]}set g(A){this.__data[1]=A}get b(){return this.__data[2]}set b(A){this.__data[2]=A}get a(){return this.__data[3]}set a(A){this.__data[3]=A}set(A,g,I,C=1){this.r=A,this.g=g,this.b=I,this.a=C}setFromOther(A){this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a}setFromScalarArray(A){this.r=A[0],this.g=A[1],this.b=A[2],this.a=4==A.length?A[3]:1}getAsRGBArray(){return[255*this.r,255*this.g,255*this.b]}getAsRGBDict(){return{r:255*this.r,g:255*this.g,b:255*this.b}}setFromRGB(A,g,I,C){this.r=A/255,this.g=g/255,this.b=I/255,this.a=C?C/255:1}setFromRGBArray(A){this.r=A[0]/255,this.g=A[1]/255,this.b=A[2]/255,this.a=4==A.length?A[3]/255:1}setFromRGBDict(A){this.r=A.r/255,this.g=A.g/255,this.b=A.b/255,this.a=4==A.a?A.a/255:1}setFromHex(A){const g=function(A){const g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(A);return g?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16)}:null}(A);g?this.setFromRGB(g.r,g.g,g.b):console.warn("Invalid hex code:"+A)}setFromCSSColorName(A){if(A.startsWith("#"))this.setFromHex(A);else{const g={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}[A.toLowerCase()];g&&this.setFromHex(g)}}toHex(){function A(A){const g=Math.round(255*A).toString(16);return 1==g.length?"0"+g:g}return"#"+A(this.r)+A(this.g)+A(this.b)}isEqual(A){return this.r==A.r&&this.g==A.g&&this.b==A.b&&this.a==A.a}notEquals(A){return this.r!=A.r&&this.g!=A.g&&this.b!=A.b&&this.a!=A.a}approxEqual(A,g=Number.EPSILON){return Math.abs(this.r-A.r)<g&&Math.abs(this.g-A.g)<g&&Math.abs(this.b-A.b)<g&&Math.abs(this.a-A.a)<g}add(A){return new l(this.r+A.r,this.g+A.g,this.b+A.b,this.a+A.a)}addInPlace(A){this.r+=A.r,this.g+=A.g,this.b+=A.b,this.a+=A.a}subtract(A){return new l(this.r-A.r,this.g-A.g,this.b-A.b,this.a-A.a)}scale(A){return new l(this.r*A,this.g*A,this.b*A,this.a*A)}scaleInPlace(A){this.r*=A,this.g*=A,this.b*=A,this.a*=A}applyGamma(A){this.set(Math.pow(this.r,A),Math.pow(this.g,A),Math.pow(this.b,A),this.a)}toLinear(A=2.2){return new l(Math.pow(this.r,A),Math.pow(this.g,A),Math.pow(this.b,A),this.a)}toGamma(A=2.2){return new l(Math.pow(this.r,1/A),Math.pow(this.g,1/A),Math.pow(this.b,1/A),this.a)}luminance(){return.2126*this.r+.7152*this.g+.0722*this.b}lerp(A,g){const I=this.r,C=this.g,i=this.b,e=this.a;return new l(I+g*(A.r-I),C+g*(A.g-C),i+g*(A.b-i),e+g*(A.a-e))}static random(A=0,g=!1){return A>0?new l(A+Math.random()*(1-A),A+Math.random()*(1-A),A+Math.random()*(1-A),g?A+Math.random()*(1-A):1):A<0?new l(Math.random()*(1+A),Math.random()*(1+A),Math.random()*(1+A),g?Math.random()*(1+A):1):new l(Math.random(),Math.random(),Math.random(),g?Math.random():1)}clone(){return new l(this.__data[0],this.__data[1],this.__data[2],this.__data[3])}asArray(){return this.__data}as3ComponentArray(){return[this.__data[0],this.__data[1],this.__data[2]]}toJSON(){return{r:this.r,g:this.g,b:this.b,a:this.a}}fromJSON(A){this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a}readBinary(A){this.r=A.loadFloat32(),this.g=A.loadFloat32(),this.b=A.loadFloat32(),this.a=A.loadFloat32()}toCSSString(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"}}class n{constructor(A=0,g=0,I=0,C=0){if("number"!=typeof C||isNaN(C))switch(C){case"XYZ":this.order=0;break;case"YZX":this.order=1;break;case"ZXY":this.order=2;break;case"XZY":this.order=3;break;case"ZYX":this.order=4;break;case"YXZ":this.order=5;break;default:throw new Error("Invalid Euler Angles Order:"+C)}else this.order=C;if(A instanceof ArrayBuffer){const I=A,C=g;this.__data=new Float32Array(I,C,4)}else this.__data=new Float32Array(3),this.__data[0]=A,this.__data[1]=g,this.__data[2]=I}get x(){return this.__data[0]}set x(A){this.__data[0]=A}get y(){return this.__data[1]}set y(A){this.__data[1]=A}get z(){return this.__data[2]}set z(A){this.__data[2]=A}set(A,g,I){this.__data[0]=A,this.__data[1]=g,this.__data[2]=I}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return{x:this.__data[0],y:this.__data[1],z:this.__data[2],order:this.order}}fromJSON(A){this.__data[0]=A.x,this.__data[1]=A.y,this.__data[2]=A.z,this.order=A.order}}class d{constructor(A=1,g=0,I=0,C=0,i=1,e=0,t=0,B=0,s=1){if(A instanceof o&&g instanceof o&&I instanceof o)this.__data=new Float32Array(9),this.set(A.x,A.y,A.z,g.x,g.y,g.z,I.x,I.y,I.z);else if(A instanceof Float32Array)this.__data=A;else if(A instanceof ArrayBuffer){console.warn("Deprecated, please use new Vec3(new Float32Array(buffer, byteOffset, 9))");const I=A,C=g;this.__data=new Float32Array(I,C,9)}else this.__data=new Float32Array(9),this.set(A,g,I,C,i,e,t,B,s)}get m00(){return this.__data[0]}set m00(A){this.__data[0]=A}get m01(){return this.__data[1]}set m01(A){this.__data[1]=A}get m02(){return this.__data[2]}set m02(A){this.__data[2]=A}get m10(){return this.__data[3]}set m10(A){this.__data[3]=A}get m11(){return this.__data[4]}set m11(A){this.__data[4]=A}get m12(){return this.__data[5]}set m12(A){this.__data[5]=A}get m20(){return this.__data[6]}set m20(A){this.__data[6]=A}get m21(){return this.__data[7]}set m21(A){this.__data[7]=A}get m22(){return this.__data[8]}set m22(A){this.__data[8]=A}get xAxis(){return new o(new Float32Array(this.__data.buffer,0,3))}set xAxis(A){this.xAxis.set(A.x,A.y,A.z)}get yAxis(){return new o(new Float32Array(this.__data.buffer,12,3))}set yAxis(A){this.yAxis.set(A.x,A.y,A.z)}get zAxis(){return new o(new Float32Array(this.__data.buffer,24,3))}set zAxis(A){this.zAxis.set(A.x,A.y,A.z)}set(A=1,g=0,I=0,C=0,i=1,e=0,t=0,B=0,o=1){this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C,this.__data[4]=i,this.__data[5]=e,this.__data[6]=t,this.__data[7]=B,this.__data[8]=o}setIdentity(){this.set()}setFromMat(A){this.__data[0]=A.m00,this.__data[1]=A.m01,this.__data[2]=A.m02,this.__data[3]=A.m10,this.__data[4]=A.m11,this.__data[5]=A.m12,this.__data[6]=A.m20,this.__data[7]=A.m21,this.__data[8]=A.m22}setFromDirectionAndUpvector(A,g){const I=A,C=I.length();if(C<Number.EPSILON)return void this.setIdentity();I.scaleInPlace(1/C);const i=g.cross(I),e=i.length();e>Number.EPSILON&&i.scaleInPlace(1/e);const t=I.cross(i),B=t.length();B>Number.EPSILON&&t.scaleInPlace(1/B),this.set(i.x,i.y,i.z,t.x,t.y,t.z,I.x,I.y,I.z)}inverse(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3],i=this.__data[4],e=this.__data[5],t=this.__data[6],B=this.__data[7],o=this.__data[8],s=o*i-e*B,a=-o*C+e*t,l=B*C-i*t;let n=A*s+g*a+I*l;return n?(n=1/n,new d(s*n,(-o*g+I*B)*n,(e*g-I*i)*n,a*n,(o*A-I*t)*n,(-e*A+I*C)*n,l*n,(-B*A+g*t)*n,(i*A-g*C)*n)):(console.warn("Unable to invert Mat3"),new d)}invertInPlace(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3],i=this.__data[4],e=this.__data[5],t=this.__data[6],B=this.__data[7],o=this.__data[8],s=o*i-e*B,a=-o*C+e*t,l=B*C-i*t;let n=A*s+g*a+I*l;return n?(n=1/n,this.set(s*n,(-o*g+I*B)*n,(e*g-I*i)*n,a*n,(o*A-I*t)*n,(-e*A+I*C)*n,l*n,(-B*A+g*t)*n,(i*A-g*C)*n),!0):(console.warn("Unable to invert Mat3"),!1)}transpose(){return new d(this.__data[0],this.__data[3],this.__data[6],this.__data[1],this.__data[4],this.__data[7],this.__data[2],this.__data[5],this.__data[8])}transposeInPlace(){const A=this.__data[1],g=this.__data[2],I=this.__data[5];this.__data[1]=this.__data[3],this.__data[2]=this.__data[6],this.__data[3]=A,this.__data[5]=this.__data[7],this.__data[6]=g,this.__data[7]=I}transformVec3(A){return new o(this.__data[0]*A.x+this.__data[1]*A.y+this.__data[2]*A.z,this.__data[3]*A.x+this.__data[4]*A.y+this.__data[5]*A.z,this.__data[6]*A.x+this.__data[7]*A.y+this.__data[8]*A.z)}clone(){return new d(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8])}readBinary(A){this.__data=A.loadFloat32Array(9)}toJSON(){return this.__data}fromJSON(A){this.__data=new Float32Array(A)}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}asArray(){return this.__data}}class h{constructor(A=1,g=0,I=0,C=0,i=0,e=1,t=0,B=0,o=0,s=0,a=1,l=0,n=0,d=0,h=0,c=1){if(A instanceof Float32Array)this.__data=A;else if(A instanceof ArrayBuffer){const I=A,C=g;this.__data=new Float32Array(I,C,16)}else this.__data=new Float32Array(16),this.set(A,g,I,C,i,e,t,B,o,s,a,l,n,d,h,c)}get m00(){return this.__data[0]}set m00(A){this.__data[0]=A}get m01(){return this.__data[1]}set m01(A){this.__data[1]=A}get m02(){return this.__data[2]}set m02(A){this.__data[2]=A}get m03(){return this.__data[3]}set m03(A){this.__data[3]=A}get m10(){return this.__data[4]}set m10(A){this.__data[4]=A}get m11(){return this.__data[5]}set m11(A){this.__data[5]=A}get m12(){return this.__data[6]}set m12(A){this.__data[6]=A}get m13(){return this.__data[7]}set m13(A){this.__data[7]=A}get m20(){return this.__data[8]}set m20(A){this.__data[8]=A}get m21(){return this.__data[9]}set m21(A){this.__data[9]=A}get m22(){return this.__data[10]}set m22(A){this.__data[10]=A}get m23(){return this.__data[11]}set m23(A){this.__data[11]=A}get m30(){return this.__data[12]}set m30(A){this.__data[12]=A}get m31(){return this.__data[13]}set m31(A){this.__data[13]=A}get m32(){return this.__data[14]}set m32(A){this.__data[14]=A}get m33(){return this.__data[15]}set m33(A){this.__data[15]=A}get xAxis(){return new o(new Float32Array(this.__data.buffer,0,3))}set xAxis(A){this.xAxis.set(A.x,A.y,A.z)}get yAxis(){return new o(new Float32Array(this.__data.buffer,16,3))}set yAxis(A){this.yAxis.set(A.x,A.y,A.z)}get zAxis(){return new o(new Float32Array(this.__data.buffer,32,3))}set zAxis(A){this.zAxis.set(A.x,A.y,A.z)}get translation(){return new o(new Float32Array(this.__data.buffer,48,3))}set translation(A){this.translation.set(A.x,A.y,A.z)}set(A=1,g=0,I=0,C=0,i=0,e=1,t=0,B=0,o=0,s=0,a=1,l=0,n=0,d=0,h=0,c=1){this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C,this.__data[4]=i,this.__data[5]=e,this.__data[6]=t,this.__data[7]=B,this.__data[8]=o,this.__data[9]=s,this.__data[10]=a,this.__data[11]=l,this.__data[12]=n,this.__data[13]=d,this.__data[14]=h,this.__data[15]=c}setIdentity(){this.set()}setDataArray(A){this.__data=A}setFromMat4(A){this.__data[0]=A.m00,this.__data[1]=A.m01,this.__data[2]=A.m02,this.__data[3]=A.m03,this.__data[4]=A.m10,this.__data[5]=A.m11,this.__data[6]=A.m12,this.__data[7]=A.m13,this.__data[8]=A.m20,this.__data[9]=A.m21,this.__data[10]=A.m22,this.__data[11]=A.m23,this.__data[12]=A.m30,this.__data[13]=A.m31,this.__data[14]=A.m32,this.__data[15]=A.m33}toMat3(){return new d(this.__data[0],this.__data[1],this.__data[2],this.__data[4],this.__data[5],this.__data[6],this.__data[8],this.__data[9],this.__data[10])}transposeInPlace(){const A=this.__data[1],g=this.__data[2],I=this.__data[3],C=this.__data[6],i=this.__data[7],e=this.__data[11];this.__data[1]=this.__data[4],this.__data[2]=this.__data[8],this.__data[3]=this.__data[12],this.__data[4]=A,this.__data[6]=this.__data[9],this.__data[7]=this.__data[13],this.__data[8]=g,this.__data[9]=C,this.__data[11]=this.__data[14],this.__data[12]=I,this.__data[13]=i,this.__data[14]=e}transpose(){return new h(this.__data[0],this.__data[4],this.__data[8],this.__data[12],this.__data[1],this.__data[5],this.__data[9],this.__data[13],this.__data[2],this.__data[6],this.__data[10],this.__data[14],this.__data[3],this.__data[7],this.__data[11],this.__data[15])}inverse(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3],i=this.__data[4],e=this.__data[5],t=this.__data[6],B=this.__data[7],o=this.__data[8],s=this.__data[9],a=this.__data[10],l=this.__data[11],n=this.__data[12],d=this.__data[13],c=this.__data[14],r=this.__data[15],G=A*e-g*i,m=A*t-I*i,Q=A*B-C*i,E=g*t-I*e,b=g*B-C*e,Z=I*B-C*t,y=o*d-s*n,u=o*c-a*n,R=o*r-l*n,V=s*c-a*d,F=s*r-l*d,S=a*r-l*c;let w=G*S-m*F+Q*V+E*R-b*u+Z*y;return w?(w=1/w,new h((e*S-t*F+B*V)*w,(I*F-g*S-C*V)*w,(d*Z-c*b+r*E)*w,(a*b-s*Z-l*E)*w,(t*R-i*S-B*u)*w,(A*S-I*R+C*u)*w,(c*Q-n*Z-r*m)*w,(o*Z-a*Q+l*m)*w,(i*F-e*R+B*y)*w,(g*R-A*F-C*y)*w,(n*b-d*Q+r*G)*w,(s*Q-o*b-l*G)*w,(e*u-i*V-t*y)*w,(A*V-g*u+I*y)*w,(d*m-n*E-c*G)*w,(o*E-s*m+a*G)*w)):(console.warn("Unable to invert Mat4"),this)}invertInPlace(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3],i=this.__data[4],e=this.__data[5],t=this.__data[6],B=this.__data[7],o=this.__data[8],s=this.__data[9],a=this.__data[10],l=this.__data[11],n=this.__data[12],d=this.__data[13],h=this.__data[14],c=this.__data[15],r=A*e-g*i,G=A*t-I*i,m=A*B-C*i,Q=g*t-I*e,E=g*B-C*e,b=I*B-C*t,Z=o*d-s*n,y=o*h-a*n,u=o*c-l*n,R=s*h-a*d,V=s*c-l*d,F=a*c-l*h;let S=r*F-G*V+m*R+Q*u-E*y+b*Z;return S?(S=1/S,this.set((e*F-t*V+B*R)*S,(I*V-g*F-C*R)*S,(d*b-h*E+c*Q)*S,(a*E-s*b-l*Q)*S,(t*u-i*F-B*y)*S,(A*F-I*u+C*y)*S,(h*m-n*b-c*G)*S,(o*b-a*m+l*G)*S,(i*V-e*u+B*Z)*S,(g*u-A*V-C*Z)*S,(n*E-d*m+c*r)*S,(s*m-o*E-l*r)*S,(e*y-i*R-t*Z)*S,(A*R-g*y+I*Z)*S,(d*G-n*Q-h*r)*S,(o*Q-s*G+a*r)*S),!0):(console.warn("Unable to invert Mat4"),!1)}setInverse(A){const g=A.__data[0],I=A.__data[1],C=A.__data[2],i=A.__data[3],e=A.__data[4],t=A.__data[5],B=A.__data[6],o=A.__data[7],s=A.__data[8],a=A.__data[9],l=A.__data[10],n=A.__data[11],d=A.__data[12],h=A.__data[13],c=A.__data[14],r=A.__data[15],G=g*t-I*e,m=g*B-C*e,Q=g*o-i*e,E=I*B-C*t,b=I*o-i*t,Z=C*o-i*B,y=s*h-a*d,u=s*c-l*d,R=s*r-n*d,V=a*c-l*h,F=a*r-n*h,S=l*r-n*c;let w=G*S-m*F+Q*V+E*R-b*u+Z*y;if(!w)throw new Error("Unable to invert Mat4");w=1/w,this.set((t*S-B*F+o*V)*w,(C*F-I*S-i*V)*w,(h*Z-c*b+r*E)*w,(l*b-a*Z-n*E)*w,(B*R-e*S-o*u)*w,(g*S-C*R+i*u)*w,(c*Q-d*Z-r*m)*w,(s*Z-l*Q+n*m)*w,(e*F-t*R+o*y)*w,(I*R-g*F-i*y)*w,(d*b-h*Q+r*G)*w,(a*Q-s*b-n*G)*w,(t*u-e*V-B*y)*w,(g*V-I*u+C*y)*w,(h*m-d*E-c*G)*w,(s*E-a*m+l*G)*w)}multiply(A){const g=this.__data[0],I=this.__data[1],C=this.__data[2],i=this.__data[3],e=this.__data[4],t=this.__data[5],B=this.__data[6],o=this.__data[7],s=this.__data[8],a=this.__data[9],l=this.__data[10],n=this.__data[11],d=this.__data[12],c=this.__data[13],r=this.__data[14],G=this.__data[15],m=A.asArray();let Q=m[0],E=m[1],b=m[2],Z=m[3];const y=new h;return y.m00=Q*g+E*e+b*s+Z*d,y.m01=Q*I+E*t+b*a+Z*c,y.m02=Q*C+E*B+b*l+Z*r,y.m03=Q*i+E*o+b*n+Z*G,Q=m[4],E=m[5],b=m[6],Z=m[7],y.m10=Q*g+E*e+b*s+Z*d,y.m11=Q*I+E*t+b*a+Z*c,y.m12=Q*C+E*B+b*l+Z*r,y.m13=Q*i+E*o+b*n+Z*G,Q=m[8],E=m[9],b=m[10],Z=m[11],y.m20=Q*g+E*e+b*s+Z*d,y.m21=Q*I+E*t+b*a+Z*c,y.m22=Q*C+E*B+b*l+Z*r,y.m23=Q*i+E*o+b*n+Z*G,Q=m[12],E=m[13],b=m[14],Z=m[15],y.m30=Q*g+E*e+b*s+Z*d,y.m31=Q*I+E*t+b*a+Z*c,y.m32=Q*C+E*B+b*l+Z*r,y.m33=Q*i+E*o+b*n+Z*G,y}multiplyInPlace(A){const g=this.asArray(),I=g[0],C=g[1],i=g[2],e=g[3],t=g[4],B=g[5],o=g[6],s=g[7],a=g[8],l=g[9],n=g[10],d=g[11],h=g[12],c=g[13],r=g[14],G=g[15],m=A.asArray();let Q=m[0],E=m[1],b=m[2],Z=m[3];return this.m00=Q*I+E*t+b*a+Z*h,this.m01=Q*C+E*B+b*l+Z*c,this.m02=Q*i+E*o+b*n+Z*r,this.m03=Q*e+E*s+b*d+Z*G,Q=m[4],E=m[5],b=m[6],Z=m[7],this.m10=Q*I+E*t+b*a+Z*h,this.m11=Q*C+E*B+b*l+Z*c,this.m12=Q*i+E*o+b*n+Z*r,this.m13=Q*e+E*s+b*d+Z*G,Q=m[8],E=m[9],b=m[10],Z=m[11],this.m20=Q*I+E*t+b*a+Z*h,this.m21=Q*C+E*B+b*l+Z*c,this.m22=Q*i+E*o+b*n+Z*r,this.m23=Q*e+E*s+b*d+Z*G,Q=m[12],E=m[13],b=m[14],Z=m[15],this.m30=Q*I+E*t+b*a+Z*h,this.m31=Q*C+E*B+b*l+Z*c,this.m32=Q*i+E*o+b*n+Z*r,this.m33=Q*e+E*s+b*d+Z*G,this}postMultiplyInPlace(A){const g=A.asArray(),I=g[0],C=g[1],i=g[2],e=g[3],t=g[4],B=g[5],o=g[6],s=g[7],a=g[8],l=g[9],n=g[10],d=g[11],h=g[12],c=g[13],r=g[14],G=g[15],m=this.asArray();let Q=m[0],E=m[1],b=m[2],Z=m[3];return this.m00=Q*I+E*t+b*a+Z*h,this.m01=Q*C+E*B+b*l+Z*c,this.m02=Q*i+E*o+b*n+Z*r,this.m03=Q*e+E*s+b*d+Z*G,Q=m[4],E=m[5],b=m[6],Z=m[7],this.m10=Q*I+E*t+b*a+Z*h,this.m11=Q*C+E*B+b*l+Z*c,this.m12=Q*i+E*o+b*n+Z*r,this.m13=Q*e+E*s+b*d+Z*G,Q=m[8],E=m[9],b=m[10],Z=m[11],this.m20=Q*I+E*t+b*a+Z*h,this.m21=Q*C+E*B+b*l+Z*c,this.m22=Q*i+E*o+b*n+Z*r,this.m23=Q*e+E*s+b*d+Z*G,Q=m[12],E=m[13],b=m[14],Z=m[15],this.m30=Q*I+E*t+b*a+Z*h,this.m31=Q*C+E*B+b*l+Z*c,this.m32=Q*i+E*o+b*n+Z*r,this.m33=Q*e+E*s+b*d+Z*G,this}translateInPlace(A){const g=this.__data,I=A.x,C=A.y,i=A.z;return g[12]=g[0]*I+g[4]*C+g[8]*i+g[12],g[13]=g[1]*I+g[5]*C+g[9]*i+g[13],g[14]=g[2]*I+g[6]*C+g[10]*i+g[14],g[15]=g[3]*I+g[7]*C+g[11]*i+g[15],this}setLookAt(A,g,I){const C=A.subtract(g),i=C.length();if(i<Number.EPSILON)return void this.setIdentity();C.scaleInPlace(1/i);const e=I.cross(C),t=e.length();t>Number.EPSILON&&e.scaleInPlace(1/t);const B=C.cross(e),o=B.length();o>Number.EPSILON&&B.scaleInPlace(1/o),this.set(e.x,e.y,e.z,0,B.x,B.y,B.z,0,C.x,C.y,C.z,0,A.x,A.y,A.z,1)}setRotation(A,g){const I=A.length();if(Math.abs(I)<Number.EPSILON)return null;const C=A.x/I,i=A.y/I,e=A.z/I,t=Math.sin(g),B=Math.cos(g),o=1-B,s=this.__data;return s[0]=C*C*o+B,s[1]=i*C*o+e*t,s[2]=e*C*o-i*t,s[3]=0,s[4]=C*i*o-e*t,s[5]=i*i*o+B,s[6]=e*i*o+C*t,s[7]=0,s[8]=C*e*o+i*t,s[9]=i*e*o-C*t,s[10]=e*e*o+B,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}setXRotation(A){const g=Math.sin(A),I=Math.cos(A),C=this.__data;return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=I,C[6]=g,C[7]=0,C[8]=0,C[9]=-g,C[10]=I,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,this}setYRotation(A){const g=Math.sin(A),I=Math.cos(A),C=this.__data;return C[0]=I,C[1]=0,C[2]=-g,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=g,C[9]=0,C[10]=I,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,this}setZRotation(A){const g=Math.sin(A),I=Math.cos(A),C=this.__data;return C[0]=I,C[1]=g,C[2]=0,C[3]=0,C[4]=-g,C[5]=I,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,this}transformVec4(A){const g=this.__data,I=A.x,C=A.y,i=A.z,e=A.t;return new s(g[0]*I+g[4]*C+g[8]*i+g[12]*e,g[1]*I+g[5]*C+g[9]*i+g[13]*e,g[2]*I+g[6]*C+g[10]*i+g[14]*e,g[3]*I+g[7]*C+g[11]*i+g[15]*e)}transformVec3(A){const g=this.__data,I=A.x,C=A.y,i=A.z;return new o(g[0]*I+g[4]*C+g[8]*i+g[12],g[1]*I+g[5]*C+g[9]*i+g[13],g[2]*I+g[6]*C+g[10]*i+g[14])}rotateVec3(A){const g=this.__data,I=A.x,C=A.y,i=A.z;return new o(g[0]*I+g[4]*C+g[8]*i,g[1]*I+g[5]*C+g[9]*i,g[2]*I+g[6]*C+g[10]*i)}setPerspectiveMatrix(A,g,I,C){const i=Math.tan(.5*Math.PI-.5*A),e=1/(I-C);this.set(i/g,0,0,0,0,i,0,0,0,0,(I+C)*e,-1,0,0,I*C*e*2,0)}setOrthographicMatrix(A,g,I,C,i,e){const t=1/(A-g),B=1/(I-C),o=1/(i-e);this.set(-2*t,0,0,0,0,-2*B,0,0,0,0,2*o,0,(A+g)*t,(C+I)*B,(e+i)*o,1)}setScale(A,g,I){A instanceof o?this.set(A.x,0,0,0,0,A.y,0,0,0,0,A.z,0,0,0,0,1):this.set(A,0,0,0,0,g,0,0,0,0,I,0,0,0,0,1)}setFromMat3x4Array(A){this.set(A[0],A[1],A[2],0,A[3],A[4],A[5],0,A[6],A[7],A[8],0,A[9],A[10],A[11],1)}clone(){return new h(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8],this.__data[9],this.__data[10],this.__data[11],this.__data[12],this.__data[13],this.__data[14],this.__data[15])}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return this.__data}fromJSON(A){this.__data=new Float32Array(A)}readBinary(A){this.__data=A.loadFloat32Array(16)}asArray(){return this.__data}}class c{constructor(A=0,g=0,I=0,C=1){if(A instanceof Float32Array)this.__data=A;else if(A instanceof ArrayBuffer){console.warn("deprecated, please use new Vec4(new Float32Array(buffer, byteOffset, 4))");const I=A,C=g;this.__data=new Float32Array(I,C,4)}else this.__data=new Float32Array(4),"object"==typeof A?(this.__data[0]=0,this.__data[1]=0,this.__data[2]=0,this.__data[3]=1,this.fromJSON(A)):(this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C)}get x(){return this.__data[0]}set x(A){this.__data[0]=A}get y(){return this.__data[1]}set y(A){this.__data[1]=A}get z(){return this.__data[2]}set z(A){this.__data[2]=A}get w(){return this.__data[3]}set w(A){this.__data[3]=A}set(A,g,I,C){this.__data[0]=A,this.__data[1]=g,this.__data[2]=I,this.__data[3]=C}setDataArray(A){this.__data=A}setFromOther(A){this.__data[0]=A.x,this.__data[1]=A.y,this.__data[2]=A.z,this.__data[3]=A.w}setFromEulerAngles(A){const g=new o;switch(A.order){case 0:g.set(A.x,-A.y,A.z);break;case 1:g.set(A.y,-A.z,A.x);break;case 2:g.set(A.z,-A.x,A.y);break;case 3:g.set(A.x,A.z,A.y);break;case 4:g.set(A.z,A.y,A.x);break;case 5:g.set(A.y,A.x,A.z);break;default:throw new Error(`Invalid EulerAngles order: ${A.order}`)}const I=.5*g.x,C=.5*g.y,i=.5*g.z,e=Math.cos(I),t=Math.cos(C),B=Math.cos(i),s=Math.sin(I),a=Math.sin(C),l=Math.sin(i),n=e*B,d=e*l,h=s*B,c=s*l,r=t*h-a*d,G=t*c+a*n,m=t*d-a*h;switch(this.w=t*n+a*c,A.order){case 0:this.x=r,this.y=-G,this.z=m;break;case 1:this.x=m,this.y=r,this.z=-G;break;case 2:this.x=-G,this.y=m,this.z=r;break;case 3:this.x=r,this.y=m,this.z=G;break;case 4:this.x=m,this.y=G,this.z=r;break;case 5:this.x=G,this.y=r,this.z=m;break;default:throw new Error(`Invalid EulerAngles order: ${A.order}`)}}toEulerAngles(A){const g=new o;switch(A){case 0:g.set(this.z,this.x,this.y);break;case 1:g.set(this.x,this.y,this.z);break;case 2:g.set(this.y,this.z,this.x);break;case 3:g.set(this.y,-this.x,this.z);break;case 4:g.set(this.x,-this.z,this.y);break;case 5:g.set(this.z,-this.y,this.x);break;default:throw new Error("Invalid rotation order:"+A)}const I=new o,C=g.x*g.y+g.z*this.w;if(C>.49999)I.y=2*Math.atan2(g.x,this.w),I.z=.5*Math.PI,I.x=0;else if(C<-.49999)I.y=-2*Math.atan2(g.x,this.w),I.z=-.5*Math.PI,I.x=0;else{const A=g.x*g.x,i=g.y*g.y,e=g.z*g.z;I.y=Math.atan2(2*g.y*this.w-2*g.x*g.z,1-2*i-2*e),I.z=Math.asin(2*C),I.x=Math.atan2(2*g.x*this.w-2*g.y*g.z,1-2*A-2*e)}switch(A){case 0:return new n(I.y,I.z,I.x,A);case 1:return new n(I.x,I.y,I.z,A);case 2:return new n(I.z,I.x,I.y,A);case 3:return new n(-I.y,I.x,I.z,A);case 4:return new n(I.x,I.z,-I.y,A);case 5:return new n(I.z,-I.y,I.x,A)}}setFromAxisAndAngle(A,g){const I=g/2,C=A.normalize().scale(Math.sin(I));this.set(C.x,C.y,C.z,Math.cos(I))}setFromDirectionAndUpvector(A,g){const I=new d;I.setFromDirectionAndUpvector(A,g),this.setFromMat3(I)}setFrom2Vectors(A,g){const I=A.cross(g),C=A.dot(g),i=Math.sqrt(2*(1+C));this.set(I.x/i,I.y/i,I.z/i,i/2),this.normalizeInPlace()}setFromMat3(A){const g=A.asArray(),I=g[0]+g[4]+g[8];let C;if(I>0)C=Math.sqrt(I+1),this.__data[3]=.5*C,C=.5/C,this.__data[0]=(g[5]-g[7])*C,this.__data[1]=(g[6]-g[2])*C,this.__data[2]=(g[1]-g[3])*C;else{let A=0;g[4]>g[0]&&(A=1),g[8]>g[3*A+A]&&(A=2);const I=(A+1)%3,i=(A+2)%3;C=Math.sqrt(g[3*A+A]-g[3*I+I]-g[3*i+i]+1),this.__data[A]=.5*C,C=.5/C,this.__data[3]=(g[3*I+i]-g[3*i+I])*C,this.__data[I]=(g[3*I+A]+g[3*A+I])*C,this.__data[i]=(g[3*i+A]+g[3*A+i])*C}this.normalizeInPlace()}setFromMat4(A){const g=A.asArray(),I=g[0]+g[5]+g[10];let C;if(I>0)C=Math.sqrt(I+1),this.__data[3]=.5*C,C=.5/C,this.__data[0]=(g[6]-g[9])*C,this.__data[1]=(g[8]-g[2])*C,this.__data[2]=(g[1]-g[4])*C;else{let A=0;g[5]>g[0]&&(A=1),g[10]>g[4*A+A]&&(A=2);const I=(A+1)%3,i=(A+2)%3;C=Math.sqrt(g[4*A+A]-g[4*I+I]-g[4*i+i]+1),this.__data[A]=.5*C,C=.5/C,this.__data[3]=(g[4*I+i]-g[4*i+I])*C,this.__data[I]=(g[4*I+A]+g[4*A+I])*C,this.__data[i]=(g[4*i+A]+g[4*A+i])*C}this.normalizeInPlace()}isIdentity(){return this.getAngle()<Number.EPSILON}getAngle(){return 2*Math.acos(this.w)}isEqual(A){return this.x==A.x&&this.y==A.y&&this.z==A.z&&this.w==A.w}notEquals(A){return this.x!=A.x&&this.y!=A.y&&this.z!=A.z&&this.w!=A.w}approxEqual(A,g=Number.EPSILON){return Math.abs(this.x-A.x)<g&&Math.abs(this.y-A.y)<g&&Math.abs(this.z-A.z)<g&&Math.abs(this.w-A.w)<g}add(A){return new c(this.x+A.x,this.y+A.y,this.z+A.z,this.w+A.w)}addInPlace(A){this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w}subtract(A){return new c(this.x-A.x,this.y-A.y,this.z-A.z,this.w-A.w)}scale(A){return new c(this.x*A,this.y*A,this.z*A,this.w*A)}scaleInPlace(A){this.x*=A,this.y*=A,this.z*=A,this.w*=A}length(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];return Math.sqrt(A*A+g*g+I*I+C*C)}lengthSquared(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];return A*A+g*g+I*I+C*C}normalize(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];let i=A*A+g*g+I*I+C*C;return i<Number.EPSILON?new c:(i=1/Math.sqrt(i),new c(A*i,g*i,I*i,C*i))}normalizeInPlace(){const A=this.__data[0],g=this.__data[1],I=this.__data[2],C=this.__data[3];let i=A*A+g*g+I*I+C*C;i<Number.EPSILON||(i=1/Math.sqrt(i),this.set(A*i,g*i,I*i,C*i))}dot(A){return this.x*A.x+this.y*A.y+this.z*A.z+this.w*A.w}cross(A){const g=this.x,I=this.y,C=this.z,i=this.w,e=A.x,t=A.y,B=A.z,o=A.w;return new c(I*B-C*t,C*o-i*B,i*e-g*o,g*t-I*e)}conjugate(){return new c(-this.x,-this.y,-this.z,this.w)}inverse(){return this.conjugate()}alignWith(A){this.dot(A)<0&&this.set(-this.x,-this.y,-this.z,-this.w)}multiply(A){const g=this.__data[0],I=this.__data[1],C=this.__data[2],i=this.__data[3],e=A.__data[0],t=A.__data[1],B=A.__data[2],o=A.__data[3];return new c(g*o+i*e+I*B-C*t,I*o+i*t+C*e-g*B,C*o+i*B+g*t-I*e,i*o-g*e-I*t-C*B)}multiplyInPlace(A){const g=this.__data[0],I=this.__data[1],C=this.__data[2],i=this.__data[3],e=A.__data[0],t=A.__data[1],B=A.__data[2],o=A.__data[3];this.set(g*o+i*e+I*B-C*t,I*o+i*t+C*e-g*B,C*o+i*B+g*t-I*e,i*o-g*e-I*t-C*B)}rotateVec3(A){const g=new c(A.x,A.y,A.z,0),I=this.multiply(g).multiply(this.conjugate());return new o(I.x,I.y,I.z)}rotateX(A){A*=.5;const g=this.x,I=this.y,C=this.z,i=this.w,e=Math.sin(A),t=Math.cos(A);this.x=g*t+i*e,this.y=I*t+C*e,this.z=C*t-I*e,this.w=i*t-g*e}rotateY(A){A*=.5;const g=this.x,I=this.y,C=this.z,i=this.w,e=Math.sin(A),t=Math.cos(A);this.x=g*t-C*e,this.y=I*t+i*e,this.z=C*t+g*e,this.w=i*t-I*e}rotateZ(A){A*=.5;const g=this.x,I=this.y,C=this.z,i=this.w,e=Math.sin(A),t=Math.cos(A);this.x=g*t+I*e,this.y=I*t-g*e,this.z=C*t+i*e,this.w=i*t-C*e}toMat3(){const A=this.x,g=this.y,I=this.z,C=this.w,i=A+A,e=g+g,t=I+I,B=A*i,o=g*i,s=g*e,a=I*i,l=I*e,n=I*t,h=C*i,c=C*e,r=C*t,G=new d;return G.m00=1-s-n,G.m10=o-r,G.m20=a+c,G.m01=o+r,G.m11=1-B-n,G.m21=l-h,G.m02=a-c,G.m12=l+h,G.m22=1-B-s,G}getXaxis(){const A=this.x*this.y,g=this.x*this.z,I=this.y*this.y,C=this.y*this.w,i=this.z*this.z,e=this.z*this.w;return new o(1-2*(i+I),2*(A+e),2*(g-C))}getYaxis(){const A=this.x*this.x,g=this.x*this.y,I=this.x*this.w,C=this.y*this.z,i=this.z*this.z,e=this.z*this.w;return new o(2*(g-e),1-2*(i+A),2*(C+I))}getZaxis(){const A=this.x*this.x,g=this.x*this.z,I=this.x*this.w,C=this.y*this.y,i=this.y*this.z,e=this.y*this.w;return new o(2*(e+g),2*(i-I),1-2*(C+A))}mirror(A){switch(A){case 0:case 0:default:return new c(this.z,this.w,this.x,this.y);case 1:return new c(-this.w,this.z,this.y,-this.x);case 2:return new c(this.x,this.y,this.z,-this.w)}}toMat4(){const A=this.x,g=this.y,I=this.z,C=this.w,i=A+A,e=g+g,t=I+I,B=A*i,o=g*i,s=g*e,a=I*i,l=I*e,n=I*t,d=C*i,c=C*e,r=C*t,G=new h;return G.m00=1-s-n,G.m10=o-r,G.m20=a+c,G.m01=o+r,G.m11=1-B-n,G.m21=l-d,G.m02=a-c,G.m12=l+d,G.m22=1-B-s,G}lerp(A,g){const I=new c(this.x+g*(A.x-this.x),this.y+g*(A.y-this.y),this.z+g*(A.z-this.z),this.w+g*(A.w-this.w));return I.normalizeInPlace(),I}slerp(A,g){const I=this.dot(A);if(I>.999)return this;const C=Math.acos(I),i=Math.sin(C),e=Math.sin(g*C),t=Math.sin((1-g)*C)/i,B=e/i,o=new c(t*this.x+B*A.x,t*this.y+B*A.y,t*this.z+B*A.z,t*this.w+B*A.w);return o.normalizeInPlace(),o}clone(){return new c(this.__data[0],this.__data[1],this.__data[2],this.__data[3])}asArray(){return this.__data}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}fromJSON(A){this.__data[0]=A.x,this.__data[1]=A.y,this.__data[2]=A.z,this.__data[3]=A.w,this.normalizeInPlace()}readBinary(A){this.x=A.loadFloat32(),this.y=A.loadFloat32(),this.z=A.loadFloat32(),this.w=A.loadFloat32()}}class r{static radToDeg(A){return A/(Math.PI/180)}static degToRad(A){return A*(Math.PI/180)}static isNumeric(A){return!isNaN(parseFloat(A))&&isFinite(A)}static randomInt(A,g){return A=Math.ceil(A),g=Math.floor(g),Math.floor(Math.random()*(g-A))+A}static lerp(A,g,I){return A+I*(g-A)}static clamp(A,g,I){return Math.min(Math.max(A,g),I)}static nearestPow2(A){return Math.pow(2,Math.round(Math.log(A)/Math.log(2)))}static nearestPow10(A){return Math.pow(10,Math.round(Math.log10(A)/Math.log10(10)))}static nextPow2(A){if(0==this.fract(Math.log2(A)))return A;let g=0;for(;A>0;)g++,A>>=1;return 1<<g}static fract(A){return 0==A?0:A<0?A>-1?-A:-A%Math.floor(-A):A<1?A:A%Math.floor(A)}static remap(A,g,I,C,i){return C+(A-g)/(I-g)*(i-C)}static smoothStep(A,g,I){const C=this.clamp((I-A)/(g-A),0,1);return C*C*(3-2*C)}static linStep(A,g,I){return this.clamp((I-A)/(g-A),0,1)}static decode16BitFloatFrom2xUInt8(A){const g=A[0],I=(120&g)>>3;let C=0==I?0:2048;const i=C+((7&g)<<8)+A[1];C=0==I?1:0;return(128&g?1:-1)*i*Math.pow(2,I+C-16)}static encode16BitFloatInto2xUInt8(A){const g=new Uint8Array(2),I=A>=0?128:0;A=Math.abs(A);let C,i=15,e=1024;for(let g=15;g>0;g--)A<e&&(e/=2,i--);C=0==i?A/e/2:(A-e)/e;const t=Math.round(2048*C),B=t/256,o=t-256*B;return g[0]=I+8*i+B,g[1]=o,A>=2048&&(g[0]=255),g}static encode16BitFloat(A){const g=new Float32Array(1);g[0]=A;return(A=>{let g=A>>16&32768,I=A>>12&2047;const C=A>>23&255;return C<103?g:C>142?(g|=31744,g|=(255==C?0:1)&&8388607&A,g):C<113?(I|=2048,g|=(I>>114-C)+(I>>113-C&1),g):(g|=C-112<<10|I>>1,g+=1&I,g)})(new Int32Array(g.buffer)[0])}static decode16BitFloat(A){const g=(32768&A)>>15,I=(31744&A)>>10,C=1023&A;return 0==I?(g?-1:1)*Math.pow(2,-14)*(C/Math.pow(2,10)):31==I?C?NaN:1/0*(g?-1:1):(g?-1:1)*Math.pow(2,I-15)*(1+C/Math.pow(2,10))}static convertFloat32ArrayToUInt16Array(A){const g=new Uint16Array(A.length),I=new Int32Array(A.buffer),C=A=>{let g=A>>16&32768,I=A>>12&2047;const C=A>>23&255;return C<103?g:C>142?(g|=31744,g|=(255==C?0:1)&&8388607&A,g):C<113?(I|=2048,g|=(I>>114-C)+(I>>113-C&1),g):(g|=C-112<<10|I>>1,g+=1&I,g)};for(let i=0;i<A.length;i++)g[i]=C(I[i]);return g}}class G{constructor(A,g){this.start=A instanceof o?A:new o,this.dir=g instanceof o?g:new o}closestPoint(A){const g=A.subtract(this.start).dot(this.dir);if(g<Number.EPSILON)return 0;const I=this.dir.dot(this.dir);return I<Number.EPSILON?0:g/I}closestPointOnLineSegment(A,g){const I=this.dir,C=g.subtract(A),i=C.length();C.normalizeInPlace();const e=this.start.subtract(A),t=I.dot(I),B=I.dot(C),o=C.dot(C),s=I.dot(e),a=C.dot(e);if(0==t&&0==o)return[this.start.distanceTo(A),0];if(0==t)return[0,0];if(0==o)return[this.closestPoint(A),0];const l=t*o-B*B;let n,d;return l<.001?(n=0,d=B>o?s/B:a/o):(n=(B*a-o*s)/l,d=(t*a-B*s)/l),[n,r.clamp(d/i,0,1)]}pointAtDist(A){return this.start.add(this.dir.scale(A))}intersectRayVector(A){const g=this.dir,I=A.dir,C=this.start.subtract(A.start),i=g.dot(g),e=g.dot(I),t=I.dot(I),B=g.dot(C),o=I.dot(C);if(0==i&&0==t)return this.start.distanceTo(A.start);if(0==i)return A.closestPoint(this.start);if(0==t)return this.closestPoint(A.start);const s=i*t-e*e;let a,l;return s<.001?(a=0,l=e>t?B/e:o/t):(a=(e*o-t*B)/s,l=(i*o-e*B)/s),[a,l]}intersectRayPlane(A){const g=this.start.subtract(A.start),I=A.dir.dot(this.dir),C=-A.dir.dot(g);if(Math.abs(I)<Number.PRECISION)return-1;const i=C/I;return i<-Number.PRECISION?-1:i}intersectRayBox3(A,g=0){const I=new o(1/this.dir.x,1/this.dir.y,1/this.dir.z),C=[];C[0]=I.x<0?1:0,C[1]=I.y<0?1:0,C[2]=I.z<0?1:0;const i=[];if(g>0){const I=A.diagonal();I.normalizeInPlace(),I.scaleInPlace(g),i[0]=A.p0.subtract(I),i[1]=A.p1.add(I)}else i[0]=A.p0,i[1]=A.p1;let e=(i[C[0]].x-this.start.x)*I.x,t=(i[1-C[0]].x-this.start.x)*I.x;const B=(i[C[1]].y-this.start.y)*I.y,s=(i[1-C[1]].y-this.start.y)*I.y;if(e>s||B>t)return!1;B>e&&(e=B),s<t&&(t=s);const a=(i[C[2]].z-this.start.z)*I.z,l=(i[1-C[2]].z-this.start.z)*I.z;return!(e>l||a>t)&&(a>e&&(e=a),l<t&&(t=l),!0)}clone(){return new G(this.start.clone(),this.dir.clone())}toJSON(){return{start:this.start.toJSON(),dir:this.dir.toJSON()}}fromJSON(A){this.start.fromJSON(A.start),this.dir.fromJSON(A.dir)}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}class m{constructor(A,g,I){if(A instanceof Float32Array)this.setFromFloat32Array(A);else{if(A instanceof o)this.tr=A;else{if(A instanceof c&&null==g&&null==I)return this.tr=new o,this.ori=A,void(this.sc=new o(1,1,1));this.tr=new o}this.ori=g instanceof c?g:new c,this.sc=I instanceof o?I:new o(1,1,1)}}set(A,g,I){this.tr=A,this.ori=g,I instanceof o&&(this.sc=I)}setFromOther(A){this.tr=A.tr,this.ori=A.ori,this.sc=A.sc}isIdentity(){return this.tr.isNull()&&this.ori.isIdentity()&&this.sc.is111()}isEqual(A){return this.tr.isEqual(A.tr)&&this.ori.isEqual(A.ori)&&this.sc.isEqual(A.sc)}approxEqual(A,g=Number.EPSILON){return(!A.tr||this.tr.approxEqual(A.tr,g))&&(!A.ori||this.ori.approxEqual(A.ori,g))&&(!A.sc||this.sc.approxEqual(A.sc,g))}setLookAt(A,g,I){const C=A.subtract(g);if(C.length()<Number.EPSILON)throw new Error("Invalid dir");this.ori.setFromDirectionAndUpvector(C,I),this.tr=A}multiply(A){let g=this.sc;if(Math.abs(this.sc.y-this.sc.x)>.001||Math.abs(this.sc.z-this.sc.x)>.001||Math.abs(this.sc.z-this.sc.y)>.001){const A=this.ori.toMat4(),I=new h(this.sc.x,0,0,0,0,this.sc.y,0,0,0,0,this.sc.z,0,0,0,0,1).multiply(A);g=new o(I.xAxis.length(),I.yAxis.length(),I.zAxis.length())}return new m(this.tr.add(this.ori.rotateVec3(this.sc.multiply(A.tr))),this.ori.multiply(A.ori),g.multiply(A.sc))}inverse(){const A=new m;if(A.ori=this.ori.inverse(),Math.abs(this.sc.y-this.sc.x)>.001||Math.abs(this.sc.z-this.sc.x)>.001||Math.abs(this.sc.z-this.sc.y)>.001){const g=A.ori.toMat4(),I=new h(this.sc.x,0,0,0,0,this.sc.y,0,0,0,0,this.sc.z,0,0,0,0,1).multiply(g);A.sc=new o(1/I.xAxis.length(),1/I.yAxis.length(),1/I.zAxis.length())}else A.sc=this.sc.inverse();return A.tr=A.ori.rotateVec3(this.tr.negate().multiply(A.sc)),A}transformVec3(A){return this.tr.add(this.ori.rotateVec3(this.sc.multiply(A)))}toMat4(){const A=new h(this.sc.x,0,0,0,0,this.sc.y,0,0,0,0,this.sc.z,0,0,0,0,1),g=this.ori.toMat4(),I=new h;return I.translation=this.tr,I.multiply(g).multiply(A)}setFromMat4(A){this.tr=A.translation,this.ori.setFromMat4(A)}setFromFloat32Array(A){if(7==A.length)return this.tr=new o(new Float32Array(A.buffer,A.byteOffset,3)),this.ori=new c(new Float32Array(A.buffer,A.byteOffset+12,4)),void(this.sc=new o(1,1,1));if(8!=A.length){if(10==A.length)return this.tr=new o(new Float32Array(A.buffer,A.byteOffset,3)),this.ori=new c(new Float32Array(A.buffer,A.byteOffset+12,4)),void(this.sc=new o(new Float32Array(A.buffer,A.byteOffset+21,3)));console.warn("unitialized: float32array.length == ",A.length)}else{this.tr=new o(new Float32Array(A.buffer,A.byteOffset,3)),this.ori=new c(new Float32Array(A.buffer,A.byteOffset+12,4));const g=A[7];this.sc=new o(g,g,g)}}clone(){return new m(this.tr.clone(),this.ori.clone(),this.sc.clone())}toJSON(){return{tr:this.tr.toJSON(),ori:this.ori.toJSON(),sc:this.sc.toJSON()}}fromJSON(A){this.tr.fromJSON(A.tr),this.ori.fromJSON(A.ori),A.sc&&this.sc.fromJSON(A.sc)}readBinary(A){this.tr.readBinary(A),this.ori.readBinary(A),this.sc.readBinary(A)}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}class Q{constructor(A,g){this.p0=A instanceof B?A:new B(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=g instanceof B?g:new B(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}set(A,g){this.p0=A,this.p1=g}reset(){this.p0.x=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY}isValid(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY}addPoint(A){(this.p0.x==Number.POSITIVE_INFINITY||A.x<this.p0.x)&&(this.p0.x=A.x),(this.p0.y==Number.POSITIVE_INFINITY||A.y<this.p0.y)&&(this.p0.y=A.y),(this.p1.y==Number.NEGATIVE_INFINITY||A.x>this.p1.x)&&(this.p1.x=A.x),(this.p1.y==Number.NEGATIVE_INFINITY||A.y>this.p1.y)&&(this.p1.y=A.y)}size(){return this.p1.distanceTo(this.p0)}diagonal(){return this.p1.subtract(this.p0)}center(){const A=this.p1.subtract(this.p0);return A.scaleInPlace(.5),A.addInPlace(this.p0),A}clone(){return new Q(this.p0.clone(),this.p1.clone())}toJSON(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}class E{constructor(A=new o,g=0){this.pos=A instanceof o?A:new o,this.radius=g}clone(){return new E(this.pos.clone(),this.radius)}intersectsBox(A){return A.intersectsSphere(this)}toJSON(){return{pos:this.pos.toJSON(),radius:this.radius}}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}class b{constructor(A,g){A instanceof Float32Array?(this.p0=new o(new Float32Array(A.buffer,A.byteOffset,3)),this.p1=new o(new Float32Array(A.buffer,A.byteOffset+12,3))):(this.p0=A instanceof o?A:new o(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=g instanceof o?g:new o(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))}get min(){return this.p0}get max(){return this.p1}set(A,g){this.p0=A,this.p1=g}reset(){this.p0.x=Number.POSITIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p0.z=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY,this.p1.z=Number.NEGATIVE_INFINITY}isValid(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY&&this.p0.z!=Number.POSITIVE_INFINITY&&this.p1.z!=Number.NEGATIVE_INFINITY}addPoint(A){A.x!=Number.POSITIVE_INFINITY&&A.x!=Number.NEGATIVE_INFINITY&&(A.x<this.p0.x&&(this.p0.x=A.x),A.x>this.p1.x&&(this.p1.x=A.x)),A.y!=Number.POSITIVE_INFINITY&&A.y!=Number.NEGATIVE_INFINITY&&(A.y<this.p0.y&&(this.p0.y=A.y),A.y>this.p1.y&&(this.p1.y=A.y)),A.z!=Number.POSITIVE_INFINITY&&A.z!=Number.NEGATIVE_INFINITY&&(A.z<this.p0.z&&(this.p0.z=A.z),A.z>this.p1.z&&(this.p1.z=A.z))}addBox3(A,g){g?(this.addPoint(g.transformVec3(A.p0)),this.addPoint(g.transformVec3(new o(A.p0.x,A.p0.y,A.p1.z))),this.addPoint(g.transformVec3(new o(A.p0.x,A.p1.y,A.p0.z))),this.addPoint(g.transformVec3(new o(A.p1.x,A.p0.y,A.p0.z))),this.addPoint(g.transformVec3(new o(A.p0.x,A.p1.y,A.p1.z))),this.addPoint(g.transformVec3(new o(A.p1.x,A.p0.y,A.p1.z))),this.addPoint(g.transformVec3(new o(A.p1.x,A.p1.y,A.p0.z))),this.addPoint(g.transformVec3(A.p1))):(this.addPoint(A.p0),this.addPoint(A.p1))}size(){return this.p1.distanceTo(this.p0)}diagonal(){return this.p1.subtract(this.p0)}center(){const A=this.p1.subtract(this.p0);return A.scaleInPlace(.5),A.addInPlace(this.p0),A}toMat4(){const A=this.p1.x-this.p0.x,g=this.p1.y-this.p0.y,I=this.p1.z-this.p0.z;return new h(A,0,0,0,0,g,0,0,0,0,I,0,this.p0.x,this.p0.y,this.p0.z,1)}getBoundingSphere(){return new E(this.center(),.5*this.diagonal().length())}intersectsBox(A){return!(A.max.x<this.min.x||A.min.x>this.max.x||A.max.y<this.min.y||A.min.y>this.max.y||A.max.z<this.min.z||A.min.z>this.max.z)}intersectsSphere(A){return(new o).distanceTo(A.pos)<=A.radius*A.radius}intersectsPlane(A){let g,I;return A.normal.x>0?(g=A.normal.x*this.min.x,I=A.normal.x*this.max.x):(g=A.normal.x*this.max.x,I=A.normal.x*this.min.x),A.normal.y>0?(g+=A.normal.y*this.min.y,I+=A.normal.y*this.max.y):(g+=A.normal.y*this.max.y,I+=A.normal.y*this.min.y),A.normal.z>0?(g+=A.normal.z*this.min.z,I+=A.normal.z*this.max.z):(g+=A.normal.z*this.max.z,I+=A.normal.z*this.min.z),g<=-A.w&&I>=-A.w}clone(){return new b(this.p0.clone(),this.p1.clone())}toJSON(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}}fromJSON(A){const g={x:r.isNumeric(A.p0.x)?A.p0.x:Number.POSITIVE_INFINITY,y:r.isNumeric(A.p0.y)?A.p0.y:Number.POSITIVE_INFINITY,z:r.isNumeric(A.p0.z)?A.p0.z:Number.POSITIVE_INFINITY},I={x:r.isNumeric(A.p1.x)?A.p1.x:Number.NEGATIVE_INFINITY,y:r.isNumeric(A.p1.y)?A.p1.y:Number.NEGATIVE_INFINITY,z:r.isNumeric(A.p1.z)?A.p1.z:Number.NEGATIVE_INFINITY};this.p0.fromJSON(g),this.p1.fromJSON(I)}setFromFloat32Array(A){this.p0=new o(A.buffer,A.byteOffset),this.p1=new o(A.buffer,A.byteOffset+12)}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}class Z{constructor(A,g=0){this.normal=A instanceof o?A:new o,this.w=g}set(A,g,I,C){this.normal.set(A,g,I),this.w=C}divideScalar(A){this.normal.scaleInPlace(1/A),this.w/=A}distanceToPoint(A){return A.dot(this.normal)+this.w}normalizeInPlace(){const A=1/this.normal.length();this.normal.scaleInPlace(A),this.w*=A}clone(){return new Z(this.normal.clone(),this.w)}toJSON(){return{normal:this.normal.toJSON(),w:this.w}}fromJSON(A){this.normal.fromJSON(A.normal),this.w=A.w}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}}let y=0;class u{constructor(){this.__id=++y}getId(){return this.__id}getClassName(){return e.getClassName(Object.getPrototypeOf(this).constructor)}}class R{constructor(){}}class V extends u{constructor(){super(),this.listeners={}}on(A,g){if(!g)throw new Error("Missing listener.");this.listeners[A]||(this.listeners[A]=[]);const I=this.listeners[A];if(I.includes(g))throw new Error(`Listener "${g.name}" already connected to event "${A}".`);const C=I.length;return I[C]=g,C}once(A,g){const I=C=>{g(C),this.off(A,I)};return this.on(A,I)}off(A,g){if(!g)throw new Error("Missing callback function (listener).");if("number"==typeof g)return console.warn("Deprecated. Un-register using the original listener instead."),void this.removeListenerById(A,g);const I=this.listeners[A]||[],C=[];if(I.forEach(((A,I)=>{A===g&&C.push(I)})),0==C.length)throw new Error(`Listener "${g.name}" is not connected to "${A}" event`);for(const A of C)I[A]=null}removeListenerById(A,g){const I=this.listeners[A];if(I){if(!I[g])throw new Error("Invalid ID");I[g]=null}else console.warn("callback :"+g+" was not connected to this event:"+A)}emit(A,g=new R){(this.listeners[A]||[]).forEach((A=>{A&&A(g)}))}}class F extends R{constructor(A,g){super(),this.width=A,this.height=g}}class S extends V{constructor(A=0,g=0){super(),this.root={x:0,y:0,w:A,h:g}}fit(A){if(0==A.length)return;let g=!1;if(this.root.w<A[0].w&&(this.root.w=A[0].w,g=!0),this.root.h<A[0].h&&(this.root.h=A[0].h,g=!0),g){const A=new F(this.root.w,this.root.h);this.emit("resized",A)}A.forEach((A=>{A.fit=this.__addBlock(A)}))}__addBlock(A){const g=this.findNode(this.root,A.w,A.h);return g?this.splitNode(g,A.w,A.h):this.growNode(A.w,A.h)}addBlock(A){let g=!1;if(this.root.w<A.w&&(this.root.w=A.w,g=!0),this.root.h<A.h&&(this.root.h=A.h,g=!0),g){const A=new F(this.root.w,this.root.h);this.emit("resized",A)}const I=this.findNode(this.root,A.w,A.h);return I?this.splitNode(I,A.w,A.h):this.growNode(A.w,A.h)}findNode(A,g,I){return A.used?this.findNode(A.right,g,I)||this.findNode(A.down,g,I):g<=A.w&&I<=A.h?A:null}splitNode(A,g,I){return A.used=!0,A.down={x:A.x,y:A.y+I,w:A.w,h:A.h-I},A.right={x:A.x+g,y:A.y,w:A.w-g,h:I},A}growNode(A,g){const I=A<=this.root.w,C=g<=this.root.h,i=C&&this.root.h>=this.root.w+A,e=I&&this.root.w>=this.root.h+g;return i?this.growRight(A,g):e?this.growDown(A,g):C?this.growRight(A,g):I?this.growDown(A,g):null}growRight(A,g){this.root={used:!0,x:0,y:0,w:this.root.w+A,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:A,h:this.root.h}};const I=this.findNode(this.root,A,g);let C;I&&(C=this.splitNode(I,A,g));const i=new F(this.root.w,this.root.h);return this.emit("resized",i),C}growDown(A,g){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+g,down:{x:0,y:this.root.h,w:this.root.w,h:g},right:this.root};const I=this.findNode(this.root,A,g);let C;I&&(C=this.splitNode(I,A,g));const i=new F(this.root.w,this.root.h);return this.emit("resized",i),C}}class w{constructor(A=0,g=0){this.start=A,this.size=g}}class X extends V{constructor(){super(),this.freeList=[],this.allocations=[],this.allocationsMap={},this.allocatedSpace=0,this.reservedSpace=0,this.freeSpace=0}getAllocation(A){return this.allocations[this.allocationsMap[A]]}allocate(A,g){if(null!=this.allocationsMap[A]){const I=this.allocationsMap[A],C=this.allocations[I];if(g==C.size)return C;if(g<C.size){const A=C.size-g;return this.addBlock(I+1,new w(C.start+g,A)),this.freeBlock(I+1),C.size=g,C}{const i=I+1;if(this.freeList.includes(i)&&C.size+this.allocations[i].size>=g){const A=this.allocations[i];if(C.size+A.size==g)return C.size+=A.size,this.freeSpace-=A.size,this.freeList.splice(this.freeList.indexOf(i),1),this.removeBlock(i),C;{const I=g-C.size;return C.size+=I,this.freeSpace-=I,A.start+=I,A.size-=I,C}}delete this.allocationsMap[A],C.start+C.size==this.allocatedSpace?(this.removeBlock(I),this.allocatedSpace-=C.size):this.freeBlock(I)}}let I=-1;for(let A=0;A<this.freeList.length;A++){const C=this.freeList[A],i=this.allocations[C];if(i.size==g){I=C;break}i.size>g&&(I=C)}if(-1!=I){const C=this.allocations[I];if(this.freeSpace-=C.size,this.freeList.splice(this.freeList.indexOf(I),1),C.size>g){const A=C.size-g;this.addBlock(I+1,new w(C.start+g,A)),this.freeBlock(I+1),this.freeList.sort(((A,g)=>this.allocations[g].size-this.allocations[A].size)),this.allocations[I].size=g}this.allocationsMap[A]=I}else{const I=this.allocatedSpace,C=this.allocations.length;this.allocatedSpace+=g;const i=r.nextPow2(this.allocatedSpace);i>this.reservedSpace&&(this.reservedSpace=i,this.emit("resized",{reservedSpace:this.reservedSpace})),this.allocations.push(new w(I,g)),this.allocationsMap[A]=C}return this.allocations[this.allocationsMap[A]]}addBlock(A,g){this.allocations.splice(A,0,g);for(const g in this.allocationsMap)this.allocationsMap[g]>=A&&this.allocationsMap[g]++;for(let g=0;g<this.freeList.length;g++)this.freeList[g]>=A&&this.freeList[g]++}removeBlock(A){this.allocations.splice(A,1);for(const g in this.allocationsMap)this.allocationsMap[g]>A&&this.allocationsMap[g]--;for(let g=0;g<this.freeList.length;g++)this.freeList[g]>A&&this.freeList[g]--}freeBlock(A){const g=this.allocations[A];this.freeSpace+=g.size;const I=A-1;if(this.freeList.includes(I)){return this.allocations[I].size+=g.size,void this.removeBlock(A)}const C=A+1;if(this.freeList.includes(C)){const I=this.allocations[C];return I.start-=g.size,I.size+=g.size,void this.removeBlock(A)}this.freeList.push(A)}deallocate(A){const g=this.allocationsMap[A];if(null==g)throw new Error(`allocation ${A} does not exist.`);this.freeBlock(g),delete this.allocationsMap[A]}getFragmentation(){return this.freeSpace/this.allocatedSpace}defragment(){}verifyConsistency(){if(Object.keys(this.allocationsMap).length+this.freeList.length!=this.allocations.length)throw new Error("number of blocks does not match the number of allocations");for(const A in this.allocationsMap){const g=this.allocationsMap[A];if(this.freeList.includes(g))throw new Error("block of used memory is also on the free list")}let A=0;for(let g=0;g<this.allocations.length;g++){const I=this.allocations[g];if(I.start!=A)throw"blocks of memory are not sequential";A+=I.size}if(A!=this.allocatedSpace)throw`allocated size: ${this.allocatedSpace}  does not match allocated blocks: ${A}`;if(this.reservedSpace<this.allocatedSpace)throw`reserved space: ${this.reservedSpace} is less than allocated space: ${this.allocatedSpace}`}}class H{constructor(A,g,I,C,i){this.screenPos=A,this.pointerRay=g,this.intersectionPos=I,this.geomData=C,this.geomItem=i.geomItem,this.componentId=i.componentId,this.dist=i.dist}}class W extends R{constructor(A){super(),this.controller=A}}class Y extends R{constructor(A,g){super(),this.change=A,this.count=g}}class K extends R{constructor(A){super(),this.envMap=A}}class p extends R{constructor(A){super(),this.index=A}}class N extends R{constructor(){super(),this.propagating=!0}}class J extends N{constructor(A){super(),this.propagating=!0,this.sourceEvent=A,this.altKey=A.altKey,this.code=A.code,this.ctrlKey=A.ctrlKey,this.isComposing=A.isComposing,this.key=A.key,this.location=A.location,this.metaKey=A.metaKey,this.repeat=A.repeat,this.shiftKey=A.shiftKey,this.which=A.which}stopPropagation(){this.propagating=!1,this.sourceEvent&&this.sourceEvent.stopPropagation()}preventDefault(){this.sourceEvent&&this.sourceEvent.preventDefault()}}class D extends R{constructor(A){super(),this.name=A}}class f extends R{constructor(A){super(),this.name=A}}class M extends R{constructor(A){super(),this.range=A}}class L extends R{constructor(A){super(),this.scene=A}}class U extends R{constructor(A){super(),this.value=A}}class v extends R{constructor(A){super(),this.selected=A}}class k extends R{constructor(A){super(),this.shaderName=A}}class x extends R{constructor(A){super(),this.state=A}}class z extends R{constructor(A,g){super(),this.geomFileID=A,this.geomCount=g}}class T extends R{constructor(A,g){super(),this.isTextured=A,this.param=g}}class _ extends R{constructor(A,g){super(),this.isOpaque=A,this.isOpaqueStateChanged=g}}class P extends R{constructor(A,g){super(),this.interfaceType=A,this.viewXfo=g}}class O extends R{constructor(A){super(),this.visible=A}}class j extends P{constructor(A){super("VR",A),this.hmd="",this.controllers=[]}}const q={mouse:"mouse",touch:"touch",xr:"xr"};let $=null;class AA extends N{constructor(A){super(),this.pointerType=A}stopPropagation(){this.propagating=!1}setCapture(A){$=A}getCapture(){return $}releaseCapture(){$=null}}class gA extends AA{constructor(A,g,I,C){super(q.xr),this.buttonPressed=0,this.viewport=A,this.controller=g,this.button=I,this.buttonPressed=C}stopPropagation(){this.propagating=!1}setCapture(A){this.controller.capturedItem=A}getCapture(){return this.controller.capturedItem}releaseCapture(){this.controller.capturedItem=null}}class IA extends AA{constructor(A,g,I){super(q.xr),this.controllers=[],this.viewport=A,this.viewXfo=g,I.forEach((A=>{this.controllers.push(A)}))}}class CA extends R{constructor(A){super(),this.xrViewport=A}}class iA extends AA{constructor(A,g){super(q.mouse),this.sourceEvent=A,this.button=A.button,this.clientX=A.clientX,this.clientY=A.clientY;this.rendererX=1*(this.clientX-g.left),this.rendererY=1*(this.clientY-g.top),this.altKey=A.altKey,this.metaKey=A.metaKey,this.ctrlKey=A.ctrlKey,this.shiftKey=A.shiftKey}stopPropagation(){super.stopPropagation(),this.sourceEvent&&this.sourceEvent.stopPropagation()}preventDefault(){this.sourceEvent&&this.sourceEvent.preventDefault()}}class eA{constructor(A,g){this.clientX=0,this.clientY=0,this.screenX=0,this.screenY=0,this.pageX=0,this.pageY=0,this.radiusX=0,this.radiusY=0,this.rotationAngle=0,this.force=0,this.altitudeAngle=0,this.azimuthAngle=0,this.touchType="direct",this.identifier=A.identifier,this.clientX=A.clientX,this.clientY=A.clientY,this.screenX=A.screenX,this.screenY=A.screenY,this.pageX=A.pageX,this.pageY=A.pageY,this.radiusX=A.radiusX,this.radiusY=A.radiusY,this.rotationAngle=A.rotationAngle,this.force=A.force;this.rendererX=1*(this.clientX-g.left),this.rendererY=1*(this.clientY-g.top),this.touchPos=new B,this.touchRay=new G}}class tA extends AA{constructor(A,g){super(q.touch),this.touches=[],this.changedTouches=[],this.targetTouches=[],this.altKey=!1,this.metaKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.sourceEvent=A,this.sourceEvent.stopPropagation(),this.altKey=A.altKey,this.metaKey=A.metaKey,this.ctrlKey=A.ctrlKey,this.shiftKey=A.shiftKey;for(let I=0;I<A.touches.length;I++)this.touches.push(new eA(A.touches[I],g));if(A.changedTouches)for(let I=0;I<A.changedTouches.length;I++)this.changedTouches.push(new eA(A.changedTouches[I],g));if(A.targetTouches)for(let I=0;I<A.targetTouches.length;I++)this.targetTouches.push(new eA(A.targetTouches[I],g))}stopPropagation(){super.stopPropagation(),this.sourceEvent&&this.sourceEvent.stopPropagation()}preventDefault(){}}class BA extends iA{constructor(A,g){super(A,g),this.wheelDelta=A.wheelDelta,this.deltaMode=A.deltaMode,this.deltaX=A.deltaX,this.deltaY=A.deltaY,this.deltaZ=A.deltaZ}}class oA extends R{constructor(A,g){super(),this.index=A,this.childItem=g}}class sA extends R{constructor(A,g){super(),this.oldName=A,this.newName=g}}let aA=0;class lA extends V{constructor(){if(super(),"RefCounted"==this.constructor.name)throw new Error("RefCounted should not be instantiated directly.");this.__id=++aA,this.__refs=[],this.__destroyed=!1}getId(){return this.__id}numRefs(){return this.__refs.length}addRef(A){if(!A)throw new Error("Error in RefCounted.addRef: Must provide a referer");return this.__refs.push(A),!0}removeRef(A){if(!A)throw new Error("Error in RefCounted.removeRef: Must provide a referer");const g=this.__refs.indexOf(A);if(-1==g)throw new Error("Error in RefCounted.removeRef: referer not found in refs list.");this.__refs.splice(g,1),0==this.__refs.length&&this.destroy()}getRefer(A){return this.__refs[A]}getRefIndex(A){return this.__refs.indexOf(A)}isDestroyed(){return this.__destroyed}destroy(){this.__destroyed=!0,this.emit("destructing")}}class nA extends V{constructor(){super(),this.paramEventListenerIDs={},this.paramMapping={},this.params=[],this.deprecatedParamMapping={}}getNumParameters(){return this.params.length}getParameters(){return this.params}getParameterIndex(A){return this.paramMapping[A]}getParameterByIndex(A){return this.params[A]}hasParameter(A){return A in this.paramMapping}addParameterDeprecationMapping(A,g){this.deprecatedParamMapping[A]=g}getParameter(A){let g=this.paramMapping[A];if(null==g){const I=this.deprecatedParamMapping[A];if(!I)return null;console.warn(`Parameter name ${A} is now deprecated. Please use ${I} instead.`),g=this.paramMapping[I]}return this.params[g]}parameterValueChanged(A){this.emit("parameterValueChanged",A)}addParameter(A){return this.insertParameter(A,this.params.length)}insertParameter(A,g){const I=A.getName();null!=this.paramMapping[I]&&(console.warn("Replacing Parameter:"+I),this.removeParameter(I)),A.setOwner(this),this.paramEventListenerIDs[I]=A.on("valueChanged",(g=>{const I={param:A};for(const A in g)I[A]=g[A];this.parameterValueChanged(I)})),this.params.splice(g,0,A);for(let A=g;A<this.params.length;A++)this.paramMapping[this.params[A].getName()]=A;const C=new D(I);return this.emit("parameterAdded",C),A}removeParameter(A){if(null==this.paramMapping[A])throw new Error("Unable to remove Parameter:"+A);const g=this.paramMapping[A];this.params[this.paramMapping[A]].removeListenerById("valueChanged",this.paramEventListenerIDs[A]),this.params.splice(g,1),delete this.paramMapping[A];for(let A=g;A<this.params.length;A++)this.paramMapping[this.params[A].getName()]=A;const I=new f(A);this.emit("parameterRemoved",I)}replaceParameter(A){const g=A.getName();if(null==this.paramMapping[g])throw new Error("Unable to replace Parameter:"+g);const I=this.paramMapping[g];return this.removeParameter(g),this.insertParameter(A,I),A}toJSON(A){const g={type:this.getClassName()},I={};let C=0;for(const g of this.params){const i=g.toJSON(A);i&&(I[g.getName()]=i,C++)}return C>0&&(g.params=I),g}fromJSON(A,g){if(A.params)for(const I in A.params){const C=A.params[I],i=this.getParameter(I);i?C.paramPath?null==g||g.resolvePath(C.paramPath,(A=>{this.replaceParameter(A)}),(()=>{console.warn("Unable to resolve shared parameter:"+C.paramPath)})):i.fromJSON(C,g):console.warn("Param not found:"+I)}}readBinary(A,g){if((null==g?void 0:g.versions["zea-engine"].compare([0,0,3]))>=0){const I=A.loadUInt32();for(let C=0;C<I;C++){const I=A.loadStr(),C=A.loadStr();let i=this.getParameter(C);if(!i){if(i=e.constructClass(I),!i){console.error("Unable to construct prop:"+C+" of type:"+I);continue}i.setName(C),this.addParameter(i)}i.readBinary(A,g)}}}toString(A){return JSON.stringify(this.toJSON(),null,2)}copyFrom(A,g){let I=A.getNumParameters();for(;I--;){const g=A.getParameterByIndex(I),C=this.getParameter(g.getName());C?C.copyFrom(g):this.addParameter(g.clone())}}}let dA=0;class hA extends nA{constructor(A=""){super(),this.__ownerItem=void 0,this.__selectable=!0,this.__selected=!1,this.__metaData={},this.__name=A,this.__path=[this.__name],dA++}static getNumBaseItems(){return dA}getName(){return this.__name}setName(A){if(this.__name!=A){const g=this.__name;this.__name=A,this.updatePath();const I=new sA(g,A);this.emit("nameChanged",I)}}get name(){return this.getName()}set name(A){this.setName(A)}updatePath(){null==this.__ownerItem?this.__path=[this.__name]:(this.__path=this.__ownerItem.getPath().slice(),this.__path.push(this.__name))}getPath(){return this.__path}resolvePath(A,g=0){if(0==g&&("."!=A[0]&&A[0]!=this.__name||g++),g==A.length)return this;if(">"==A[g]&&g==A.length-1)return this.getParameter(A[g+1]);const I=this.getParameter(A[g]);if(I)return I;throw new Error("Invalid path:"+A+"["+g+"] member not found")}getOwner(){return this.__ownerItem}setOwner(A){this.__ownerItem!==A?this.__ownerItem=A:A||(this.__ownerItem=void 0),this.updatePath()}isSelectable(){return this.__selectable}setSelectable(A){if(this.__selectable!=A){this.__selectable=A;let g=new U(this.__selectable);return this.emit("selectabilityChanged",g),!0}return!1}isSelected(){return this.__selected}setSelected(A){this.__selected=A;let g=new v(this.__selected);this.emit("selectedChanged",g)}getMetadata(A){return this.__metaData[A]}hasMetadata(A){return A in this.__metaData}setMetadata(A,g){this.__metaData[A]=g}deleteMetadata(A){delete this.__metaData[A]}toJSON(A){const g=super.toJSON(A);return g.name=this.__name,g}fromJSON(A,g){A.name&&(this.__name=A.name),super.fromJSON(A,g)}readBinary(A,g){A.loadStr(),this.setName(A.loadStr()),super.readBinary(A,g)}clone(A){throw new Error(this.constructor.name+" does not implement its clone method")}copyFrom(A,g){super.copyFrom(A,g),this.setName(A.getName()),this.setSelectable(A.isSelectable())}}const cA=function(A,g,I,C,i){try{const e=new XMLHttpRequest;e.responseType=g,e.addEventListener("timeout",(g=>{throw new Error("The request for "+A+" timed out.")})),e.addEventListener("error",(g=>{throw new Error("The request for "+A+": xhr.readyState:"+e.readyState)})),e.addEventListener("abort",(g=>{throw new Error("The request for "+A+": xhr.readyState:"+e.readyState)})),e.addEventListener("progress",(A=>{i&&i(A.total,A.loaded)})),e.addEventListener("loadend",(A=>{200==e.status?I(e):C(e.statusText)})),e.open("GET",A,!0),e.send()}catch(A){C(A)}},rA=function(A,g,I,C){cA(A,"text",(A=>{g(A.responseText)}),(g=>{if(null==I)throw new Error("Unable to XHR File:"+A);I(g)}),C)},GA=function(A,g,I,C){cA(A,"arraybuffer",(A=>{g(A.response)}),(g=>{if(null==I)throw new Error("Unable to XHR File:"+A);I(g)}),C)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function mA(A,g,I,C){return new(I||(I=Promise))((function(i,e){function t(A){try{o(C.next(A))}catch(A){e(A)}}function B(A){try{o(C.throw(A))}catch(A){e(A)}}function o(A){var g;A.done?i(A.value):(g=A.value,g instanceof I?g:new I((function(A){A(g)}))).then(t,B)}o((C=C.apply(A,g||[])).next())}))}let QA=0;class EA extends V{constructor(A){super(),this.poolSize=Math.max(1,g.hardwareConcurrency-1),this.workers=[],this.workerTaskCount=[],this.taskPromiseResolves={},this.taskQueue=[],this.availableWorkers=[],this.terminationTimeouts=[],this.terminateWorkersWhenFree=!0,this.terminationLatency=2e3,this.terminateWorkersWhenFree=A}addTask(A,g){return this.addTaskCallback((()=>({taskData:A,transferables:g})))}addTaskCallback(A){QA++;const g=QA;return new Promise((I=>mA(this,void 0,void 0,(function*(){this.taskPromiseResolves[g]=I,this.taskQueue.push({taskId:g,dataFactory:A}),this.availableWorkers.length>0?this.consumeTask():this.workers.length<this.poolSize&&(yield this.addWorker(),this.consumeTask())}))))}consumeTask(){return mA(this,void 0,void 0,(function*(){const A=this.availableWorkers.pop();if(this.workerTaskCount[A]>0)return;if(0==this.taskQueue.length)return void(this.terminateWorkersWhenFree&&this.scheduleWorkerTermination(A));if(-1!=this.terminationTimeouts[A]?(clearTimeout(this.terminationTimeouts[A]),this.terminationTimeouts[A]=-1):this.workers[A]||(yield this.allocWorker(A)),0==this.taskQueue.length)return void(this.terminateWorkersWhenFree&&this.scheduleWorkerTermination(A));const g=this.taskQueue.pop(),{taskData:I,transferables:C}=g.dataFactory(A);I.taskId=g.taskId,this.workerTaskCount[A]++,this.workers[A].postMessage(I,C)}))}addWorker(){const A=this.workers.length;return this.workers.push(null),this.allocWorker(A)}allocWorker(A){return new Promise((g=>{this.constructWorker().then((I=>{I.onmessage=g=>{if(g.data.taskId in this.taskPromiseResolves){const I=g.data.taskId;if(delete g.data.taskId,this.taskPromiseResolves[I](g.data),delete this.taskPromiseResolves[I],this.workerTaskCount[A]--,this.workerTaskCount[A]>0)return;-1==this.availableWorkers.indexOf(A)&&this.availableWorkers.push(A),this.taskQueue.length>0?this.consumeTask():this.terminateWorkersWhenFree&&this.scheduleWorkerTermination(A)}else g.data.eventName&&(g.data.workerId=A,this.emit(g.data.eventName,g.data))},this.workers[A]=I,this.terminationTimeouts[A]=-1,this.workerTaskCount[A]=0,this.availableWorkers.push(A),g()}))}))}scheduleWorkerTermination(A){this.terminationTimeouts[A]=setTimeout((()=>{this.terminateWorker(A),this.terminationTimeouts[A]=-1}),this.terminationLatency)}terminateWorker(A){this.workers[A].terminate(),this.workers[A]=null}messageWorker(A,g){QA++;const I=QA;return new Promise((C=>{this.taskPromiseResolves[I]=C,g.taskId=I,this.workers[A].postMessage(g)}))}}function bA(A,g,I){var C=void 0===g?null:g,i=function(A,g){var I=atob(A);if(g){for(var C=new Uint8Array(I.length),i=0,e=I.length;i<e;++i)C[i]=I.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(C.buffer))}return I}(A,void 0!==I&&I),e=i.indexOf("\n",10)+1,t=i.substring(e)+(C?"//# sourceMappingURL="+C:""),B=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(B)}function ZA(A,g,I){var C;return function(i){return C=C||bA(A,g,I),new Worker(C,i)}}var yA=ZA("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gPCEtLSBwcmV0dGllci1pZ25vcmUtc3RhcnQgLS0+CiAgLyogZXNsaW50LWRpc2FibGUgcmVxdWlyZS1qc2RvYyAqLwoKICBjb25zdCBNb2R1bGUgPSB7fTsKCiAgY29uc3QgV29ya2VyU2NvcGUgPSB7fTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLXVucGFja0JyaWRnZS5qcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAhKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAvLyBUaGUgZm9sbG93aW5nIGNvZGUgaGFzIGJlZW4gX2NhcmVmdWxseV8gbW9kaWZpZWQgYnkgaGFuZC4KICAgIC8vIFRoZXJlIHdlcmUgdmFyaW91cyBjYXNlcyBmb3IgaW4gd2hhdCBjb250ZXh0IHRoZSBjb2RlIG1pZ2h0CiAgICAvLyBiZSBydW4sIGFuZCBJIHJlbW92ZWQgYWxsIGJ1dCB0aGUgd2Vid29ya2VyIGNhc2UuCiAgICAvLyBUaGVyZSB3YXMgY29kZSB0byBoYW5kbGUgbG9hZGluZyBpbiBhIG5vZGVKUyBjb250ZXh0LCB0aGF0IHRyaWVkIHRvIGltcG9ydCgiZnMiKQogICAgLy8gV2ViUGFjayBrZXB0cyB0cmlwcGluZyB1cCBvbiB0aGF0IGNvZGUgaW4gaXRzIHN0YXRpYyBhbmFseXNpcyBvZiB0aGUgY29kZSwgc28KICAgIC8vIEkgY2FyZWZ1bGx5IHJlbW92ZWQgaXQuCiAgICB0LnVucGFja0JyaWRnZSA9IGUodC5mcyk7CiAgfSkoV29ya2VyU2NvcGUsIGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0ge307CiAgICAgIGZ1bmN0aW9uIHIobikgewogICAgICAgIGlmIChlW25dKSByZXR1cm4gZVtuXS5leHBvcnRzCiAgICAgICAgdmFyIGkgPSAoZVtuXSA9IHsgaTogbiwgbDogITEsIGV4cG9ydHM6IHt9IH0pOwogICAgICAgIHJldHVybiB0W25dLmNhbGwoaS5leHBvcnRzLCBpLCBpLmV4cG9ydHMsIHIpLCAoaS5sID0gITApLCBpLmV4cG9ydHMKICAgICAgfQogICAgICByZXR1cm4gKAogICAgICAgIChyLm0gPSB0KSwKICAgICAgICAoci5jID0gZSksCiAgICAgICAgKHIuZCA9IGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgICAgICByLm8odCwgZSkgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsgZW51bWVyYWJsZTogITAsIGdldDogbiB9KTsKICAgICAgICB9KSwKICAgICAgICAoci5yID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICd1bmRlZmluZWQnICE9IHR5cGVvZiBTeW1ib2wgJiYKICAgICAgICAgICAgU3ltYm9sLnRvU3RyaW5nVGFnICYmCiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pLAogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICB9KSwKICAgICAgICAoci50ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIGlmICgoMSAmIGUgJiYgKHQgPSByKHQpKSwgOCAmIGUpKSByZXR1cm4gdAogICAgICAgICAgaWYgKDQgJiBlICYmICdvYmplY3QnID09IHR5cGVvZiB0ICYmIHQgJiYgdC5fX2VzTW9kdWxlKSByZXR1cm4gdAogICAgICAgICAgdmFyIG4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgaWYgKChyLnIobiksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogITAsIHZhbHVlOiB0IH0pLCAyICYgZSAmJiAnc3RyaW5nJyAhPSB0eXBlb2YgdCkpCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdCkKICAgICAgICAgICAgICByLmQoCiAgICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0W2VdCiAgICAgICAgICAgICAgICB9LmJpbmQobnVsbCwgaSkKICAgICAgICAgICAgICApOwogICAgICAgICAgcmV0dXJuIG4KICAgICAgICB9KSwKICAgICAgICAoci5uID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0KICAgICAgICAgICAgdCAmJiB0Ll9fZXNNb2R1bGUKICAgICAgICAgICAgICA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZGVmYXVsdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiByLmQoZSwgJ2EnLCBlKSwgZQogICAgICAgIH0pLAogICAgICAgIChyLm8gPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBlKQogICAgICAgIH0pLAogICAgICAgIChyLnAgPSAnJyksCiAgICAgICAgcigoci5zID0gMikpCiAgICAgICkKICAgIH0pKFsKICAgICAgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICBjb25zdCBuID0gcigxKSwKICAgICAgICAgIGkgPSB7CiAgICAgICAgICAgIDA6ICdFUkFSX1NVQ0NFU1MnLAogICAgICAgICAgICAxMDogJ0VSQVJfRU5EX0FSQ0hJVkUnLAogICAgICAgICAgICAxMTogJ0VSQVJfTk9fTUVNT1JZJywKICAgICAgICAgICAgMTI6ICdFUkFSX0JBRF9EQVRBJywKICAgICAgICAgICAgMTM6ICdFUkFSX0JBRF9BUkNISVZFJywKICAgICAgICAgICAgMTQ6ICdFUkFSX1VOS05PV05fRk9STUFUJywKICAgICAgICAgICAgMTU6ICdFUkFSX0VPUEVOJywKICAgICAgICAgICAgMTY6ICdFUkFSX0VDUkVBVEUnLAogICAgICAgICAgICAxNzogJ0VSQVJfRUNMT1NFJywKICAgICAgICAgICAgMTg6ICdFUkFSX0VSRUFEJywKICAgICAgICAgICAgMTk6ICdFUkFSX0VXUklURScsCiAgICAgICAgICAgIDIwOiAnRVJBUl9TTUFMTF9CVUYnLAogICAgICAgICAgICAyMTogJ0VSQVJfVU5LTk9XTicsCiAgICAgICAgICAgIDIyOiAnRVJBUl9NSVNTSU5HX1BBU1NXT1JEJywKICAgICAgICAgICAgMjM6ICdFUkFSX0VSRUZFUkVOQ0UnLAogICAgICAgICAgICAyNDogJ0VSQVJfQkFEX1BBU1NXT1JEJywKICAgICAgICAgIH0sCiAgICAgICAgICBvID0gewogICAgICAgICAgICAwOiAnU3VjY2VzcycsCiAgICAgICAgICAgIDExOiAnTm90IGVub3VnaCBtZW1vcnknLAogICAgICAgICAgICAxMjogJ0FyY2hpdmUgaGVhZGVyIG9yIGRhdGEgYXJlIGRhbWFnZWQnLAogICAgICAgICAgICAxMzogJ0ZpbGUgaXMgbm90IFJBUiBhcmNoaXZlJywKICAgICAgICAgICAgMTQ6ICdVbmtub3duIGFyY2hpdmUgZm9ybWF0JywKICAgICAgICAgICAgMTU6ICdGaWxlIG9wZW4gZXJyb3InLAogICAgICAgICAgICAxNjogJ0ZpbGUgY3JlYXRlIGVycm9yJywKICAgICAgICAgICAgMTc6ICdGaWxlIGNsb3NlIGVycm9yJywKICAgICAgICAgICAgMTg6ICdGaWxlIHJlYWQgZXJyb3InLAogICAgICAgICAgICAxOTogJ0ZpbGUgd3JpdGUgZXJyb3InLAogICAgICAgICAgICAyMDogJ0J1ZmZlciBmb3IgYXJjaGl2ZSBjb21tZW50IGlzIHRvbyBzbWFsbCwgY29tbWVudCB0cnVuY2F0ZWQnLAogICAgICAgICAgICAyMTogJ1Vua25vd24gZXJyb3InLAogICAgICAgICAgICAyMjogJ1Bhc3N3b3JkIGZvciBlbmNyeXB0ZWQgZmlsZSBvciBoZWFkZXIgaXMgbm90IHNwZWNpZmllZCcsCiAgICAgICAgICAgIDIzOiAnQ2Fubm90IG9wZW4gZmlsZSBzb3VyY2UgZm9yIHJlZmVyZW5jZSByZWNvcmQnLAogICAgICAgICAgICAyNDogJ1dyb25nIHBhc3N3b3JkIGlzIHNwZWNpZmllZCcsCiAgICAgICAgICB9OwogICAgICAgIGNsYXNzIHMgewogICAgICAgICAgY29uc3RydWN0b3IodCA9ICcnKSB7CiAgKHRoaXMuX3Bhc3N3b3JkID0gdCksICh0aGlzLl9hcmNoaXZlID0gbnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRGaWxlTGlzdCgpIHsKICAgICAgICAgICAgbGV0IHQsCiAgICAgICAgICAgICAgW2UsIHJdID0gdGhpcy5vcGVuQXJjKCEwKTsKICAgICAgICAgICAgaWYgKCdTVUNDRVNTJyAhPT0gZS5zdGF0ZSkgdCA9IFtlLCBudWxsXTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgbGV0IGUsCiAgICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgICAgaSA9IFtdOwogICAgICAgICAgICAgIGZvciAoOyAoW2UsIG5dID0gdGhpcy5wcm9jZXNzTmV4dEZpbGUoKCkgPT4gITApKSwgJ1NVQ0NFU1MnID09PSBlLnN0YXRlOyApIGkucHVzaChuLmZpbGVIZWFkZXIpOwogICAgICAgICAgICAgIHQgPSAnRVJBUl9FTkRfQVJDSElWRScgIT09IGUucmVhc29uID8gW2UsIG51bGxdIDogW3sgc3RhdGU6ICdTVUNDRVNTJyB9LCB7IGFyY0hlYWRlcjogciwgZmlsZUhlYWRlcnM6IGkgfV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VBcmMoKSwgdAogICAgICAgICAgfQogICAgICAgICAgZXh0cmFjdEFsbCgpIHsKICAgICAgICAgICAgbGV0IHQsCiAgICAgICAgICAgICAgW2UsIHJdID0gdGhpcy5vcGVuQXJjKCExKTsKICAgICAgICAgICAgaWYgKCdTVUNDRVNTJyAhPT0gZS5zdGF0ZSkgdCA9IFtlLCBudWxsXTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgbGV0IGUsCiAgICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgICAgaSA9IFtdOwogICAgICAgICAgICAgIGZvciAoOyAoW2UsIG5dID0gdGhpcy5wcm9jZXNzTmV4dEZpbGUoKCkgPT4gITEpKSwgJ1NVQ0NFU1MnID09PSBlLnN0YXRlOyApIGkucHVzaChuKTsKICAgICAgICAgICAgICB0ID0gJ0VSQVJfRU5EX0FSQ0hJVkUnICE9PSBlLnJlYXNvbiA/IFtlLCBudWxsXSA6IFt7IHN0YXRlOiAnU1VDQ0VTUycgfSwgeyBhcmNIZWFkZXI6IHIsIGZpbGVzOiBpIH1dOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb3NlQXJjKCksIHQKICAgICAgICAgIH0KICAgICAgICAgIGV4dHJhY3RGaWxlcyh0LCBlKSB7CiAgICAgICAgICAgIGxldCByLAogICAgICAgICAgICAgIFtuLCBpXSA9IHRoaXMub3BlbkFyYyghMSwgZSksCiAgICAgICAgICAgICAgbyA9IHt9OwogICAgICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubGVuZ3RoOyArK2UpIG9bdFtlXV0gPSBlOwogICAgICAgICAgICBpZiAoJ1NVQ0NFU1MnICE9PSBuLnN0YXRlKSByID0gW24sIG51bGxdOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBsZXQgZSwKICAgICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgICBzID0gQXJyYXkodC5sZW5ndGgpLmZpbGwobnVsbCksCiAgICAgICAgICAgICAgICB1ID0gMDsKICAgICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgICBsZXQgciA9ICExLAogICAgICAgICAgICAgICAgICBpID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgKChbZSwgbl0gPSB0aGlzLnByb2Nlc3NOZXh0RmlsZSgodCkgPT4gKHQgaW4gbyA/ICgoaSA9IG9bdF0pLCAhMSkgOiAoKHIgPSAhMCksICEwKSkpKSwKICAgICAgICAgICAgICAgICAgJ1NVQ0NFU1MnICE9PSBlLnN0YXRlKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgaWYgKCFyICYmICgoc1tpXSA9IG4pLCArK3UgPT09IHQubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICBlLnJlYXNvbiA9ICdFUkFSX0VORF9BUkNISVZFJzsKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgciA9ICdFUkFSX0VORF9BUkNISVZFJyAhPT0gZS5yZWFzb24gPyBbZSwgbnVsbF0gOiBbeyBzdGF0ZTogJ1NVQ0NFU1MnIH0sIHsgYXJjSGVhZGVyOiBpLCBmaWxlczogcyB9XTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUFyYygpLCByCiAgICAgICAgICB9CiAgICAgICAgICBmaWxlQ3JlYXRlZCh0KSB7fQogICAgICAgICAgY2xvc2UodCkgewogICAgICAgICAgICB0aGlzLl9sYXN0RmlsZUNvbnRlbnQgPSB0aGlzLmNsb3NlRmlsZSh0KTsKICAgICAgICAgIH0KICAgICAgICAgIG9wZW5BcmModCwgZSkgewogIChuLkV4dC5jdXJyZW50ID0gdGhpcyksICh0aGlzLl9hcmNoaXZlID0gbmV3IHVucGFjay5SYXJBcmNoaXZlKCkpOwogICAgICAgICAgICBsZXQgciwKICAgICAgICAgICAgICBpID0gdGhpcy5fYXJjaGl2ZS5vcGVuKHRoaXMuX2ZpbGVQYXRoLCBlIHx8IHRoaXMuX3Bhc3N3b3JkLCB0KTsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAociA9CiAgICAgICAgICAgICAgICAwICE9PSBpLnN0YXRlLmVyckNvZGUKICAgICAgICAgICAgICAgICAgPyBbdGhpcy5nZXRGYWlsSW5mbyhpLnN0YXRlLmVyckNvZGUsIGkuc3RhdGUuZXJyVHlwZSksIG51bGxdCiAgICAgICAgICAgICAgICAgIDogWwogICAgICAgICAgICAgICAgICAgICAgeyBzdGF0ZTogJ1NVQ0NFU1MnIH0sCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQ6IGkuY29tbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWU6IDAgIT0gKDEgJiBpLmZsYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NrOiAwICE9ICg0ICYgaS5mbGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgc29saWQ6IDAgIT0gKDggJiBpLmZsYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoSW5mbzogMCAhPSAoMzIgJiBpLmZsYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvdmVyeVJlY29yZDogMCAhPSAoNjQgJiBpLmZsYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJFbmNyeXB0ZWQ6IDAgIT0gKDEyOCAmIGkuZmxhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBdKSwKICAgICAgICAgICAgICAobi5FeHQuY3VycmVudCA9IG51bGwpLAogICAgICAgICAgICAgIHIKICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgICAgcHJvY2Vzc05leHRGaWxlKHQpIHsKICAgICAgICAgICAgbGV0IGU7CiAgICAgICAgICAgIG4uRXh0LmN1cnJlbnQgPSB0aGlzOwogICAgICAgICAgICBsZXQgciA9IHRoaXMuX2FyY2hpdmUuZ2V0RmlsZUhlYWRlcigpLAogICAgICAgICAgICAgIGkgPSBbeyBzdGF0ZTogJ1NVQ0NFU1MnIH0sIG51bGxdOwogICAgICAgICAgICBpZiAoMCA9PT0gci5zdGF0ZS5lcnJDb2RlKSB7CiAgICAgICAgICAgICAgbGV0IGUgPSB0KHIubmFtZSk7CiAgICAgICAgICAgICAgdGhpcy5fbGFzdEZpbGVDb250ZW50ID0gbnVsbDsKICAgICAgICAgICAgICBsZXQgbiA9IHRoaXMuX2FyY2hpdmUucmVhZEZpbGUoZSk7CiAgICAgICAgICAgICAgMCA9PT0gbi5lcnJDb2RlIHx8CiAgICAgICAgICAgICAgICBlIHx8CiAgICAgICAgICAgICAgICAoKGlbMF0gPSB0aGlzLmdldEZhaWxJbmZvKG4uZXJyQ29kZSwgbi5lcnJUeXBlKSksCiAgICAgICAgICAgICAgICAyMiA9PT0gbi5lcnJDb2RlID8gKG4gPSB0aGlzLl9hcmNoaXZlLnJlYWRGaWxlKCEwKSkgOiAobi5lcnJDb2RlID0gMCkpLAogICAgICAgICAgICAgICAgMCA9PT0gbi5lcnJDb2RlCiAgICAgICAgICAgICAgICAgID8gKGlbMV0gPSB0aGlzLl9sYXN0RmlsZUNvbnRlbnQpCiAgICAgICAgICAgICAgICAgIDogKChyLnN0YXRlLmVyckNvZGUgPSBuLmVyckNvZGUpLCAoci5zdGF0ZS5lcnJUeXBlID0gbi5lcnJUeXBlKSksCiAgICAgICAgICAgICAgICAodGhpcy5fbGFzdEZpbGVDb250ZW50ID0gbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAoZSA9CiAgICAgICAgICAgICAgICAwICE9PSByLnN0YXRlLmVyckNvZGUKICAgICAgICAgICAgICAgICAgPyBbdGhpcy5nZXRGYWlsSW5mbyhyLnN0YXRlLmVyckNvZGUsIHIuc3RhdGUuZXJyVHlwZSksIG51bGxdCiAgICAgICAgICAgICAgICAgIDogWwogICAgICAgICAgICAgICAgICAgICAgeyBzdGF0ZTogJ1NVQ0NFU1MnIH0sCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVIZWFkZXI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiByLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuY3J5cHRlZDogMCAhPSAoNCAmIHIuZmxhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29saWQ6IDAgIT0gKDE2ICYgci5mbGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rvcnk6IDAgIT0gKDMyICYgci5mbGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrU2l6ZTogci5wYWNrU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB1bnBTaXplOiByLnVucFNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3JjOiByLmNyYywKICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBbNSwgNiwgNSwgNSwgNCwgN107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgciA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbiBvZiBlKSByLnB1c2godCAmICgoMSA8PCBuKSAtIDEpKSwgKHQgPj49IG4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG4gPSAodCkgPT4gKHQgPCAxMCA/ICcwJyArIHQgOiAnJyArIHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCR7MTk4MCArIChyID0gci5yZXZlcnNlKCkpWzBdfS0ke24oclsxXSl9LSR7bihyWzJdKX1gICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYFQke24oclszXSl9OiR7bihyWzRdKX06JHtuKDIgKiByWzVdKX0uMDAwYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKHIudGltZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5wVmVyOiBgJHtNYXRoLmZsb29yKHIudW5wVmVyIC8gMTApfS4ke3IudW5wVmVyICUgMTB9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyA0ODogJ1N0b3JpbmcnLCA0OTogJ0Zhc3Rlc3QnLCA1MDogJ0Zhc3QnLCA1MTogJ05vcm1hbCcsIDUyOiAnR29vZCcsIDUzOiAnQmVzdCcgfVt0XSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVW5rbm93bicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICB9KShyLm1ldGhvZCksCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3Q6IGksCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF0pLAogICAgICAgICAgICAgIChuLkV4dC5jdXJyZW50ID0gbnVsbCksCiAgICAgICAgICAgICAgZQogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBjbG9zZUFyYygpIHsKICAobi5FeHQuY3VycmVudCA9IHRoaXMpLCB0aGlzLl9hcmNoaXZlLmRlbGV0ZSgpLCAobi5FeHQuY3VycmVudCA9IG51bGwpLCAodGhpcy5fYXJjaGl2ZSA9IG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0RmFpbEluZm8odCwgZSkgewogICAgICAgICAgICByZXR1cm4geyBzdGF0ZTogJ0ZBSUwnLCByZWFzb246IGlbdF0sIG1zZzogb1t0XSB9CiAgICAgICAgICB9CiAgICAgICAgfQogIChzLl9jdXJyZW50ID0gbnVsbCksIChlLkV4dHJhY3RvciA9IHMpOwogICAgICB9LAogICAgICBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAnX19lc01vZHVsZScsIHsgdmFsdWU6ICEwIH0pLCAoZS5FeHQgPSB7IGN1cnJlbnQ6IG51bGwgfSk7CiAgICAgIH0sCiAgICAgIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogITAgfSksCiAgICAgICAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgciBpbiB0KSBlLmhhc093blByb3BlcnR5KHIpIHx8IChlW3JdID0gdFtyXSk7CiAgICAgICAgICB9KShyKDMpKTsKICAgICAgICB2YXIgbiA9IHIoMSk7CiAgICAgICAgZS5FeHQgPSBuLkV4dDsKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICBjb25zdCBuID0gcig0KSwKICAgICAgICAgIGkgPSByKDYpCiAgICAgICAgOyhlLmNyZWF0ZUV4dHJhY3RvckZyb21EYXRhID0gZnVuY3Rpb24gKHQsIGUgPSAnJykgewogICAgICAgICAgcmV0dXJuIG5ldyBuLkRhdGFFeHRyYWN0b3IodCwgZSkKICAgICAgICB9KSwKICAgICAgICAgIChlLmNyZWF0ZUV4dHJhY3RvckZyb21GaWxlID0gZnVuY3Rpb24gKHQsIGUgPSAnJywgciA9ICcnKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgaS5GaWxlRXh0cmFjdG9yKHQsIGUsIHIpCiAgICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICBjb25zdCBuID0gcig1KSwKICAgICAgICAgIGkgPSByKDApOwogICAgICAgIGUuRGF0YUV4dHJhY3RvciA9IGNsYXNzIGV4dGVuZHMgaS5FeHRyYWN0b3IgewogICAgICAgICAgY29uc3RydWN0b3IodCwgZSkgewogICAgICAgICAgICBzdXBlcihlKSwgKHRoaXMuZGF0YUZpbGVzID0ge30pLCAodGhpcy5kYXRhRmlsZU1hcCA9IHt9KSwgKHRoaXMuY3VycmVudEZkID0gMSk7CiAgICAgICAgICAgIGxldCByID0geyBmaWxlOiBuZXcgbi5EYXRhRmlsZShuZXcgVWludDhBcnJheSh0KSksIGZkOiB0aGlzLmN1cnJlbnRGZCsrIH0KICAgICAgICAgICAgOyh0aGlzLl9maWxlUGF0aCA9ICdfZGVmYXVsdFVucmFySlNfLnJhcicpLAogICAgICAgICAgICAgICh0aGlzLmRhdGFGaWxlc1t0aGlzLl9maWxlUGF0aF0gPSByKSwKICAgICAgICAgICAgICAodGhpcy5kYXRhRmlsZU1hcFtyLmZkXSA9IHRoaXMuX2ZpbGVQYXRoKTsKICAgICAgICAgIH0KICAgICAgICAgIG9wZW4odCkgewogICAgICAgICAgICBsZXQgZSA9IHRoaXMuZGF0YUZpbGVzW3RdOwogICAgICAgICAgICByZXR1cm4gZSA/IGUuZmQgOiAwCiAgICAgICAgICB9CiAgICAgICAgICBjcmVhdGUodCkgewogICAgICAgICAgICBsZXQgZSA9IHRoaXMuY3VycmVudEZkKys7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5kYXRhRmlsZXNbdF0gPSB7IGZpbGU6IG5ldyBuLkRhdGFGaWxlKCksIGZkOiB0aGlzLmN1cnJlbnRGZCsrIH0pLCAodGhpcy5kYXRhRmlsZU1hcFtlXSA9IHQpLCBlCiAgICAgICAgICB9CiAgICAgICAgICBjbG9zZUZpbGUodCkgewogICAgICAgICAgICBsZXQgZSA9IHRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbdF1dOwogICAgICAgICAgICBpZiAoIWUpIHJldHVybiBudWxsCiAgICAgICAgICAgIGxldCByID0gZS5maWxlLnJlYWRBbGwoKTsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAxICE9PSB0ID8gKGRlbGV0ZSB0aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW3RdXSwgZGVsZXRlIHRoaXMuZGF0YUZpbGVNYXBbdF0pIDogZS5maWxlLnNlZWsoMCwgJ1NFVCcpLAogICAgICAgICAgICAgIHIKICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgICAgcmVhZCh0LCBlLCByKSB7CiAgICAgICAgICAgIGxldCBuID0gdGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFt0XV07CiAgICAgICAgICAgIGlmICghbikgcmV0dXJuIC0xCiAgICAgICAgICAgIGxldCBpID0gbi5maWxlLnJlYWQocik7CiAgICAgICAgICAgIHJldHVybiBudWxsID09PSBpID8gLTEgOiAodW5wYWNrLkhFQVBVOC5zZXQoaSwgZSksIGkuYnl0ZUxlbmd0aCkKICAgICAgICAgIH0KICAgICAgICAgIHdyaXRlKHQsIGUsIHIpIHsKICAgICAgICAgICAgbGV0IG4gPSB0aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW3RdXTsKICAgICAgICAgICAgcmV0dXJuICEhbiAmJiAobi5maWxlLndyaXRlKHVucGFjay5IRUFQVTguc2xpY2UoZSwgZSArIHIpKSwgITApCiAgICAgICAgICB9CiAgICAgICAgICB0ZWxsKHQpIHsKICAgICAgICAgICAgbGV0IGUgPSB0aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW3RdXTsKICAgICAgICAgICAgcmV0dXJuIGUgPyBlLmZpbGUudGVsbCgpIDogLTEKICAgICAgICAgIH0KICAgICAgICAgIHNlZWsodCwgZSwgcikgewogICAgICAgICAgICBsZXQgbiA9IHRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbdF1dOwogICAgICAgICAgICByZXR1cm4gISFuICYmIG4uZmlsZS5zZWVrKGUsIHIpCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICBlLkRhdGFGaWxlID0gY2xhc3MgewogICAgICAgICAgY29uc3RydWN0b3IodCkgewogICh0aGlzLmJ1ZmZlcnMgPSBbXSksCiAgICAgICAgICAgICAgKHRoaXMucG9zID0gMCksCiAgICAgICAgICAgICAgKHRoaXMuc2l6ZSA9IDApLAogICAgICAgICAgICAgIHQgJiYgKHRoaXMuYnVmZmVycy5wdXNoKHQpLCAodGhpcy5zaXplID0gdC5ieXRlTGVuZ3RoKSwgKHRoaXMucG9zID0gMCkpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZCh0KSB7CiAgICAgICAgICAgIGlmICgodGhpcy5mbGF0dGVuKCksIHQgKyB0aGlzLnBvcyA+IHRoaXMuc2l6ZSkpIHJldHVybiBudWxsCiAgICAgICAgICAgIGxldCBlID0gdGhpcy5wb3M7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5wb3MgKz0gdCksIHRoaXMuYnVmZmVyc1swXS5zbGljZShlLCB0aGlzLnBvcykKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRBbGwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZsYXR0ZW4oKSwgdGhpcy5idWZmZXJzWzBdCiAgICAgICAgICB9CiAgICAgICAgICB3cml0ZSh0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcnMucHVzaCh0KSwgKHRoaXMuc2l6ZSArPSB0LmJ5dGVMZW5ndGgpLCAodGhpcy5wb3MgKz0gdC5ieXRlTGVuZ3RoKSwgITAKICAgICAgICAgIH0KICAgICAgICAgIHRlbGwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBvcwogICAgICAgICAgfQogICAgICAgICAgc2Vlayh0LCBlKSB7CiAgICAgICAgICAgIGxldCByID0gdGhpcy5wb3M7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgJ1NFVCcgPT09IGUgPyAociA9IHQpIDogJ0NVUicgPT09IGUgPyAociArPSB0KSA6IChyID0gdGhpcy5zaXplIC0gdCksCiAgICAgICAgICAgICAgIShyIDwgMCB8fCByID4gdGhpcy5zaXplIHx8ICgodGhpcy5wb3MgPSByKSwgMCkpCiAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICAgIGZsYXR0ZW4oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlcnMubGVuZ3RoIDw9IDEpIHJldHVybgogICAgICAgICAgICBsZXQgdCA9IG5ldyBVaW50OEFycmF5KHRoaXMuc2l6ZSksCiAgICAgICAgICAgICAgZSA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IHIgb2YgdGhpcy5idWZmZXJzKSB0LnNldChyLCBlKSwgKGUgKz0gci5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgdGhpcy5idWZmZXJzID0gW3RdOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiAhMCB9KTsKICAgICAgICAgIGNvbnN0IG4gPSByKDEyKSwKICAgICAgICAgICAgaSA9IHIoMTMpLAogICAgICAgICAgICBvID0gcigwKTsKICAgICAgICAgIGUuRmlsZUV4dHJhY3RvciA9IGNsYXNzIGV4dGVuZHMgby5FeHRyYWN0b3IgewogICAgICAgICAgICBjb25zdHJ1Y3Rvcih0LCBlLCByKSB7CiAgICAgICAgICAgICAgc3VwZXIociksICh0aGlzLl9maWxlUGF0aCA9IHQpLCAodGhpcy5maWxlTWFwID0ge30pLCAodGhpcy5fdGFyZ2V0ID0gZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3Blbih0KSB7CiAgICAgICAgICAgICAgbGV0IGUgPSBuLm9wZW5TeW5jKHQsICdyJyk7CiAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmZpbGVNYXBbZV0gPSB7IHNpemU6IG4uZnN0YXRTeW5jKGUpLnNpemUsIHBvczogMCwgbmFtZTogdCB9KSwgZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNyZWF0ZSh0KSB7CiAgICAgICAgICAgICAgbGV0IGUgPSBpLmpvaW4odGhpcy5fdGFyZ2V0LCB0KTsKICAgICAgICAgICAgICBpLnBhcnNlKGUpCiAgICAgICAgICAgICAgICAuZGlyLnNwbGl0KCcvJykKICAgICAgICAgICAgICAgIC5yZWR1Y2UoKHQsIGUpID0+ICgodCArPSBlICsgJy8nKSwgbi5leGlzdHNTeW5jKHQpIHx8IG4ubWtkaXJTeW5jKHQpLCB0KSwgJycpOwogICAgICAgICAgICAgIGxldCByID0gbi5vcGVuU3luYyhlLCAndycpOwogICAgICAgICAgICAgIHJldHVybiAodGhpcy5maWxlTWFwW3JdID0geyBzaXplOiAwLCBwb3M6IDAsIG5hbWU6IHQgfSksIHIKICAgICAgICAgICAgfQogICAgICAgICAgICBjbG9zZUZpbGUodCkgewogICAgICAgICAgICAgIHJldHVybiBkZWxldGUgdGhpcy5maWxlTWFwW3RdLCBuLmNsb3NlU3luYyh0KSwgbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlYWQoZSwgciwgaSkgewogICAgICAgICAgICAgIGxldCBvID0gdGhpcy5maWxlTWFwW2VdLAogICAgICAgICAgICAgICAgcyA9IG5ldyB0KGkpLAogICAgICAgICAgICAgICAgdSA9IG4ucmVhZFN5bmMoZSwgcywgMCwgaSwgby5wb3MpOwogICAgICAgICAgICAgIHJldHVybiB1bnBhY2suSEVBUFU4LnNldChzLCByKSwgKG8ucG9zICs9IHUpLCB1CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd3JpdGUoZSwgciwgaSkgewogICAgICAgICAgICAgIGxldCBvID0gdGhpcy5maWxlTWFwW2VdLAogICAgICAgICAgICAgICAgcyA9IG4ud3JpdGVTeW5jKGUsIG5ldyB0KHVucGFjay5IRUFQVTguc3ViYXJyYXkociwgciArIGkpKSwgMCwgaSk7CiAgICAgICAgICAgICAgcmV0dXJuIChvLnBvcyArPSBzKSwgKG8uc2l6ZSArPSBzKSwgcyA9PT0gaQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRlbGwodCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVNYXBbdF0ucG9zCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2Vlayh0LCBlLCByKSB7CiAgICAgICAgICAgICAgbGV0IG4gPSB0aGlzLmZpbGVNYXBbdF0sCiAgICAgICAgICAgICAgICBpID0gbi5wb3M7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICdTRVQnID09PSByID8gKGkgPSAwKSA6ICdFTkQnID09PSByICYmIChpID0gbi5zaXplKSwgISgoaSArPSBlKSA8IDAgfHwgaSA+IG4uc2l6ZSB8fCAoKG4ucG9zID0gaSksIDApKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9LmNhbGwodGhpcywgcig3KS5CdWZmZXIpKTsKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIC8qIQogICAgICAgICAgICogVGhlIGJ1ZmZlciBtb2R1bGUgZnJvbSBub2RlLmpzLCBmb3IgdGhlIGJyb3dzZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGF1dGhvciAgIEZlcm9zcyBBYm91a2hhZGlqZWggPGZlcm9zc0BmZXJvc3Mub3JnPiA8aHR0cDovL2Zlcm9zcy5vcmc+CiAgICAgICAgICAgKiBAbGljZW5zZSAgTUlUCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBuID0gcig5KSwKICAgICAgICAgICAgaSA9IHIoMTApLAogICAgICAgICAgICBvID0gcigxMSk7CiAgICAgICAgICBmdW5jdGlvbiBzKCkgewogICAgICAgICAgICByZXR1cm4gYS5UWVBFRF9BUlJBWV9TVVBQT1JUID8gMjE0NzQ4MzY0NyA6IDEwNzM3NDE4MjMKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHUodCwgZSkgewogICAgICAgICAgICBpZiAocygpIDwgZSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0ludmFsaWQgdHlwZWQgYXJyYXkgbGVuZ3RoJykKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICBhLlRZUEVEX0FSUkFZX1NVUFBPUlQKICAgICAgICAgICAgICAgID8gKCh0ID0gbmV3IFVpbnQ4QXJyYXkoZSkpLl9fcHJvdG9fXyA9IGEucHJvdG90eXBlKQogICAgICAgICAgICAgICAgOiAobnVsbCA9PT0gdCAmJiAodCA9IG5ldyBhKGUpKSwgKHQubGVuZ3RoID0gZSkpLAogICAgICAgICAgICAgIHQKICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYSh0LCBlLCByKSB7CiAgICAgICAgICAgIGlmICghKGEuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCB0aGlzIGluc3RhbmNlb2YgYSkpIHJldHVybiBuZXcgYSh0LCBlLCByKQogICAgICAgICAgICBpZiAoJ251bWJlcicgPT0gdHlwZW9mIHQpIHsKICAgICAgICAgICAgICBpZiAoJ3N0cmluZycgPT0gdHlwZW9mIGUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJykKICAgICAgICAgICAgICByZXR1cm4gbCh0aGlzLCB0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmKHRoaXMsIHQsIGUsIHIpCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBmKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgaWYgKCdudW1iZXInID09IHR5cGVvZiBlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIGEgbnVtYmVyJykKICAgICAgICAgICAgcmV0dXJuICd1bmRlZmluZWQnICE9IHR5cGVvZiBBcnJheUJ1ZmZlciAmJiBlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIKICAgICAgICAgICAgICA/IChmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgICAgICAgICAgICBpZiAoKGUuYnl0ZUxlbmd0aCwgciA8IDAgfHwgZS5ieXRlTGVuZ3RoIDwgcikpIHRocm93IG5ldyBSYW5nZUVycm9yKCInb2Zmc2V0JyBpcyBvdXQgb2YgYm91bmRzIikKICAgICAgICAgICAgICAgICAgaWYgKGUuYnl0ZUxlbmd0aCA8IHIgKyAobiB8fCAwKSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIidsZW5ndGgnIGlzIG91dCBvZiBib3VuZHMiKQogICAgICAgICAgICAgICAgICBlID0KICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IHIgJiYgdm9pZCAwID09PSBuCiAgICAgICAgICAgICAgICAgICAgICA/IG5ldyBVaW50OEFycmF5KGUpCiAgICAgICAgICAgICAgICAgICAgICA6IHZvaWQgMCA9PT0gbgogICAgICAgICAgICAgICAgICAgICAgPyBuZXcgVWludDhBcnJheShlLCByKQogICAgICAgICAgICAgICAgICAgICAgOiBuZXcgVWludDhBcnJheShlLCByLCBuKTsKICAgICAgICAgICAgICAgICAgYS5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKCh0ID0gZSkuX19wcm90b19fID0gYS5wcm90b3R5cGUpIDogKHQgPSBjKHQsIGUpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgIH0pKHQsIGUsIHIsIG4pCiAgICAgICAgICAgICAgOiAnc3RyaW5nJyA9PSB0eXBlb2YgZQogICAgICAgICAgICAgID8gKGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgKCdzdHJpbmcnID09IHR5cGVvZiByICYmICcnICE9PSByKSB8fCAociA9ICd1dGY4Jyk7CiAgICAgICAgICAgICAgICAgIGlmICghYS5pc0VuY29kaW5nKHIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKQogICAgICAgICAgICAgICAgICB2YXIgbiA9IDAgfCBnKGUsIHIpLAogICAgICAgICAgICAgICAgICAgIGkgPSAodCA9IHUodCwgbikpLndyaXRlKGUsIHIpOwogICAgICAgICAgICAgICAgICBpICE9PSBuICYmICh0ID0gdC5zbGljZSgwLCBpKSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgICAgICB9KSh0LCBlLCByKQogICAgICAgICAgICAgIDogKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChhLmlzQnVmZmVyKGUpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSAwIHwgcChlLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT09ICh0ID0gdSh0LCByKSkubGVuZ3RoID8gdCA6IChlLmNvcHkodCwgMCwgMCwgciksIHQpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCd1bmRlZmluZWQnICE9IHR5cGVvZiBBcnJheUJ1ZmZlciAmJiBlLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB8fCAnbGVuZ3RoJyBpbiBlKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXInICE9IHR5cGVvZiBlLmxlbmd0aCB8fAogICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCAhPSB0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKGUubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICA/IHUodCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgOiBjKHQsIGUpCiAgICAgICAgICAgICAgICAgICAgaWYgKCdCdWZmZXInID09PSBlLnR5cGUgJiYgbyhlLmRhdGEpKSByZXR1cm4gYyh0LCBlLmRhdGEpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgICAnRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIGFycmF5LWxpa2Ugb2JqZWN0LicKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgfSkodCwgZSkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGgodCkgewogICAgICAgICAgICBpZiAoJ251bWJlcicgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoJyJzaXplIiBhcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyJykKICAgICAgICAgICAgaWYgKHQgPCAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJykKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGwodCwgZSkgewogICAgICAgICAgICBpZiAoKGgoZSksICh0ID0gdSh0LCBlIDwgMCA/IDAgOiAwIHwgcChlKSkpLCAhYS5UWVBFRF9BUlJBWV9TVVBQT1JUKSkgZm9yICh2YXIgciA9IDA7IHIgPCBlOyArK3IpIHRbcl0gPSAwOwogICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYyh0LCBlKSB7CiAgICAgICAgICAgIHZhciByID0gZS5sZW5ndGggPCAwID8gMCA6IDAgfCBwKGUubGVuZ3RoKTsKICAgICAgICAgICAgdCA9IHUodCwgcik7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgcjsgbiArPSAxKSB0W25dID0gMjU1ICYgZVtuXTsKICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHAodCkgewogICAgICAgICAgICBpZiAodCA+PSBzKCkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoCiAgICAgICAgICAgICAgICAnQXR0ZW1wdCB0byBhbGxvY2F0ZSBCdWZmZXIgbGFyZ2VyIHRoYW4gbWF4aW11bSBzaXplOiAweCcgKyBzKCkudG9TdHJpbmcoMTYpICsgJyBieXRlcycKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiAwIHwgdAogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZyh0LCBlKSB7CiAgICAgICAgICAgIGlmIChhLmlzQnVmZmVyKHQpKSByZXR1cm4gdC5sZW5ndGgKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICd1bmRlZmluZWQnICE9IHR5cGVvZiBBcnJheUJ1ZmZlciAmJgogICAgICAgICAgICAgICdmdW5jdGlvbicgPT0gdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyAmJgogICAgICAgICAgICAgIChBcnJheUJ1ZmZlci5pc1ZpZXcodCkgfHwgdCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgcmV0dXJuIHQuYnl0ZUxlbmd0aAogICAgICAgICAgICAnc3RyaW5nJyAhPSB0eXBlb2YgdCAmJiAodCA9ICcnICsgdCk7CiAgICAgICAgICAgIHZhciByID0gdC5sZW5ndGg7CiAgICAgICAgICAgIGlmICgwID09PSByKSByZXR1cm4gMAogICAgICAgICAgICBmb3IgKHZhciBuID0gITE7IDsgKQogICAgICAgICAgICAgIHN3aXRjaCAoZSkgewogICAgICAgICAgICAgICAgY2FzZSAnYXNjaWknOgogICAgICAgICAgICAgICAgY2FzZSAnbGF0aW4xJzoKICAgICAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgICAgICBjYXNlICd1dGY4JzoKICAgICAgICAgICAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICAgICAgICAgIGNhc2Ugdm9pZCAwOgogICAgICAgICAgICAgICAgICByZXR1cm4gayh0KS5sZW5ndGgKICAgICAgICAgICAgICAgIGNhc2UgJ3VjczInOgogICAgICAgICAgICAgICAgY2FzZSAndWNzLTInOgogICAgICAgICAgICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6CiAgICAgICAgICAgICAgICAgIHJldHVybiAyICogcgogICAgICAgICAgICAgICAgY2FzZSAnaGV4JzoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgPj4+IDEKICAgICAgICAgICAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgICAgICAgICAgIHJldHVybiBqKHQpLmxlbmd0aAogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgaWYgKG4pIHJldHVybiBrKHQpLmxlbmd0aAogICAgICAgICAgICAgICAgICA7KGUgPSAoJycgKyBlKS50b0xvd2VyQ2FzZSgpKSwgKG4gPSAhMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZCh0LCBlLCByKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtlXQogICAgICAgICAgICA7KHRbZV0gPSB0W3JdKSwgKHRbcl0gPSBuKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHkodCwgZSwgciwgbiwgaSkgewogICAgICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybiAtMQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgKCdzdHJpbmcnID09IHR5cGVvZiByCiAgICAgICAgICAgICAgICA/ICgobiA9IHIpLCAociA9IDApKQogICAgICAgICAgICAgICAgOiByID4gMjE0NzQ4MzY0NwogICAgICAgICAgICAgICAgPyAociA9IDIxNDc0ODM2NDcpCiAgICAgICAgICAgICAgICA6IHIgPCAtMjE0NzQ4MzY0OCAmJiAociA9IC0yMTQ3NDgzNjQ4KSwKICAgICAgICAgICAgICAociA9ICtyKSwKICAgICAgICAgICAgICBpc05hTihyKSAmJiAociA9IGkgPyAwIDogdC5sZW5ndGggLSAxKSwKICAgICAgICAgICAgICByIDwgMCAmJiAociA9IHQubGVuZ3RoICsgciksCiAgICAgICAgICAgICAgciA+PSB0Lmxlbmd0aCkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgaWYgKGkpIHJldHVybiAtMQogICAgICAgICAgICAgIHIgPSB0Lmxlbmd0aCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAociA8IDApIHsKICAgICAgICAgICAgICBpZiAoIWkpIHJldHVybiAtMQogICAgICAgICAgICAgIHIgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoJ3N0cmluZycgPT0gdHlwZW9mIGUgJiYgKGUgPSBhLmZyb20oZSwgbikpLCBhLmlzQnVmZmVyKGUpKSkgcmV0dXJuIDAgPT09IGUubGVuZ3RoID8gLTEgOiB3KHQsIGUsIHIsIG4sIGkpCiAgICAgICAgICAgIGlmICgnbnVtYmVyJyA9PSB0eXBlb2YgZSkKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGUgJj0gMjU1KSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mCiAgICAgICAgICAgICAgICAgID8gaQogICAgICAgICAgICAgICAgICAgID8gVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKHQsIGUsIHIpCiAgICAgICAgICAgICAgICAgICAgOiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKHQsIGUsIHIpCiAgICAgICAgICAgICAgICAgIDogdyh0LCBbZV0sIHIsIG4sIGkpCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXInKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gdyh0LCBlLCByLCBuLCBpKSB7CiAgICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgIHMgPSAxLAogICAgICAgICAgICAgIHUgPSB0Lmxlbmd0aCwKICAgICAgICAgICAgICBhID0gZS5sZW5ndGg7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB2b2lkIDAgIT09IG4gJiYKICAgICAgICAgICAgICAoJ3VjczInID09PSAobiA9IFN0cmluZyhuKS50b0xvd2VyQ2FzZSgpKSB8fCAndWNzLTInID09PSBuIHx8ICd1dGYxNmxlJyA9PT0gbiB8fCAndXRmLTE2bGUnID09PSBuKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAodC5sZW5ndGggPCAyIHx8IGUubGVuZ3RoIDwgMikgcmV0dXJuIC0xCiAgICAgICAgICAgICAgOyhzID0gMiksICh1IC89IDIpLCAoYSAvPSAyKSwgKHIgLz0gMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZih0LCBlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDEgPT09IHMgPyB0W2VdIDogdC5yZWFkVUludDE2QkUoZSAqIHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgICB2YXIgaCA9IC0xOwogICAgICAgICAgICAgIGZvciAobyA9IHI7IG8gPCB1OyBvKyspCiAgICAgICAgICAgICAgICBpZiAoZih0LCBvKSA9PT0gZihlLCAtMSA9PT0gaCA/IDAgOiBvIC0gaCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKCgtMSA9PT0gaCAmJiAoaCA9IG8pLCBvIC0gaCArIDEgPT09IGEpKSByZXR1cm4gaCAqIHMKICAgICAgICAgICAgICAgIH0gZWxzZSAtMSAhPT0gaCAmJiAobyAtPSBvIC0gaCksIChoID0gLTEpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBmb3IgKHIgKyBhID4gdSAmJiAociA9IHUgLSBhKSwgbyA9IHI7IG8gPj0gMDsgby0tKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBsID0gITAsIGMgPSAwOyBjIDwgYTsgYysrKQogICAgICAgICAgICAgICAgICBpZiAoZih0LCBvICsgYykgIT09IGYoZSwgYykpIHsKICAgICAgICAgICAgICAgICAgICBsID0gITE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGwpIHJldHVybiBvCiAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIEUodCwgZSwgciwgbikgewogICAgICAgICAgICByID0gTnVtYmVyKHIpIHx8IDA7CiAgICAgICAgICAgIHZhciBpID0gdC5sZW5ndGggLSByOwogICAgICAgICAgICBuID8gKG4gPSBOdW1iZXIobikpID4gaSAmJiAobiA9IGkpIDogKG4gPSBpKTsKICAgICAgICAgICAgdmFyIG8gPSBlLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG8gJSAyICE9IDApIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgaGV4IHN0cmluZycpCiAgICAgICAgICAgIG4gPiBvIC8gMiAmJiAobiA9IG8gLyAyKTsKICAgICAgICAgICAgZm9yICh2YXIgcyA9IDA7IHMgPCBuOyArK3MpIHsKICAgICAgICAgICAgICB2YXIgdSA9IHBhcnNlSW50KGUuc3Vic3RyKDIgKiBzLCAyKSwgMTYpOwogICAgICAgICAgICAgIGlmIChpc05hTih1KSkgcmV0dXJuIHMKICAgICAgICAgICAgICB0W3IgKyBzXSA9IHU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHMKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHYodCwgZSwgciwgbikgewogICAgICAgICAgICByZXR1cm4geihrKGUsIHQubGVuZ3RoIC0gciksIHQsIHIsIG4pCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBBKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIHooCiAgICAgICAgICAgICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0gW10sIHIgPSAwOyByIDwgdC5sZW5ndGg7ICsrcikgZS5wdXNoKDI1NSAmIHQuY2hhckNvZGVBdChyKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgIH0pKGUpLAogICAgICAgICAgICAgIHQsCiAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICBuCiAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIF8odCwgZSwgciwgbikgewogICAgICAgICAgICByZXR1cm4gQSh0LCBlLCByLCBuKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYih0LCBlLCByLCBuKSB7CiAgICAgICAgICAgIHJldHVybiB6KGooZSksIHQsIHIsIG4pCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBtKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIHooCiAgICAgICAgICAgICAgKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciByLCBuLCBpLCBvID0gW10sIHMgPSAwOyBzIDwgdC5sZW5ndGggJiYgISgoZSAtPSAyKSA8IDApOyArK3MpCiAgICAgICAgICAgICAgICAgIChyID0gdC5jaGFyQ29kZUF0KHMpKSwgKG4gPSByID4+IDgpLCAoaSA9IHIgJSAyNTYpLCBvLnB1c2goaSksIG8ucHVzaChuKTsKICAgICAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgICAgICAgfSkoZSwgdC5sZW5ndGggLSByKSwKICAgICAgICAgICAgICB0LAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgbgogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBSKHQsIGUsIHIpIHsKICAgICAgICAgICAgcmV0dXJuIDAgPT09IGUgJiYgciA9PT0gdC5sZW5ndGggPyBuLmZyb21CeXRlQXJyYXkodCkgOiBuLmZyb21CeXRlQXJyYXkodC5zbGljZShlLCByKSkKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIFModCwgZSwgcikgewogICAgICAgICAgICByID0gTWF0aC5taW4odC5sZW5ndGgsIHIpOwogICAgICAgICAgICBmb3IgKHZhciBuID0gW10sIGkgPSBlOyBpIDwgcjsgKSB7CiAgICAgICAgICAgICAgdmFyIG8sCiAgICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgICAgdSwKICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICBmID0gdFtpXSwKICAgICAgICAgICAgICAgIGggPSBudWxsLAogICAgICAgICAgICAgICAgbCA9IGYgPiAyMzkgPyA0IDogZiA+IDIyMyA/IDMgOiBmID4gMTkxID8gMiA6IDE7CiAgICAgICAgICAgICAgaWYgKGkgKyBsIDw9IHIpCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGwpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIGYgPCAxMjggJiYgKGggPSBmKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgMTI4ID09ICgxOTIgJiAobyA9IHRbaSArIDFdKSkgJiYgKGEgPSAoKDMxICYgZikgPDwgNikgfCAoNjMgJiBvKSkgPiAxMjcgJiYgKGggPSBhKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgKG8gPSB0W2kgKyAxXSksCiAgICAgICAgICAgICAgICAgICAgICAocyA9IHRbaSArIDJdKSwKICAgICAgICAgICAgICAgICAgICAgIDEyOCA9PSAoMTkyICYgbykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgMTI4ID09ICgxOTIgJiBzKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAoYSA9ICgoMTUgJiBmKSA8PCAxMikgfCAoKDYzICYgbykgPDwgNikgfCAoNjMgJiBzKSkgPiAyMDQ3ICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChhIDwgNTUyOTYgfHwgYSA+IDU3MzQzKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAoaCA9IGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAobyA9IHRbaSArIDFdKSwKICAgICAgICAgICAgICAgICAgICAgIChzID0gdFtpICsgMl0pLAogICAgICAgICAgICAgICAgICAgICAgKHUgPSB0W2kgKyAzXSksCiAgICAgICAgICAgICAgICAgICAgICAxMjggPT0gKDE5MiAmIG8pICYmCiAgICAgICAgICAgICAgICAgICAgICAgIDEyOCA9PSAoMTkyICYgcykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgMTI4ID09ICgxOTIgJiB1KSAmJgogICAgICAgICAgICAgICAgICAgICAgICAoYSA9ICgoMTUgJiBmKSA8PCAxOCkgfCAoKDYzICYgbykgPDwgMTIpIHwgKCg2MyAmIHMpIDw8IDYpIHwgKDYzICYgdSkpID4gNjU1MzUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgYSA8IDExMTQxMTIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKGggPSBhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBudWxsID09PSBoCiAgICAgICAgICAgICAgICA/ICgoaCA9IDY1NTMzKSwgKGwgPSAxKSkKICAgICAgICAgICAgICAgIDogaCA+IDY1NTM1ICYmICgoaCAtPSA2NTUzNiksIG4ucHVzaCgoKGggPj4+IDEwKSAmIDEwMjMpIHwgNTUyOTYpLCAoaCA9IDU2MzIwIHwgKDEwMjMgJiBoKSkpLAogICAgICAgICAgICAgICAgbi5wdXNoKGgpLAogICAgICAgICAgICAgICAgKGkgKz0gbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBlID0gdC5sZW5ndGg7CiAgICAgICAgICAgICAgaWYgKGUgPD0gVCkgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCB0KQogICAgICAgICAgICAgIHZhciByID0gJycsCiAgICAgICAgICAgICAgICBuID0gMDsKICAgICAgICAgICAgICBmb3IgKDsgbiA8IGU7ICkgciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgdC5zbGljZShuLCAobiArPSBUKSkpOwogICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIH0pKG4pCiAgICAgICAgICB9CiAgKGUuQnVmZmVyID0gYSksCiAgICAgICAgICAgIChlLlNsb3dCdWZmZXIgPSBmdW5jdGlvbiAodCkgewogICt0ICE9IHQgJiYgKHQgPSAwKTsKICAgICAgICAgICAgICByZXR1cm4gYS5hbGxvYygrdCkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChlLklOU1BFQ1RfTUFYX0JZVEVTID0gNTApLAogICAgICAgICAgICAoYS5UWVBFRF9BUlJBWV9TVVBQT1JUID0KICAgICAgICAgICAgICB2b2lkIDAgIT09IHQuVFlQRURfQVJSQVlfU1VQUE9SVAogICAgICAgICAgICAgICAgPyB0LlRZUEVEX0FSUkFZX1NVUFBPUlQKICAgICAgICAgICAgICAgIDogKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgVWludDhBcnJheSgxKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICh0Ll9fcHJvdG9fXyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfX3Byb3RvX186IFVpbnQ4QXJyYXkucHJvdG90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZvbzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQyCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIDQyID09PSB0LmZvbygpICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIHQuc3ViYXJyYXkgJiYgMCA9PT0gdC5zdWJhcnJheSgxLCAxKS5ieXRlTGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KSgpKSwKICAgICAgICAgICAgKGUua01heExlbmd0aCA9IHMoKSksCiAgICAgICAgICAgIChhLnBvb2xTaXplID0gODE5MiksCiAgICAgICAgICAgIChhLl9hdWdtZW50ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gKHQuX19wcm90b19fID0gYS5wcm90b3R5cGUpLCB0CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5mcm9tID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZihudWxsLCB0LCBlLCByKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgYS5UWVBFRF9BUlJBWV9TVVBQT1JUICYmCiAgICAgICAgICAgICAgKChhLnByb3RvdHlwZS5fX3Byb3RvX18gPSBVaW50OEFycmF5LnByb3RvdHlwZSksCiAgICAgICAgICAgICAgKGEuX19wcm90b19fID0gVWludDhBcnJheSksCiAgICAgICAgICAgICAgJ3VuZGVmaW5lZCcgIT0gdHlwZW9mIFN5bWJvbCAmJgogICAgICAgICAgICAgICAgU3ltYm9sLnNwZWNpZXMgJiYKICAgICAgICAgICAgICAgIGFbU3ltYm9sLnNwZWNpZXNdID09PSBhICYmCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgU3ltYm9sLnNwZWNpZXMsIHsgdmFsdWU6IG51bGwsIGNvbmZpZ3VyYWJsZTogITAgfSkpLAogICAgICAgICAgICAoYS5hbGxvYyA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIChmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgaChlKSwKICAgICAgICAgICAgICAgICAgZSA8PSAwCiAgICAgICAgICAgICAgICAgICAgPyB1KHQsIGUpCiAgICAgICAgICAgICAgICAgICAgOiB2b2lkIDAgIT09IHIKICAgICAgICAgICAgICAgICAgICA/ICdzdHJpbmcnID09IHR5cGVvZiBuCiAgICAgICAgICAgICAgICAgICAgICA/IHUodCwgZSkuZmlsbChyLCBuKQogICAgICAgICAgICAgICAgICAgICAgOiB1KHQsIGUpLmZpbGwocikKICAgICAgICAgICAgICAgICAgICA6IHUodCwgZSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9KShudWxsLCB0LCBlLCByKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEuYWxsb2NVbnNhZmUgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBsKG51bGwsIHQpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5hbGxvY1Vuc2FmZVNsb3cgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBsKG51bGwsIHQpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5pc0J1ZmZlciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuICEobnVsbCA9PSB0IHx8ICF0Ll9pc0J1ZmZlcikKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLmNvbXBhcmUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIGlmICghYS5pc0J1ZmZlcih0KSB8fCAhYS5pc0J1ZmZlcihlKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnRzIG11c3QgYmUgQnVmZmVycycpCiAgICAgICAgICAgICAgaWYgKHQgPT09IGUpIHJldHVybiAwCiAgICAgICAgICAgICAgZm9yICh2YXIgciA9IHQubGVuZ3RoLCBuID0gZS5sZW5ndGgsIGkgPSAwLCBvID0gTWF0aC5taW4ociwgbik7IGkgPCBvOyArK2kpCiAgICAgICAgICAgICAgICBpZiAodFtpXSAhPT0gZVtpXSkgewogIChyID0gdFtpXSksIChuID0gZVtpXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHIgPCBuID8gLTEgOiBuIDwgciA/IDEgOiAwCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5pc0VuY29kaW5nID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKFN0cmluZyh0KS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICdoZXgnOgogICAgICAgICAgICAgICAgY2FzZSAndXRmOCc6CiAgICAgICAgICAgICAgICBjYXNlICd1dGYtOCc6CiAgICAgICAgICAgICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgICAgICAgICBjYXNlICdsYXRpbjEnOgogICAgICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICAgICAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgICAgICAgICBjYXNlICd1Y3MyJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgICAgICAgICAgY2FzZSAndXRmLTE2bGUnOgogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLmNvbmNhdCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgaWYgKCFvKHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCcibGlzdCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJykKICAgICAgICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybiBhLmFsbG9jKDApCiAgICAgICAgICAgICAgdmFyIHI7CiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSkgZm9yIChlID0gMCwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgKytyKSBlICs9IHRbcl0ubGVuZ3RoOwogICAgICAgICAgICAgIHZhciBuID0gYS5hbGxvY1Vuc2FmZShlKSwKICAgICAgICAgICAgICAgIGkgPSAwOwogICAgICAgICAgICAgIGZvciAociA9IDA7IHIgPCB0Lmxlbmd0aDsgKytyKSB7CiAgICAgICAgICAgICAgICB2YXIgcyA9IHRbcl07CiAgICAgICAgICAgICAgICBpZiAoIWEuaXNCdWZmZXIocykpIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKQogICAgICAgICAgICAgICAgcy5jb3B5KG4sIGkpLCAoaSArPSBzLmxlbmd0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBuCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5ieXRlTGVuZ3RoID0gZyksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5faXNCdWZmZXIgPSAhMCksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5zd2FwMTYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmxlbmd0aDsKICAgICAgICAgICAgICBpZiAodCAlIDIgIT0gMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNi1iaXRzJykKICAgICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHQ7IGUgKz0gMikgZCh0aGlzLCBlLCBlICsgMSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5zd2FwMzIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmxlbmd0aDsKICAgICAgICAgICAgICBpZiAodCAlIDQgIT0gMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzJykKICAgICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHQ7IGUgKz0gNCkgZCh0aGlzLCBlLCBlICsgMyksIGQodGhpcywgZSArIDEsIGUgKyAyKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnN3YXA2NCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgICAgIGlmICh0ICUgOCAhPSAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMnKQogICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdDsgZSArPSA4KQogICAgICAgICAgICAgICAgZCh0aGlzLCBlLCBlICsgNyksIGQodGhpcywgZSArIDEsIGUgKyA2KSwgZCh0aGlzLCBlICsgMiwgZSArIDUpLCBkKHRoaXMsIGUgKyAzLCBlICsgNCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgdCA9IDAgfCB0aGlzLmxlbmd0aDsKICAgICAgICAgICAgICByZXR1cm4gMCA9PT0gdAogICAgICAgICAgICAgICAgPyAnJwogICAgICAgICAgICAgICAgOiAwID09PSBhcmd1bWVudHMubGVuZ3RoCiAgICAgICAgICAgICAgICA/IFModGhpcywgMCwgdCkKICAgICAgICAgICAgICAgIDogZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9ICExOwogICAgICAgICAgICAgICAgICAgIGlmICgoKHZvaWQgMCA9PT0gZSB8fCBlIDwgMCkgJiYgKGUgPSAwKSwgZSA+IHRoaXMubGVuZ3RoKSkgcmV0dXJuICcnCiAgICAgICAgICAgICAgICAgICAgaWYgKCgodm9pZCAwID09PSByIHx8IHIgPiB0aGlzLmxlbmd0aCkgJiYgKHIgPSB0aGlzLmxlbmd0aCksIHIgPD0gMCkpIHJldHVybiAnJwogICAgICAgICAgICAgICAgICAgIGlmICgociA+Pj49IDApIDw9IChlID4+Pj0gMCkpIHJldHVybiAnJwogICAgICAgICAgICAgICAgICAgIGZvciAodCB8fCAodCA9ICd1dGY4Jyk7IDsgKQogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFUodGhpcywgZSwgcikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXRmOCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUyh0aGlzLCBlLCByKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFAodGhpcywgZSwgcikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGF0aW4xJzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQyh0aGlzLCBlLCByKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdiYXNlNjQnOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSKHRoaXMsIGUsIHIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VjczInOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1Y3MtMic6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEIodGhpcywgZSwgcikKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobikgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgOyh0ID0gKHQgKyAnJykudG9Mb3dlckNhc2UoKSksIChuID0gITApOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGlmICghYS5pc0J1ZmZlcih0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlcicpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgPT09IHQgfHwgMCA9PT0gYS5jb21wYXJlKHRoaXMsIHQpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgdCA9ICcnLAogICAgICAgICAgICAgICAgciA9IGUuSU5TUEVDVF9NQVhfQllURVM7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoID4gMCAmJgogICAgICAgICAgICAgICAgICAoKHQgPSB0aGlzLnRvU3RyaW5nKCdoZXgnLCAwLCByKS5tYXRjaCgvLnsyfS9nKS5qb2luKCcgJykpLCB0aGlzLmxlbmd0aCA+IHIgJiYgKHQgKz0gJyAuLi4gJykpLAogICAgICAgICAgICAgICAgJzxCdWZmZXIgJyArIHQgKyAnPicKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7CiAgICAgICAgICAgICAgaWYgKCFhLmlzQnVmZmVyKHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyJykKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAodm9pZCAwID09PSBlICYmIChlID0gMCksCiAgICAgICAgICAgICAgICB2b2lkIDAgPT09IHIgJiYgKHIgPSB0ID8gdC5sZW5ndGggOiAwKSwKICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gbiAmJiAobiA9IDApLAogICAgICAgICAgICAgICAgdm9pZCAwID09PSBpICYmIChpID0gdGhpcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgZSA8IDAgfHwgciA+IHQubGVuZ3RoIHx8IG4gPCAwIHx8IGkgPiB0aGlzLmxlbmd0aCkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignb3V0IG9mIHJhbmdlIGluZGV4JykKICAgICAgICAgICAgICBpZiAobiA+PSBpICYmIGUgPj0gcikgcmV0dXJuIDAKICAgICAgICAgICAgICBpZiAobiA+PSBpKSByZXR1cm4gLTEKICAgICAgICAgICAgICBpZiAoZSA+PSByKSByZXR1cm4gMQogICAgICAgICAgICAgIGlmICgoKGUgPj4+PSAwKSwgKHIgPj4+PSAwKSwgKG4gPj4+PSAwKSwgKGkgPj4+PSAwKSwgdGhpcyA9PT0gdCkpIHJldHVybiAwCiAgICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICAgIHZhciBvID0gaSAtIG4sIHMgPSByIC0gZSwgdSA9IE1hdGgubWluKG8sIHMpLCBmID0gdGhpcy5zbGljZShuLCBpKSwgaCA9IHQuc2xpY2UoZSwgciksIGwgPSAwOwogICAgICAgICAgICAgICAgbCA8IHU7CiAgICAgICAgICAgICAgICArK2wKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiAoZltsXSAhPT0gaFtsXSkgewogIChvID0gZltsXSksIChzID0gaFtsXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG8gPCBzID8gLTEgOiBzIDwgbyA/IDEgOiAwCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiAtMSAhPT0gdGhpcy5pbmRleE9mKHQsIGUsIHIpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHkodGhpcywgdCwgZSwgciwgITApCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiB5KHRoaXMsIHQsIGUsIHIsICExKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBlKSAobiA9ICd1dGY4JyksIChyID0gdGhpcy5sZW5ndGgpLCAoZSA9IDApOwogICAgICAgICAgICAgIGVsc2UgaWYgKHZvaWQgMCA9PT0gciAmJiAnc3RyaW5nJyA9PSB0eXBlb2YgZSkgKG4gPSBlKSwgKHIgPSB0aGlzLmxlbmd0aCksIChlID0gMCk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzRmluaXRlKGUpKQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0J1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkJykKICAgICAgICAgICAgICAgIDsoZSB8PSAwKSwgaXNGaW5pdGUocikgPyAoKHIgfD0gMCksIHZvaWQgMCA9PT0gbiAmJiAobiA9ICd1dGY4JykpIDogKChuID0gciksIChyID0gdm9pZCAwKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBpID0gdGhpcy5sZW5ndGggLSBlOwogICAgICAgICAgICAgIGlmICgoKHZvaWQgMCA9PT0gciB8fCByID4gaSkgJiYgKHIgPSBpKSwgKHQubGVuZ3RoID4gMCAmJiAociA8IDAgfHwgZSA8IDApKSB8fCBlID4gdGhpcy5sZW5ndGgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0F0dGVtcHQgdG8gd3JpdGUgb3V0c2lkZSBidWZmZXIgYm91bmRzJykKICAgICAgICAgICAgICBuIHx8IChuID0gJ3V0ZjgnKTsKICAgICAgICAgICAgICBmb3IgKHZhciBvID0gITE7IDsgKQogICAgICAgICAgICAgICAgc3dpdGNoIChuKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEUodGhpcywgdCwgZSwgcikKICAgICAgICAgICAgICAgICAgY2FzZSAndXRmOCc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdih0aGlzLCB0LCBlLCByKQogICAgICAgICAgICAgICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEEodGhpcywgdCwgZSwgcikKICAgICAgICAgICAgICAgICAgY2FzZSAnbGF0aW4xJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gXyh0aGlzLCB0LCBlLCByKQogICAgICAgICAgICAgICAgICBjYXNlICdiYXNlNjQnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBiKHRoaXMsIHQsIGUsIHIpCiAgICAgICAgICAgICAgICAgIGNhc2UgJ3VjczInOgogICAgICAgICAgICAgICAgICBjYXNlICd1Y3MtMic6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgICAgICAgICAgICBjYXNlICd1dGYtMTZsZSc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0odGhpcywgdCwgZSwgcikKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAobykgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIG4pCiAgICAgICAgICAgICAgICAgICAgOyhuID0gKCcnICsgbikudG9Mb3dlckNhc2UoKSksIChvID0gITApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4geyB0eXBlOiAnQnVmZmVyJywgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgVCA9IDQwOTY7CiAgICAgICAgICBmdW5jdGlvbiBQKHQsIGUsIHIpIHsKICAgICAgICAgICAgdmFyIG4gPSAnJzsKICAgICAgICAgICAgciA9IE1hdGgubWluKHQubGVuZ3RoLCByKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IGU7IGkgPCByOyArK2kpIG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgxMjcgJiB0W2ldKTsKICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIEModCwgZSwgcikgewogICAgICAgICAgICB2YXIgbiA9ICcnOwogICAgICAgICAgICByID0gTWF0aC5taW4odC5sZW5ndGgsIHIpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gZTsgaSA8IHI7ICsraSkgbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHRbaV0pOwogICAgICAgICAgICByZXR1cm4gbgogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gVSh0LCBlLCByKSB7CiAgICAgICAgICAgIHZhciBuID0gdC5sZW5ndGgKICAgICAgICAgICAgOyghZSB8fCBlIDwgMCkgJiYgKGUgPSAwKSwgKCFyIHx8IHIgPCAwIHx8IHIgPiBuKSAmJiAociA9IG4pOwogICAgICAgICAgICBmb3IgKHZhciBpID0gJycsIG8gPSBlOyBvIDwgcjsgKytvKSBpICs9IE4odFtvXSk7CiAgICAgICAgICAgIHJldHVybiBpCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBCKHQsIGUsIHIpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IHQuc2xpY2UoZSwgciksIGkgPSAnJywgbyA9IDA7IG8gPCBuLmxlbmd0aDsgbyArPSAyKQogICAgICAgICAgICAgIGkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShuW29dICsgMjU2ICogbltvICsgMV0pOwogICAgICAgICAgICByZXR1cm4gaQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gRih0LCBlLCByKSB7CiAgICAgICAgICAgIGlmICh0ICUgMSAhPSAwIHx8IHQgPCAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignb2Zmc2V0IGlzIG5vdCB1aW50JykKICAgICAgICAgICAgaWYgKHQgKyBlID4gcikgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RyeWluZyB0byBhY2Nlc3MgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gTSh0LCBlLCByLCBuLCBpLCBvKSB7CiAgICAgICAgICAgIGlmICghYS5pc0J1ZmZlcih0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcignImJ1ZmZlciIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpCiAgICAgICAgICAgIGlmIChlID4gaSB8fCBlIDwgbykgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJyJ2YWx1ZSIgYXJndW1lbnQgaXMgb3V0IG9mIGJvdW5kcycpCiAgICAgICAgICAgIGlmIChyICsgbiA+IHQubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJykKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHgodCwgZSwgciwgbikgewogICAgICAgICAgICBlIDwgMCAmJiAoZSA9IDY1NTM1ICsgZSArIDEpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbyA9IE1hdGgubWluKHQubGVuZ3RoIC0gciwgMik7IGkgPCBvOyArK2kpCiAgICAgICAgICAgICAgdFtyICsgaV0gPSAoZSAmICgyNTUgPDwgKDggKiAobiA/IGkgOiAxIC0gaSkpKSkgPj4+ICg4ICogKG4gPyBpIDogMSAtIGkpKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIEkodCwgZSwgciwgbikgewogICAgICAgICAgICBlIDwgMCAmJiAoZSA9IDQyOTQ5NjcyOTUgKyBlICsgMSk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBvID0gTWF0aC5taW4odC5sZW5ndGggLSByLCA0KTsgaSA8IG87ICsraSkgdFtyICsgaV0gPSAoZSA+Pj4gKDggKiAobiA/IGkgOiAzIC0gaSkpKSAmIDI1NTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIE8odCwgZSwgciwgbiwgaSwgbykgewogICAgICAgICAgICBpZiAociArIG4gPiB0Lmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpCiAgICAgICAgICAgIGlmIChyIDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBZKHQsIGUsIHIsIG4sIG8pIHsKICAgICAgICAgICAgcmV0dXJuIG8gfHwgTyh0LCAwLCByLCA0KSwgaS53cml0ZSh0LCBlLCByLCBuLCAyMywgNCksIHIgKyA0CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBMKHQsIGUsIHIsIG4sIG8pIHsKICAgICAgICAgICAgcmV0dXJuIG8gfHwgTyh0LCAwLCByLCA4KSwgaS53cml0ZSh0LCBlLCByLCBuLCA1MiwgOCksIHIgKyA4CiAgICAgICAgICB9CiAgKGEucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgdmFyIHIsCiAgICAgICAgICAgICAgbiA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgKCh0ID0gfn50KSwKICAgICAgICAgICAgICAoZSA9IHZvaWQgMCA9PT0gZSA/IG4gOiB+fmUpLAogICAgICAgICAgICAgIHQgPCAwID8gKHQgKz0gbikgPCAwICYmICh0ID0gMCkgOiB0ID4gbiAmJiAodCA9IG4pLAogICAgICAgICAgICAgIGUgPCAwID8gKGUgKz0gbikgPCAwICYmIChlID0gMCkgOiBlID4gbiAmJiAoZSA9IG4pLAogICAgICAgICAgICAgIGUgPCB0ICYmIChlID0gdCksCiAgICAgICAgICAgICAgYS5UWVBFRF9BUlJBWV9TVVBQT1JUKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgKHIgPSB0aGlzLnN1YmFycmF5KHQsIGUpKS5fX3Byb3RvX18gPSBhLnByb3RvdHlwZTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGkgPSBlIC0gdDsKICAgICAgICAgICAgICByID0gbmV3IGEoaSwgdm9pZCAwKTsKICAgICAgICAgICAgICBmb3IgKHZhciBvID0gMDsgbyA8IGk7ICsrbykgcltvXSA9IHRoaXNbbyArIHRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICh0IHw9IDApLCAoZSB8PSAwKSwgciB8fCBGKHQsIGUsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgICAgICBmb3IgKHZhciBuID0gdGhpc1t0XSwgaSA9IDEsIG8gPSAwOyArK28gPCBlICYmIChpICo9IDI1Nik7ICkgbiArPSB0aGlzW3QgKyBvXSAqIGk7CiAgICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkVUludEJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAodCB8PSAwKSwgKGUgfD0gMCksIHIgfHwgRih0LCBlLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXNbdCArIC0tZV0sIGkgPSAxOyBlID4gMCAmJiAoaSAqPSAyNTYpOyApIG4gKz0gdGhpc1t0ICsgLS1lXSAqIGk7CiAgICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHJldHVybiBlIHx8IEYodCwgMSwgdGhpcy5sZW5ndGgpLCB0aGlzW3RdCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUucmVhZFVJbnQxNkxFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZSB8fCBGKHQsIDIsIHRoaXMubGVuZ3RoKSwgdGhpc1t0XSB8ICh0aGlzW3QgKyAxXSA8PCA4KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUgfHwgRih0LCAyLCB0aGlzLmxlbmd0aCksICh0aGlzW3RdIDw8IDgpIHwgdGhpc1t0ICsgMV0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkVUludDMyTEUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBlIHx8IEYodCwgNCwgdGhpcy5sZW5ndGgpLCAodGhpc1t0XSB8ICh0aGlzW3QgKyAxXSA8PCA4KSB8ICh0aGlzW3QgKyAyXSA8PCAxNikpICsgMTY3NzcyMTYgKiB0aGlzW3QgKyAzXQogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkVUludDMyQkUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBlIHx8IEYodCwgNCwgdGhpcy5sZW5ndGgpLCAxNjc3NzIxNiAqIHRoaXNbdF0gKyAoKHRoaXNbdCArIDFdIDw8IDE2KSB8ICh0aGlzW3QgKyAyXSA8PCA4KSB8IHRoaXNbdCArIDNdKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkSW50TEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICh0IHw9IDApLCAoZSB8PSAwKSwgciB8fCBGKHQsIGUsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgICAgICBmb3IgKHZhciBuID0gdGhpc1t0XSwgaSA9IDEsIG8gPSAwOyArK28gPCBlICYmIChpICo9IDI1Nik7ICkgbiArPSB0aGlzW3QgKyBvXSAqIGk7CiAgICAgICAgICAgICAgcmV0dXJuIG4gPj0gKGkgKj0gMTI4KSAmJiAobiAtPSBNYXRoLnBvdygyLCA4ICogZSkpLCBuCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUucmVhZEludEJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAodCB8PSAwKSwgKGUgfD0gMCksIHIgfHwgRih0LCBlLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IGUsIGkgPSAxLCBvID0gdGhpc1t0ICsgLS1uXTsgbiA+IDAgJiYgKGkgKj0gMjU2KTsgKSBvICs9IHRoaXNbdCArIC0tbl0gKiBpOwogICAgICAgICAgICAgIHJldHVybiBvID49IChpICo9IDEyOCkgJiYgKG8gLT0gTWF0aC5wb3coMiwgOCAqIGUpKSwgbwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnJlYWRJbnQ4ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZSB8fCBGKHQsIDEsIHRoaXMubGVuZ3RoKSwgMTI4ICYgdGhpc1t0XSA/IC0xICogKDI1NSAtIHRoaXNbdF0gKyAxKSA6IHRoaXNbdF0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkSW50MTZMRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgZSB8fCBGKHQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgICAgICB2YXIgciA9IHRoaXNbdF0gfCAodGhpc1t0ICsgMV0gPDwgOCk7CiAgICAgICAgICAgICAgcmV0dXJuIDMyNzY4ICYgciA/IDQyOTQ5MDE3NjAgfCByIDogcgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgICBlIHx8IEYodCwgMiwgdGhpcy5sZW5ndGgpOwogICAgICAgICAgICAgIHZhciByID0gdGhpc1t0ICsgMV0gfCAodGhpc1t0XSA8PCA4KTsKICAgICAgICAgICAgICByZXR1cm4gMzI3NjggJiByID8gNDI5NDkwMTc2MCB8IHIgOiByCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHJldHVybiBlIHx8IEYodCwgNCwgdGhpcy5sZW5ndGgpLCB0aGlzW3RdIHwgKHRoaXNbdCArIDFdIDw8IDgpIHwgKHRoaXNbdCArIDJdIDw8IDE2KSB8ICh0aGlzW3QgKyAzXSA8PCAyNCkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUgfHwgRih0LCA0LCB0aGlzLmxlbmd0aCksICh0aGlzW3RdIDw8IDI0KSB8ICh0aGlzW3QgKyAxXSA8PCAxNikgfCAodGhpc1t0ICsgMl0gPDwgOCkgfCB0aGlzW3QgKyAzXQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLnJlYWRGbG9hdExFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZSB8fCBGKHQsIDQsIHRoaXMubGVuZ3RoKSwgaS5yZWFkKHRoaXMsIHQsICEwLCAyMywgNCkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUgfHwgRih0LCA0LCB0aGlzLmxlbmd0aCksIGkucmVhZCh0aGlzLCB0LCAhMSwgMjMsIDQpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZSB8fCBGKHQsIDgsIHRoaXMubGVuZ3RoKSwgaS5yZWFkKHRoaXMsIHQsICEwLCA1MiwgOCkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5yZWFkRG91YmxlQkUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHJldHVybiBlIHx8IEYodCwgOCwgdGhpcy5sZW5ndGgpLCBpLnJlYWQodGhpcywgdCwgITEsIDUyLCA4KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlVUludExFID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAoKHQgPSArdCksIChlIHw9IDApLCAociB8PSAwKSwgbikgfHwgTSh0aGlzLCB0LCBlLCByLCBNYXRoLnBvdygyLCA4ICogcikgLSAxLCAwKTsKICAgICAgICAgICAgICB2YXIgaSA9IDEsCiAgICAgICAgICAgICAgICBvID0gMDsKICAgICAgICAgICAgICBmb3IgKHRoaXNbZV0gPSAyNTUgJiB0OyArK28gPCByICYmIChpICo9IDI1Nik7ICkgdGhpc1tlICsgb10gPSAodCAvIGkpICYgMjU1OwogICAgICAgICAgICAgIHJldHVybiBlICsgcgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlVUludEJFID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAoKHQgPSArdCksIChlIHw9IDApLCAociB8PSAwKSwgbikgfHwgTSh0aGlzLCB0LCBlLCByLCBNYXRoLnBvdygyLCA4ICogcikgLSAxLCAwKTsKICAgICAgICAgICAgICB2YXIgaSA9IHIgLSAxLAogICAgICAgICAgICAgICAgbyA9IDE7CiAgICAgICAgICAgICAgZm9yICh0aGlzW2UgKyBpXSA9IDI1NSAmIHQ7IC0taSA+PSAwICYmIChvICo9IDI1Nik7ICkgdGhpc1tlICsgaV0gPSAodCAvIG8pICYgMjU1OwogICAgICAgICAgICAgIHJldHVybiBlICsgcgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAodCA9ICt0KSwKICAgICAgICAgICAgICAgIChlIHw9IDApLAogICAgICAgICAgICAgICAgciB8fCBNKHRoaXMsIHQsIGUsIDEsIDI1NSwgMCksCiAgICAgICAgICAgICAgICBhLlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgKHQgPSBNYXRoLmZsb29yKHQpKSwKICAgICAgICAgICAgICAgICh0aGlzW2VdID0gMjU1ICYgdCksCiAgICAgICAgICAgICAgICBlICsgMQogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSArdCksCiAgICAgICAgICAgICAgICAoZSB8PSAwKSwKICAgICAgICAgICAgICAgIHIgfHwgTSh0aGlzLCB0LCBlLCAyLCA2NTUzNSwgMCksCiAgICAgICAgICAgICAgICBhLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoKHRoaXNbZV0gPSAyNTUgJiB0KSwgKHRoaXNbZSArIDFdID0gdCA+Pj4gOCkpIDogeCh0aGlzLCB0LCBlLCAhMCksCiAgICAgICAgICAgICAgICBlICsgMgogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSArdCksCiAgICAgICAgICAgICAgICAoZSB8PSAwKSwKICAgICAgICAgICAgICAgIHIgfHwgTSh0aGlzLCB0LCBlLCAyLCA2NTUzNSwgMCksCiAgICAgICAgICAgICAgICBhLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoKHRoaXNbZV0gPSB0ID4+PiA4KSwgKHRoaXNbZSArIDFdID0gMjU1ICYgdCkpIDogeCh0aGlzLCB0LCBlLCAhMSksCiAgICAgICAgICAgICAgICBlICsgMgogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZVVJbnQzMkxFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSArdCksCiAgICAgICAgICAgICAgICAoZSB8PSAwKSwKICAgICAgICAgICAgICAgIHIgfHwgTSh0aGlzLCB0LCBlLCA0LCA0Mjk0OTY3Mjk1LCAwKSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVAogICAgICAgICAgICAgICAgICA/ICgodGhpc1tlICsgM10gPSB0ID4+PiAyNCksICh0aGlzW2UgKyAyXSA9IHQgPj4+IDE2KSwgKHRoaXNbZSArIDFdID0gdCA+Pj4gOCksICh0aGlzW2VdID0gMjU1ICYgdCkpCiAgICAgICAgICAgICAgICAgIDogSSh0aGlzLCB0LCBlLCAhMCksCiAgICAgICAgICAgICAgICBlICsgNAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZVVJbnQzMkJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSArdCksCiAgICAgICAgICAgICAgICAoZSB8PSAwKSwKICAgICAgICAgICAgICAgIHIgfHwgTSh0aGlzLCB0LCBlLCA0LCA0Mjk0OTY3Mjk1LCAwKSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVAogICAgICAgICAgICAgICAgICA/ICgodGhpc1tlXSA9IHQgPj4+IDI0KSwgKHRoaXNbZSArIDFdID0gdCA+Pj4gMTYpLCAodGhpc1tlICsgMl0gPSB0ID4+PiA4KSwgKHRoaXNbZSArIDNdID0gMjU1ICYgdCkpCiAgICAgICAgICAgICAgICAgIDogSSh0aGlzLCB0LCBlLCAhMSksCiAgICAgICAgICAgICAgICBlICsgNAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZUludExFID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAoKCh0ID0gK3QpLCAoZSB8PSAwKSwgIW4pKSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IE1hdGgucG93KDIsIDggKiByIC0gMSk7CiAgICAgICAgICAgICAgICBNKHRoaXMsIHQsIGUsIHIsIGkgLSAxLCAtaSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBvID0gMCwKICAgICAgICAgICAgICAgIHMgPSAxLAogICAgICAgICAgICAgICAgdSA9IDA7CiAgICAgICAgICAgICAgZm9yICh0aGlzW2VdID0gMjU1ICYgdDsgKytvIDwgciAmJiAocyAqPSAyNTYpOyApCiAgICAgICAgICAgICAgICB0IDwgMCAmJiAwID09PSB1ICYmIDAgIT09IHRoaXNbZSArIG8gLSAxXSAmJiAodSA9IDEpLCAodGhpc1tlICsgb10gPSAoKCh0IC8gcykgPj4gMCkgLSB1KSAmIDI1NSk7CiAgICAgICAgICAgICAgcmV0dXJuIGUgKyByCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUud3JpdGVJbnRCRSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgICAgICAgaWYgKCgodCA9ICt0KSwgKGUgfD0gMCksICFuKSkgewogICAgICAgICAgICAgICAgdmFyIGkgPSBNYXRoLnBvdygyLCA4ICogciAtIDEpOwogICAgICAgICAgICAgICAgTSh0aGlzLCB0LCBlLCByLCBpIC0gMSwgLWkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgbyA9IHIgLSAxLAogICAgICAgICAgICAgICAgcyA9IDEsCiAgICAgICAgICAgICAgICB1ID0gMDsKICAgICAgICAgICAgICBmb3IgKHRoaXNbZSArIG9dID0gMjU1ICYgdDsgLS1vID49IDAgJiYgKHMgKj0gMjU2KTsgKQogICAgICAgICAgICAgICAgdCA8IDAgJiYgMCA9PT0gdSAmJiAwICE9PSB0aGlzW2UgKyBvICsgMV0gJiYgKHUgPSAxKSwgKHRoaXNbZSArIG9dID0gKCgodCAvIHMpID4+IDApIC0gdSkgJiAyNTUpOwogICAgICAgICAgICAgIHJldHVybiBlICsgcgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICh0ID0gK3QpLAogICAgICAgICAgICAgICAgKGUgfD0gMCksCiAgICAgICAgICAgICAgICByIHx8IE0odGhpcywgdCwgZSwgMSwgMTI3LCAtMTI4KSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCAodCA9IE1hdGguZmxvb3IodCkpLAogICAgICAgICAgICAgICAgdCA8IDAgJiYgKHQgPSAyNTUgKyB0ICsgMSksCiAgICAgICAgICAgICAgICAodGhpc1tlXSA9IDI1NSAmIHQpLAogICAgICAgICAgICAgICAgZSArIDEKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSArdCksCiAgICAgICAgICAgICAgICAoZSB8PSAwKSwKICAgICAgICAgICAgICAgIHIgfHwgTSh0aGlzLCB0LCBlLCAyLCAzMjc2NywgLTMyNzY4KSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICgodGhpc1tlXSA9IDI1NSAmIHQpLCAodGhpc1tlICsgMV0gPSB0ID4+PiA4KSkgOiB4KHRoaXMsIHQsIGUsICEwKSwKICAgICAgICAgICAgICAgIGUgKyAyCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlSW50MTZCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICh0ID0gK3QpLAogICAgICAgICAgICAgICAgKGUgfD0gMCksCiAgICAgICAgICAgICAgICByIHx8IE0odGhpcywgdCwgZSwgMiwgMzI3NjcsIC0zMjc2OCksCiAgICAgICAgICAgICAgICBhLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoKHRoaXNbZV0gPSB0ID4+PiA4KSwgKHRoaXNbZSArIDFdID0gMjU1ICYgdCkpIDogeCh0aGlzLCB0LCBlLCAhMSksCiAgICAgICAgICAgICAgICBlICsgMgogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZUludDMyTEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAodCA9ICt0KSwKICAgICAgICAgICAgICAgIChlIHw9IDApLAogICAgICAgICAgICAgICAgciB8fCBNKHRoaXMsIHQsIGUsIDQsIDIxNDc0ODM2NDcsIC0yMTQ3NDgzNjQ4KSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVAogICAgICAgICAgICAgICAgICA/ICgodGhpc1tlXSA9IDI1NSAmIHQpLCAodGhpc1tlICsgMV0gPSB0ID4+PiA4KSwgKHRoaXNbZSArIDJdID0gdCA+Pj4gMTYpLCAodGhpc1tlICsgM10gPSB0ID4+PiAyNCkpCiAgICAgICAgICAgICAgICAgIDogSSh0aGlzLCB0LCBlLCAhMCksCiAgICAgICAgICAgICAgICBlICsgNAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZUludDMyQkUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAodCA9ICt0KSwKICAgICAgICAgICAgICAgIChlIHw9IDApLAogICAgICAgICAgICAgICAgciB8fCBNKHRoaXMsIHQsIGUsIDQsIDIxNDc0ODM2NDcsIC0yMTQ3NDgzNjQ4KSwKICAgICAgICAgICAgICAgIHQgPCAwICYmICh0ID0gNDI5NDk2NzI5NSArIHQgKyAxKSwKICAgICAgICAgICAgICAgIGEuVFlQRURfQVJSQVlfU1VQUE9SVAogICAgICAgICAgICAgICAgICA/ICgodGhpc1tlXSA9IHQgPj4+IDI0KSwgKHRoaXNbZSArIDFdID0gdCA+Pj4gMTYpLCAodGhpc1tlICsgMl0gPSB0ID4+PiA4KSwgKHRoaXNbZSArIDNdID0gMjU1ICYgdCkpCiAgICAgICAgICAgICAgICAgIDogSSh0aGlzLCB0LCBlLCAhMSksCiAgICAgICAgICAgICAgICBlICsgNAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgIHJldHVybiBZKHRoaXMsIHQsIGUsICEwLCByKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGEucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFkodGhpcywgdCwgZSwgITEsIHIpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUud3JpdGVEb3VibGVMRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEwodGhpcywgdCwgZSwgITAsIHIpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUud3JpdGVEb3VibGVCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEwodGhpcywgdCwgZSwgITEsIHIpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoYS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgKHIgfHwgKHIgPSAwKSwKICAgICAgICAgICAgICAgIG4gfHwgMCA9PT0gbiB8fCAobiA9IHRoaXMubGVuZ3RoKSwKICAgICAgICAgICAgICAgIGUgPj0gdC5sZW5ndGggJiYgKGUgPSB0Lmxlbmd0aCksCiAgICAgICAgICAgICAgICBlIHx8IChlID0gMCksCiAgICAgICAgICAgICAgICBuID4gMCAmJiBuIDwgciAmJiAobiA9IHIpLAogICAgICAgICAgICAgICAgbiA9PT0gcikKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCB8fCAwID09PSB0aGlzLmxlbmd0aCkgcmV0dXJuIDAKICAgICAgICAgICAgICBpZiAoZSA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCd0YXJnZXRTdGFydCBvdXQgb2YgYm91bmRzJykKICAgICAgICAgICAgICBpZiAociA8IDAgfHwgciA+PSB0aGlzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZVN0YXJ0IG91dCBvZiBib3VuZHMnKQogICAgICAgICAgICAgIGlmIChuIDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3NvdXJjZUVuZCBvdXQgb2YgYm91bmRzJykKICAgICAgICAgICAgICBuID4gdGhpcy5sZW5ndGggJiYgKG4gPSB0aGlzLmxlbmd0aCksIHQubGVuZ3RoIC0gZSA8IG4gLSByICYmIChuID0gdC5sZW5ndGggLSBlICsgcik7CiAgICAgICAgICAgICAgdmFyIGksCiAgICAgICAgICAgICAgICBvID0gbiAtIHI7CiAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IHQgJiYgciA8IGUgJiYgZSA8IG4pIGZvciAoaSA9IG8gLSAxOyBpID49IDA7IC0taSkgdFtpICsgZV0gPSB0aGlzW2kgKyByXTsKICAgICAgICAgICAgICBlbHNlIGlmIChvIDwgMWUzIHx8ICFhLlRZUEVEX0FSUkFZX1NVUFBPUlQpIGZvciAoaSA9IDA7IGkgPCBvOyArK2kpIHRbaSArIGVdID0gdGhpc1tpICsgcl07CiAgICAgICAgICAgICAgZWxzZSBVaW50OEFycmF5LnByb3RvdHlwZS5zZXQuY2FsbCh0LCB0aGlzLnN1YmFycmF5KHIsIHIgKyBvKSwgZSk7CiAgICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChhLnByb3RvdHlwZS5maWxsID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgICBpZiAoJ3N0cmluZycgPT0gdHlwZW9mIHQpIHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgKCdzdHJpbmcnID09IHR5cGVvZiBlCiAgICAgICAgICAgICAgICAgICAgPyAoKG4gPSBlKSwgKGUgPSAwKSwgKHIgPSB0aGlzLmxlbmd0aCkpCiAgICAgICAgICAgICAgICAgICAgOiAnc3RyaW5nJyA9PSB0eXBlb2YgciAmJiAoKG4gPSByKSwgKHIgPSB0aGlzLmxlbmd0aCkpLAogICAgICAgICAgICAgICAgICAxID09PSB0Lmxlbmd0aCkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IHQuY2hhckNvZGVBdCgwKTsKICAgICAgICAgICAgICAgICAgaSA8IDI1NiAmJiAodCA9IGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gbiAmJiAnc3RyaW5nJyAhPSB0eXBlb2YgbikgdGhyb3cgbmV3IFR5cGVFcnJvcignZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZycpCiAgICAgICAgICAgICAgICBpZiAoJ3N0cmluZycgPT0gdHlwZW9mIG4gJiYgIWEuaXNFbmNvZGluZyhuKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIG4pCiAgICAgICAgICAgICAgfSBlbHNlICdudW1iZXInID09IHR5cGVvZiB0ICYmICh0ICY9IDI1NSk7CiAgICAgICAgICAgICAgaWYgKGUgPCAwIHx8IHRoaXMubGVuZ3RoIDwgZSB8fCB0aGlzLmxlbmd0aCA8IHIpIHRocm93IG5ldyBSYW5nZUVycm9yKCdPdXQgb2YgcmFuZ2UgaW5kZXgnKQogICAgICAgICAgICAgIGlmIChyIDw9IGUpIHJldHVybiB0aGlzCiAgICAgICAgICAgICAgdmFyIG87CiAgICAgICAgICAgICAgaWYgKCgoZSA+Pj49IDApLCAociA9IHZvaWQgMCA9PT0gciA/IHRoaXMubGVuZ3RoIDogciA+Pj4gMCksIHQgfHwgKHQgPSAwKSwgJ251bWJlcicgPT0gdHlwZW9mIHQpKQogICAgICAgICAgICAgICAgZm9yIChvID0gZTsgbyA8IHI7ICsrbykgdGhpc1tvXSA9IHQ7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcyA9IGEuaXNCdWZmZXIodCkgPyB0IDogayhuZXcgYSh0LCBuKS50b1N0cmluZygpKSwKICAgICAgICAgICAgICAgICAgdSA9IHMubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChvID0gMDsgbyA8IHIgLSBlOyArK28pIHRoaXNbbyArIGVdID0gc1tvICUgdV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIEQgPSAvW14rXC8wLTlBLVphLXotX10vZzsKICAgICAgICAgIGZ1bmN0aW9uIE4odCkgewogICAgICAgICAgICByZXR1cm4gdCA8IDE2ID8gJzAnICsgdC50b1N0cmluZygxNikgOiB0LnRvU3RyaW5nKDE2KQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gayh0LCBlKSB7CiAgICAgICAgICAgIHZhciByOwogICAgICAgICAgICBlID0gZSB8fCAxIC8gMDsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IHQubGVuZ3RoLCBpID0gbnVsbCwgbyA9IFtdLCBzID0gMDsgcyA8IG47ICsrcykgewogICAgICAgICAgICAgIGlmICgociA9IHQuY2hhckNvZGVBdChzKSkgPiA1NTI5NSAmJiByIDwgNTczNDQpIHsKICAgICAgICAgICAgICAgIGlmICghaSkgewogICAgICAgICAgICAgICAgICBpZiAociA+IDU2MzE5KSB7CiAgKGUgLT0gMykgPiAtMSAmJiBvLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAocyArIDEgPT09IG4pIHsKICAoZSAtPSAzKSA+IC0xICYmIG8ucHVzaCgyMzksIDE5MSwgMTg5KTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGkgPSByOwogICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHIgPCA1NjMyMCkgewogIChlIC09IDMpID4gLTEgJiYgby5wdXNoKDIzOSwgMTkxLCAxODkpLCAoaSA9IHIpOwogICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA9IDY1NTM2ICsgKCgoaSAtIDU1Mjk2KSA8PCAxMCkgfCAociAtIDU2MzIwKSk7CiAgICAgICAgICAgICAgfSBlbHNlIGkgJiYgKGUgLT0gMykgPiAtMSAmJiBvLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgaWYgKCgoaSA9IG51bGwpLCByIDwgMTI4KSkgewogICAgICAgICAgICAgICAgaWYgKChlIC09IDEpIDwgMCkgYnJlYWsKICAgICAgICAgICAgICAgIG8ucHVzaChyKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHIgPCAyMDQ4KSB7CiAgICAgICAgICAgICAgICBpZiAoKGUgLT0gMikgPCAwKSBicmVhawogICAgICAgICAgICAgICAgby5wdXNoKChyID4+IDYpIHwgMTkyLCAoNjMgJiByKSB8IDEyOCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyIDwgNjU1MzYpIHsKICAgICAgICAgICAgICAgIGlmICgoZSAtPSAzKSA8IDApIGJyZWFrCiAgICAgICAgICAgICAgICBvLnB1c2goKHIgPj4gMTIpIHwgMjI0LCAoKHIgPj4gNikgJiA2MykgfCAxMjgsICg2MyAmIHIpIHwgMTI4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCEociA8IDExMTQxMTIpKSB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY29kZSBwb2ludCcpCiAgICAgICAgICAgICAgICBpZiAoKGUgLT0gNCkgPCAwKSBicmVhawogICAgICAgICAgICAgICAgby5wdXNoKChyID4+IDE4KSB8IDI0MCwgKChyID4+IDEyKSAmIDYzKSB8IDEyOCwgKChyID4+IDYpICYgNjMpIHwgMTI4LCAoNjMgJiByKSB8IDEyOCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBqKHQpIHsKICAgICAgICAgICAgcmV0dXJuIG4udG9CeXRlQXJyYXkoCiAgICAgICAgICAgICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICh0ID0gKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQudHJpbSA/IHQudHJpbSgpIDogdC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCiAgICAgICAgICAgICAgICAgIH0pKHQpLnJlcGxhY2UoRCwgJycpKS5sZW5ndGggPCAyCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICAgICAgZm9yICg7IHQubGVuZ3RoICUgNCAhPSAwOyApIHQgKz0gJz0nOwogICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICB9KSh0KQogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB6KHQsIGUsIHIsIG4pIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuICYmICEoaSArIHIgPj0gZS5sZW5ndGggfHwgaSA+PSB0Lmxlbmd0aCk7ICsraSkgZVtpICsgcl0gPSB0W2ldOwogICAgICAgICAgICByZXR1cm4gaQogICAgICAgICAgfQogICAgICAgIH0uY2FsbCh0aGlzLCByKDgpKSk7CiAgICAgIH0sCiAgICAgIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHI7CiAgICAgICAgciA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0pKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHIgPSByIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCkgfHwgKDAsIGV2YWwpKCd0aGlzJyk7CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgJ29iamVjdCcgPT0gdHlwZW9mIHdpbmRvdyAmJiAociA9IHdpbmRvdyk7CiAgICAgICAgfQogICAgICAgIHQuZXhwb3J0cyA9IHI7CiAgICAgIH0sCiAgICAgIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgKGUuYnl0ZUxlbmd0aCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgZSA9IGYodCksCiAgICAgICAgICAgIHIgPSBlWzBdLAogICAgICAgICAgICBuID0gZVsxXTsKICAgICAgICAgIHJldHVybiAoMyAqIChyICsgbikpIC8gNCAtIG4KICAgICAgICB9KSwKICAgICAgICAgIChlLnRvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgICAgIHIgPSBmKHQpLAogICAgICAgICAgICAgICAgbiA9IHJbMF0sCiAgICAgICAgICAgICAgICBzID0gclsxXSwKICAgICAgICAgICAgICAgIHUgPSBuZXcgbygKICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgzICogKGUgKyByKSkgLyA0IC0gcgogICAgICAgICAgICAgICAgICB9KSgwLCBuLCBzKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIGEgPSAwLAogICAgICAgICAgICAgICAgaCA9IHMgPiAwID8gbiAtIDQgOiBuLAogICAgICAgICAgICAgICAgbCA9IDA7CiAgICAgICAgICAgICAgbCA8IGg7CiAgICAgICAgICAgICAgbCArPSA0CiAgICAgICAgICAgICkKICAgICAgICAgICAgICAoZSA9CiAgICAgICAgICAgICAgICAoaVt0LmNoYXJDb2RlQXQobCldIDw8IDE4KSB8CiAgICAgICAgICAgICAgICAoaVt0LmNoYXJDb2RlQXQobCArIDEpXSA8PCAxMikgfAogICAgICAgICAgICAgICAgKGlbdC5jaGFyQ29kZUF0KGwgKyAyKV0gPDwgNikgfAogICAgICAgICAgICAgICAgaVt0LmNoYXJDb2RlQXQobCArIDMpXSksCiAgICAgICAgICAgICAgICAodVthKytdID0gKGUgPj4gMTYpICYgMjU1KSwKICAgICAgICAgICAgICAgICh1W2ErK10gPSAoZSA+PiA4KSAmIDI1NSksCiAgICAgICAgICAgICAgICAodVthKytdID0gMjU1ICYgZSk7CiAgICAgICAgICAgIDIgPT09IHMgJiYgKChlID0gKGlbdC5jaGFyQ29kZUF0KGwpXSA8PCAyKSB8IChpW3QuY2hhckNvZGVBdChsICsgMSldID4+IDQpKSwgKHVbYSsrXSA9IDI1NSAmIGUpKTsKICAgICAgICAgICAgMSA9PT0gcyAmJgogICAgICAgICAgICAgICgoZSA9IChpW3QuY2hhckNvZGVBdChsKV0gPDwgMTApIHwgKGlbdC5jaGFyQ29kZUF0KGwgKyAxKV0gPDwgNCkgfCAoaVt0LmNoYXJDb2RlQXQobCArIDIpXSA+PiAyKSksCiAgICAgICAgICAgICAgKHVbYSsrXSA9IChlID4+IDgpICYgMjU1KSwKICAgICAgICAgICAgICAodVthKytdID0gMjU1ICYgZSkpOwogICAgICAgICAgICByZXR1cm4gdQogICAgICAgICAgfSksCiAgICAgICAgICAoZS5mcm9tQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgZSwgciA9IHQubGVuZ3RoLCBpID0gciAlIDMsIG8gPSBbXSwgcyA9IDAsIHUgPSByIC0gaTsgcyA8IHU7IHMgKz0gMTYzODMpCiAgICAgICAgICAgICAgby5wdXNoKGwodCwgcywgcyArIDE2MzgzID4gdSA/IHUgOiBzICsgMTYzODMpKTsKICAgICAgICAgICAgMSA9PT0gaQogICAgICAgICAgICAgID8gKChlID0gdFtyIC0gMV0pLCBvLnB1c2gobltlID4+IDJdICsgblsoZSA8PCA0KSAmIDYzXSArICc9PScpKQogICAgICAgICAgICAgIDogMiA9PT0gaSAmJgogICAgICAgICAgICAgICAgKChlID0gKHRbciAtIDJdIDw8IDgpICsgdFtyIC0gMV0pLCBvLnB1c2gobltlID4+IDEwXSArIG5bKGUgPj4gNCkgJiA2M10gKyBuWyhlIDw8IDIpICYgNjNdICsgJz0nKSk7CiAgICAgICAgICAgIHJldHVybiBvLmpvaW4oJycpCiAgICAgICAgICB9KTsKICAgICAgICBmb3IgKAogICAgICAgICAgdmFyIG4gPSBbXSwKICAgICAgICAgICAgaSA9IFtdLAogICAgICAgICAgICBvID0gJ3VuZGVmaW5lZCcgIT0gdHlwZW9mIFVpbnQ4QXJyYXkgPyBVaW50OEFycmF5IDogQXJyYXksCiAgICAgICAgICAgIHMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLycsCiAgICAgICAgICAgIHUgPSAwLAogICAgICAgICAgICBhID0gcy5sZW5ndGg7CiAgICAgICAgICB1IDwgYTsKICAgICAgICAgICsrdQogICAgICAgICkKICAgICAgICAgIChuW3VdID0gc1t1XSksIChpW3MuY2hhckNvZGVBdCh1KV0gPSB1KTsKICAgICAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgICAgIHZhciBlID0gdC5sZW5ndGg7CiAgICAgICAgICBpZiAoZSAlIDQgPiAwKSB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQnKQogICAgICAgICAgdmFyIHIgPSB0LmluZGV4T2YoJz0nKTsKICAgICAgICAgIHJldHVybiAtMSA9PT0gciAmJiAociA9IGUpLCBbciwgciA9PT0gZSA/IDAgOiA0IC0gKHIgJSA0KV0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaCh0KSB7CiAgICAgICAgICByZXR1cm4gblsodCA+PiAxOCkgJiA2M10gKyBuWyh0ID4+IDEyKSAmIDYzXSArIG5bKHQgPj4gNikgJiA2M10gKyBuWzYzICYgdF0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbCh0LCBlLCByKSB7CiAgICAgICAgICBmb3IgKHZhciBuLCBpID0gW10sIG8gPSBlOyBvIDwgcjsgbyArPSAzKQogICAgICAgICAgICAobiA9ICgodFtvXSA8PCAxNikgJiAxNjcxMTY4MCkgKyAoKHRbbyArIDFdIDw8IDgpICYgNjUyODApICsgKDI1NSAmIHRbbyArIDJdKSksIGkucHVzaChoKG4pKTsKICAgICAgICAgIHJldHVybiBpLmpvaW4oJycpCiAgICAgICAgfQogIChpWyctJy5jaGFyQ29kZUF0KDApXSA9IDYyKSwgKGlbJ18nLmNoYXJDb2RlQXQoMCldID0gNjMpOwogICAgICB9LAogICAgICBmdW5jdGlvbiAodCwgZSkgewogIChlLnJlYWQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgewogICAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIHUgPSA4ICogaSAtIG4gLSAxLAogICAgICAgICAgICBhID0gKDEgPDwgdSkgLSAxLAogICAgICAgICAgICBmID0gYSA+PiAxLAogICAgICAgICAgICBoID0gLTcsCiAgICAgICAgICAgIGwgPSByID8gaSAtIDEgOiAwLAogICAgICAgICAgICBjID0gciA/IC0xIDogMSwKICAgICAgICAgICAgcCA9IHRbZSArIGxdOwogICAgICAgICAgZm9yIChsICs9IGMsIG8gPSBwICYgKCgxIDw8IC1oKSAtIDEpLCBwID4+PSAtaCwgaCArPSB1OyBoID4gMDsgbyA9IDI1NiAqIG8gKyB0W2UgKyBsXSwgbCArPSBjLCBoIC09IDgpOwogICAgICAgICAgZm9yIChzID0gbyAmICgoMSA8PCAtaCkgLSAxKSwgbyA+Pj0gLWgsIGggKz0gbjsgaCA+IDA7IHMgPSAyNTYgKiBzICsgdFtlICsgbF0sIGwgKz0gYywgaCAtPSA4KTsKICAgICAgICAgIGlmICgwID09PSBvKSBvID0gMSAtIGY7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKG8gPT09IGEpIHJldHVybiBzID8gTmFOIDogKDEgLyAwKSAqIChwID8gLTEgOiAxKQogICAgICAgICAgICA7KHMgKz0gTWF0aC5wb3coMiwgbikpLCAobyAtPSBmKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAocCA/IC0xIDogMSkgKiBzICogTWF0aC5wb3coMiwgbyAtIG4pCiAgICAgICAgfSksCiAgICAgICAgICAoZS53cml0ZSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpLCBvKSB7CiAgICAgICAgICAgIHZhciBzLAogICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBmID0gOCAqIG8gLSBpIC0gMSwKICAgICAgICAgICAgICBoID0gKDEgPDwgZikgLSAxLAogICAgICAgICAgICAgIGwgPSBoID4+IDEsCiAgICAgICAgICAgICAgYyA9IDIzID09PSBpID8gTWF0aC5wb3coMiwgLTI0KSAtIE1hdGgucG93KDIsIC03NykgOiAwLAogICAgICAgICAgICAgIHAgPSBuID8gMCA6IG8gLSAxLAogICAgICAgICAgICAgIGcgPSBuID8gMSA6IC0xLAogICAgICAgICAgICAgIGQgPSBlIDwgMCB8fCAoMCA9PT0gZSAmJiAxIC8gZSA8IDApID8gMSA6IDA7CiAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgZSA9IE1hdGguYWJzKGUpLAogICAgICAgICAgICAgICAgaXNOYU4oZSkgfHwgZSA9PT0gMSAvIDAKICAgICAgICAgICAgICAgICAgPyAoKHUgPSBpc05hTihlKSA/IDEgOiAwKSwgKHMgPSBoKSkKICAgICAgICAgICAgICAgICAgOiAoKHMgPSBNYXRoLmZsb29yKE1hdGgubG9nKGUpIC8gTWF0aC5MTjIpKSwKICAgICAgICAgICAgICAgICAgICBlICogKGEgPSBNYXRoLnBvdygyLCAtcykpIDwgMSAmJiAocy0tLCAoYSAqPSAyKSksCiAgICAgICAgICAgICAgICAgICAgKGUgKz0gcyArIGwgPj0gMSA/IGMgLyBhIDogYyAqIE1hdGgucG93KDIsIDEgLSBsKSkgKiBhID49IDIgJiYgKHMrKywgKGEgLz0gMikpLAogICAgICAgICAgICAgICAgICAgIHMgKyBsID49IGgKICAgICAgICAgICAgICAgICAgICAgID8gKCh1ID0gMCksIChzID0gaCkpCiAgICAgICAgICAgICAgICAgICAgICA6IHMgKyBsID49IDEKICAgICAgICAgICAgICAgICAgICAgID8gKCh1ID0gKGUgKiBhIC0gMSkgKiBNYXRoLnBvdygyLCBpKSksIChzICs9IGwpKQogICAgICAgICAgICAgICAgICAgICAgOiAoKHUgPSBlICogTWF0aC5wb3coMiwgbCAtIDEpICogTWF0aC5wb3coMiwgaSkpLCAocyA9IDApKSk7CiAgICAgICAgICAgICAgaSA+PSA4OwogICAgICAgICAgICAgIHRbciArIHBdID0gMjU1ICYgdSwgcCArPSBnLCB1IC89IDI1NiwgaSAtPSA4CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGZvciAocyA9IChzIDw8IGkpIHwgdSwgZiArPSBpOyBmID4gMDsgdFtyICsgcF0gPSAyNTUgJiBzLCBwICs9IGcsIHMgLz0gMjU2LCBmIC09IDgpOwogICAgICAgICAgICB0W3IgKyBwIC0gZ10gfD0gMTI4ICogZDsKICAgICAgICAgIH0pOwogICAgICB9LAogICAgICBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByID0ge30udG9TdHJpbmc7CiAgICAgICAgdC5leHBvcnRzID0KICAgICAgICAgIEFycmF5LmlzQXJyYXkgfHwKICAgICAgICAgIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiAnW29iamVjdCBBcnJheV0nID09IHIuY2FsbCh0KQogICAgICAgICAgfTsKICAgICAgfSwKICAgICAgZnVuY3Rpb24gKGUsIHIpIHsKICAgICAgICBlLmV4cG9ydHMgPSB0OwogICAgICB9LAogICAgICBmdW5jdGlvbiAodCwgZSwgcikgewogIChmdW5jdGlvbiAodCkgewogICAgICAgICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgICAgICAgIGZvciAodmFyIHIgPSAwLCBuID0gdC5sZW5ndGggLSAxOyBuID49IDA7IG4tLSkgewogICAgICAgICAgICAgIHZhciBpID0gdFtuXTsKICAgICAgICAgICAgICAnLicgPT09IGkgPyB0LnNwbGljZShuLCAxKSA6ICcuLicgPT09IGkgPyAodC5zcGxpY2UobiwgMSksIHIrKykgOiByICYmICh0LnNwbGljZShuLCAxKSwgci0tKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZSkgZm9yICg7IHItLTsgcikgdC51bnNoaWZ0KCcuLicpOwogICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgfQogICAgICAgICAgdmFyIG4gPSAvXihcLz98KShbXHNcU10qPykoKD86XC57MSwyfXxbXlwvXSs/fCkoXC5bXi5cL10qfCkpKD86W1wvXSopJC8sCiAgICAgICAgICAgIGkgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBuLmV4ZWModCkuc2xpY2UoMSkKICAgICAgICAgICAgfTsKICAgICAgICAgIGZ1bmN0aW9uIG8odCwgZSkgewogICAgICAgICAgICBpZiAodC5maWx0ZXIpIHJldHVybiB0LmZpbHRlcihlKQogICAgICAgICAgICBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgZSh0W25dLCBuLCB0KSAmJiByLnB1c2godFtuXSk7CiAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICB9CiAgKGUucmVzb2x2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZm9yICh2YXIgZSA9ICcnLCBuID0gITEsIGkgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSA+PSAtMSAmJiAhbjsgaS0tKSB7CiAgICAgICAgICAgICAgdmFyIHMgPSBpID49IDAgPyBhcmd1bWVudHNbaV0gOiB0LmN3ZCgpOwogICAgICAgICAgICAgIGlmICgnc3RyaW5nJyAhPSB0eXBlb2YgcykgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnRzIHRvIHBhdGgucmVzb2x2ZSBtdXN0IGJlIHN0cmluZ3MnKQogICAgICAgICAgICAgIHMgJiYgKChlID0gcyArICcvJyArIGUpLCAobiA9ICcvJyA9PT0gcy5jaGFyQXQoMCkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIChlID0gcigKICAgICAgICAgICAgICAgIG8oZS5zcGxpdCgnLycpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gISF0CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICFuCiAgICAgICAgICAgICAgKS5qb2luKCcvJykpLAogICAgICAgICAgICAgIChuID8gJy8nIDogJycpICsgZSB8fCAnLicKICAgICAgICAgICAgKQogICAgICAgICAgfSksCiAgICAgICAgICAgIChlLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBlLmlzQWJzb2x1dGUodCksCiAgICAgICAgICAgICAgICBpID0gJy8nID09PSBzKHQsIC0xKTsKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKHQgPSByKAogICAgICAgICAgICAgICAgICBvKHQuc3BsaXQoJy8nKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gISF0CiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAhbgogICAgICAgICAgICAgICAgKS5qb2luKCcvJykpIHx8CiAgICAgICAgICAgICAgICAgIG4gfHwKICAgICAgICAgICAgICAgICAgKHQgPSAnLicpLAogICAgICAgICAgICAgICAgdCAmJiBpICYmICh0ICs9ICcvJyksCiAgICAgICAgICAgICAgICAobiA/ICcvJyA6ICcnKSArIHQKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAoZS5pc0Fic29sdXRlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gJy8nID09PSB0LmNoYXJBdCgwKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGUuam9pbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgdCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICAgICAgICAgICAgcmV0dXJuIGUubm9ybWFsaXplKAogICAgICAgICAgICAgICAgbyh0LCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgICAgICBpZiAoJ3N0cmluZycgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50cyB0byBwYXRoLmpvaW4gbXVzdCBiZSBzdHJpbmdzJykKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgIH0pLmpvaW4oJy8nKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChlLnJlbGF0aXZlID0gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdC5sZW5ndGggJiYgJycgPT09IHRbZV07IGUrKyk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciByID0gdC5sZW5ndGggLSAxOyByID49IDAgJiYgJycgPT09IHRbcl07IHItLSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZSA+IHIgPyBbXSA6IHQuc2xpY2UoZSwgciAtIGUgKyAxKQogICAgICAgICAgICAgIH0KICAodCA9IGUucmVzb2x2ZSh0KS5zdWJzdHIoMSkpLCAociA9IGUucmVzb2x2ZShyKS5zdWJzdHIoMSkpOwogICAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgICB2YXIgaSA9IG4odC5zcGxpdCgnLycpKSwgbyA9IG4oci5zcGxpdCgnLycpKSwgcyA9IE1hdGgubWluKGkubGVuZ3RoLCBvLmxlbmd0aCksIHUgPSBzLCBhID0gMDsKICAgICAgICAgICAgICAgIGEgPCBzOwogICAgICAgICAgICAgICAgYSsrCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgKGlbYV0gIT09IG9bYV0pIHsKICAgICAgICAgICAgICAgICAgdSA9IGE7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIGYgPSBbXTsKICAgICAgICAgICAgICBmb3IgKGEgPSB1OyBhIDwgaS5sZW5ndGg7IGErKykgZi5wdXNoKCcuLicpOwogICAgICAgICAgICAgIHJldHVybiAoZiA9IGYuY29uY2F0KG8uc2xpY2UodSkpKS5qb2luKCcvJykKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIChlLnNlcCA9ICcvJyksCiAgICAgICAgICAgIChlLmRlbGltaXRlciA9ICc6JyksCiAgICAgICAgICAgIChlLmRpcm5hbWUgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBlID0gaSh0KSwKICAgICAgICAgICAgICAgIHIgPSBlWzBdLAogICAgICAgICAgICAgICAgbiA9IGVbMV07CiAgICAgICAgICAgICAgcmV0dXJuIHIgfHwgbiA/IChuICYmIChuID0gbi5zdWJzdHIoMCwgbi5sZW5ndGggLSAxKSksIHIgKyBuKSA6ICcuJwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGUuYmFzZW5hbWUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgIHZhciByID0gaSh0KVsyXTsKICAgICAgICAgICAgICByZXR1cm4gZSAmJiByLnN1YnN0cigtMSAqIGUubGVuZ3RoKSA9PT0gZSAmJiAociA9IHIuc3Vic3RyKDAsIHIubGVuZ3RoIC0gZS5sZW5ndGgpKSwgcgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGUuZXh0bmFtZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGkodClbM10KICAgICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgcyA9CiAgICAgICAgICAgICdiJyA9PT0gJ2FiJy5zdWJzdHIoLTEpCiAgICAgICAgICAgICAgPyBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgICAgICAgICByZXR1cm4gdC5zdWJzdHIoZSwgcikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICA6IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlIDwgMCAmJiAoZSA9IHQubGVuZ3RoICsgZSksIHQuc3Vic3RyKGUsIHIpCiAgICAgICAgICAgICAgICB9OwogICAgICAgIH0uY2FsbCh0aGlzLCByKDE0KSkpOwogICAgICB9LAogICAgICBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciByLAogICAgICAgICAgbiwKICAgICAgICAgIGkgPSAodC5leHBvcnRzID0ge30pOwogICAgICAgIGZ1bmN0aW9uIG8oKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgICAgIGlmIChyID09PSBzZXRUaW1lb3V0KSByZXR1cm4gc2V0VGltZW91dCh0LCAwKQogICAgICAgICAgaWYgKChyID09PSBvIHx8ICFyKSAmJiBzZXRUaW1lb3V0KSByZXR1cm4gKHIgPSBzZXRUaW1lb3V0KSwgc2V0VGltZW91dCh0LCAwKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHIodCwgMCkKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gci5jYWxsKG51bGwsIHQsIDApCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gci5jYWxsKHRoaXMsIHQsIDApCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiBvOwogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICByID0gbzsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG4gPSAnZnVuY3Rpb24nID09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiBzOwogICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICBuID0gczsKICAgICAgICAgIH0KICAgICAgICB9KSgpOwogICAgICAgIHZhciBhLAogICAgICAgICAgZiA9IFtdLAogICAgICAgICAgaCA9ICExLAogICAgICAgICAgbCA9IC0xOwogICAgICAgIGZ1bmN0aW9uIGMoKSB7CiAgICAgICAgICBoICYmIGEgJiYgKChoID0gITEpLCBhLmxlbmd0aCA/IChmID0gYS5jb25jYXQoZikpIDogKGwgPSAtMSksIGYubGVuZ3RoICYmIHAoKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHAoKSB7CiAgICAgICAgICBpZiAoIWgpIHsKICAgICAgICAgICAgdmFyIHQgPSB1KGMpOwogICAgICAgICAgICBoID0gITA7CiAgICAgICAgICAgIGZvciAodmFyIGUgPSBmLmxlbmd0aDsgZTsgKSB7CiAgICAgICAgICAgICAgZm9yIChhID0gZiwgZiA9IFtdOyArK2wgPCBlOyApIGEgJiYgYVtsXS5ydW4oKQogICAgICAgICAgICAgIDsobCA9IC0xKSwgKGUgPSBmLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAoYSA9IG51bGwpLAogICAgICAgICAgICAgIChoID0gITEpLAogICAgICAgICAgICAgIChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgaWYgKG4gPT09IGNsZWFyVGltZW91dCkgcmV0dXJuIGNsZWFyVGltZW91dCh0KQogICAgICAgICAgICAgICAgaWYgKChuID09PSBzIHx8ICFuKSAmJiBjbGVhclRpbWVvdXQpIHJldHVybiAobiA9IGNsZWFyVGltZW91dCksIGNsZWFyVGltZW91dCh0KQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgbih0KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5jYWxsKG51bGwsIHQpCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5jYWxsKHRoaXMsIHQpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSh0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZyh0LCBlKSB7CiAgKHRoaXMuZnVuID0gdCksICh0aGlzLmFycmF5ID0gZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGQoKSB7fQogIChpLm5leHRUaWNrID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTsKICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIGVbciAtIDFdID0gYXJndW1lbnRzW3JdOwogICAgICAgICAgZi5wdXNoKG5ldyBnKHQsIGUpKSwgMSAhPT0gZi5sZW5ndGggfHwgaCB8fCB1KHApOwogICAgICAgIH0pLAogICAgICAgICAgKGcucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7CiAgICAgICAgICB9KSwKICAgICAgICAgIChpLnRpdGxlID0gJ2Jyb3dzZXInKSwKICAgICAgICAgIChpLmJyb3dzZXIgPSAhMCksCiAgICAgICAgICAoaS5lbnYgPSB7fSksCiAgICAgICAgICAoaS5hcmd2ID0gW10pLAogICAgICAgICAgKGkudmVyc2lvbiA9ICcnKSwKICAgICAgICAgIChpLnZlcnNpb25zID0ge30pLAogICAgICAgICAgKGkub24gPSBkKSwKICAgICAgICAgIChpLmFkZExpc3RlbmVyID0gZCksCiAgICAgICAgICAoaS5vbmNlID0gZCksCiAgICAgICAgICAoaS5vZmYgPSBkKSwKICAgICAgICAgIChpLnJlbW92ZUxpc3RlbmVyID0gZCksCiAgICAgICAgICAoaS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBkKSwKICAgICAgICAgIChpLmVtaXQgPSBkKSwKICAgICAgICAgIChpLnByZXBlbmRMaXN0ZW5lciA9IGQpLAogICAgICAgICAgKGkucHJlcGVuZE9uY2VMaXN0ZW5lciA9IGQpLAogICAgICAgICAgKGkubGlzdGVuZXJzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgICB9KSwKICAgICAgICAgIChpLmJpbmRpbmcgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJykKICAgICAgICAgIH0pLAogICAgICAgICAgKGkuY3dkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gJy8nCiAgICAgICAgICB9KSwKICAgICAgICAgIChpLmNoZGlyID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKQogICAgICAgICAgfSksCiAgICAgICAgICAoaS51bWFzayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgIH0pOwogICAgICB9LAogICAgXSkKICB9KTsKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgY29uc3QgdW5wYWNrQnJpZGdlID0gV29ya2VyU2NvcGUudW5wYWNrQnJpZGdlOwoKICBsZXQgdW5wYWNrOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS11bnBhY2stLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBpbml0dW5wYWNrID0gZnVuY3Rpb24gKGJ1ZmZlcikgewogICAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGhhcyBiZWVuIF9jYXJlZnVsbHlfIG1vZGlmaWVkIGJ5IGhhbmQuCiAgICAvLyBEdWUgdG8gV2ViUGFjayBlbWJlZGRpbmcgdGhpcyBzY3JpcHQgaW50byB0aGUgWmVhIGVuZ2luZQogICAgLy8gYnVpbGQsIGNlcnRhaW4gZmVhdHVyZXMgYnJva2UuCiAgICAvLyBUaGVyZSB3YXMgY29kZSB0byBoYW5kbGUgbG9hZGluZyBpbiBhIG5vZGVKUyBjb250ZXh0LCB0aGF0IHRyaWVkIHRvIGltcG9ydCgiZnMiKQogICAgLy8gV2ViUGFjayBrZXB0cyB0cmlwcGluZyB1cCBvbiB0aGF0IGNvZGUgaW4gaXRzIHN0YXRpYyBhbmFseXNpcyBvZiB0aGUgY29kZSwgc28KICAgIC8vIEkgY2FyZWZ1bGx5IHJlbW92ZWQgaXQuCiAgICAvLyBUaGUgZ2xvYmFsIHNjb3BlIG9mIHRoZSBzY3JpcHQgc2VlbXMgdG8gYmUgZGlmZmVyZW50LCBzbyB1bnBhY2tCcmlkZ2Ugd2FzIG5vdCBhdmFpbGFibGUuCiAgICAvLyBUaGUgdW5wYWNrQnJpZGdlIGNvZGUgYXNzaWducyB1bnBhY2tCcmlkZ2UgdG8gdGhlIHBhc3NlZCBpbiBzY29wZSwgd2hpY2ggaXMgJ3RoaXMnLCBidXQgdGhhdAogICAgLy8gc2NvcGUgaXNuJ3QgYXZhaWxhYmxlIGluc2lkZSB0aGlzICd1bnBhY2snIGZ1bmN0aW9uLgogICAgY29uc3QgdW5wYWNrID0gTW9kdWxlOwoKICAgIC8vIE5vdGU6IHRoZSBmb2xsb3dpbmcgaXMgdGhlIFVSTCBvZiB0aGUgdW5wYWNrLndhc20gZmlsZSBpbiBvdXIgWmVhRW5naW5lIHByb2plY3Qgb24gb3VyCiAgICAvLyBzZXJ2ZXIuIElkZWFsbHkgd2UgY291bGQgdXNlIGEgcmVsYXRpdmUgcGF0aCBmcm9tIHRoZSBaZWFFbmdpbmUgZmlsZSwgYnV0CiAgICAvLyB0aGF0IGlzbid0IHBvc3NpYmxlIHlldC4gKFRPRE86IEFzayBNYXVybyBhYm91dCB0aGlzKQogICAgY29uc3QgY3JlZGVudGlhbHMgPSAnb21pdCc7CgogICAgdmFyIEV4dCA9IHVucGFja0JyaWRnZS5FeHQ7CiAgICB2YXIganNBUEkgPSB7CiAgICAgIG9wZW46IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gRXh0LmN1cnJlbnQub3Blbi5hcHBseShFeHQuY3VycmVudCwgYXJndW1lbnRzKQogICAgICB9LAogICAgICBjbG9zZTogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBFeHQuY3VycmVudC5jbG9zZS5hcHBseShFeHQuY3VycmVudCwgYXJndW1lbnRzKQogICAgICB9LAogICAgICByZWFkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIEV4dC5jdXJyZW50LnJlYWQuYXBwbHkoRXh0LmN1cnJlbnQsIGFyZ3VtZW50cykKICAgICAgfSwKICAgICAgd3JpdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gRXh0LmN1cnJlbnQud3JpdGUuYXBwbHkoRXh0LmN1cnJlbnQsIGFyZ3VtZW50cykKICAgICAgfSwKICAgICAgdGVsbDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBFeHQuY3VycmVudC50ZWxsLmFwcGx5KEV4dC5jdXJyZW50LCBhcmd1bWVudHMpCiAgICAgIH0sCiAgICAgIHNlZWs6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gRXh0LmN1cnJlbnQuc2Vlay5hcHBseShFeHQuY3VycmVudCwgYXJndW1lbnRzKQogICAgICB9LAogICAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gRXh0LmN1cnJlbnQuY3JlYXRlLmFwcGx5KEV4dC5jdXJyZW50LCBhcmd1bWVudHMpCiAgICAgIH0sCiAgICB9OwogICAgdmFyIG1vZHVsZU92ZXJyaWRlcyA9IHt9OwogICAgdmFyIGtleTsKICAgIGZvciAoa2V5IGluIE1vZHVsZSkgewogICAgICBpZiAoTW9kdWxlLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICBtb2R1bGVPdmVycmlkZXNba2V5XSA9IE1vZHVsZVtrZXldOwogICAgICB9CiAgICB9CiAgICBNb2R1bGVbJ3dhc21CaW5hcnknXSA9IGJ1ZmZlcjsKICAgIE1vZHVsZVsnYXJndW1lbnRzJ10gPSBbXTsKICAgIE1vZHVsZVsndGhpc1Byb2dyYW0nXSA9ICcuL3RoaXMucHJvZ3JhbSc7CiAgICBNb2R1bGVbJ3F1aXQnXSA9IGZ1bmN0aW9uIChzdGF0dXMsIHRvVGhyb3cpIHsKICAgICAgdGhyb3cgdG9UaHJvdwogICAgfTsKICAgIE1vZHVsZVsncHJlUnVuJ10gPSBbXTsKICAgIE1vZHVsZVsncG9zdFJ1biddID0gW107CiAgICB2YXIgRU5WSVJPTk1FTlRfSVNfV0VCID0gZmFsc2U7CiAgICB2YXIgRU5WSVJPTk1FTlRfSVNfV09SS0VSID0gZmFsc2U7CiAgICB2YXIgRU5WSVJPTk1FTlRfSVNfTk9ERSA9IGZhbHNlOwogICAgaWYgKE1vZHVsZVsnRU5WSVJPTk1FTlQnXSkgewogICAgICBpZiAoTW9kdWxlWydFTlZJUk9OTUVOVCddID09PSAnV0VCJykgewogICAgICAgIEVOVklST05NRU5UX0lTX1dFQiA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoTW9kdWxlWydFTlZJUk9OTUVOVCddID09PSAnV09SS0VSJykgewogICAgICAgIEVOVklST05NRU5UX0lTX1dPUktFUiA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoTW9kdWxlWydFTlZJUk9OTUVOVCddID09PSAnTk9ERScpIHsKICAgICAgICBFTlZJUk9OTUVOVF9JU19OT0RFID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChNb2R1bGVbJ0VOVklST05NRU5UJ10gPT09ICdTSEVMTCcpIDsgZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNb2R1bGVbJ0VOVklST05NRU5UJ10gdmFsdWUgaXMgbm90IHZhbGlkLiBtdXN0IGJlIG9uZSBvZjogV0VCfFdPUktFUnxOT0RFfFNIRUxMLiIpCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIEVOVklST05NRU5UX0lTX1dFQiA9IHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnOwogICAgICBFTlZJUk9OTUVOVF9JU19XT1JLRVIgPSB0eXBlb2YgaW1wb3J0U2NyaXB0cyA9PT0gJ2Z1bmN0aW9uJzsKICAgICAgRU5WSVJPTk1FTlRfSVNfTk9ERSA9CiAgICAgICAgdHlwZW9mIHByb2Nlc3MgPT09ICdvYmplY3QnICYmIHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nICYmICFFTlZJUk9OTUVOVF9JU19XRUIgJiYgIUVOVklST05NRU5UX0lTX1dPUktFUjsKICAgIH0KICAgIGlmIChFTlZJUk9OTUVOVF9JU19XRUIgfHwgRU5WSVJPTk1FTlRfSVNfV09SS0VSKSB7CiAgICAgIE1vZHVsZVsncmVhZCddID0gZnVuY3Rpb24gc2hlbGxfcmVhZCh1cmwpIHsKICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgZmFsc2UpOwogICAgICAgIHhoci5zZW5kKG51bGwpOwogICAgICAgIHJldHVybiB4aHIucmVzcG9uc2VUZXh0CiAgICAgIH07CiAgICAgIGlmIChFTlZJUk9OTUVOVF9JU19XT1JLRVIpIHsKICAgICAgICBNb2R1bGVbJ3JlYWRCaW5hcnknXSA9IGZ1bmN0aW9uIHJlYWRCaW5hcnkodXJsKSB7CiAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCBmYWxzZSk7CiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2FycmF5YnVmZmVyJzsKICAgICAgICAgIHhoci5zZW5kKG51bGwpOwogICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHhoci5yZXNwb25zZSkKICAgICAgICB9OwogICAgICB9CiAgICAgIE1vZHVsZVsncmVhZEFzeW5jJ10gPSBmdW5jdGlvbiByZWFkQXN5bmModXJsLCBvbmxvYWQsIG9uZXJyb3IpIHsKICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7CiAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uIHhocl9vbmxvYWQoKSB7CiAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDAgfHwgKHhoci5zdGF0dXMgPT0gMCAmJiB4aHIucmVzcG9uc2UpKSB7CiAgICAgICAgICAgIG9ubG9hZCh4aHIucmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICAgIG9uZXJyb3IoKTsKICAgICAgICB9OwogICAgICAgIHhoci5vbmVycm9yID0gb25lcnJvcjsKICAgICAgICB4aHIuc2VuZChudWxsKTsKICAgICAgfTsKICAgICAgTW9kdWxlWydzZXRXaW5kb3dUaXRsZSddID0gZnVuY3Rpb24gKHRpdGxlKSB7CiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKICAgICAgfTsKICAgIH0KICAgIE1vZHVsZVsncHJpbnQnXSA9CiAgICAgIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiB0eXBlb2YgcHJpbnQgIT09ICd1bmRlZmluZWQnID8gcHJpbnQgOiBudWxsOwogICAgTW9kdWxlWydwcmludEVyciddID0KICAgICAgdHlwZW9mIHByaW50RXJyICE9PSAndW5kZWZpbmVkJwogICAgICAgID8gcHJpbnRFcnIKICAgICAgICA6ICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS53YXJuLmJpbmQoY29uc29sZSkpIHx8IE1vZHVsZVsncHJpbnQnXTsKICAgIE1vZHVsZS5wcmludCA9IE1vZHVsZVsncHJpbnQnXTsKICAgIE1vZHVsZS5wcmludEVyciA9IE1vZHVsZVsncHJpbnRFcnInXTsKICAgIGZvciAoa2V5IGluIG1vZHVsZU92ZXJyaWRlcykgewogICAgICBpZiAobW9kdWxlT3ZlcnJpZGVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICBNb2R1bGVba2V5XSA9IG1vZHVsZU92ZXJyaWRlc1trZXldOwogICAgICB9CiAgICB9CiAgICBtb2R1bGVPdmVycmlkZXMgPSB1bmRlZmluZWQ7CiAgICB2YXIgU1RBQ0tfQUxJR04gPSAxNjsKICAgIGZ1bmN0aW9uIHN0YXRpY0FsbG9jKHNpemUpIHsKICAgICAgYXNzZXJ0KCFzdGF0aWNTZWFsZWQpOwogICAgICB2YXIgcmV0ID0gU1RBVElDVE9QOwogICAgICBTVEFUSUNUT1AgPSAoU1RBVElDVE9QICsgc2l6ZSArIDE1KSAmIC0xNjsKICAgICAgcmV0dXJuIHJldAogICAgfQogICAgZnVuY3Rpb24gZHluYW1pY0FsbG9jKHNpemUpIHsKICAgICAgYXNzZXJ0KERZTkFNSUNUT1BfUFRSKTsKICAgICAgdmFyIHJldCA9IEhFQVAzMltEWU5BTUlDVE9QX1BUUiA+PiAyXTsKICAgICAgdmFyIGVuZCA9IChyZXQgKyBzaXplICsgMTUpICYgLTE2OwogICAgICBIRUFQMzJbRFlOQU1JQ1RPUF9QVFIgPj4gMl0gPSBlbmQ7CiAgICAgIGlmIChlbmQgPj0gVE9UQUxfTUVNT1JZKSB7CiAgICAgICAgdmFyIHN1Y2Nlc3MgPSBlbmxhcmdlTWVtb3J5KCk7CiAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICBIRUFQMzJbRFlOQU1JQ1RPUF9QVFIgPj4gMl0gPSByZXQ7CiAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBmdW5jdGlvbiBhbGlnbk1lbW9yeShzaXplLCBmYWN0b3IpIHsKICAgICAgaWYgKCFmYWN0b3IpIGZhY3RvciA9IFNUQUNLX0FMSUdOOwogICAgICB2YXIgcmV0ID0gKHNpemUgPSBNYXRoLmNlaWwoc2l6ZSAvIGZhY3RvcikgKiBmYWN0b3IpOwogICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBmdW5jdGlvbiBnZXROYXRpdmVUeXBlU2l6ZSh0eXBlKSB7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ2kxJzoKICAgICAgICBjYXNlICdpOCc6CiAgICAgICAgICByZXR1cm4gMQogICAgICAgIGNhc2UgJ2kxNic6CiAgICAgICAgICByZXR1cm4gMgogICAgICAgIGNhc2UgJ2kzMic6CiAgICAgICAgICByZXR1cm4gNAogICAgICAgIGNhc2UgJ2k2NCc6CiAgICAgICAgICByZXR1cm4gOAogICAgICAgIGNhc2UgJ2Zsb2F0JzoKICAgICAgICAgIHJldHVybiA0CiAgICAgICAgY2FzZSAnZG91YmxlJzoKICAgICAgICAgIHJldHVybiA4CiAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgaWYgKHR5cGVbdHlwZS5sZW5ndGggLSAxXSA9PT0gJyonKSB7CiAgICAgICAgICAgIHJldHVybiA0CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVbMF0gPT09ICdpJykgewogICAgICAgICAgICB2YXIgYml0cyA9IHBhcnNlSW50KHR5cGUuc3Vic3RyKDEpKTsKICAgICAgICAgICAgYXNzZXJ0KGJpdHMgJSA4ID09PSAwKTsKICAgICAgICAgICAgcmV0dXJuIGJpdHMgLyA4CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbmV3IEFycmF5KDApOwogICAgdmFyIEdMT0JBTF9CQVNFID0gMTAyNDsKICAgIHZhciBBQk9SVCA9IDA7CiAgICBmdW5jdGlvbiBhc3NlcnQoY29uZGl0aW9uLCB0ZXh0KSB7CiAgICAgIGlmICghY29uZGl0aW9uKSB7CiAgICAgICAgYWJvcnQoJ0Fzc2VydGlvbiBmYWlsZWQ6ICcgKyB0ZXh0KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2V0VmFsdWUocHRyLCB2YWx1ZSwgdHlwZSwgbm9TYWZlKSB7CiAgICAgIHR5cGUgPSB0eXBlIHx8ICdpOCc7CiAgICAgIGlmICh0eXBlLmNoYXJBdCh0eXBlLmxlbmd0aCAtIDEpID09PSAnKicpIHR5cGUgPSAnaTMyJzsKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnaTEnOgogICAgICAgICAgSEVBUDhbcHRyID4+IDBdID0gdmFsdWU7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2k4JzoKICAgICAgICAgIEhFQVA4W3B0ciA+PiAwXSA9IHZhbHVlOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpMTYnOgogICAgICAgICAgSEVBUDE2W3B0ciA+PiAxXSA9IHZhbHVlOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpMzInOgogICAgICAgICAgSEVBUDMyW3B0ciA+PiAyXSA9IHZhbHVlOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpNjQnOgogICh0ZW1wSTY0ID0gWwogICAgICAgICAgICB2YWx1ZSA+Pj4gMCwKICAgICAgICAgICAgKCh0ZW1wRG91YmxlID0gdmFsdWUpLAogICAgICAgICAgICArTWF0aF9hYnModGVtcERvdWJsZSkgPj0gMQogICAgICAgICAgICAgID8gdGVtcERvdWJsZSA+IDAKICAgICAgICAgICAgICAgID8gKE1hdGhfbWluKCtNYXRoX2Zsb29yKHRlbXBEb3VibGUgLyA0Mjk0OTY3Mjk2KSwgNDI5NDk2NzI5NSkgfCAwKSA+Pj4gMAogICAgICAgICAgICAgICAgOiB+fitNYXRoX2NlaWwoKHRlbXBEb3VibGUgLSArKH5+dGVtcERvdWJsZSA+Pj4gMCkpIC8gNDI5NDk2NzI5NikgPj4+IDAKICAgICAgICAgICAgICA6IDApLAogICAgICAgICAgXSksCiAgICAgICAgICAgIChIRUFQMzJbcHRyID4+IDJdID0gdGVtcEk2NFswXSksCiAgICAgICAgICAgIChIRUFQMzJbKHB0ciArIDQpID4+IDJdID0gdGVtcEk2NFsxXSk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2Zsb2F0JzoKICAgICAgICAgIEhFQVBGMzJbcHRyID4+IDJdID0gdmFsdWU7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2RvdWJsZSc6CiAgICAgICAgICBIRUFQRjY0W3B0ciA+PiAzXSA9IHZhbHVlOwogICAgICAgICAgYnJlYWsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYWJvcnQoJ2ludmFsaWQgdHlwZSBmb3Igc2V0VmFsdWU6ICcgKyB0eXBlKTsKICAgICAgfQogICAgfQogICAgdmFyIEFMTE9DX05PUk1BTCA9IDA7CiAgICB2YXIgQUxMT0NfU1RBVElDID0gMjsKICAgIHZhciBBTExPQ19OT05FID0gNDsKICAgIGZ1bmN0aW9uIGFsbG9jYXRlKHNsYWIsIHR5cGVzLCBhbGxvY2F0b3IsIHB0cikgewogICAgICB2YXIgemVyb2luaXQsIHNpemU7CiAgICAgIGlmICh0eXBlb2Ygc2xhYiA9PT0gJ251bWJlcicpIHsKICAgICAgICB6ZXJvaW5pdCA9IHRydWU7CiAgICAgICAgc2l6ZSA9IHNsYWI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgemVyb2luaXQgPSBmYWxzZTsKICAgICAgICBzaXplID0gc2xhYi5sZW5ndGg7CiAgICAgIH0KICAgICAgdmFyIHNpbmdsZVR5cGUgPSB0eXBlb2YgdHlwZXMgPT09ICdzdHJpbmcnID8gdHlwZXMgOiBudWxsOwogICAgICB2YXIgcmV0OwogICAgICBpZiAoYWxsb2NhdG9yID09IEFMTE9DX05PTkUpIHsKICAgICAgICByZXQgPSBwdHI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0ID0gW3R5cGVvZiBfbWFsbG9jID09PSAnZnVuY3Rpb24nID8gX21hbGxvYyA6IHN0YXRpY0FsbG9jLCBzdGFja0FsbG9jLCBzdGF0aWNBbGxvYywgZHluYW1pY0FsbG9jXVsKICAgICAgICAgIGFsbG9jYXRvciA9PT0gdW5kZWZpbmVkID8gQUxMT0NfU1RBVElDIDogYWxsb2NhdG9yCiAgICAgICAgXShNYXRoLm1heChzaXplLCBzaW5nbGVUeXBlID8gMSA6IHR5cGVzLmxlbmd0aCkpOwogICAgICB9CiAgICAgIGlmICh6ZXJvaW5pdCkgewogICAgICAgIHZhciBzdG9wOwogICAgICAgIHB0ciA9IHJldDsKICAgICAgICBhc3NlcnQoKHJldCAmIDMpID09IDApOwogICAgICAgIHN0b3AgPSByZXQgKyAoc2l6ZSAmIH4zKTsKICAgICAgICBmb3IgKDsgcHRyIDwgc3RvcDsgcHRyICs9IDQpIHsKICAgICAgICAgIEhFQVAzMltwdHIgPj4gMl0gPSAwOwogICAgICAgIH0KICAgICAgICBzdG9wID0gcmV0ICsgc2l6ZTsKICAgICAgICB3aGlsZSAocHRyIDwgc3RvcCkgewogICAgICAgICAgSEVBUDhbcHRyKysgPj4gMF0gPSAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0CiAgICAgIH0KICAgICAgaWYgKHNpbmdsZVR5cGUgPT09ICdpOCcpIHsKICAgICAgICBpZiAoc2xhYi5zdWJhcnJheSB8fCBzbGFiLnNsaWNlKSB7CiAgICAgICAgICBIRUFQVTguc2V0KHNsYWIsIHJldCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEhFQVBVOC5zZXQobmV3IFVpbnQ4QXJyYXkoc2xhYiksIHJldCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQKICAgICAgfQogICAgICB2YXIgaSA9IDAsCiAgICAgICAgdHlwZSwKICAgICAgICB0eXBlU2l6ZSwKICAgICAgICBwcmV2aW91c1R5cGU7CiAgICAgIHdoaWxlIChpIDwgc2l6ZSkgewogICAgICAgIHZhciBjdXJyID0gc2xhYltpXTsKICAgICAgICB0eXBlID0gc2luZ2xlVHlwZSB8fCB0eXBlc1tpXTsKICAgICAgICBpZiAodHlwZSA9PT0gMCkgewogICAgICAgICAgaSsrOwogICAgICAgICAgY29udGludWUKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT0gJ2k2NCcpIHR5cGUgPSAnaTMyJzsKICAgICAgICBzZXRWYWx1ZShyZXQgKyBpLCBjdXJyLCB0eXBlKTsKICAgICAgICBpZiAocHJldmlvdXNUeXBlICE9PSB0eXBlKSB7CiAgICAgICAgICB0eXBlU2l6ZSA9IGdldE5hdGl2ZVR5cGVTaXplKHR5cGUpOwogICAgICAgICAgcHJldmlvdXNUeXBlID0gdHlwZTsKICAgICAgICB9CiAgICAgICAgaSArPSB0eXBlU2l6ZTsKICAgICAgfQogICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBmdW5jdGlvbiBQb2ludGVyX3N0cmluZ2lmeShwdHIsIGxlbmd0aCkgewogICAgICBpZiAobGVuZ3RoID09PSAwIHx8ICFwdHIpIHJldHVybiAnJwogICAgICB2YXIgaGFzVXRmID0gMDsKICAgICAgdmFyIHQ7CiAgICAgIHZhciBpID0gMDsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICB0ID0gSEVBUFU4WyhwdHIgKyBpKSA+PiAwXTsKICAgICAgICBoYXNVdGYgfD0gdDsKICAgICAgICBpZiAodCA9PSAwICYmICFsZW5ndGgpIGJyZWFrCiAgICAgICAgaSsrOwogICAgICAgIGlmIChsZW5ndGggJiYgaSA9PSBsZW5ndGgpIGJyZWFrCiAgICAgIH0KICAgICAgaWYgKCFsZW5ndGgpIGxlbmd0aCA9IGk7CiAgICAgIHZhciByZXQgPSAnJzsKICAgICAgaWYgKGhhc1V0ZiA8IDEyOCkgewogICAgICAgIHZhciBNQVhfQ0hVTksgPSAxMDI0OwogICAgICAgIHZhciBjdXJyOwogICAgICAgIHdoaWxlIChsZW5ndGggPiAwKSB7CiAgICAgICAgICBjdXJyID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIEhFQVBVOC5zdWJhcnJheShwdHIsIHB0ciArIE1hdGgubWluKGxlbmd0aCwgTUFYX0NIVU5LKSkpOwogICAgICAgICAgcmV0ID0gcmV0ID8gcmV0ICsgY3VyciA6IGN1cnI7CiAgICAgICAgICBwdHIgKz0gTUFYX0NIVU5LOwogICAgICAgICAgbGVuZ3RoIC09IE1BWF9DSFVOSzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldAogICAgICB9CiAgICAgIHJldHVybiBVVEY4VG9TdHJpbmcocHRyKQogICAgfQogICAgdmFyIFVURjhEZWNvZGVyID0gdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBUZXh0RGVjb2RlcigndXRmOCcpIDogdW5kZWZpbmVkOwogICAgZnVuY3Rpb24gVVRGOEFycmF5VG9TdHJpbmcodThBcnJheSwgaWR4KSB7CiAgICAgIHZhciBlbmRQdHIgPSBpZHg7CiAgICAgIHdoaWxlICh1OEFycmF5W2VuZFB0cl0pICsrZW5kUHRyOwogICAgICBpZiAoZW5kUHRyIC0gaWR4ID4gMTYgJiYgdThBcnJheS5zdWJhcnJheSAmJiBVVEY4RGVjb2RlcikgewogICAgICAgIHJldHVybiBVVEY4RGVjb2Rlci5kZWNvZGUodThBcnJheS5zdWJhcnJheShpZHgsIGVuZFB0cikpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHUwLCB1MSwgdTIsIHUzLCB1NCwgdTU7CiAgICAgICAgdmFyIHN0ciA9ICcnOwogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICB1MCA9IHU4QXJyYXlbaWR4KytdOwogICAgICAgICAgaWYgKCF1MCkgcmV0dXJuIHN0cgogICAgICAgICAgaWYgKCEodTAgJiAxMjgpKSB7CiAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KICAgICAgICAgIHUxID0gdThBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICAgIGlmICgodTAgJiAyMjQpID09IDE5MikgewogICAgICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKHUwICYgMzEpIDw8IDYpIHwgdTEpOwogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgfQogICAgICAgICAgdTIgPSB1OEFycmF5W2lkeCsrXSAmIDYzOwogICAgICAgICAgaWYgKCh1MCAmIDI0MCkgPT0gMjI0KSB7CiAgICAgICAgICAgIHUwID0gKCh1MCAmIDE1KSA8PCAxMikgfCAodTEgPDwgNikgfCB1MjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHUzID0gdThBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICAgICAgaWYgKCh1MCAmIDI0OCkgPT0gMjQwKSB7CiAgICAgICAgICAgICAgdTAgPSAoKHUwICYgNykgPDwgMTgpIHwgKHUxIDw8IDEyKSB8ICh1MiA8PCA2KSB8IHUzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHU0ID0gdThBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICAgICAgICBpZiAoKHUwICYgMjUyKSA9PSAyNDgpIHsKICAgICAgICAgICAgICAgIHUwID0gKCh1MCAmIDMpIDw8IDI0KSB8ICh1MSA8PCAxOCkgfCAodTIgPDwgMTIpIHwgKHUzIDw8IDYpIHwgdTQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHU1ID0gdThBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICAgICAgICAgIHUwID0gKCh1MCAmIDEpIDw8IDMwKSB8ICh1MSA8PCAyNCkgfCAodTIgPDwgMTgpIHwgKHUzIDw8IDEyKSB8ICh1NCA8PCA2KSB8IHU1OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHUwIDwgNjU1MzYpIHsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodTApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGNoID0gdTAgLSA2NTUzNjsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTYgfCAoY2ggPj4gMTApLCA1NjMyMCB8IChjaCAmIDEwMjMpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIFVURjhUb1N0cmluZyhwdHIpIHsKICAgICAgcmV0dXJuIFVURjhBcnJheVRvU3RyaW5nKEhFQVBVOCwgcHRyKQogICAgfQogICAgZnVuY3Rpb24gc3RyaW5nVG9VVEY4QXJyYXkoc3RyLCBvdXRVOEFycmF5LCBvdXRJZHgsIG1heEJ5dGVzVG9Xcml0ZSkgewogICAgICBpZiAoIShtYXhCeXRlc1RvV3JpdGUgPiAwKSkgcmV0dXJuIDAKICAgICAgdmFyIHN0YXJ0SWR4ID0gb3V0SWR4OwogICAgICB2YXIgZW5kSWR4ID0gb3V0SWR4ICsgbWF4Qnl0ZXNUb1dyaXRlIC0gMTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsKICAgICAgICB2YXIgdSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIGlmICh1ID49IDU1Mjk2ICYmIHUgPD0gNTczNDMpIHUgPSAoNjU1MzYgKyAoKHUgJiAxMDIzKSA8PCAxMCkpIHwgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAxMDIzKTsKICAgICAgICBpZiAodSA8PSAxMjcpIHsKICAgICAgICAgIGlmIChvdXRJZHggPj0gZW5kSWR4KSBicmVhawogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSB1OwogICAgICAgIH0gZWxzZSBpZiAodSA8PSAyMDQ3KSB7CiAgICAgICAgICBpZiAob3V0SWR4ICsgMSA+PSBlbmRJZHgpIGJyZWFrCiAgICAgICAgICBvdXRVOEFycmF5W291dElkeCsrXSA9IDE5MiB8ICh1ID4+IDYpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAodSAmIDYzKTsKICAgICAgICB9IGVsc2UgaWYgKHUgPD0gNjU1MzUpIHsKICAgICAgICAgIGlmIChvdXRJZHggKyAyID49IGVuZElkeCkgYnJlYWsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMjI0IHwgKHUgPj4gMTIpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAoKHUgPj4gNikgJiA2Myk7CiAgICAgICAgICBvdXRVOEFycmF5W291dElkeCsrXSA9IDEyOCB8ICh1ICYgNjMpOwogICAgICAgIH0gZWxzZSBpZiAodSA8PSAyMDk3MTUxKSB7CiAgICAgICAgICBpZiAob3V0SWR4ICsgMyA+PSBlbmRJZHgpIGJyZWFrCiAgICAgICAgICBvdXRVOEFycmF5W291dElkeCsrXSA9IDI0MCB8ICh1ID4+IDE4KTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDEyKSAmIDYzKTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDYpICYgNjMpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAodSAmIDYzKTsKICAgICAgICB9IGVsc2UgaWYgKHUgPD0gNjcxMDg4NjMpIHsKICAgICAgICAgIGlmIChvdXRJZHggKyA0ID49IGVuZElkeCkgYnJlYWsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMjQ4IHwgKHUgPj4gMjQpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAoKHUgPj4gMTgpICYgNjMpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAoKHUgPj4gMTIpICYgNjMpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAoKHUgPj4gNikgJiA2Myk7CiAgICAgICAgICBvdXRVOEFycmF5W291dElkeCsrXSA9IDEyOCB8ICh1ICYgNjMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAob3V0SWR4ICsgNSA+PSBlbmRJZHgpIGJyZWFrCiAgICAgICAgICBvdXRVOEFycmF5W291dElkeCsrXSA9IDI1MiB8ICh1ID4+IDMwKTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDI0KSAmIDYzKTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDE4KSAmIDYzKTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDEyKSAmIDYzKTsKICAgICAgICAgIG91dFU4QXJyYXlbb3V0SWR4KytdID0gMTI4IHwgKCh1ID4+IDYpICYgNjMpOwogICAgICAgICAgb3V0VThBcnJheVtvdXRJZHgrK10gPSAxMjggfCAodSAmIDYzKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgb3V0VThBcnJheVtvdXRJZHhdID0gMDsKICAgICAgcmV0dXJuIG91dElkeCAtIHN0YXJ0SWR4CiAgICB9CiAgICBmdW5jdGlvbiBzdHJpbmdUb1VURjgoc3RyLCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSkgewogICAgICByZXR1cm4gc3RyaW5nVG9VVEY4QXJyYXkoc3RyLCBIRUFQVTgsIG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKQogICAgfQogICAgZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEY4KHN0cikgewogICAgICB2YXIgbGVuID0gMDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsKICAgICAgICB2YXIgdSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIGlmICh1ID49IDU1Mjk2ICYmIHUgPD0gNTczNDMpIHUgPSAoNjU1MzYgKyAoKHUgJiAxMDIzKSA8PCAxMCkpIHwgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAxMDIzKTsKICAgICAgICBpZiAodSA8PSAxMjcpIHsKICAgICAgICAgICsrbGVuOwogICAgICAgIH0gZWxzZSBpZiAodSA8PSAyMDQ3KSB7CiAgICAgICAgICBsZW4gKz0gMjsKICAgICAgICB9IGVsc2UgaWYgKHUgPD0gNjU1MzUpIHsKICAgICAgICAgIGxlbiArPSAzOwogICAgICAgIH0gZWxzZSBpZiAodSA8PSAyMDk3MTUxKSB7CiAgICAgICAgICBsZW4gKz0gNDsKICAgICAgICB9IGVsc2UgaWYgKHUgPD0gNjcxMDg4NjMpIHsKICAgICAgICAgIGxlbiArPSA1OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZW4gKz0gNjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGxlbgogICAgfQogICAgdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBUZXh0RGVjb2RlcigndXRmLTE2bGUnKSA6IHVuZGVmaW5lZDsKICAgIGZ1bmN0aW9uIFVURjMyVG9TdHJpbmcocHRyKSB7CiAgICAgIHZhciBpID0gMDsKICAgICAgdmFyIHN0ciA9ICcnOwogICAgICB3aGlsZSAoMSkgewogICAgICAgIHZhciB1dGYzMiA9IEhFQVAzMlsocHRyICsgaSAqIDQpID4+IDJdOwogICAgICAgIGlmICh1dGYzMiA9PSAwKSByZXR1cm4gc3RyCiAgICAgICAgKytpOwogICAgICAgIGlmICh1dGYzMiA+PSA2NTUzNikgewogICAgICAgICAgdmFyIGNoID0gdXRmMzIgLSA2NTUzNjsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2IHwgKGNoID4+IDEwKSwgNTYzMjAgfCAoY2ggJiAxMDIzKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHV0ZjMyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVVRGOChzdHIpIHsKICAgICAgdmFyIHNpemUgPSBsZW5ndGhCeXRlc1VURjgoc3RyKSArIDE7CiAgICAgIHZhciByZXQgPSBfbWFsbG9jKHNpemUpOwogICAgICBpZiAocmV0KSBzdHJpbmdUb1VURjhBcnJheShzdHIsIEhFQVA4LCByZXQsIHNpemUpOwogICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBmdW5jdGlvbiBkZW1hbmdsZShmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jCiAgICB9CiAgICBmdW5jdGlvbiBkZW1hbmdsZUFsbCh0ZXh0KSB7CiAgICAgIHZhciByZWdleCA9IC9fX1pbXHdcZF9dKy9nOwogICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHJlZ2V4LCBmdW5jdGlvbiAoeCkgewogICAgICAgIHZhciB5ID0gZGVtYW5nbGUoeCk7CiAgICAgICAgcmV0dXJuIHggPT09IHkgPyB4IDogeCArICcgWycgKyB5ICsgJ10nCiAgICAgIH0pCiAgICB9CiAgICBmdW5jdGlvbiBqc1N0YWNrVHJhY2UoKSB7CiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoKTsKICAgICAgaWYgKCFlcnIuc3RhY2spIHsKICAgICAgICB0cnkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKDApCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgZXJyID0gZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlcnIuc3RhY2spIHsKICAgICAgICAgIHJldHVybiAnKG5vIHN0YWNrIHRyYWNlIGF2YWlsYWJsZSknCiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBlcnIuc3RhY2sudG9TdHJpbmcoKQogICAgfQogICAgZnVuY3Rpb24gc3RhY2tUcmFjZSgpIHsKICAgICAgdmFyIGpzID0ganNTdGFja1RyYWNlKCk7CiAgICAgIGlmIChNb2R1bGVbJ2V4dHJhU3RhY2tUcmFjZSddKSBqcyArPSAnXG4nICsgTW9kdWxlWydleHRyYVN0YWNrVHJhY2UnXSgpOwogICAgICByZXR1cm4gZGVtYW5nbGVBbGwoanMpCiAgICB9CiAgICB2YXIgV0FTTV9QQUdFX1NJWkUgPSA2NTUzNjsKICAgIHZhciBBU01KU19QQUdFX1NJWkUgPSAxNjc3NzIxNjsKICAgIHZhciBNSU5fVE9UQUxfTUVNT1JZID0gMTY3NzcyMTY7CiAgICBmdW5jdGlvbiBhbGlnblVwKHgsIG11bHRpcGxlKSB7CiAgICAgIGlmICh4ICUgbXVsdGlwbGUgPiAwKSB7CiAgICAgICAgeCArPSBtdWx0aXBsZSAtICh4ICUgbXVsdGlwbGUpOwogICAgICB9CiAgICAgIHJldHVybiB4CiAgICB9CiAgICB2YXIgYnVmZmVyLCBIRUFQOCwgSEVBUFU4LCBIRUFQMTYsIEhFQVBVMTYsIEhFQVAzMiwgSEVBUFUzMiwgSEVBUEYzMiwgSEVBUEY2NDsKICAgIGZ1bmN0aW9uIHVwZGF0ZUdsb2JhbEJ1ZmZlcihidWYpIHsKICAgICAgTW9kdWxlWydidWZmZXInXSA9IGJ1ZmZlciA9IGJ1ZjsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUdsb2JhbEJ1ZmZlclZpZXdzKCkgewogICAgICBNb2R1bGVbJ0hFQVA4J10gPSBIRUFQOCA9IG5ldyBJbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgTW9kdWxlWydIRUFQMTYnXSA9IEhFQVAxNiA9IG5ldyBJbnQxNkFycmF5KGJ1ZmZlcik7CiAgICAgIE1vZHVsZVsnSEVBUDMyJ10gPSBIRUFQMzIgPSBuZXcgSW50MzJBcnJheShidWZmZXIpOwogICAgICBNb2R1bGVbJ0hFQVBVOCddID0gSEVBUFU4ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgTW9kdWxlWydIRUFQVTE2J10gPSBIRUFQVTE2ID0gbmV3IFVpbnQxNkFycmF5KGJ1ZmZlcik7CiAgICAgIE1vZHVsZVsnSEVBUFUzMiddID0gSEVBUFUzMiA9IG5ldyBVaW50MzJBcnJheShidWZmZXIpOwogICAgICBNb2R1bGVbJ0hFQVBGMzInXSA9IEhFQVBGMzIgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlcik7CiAgICAgIE1vZHVsZVsnSEVBUEY2NCddID0gSEVBUEY2NCA9IG5ldyBGbG9hdDY0QXJyYXkoYnVmZmVyKTsKICAgIH0KICAgIHZhciBTVEFUSUNfQkFTRSwgU1RBVElDVE9QLCBzdGF0aWNTZWFsZWQ7CiAgICB2YXIgU1RBQ0tfQkFTRSwgU1RBQ0tUT1AsIFNUQUNLX01BWDsKICAgIHZhciBEWU5BTUlDX0JBU0UsIERZTkFNSUNUT1BfUFRSOwogICAgU1RBVElDX0JBU0UgPSBTVEFUSUNUT1AgPSBTVEFDS19CQVNFID0gU1RBQ0tUT1AgPSBTVEFDS19NQVggPSBEWU5BTUlDX0JBU0UgPSBEWU5BTUlDVE9QX1BUUiA9IDA7CiAgICBzdGF0aWNTZWFsZWQgPSBmYWxzZTsKICAgIGZ1bmN0aW9uIGFib3J0T25DYW5ub3RHcm93TWVtb3J5KCkgewogICAgICBhYm9ydCgKICAgICAgICAnQ2Fubm90IGVubGFyZ2UgbWVtb3J5IGFycmF5cy4gRWl0aGVyICgxKSBjb21waWxlIHdpdGggIC1zIFRPVEFMX01FTU9SWT1YICB3aXRoIFggaGlnaGVyIHRoYW4gdGhlIGN1cnJlbnQgdmFsdWUgJyArCiAgICAgICAgICBUT1RBTF9NRU1PUlkgKwogICAgICAgICAgJywgKDIpIGNvbXBpbGUgd2l0aCAgLXMgQUxMT1dfTUVNT1JZX0dST1dUSD0xICB3aGljaCBhbGxvd3MgaW5jcmVhc2luZyB0aGUgc2l6ZSBhdCBydW50aW1lLCBvciAoMykgaWYgeW91IHdhbnQgbWFsbG9jIHRvIHJldHVybiBOVUxMICgwKSBpbnN0ZWFkIG9mIHRoaXMgYWJvcnQsIGNvbXBpbGUgd2l0aCAgLXMgQUJPUlRJTkdfTUFMTE9DPTAgJwogICAgICApOwogICAgfQogICAgaWYgKCFNb2R1bGVbJ3JlYWxsb2NCdWZmZXInXSkKICAgICAgTW9kdWxlWydyZWFsbG9jQnVmZmVyJ10gPSBmdW5jdGlvbiAoc2l6ZSkgewogICAgICAgIHZhciByZXQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChBcnJheUJ1ZmZlci50cmFuc2ZlcikgewogICAgICAgICAgICByZXQgPSBBcnJheUJ1ZmZlci50cmFuc2ZlcihidWZmZXIsIHNpemUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9sZEhFQVA4ID0gSEVBUDg7CiAgICAgICAgICAgIHJldCA9IG5ldyBBcnJheUJ1ZmZlcihzaXplKTsKICAgICAgICAgICAgdmFyIHRlbXAgPSBuZXcgSW50OEFycmF5KHJldCk7CiAgICAgICAgICAgIHRlbXAuc2V0KG9sZEhFQVA4KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgdmFyIHN1Y2Nlc3MgPSBfZW1zY3JpcHRlbl9yZXBsYWNlX21lbW9yeShyZXQpOwogICAgICAgIGlmICghc3VjY2VzcykgcmV0dXJuIGZhbHNlCiAgICAgICAgcmV0dXJuIHJldAogICAgICB9OwogICAgZnVuY3Rpb24gZW5sYXJnZU1lbW9yeSgpIHsKICAgICAgdmFyIFBBR0VfTVVMVElQTEUgPSBNb2R1bGVbJ3VzaW5nV2FzbSddID8gV0FTTV9QQUdFX1NJWkUgOiBBU01KU19QQUdFX1NJWkU7CiAgICAgIHZhciBMSU1JVCA9IDIxNDc0ODM2NDggLSBQQUdFX01VTFRJUExFOwogICAgICBpZiAoSEVBUDMyW0RZTkFNSUNUT1BfUFRSID4+IDJdID4gTElNSVQpIHsKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICB2YXIgT0xEX1RPVEFMX01FTU9SWSA9IFRPVEFMX01FTU9SWTsKICAgICAgVE9UQUxfTUVNT1JZID0gTWF0aC5tYXgoVE9UQUxfTUVNT1JZLCBNSU5fVE9UQUxfTUVNT1JZKTsKICAgICAgd2hpbGUgKFRPVEFMX01FTU9SWSA8IEhFQVAzMltEWU5BTUlDVE9QX1BUUiA+PiAyXSkgewogICAgICAgIGlmIChUT1RBTF9NRU1PUlkgPD0gNTM2ODcwOTEyKSB7CiAgICAgICAgICBUT1RBTF9NRU1PUlkgPSBhbGlnblVwKDIgKiBUT1RBTF9NRU1PUlksIFBBR0VfTVVMVElQTEUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBUT1RBTF9NRU1PUlkgPSBNYXRoLm1pbihhbGlnblVwKCgzICogVE9UQUxfTUVNT1JZICsgMjE0NzQ4MzY0OCkgLyA0LCBQQUdFX01VTFRJUExFKSwgTElNSVQpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgcmVwbGFjZW1lbnQgPSBNb2R1bGVbJ3JlYWxsb2NCdWZmZXInXShUT1RBTF9NRU1PUlkpOwogICAgICBpZiAoIXJlcGxhY2VtZW50IHx8IHJlcGxhY2VtZW50LmJ5dGVMZW5ndGggIT0gVE9UQUxfTUVNT1JZKSB7CiAgICAgICAgVE9UQUxfTUVNT1JZID0gT0xEX1RPVEFMX01FTU9SWTsKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICB1cGRhdGVHbG9iYWxCdWZmZXIocmVwbGFjZW1lbnQpOwogICAgICB1cGRhdGVHbG9iYWxCdWZmZXJWaWV3cygpOwogICAgICByZXR1cm4gdHJ1ZQogICAgfQogICAgdmFyIGJ5dGVMZW5ndGg7CiAgICB0cnkgewogICAgICBieXRlTGVuZ3RoID0gRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEFycmF5QnVmZmVyLnByb3RvdHlwZSwgJ2J5dGVMZW5ndGgnKS5nZXQpOwogICAgICBieXRlTGVuZ3RoKG5ldyBBcnJheUJ1ZmZlcig0KSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGJ5dGVMZW5ndGggPSBmdW5jdGlvbiAoYnVmZmVyKSB7CiAgICAgICAgcmV0dXJuIGJ1ZmZlci5ieXRlTGVuZ3RoCiAgICAgIH07CiAgICB9CiAgICB2YXIgVE9UQUxfU1RBQ0sgPSBNb2R1bGVbJ1RPVEFMX1NUQUNLJ10gfHwgNTI0Mjg4MDsKICAgIHZhciBUT1RBTF9NRU1PUlkgPSBNb2R1bGVbJ1RPVEFMX01FTU9SWSddIHx8IDE2Nzc3MjE2OwogICAgaWYgKFRPVEFMX01FTU9SWSA8IFRPVEFMX1NUQUNLKQogICAgICBNb2R1bGUucHJpbnRFcnIoCiAgICAgICAgJ1RPVEFMX01FTU9SWSBzaG91bGQgYmUgbGFyZ2VyIHRoYW4gVE9UQUxfU1RBQ0ssIHdhcyAnICsgVE9UQUxfTUVNT1JZICsgJyEgKFRPVEFMX1NUQUNLPScgKyBUT1RBTF9TVEFDSyArICcpJwogICAgICApOwogICAgaWYgKE1vZHVsZVsnYnVmZmVyJ10pIHsKICAgICAgYnVmZmVyID0gTW9kdWxlWydidWZmZXInXTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICh0eXBlb2YgV2ViQXNzZW1ibHkgPT09ICdvYmplY3QnICYmIHR5cGVvZiBXZWJBc3NlbWJseS5NZW1vcnkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBNb2R1bGVbJ3dhc21NZW1vcnknXSA9IG5ldyBXZWJBc3NlbWJseS5NZW1vcnkoeyBpbml0aWFsOiBUT1RBTF9NRU1PUlkgLyBXQVNNX1BBR0VfU0laRSB9KTsKICAgICAgICBidWZmZXIgPSBNb2R1bGVbJ3dhc21NZW1vcnknXS5idWZmZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKFRPVEFMX01FTU9SWSk7CiAgICAgIH0KICAgICAgTW9kdWxlWydidWZmZXInXSA9IGJ1ZmZlcjsKICAgIH0KICAgIHVwZGF0ZUdsb2JhbEJ1ZmZlclZpZXdzKCk7CiAgICBmdW5jdGlvbiBnZXRUb3RhbE1lbW9yeSgpIHsKICAgICAgcmV0dXJuIFRPVEFMX01FTU9SWQogICAgfQogICAgSEVBUDMyWzBdID0gMTY2ODUwOTAyOTsKICAgIEhFQVAxNlsxXSA9IDI1NDU5OwogICAgaWYgKEhFQVBVOFsyXSAhPT0gMTE1IHx8IEhFQVBVOFszXSAhPT0gOTkpIHRocm93ICdSdW50aW1lIGVycm9yOiBleHBlY3RlZCB0aGUgc3lzdGVtIHRvIGJlIGxpdHRsZS1lbmRpYW4hJwogICAgZnVuY3Rpb24gY2FsbFJ1bnRpbWVDYWxsYmFja3MoY2FsbGJhY2tzKSB7CiAgICAgIHdoaWxlIChjYWxsYmFja3MubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBjYWxsYmFjayA9IGNhbGxiYWNrcy5zaGlmdCgpOwogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIHZhciBmdW5jID0gY2FsbGJhY2suZnVuYzsKICAgICAgICBpZiAodHlwZW9mIGZ1bmMgPT09ICdudW1iZXInKSB7CiAgICAgICAgICBpZiAoY2FsbGJhY2suYXJnID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgTW9kdWxlWydkeW5DYWxsX3YnXShmdW5jKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aSddKGZ1bmMsIGNhbGxiYWNrLmFyZyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZ1bmMoY2FsbGJhY2suYXJnID09PSB1bmRlZmluZWQgPyBudWxsIDogY2FsbGJhY2suYXJnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHZhciBfX0FUUFJFUlVOX18gPSBbXTsKICAgIHZhciBfX0FUSU5JVF9fID0gW107CiAgICB2YXIgX19BVE1BSU5fXyA9IFtdOwogICAgdmFyIF9fQVRFWElUX18gPSBbXTsKICAgIHZhciBfX0FUUE9TVFJVTl9fID0gW107CiAgICB2YXIgcnVudGltZUluaXRpYWxpemVkID0gZmFsc2U7CiAgICBmdW5jdGlvbiBwcmVSdW4oKSB7CiAgICAgIGlmIChNb2R1bGVbJ3ByZVJ1biddKSB7CiAgICAgICAgaWYgKHR5cGVvZiBNb2R1bGVbJ3ByZVJ1biddID09ICdmdW5jdGlvbicpIE1vZHVsZVsncHJlUnVuJ10gPSBbTW9kdWxlWydwcmVSdW4nXV07CiAgICAgICAgd2hpbGUgKE1vZHVsZVsncHJlUnVuJ10ubGVuZ3RoKSB7CiAgICAgICAgICBhZGRPblByZVJ1bihNb2R1bGVbJ3ByZVJ1biddLnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfQogICAgICBjYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUUFJFUlVOX18pOwogICAgfQogICAgZnVuY3Rpb24gZW5zdXJlSW5pdFJ1bnRpbWUoKSB7CiAgICAgIGlmIChydW50aW1lSW5pdGlhbGl6ZWQpIHJldHVybgogICAgICBydW50aW1lSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICBjYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUSU5JVF9fKTsKICAgIH0KICAgIGZ1bmN0aW9uIHByZU1haW4oKSB7CiAgICAgIGNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRNQUlOX18pOwogICAgfQogICAgZnVuY3Rpb24gZXhpdFJ1bnRpbWUoKSB7CiAgICAgIGNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRFWElUX18pOwogICAgfQogICAgZnVuY3Rpb24gcG9zdFJ1bigpIHsKICAgICAgaWYgKE1vZHVsZVsncG9zdFJ1biddKSB7CiAgICAgICAgaWYgKHR5cGVvZiBNb2R1bGVbJ3Bvc3RSdW4nXSA9PSAnZnVuY3Rpb24nKSBNb2R1bGVbJ3Bvc3RSdW4nXSA9IFtNb2R1bGVbJ3Bvc3RSdW4nXV07CiAgICAgICAgd2hpbGUgKE1vZHVsZVsncG9zdFJ1biddLmxlbmd0aCkgewogICAgICAgICAgYWRkT25Qb3N0UnVuKE1vZHVsZVsncG9zdFJ1biddLnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfQogICAgICBjYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUUE9TVFJVTl9fKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZE9uUHJlUnVuKGNiKSB7CiAgICAgIF9fQVRQUkVSVU5fXy51bnNoaWZ0KGNiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZE9uUG9zdFJ1bihjYikgewogICAgICBfX0FUUE9TVFJVTl9fLnVuc2hpZnQoY2IpOwogICAgfQogICAgZnVuY3Rpb24gd3JpdGVBc2NpaVRvTWVtb3J5KHN0ciwgYnVmZmVyLCBkb250QWRkTnVsbCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICAgIEhFQVA4W2J1ZmZlcisrID4+IDBdID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgIH0KICAgICAgaWYgKCFkb250QWRkTnVsbCkgSEVBUDhbYnVmZmVyID4+IDBdID0gMDsKICAgIH0KICAgIHZhciBNYXRoX2FicyA9IE1hdGguYWJzOwogICAgdmFyIE1hdGhfY2VpbCA9IE1hdGguY2VpbDsKICAgIHZhciBNYXRoX2Zsb29yID0gTWF0aC5mbG9vcjsKICAgIHZhciBNYXRoX21pbiA9IE1hdGgubWluOwogICAgdmFyIHJ1bkRlcGVuZGVuY2llcyA9IDA7CiAgICB2YXIgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gbnVsbDsKICAgIGZ1bmN0aW9uIGFkZFJ1bkRlcGVuZGVuY3koaWQpIHsKICAgICAgcnVuRGVwZW5kZW5jaWVzKys7CiAgICAgIGlmIChNb2R1bGVbJ21vbml0b3JSdW5EZXBlbmRlbmNpZXMnXSkgewogICAgICAgIE1vZHVsZVsnbW9uaXRvclJ1bkRlcGVuZGVuY2llcyddKHJ1bkRlcGVuZGVuY2llcyk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJlbW92ZVJ1bkRlcGVuZGVuY3koaWQpIHsKICAgICAgcnVuRGVwZW5kZW5jaWVzLS07CiAgICAgIGlmIChNb2R1bGVbJ21vbml0b3JSdW5EZXBlbmRlbmNpZXMnXSkgewogICAgICAgIE1vZHVsZVsnbW9uaXRvclJ1bkRlcGVuZGVuY2llcyddKHJ1bkRlcGVuZGVuY2llcyk7CiAgICAgIH0KICAgICAgaWYgKHJ1bkRlcGVuZGVuY2llcyA9PSAwKSB7CiAgICAgICAgaWYgKGRlcGVuZGVuY2llc0Z1bGZpbGxlZCkgewogICAgICAgICAgdmFyIGNhbGxiYWNrID0gZGVwZW5kZW5jaWVzRnVsZmlsbGVkOwogICAgICAgICAgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gbnVsbDsKICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBNb2R1bGVbJ3ByZWxvYWRlZEltYWdlcyddID0ge307CiAgICBNb2R1bGVbJ3ByZWxvYWRlZEF1ZGlvcyddID0ge307CiAgICB2YXIgZGF0YVVSSVByZWZpeCA9ICdkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsJzsKICAgIGZ1bmN0aW9uIGlzRGF0YVVSSShmaWxlbmFtZSkgewogICAgICByZXR1cm4gU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID8gZmlsZW5hbWUuc3RhcnRzV2l0aChkYXRhVVJJUHJlZml4KSA6IGZpbGVuYW1lLmluZGV4T2YoZGF0YVVSSVByZWZpeCkgPT09IDAKICAgIH0KICAgIGZ1bmN0aW9uIGludGVncmF0ZVdhc21KUygpIHsKICAgICAgdmFyIHdhc21UZXh0RmlsZSA9ICd1bnBhY2sud2FzdCc7CiAgICAgIHZhciBhc21qc0NvZGVGaWxlID0gJ3VucGFjay50ZW1wLmFzbS5qcyc7CiAgICAgIGlmICh0eXBlb2YgTW9kdWxlWydsb2NhdGVGaWxlJ10gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBpZiAoIWlzRGF0YVVSSSh3YXNtVGV4dEZpbGUpKSB7CiAgICAgICAgICB3YXNtVGV4dEZpbGUgPSBNb2R1bGVbJ2xvY2F0ZUZpbGUnXSh3YXNtVGV4dEZpbGUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzRGF0YVVSSSh3YXNtQmluYXJ5RmlsZSkpIHsKICAgICAgICAgIHdhc21CaW5hcnlGaWxlID0gTW9kdWxlWydsb2NhdGVGaWxlJ10od2FzbUJpbmFyeUZpbGUpOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzRGF0YVVSSShhc21qc0NvZGVGaWxlKSkgewogICAgICAgICAgYXNtanNDb2RlRmlsZSA9IE1vZHVsZVsnbG9jYXRlRmlsZSddKGFzbWpzQ29kZUZpbGUpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgd2FzbVBhZ2VTaXplID0gNjQgKiAxMDI0OwogICAgICB2YXIgaW5mbyA9IHsKICAgICAgICBnbG9iYWw6IG51bGwsCiAgICAgICAgZW52OiBudWxsLAogICAgICAgIGFzbTJ3YXNtOiB7CiAgICAgICAgICAnZjY0LXJlbSc6IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB4ICUgeQogICAgICAgICAgfSwKICAgICAgICAgIGRlYnVnZ2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGRlYnVnZ2VyCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgcGFyZW50OiBNb2R1bGUsCiAgICAgIH07CiAgICAgIHZhciBleHBvcnRzID0gbnVsbDsKICAgICAgZnVuY3Rpb24gbWVyZ2VNZW1vcnkobmV3QnVmZmVyKSB7CiAgICAgICAgdmFyIG9sZEJ1ZmZlciA9IE1vZHVsZVsnYnVmZmVyJ107CiAgICAgICAgaWYgKG5ld0J1ZmZlci5ieXRlTGVuZ3RoIDwgb2xkQnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXSgKICAgICAgICAgICAgJ3RoZSBuZXcgYnVmZmVyIGluIG1lcmdlTWVtb3J5IGlzIHNtYWxsZXIgdGhhbiB0aGUgcHJldmlvdXMgb25lLiBpbiBuYXRpdmUgd2FzbSwgd2Ugc2hvdWxkIGdyb3cgbWVtb3J5IGhlcmUnCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB2YXIgb2xkVmlldyA9IG5ldyBJbnQ4QXJyYXkob2xkQnVmZmVyKTsKICAgICAgICB2YXIgbmV3VmlldyA9IG5ldyBJbnQ4QXJyYXkobmV3QnVmZmVyKTsKICAgICAgICBuZXdWaWV3LnNldChvbGRWaWV3KTsKICAgICAgICB1cGRhdGVHbG9iYWxCdWZmZXIobmV3QnVmZmVyKTsKICAgICAgICB1cGRhdGVHbG9iYWxCdWZmZXJWaWV3cygpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZpeEltcG9ydHMoaW1wb3J0cykgewogICAgICAgIHJldHVybiBpbXBvcnRzCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ2V0QmluYXJ5KCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoTW9kdWxlWyd3YXNtQmluYXJ5J10pIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KE1vZHVsZVsnd2FzbUJpbmFyeSddKQogICAgICAgICAgfQogICAgICAgICAgaWYgKE1vZHVsZVsncmVhZEJpbmFyeSddKSB7CiAgICAgICAgICAgIHJldHVybiBNb2R1bGVbJ3JlYWRCaW5hcnknXSh3YXNtQmluYXJ5RmlsZSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93ICJvbiB0aGUgd2ViLCB3ZSBuZWVkIHRoZSB3YXNtIGJpbmFyeSB0byBiZSBwcmVsb2FkZWQgYW5kIHNldCBvbiBNb2R1bGVbJ3dhc21CaW5hcnknXS4gZW1jYy5weSB3aWxsIGRvIHRoYXQgZm9yIHlvdSB3aGVuIGdlbmVyYXRpbmcgSFRNTCAoYnV0IG5vdCBKUykiCiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBhYm9ydChlcnIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBnZXRCaW5hcnlQcm9taXNlKCkgewogICAgICAgIGlmICghTW9kdWxlWyd3YXNtQmluYXJ5J10gJiYgKEVOVklST05NRU5UX0lTX1dFQiB8fCBFTlZJUk9OTUVOVF9JU19XT1JLRVIpICYmIHR5cGVvZiBmZXRjaCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgcmV0dXJuIGZldGNoKHdhc21CaW5hcnlGaWxlLCB7IGNyZWRlbnRpYWxzIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmICghcmVzcG9uc2VbJ29rJ10pIHsKICAgICAgICAgICAgICAgIHRocm93ICJmYWlsZWQgdG8gbG9hZCB3YXNtIGJpbmFyeSBmaWxlIGF0ICciICsgd2FzbUJpbmFyeUZpbGUgKyAiJyIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWydhcnJheUJ1ZmZlciddKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gZ2V0QmluYXJ5KCkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHJlc29sdmUoZ2V0QmluYXJ5KCkpOwogICAgICAgIH0pCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZG9OYXRpdmVXYXNtKGdsb2JhbCwgZW52LCBwcm92aWRlZEJ1ZmZlcikgewogICAgICAgIGlmICh0eXBlb2YgV2ViQXNzZW1ibHkgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICBNb2R1bGVbJ3ByaW50RXJyJ10oJ25vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQnKTsKICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBpZiAoIShNb2R1bGVbJ3dhc21NZW1vcnknXSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5Lk1lbW9yeSkpIHsKICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXSgnbm8gbmF0aXZlIHdhc20gTWVtb3J5IGluIHVzZScpOwogICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIGVudlsnbWVtb3J5J10gPSBNb2R1bGVbJ3dhc21NZW1vcnknXTsKICAgICAgICBpbmZvWydnbG9iYWwnXSA9IHsgTmFOOiBOYU4sIEluZmluaXR5OiBJbmZpbml0eSB9OwogICAgICAgIGluZm9bJ2dsb2JhbC5NYXRoJ10gPSBNYXRoOwogICAgICAgIGluZm9bJ2VudiddID0gZW52OwogICAgICAgIGZ1bmN0aW9uIHJlY2VpdmVJbnN0YW5jZShpbnN0YW5jZSwgbW9kdWxlKSB7CiAgICAgICAgICBleHBvcnRzID0gaW5zdGFuY2UuZXhwb3J0czsKICAgICAgICAgIGlmIChleHBvcnRzLm1lbW9yeSkgbWVyZ2VNZW1vcnkoZXhwb3J0cy5tZW1vcnkpOwogICAgICAgICAgTW9kdWxlWydhc20nXSA9IGV4cG9ydHM7CiAgICAgICAgICBNb2R1bGVbJ3VzaW5nV2FzbSddID0gdHJ1ZTsKICAgICAgICAgIHJlbW92ZVJ1bkRlcGVuZGVuY3koKTsKICAgICAgICB9CiAgICAgICAgYWRkUnVuRGVwZW5kZW5jeSgpOwogICAgICAgIGlmIChNb2R1bGVbJ2luc3RhbnRpYXRlV2FzbSddKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gTW9kdWxlWydpbnN0YW50aWF0ZVdhc20nXShpbmZvLCByZWNlaXZlSW5zdGFuY2UpCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXSgnTW9kdWxlLmluc3RhbnRpYXRlV2FzbSBjYWxsYmFjayBmYWlsZWQgd2l0aCBlcnJvcjogJyArIGUpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZShvdXRwdXQpIHsKICAgICAgICAgIHJlY2VpdmVJbnN0YW5jZShvdXRwdXRbJ2luc3RhbmNlJ10sIG91dHB1dFsnbW9kdWxlJ10pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpbnN0YW50aWF0ZUFycmF5QnVmZmVyKHJlY2VpdmVyKSB7CiAgICAgICAgICBnZXRCaW5hcnlQcm9taXNlKCkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGJpbmFyeSkgewogICAgICAgICAgICAgIHJldHVybiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShiaW5hcnksIGluZm8pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKHJlY2VpdmVyKQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXSgnZmFpbGVkIHRvIGFzeW5jaHJvbm91c2x5IHByZXBhcmUgd2FzbTogJyArIHJlYXNvbik7CiAgICAgICAgICAgICAgYWJvcnQocmVhc29uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgICFNb2R1bGVbJ3dhc21CaW5hcnknXSAmJgogICAgICAgICAgdHlwZW9mIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nID09PSAnZnVuY3Rpb24nICYmCiAgICAgICAgICAhaXNEYXRhVVJJKHdhc21CaW5hcnlGaWxlKSAmJgogICAgICAgICAgdHlwZW9mIGZldGNoID09PSAnZnVuY3Rpb24nCiAgICAgICAgKSB7CiAgICAgICAgICBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhmZXRjaCh3YXNtQmluYXJ5RmlsZSwgeyBjcmVkZW50aWFscyB9KSwgaW5mbykKICAgICAgICAgICAgLnRoZW4ocmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBNb2R1bGVbJ3ByaW50RXJyJ10oJ3dhc20gc3RyZWFtaW5nIGNvbXBpbGUgZmFpbGVkOiAnICsgcmVhc29uKTsKICAgICAgICAgICAgICBNb2R1bGVbJ3ByaW50RXJyJ10oJ2ZhbGxpbmcgYmFjayB0byBBcnJheUJ1ZmZlciBpbnN0YW50aWF0aW9uJyk7CiAgICAgICAgICAgICAgaW5zdGFudGlhdGVBcnJheUJ1ZmZlcihyZWNlaXZlSW5zdGFudGlhdGVkU291cmNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluc3RhbnRpYXRlQXJyYXlCdWZmZXIocmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7fQogICAgICB9CiAgICAgIE1vZHVsZVsnYXNtUHJlbG9hZCddID0gTW9kdWxlWydhc20nXTsKICAgICAgdmFyIGFzbWpzUmVhbGxvY0J1ZmZlciA9IE1vZHVsZVsncmVhbGxvY0J1ZmZlciddOwogICAgICB2YXIgd2FzbVJlYWxsb2NCdWZmZXIgPSBmdW5jdGlvbiAoc2l6ZSkgewogICAgICAgIHZhciBQQUdFX01VTFRJUExFID0gTW9kdWxlWyd1c2luZ1dhc20nXSA/IFdBU01fUEFHRV9TSVpFIDogQVNNSlNfUEFHRV9TSVpFOwogICAgICAgIHNpemUgPSBhbGlnblVwKHNpemUsIFBBR0VfTVVMVElQTEUpOwogICAgICAgIHZhciBvbGQgPSBNb2R1bGVbJ2J1ZmZlciddOwogICAgICAgIHZhciBvbGRTaXplID0gb2xkLmJ5dGVMZW5ndGg7CiAgICAgICAgaWYgKE1vZHVsZVsndXNpbmdXYXNtJ10pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBNb2R1bGVbJ3dhc21NZW1vcnknXS5ncm93KChzaXplIC0gb2xkU2l6ZSkgLyB3YXNtUGFnZVNpemUpOwogICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAoLTEgfCAwKSkgewogICAgICAgICAgICAgIHJldHVybiAoTW9kdWxlWydidWZmZXInXSA9IE1vZHVsZVsnd2FzbU1lbW9yeSddLmJ1ZmZlcikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBNb2R1bGVbJ3JlYWxsb2NCdWZmZXInXSA9IGZ1bmN0aW9uIChzaXplKSB7CiAgICAgICAgaWYgKGZpbmFsTWV0aG9kID09PSAnYXNtanMnKSB7CiAgICAgICAgICByZXR1cm4gYXNtanNSZWFsbG9jQnVmZmVyKHNpemUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB3YXNtUmVhbGxvY0J1ZmZlcihzaXplKQogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIGZpbmFsTWV0aG9kID0gJyc7CiAgICAgIE1vZHVsZVsnYXNtJ10gPSBmdW5jdGlvbiAoZ2xvYmFsLCBlbnYsIHByb3ZpZGVkQnVmZmVyKSB7CiAgICAgICAgZW52ID0gZml4SW1wb3J0cyhlbnYpOwogICAgICAgIGlmICghZW52Wyd0YWJsZSddKSB7CiAgICAgICAgICB2YXIgVEFCTEVfU0laRSA9IE1vZHVsZVsnd2FzbVRhYmxlU2l6ZSddOwogICAgICAgICAgaWYgKFRBQkxFX1NJWkUgPT09IHVuZGVmaW5lZCkgVEFCTEVfU0laRSA9IDEwMjQ7CiAgICAgICAgICB2YXIgTUFYX1RBQkxFX1NJWkUgPSBNb2R1bGVbJ3dhc21NYXhUYWJsZVNpemUnXTsKICAgICAgICAgIGlmICh0eXBlb2YgV2ViQXNzZW1ibHkgPT09ICdvYmplY3QnICYmIHR5cGVvZiBXZWJBc3NlbWJseS5UYWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBpZiAoTUFYX1RBQkxFX1NJWkUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGVudlsndGFibGUnXSA9IG5ldyBXZWJBc3NlbWJseS5UYWJsZSh7IGluaXRpYWw6IFRBQkxFX1NJWkUsIG1heGltdW06IE1BWF9UQUJMRV9TSVpFLCBlbGVtZW50OiAnYW55ZnVuYycgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZW52Wyd0YWJsZSddID0gbmV3IFdlYkFzc2VtYmx5LlRhYmxlKHsgaW5pdGlhbDogVEFCTEVfU0laRSwgZWxlbWVudDogJ2FueWZ1bmMnIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbnZbJ3RhYmxlJ10gPSBuZXcgQXJyYXkoVEFCTEVfU0laRSk7CiAgICAgICAgICB9CiAgICAgICAgICBNb2R1bGVbJ3dhc21UYWJsZSddID0gZW52Wyd0YWJsZSddOwogICAgICAgIH0KICAgICAgICBpZiAoIWVudlsnbWVtb3J5QmFzZSddKSB7CiAgICAgICAgICBlbnZbJ21lbW9yeUJhc2UnXSA9IE1vZHVsZVsnU1RBVElDX0JBU0UnXTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbnZbJ3RhYmxlQmFzZSddKSB7CiAgICAgICAgICBlbnZbJ3RhYmxlQmFzZSddID0gMDsKICAgICAgICB9CiAgICAgICAgdmFyIGV4cG9ydHM7CiAgICAgICAgZXhwb3J0cyA9IGRvTmF0aXZlV2FzbShnbG9iYWwsIGVudik7CiAgICAgICAgaWYgKCFleHBvcnRzKQogICAgICAgICAgYWJvcnQoCiAgICAgICAgICAgICdubyBiaW5hcnllbiBtZXRob2Qgc3VjY2VlZGVkLiBjb25zaWRlciBlbmFibGluZyBtb3JlIG9wdGlvbnMsIGxpa2UgaW50ZXJwcmV0aW5nLCBpZiB5b3Ugd2FudCB0aGF0OiBodHRwczovL2dpdGh1Yi5jb20va3JpcGtlbi9lbXNjcmlwdGVuL3dpa2kvV2ViQXNzZW1ibHkjYmluYXJ5ZW4tbWV0aG9kcycKICAgICAgICAgICk7CiAgICAgICAgcmV0dXJuIGV4cG9ydHMKICAgICAgfTsKICAgIH0KICAgIGludGVncmF0ZVdhc21KUygpOwogICAgU1RBVElDX0JBU0UgPSBHTE9CQUxfQkFTRTsKICAgIFNUQVRJQ1RPUCA9IFNUQVRJQ19CQVNFICsgNjY5NjA7CiAgICBfX0FUSU5JVF9fLnB1c2goCiAgICAgIHsKICAgICAgICBmdW5jOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfX0dMT0JBTF9fc3ViX0lfZ2xvYmFsX2NwcCgpOwogICAgICAgIH0sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBmdW5jOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfX0dMT0JBTF9fc3ViX0lfY3JjX2NwcCgpOwogICAgICAgIH0sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBmdW5jOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcCgpOwogICAgICAgIH0sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBmdW5jOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfX0dMT0JBTF9fc3ViX0lfYmluZF9jcHAoKTsKICAgICAgICB9LAogICAgICB9CiAgICApOwogICAgdmFyIFNUQVRJQ19CVU1QID0gNjY5NjA7CiAgICBNb2R1bGVbJ1NUQVRJQ19CQVNFJ10gPSBTVEFUSUNfQkFTRTsKICAgIE1vZHVsZVsnU1RBVElDX0JVTVAnXSA9IFNUQVRJQ19CVU1QOwogICAgU1RBVElDVE9QICs9IDE2OwogICAgZnVuY3Rpb24gX19fY3hhX2FsbG9jYXRlX2V4Y2VwdGlvbihzaXplKSB7CiAgICAgIHJldHVybiBfbWFsbG9jKHNpemUpCiAgICB9CiAgICB2YXIgRVhDRVBUSU9OUyA9IHsKICAgICAgbGFzdDogMCwKICAgICAgY2F1Z2h0OiBbXSwKICAgICAgaW5mb3M6IHt9LAogICAgICBkZUFkanVzdDogZnVuY3Rpb24gKGFkanVzdGVkKSB7CiAgICAgICAgaWYgKCFhZGp1c3RlZCB8fCBFWENFUFRJT05TLmluZm9zW2FkanVzdGVkXSkgcmV0dXJuIGFkanVzdGVkCiAgICAgICAgZm9yICh2YXIga2V5IGluIEVYQ0VQVElPTlMuaW5mb3MpIHsKICAgICAgICAgIHZhciBwdHIgPSAra2V5OwogICAgICAgICAgdmFyIGluZm8gPSBFWENFUFRJT05TLmluZm9zW3B0cl07CiAgICAgICAgICBpZiAoaW5mby5hZGp1c3RlZCA9PT0gYWRqdXN0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHB0cgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRqdXN0ZWQKICAgICAgfSwKICAgICAgYWRkUmVmOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgaWYgKCFwdHIpIHJldHVybgogICAgICAgIHZhciBpbmZvID0gRVhDRVBUSU9OUy5pbmZvc1twdHJdOwogICAgICAgIGluZm8ucmVmY291bnQrKzsKICAgICAgfSwKICAgICAgZGVjUmVmOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgaWYgKCFwdHIpIHJldHVybgogICAgICAgIHZhciBpbmZvID0gRVhDRVBUSU9OUy5pbmZvc1twdHJdOwogICAgICAgIGFzc2VydChpbmZvLnJlZmNvdW50ID4gMCk7CiAgICAgICAgaW5mby5yZWZjb3VudC0tOwogICAgICAgIGlmIChpbmZvLnJlZmNvdW50ID09PSAwICYmICFpbmZvLnJldGhyb3duKSB7CiAgICAgICAgICBpZiAoaW5mby5kZXN0cnVjdG9yKSB7CiAgICAgICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aSddKGluZm8uZGVzdHJ1Y3RvciwgcHRyKTsKICAgICAgICAgIH0KICAgICAgICAgIGRlbGV0ZSBFWENFUFRJT05TLmluZm9zW3B0cl07CiAgICAgICAgICBfX19jeGFfZnJlZV9leGNlcHRpb24ocHRyKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNsZWFyUmVmOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgaWYgKCFwdHIpIHJldHVybgogICAgICAgIHZhciBpbmZvID0gRVhDRVBUSU9OUy5pbmZvc1twdHJdOwogICAgICAgIGluZm8ucmVmY291bnQgPSAwOwogICAgICB9LAogICAgfTsKICAgIGZ1bmN0aW9uIF9fX2N4YV9iZWdpbl9jYXRjaChwdHIpIHsKICAgICAgdmFyIGluZm8gPSBFWENFUFRJT05TLmluZm9zW3B0cl07CiAgICAgIGlmIChpbmZvICYmICFpbmZvLmNhdWdodCkgewogICAgICAgIGluZm8uY2F1Z2h0ID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAoaW5mbykgaW5mby5yZXRocm93biA9IGZhbHNlOwogICAgICBFWENFUFRJT05TLmNhdWdodC5wdXNoKHB0cik7CiAgICAgIEVYQ0VQVElPTlMuYWRkUmVmKEVYQ0VQVElPTlMuZGVBZGp1c3QocHRyKSk7CiAgICAgIHJldHVybiBwdHIKICAgIH0KICAgIGZ1bmN0aW9uIF9fX2N4YV9mcmVlX2V4Y2VwdGlvbihwdHIpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gX2ZyZWUocHRyKQogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogICAgZnVuY3Rpb24gX19fY3hhX2VuZF9jYXRjaCgpIHsKICAgICAgTW9kdWxlWydzZXRUaHJldyddKDApOwogICAgICB2YXIgcHRyID0gRVhDRVBUSU9OUy5jYXVnaHQucG9wKCk7CiAgICAgIGlmIChwdHIpIHsKICAgICAgICBFWENFUFRJT05TLmRlY1JlZihFWENFUFRJT05TLmRlQWRqdXN0KHB0cikpOwogICAgICAgIEVYQ0VQVElPTlMubGFzdCA9IDA7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoXzIoKSB7CiAgICAgIHJldHVybiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaC5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9CiAgICBmdW5jdGlvbiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zKCkgewogICAgICByZXR1cm4gX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2guYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfQogICAgZnVuY3Rpb24gX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2hfNCgpIHsKICAgICAgcmV0dXJuIF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0KICAgIGZ1bmN0aW9uIF9fX3Jlc3VtZUV4Y2VwdGlvbihwdHIpIHsKICAgICAgaWYgKCFFWENFUFRJT05TLmxhc3QpIHsKICAgICAgICBFWENFUFRJT05TLmxhc3QgPSBwdHI7CiAgICAgIH0KICAgICAgdGhyb3cgcHRyCiAgICB9CiAgICBmdW5jdGlvbiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaCgpIHsKICAgICAgdmFyIHRocm93biA9IEVYQ0VQVElPTlMubGFzdDsKICAgICAgaWYgKCF0aHJvd24pIHsKICAgICAgICByZXR1cm4gKHNldFRlbXBSZXQwKDApLCAwKSB8IDAKICAgICAgfQogICAgICB2YXIgaW5mbyA9IEVYQ0VQVElPTlMuaW5mb3NbdGhyb3duXTsKICAgICAgdmFyIHRocm93bnR5cGUgPSBpbmZvLnR5cGU7CiAgICAgIGlmICghdGhyb3dudHlwZSkgewogICAgICAgIHJldHVybiAoc2V0VGVtcFJldDAoMCksIHRocm93bikgfCAwCiAgICAgIH0KICAgICAgdmFyIHR5cGVBcnJheSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIE1vZHVsZVsnX19fY3hhX2lzX3BvaW50ZXJfdHlwZSddKHRocm93bnR5cGUpOwogICAgICBpZiAoIV9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoLmJ1ZmZlcikgX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2guYnVmZmVyID0gX21hbGxvYyg0KTsKICAgICAgSEVBUDMyW19fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoLmJ1ZmZlciA+PiAyXSA9IHRocm93bjsKICAgICAgdGhyb3duID0gX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2guYnVmZmVyOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGVBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0eXBlQXJyYXlbaV0gJiYgTW9kdWxlWydfX19jeGFfY2FuX2NhdGNoJ10odHlwZUFycmF5W2ldLCB0aHJvd250eXBlLCB0aHJvd24pKSB7CiAgICAgICAgICB0aHJvd24gPSBIRUFQMzJbdGhyb3duID4+IDJdOwogICAgICAgICAgaW5mby5hZGp1c3RlZCA9IHRocm93bjsKICAgICAgICAgIHJldHVybiAoc2V0VGVtcFJldDAodHlwZUFycmF5W2ldKSwgdGhyb3duKSB8IDAKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3duID0gSEVBUDMyW3Rocm93biA+PiAyXTsKICAgICAgcmV0dXJuIChzZXRUZW1wUmV0MCh0aHJvd250eXBlKSwgdGhyb3duKSB8IDAKICAgIH0KICAgIGZ1bmN0aW9uIF9fX2N4YV90aHJvdyhwdHIsIHR5cGUsIGRlc3RydWN0b3IpIHsKICAgICAgRVhDRVBUSU9OUy5pbmZvc1twdHJdID0gewogICAgICAgIHB0cjogcHRyLAogICAgICAgIGFkanVzdGVkOiBwdHIsCiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBkZXN0cnVjdG9yOiBkZXN0cnVjdG9yLAogICAgICAgIHJlZmNvdW50OiAwLAogICAgICAgIGNhdWdodDogZmFsc2UsCiAgICAgICAgcmV0aHJvd246IGZhbHNlLAogICAgICB9OwogICAgICBFWENFUFRJT05TLmxhc3QgPSBwdHI7CiAgICAgIHRocm93IHB0cgogICAgfQogICAgZnVuY3Rpb24gX19fbG9jaygpIHt9CiAgICB2YXIgRVJSTk9fQ09ERVMgPSB7CiAgICAgIEVQRVJNOiAxLAogICAgICBFTk9FTlQ6IDIsCiAgICAgIEVTUkNIOiAzLAogICAgICBFSU5UUjogNCwKICAgICAgRUlPOiA1LAogICAgICBFTlhJTzogNiwKICAgICAgRTJCSUc6IDcsCiAgICAgIEVOT0VYRUM6IDgsCiAgICAgIEVCQURGOiA5LAogICAgICBFQ0hJTEQ6IDEwLAogICAgICBFQUdBSU46IDExLAogICAgICBFV09VTERCTE9DSzogMTEsCiAgICAgIEVOT01FTTogMTIsCiAgICAgIEVBQ0NFUzogMTMsCiAgICAgIEVGQVVMVDogMTQsCiAgICAgIEVOT1RCTEs6IDE1LAogICAgICBFQlVTWTogMTYsCiAgICAgIEVFWElTVDogMTcsCiAgICAgIEVYREVWOiAxOCwKICAgICAgRU5PREVWOiAxOSwKICAgICAgRU5PVERJUjogMjAsCiAgICAgIEVJU0RJUjogMjEsCiAgICAgIEVJTlZBTDogMjIsCiAgICAgIEVORklMRTogMjMsCiAgICAgIEVNRklMRTogMjQsCiAgICAgIEVOT1RUWTogMjUsCiAgICAgIEVUWFRCU1k6IDI2LAogICAgICBFRkJJRzogMjcsCiAgICAgIEVOT1NQQzogMjgsCiAgICAgIEVTUElQRTogMjksCiAgICAgIEVST0ZTOiAzMCwKICAgICAgRU1MSU5LOiAzMSwKICAgICAgRVBJUEU6IDMyLAogICAgICBFRE9NOiAzMywKICAgICAgRVJBTkdFOiAzNCwKICAgICAgRU5PTVNHOiA0MiwKICAgICAgRUlEUk06IDQzLAogICAgICBFQ0hSTkc6IDQ0LAogICAgICBFTDJOU1lOQzogNDUsCiAgICAgIEVMM0hMVDogNDYsCiAgICAgIEVMM1JTVDogNDcsCiAgICAgIEVMTlJORzogNDgsCiAgICAgIEVVTkFUQ0g6IDQ5LAogICAgICBFTk9DU0k6IDUwLAogICAgICBFTDJITFQ6IDUxLAogICAgICBFREVBRExLOiAzNSwKICAgICAgRU5PTENLOiAzNywKICAgICAgRUJBREU6IDUyLAogICAgICBFQkFEUjogNTMsCiAgICAgIEVYRlVMTDogNTQsCiAgICAgIEVOT0FOTzogNTUsCiAgICAgIEVCQURSUUM6IDU2LAogICAgICBFQkFEU0xUOiA1NywKICAgICAgRURFQURMT0NLOiAzNSwKICAgICAgRUJGT05UOiA1OSwKICAgICAgRU5PU1RSOiA2MCwKICAgICAgRU5PREFUQTogNjEsCiAgICAgIEVUSU1FOiA2MiwKICAgICAgRU5PU1I6IDYzLAogICAgICBFTk9ORVQ6IDY0LAogICAgICBFTk9QS0c6IDY1LAogICAgICBFUkVNT1RFOiA2NiwKICAgICAgRU5PTElOSzogNjcsCiAgICAgIEVBRFY6IDY4LAogICAgICBFU1JNTlQ6IDY5LAogICAgICBFQ09NTTogNzAsCiAgICAgIEVQUk9UTzogNzEsCiAgICAgIEVNVUxUSUhPUDogNzIsCiAgICAgIEVET1RET1Q6IDczLAogICAgICBFQkFETVNHOiA3NCwKICAgICAgRU5PVFVOSVE6IDc2LAogICAgICBFQkFERkQ6IDc3LAogICAgICBFUkVNQ0hHOiA3OCwKICAgICAgRUxJQkFDQzogNzksCiAgICAgIEVMSUJCQUQ6IDgwLAogICAgICBFTElCU0NOOiA4MSwKICAgICAgRUxJQk1BWDogODIsCiAgICAgIEVMSUJFWEVDOiA4MywKICAgICAgRU5PU1lTOiAzOCwKICAgICAgRU5PVEVNUFRZOiAzOSwKICAgICAgRU5BTUVUT09MT05HOiAzNiwKICAgICAgRUxPT1A6IDQwLAogICAgICBFT1BOT1RTVVBQOiA5NSwKICAgICAgRVBGTk9TVVBQT1JUOiA5NiwKICAgICAgRUNPTk5SRVNFVDogMTA0LAogICAgICBFTk9CVUZTOiAxMDUsCiAgICAgIEVBRk5PU1VQUE9SVDogOTcsCiAgICAgIEVQUk9UT1RZUEU6IDkxLAogICAgICBFTk9UU09DSzogODgsCiAgICAgIEVOT1BST1RPT1BUOiA5MiwKICAgICAgRVNIVVRET1dOOiAxMDgsCiAgICAgIEVDT05OUkVGVVNFRDogMTExLAogICAgICBFQUREUklOVVNFOiA5OCwKICAgICAgRUNPTk5BQk9SVEVEOiAxMDMsCiAgICAgIEVORVRVTlJFQUNIOiAxMDEsCiAgICAgIEVORVRET1dOOiAxMDAsCiAgICAgIEVUSU1FRE9VVDogMTEwLAogICAgICBFSE9TVERPV046IDExMiwKICAgICAgRUhPU1RVTlJFQUNIOiAxMTMsCiAgICAgIEVJTlBST0dSRVNTOiAxMTUsCiAgICAgIEVBTFJFQURZOiAxMTQsCiAgICAgIEVERVNUQUREUlJFUTogODksCiAgICAgIEVNU0dTSVpFOiA5MCwKICAgICAgRVBST1RPTk9TVVBQT1JUOiA5MywKICAgICAgRVNPQ0tUTk9TVVBQT1JUOiA5NCwKICAgICAgRUFERFJOT1RBVkFJTDogOTksCiAgICAgIEVORVRSRVNFVDogMTAyLAogICAgICBFSVNDT05OOiAxMDYsCiAgICAgIEVOT1RDT05OOiAxMDcsCiAgICAgIEVUT09NQU5ZUkVGUzogMTA5LAogICAgICBFVVNFUlM6IDg3LAogICAgICBFRFFVT1Q6IDEyMiwKICAgICAgRVNUQUxFOiAxMTYsCiAgICAgIEVOT1RTVVA6IDk1LAogICAgICBFTk9NRURJVU06IDEyMywKICAgICAgRUlMU0VROiA4NCwKICAgICAgRU9WRVJGTE9XOiA3NSwKICAgICAgRUNBTkNFTEVEOiAxMjUsCiAgICAgIEVOT1RSRUNPVkVSQUJMRTogMTMxLAogICAgICBFT1dORVJERUFEOiAxMzAsCiAgICAgIEVTVFJQSVBFOiA4NiwKICAgIH07CiAgICBmdW5jdGlvbiBfX19zZXRFcnJObyh2YWx1ZSkgewogICAgICBpZiAoTW9kdWxlWydfX19lcnJub19sb2NhdGlvbiddKSBIRUFQMzJbTW9kdWxlWydfX19lcnJub19sb2NhdGlvbiddKCkgPj4gMl0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIHZhbHVlCiAgICB9CiAgICBmdW5jdGlvbiBfX19tYXBfZmlsZShwYXRobmFtZSwgc2l6ZSkgewogICAgICBfX19zZXRFcnJObyhFUlJOT19DT0RFUy5FUEVSTSk7CiAgICAgIHJldHVybiAtMQogICAgfQogICAgdmFyIEVSUk5PX01FU1NBR0VTID0gewogICAgICAwOiAnU3VjY2VzcycsCiAgICAgIDE6ICdOb3Qgc3VwZXItdXNlcicsCiAgICAgIDI6ICdObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5JywKICAgICAgMzogJ05vIHN1Y2ggcHJvY2VzcycsCiAgICAgIDQ6ICdJbnRlcnJ1cHRlZCBzeXN0ZW0gY2FsbCcsCiAgICAgIDU6ICdJL08gZXJyb3InLAogICAgICA2OiAnTm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcycsCiAgICAgIDc6ICdBcmcgbGlzdCB0b28gbG9uZycsCiAgICAgIDg6ICdFeGVjIGZvcm1hdCBlcnJvcicsCiAgICAgIDk6ICdCYWQgZmlsZSBudW1iZXInLAogICAgICAxMDogJ05vIGNoaWxkcmVuJywKICAgICAgMTE6ICdObyBtb3JlIHByb2Nlc3NlcycsCiAgICAgIDEyOiAnTm90IGVub3VnaCBjb3JlJywKICAgICAgMTM6ICdQZXJtaXNzaW9uIGRlbmllZCcsCiAgICAgIDE0OiAnQmFkIGFkZHJlc3MnLAogICAgICAxNTogJ0Jsb2NrIGRldmljZSByZXF1aXJlZCcsCiAgICAgIDE2OiAnTW91bnQgZGV2aWNlIGJ1c3knLAogICAgICAxNzogJ0ZpbGUgZXhpc3RzJywKICAgICAgMTg6ICdDcm9zcy1kZXZpY2UgbGluaycsCiAgICAgIDE5OiAnTm8gc3VjaCBkZXZpY2UnLAogICAgICAyMDogJ05vdCBhIGRpcmVjdG9yeScsCiAgICAgIDIxOiAnSXMgYSBkaXJlY3RvcnknLAogICAgICAyMjogJ0ludmFsaWQgYXJndW1lbnQnLAogICAgICAyMzogJ1RvbyBtYW55IG9wZW4gZmlsZXMgaW4gc3lzdGVtJywKICAgICAgMjQ6ICdUb28gbWFueSBvcGVuIGZpbGVzJywKICAgICAgMjU6ICdOb3QgYSB0eXBld3JpdGVyJywKICAgICAgMjY6ICdUZXh0IGZpbGUgYnVzeScsCiAgICAgIDI3OiAnRmlsZSB0b28gbGFyZ2UnLAogICAgICAyODogJ05vIHNwYWNlIGxlZnQgb24gZGV2aWNlJywKICAgICAgMjk6ICdJbGxlZ2FsIHNlZWsnLAogICAgICAzMDogJ1JlYWQgb25seSBmaWxlIHN5c3RlbScsCiAgICAgIDMxOiAnVG9vIG1hbnkgbGlua3MnLAogICAgICAzMjogJ0Jyb2tlbiBwaXBlJywKICAgICAgMzM6ICdNYXRoIGFyZyBvdXQgb2YgZG9tYWluIG9mIGZ1bmMnLAogICAgICAzNDogJ01hdGggcmVzdWx0IG5vdCByZXByZXNlbnRhYmxlJywKICAgICAgMzU6ICdGaWxlIGxvY2tpbmcgZGVhZGxvY2sgZXJyb3InLAogICAgICAzNjogJ0ZpbGUgb3IgcGF0aCBuYW1lIHRvbyBsb25nJywKICAgICAgMzc6ICdObyByZWNvcmQgbG9ja3MgYXZhaWxhYmxlJywKICAgICAgMzg6ICdGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQnLAogICAgICAzOTogJ0RpcmVjdG9yeSBub3QgZW1wdHknLAogICAgICA0MDogJ1RvbyBtYW55IHN5bWJvbGljIGxpbmtzJywKICAgICAgNDI6ICdObyBtZXNzYWdlIG9mIGRlc2lyZWQgdHlwZScsCiAgICAgIDQzOiAnSWRlbnRpZmllciByZW1vdmVkJywKICAgICAgNDQ6ICdDaGFubmVsIG51bWJlciBvdXQgb2YgcmFuZ2UnLAogICAgICA0NTogJ0xldmVsIDIgbm90IHN5bmNocm9uaXplZCcsCiAgICAgIDQ2OiAnTGV2ZWwgMyBoYWx0ZWQnLAogICAgICA0NzogJ0xldmVsIDMgcmVzZXQnLAogICAgICA0ODogJ0xpbmsgbnVtYmVyIG91dCBvZiByYW5nZScsCiAgICAgIDQ5OiAnUHJvdG9jb2wgZHJpdmVyIG5vdCBhdHRhY2hlZCcsCiAgICAgIDUwOiAnTm8gQ1NJIHN0cnVjdHVyZSBhdmFpbGFibGUnLAogICAgICA1MTogJ0xldmVsIDIgaGFsdGVkJywKICAgICAgNTI6ICdJbnZhbGlkIGV4Y2hhbmdlJywKICAgICAgNTM6ICdJbnZhbGlkIHJlcXVlc3QgZGVzY3JpcHRvcicsCiAgICAgIDU0OiAnRXhjaGFuZ2UgZnVsbCcsCiAgICAgIDU1OiAnTm8gYW5vZGUnLAogICAgICA1NjogJ0ludmFsaWQgcmVxdWVzdCBjb2RlJywKICAgICAgNTc6ICdJbnZhbGlkIHNsb3QnLAogICAgICA1OTogJ0JhZCBmb250IGZpbGUgZm10JywKICAgICAgNjA6ICdEZXZpY2Ugbm90IGEgc3RyZWFtJywKICAgICAgNjE6ICdObyBkYXRhIChmb3Igbm8gZGVsYXkgaW8pJywKICAgICAgNjI6ICdUaW1lciBleHBpcmVkJywKICAgICAgNjM6ICdPdXQgb2Ygc3RyZWFtcyByZXNvdXJjZXMnLAogICAgICA2NDogJ01hY2hpbmUgaXMgbm90IG9uIHRoZSBuZXR3b3JrJywKICAgICAgNjU6ICdQYWNrYWdlIG5vdCBpbnN0YWxsZWQnLAogICAgICA2NjogJ1RoZSBvYmplY3QgaXMgcmVtb3RlJywKICAgICAgNjc6ICdUaGUgbGluayBoYXMgYmVlbiBzZXZlcmVkJywKICAgICAgNjg6ICdBZHZlcnRpc2UgZXJyb3InLAogICAgICA2OTogJ1NybW91bnQgZXJyb3InLAogICAgICA3MDogJ0NvbW11bmljYXRpb24gZXJyb3Igb24gc2VuZCcsCiAgICAgIDcxOiAnUHJvdG9jb2wgZXJyb3InLAogICAgICA3MjogJ011bHRpaG9wIGF0dGVtcHRlZCcsCiAgICAgIDczOiAnQ3Jvc3MgbW91bnQgcG9pbnQgKG5vdCByZWFsbHkgZXJyb3IpJywKICAgICAgNzQ6ICdUcnlpbmcgdG8gcmVhZCB1bnJlYWRhYmxlIG1lc3NhZ2UnLAogICAgICA3NTogJ1ZhbHVlIHRvbyBsYXJnZSBmb3IgZGVmaW5lZCBkYXRhIHR5cGUnLAogICAgICA3NjogJ0dpdmVuIGxvZy4gbmFtZSBub3QgdW5pcXVlJywKICAgICAgNzc6ICdmLmQuIGludmFsaWQgZm9yIHRoaXMgb3BlcmF0aW9uJywKICAgICAgNzg6ICdSZW1vdGUgYWRkcmVzcyBjaGFuZ2VkJywKICAgICAgNzk6ICdDYW4gICBhY2Nlc3MgYSBuZWVkZWQgc2hhcmVkIGxpYicsCiAgICAgIDgwOiAnQWNjZXNzaW5nIGEgY29ycnVwdGVkIHNoYXJlZCBsaWInLAogICAgICA4MTogJy5saWIgc2VjdGlvbiBpbiBhLm91dCBjb3JydXB0ZWQnLAogICAgICA4MjogJ0F0dGVtcHRpbmcgdG8gbGluayBpbiB0b28gbWFueSBsaWJzJywKICAgICAgODM6ICdBdHRlbXB0aW5nIHRvIGV4ZWMgYSBzaGFyZWQgbGlicmFyeScsCiAgICAgIDg0OiAnSWxsZWdhbCBieXRlIHNlcXVlbmNlJywKICAgICAgODY6ICdTdHJlYW1zIHBpcGUgZXJyb3InLAogICAgICA4NzogJ1RvbyBtYW55IHVzZXJzJywKICAgICAgODg6ICdTb2NrZXQgb3BlcmF0aW9uIG9uIG5vbi1zb2NrZXQnLAogICAgICA4OTogJ0Rlc3RpbmF0aW9uIGFkZHJlc3MgcmVxdWlyZWQnLAogICAgICA5MDogJ01lc3NhZ2UgdG9vIGxvbmcnLAogICAgICA5MTogJ1Byb3RvY29sIHdyb25nIHR5cGUgZm9yIHNvY2tldCcsCiAgICAgIDkyOiAnUHJvdG9jb2wgbm90IGF2YWlsYWJsZScsCiAgICAgIDkzOiAnVW5rbm93biBwcm90b2NvbCcsCiAgICAgIDk0OiAnU29ja2V0IHR5cGUgbm90IHN1cHBvcnRlZCcsCiAgICAgIDk1OiAnTm90IHN1cHBvcnRlZCcsCiAgICAgIDk2OiAnUHJvdG9jb2wgZmFtaWx5IG5vdCBzdXBwb3J0ZWQnLAogICAgICA5NzogJ0FkZHJlc3MgZmFtaWx5IG5vdCBzdXBwb3J0ZWQgYnkgcHJvdG9jb2wgZmFtaWx5JywKICAgICAgOTg6ICdBZGRyZXNzIGFscmVhZHkgaW4gdXNlJywKICAgICAgOTk6ICdBZGRyZXNzIG5vdCBhdmFpbGFibGUnLAogICAgICAxMDA6ICdOZXR3b3JrIGludGVyZmFjZSBpcyBub3QgY29uZmlndXJlZCcsCiAgICAgIDEwMTogJ05ldHdvcmsgaXMgdW5yZWFjaGFibGUnLAogICAgICAxMDI6ICdDb25uZWN0aW9uIHJlc2V0IGJ5IG5ldHdvcmsnLAogICAgICAxMDM6ICdDb25uZWN0aW9uIGFib3J0ZWQnLAogICAgICAxMDQ6ICdDb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXInLAogICAgICAxMDU6ICdObyBidWZmZXIgc3BhY2UgYXZhaWxhYmxlJywKICAgICAgMTA2OiAnU29ja2V0IGlzIGFscmVhZHkgY29ubmVjdGVkJywKICAgICAgMTA3OiAnU29ja2V0IGlzIG5vdCBjb25uZWN0ZWQnLAogICAgICAxMDg6ICJDYW4ndCBzZW5kIGFmdGVyIHNvY2tldCBzaHV0ZG93biIsCiAgICAgIDEwOTogJ1RvbyBtYW55IHJlZmVyZW5jZXMnLAogICAgICAxMTA6ICdDb25uZWN0aW9uIHRpbWVkIG91dCcsCiAgICAgIDExMTogJ0Nvbm5lY3Rpb24gcmVmdXNlZCcsCiAgICAgIDExMjogJ0hvc3QgaXMgZG93bicsCiAgICAgIDExMzogJ0hvc3QgaXMgdW5yZWFjaGFibGUnLAogICAgICAxMTQ6ICdTb2NrZXQgYWxyZWFkeSBjb25uZWN0ZWQnLAogICAgICAxMTU6ICdDb25uZWN0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MnLAogICAgICAxMTY6ICdTdGFsZSBmaWxlIGhhbmRsZScsCiAgICAgIDEyMjogJ1F1b3RhIGV4Y2VlZGVkJywKICAgICAgMTIzOiAnTm8gbWVkaXVtIChpbiB0YXBlIGRyaXZlKScsCiAgICAgIDEyNTogJ09wZXJhdGlvbiBjYW5jZWxlZCcsCiAgICAgIDEzMDogJ1ByZXZpb3VzIG93bmVyIGRpZWQnLAogICAgICAxMzE6ICdTdGF0ZSBub3QgcmVjb3ZlcmFibGUnLAogICAgfTsKICAgIHZhciBQQVRIID0gewogICAgICBzcGxpdFBhdGg6IGZ1bmN0aW9uIChmaWxlbmFtZSkgewogICAgICAgIHZhciBzcGxpdFBhdGhSZSA9IC9eKFwvP3wpKFtcc1xTXSo/KSgoPzpcLnsxLDJ9fFteXC9dKz98KShcLlteLlwvXSp8KSkoPzpbXC9dKikkLzsKICAgICAgICByZXR1cm4gc3BsaXRQYXRoUmUuZXhlYyhmaWxlbmFtZSkuc2xpY2UoMSkKICAgICAgfSwKICAgICAgbm9ybWFsaXplQXJyYXk6IGZ1bmN0aW9uIChwYXJ0cywgYWxsb3dBYm92ZVJvb3QpIHsKICAgICAgICB2YXIgdXAgPSAwOwogICAgICAgIGZvciAodmFyIGkgPSBwYXJ0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgdmFyIGxhc3QgPSBwYXJ0c1tpXTsKICAgICAgICAgIGlmIChsYXN0ID09PSAnLicpIHsKICAgICAgICAgICAgcGFydHMuc3BsaWNlKGksIDEpOwogICAgICAgICAgfSBlbHNlIGlmIChsYXN0ID09PSAnLi4nKSB7CiAgICAgICAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgdXArKzsKICAgICAgICAgIH0gZWxzZSBpZiAodXApIHsKICAgICAgICAgICAgcGFydHMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB1cC0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYWxsb3dBYm92ZVJvb3QpIHsKICAgICAgICAgIGZvciAoOyB1cDsgdXAtLSkgewogICAgICAgICAgICBwYXJ0cy51bnNoaWZ0KCcuLicpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFydHMKICAgICAgfSwKICAgICAgbm9ybWFsaXplOiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHZhciBpc0Fic29sdXRlID0gcGF0aC5jaGFyQXQoMCkgPT09ICcvJywKICAgICAgICAgIHRyYWlsaW5nU2xhc2ggPSBwYXRoLnN1YnN0cigtMSkgPT09ICcvJzsKICAgICAgICBwYXRoID0gUEFUSC5ub3JtYWxpemVBcnJheSgKICAgICAgICAgIHBhdGguc3BsaXQoJy8nKS5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgcmV0dXJuICEhcAogICAgICAgICAgfSksCiAgICAgICAgICAhaXNBYnNvbHV0ZQogICAgICAgICkuam9pbignLycpOwogICAgICAgIGlmICghcGF0aCAmJiAhaXNBYnNvbHV0ZSkgewogICAgICAgICAgcGF0aCA9ICcuJzsKICAgICAgICB9CiAgICAgICAgaWYgKHBhdGggJiYgdHJhaWxpbmdTbGFzaCkgewogICAgICAgICAgcGF0aCArPSAnLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoaXNBYnNvbHV0ZSA/ICcvJyA6ICcnKSArIHBhdGgKICAgICAgfSwKICAgICAgZGlybmFtZTogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gUEFUSC5zcGxpdFBhdGgocGF0aCksCiAgICAgICAgICByb290ID0gcmVzdWx0WzBdLAogICAgICAgICAgZGlyID0gcmVzdWx0WzFdOwogICAgICAgIGlmICghcm9vdCAmJiAhZGlyKSB7CiAgICAgICAgICByZXR1cm4gJy4nCiAgICAgICAgfQogICAgICAgIGlmIChkaXIpIHsKICAgICAgICAgIGRpciA9IGRpci5zdWJzdHIoMCwgZGlyLmxlbmd0aCAtIDEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcm9vdCArIGRpcgogICAgICB9LAogICAgICBiYXNlbmFtZTogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICBpZiAocGF0aCA9PT0gJy8nKSByZXR1cm4gJy8nCiAgICAgICAgdmFyIGxhc3RTbGFzaCA9IHBhdGgubGFzdEluZGV4T2YoJy8nKTsKICAgICAgICBpZiAobGFzdFNsYXNoID09PSAtMSkgcmV0dXJuIHBhdGgKICAgICAgICByZXR1cm4gcGF0aC5zdWJzdHIobGFzdFNsYXNoICsgMSkKICAgICAgfSwKICAgICAgZXh0bmFtZTogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICByZXR1cm4gUEFUSC5zcGxpdFBhdGgocGF0aClbM10KICAgICAgfSwKICAgICAgam9pbjogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBwYXRocyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICAgICAgcmV0dXJuIFBBVEgubm9ybWFsaXplKHBhdGhzLmpvaW4oJy8nKSkKICAgICAgfSwKICAgICAgam9pbjI6IGZ1bmN0aW9uIChsLCByKSB7CiAgICAgICAgcmV0dXJuIFBBVEgubm9ybWFsaXplKGwgKyAnLycgKyByKQogICAgICB9LAogICAgICByZXNvbHZlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJlc29sdmVkUGF0aCA9ICcnLAogICAgICAgICAgcmVzb2x2ZWRBYnNvbHV0ZSA9IGZhbHNlOwogICAgICAgIGZvciAodmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSA+PSAtMSAmJiAhcmVzb2x2ZWRBYnNvbHV0ZTsgaS0tKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IGkgPj0gMCA/IGFyZ3VtZW50c1tpXSA6IEZTLmN3ZCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBwYXRoICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudHMgdG8gcGF0aC5yZXNvbHZlIG11c3QgYmUgc3RyaW5ncycpCiAgICAgICAgICB9IGVsc2UgaWYgKCFwYXRoKSB7CiAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgfQogICAgICAgICAgcmVzb2x2ZWRQYXRoID0gcGF0aCArICcvJyArIHJlc29sdmVkUGF0aDsKICAgICAgICAgIHJlc29sdmVkQWJzb2x1dGUgPSBwYXRoLmNoYXJBdCgwKSA9PT0gJy8nOwogICAgICAgIH0KICAgICAgICByZXNvbHZlZFBhdGggPSBQQVRILm5vcm1hbGl6ZUFycmF5KAogICAgICAgICAgcmVzb2x2ZWRQYXRoLnNwbGl0KCcvJykuZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgIHJldHVybiAhIXAKICAgICAgICAgIH0pLAogICAgICAgICAgIXJlc29sdmVkQWJzb2x1dGUKICAgICAgICApLmpvaW4oJy8nKTsKICAgICAgICByZXR1cm4gKHJlc29sdmVkQWJzb2x1dGUgPyAnLycgOiAnJykgKyByZXNvbHZlZFBhdGggfHwgJy4nCiAgICAgIH0sCiAgICAgIHJlbGF0aXZlOiBmdW5jdGlvbiAoZnJvbSwgdG8pIHsKICAgICAgICBmcm9tID0gUEFUSC5yZXNvbHZlKGZyb20pLnN1YnN0cigxKTsKICAgICAgICB0byA9IFBBVEgucmVzb2x2ZSh0bykuc3Vic3RyKDEpOwogICAgICAgIGZ1bmN0aW9uIHRyaW0oYXJyKSB7CiAgICAgICAgICB2YXIgc3RhcnQgPSAwOwogICAgICAgICAgZm9yICg7IHN0YXJ0IDwgYXJyLmxlbmd0aDsgc3RhcnQrKykgewogICAgICAgICAgICBpZiAoYXJyW3N0YXJ0XSAhPT0gJycpIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZW5kID0gYXJyLmxlbmd0aCAtIDE7CiAgICAgICAgICBmb3IgKDsgZW5kID49IDA7IGVuZC0tKSB7CiAgICAgICAgICAgIGlmIChhcnJbZW5kXSAhPT0gJycpIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhcnQgPiBlbmQpIHJldHVybiBbXQogICAgICAgICAgcmV0dXJuIGFyci5zbGljZShzdGFydCwgZW5kIC0gc3RhcnQgKyAxKQogICAgICAgIH0KICAgICAgICB2YXIgZnJvbVBhcnRzID0gdHJpbShmcm9tLnNwbGl0KCcvJykpOwogICAgICAgIHZhciB0b1BhcnRzID0gdHJpbSh0by5zcGxpdCgnLycpKTsKICAgICAgICB2YXIgbGVuZ3RoID0gTWF0aC5taW4oZnJvbVBhcnRzLmxlbmd0aCwgdG9QYXJ0cy5sZW5ndGgpOwogICAgICAgIHZhciBzYW1lUGFydHNMZW5ndGggPSBsZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGZyb21QYXJ0c1tpXSAhPT0gdG9QYXJ0c1tpXSkgewogICAgICAgICAgICBzYW1lUGFydHNMZW5ndGggPSBpOwogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgb3V0cHV0UGFydHMgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gc2FtZVBhcnRzTGVuZ3RoOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBvdXRwdXRQYXJ0cy5wdXNoKCcuLicpOwogICAgICAgIH0KICAgICAgICBvdXRwdXRQYXJ0cyA9IG91dHB1dFBhcnRzLmNvbmNhdCh0b1BhcnRzLnNsaWNlKHNhbWVQYXJ0c0xlbmd0aCkpOwogICAgICAgIHJldHVybiBvdXRwdXRQYXJ0cy5qb2luKCcvJykKICAgICAgfSwKICAgIH07CiAgICB2YXIgVFRZID0gewogICAgICB0dHlzOiBbXSwKICAgICAgaW5pdDogZnVuY3Rpb24gKCkge30sCiAgICAgIHNodXRkb3duOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uIChkZXYsIG9wcykgewogICAgICAgIFRUWS50dHlzW2Rldl0gPSB7IGlucHV0OiBbXSwgb3V0cHV0OiBbXSwgb3BzOiBvcHMgfTsKICAgICAgICBGUy5yZWdpc3RlckRldmljZShkZXYsIFRUWS5zdHJlYW1fb3BzKTsKICAgICAgfSwKICAgICAgc3RyZWFtX29wczogewogICAgICAgIG9wZW46IGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHZhciB0dHkgPSBUVFkudHR5c1tzdHJlYW0ubm9kZS5yZGV2XTsKICAgICAgICAgIGlmICghdHR5KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT0RFVikKICAgICAgICAgIH0KICAgICAgICAgIHN0cmVhbS50dHkgPSB0dHk7CiAgICAgICAgICBzdHJlYW0uc2Vla2FibGUgPSBmYWxzZTsKICAgICAgICB9LAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICBzdHJlYW0udHR5Lm9wcy5mbHVzaChzdHJlYW0udHR5KTsKICAgICAgICB9LAogICAgICAgIGZsdXNoOiBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICBzdHJlYW0udHR5Lm9wcy5mbHVzaChzdHJlYW0udHR5KTsKICAgICAgICB9LAogICAgICAgIHJlYWQ6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcykgewogICAgICAgICAgaWYgKCFzdHJlYW0udHR5IHx8ICFzdHJlYW0udHR5Lm9wcy5nZXRfY2hhcikgewogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTlhJTykKICAgICAgICAgIH0KICAgICAgICAgIHZhciBieXRlc1JlYWQgPSAwOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJlc3VsdCA9IHN0cmVhbS50dHkub3BzLmdldF9jaGFyKHN0cmVhbS50dHkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlPKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCAmJiBieXRlc1JlYWQgPT09IDApIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQUdBSU4pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5lZCkgYnJlYWsKICAgICAgICAgICAgYnl0ZXNSZWFkKys7CiAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChieXRlc1JlYWQpIHsKICAgICAgICAgICAgc3RyZWFtLm5vZGUudGltZXN0YW1wID0gRGF0ZS5ub3coKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBieXRlc1JlYWQKICAgICAgICB9LAogICAgICAgIHdyaXRlOiBmdW5jdGlvbiAoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3MpIHsKICAgICAgICAgIGlmICghc3RyZWFtLnR0eSB8fCAhc3RyZWFtLnR0eS5vcHMucHV0X2NoYXIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5YSU8pCiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgc3RyZWFtLnR0eS5vcHMucHV0X2NoYXIoc3RyZWFtLnR0eSwgYnVmZmVyW29mZnNldCArIGldKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTykKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGxlbmd0aCkgewogICAgICAgICAgICBzdHJlYW0ubm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGkKICAgICAgICB9LAogICAgICB9LAogICAgICBkZWZhdWx0X3R0eV9vcHM6IHsKICAgICAgICBnZXRfY2hhcjogZnVuY3Rpb24gKHR0eSkgewogICAgICAgICAgaWYgKCF0dHkuaW5wdXQubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBudWxsOwogICAgICAgICAgICBpZiAoRU5WSVJPTk1FTlRfSVNfTk9ERSkgewogICAgICAgICAgICAgIHZhciBCVUZTSVpFID0gMjU2OwogICAgICAgICAgICAgIHZhciBidWYgPSBuZXcgQnVmZmVyKEJVRlNJWkUpOwogICAgICAgICAgICAgIHZhciBieXRlc1JlYWQgPSAwOwogICAgICAgICAgICAgIHZhciBpc1Bvc2l4UGxhdGZvcm0gPSBwcm9jZXNzLnBsYXRmb3JtICE9ICd3aW4zMic7CiAgICAgICAgICAgICAgdmFyIGZkID0gcHJvY2Vzcy5zdGRpbi5mZDsKICAgICAgICAgICAgICBpZiAoaXNQb3NpeFBsYXRmb3JtKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNpbmdEZXZpY2UgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGZkID0gZnMub3BlblN5bmMoJy9kZXYvc3RkaW4nLCAncicpOwogICAgICAgICAgICAgICAgICB1c2luZ0RldmljZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gZnMucmVhZFN5bmMoZmQsIGJ1ZiwgMCwgQlVGU0laRSwgbnVsbCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKGUudG9TdHJpbmcoKS5pbmRleE9mKCdFT0YnKSAhPSAtMSkgYnl0ZXNSZWFkID0gMDsKICAgICAgICAgICAgICAgIGVsc2UgdGhyb3cgZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodXNpbmdEZXZpY2UpIHsKICAgICAgICAgICAgICAgIGZzLmNsb3NlU3luYyhmZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgPiAwKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBidWYuc2xpY2UoMCwgYnl0ZXNSZWFkKS50b1N0cmluZygndXRmLTgnKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93LnByb21wdCA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gd2luZG93LnByb21wdCgnSW5wdXQ6ICcpOwogICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXG4nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVhZGxpbmUgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgIHJlc3VsdCA9IHJlYWRsaW5lKCk7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVzdWx0ICs9ICdcbic7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzdWx0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0dHkuaW5wdXQgPSBpbnRBcnJheUZyb21TdHJpbmcocmVzdWx0LCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0dHkuaW5wdXQuc2hpZnQoKQogICAgICAgIH0sCiAgICAgICAgcHV0X2NoYXI6IGZ1bmN0aW9uICh0dHksIHZhbCkgewogICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IDEwKSB7CiAgICAgICAgICAgIE1vZHVsZVsncHJpbnQnXShVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7CiAgICAgICAgICAgIHR0eS5vdXRwdXQgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh2YWwgIT0gMCkgdHR5Lm91dHB1dC5wdXNoKHZhbCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmbHVzaDogZnVuY3Rpb24gKHR0eSkgewogICAgICAgICAgaWYgKHR0eS5vdXRwdXQgJiYgdHR5Lm91dHB1dC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIE1vZHVsZVsncHJpbnQnXShVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7CiAgICAgICAgICAgIHR0eS5vdXRwdXQgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICB9LAogICAgICBkZWZhdWx0X3R0eTFfb3BzOiB7CiAgICAgICAgcHV0X2NoYXI6IGZ1bmN0aW9uICh0dHksIHZhbCkgewogICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IDEwKSB7CiAgICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXShVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7CiAgICAgICAgICAgIHR0eS5vdXRwdXQgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh2YWwgIT0gMCkgdHR5Lm91dHB1dC5wdXNoKHZhbCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmbHVzaDogZnVuY3Rpb24gKHR0eSkgewogICAgICAgICAgaWYgKHR0eS5vdXRwdXQgJiYgdHR5Lm91dHB1dC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIE1vZHVsZVsncHJpbnRFcnInXShVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7CiAgICAgICAgICAgIHR0eS5vdXRwdXQgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICB9LAogICAgfTsKICAgIHZhciBNRU1GUyA9IHsKICAgICAgb3BzX3RhYmxlOiBudWxsLAogICAgICBtb3VudDogZnVuY3Rpb24gKG1vdW50KSB7CiAgICAgICAgcmV0dXJuIE1FTUZTLmNyZWF0ZU5vZGUobnVsbCwgJy8nLCAxNjM4NCB8IDUxMSwgMCkKICAgICAgfSwKICAgICAgY3JlYXRlTm9kZTogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2KSB7CiAgICAgICAgaWYgKEZTLmlzQmxrZGV2KG1vZGUpIHx8IEZTLmlzRklGTyhtb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVBFUk0pCiAgICAgICAgfQogICAgICAgIGlmICghTUVNRlMub3BzX3RhYmxlKSB7CiAgICAgICAgICBNRU1GUy5vcHNfdGFibGUgPSB7CiAgICAgICAgICAgIGRpcjogewogICAgICAgICAgICAgIG5vZGU6IHsKICAgICAgICAgICAgICAgIGdldGF0dHI6IE1FTUZTLm5vZGVfb3BzLmdldGF0dHIsCiAgICAgICAgICAgICAgICBzZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5zZXRhdHRyLAogICAgICAgICAgICAgICAgbG9va3VwOiBNRU1GUy5ub2RlX29wcy5sb29rdXAsCiAgICAgICAgICAgICAgICBta25vZDogTUVNRlMubm9kZV9vcHMubWtub2QsCiAgICAgICAgICAgICAgICByZW5hbWU6IE1FTUZTLm5vZGVfb3BzLnJlbmFtZSwKICAgICAgICAgICAgICAgIHVubGluazogTUVNRlMubm9kZV9vcHMudW5saW5rLAogICAgICAgICAgICAgICAgcm1kaXI6IE1FTUZTLm5vZGVfb3BzLnJtZGlyLAogICAgICAgICAgICAgICAgcmVhZGRpcjogTUVNRlMubm9kZV9vcHMucmVhZGRpciwKICAgICAgICAgICAgICAgIHN5bWxpbms6IE1FTUZTLm5vZGVfb3BzLnN5bWxpbmssCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdHJlYW06IHsgbGxzZWVrOiBNRU1GUy5zdHJlYW1fb3BzLmxsc2VlayB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBmaWxlOiB7CiAgICAgICAgICAgICAgbm9kZTogeyBnZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5nZXRhdHRyLCBzZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5zZXRhdHRyIH0sCiAgICAgICAgICAgICAgc3RyZWFtOiB7CiAgICAgICAgICAgICAgICBsbHNlZWs6IE1FTUZTLnN0cmVhbV9vcHMubGxzZWVrLAogICAgICAgICAgICAgICAgcmVhZDogTUVNRlMuc3RyZWFtX29wcy5yZWFkLAogICAgICAgICAgICAgICAgd3JpdGU6IE1FTUZTLnN0cmVhbV9vcHMud3JpdGUsCiAgICAgICAgICAgICAgICBhbGxvY2F0ZTogTUVNRlMuc3RyZWFtX29wcy5hbGxvY2F0ZSwKICAgICAgICAgICAgICAgIG1tYXA6IE1FTUZTLnN0cmVhbV9vcHMubW1hcCwKICAgICAgICAgICAgICAgIG1zeW5jOiBNRU1GUy5zdHJlYW1fb3BzLm1zeW5jLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxpbms6IHsKICAgICAgICAgICAgICBub2RlOiB7CiAgICAgICAgICAgICAgICBnZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5nZXRhdHRyLAogICAgICAgICAgICAgICAgc2V0YXR0cjogTUVNRlMubm9kZV9vcHMuc2V0YXR0ciwKICAgICAgICAgICAgICAgIHJlYWRsaW5rOiBNRU1GUy5ub2RlX29wcy5yZWFkbGluaywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHN0cmVhbToge30sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNocmRldjogewogICAgICAgICAgICAgIG5vZGU6IHsgZ2V0YXR0cjogTUVNRlMubm9kZV9vcHMuZ2V0YXR0ciwgc2V0YXR0cjogTUVNRlMubm9kZV9vcHMuc2V0YXR0ciB9LAogICAgICAgICAgICAgIHN0cmVhbTogRlMuY2hyZGV2X3N0cmVhbV9vcHMsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZU5vZGUocGFyZW50LCBuYW1lLCBtb2RlLCBkZXYpOwogICAgICAgIGlmIChGUy5pc0Rpcihub2RlLm1vZGUpKSB7CiAgICAgICAgICBub2RlLm5vZGVfb3BzID0gTUVNRlMub3BzX3RhYmxlLmRpci5ub2RlOwogICAgICAgICAgbm9kZS5zdHJlYW1fb3BzID0gTUVNRlMub3BzX3RhYmxlLmRpci5zdHJlYW07CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0ge307CiAgICAgICAgfSBlbHNlIGlmIChGUy5pc0ZpbGUobm9kZS5tb2RlKSkgewogICAgICAgICAgbm9kZS5ub2RlX29wcyA9IE1FTUZTLm9wc190YWJsZS5maWxlLm5vZGU7CiAgICAgICAgICBub2RlLnN0cmVhbV9vcHMgPSBNRU1GUy5vcHNfdGFibGUuZmlsZS5zdHJlYW07CiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IDA7CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKEZTLmlzTGluayhub2RlLm1vZGUpKSB7CiAgICAgICAgICBub2RlLm5vZGVfb3BzID0gTUVNRlMub3BzX3RhYmxlLmxpbmsubm9kZTsKICAgICAgICAgIG5vZGUuc3RyZWFtX29wcyA9IE1FTUZTLm9wc190YWJsZS5saW5rLnN0cmVhbTsKICAgICAgICB9IGVsc2UgaWYgKEZTLmlzQ2hyZGV2KG5vZGUubW9kZSkpIHsKICAgICAgICAgIG5vZGUubm9kZV9vcHMgPSBNRU1GUy5vcHNfdGFibGUuY2hyZGV2Lm5vZGU7CiAgICAgICAgICBub2RlLnN0cmVhbV9vcHMgPSBNRU1GUy5vcHNfdGFibGUuY2hyZGV2LnN0cmVhbTsKICAgICAgICB9CiAgICAgICAgbm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOwogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgIHBhcmVudC5jb250ZW50c1tuYW1lXSA9IG5vZGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBub2RlCiAgICAgIH0sCiAgICAgIGdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXk6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgaWYgKG5vZGUuY29udGVudHMgJiYgbm9kZS5jb250ZW50cy5zdWJhcnJheSkgewogICAgICAgICAgdmFyIGFyciA9IFtdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLnVzZWRCeXRlczsgKytpKSBhcnIucHVzaChub2RlLmNvbnRlbnRzW2ldKTsKICAgICAgICAgIHJldHVybiBhcnIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5vZGUuY29udGVudHMKICAgICAgfSwKICAgICAgZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXk6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzKSByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoKQogICAgICAgIGlmIChub2RlLmNvbnRlbnRzLnN1YmFycmF5KSByZXR1cm4gbm9kZS5jb250ZW50cy5zdWJhcnJheSgwLCBub2RlLnVzZWRCeXRlcykKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkobm9kZS5jb250ZW50cykKICAgICAgfSwKICAgICAgZXhwYW5kRmlsZVN0b3JhZ2U6IGZ1bmN0aW9uIChub2RlLCBuZXdDYXBhY2l0eSkgewogICAgICAgIGlmIChub2RlLmNvbnRlbnRzICYmIG5vZGUuY29udGVudHMuc3ViYXJyYXkgJiYgbmV3Q2FwYWNpdHkgPiBub2RlLmNvbnRlbnRzLmxlbmd0aCkgewogICAgICAgICAgbm9kZS5jb250ZW50cyA9IE1FTUZTLmdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXkobm9kZSk7CiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IG5vZGUuY29udGVudHMubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBpZiAoIW5vZGUuY29udGVudHMgfHwgbm9kZS5jb250ZW50cy5zdWJhcnJheSkgewogICAgICAgICAgdmFyIHByZXZDYXBhY2l0eSA9IG5vZGUuY29udGVudHMgPyBub2RlLmNvbnRlbnRzLmxlbmd0aCA6IDA7CiAgICAgICAgICBpZiAocHJldkNhcGFjaXR5ID49IG5ld0NhcGFjaXR5KSByZXR1cm4KICAgICAgICAgIHZhciBDQVBBQ0lUWV9ET1VCTElOR19NQVggPSAxMDI0ICogMTAyNDsKICAgICAgICAgIG5ld0NhcGFjaXR5ID0gTWF0aC5tYXgobmV3Q2FwYWNpdHksIChwcmV2Q2FwYWNpdHkgKiAocHJldkNhcGFjaXR5IDwgQ0FQQUNJVFlfRE9VQkxJTkdfTUFYID8gMiA6IDEuMTI1KSkgfCAwKTsKICAgICAgICAgIGlmIChwcmV2Q2FwYWNpdHkgIT0gMCkgbmV3Q2FwYWNpdHkgPSBNYXRoLm1heChuZXdDYXBhY2l0eSwgMjU2KTsKICAgICAgICAgIHZhciBvbGRDb250ZW50cyA9IG5vZGUuY29udGVudHM7CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gbmV3IFVpbnQ4QXJyYXkobmV3Q2FwYWNpdHkpOwogICAgICAgICAgaWYgKG5vZGUudXNlZEJ5dGVzID4gMCkgbm9kZS5jb250ZW50cy5zZXQob2xkQ29udGVudHMuc3ViYXJyYXkoMCwgbm9kZS51c2VkQnl0ZXMpLCAwKTsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBpZiAoIW5vZGUuY29udGVudHMgJiYgbmV3Q2FwYWNpdHkgPiAwKSBub2RlLmNvbnRlbnRzID0gW107CiAgICAgICAgd2hpbGUgKG5vZGUuY29udGVudHMubGVuZ3RoIDwgbmV3Q2FwYWNpdHkpIG5vZGUuY29udGVudHMucHVzaCgwKTsKICAgICAgfSwKICAgICAgcmVzaXplRmlsZVN0b3JhZ2U6IGZ1bmN0aW9uIChub2RlLCBuZXdTaXplKSB7CiAgICAgICAgaWYgKG5vZGUudXNlZEJ5dGVzID09IG5ld1NpemUpIHJldHVybgogICAgICAgIGlmIChuZXdTaXplID09IDApIHsKICAgICAgICAgIG5vZGUuY29udGVudHMgPSBudWxsOwogICAgICAgICAgbm9kZS51c2VkQnl0ZXMgPSAwOwogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGlmICghbm9kZS5jb250ZW50cyB8fCBub2RlLmNvbnRlbnRzLnN1YmFycmF5KSB7CiAgICAgICAgICB2YXIgb2xkQ29udGVudHMgPSBub2RlLmNvbnRlbnRzOwogICAgICAgICAgbm9kZS5jb250ZW50cyA9IG5ldyBVaW50OEFycmF5KG5ldyBBcnJheUJ1ZmZlcihuZXdTaXplKSk7CiAgICAgICAgICBpZiAob2xkQ29udGVudHMpIHsKICAgICAgICAgICAgbm9kZS5jb250ZW50cy5zZXQob2xkQ29udGVudHMuc3ViYXJyYXkoMCwgTWF0aC5taW4obmV3U2l6ZSwgbm9kZS51c2VkQnl0ZXMpKSk7CiAgICAgICAgICB9CiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IG5ld1NpemU7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzKSBub2RlLmNvbnRlbnRzID0gW107CiAgICAgICAgaWYgKG5vZGUuY29udGVudHMubGVuZ3RoID4gbmV3U2l6ZSkgbm9kZS5jb250ZW50cy5sZW5ndGggPSBuZXdTaXplOwogICAgICAgIGVsc2Ugd2hpbGUgKG5vZGUuY29udGVudHMubGVuZ3RoIDwgbmV3U2l6ZSkgbm9kZS5jb250ZW50cy5wdXNoKDApOwogICAgICAgIG5vZGUudXNlZEJ5dGVzID0gbmV3U2l6ZTsKICAgICAgfSwKICAgICAgbm9kZV9vcHM6IHsKICAgICAgICBnZXRhdHRyOiBmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgdmFyIGF0dHIgPSB7fTsKICAgICAgICAgIGF0dHIuZGV2ID0gRlMuaXNDaHJkZXYobm9kZS5tb2RlKSA/IG5vZGUuaWQgOiAxOwogICAgICAgICAgYXR0ci5pbm8gPSBub2RlLmlkOwogICAgICAgICAgYXR0ci5tb2RlID0gbm9kZS5tb2RlOwogICAgICAgICAgYXR0ci5ubGluayA9IDE7CiAgICAgICAgICBhdHRyLnVpZCA9IDA7CiAgICAgICAgICBhdHRyLmdpZCA9IDA7CiAgICAgICAgICBhdHRyLnJkZXYgPSBub2RlLnJkZXY7CiAgICAgICAgICBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgewogICAgICAgICAgICBhdHRyLnNpemUgPSA0MDk2OwogICAgICAgICAgfSBlbHNlIGlmIChGUy5pc0ZpbGUobm9kZS5tb2RlKSkgewogICAgICAgICAgICBhdHRyLnNpemUgPSBub2RlLnVzZWRCeXRlczsKICAgICAgICAgIH0gZWxzZSBpZiAoRlMuaXNMaW5rKG5vZGUubW9kZSkpIHsKICAgICAgICAgICAgYXR0ci5zaXplID0gbm9kZS5saW5rLmxlbmd0aDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGF0dHIuc2l6ZSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBhdHRyLmF0aW1lID0gbmV3IERhdGUobm9kZS50aW1lc3RhbXApOwogICAgICAgICAgYXR0ci5tdGltZSA9IG5ldyBEYXRlKG5vZGUudGltZXN0YW1wKTsKICAgICAgICAgIGF0dHIuY3RpbWUgPSBuZXcgRGF0ZShub2RlLnRpbWVzdGFtcCk7CiAgICAgICAgICBhdHRyLmJsa3NpemUgPSA0MDk2OwogICAgICAgICAgYXR0ci5ibG9ja3MgPSBNYXRoLmNlaWwoYXR0ci5zaXplIC8gYXR0ci5ibGtzaXplKTsKICAgICAgICAgIHJldHVybiBhdHRyCiAgICAgICAgfSwKICAgICAgICBzZXRhdHRyOiBmdW5jdGlvbiAobm9kZSwgYXR0cikgewogICAgICAgICAgaWYgKGF0dHIubW9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG5vZGUubW9kZSA9IGF0dHIubW9kZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhdHRyLnRpbWVzdGFtcCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG5vZGUudGltZXN0YW1wID0gYXR0ci50aW1lc3RhbXA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXR0ci5zaXplICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgTUVNRlMucmVzaXplRmlsZVN0b3JhZ2Uobm9kZSwgYXR0ci5zaXplKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvb2t1cDogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSkgewogICAgICAgICAgdGhyb3cgRlMuZ2VuZXJpY0Vycm9yc1tFUlJOT19DT0RFUy5FTk9FTlRdCiAgICAgICAgfSwKICAgICAgICBta25vZDogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2KSB7CiAgICAgICAgICByZXR1cm4gTUVNRlMuY3JlYXRlTm9kZShwYXJlbnQsIG5hbWUsIG1vZGUsIGRldikKICAgICAgICB9LAogICAgICAgIHJlbmFtZTogZnVuY3Rpb24gKG9sZF9ub2RlLCBuZXdfZGlyLCBuZXdfbmFtZSkgewogICAgICAgICAgaWYgKEZTLmlzRGlyKG9sZF9ub2RlLm1vZGUpKSB7CiAgICAgICAgICAgIHZhciBuZXdfbm9kZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBuZXdfbm9kZSA9IEZTLmxvb2t1cE5vZGUobmV3X2RpciwgbmV3X25hbWUpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICBpZiAobmV3X25vZGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIG5ld19ub2RlLmNvbnRlbnRzKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9URU1QVFkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgb2xkX25vZGUucGFyZW50LmNvbnRlbnRzW29sZF9ub2RlLm5hbWVdOwogICAgICAgICAgb2xkX25vZGUubmFtZSA9IG5ld19uYW1lOwogICAgICAgICAgbmV3X2Rpci5jb250ZW50c1tuZXdfbmFtZV0gPSBvbGRfbm9kZTsKICAgICAgICAgIG9sZF9ub2RlLnBhcmVudCA9IG5ld19kaXI7CiAgICAgICAgfSwKICAgICAgICB1bmxpbms6IGZ1bmN0aW9uIChwYXJlbnQsIG5hbWUpIHsKICAgICAgICAgIGRlbGV0ZSBwYXJlbnQuY29udGVudHNbbmFtZV07CiAgICAgICAgfSwKICAgICAgICBybWRpcjogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSkgewogICAgICAgICAgdmFyIG5vZGUgPSBGUy5sb29rdXBOb2RlKHBhcmVudCwgbmFtZSk7CiAgICAgICAgICBmb3IgKHZhciBpIGluIG5vZGUuY29udGVudHMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PVEVNUFRZKQogICAgICAgICAgfQogICAgICAgICAgZGVsZXRlIHBhcmVudC5jb250ZW50c1tuYW1lXTsKICAgICAgICB9LAogICAgICAgIHJlYWRkaXI6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICB2YXIgZW50cmllcyA9IFsnLicsICcuLiddOwogICAgICAgICAgZm9yICh2YXIga2V5IGluIG5vZGUuY29udGVudHMpIHsKICAgICAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVudHJpZXMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGVudHJpZXMKICAgICAgICB9LAogICAgICAgIHN5bWxpbms6IGZ1bmN0aW9uIChwYXJlbnQsIG5ld25hbWUsIG9sZHBhdGgpIHsKICAgICAgICAgIHZhciBub2RlID0gTUVNRlMuY3JlYXRlTm9kZShwYXJlbnQsIG5ld25hbWUsIDUxMSB8IDQwOTYwLCAwKTsKICAgICAgICAgIG5vZGUubGluayA9IG9sZHBhdGg7CiAgICAgICAgICByZXR1cm4gbm9kZQogICAgICAgIH0sCiAgICAgICAgcmVhZGxpbms6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICBpZiAoIUZTLmlzTGluayhub2RlLm1vZGUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBub2RlLmxpbmsKICAgICAgICB9LAogICAgICB9LAogICAgICBzdHJlYW1fb3BzOiB7CiAgICAgICAgcmVhZDogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICAgIHZhciBjb250ZW50cyA9IHN0cmVhbS5ub2RlLmNvbnRlbnRzOwogICAgICAgICAgaWYgKHBvc2l0aW9uID49IHN0cmVhbS5ub2RlLnVzZWRCeXRlcykgcmV0dXJuIDAKICAgICAgICAgIHZhciBzaXplID0gTWF0aC5taW4oc3RyZWFtLm5vZGUudXNlZEJ5dGVzIC0gcG9zaXRpb24sIGxlbmd0aCk7CiAgICAgICAgICBhc3NlcnQoc2l6ZSA+PSAwKTsKICAgICAgICAgIGlmIChzaXplID4gOCAmJiBjb250ZW50cy5zdWJhcnJheSkgewogICAgICAgICAgICBidWZmZXIuc2V0KGNvbnRlbnRzLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIHNpemUpLCBvZmZzZXQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGNvbnRlbnRzW3Bvc2l0aW9uICsgaV07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc2l6ZQogICAgICAgIH0sCiAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBjYW5Pd24pIHsKICAgICAgICAgIGlmICghbGVuZ3RoKSByZXR1cm4gMAogICAgICAgICAgdmFyIG5vZGUgPSBzdHJlYW0ubm9kZTsKICAgICAgICAgIG5vZGUudGltZXN0YW1wID0gRGF0ZS5ub3coKTsKICAgICAgICAgIGlmIChidWZmZXIuc3ViYXJyYXkgJiYgKCFub2RlLmNvbnRlbnRzIHx8IG5vZGUuY29udGVudHMuc3ViYXJyYXkpKSB7CiAgICAgICAgICAgIGlmIChjYW5Pd24pIHsKICAgICAgICAgICAgICBub2RlLmNvbnRlbnRzID0gYnVmZmVyLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IGxlbmd0aDsKICAgICAgICAgICAgICByZXR1cm4gbGVuZ3RoCiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS51c2VkQnl0ZXMgPT09IDAgJiYgcG9zaXRpb24gPT09IDApIHsKICAgICAgICAgICAgICBub2RlLmNvbnRlbnRzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKSk7CiAgICAgICAgICAgICAgbm9kZS51c2VkQnl0ZXMgPSBsZW5ndGg7CiAgICAgICAgICAgICAgcmV0dXJuIGxlbmd0aAogICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uICsgbGVuZ3RoIDw9IG5vZGUudXNlZEJ5dGVzKSB7CiAgICAgICAgICAgICAgbm9kZS5jb250ZW50cy5zZXQoYnVmZmVyLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKSwgcG9zaXRpb24pOwogICAgICAgICAgICAgIHJldHVybiBsZW5ndGgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgTUVNRlMuZXhwYW5kRmlsZVN0b3JhZ2Uobm9kZSwgcG9zaXRpb24gKyBsZW5ndGgpOwogICAgICAgICAgaWYgKG5vZGUuY29udGVudHMuc3ViYXJyYXkgJiYgYnVmZmVyLnN1YmFycmF5KQogICAgICAgICAgICBub2RlLmNvbnRlbnRzLnNldChidWZmZXIuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpLCBwb3NpdGlvbik7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIG5vZGUuY29udGVudHNbcG9zaXRpb24gKyBpXSA9IGJ1ZmZlcltvZmZzZXQgKyBpXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbm9kZS51c2VkQnl0ZXMgPSBNYXRoLm1heChub2RlLnVzZWRCeXRlcywgcG9zaXRpb24gKyBsZW5ndGgpOwogICAgICAgICAgcmV0dXJuIGxlbmd0aAogICAgICAgIH0sCiAgICAgICAgbGxzZWVrOiBmdW5jdGlvbiAoc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSkgewogICAgICAgICAgdmFyIHBvc2l0aW9uID0gb2Zmc2V0OwogICAgICAgICAgaWYgKHdoZW5jZSA9PT0gMSkgewogICAgICAgICAgICBwb3NpdGlvbiArPSBzdHJlYW0ucG9zaXRpb247CiAgICAgICAgICB9IGVsc2UgaWYgKHdoZW5jZSA9PT0gMikgewogICAgICAgICAgICBpZiAoRlMuaXNGaWxlKHN0cmVhbS5ub2RlLm1vZGUpKSB7CiAgICAgICAgICAgICAgcG9zaXRpb24gKz0gc3RyZWFtLm5vZGUudXNlZEJ5dGVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocG9zaXRpb24gPCAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwb3NpdGlvbgogICAgICAgIH0sCiAgICAgICAgYWxsb2NhdGU6IGZ1bmN0aW9uIChzdHJlYW0sIG9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgICBNRU1GUy5leHBhbmRGaWxlU3RvcmFnZShzdHJlYW0ubm9kZSwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgIHN0cmVhbS5ub2RlLnVzZWRCeXRlcyA9IE1hdGgubWF4KHN0cmVhbS5ub2RlLnVzZWRCeXRlcywgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICB9LAogICAgICAgIG1tYXA6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBwcm90LCBmbGFncykgewogICAgICAgICAgaWYgKCFGUy5pc0ZpbGUoc3RyZWFtLm5vZGUubW9kZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PREVWKQogICAgICAgICAgfQogICAgICAgICAgdmFyIHB0cjsKICAgICAgICAgIHZhciBhbGxvY2F0ZWQ7CiAgICAgICAgICB2YXIgY29udGVudHMgPSBzdHJlYW0ubm9kZS5jb250ZW50czsKICAgICAgICAgIGlmICghKGZsYWdzICYgMikgJiYgKGNvbnRlbnRzLmJ1ZmZlciA9PT0gYnVmZmVyIHx8IGNvbnRlbnRzLmJ1ZmZlciA9PT0gYnVmZmVyLmJ1ZmZlcikpIHsKICAgICAgICAgICAgYWxsb2NhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHB0ciA9IGNvbnRlbnRzLmJ5dGVPZmZzZXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAocG9zaXRpb24gPiAwIHx8IHBvc2l0aW9uICsgbGVuZ3RoIDwgc3RyZWFtLm5vZGUudXNlZEJ5dGVzKSB7CiAgICAgICAgICAgICAgaWYgKGNvbnRlbnRzLnN1YmFycmF5KSB7CiAgICAgICAgICAgICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIGxlbmd0aCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRlbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoY29udGVudHMsIHBvc2l0aW9uLCBwb3NpdGlvbiArIGxlbmd0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsbG9jYXRlZCA9IHRydWU7CiAgICAgICAgICAgIHB0ciA9IF9tYWxsb2MobGVuZ3RoKTsKICAgICAgICAgICAgaWYgKCFwdHIpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9NRU0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVmZmVyLnNldChjb250ZW50cywgcHRyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7IHB0cjogcHRyLCBhbGxvY2F0ZWQ6IGFsbG9jYXRlZCB9CiAgICAgICAgfSwKICAgICAgICBtc3luYzogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgbW1hcEZsYWdzKSB7CiAgICAgICAgICBpZiAoIUZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9ERVYpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAobW1hcEZsYWdzICYgMikgewogICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgfQogICAgICAgICAgTUVNRlMuc3RyZWFtX29wcy53cml0ZShzdHJlYW0sIGJ1ZmZlciwgMCwgbGVuZ3RoLCBvZmZzZXQsIGZhbHNlKTsKICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfSwKICAgICAgfSwKICAgIH07CiAgICB2YXIgSURCRlMgPSB7CiAgICAgIGRiczoge30sCiAgICAgIGluZGV4ZWREQjogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0eXBlb2YgaW5kZXhlZERCICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIGluZGV4ZWREQgogICAgICAgIHZhciByZXQgPSBudWxsOwogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykKICAgICAgICAgIHJldCA9IHdpbmRvdy5pbmRleGVkREIgfHwgd2luZG93Lm1vekluZGV4ZWREQiB8fCB3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8IHdpbmRvdy5tc0luZGV4ZWREQjsKICAgICAgICBhc3NlcnQocmV0LCAnSURCRlMgdXNlZCwgYnV0IGluZGV4ZWREQiBub3Qgc3VwcG9ydGVkJyk7CiAgICAgICAgcmV0dXJuIHJldAogICAgICB9LAogICAgICBEQl9WRVJTSU9OOiAyMSwKICAgICAgREJfU1RPUkVfTkFNRTogJ0ZJTEVfREFUQScsCiAgICAgIG1vdW50OiBmdW5jdGlvbiAobW91bnQpIHsKICAgICAgICByZXR1cm4gTUVNRlMubW91bnQuYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgICB9LAogICAgICBzeW5jZnM6IGZ1bmN0aW9uIChtb3VudCwgcG9wdWxhdGUsIGNhbGxiYWNrKSB7CiAgICAgICAgSURCRlMuZ2V0TG9jYWxTZXQobW91bnQsIGZ1bmN0aW9uIChlcnIsIGxvY2FsKSB7CiAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKQogICAgICAgICAgSURCRlMuZ2V0UmVtb3RlU2V0KG1vdW50LCBmdW5jdGlvbiAoZXJyLCByZW1vdGUpIHsKICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycikKICAgICAgICAgICAgdmFyIHNyYyA9IHBvcHVsYXRlID8gcmVtb3RlIDogbG9jYWw7CiAgICAgICAgICAgIHZhciBkc3QgPSBwb3B1bGF0ZSA/IGxvY2FsIDogcmVtb3RlOwogICAgICAgICAgICBJREJGUy5yZWNvbmNpbGUoc3JjLCBkc3QsIGNhbGxiYWNrKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXREQjogZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIGRiID0gSURCRlMuZGJzW25hbWVdOwogICAgICAgIGlmIChkYikgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGRiKQogICAgICAgIH0KICAgICAgICB2YXIgcmVxOwogICAgICAgIHRyeSB7CiAgICAgICAgICByZXEgPSBJREJGUy5pbmRleGVkREIoKS5vcGVuKG5hbWUsIElEQkZTLkRCX1ZFUlNJT04pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlKQogICAgICAgIH0KICAgICAgICBpZiAoIXJlcSkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCdVbmFibGUgdG8gY29ubmVjdCB0byBJbmRleGVkREInKQogICAgICAgIH0KICAgICAgICByZXEub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBkYiA9IGUudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGUudGFyZ2V0LnRyYW5zYWN0aW9uOwogICAgICAgICAgdmFyIGZpbGVTdG9yZTsKICAgICAgICAgIGlmIChkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKElEQkZTLkRCX1NUT1JFX05BTUUpKSB7CiAgICAgICAgICAgIGZpbGVTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKElEQkZTLkRCX1NUT1JFX05BTUUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlsZVN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoSURCRlMuREJfU1RPUkVfTkFNRSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWZpbGVTdG9yZS5pbmRleE5hbWVzLmNvbnRhaW5zKCd0aW1lc3RhbXAnKSkgewogICAgICAgICAgICBmaWxlU3RvcmUuY3JlYXRlSW5kZXgoJ3RpbWVzdGFtcCcsICd0aW1lc3RhbXAnLCB7IHVuaXF1ZTogZmFsc2UgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXEub25zdWNjZXNzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgZGIgPSByZXEucmVzdWx0OwogICAgICAgICAgSURCRlMuZGJzW25hbWVdID0gZGI7CiAgICAgICAgICBjYWxsYmFjayhudWxsLCBkYik7CiAgICAgICAgfTsKICAgICAgICByZXEub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjYWxsYmFjayh0aGlzLmVycm9yKTsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwogICAgICB9LAogICAgICBnZXRMb2NhbFNldDogZnVuY3Rpb24gKG1vdW50LCBjYWxsYmFjaykgewogICAgICAgIHZhciBlbnRyaWVzID0ge307CiAgICAgICAgZnVuY3Rpb24gaXNSZWFsRGlyKHApIHsKICAgICAgICAgIHJldHVybiBwICE9PSAnLicgJiYgcCAhPT0gJy4uJwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0b0Fic29sdXRlKHJvb3QpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocCkgewogICAgICAgICAgICByZXR1cm4gUEFUSC5qb2luMihyb290LCBwKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgY2hlY2sgPSBGUy5yZWFkZGlyKG1vdW50Lm1vdW50cG9pbnQpLmZpbHRlcihpc1JlYWxEaXIpLm1hcCh0b0Fic29sdXRlKG1vdW50Lm1vdW50cG9pbnQpKTsKICAgICAgICB3aGlsZSAoY2hlY2subGVuZ3RoKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IGNoZWNrLnBvcCgpOwogICAgICAgICAgdmFyIHN0YXQ7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBzdGF0ID0gRlMuc3RhdChwYXRoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGUpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoRlMuaXNEaXIoc3RhdC5tb2RlKSkgewogICAgICAgICAgICBjaGVjay5wdXNoLmFwcGx5KGNoZWNrLCBGUy5yZWFkZGlyKHBhdGgpLmZpbHRlcihpc1JlYWxEaXIpLm1hcCh0b0Fic29sdXRlKHBhdGgpKSk7CiAgICAgICAgICB9CiAgICAgICAgICBlbnRyaWVzW3BhdGhdID0geyB0aW1lc3RhbXA6IHN0YXQubXRpbWUgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHsgdHlwZTogJ2xvY2FsJywgZW50cmllczogZW50cmllcyB9KQogICAgICB9LAogICAgICBnZXRSZW1vdGVTZXQ6IGZ1bmN0aW9uIChtb3VudCwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgZW50cmllcyA9IHt9OwogICAgICAgIElEQkZTLmdldERCKG1vdW50Lm1vdW50cG9pbnQsIGZ1bmN0aW9uIChlcnIsIGRiKSB7CiAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW0lEQkZTLkRCX1NUT1JFX05BTUVdLCAncmVhZG9ubHknKTsKICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5lcnJvcik7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShJREJGUy5EQl9TVE9SRV9OQU1FKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gc3RvcmUuaW5kZXgoJ3RpbWVzdGFtcCcpOwogICAgICAgICAgICBpbmRleC5vcGVuS2V5Q3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgaWYgKCFjdXJzb3IpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7IHR5cGU6ICdyZW1vdGUnLCBkYjogZGIsIGVudHJpZXM6IGVudHJpZXMgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZW50cmllc1tjdXJzb3IucHJpbWFyeUtleV0gPSB7IHRpbWVzdGFtcDogY3Vyc29yLmtleSB9OwogICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZSkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgbG9hZExvY2FsRW50cnk6IGZ1bmN0aW9uIChwYXRoLCBjYWxsYmFjaykgewogICAgICAgIHZhciBzdGF0LCBub2RlOwogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoKTsKICAgICAgICAgIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICAgIHN0YXQgPSBGUy5zdGF0KHBhdGgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNEaXIoc3RhdC5tb2RlKSkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHsgdGltZXN0YW1wOiBzdGF0Lm10aW1lLCBtb2RlOiBzdGF0Lm1vZGUgfSkKICAgICAgICB9IGVsc2UgaWYgKEZTLmlzRmlsZShzdGF0Lm1vZGUpKSB7CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gTUVNRlMuZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXkobm9kZSk7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgeyB0aW1lc3RhbXA6IHN0YXQubXRpbWUsIG1vZGU6IHN0YXQubW9kZSwgY29udGVudHM6IG5vZGUuY29udGVudHMgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcignbm9kZSB0eXBlIG5vdCBzdXBwb3J0ZWQnKSkKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHN0b3JlTG9jYWxFbnRyeTogZnVuY3Rpb24gKHBhdGgsIGVudHJ5LCBjYWxsYmFjaykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoRlMuaXNEaXIoZW50cnkubW9kZSkpIHsKICAgICAgICAgICAgRlMubWtkaXIocGF0aCwgZW50cnkubW9kZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKEZTLmlzRmlsZShlbnRyeS5tb2RlKSkgewogICAgICAgICAgICBGUy53cml0ZUZpbGUocGF0aCwgZW50cnkuY29udGVudHMsIHsgY2FuT3duOiB0cnVlIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcignbm9kZSB0eXBlIG5vdCBzdXBwb3J0ZWQnKSkKICAgICAgICAgIH0KICAgICAgICAgIEZTLmNobW9kKHBhdGgsIGVudHJ5Lm1vZGUpOwogICAgICAgICAgRlMudXRpbWUocGF0aCwgZW50cnkudGltZXN0YW1wLCBlbnRyeS50aW1lc3RhbXApOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlKQogICAgICAgIH0KICAgICAgICBjYWxsYmFjayhudWxsKTsKICAgICAgfSwKICAgICAgcmVtb3ZlTG9jYWxFbnRyeTogZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgpOwogICAgICAgICAgdmFyIHN0YXQgPSBGUy5zdGF0KHBhdGgpOwogICAgICAgICAgaWYgKEZTLmlzRGlyKHN0YXQubW9kZSkpIHsKICAgICAgICAgICAgRlMucm1kaXIocGF0aCk7CiAgICAgICAgICB9IGVsc2UgaWYgKEZTLmlzRmlsZShzdGF0Lm1vZGUpKSB7CiAgICAgICAgICAgIEZTLnVubGluayhwYXRoKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZSkKICAgICAgICB9CiAgICAgICAgY2FsbGJhY2sobnVsbCk7CiAgICAgIH0sCiAgICAgIGxvYWRSZW1vdGVFbnRyeTogZnVuY3Rpb24gKHN0b3JlLCBwYXRoLCBjYWxsYmFjaykgewogICAgICAgIHZhciByZXEgPSBzdG9yZS5nZXQocGF0aCk7CiAgICAgICAgcmVxLm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgY2FsbGJhY2sobnVsbCwgZXZlbnQudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgICByZXEub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjYWxsYmFjayh0aGlzLmVycm9yKTsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwogICAgICB9LAogICAgICBzdG9yZVJlbW90ZUVudHJ5OiBmdW5jdGlvbiAoc3RvcmUsIHBhdGgsIGVudHJ5LCBjYWxsYmFjaykgewogICAgICAgIHZhciByZXEgPSBzdG9yZS5wdXQoZW50cnksIHBhdGgpOwogICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjYWxsYmFjayhudWxsKTsKICAgICAgICB9OwogICAgICAgIHJlcS5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGNhbGxiYWNrKHRoaXMuZXJyb3IpOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHJlbW92ZVJlbW90ZUVudHJ5OiBmdW5jdGlvbiAoc3RvcmUsIHBhdGgsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIHJlcSA9IHN0b3JlLmRlbGV0ZShwYXRoKTsKICAgICAgICByZXEub25zdWNjZXNzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY2FsbGJhY2sobnVsbCk7CiAgICAgICAgfTsKICAgICAgICByZXEub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjYWxsYmFjayh0aGlzLmVycm9yKTsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9OwogICAgICB9LAogICAgICByZWNvbmNpbGU6IGZ1bmN0aW9uIChzcmMsIGRzdCwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgdG90YWwgPSAwOwogICAgICAgIHZhciBjcmVhdGUgPSBbXTsKICAgICAgICBPYmplY3Qua2V5cyhzcmMuZW50cmllcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICB2YXIgZSA9IHNyYy5lbnRyaWVzW2tleV07CiAgICAgICAgICB2YXIgZTIgPSBkc3QuZW50cmllc1trZXldOwogICAgICAgICAgaWYgKCFlMiB8fCBlLnRpbWVzdGFtcCA+IGUyLnRpbWVzdGFtcCkgewogICAgICAgICAgICBjcmVhdGUucHVzaChrZXkpOwogICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciByZW1vdmUgPSBbXTsKICAgICAgICBPYmplY3Qua2V5cyhkc3QuZW50cmllcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICBkc3QuZW50cmllc1trZXldOwogICAgICAgICAgdmFyIGUyID0gc3JjLmVudHJpZXNba2V5XTsKICAgICAgICAgIGlmICghZTIpIHsKICAgICAgICAgICAgcmVtb3ZlLnB1c2goa2V5KTsKICAgICAgICAgICAgdG90YWwrKzsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoIXRvdGFsKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCkKICAgICAgICB9CiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IDA7CiAgICAgICAgdmFyIGRiID0gc3JjLnR5cGUgPT09ICdyZW1vdGUnID8gc3JjLmRiIDogZHN0LmRiOwogICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFtJREJGUy5EQl9TVE9SRV9OQU1FXSwgJ3JlYWR3cml0ZScpOwogICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKElEQkZTLkRCX1NUT1JFX05BTUUpOwogICAgICAgIGZ1bmN0aW9uIGRvbmUoZXJyKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIGlmICghZG9uZS5lcnJvcmVkKSB7CiAgICAgICAgICAgICAgZG9uZS5lcnJvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgfQogICAgICAgICAgaWYgKCsrY29tcGxldGVkID49IHRvdGFsKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0cmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGRvbmUodGhpcy5lcnJvcik7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfTsKICAgICAgICBjcmVhdGUuc29ydCgpLmZvckVhY2goZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICAgIGlmIChkc3QudHlwZSA9PT0gJ2xvY2FsJykgewogICAgICAgICAgICBJREJGUy5sb2FkUmVtb3RlRW50cnkoc3RvcmUsIHBhdGgsIGZ1bmN0aW9uIChlcnIsIGVudHJ5KSB7CiAgICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIGRvbmUoZXJyKQogICAgICAgICAgICAgIElEQkZTLnN0b3JlTG9jYWxFbnRyeShwYXRoLCBlbnRyeSwgZG9uZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSURCRlMubG9hZExvY2FsRW50cnkocGF0aCwgZnVuY3Rpb24gKGVyciwgZW50cnkpIHsKICAgICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gZG9uZShlcnIpCiAgICAgICAgICAgICAgSURCRlMuc3RvcmVSZW1vdGVFbnRyeShzdG9yZSwgcGF0aCwgZW50cnksIGRvbmUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZW1vdmUKICAgICAgICAgIC5zb3J0KCkKICAgICAgICAgIC5yZXZlcnNlKCkKICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgICAgIGlmIChkc3QudHlwZSA9PT0gJ2xvY2FsJykgewogICAgICAgICAgICAgIElEQkZTLnJlbW92ZUxvY2FsRW50cnkocGF0aCwgZG9uZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgSURCRlMucmVtb3ZlUmVtb3RlRW50cnkoc3RvcmUsIHBhdGgsIGRvbmUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSwKICAgIH07CiAgICB2YXIgTk9ERUZTID0gewogICAgICBpc1dpbmRvd3M6IGZhbHNlLAogICAgICBzdGF0aWNJbml0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgTk9ERUZTLmlzV2luZG93cyA9ICEhcHJvY2Vzcy5wbGF0Zm9ybS5tYXRjaCgvXndpbi8pOwogICAgICAgIHZhciBmbGFncyA9IHByb2Nlc3NbJ2JpbmRpbmcnXSgnY29uc3RhbnRzJyk7CiAgICAgICAgaWYgKGZsYWdzWydmcyddKSB7CiAgICAgICAgICBmbGFncyA9IGZsYWdzWydmcyddOwogICAgICAgIH0KICAgICAgICBOT0RFRlMuZmxhZ3NGb3JOb2RlTWFwID0gewogICAgICAgICAgMTAyNDogZmxhZ3NbJ09fQVBQRU5EJ10sCiAgICAgICAgICA2NDogZmxhZ3NbJ09fQ1JFQVQnXSwKICAgICAgICAgIDEyODogZmxhZ3NbJ09fRVhDTCddLAogICAgICAgICAgMDogZmxhZ3NbJ09fUkRPTkxZJ10sCiAgICAgICAgICAyOiBmbGFnc1snT19SRFdSJ10sCiAgICAgICAgICA0MDk2OiBmbGFnc1snT19TWU5DJ10sCiAgICAgICAgICA1MTI6IGZsYWdzWydPX1RSVU5DJ10sCiAgICAgICAgICAxOiBmbGFnc1snT19XUk9OTFknXSwKICAgICAgICB9OwogICAgICB9LAogICAgICBidWZmZXJGcm9tOiBmdW5jdGlvbiAoYXJyYXlCdWZmZXIpIHsKICAgICAgICByZXR1cm4gQnVmZmVyLmFsbG9jID8gQnVmZmVyLmZyb20oYXJyYXlCdWZmZXIpIDogbmV3IEJ1ZmZlcihhcnJheUJ1ZmZlcikKICAgICAgfSwKICAgICAgbW91bnQ6IGZ1bmN0aW9uIChtb3VudCkgewogICAgICAgIGFzc2VydChFTlZJUk9OTUVOVF9JU19OT0RFKTsKICAgICAgICByZXR1cm4gTk9ERUZTLmNyZWF0ZU5vZGUobnVsbCwgJy8nLCBOT0RFRlMuZ2V0TW9kZShtb3VudC5vcHRzLnJvb3QpLCAwKQogICAgICB9LAogICAgICBjcmVhdGVOb2RlOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lLCBtb2RlLCBkZXYpIHsKICAgICAgICBpZiAoIUZTLmlzRGlyKG1vZGUpICYmICFGUy5pc0ZpbGUobW9kZSkgJiYgIUZTLmlzTGluayhtb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZU5vZGUocGFyZW50LCBuYW1lLCBtb2RlKTsKICAgICAgICBub2RlLm5vZGVfb3BzID0gTk9ERUZTLm5vZGVfb3BzOwogICAgICAgIG5vZGUuc3RyZWFtX29wcyA9IE5PREVGUy5zdHJlYW1fb3BzOwogICAgICAgIHJldHVybiBub2RlCiAgICAgIH0sCiAgICAgIGdldE1vZGU6IGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgdmFyIHN0YXQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHN0YXQgPSBmcy5sc3RhdFN5bmMocGF0aCk7CiAgICAgICAgICBpZiAoTk9ERUZTLmlzV2luZG93cykgewogICAgICAgICAgICBzdGF0Lm1vZGUgPSBzdGF0Lm1vZGUgfCAoKHN0YXQubW9kZSAmIDI5MikgPj4gMik7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGUKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGF0Lm1vZGUKICAgICAgfSwKICAgICAgcmVhbFBhdGg6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgdmFyIHBhcnRzID0gW107CiAgICAgICAgd2hpbGUgKG5vZGUucGFyZW50ICE9PSBub2RlKSB7CiAgICAgICAgICBwYXJ0cy5wdXNoKG5vZGUubmFtZSk7CiAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7CiAgICAgICAgfQogICAgICAgIHBhcnRzLnB1c2gobm9kZS5tb3VudC5vcHRzLnJvb3QpOwogICAgICAgIHBhcnRzLnJldmVyc2UoKTsKICAgICAgICByZXR1cm4gUEFUSC5qb2luLmFwcGx5KG51bGwsIHBhcnRzKQogICAgICB9LAogICAgICBmbGFnc0Zvck5vZGU6IGZ1bmN0aW9uIChmbGFncykgewogICAgICAgIGZsYWdzICY9IH4yMDk3MTUyOwogICAgICAgIGZsYWdzICY9IH4yMDQ4OwogICAgICAgIGZsYWdzICY9IH4zMjc2ODsKICAgICAgICBmbGFncyAmPSB+NTI0Mjg4OwogICAgICAgIHZhciBuZXdGbGFncyA9IDA7CiAgICAgICAgZm9yICh2YXIgayBpbiBOT0RFRlMuZmxhZ3NGb3JOb2RlTWFwKSB7CiAgICAgICAgICBpZiAoZmxhZ3MgJiBrKSB7CiAgICAgICAgICAgIG5ld0ZsYWdzIHw9IE5PREVGUy5mbGFnc0Zvck5vZGVNYXBba107CiAgICAgICAgICAgIGZsYWdzIF49IGs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZmxhZ3MpIHsKICAgICAgICAgIHJldHVybiBuZXdGbGFncwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU5WQUwpCiAgICAgICAgfQogICAgICB9LAogICAgICBub2RlX29wczogewogICAgICAgIGdldGF0dHI6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IE5PREVGUy5yZWFsUGF0aChub2RlKTsKICAgICAgICAgIHZhciBzdGF0OwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RhdCA9IGZzLmxzdGF0U3luYyhwYXRoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGUKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVNbZS5jb2RlXSkKICAgICAgICAgIH0KICAgICAgICAgIGlmIChOT0RFRlMuaXNXaW5kb3dzICYmICFzdGF0LmJsa3NpemUpIHsKICAgICAgICAgICAgc3RhdC5ibGtzaXplID0gNDA5NjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChOT0RFRlMuaXNXaW5kb3dzICYmICFzdGF0LmJsb2NrcykgewogICAgICAgICAgICBzdGF0LmJsb2NrcyA9ICgoc3RhdC5zaXplICsgc3RhdC5ibGtzaXplIC0gMSkgLyBzdGF0LmJsa3NpemUpIHwgMDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRldjogc3RhdC5kZXYsCiAgICAgICAgICAgIGlubzogc3RhdC5pbm8sCiAgICAgICAgICAgIG1vZGU6IHN0YXQubW9kZSwKICAgICAgICAgICAgbmxpbms6IHN0YXQubmxpbmssCiAgICAgICAgICAgIHVpZDogc3RhdC51aWQsCiAgICAgICAgICAgIGdpZDogc3RhdC5naWQsCiAgICAgICAgICAgIHJkZXY6IHN0YXQucmRldiwKICAgICAgICAgICAgc2l6ZTogc3RhdC5zaXplLAogICAgICAgICAgICBhdGltZTogc3RhdC5hdGltZSwKICAgICAgICAgICAgbXRpbWU6IHN0YXQubXRpbWUsCiAgICAgICAgICAgIGN0aW1lOiBzdGF0LmN0aW1lLAogICAgICAgICAgICBibGtzaXplOiBzdGF0LmJsa3NpemUsCiAgICAgICAgICAgIGJsb2Nrczogc3RhdC5ibG9ja3MsCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRhdHRyOiBmdW5jdGlvbiAobm9kZSwgYXR0cikgewogICAgICAgICAgdmFyIHBhdGggPSBOT0RFRlMucmVhbFBhdGgobm9kZSk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoYXR0ci5tb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBmcy5jaG1vZFN5bmMocGF0aCwgYXR0ci5tb2RlKTsKICAgICAgICAgICAgICBub2RlLm1vZGUgPSBhdHRyLm1vZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF0dHIudGltZXN0YW1wICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGF0dHIudGltZXN0YW1wKTsKICAgICAgICAgICAgICBmcy51dGltZXNTeW5jKHBhdGgsIGRhdGUsIGRhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhdHRyLnNpemUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGZzLnRydW5jYXRlU3luYyhwYXRoLCBhdHRyLnNpemUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsb29rdXA6IGZ1bmN0aW9uIChwYXJlbnQsIG5hbWUpIHsKICAgICAgICAgIHZhciBwYXRoID0gUEFUSC5qb2luMihOT0RFRlMucmVhbFBhdGgocGFyZW50KSwgbmFtZSk7CiAgICAgICAgICB2YXIgbW9kZSA9IE5PREVGUy5nZXRNb2RlKHBhdGgpOwogICAgICAgICAgcmV0dXJuIE5PREVGUy5jcmVhdGVOb2RlKHBhcmVudCwgbmFtZSwgbW9kZSkKICAgICAgICB9LAogICAgICAgIG1rbm9kOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lLCBtb2RlLCBkZXYpIHsKICAgICAgICAgIHZhciBub2RlID0gTk9ERUZTLmNyZWF0ZU5vZGUocGFyZW50LCBuYW1lLCBtb2RlLCBkZXYpOwogICAgICAgICAgdmFyIHBhdGggPSBOT0RFRlMucmVhbFBhdGgobm9kZSk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgewogICAgICAgICAgICAgIGZzLm1rZGlyU3luYyhwYXRoLCBub2RlLm1vZGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMocGF0aCwgJycsIHsgbW9kZTogbm9kZS5tb2RlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbm9kZQogICAgICAgIH0sCiAgICAgICAgcmVuYW1lOiBmdW5jdGlvbiAob2xkTm9kZSwgbmV3RGlyLCBuZXdOYW1lKSB7CiAgICAgICAgICB2YXIgb2xkUGF0aCA9IE5PREVGUy5yZWFsUGF0aChvbGROb2RlKTsKICAgICAgICAgIHZhciBuZXdQYXRoID0gUEFUSC5qb2luMihOT0RFRlMucmVhbFBhdGgobmV3RGlyKSwgbmV3TmFtZSk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmcy5yZW5hbWVTeW5jKG9sZFBhdGgsIG5ld1BhdGgpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFU1tlLmNvZGVdKQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgdW5saW5rOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IFBBVEguam9pbjIoTk9ERUZTLnJlYWxQYXRoKHBhcmVudCksIG5hbWUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZnMudW5saW5rU3luYyhwYXRoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGUKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVNbZS5jb2RlXSkKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJtZGlyOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IFBBVEguam9pbjIoTk9ERUZTLnJlYWxQYXRoKHBhcmVudCksIG5hbWUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZnMucm1kaXJTeW5jKHBhdGgpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoIWUuY29kZSkgdGhyb3cgZQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFU1tlLmNvZGVdKQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVhZGRpcjogZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgIHZhciBwYXRoID0gTk9ERUZTLnJlYWxQYXRoKG5vZGUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWRkaXJTeW5jKHBhdGgpCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzeW1saW5rOiBmdW5jdGlvbiAocGFyZW50LCBuZXdOYW1lLCBvbGRQYXRoKSB7CiAgICAgICAgICB2YXIgbmV3UGF0aCA9IFBBVEguam9pbjIoTk9ERUZTLnJlYWxQYXRoKHBhcmVudCksIG5ld05hbWUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZnMuc3ltbGlua1N5bmMob2xkUGF0aCwgbmV3UGF0aCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZWFkbGluazogZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgIHZhciBwYXRoID0gTk9ERUZTLnJlYWxQYXRoKG5vZGUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcGF0aCA9IGZzLnJlYWRsaW5rU3luYyhwYXRoKTsKICAgICAgICAgICAgcGF0aCA9IE5PREVKU19QQVRILnJlbGF0aXZlKE5PREVKU19QQVRILnJlc29sdmUobm9kZS5tb3VudC5vcHRzLnJvb3QpLCBwYXRoKTsKICAgICAgICAgICAgcmV0dXJuIHBhdGgKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKCFlLmNvZGUpIHRocm93IGUKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVNbZS5jb2RlXSkKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICB9LAogICAgICBzdHJlYW1fb3BzOiB7CiAgICAgICAgb3BlbjogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIHBhdGggPSBOT0RFRlMucmVhbFBhdGgoc3RyZWFtLm5vZGUpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKEZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSkgewogICAgICAgICAgICAgIHN0cmVhbS5uZmQgPSBmcy5vcGVuU3luYyhwYXRoLCBOT0RFRlMuZmxhZ3NGb3JOb2RlKHN0cmVhbS5mbGFncykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbG9zZTogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKEZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSAmJiBzdHJlYW0ubmZkKSB7CiAgICAgICAgICAgICAgZnMuY2xvc2VTeW5jKHN0cmVhbS5uZmQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICghZS5jb2RlKSB0aHJvdyBlCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZWFkOiBmdW5jdGlvbiAoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgICAgaWYgKGxlbmd0aCA9PT0gMCkgcmV0dXJuIDAKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBmcy5yZWFkU3luYyhzdHJlYW0ubmZkLCBOT0RFRlMuYnVmZmVyRnJvbShidWZmZXIuYnVmZmVyKSwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKQogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFU1tlLmNvZGVdKQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZnMud3JpdGVTeW5jKHN0cmVhbS5uZmQsIE5PREVGUy5idWZmZXJGcm9tKGJ1ZmZlci5idWZmZXIpLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTW2UuY29kZV0pCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsbHNlZWs6IGZ1bmN0aW9uIChzdHJlYW0sIG9mZnNldCwgd2hlbmNlKSB7CiAgICAgICAgICB2YXIgcG9zaXRpb24gPSBvZmZzZXQ7CiAgICAgICAgICBpZiAod2hlbmNlID09PSAxKSB7CiAgICAgICAgICAgIHBvc2l0aW9uICs9IHN0cmVhbS5wb3NpdGlvbjsKICAgICAgICAgIH0gZWxzZSBpZiAod2hlbmNlID09PSAyKSB7CiAgICAgICAgICAgIGlmIChGUy5pc0ZpbGUoc3RyZWFtLm5vZGUubW9kZSkpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIHN0YXQgPSBmcy5mc3RhdFN5bmMoc3RyZWFtLm5mZCk7CiAgICAgICAgICAgICAgICBwb3NpdGlvbiArPSBzdGF0LnNpemU7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVNbZS5jb2RlXSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChwb3NpdGlvbiA8IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHBvc2l0aW9uCiAgICAgICAgfSwKICAgICAgfSwKICAgIH07CiAgICB2YXIgV09SS0VSRlMgPSB7CiAgICAgIERJUl9NT0RFOiAxNjg5NSwKICAgICAgRklMRV9NT0RFOiAzMzI3OSwKICAgICAgcmVhZGVyOiBudWxsLAogICAgICBtb3VudDogZnVuY3Rpb24gKG1vdW50KSB7CiAgICAgICAgYXNzZXJ0KEVOVklST05NRU5UX0lTX1dPUktFUik7CiAgICAgICAgaWYgKCFXT1JLRVJGUy5yZWFkZXIpIFdPUktFUkZTLnJlYWRlciA9IG5ldyBGaWxlUmVhZGVyU3luYygpOwogICAgICAgIHZhciByb290ID0gV09SS0VSRlMuY3JlYXRlTm9kZShudWxsLCAnLycsIFdPUktFUkZTLkRJUl9NT0RFLCAwKTsKICAgICAgICB2YXIgY3JlYXRlZFBhcmVudHMgPSB7fTsKICAgICAgICBmdW5jdGlvbiBlbnN1cmVQYXJlbnQocGF0aCkgewogICAgICAgICAgdmFyIHBhcnRzID0gcGF0aC5zcGxpdCgnLycpOwogICAgICAgICAgdmFyIHBhcmVudCA9IHJvb3Q7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgICB2YXIgY3VyciA9IHBhcnRzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcvJyk7CiAgICAgICAgICAgIGlmICghY3JlYXRlZFBhcmVudHNbY3Vycl0pIHsKICAgICAgICAgICAgICBjcmVhdGVkUGFyZW50c1tjdXJyXSA9IFdPUktFUkZTLmNyZWF0ZU5vZGUocGFyZW50LCBwYXJ0c1tpXSwgV09SS0VSRlMuRElSX01PREUsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcmVudCA9IGNyZWF0ZWRQYXJlbnRzW2N1cnJdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHBhcmVudAogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlKHBhdGgpIHsKICAgICAgICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoJy8nKTsKICAgICAgICAgIHJldHVybiBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXQogICAgICAgIH0KICAgICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG1vdW50Lm9wdHNbJ2ZpbGVzJ10gfHwgW10sIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICBXT1JLRVJGUy5jcmVhdGVOb2RlKAogICAgICAgICAgICBlbnN1cmVQYXJlbnQoZmlsZS5uYW1lKSwKICAgICAgICAgICAgYmFzZShmaWxlLm5hbWUpLAogICAgICAgICAgICBXT1JLRVJGUy5GSUxFX01PREUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZpbGUsCiAgICAgICAgICAgIGZpbGUubGFzdE1vZGlmaWVkRGF0ZQogICAgICAgICAgKTsKICAgICAgICB9KQogICAgICAgIDsobW91bnQub3B0c1snYmxvYnMnXSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICBXT1JLRVJGUy5jcmVhdGVOb2RlKGVuc3VyZVBhcmVudChvYmpbJ25hbWUnXSksIGJhc2Uob2JqWyduYW1lJ10pLCBXT1JLRVJGUy5GSUxFX01PREUsIDAsIG9ialsnZGF0YSddKTsKICAgICAgICB9KQogICAgICAgIDsobW91bnQub3B0c1sncGFja2FnZXMnXSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAocGFjaykgewogICAgICAgICAgcGFja1snbWV0YWRhdGEnXS5maWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICAgIHZhciBuYW1lID0gZmlsZS5maWxlbmFtZS5zdWJzdHIoMSk7CiAgICAgICAgICAgIFdPUktFUkZTLmNyZWF0ZU5vZGUoCiAgICAgICAgICAgICAgZW5zdXJlUGFyZW50KG5hbWUpLAogICAgICAgICAgICAgIGJhc2UobmFtZSksCiAgICAgICAgICAgICAgV09SS0VSRlMuRklMRV9NT0RFLAogICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgcGFja1snYmxvYiddLnNsaWNlKGZpbGUuc3RhcnQsIGZpbGUuZW5kKQogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJvb3QKICAgICAgfSwKICAgICAgY3JlYXRlTm9kZTogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2LCBjb250ZW50cywgbXRpbWUpIHsKICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZU5vZGUocGFyZW50LCBuYW1lLCBtb2RlKTsKICAgICAgICBub2RlLm1vZGUgPSBtb2RlOwogICAgICAgIG5vZGUubm9kZV9vcHMgPSBXT1JLRVJGUy5ub2RlX29wczsKICAgICAgICBub2RlLnN0cmVhbV9vcHMgPSBXT1JLRVJGUy5zdHJlYW1fb3BzOwogICAgICAgIG5vZGUudGltZXN0YW1wID0gKG10aW1lIHx8IG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKICAgICAgICBhc3NlcnQoV09SS0VSRlMuRklMRV9NT0RFICE9PSBXT1JLRVJGUy5ESVJfTU9ERSk7CiAgICAgICAgaWYgKG1vZGUgPT09IFdPUktFUkZTLkZJTEVfTU9ERSkgewogICAgICAgICAgbm9kZS5zaXplID0gY29udGVudHMuc2l6ZTsKICAgICAgICAgIG5vZGUuY29udGVudHMgPSBjb250ZW50czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm9kZS5zaXplID0gNDA5NjsKICAgICAgICAgIG5vZGUuY29udGVudHMgPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgcGFyZW50LmNvbnRlbnRzW25hbWVdID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5vZGUKICAgICAgfSwKICAgICAgbm9kZV9vcHM6IHsKICAgICAgICBnZXRhdHRyOiBmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGV2OiAxLAogICAgICAgICAgICBpbm86IHVuZGVmaW5lZCwKICAgICAgICAgICAgbW9kZTogbm9kZS5tb2RlLAogICAgICAgICAgICBubGluazogMSwKICAgICAgICAgICAgdWlkOiAwLAogICAgICAgICAgICBnaWQ6IDAsCiAgICAgICAgICAgIHJkZXY6IHVuZGVmaW5lZCwKICAgICAgICAgICAgc2l6ZTogbm9kZS5zaXplLAogICAgICAgICAgICBhdGltZTogbmV3IERhdGUobm9kZS50aW1lc3RhbXApLAogICAgICAgICAgICBtdGltZTogbmV3IERhdGUobm9kZS50aW1lc3RhbXApLAogICAgICAgICAgICBjdGltZTogbmV3IERhdGUobm9kZS50aW1lc3RhbXApLAogICAgICAgICAgICBibGtzaXplOiA0MDk2LAogICAgICAgICAgICBibG9ja3M6IE1hdGguY2VpbChub2RlLnNpemUgLyA0MDk2KSwKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldGF0dHI6IGZ1bmN0aW9uIChub2RlLCBhdHRyKSB7CiAgICAgICAgICBpZiAoYXR0ci5tb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbm9kZS5tb2RlID0gYXR0ci5tb2RlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGF0dHIudGltZXN0YW1wICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbm9kZS50aW1lc3RhbXAgPSBhdHRyLnRpbWVzdGFtcDsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxvb2t1cDogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PRU5UKQogICAgICAgIH0sCiAgICAgICAgbWtub2Q6IGZ1bmN0aW9uIChwYXJlbnQsIG5hbWUsIG1vZGUsIGRldikgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVBFUk0pCiAgICAgICAgfSwKICAgICAgICByZW5hbWU6IGZ1bmN0aW9uIChvbGROb2RlLCBuZXdEaXIsIG5ld05hbWUpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVQRVJNKQogICAgICAgIH0sCiAgICAgICAgdW5saW5rOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9LAogICAgICAgIHJtZGlyOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9LAogICAgICAgIHJlYWRkaXI6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICB2YXIgZW50cmllcyA9IFsnLicsICcuLiddOwogICAgICAgICAgZm9yICh2YXIga2V5IGluIG5vZGUuY29udGVudHMpIHsKICAgICAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVudHJpZXMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGVudHJpZXMKICAgICAgICB9LAogICAgICAgIHN5bWxpbms6IGZ1bmN0aW9uIChwYXJlbnQsIG5ld05hbWUsIG9sZFBhdGgpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVQRVJNKQogICAgICAgIH0sCiAgICAgICAgcmVhZGxpbms6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9LAogICAgICB9LAogICAgICBzdHJlYW1fb3BzOiB7CiAgICAgICAgcmVhZDogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICAgIGlmIChwb3NpdGlvbiA+PSBzdHJlYW0ubm9kZS5zaXplKSByZXR1cm4gMAogICAgICAgICAgdmFyIGNodW5rID0gc3RyZWFtLm5vZGUuY29udGVudHMuc2xpY2UocG9zaXRpb24sIHBvc2l0aW9uICsgbGVuZ3RoKTsKICAgICAgICAgIHZhciBhYiA9IFdPUktFUkZTLnJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihjaHVuayk7CiAgICAgICAgICBidWZmZXIuc2V0KG5ldyBVaW50OEFycmF5KGFiKSwgb2Zmc2V0KTsKICAgICAgICAgIHJldHVybiBjaHVuay5zaXplCiAgICAgICAgfSwKICAgICAgICB3cml0ZTogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTykKICAgICAgICB9LAogICAgICAgIGxsc2VlazogZnVuY3Rpb24gKHN0cmVhbSwgb2Zmc2V0LCB3aGVuY2UpIHsKICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG9mZnNldDsKICAgICAgICAgIGlmICh3aGVuY2UgPT09IDEpIHsKICAgICAgICAgICAgcG9zaXRpb24gKz0gc3RyZWFtLnBvc2l0aW9uOwogICAgICAgICAgfSBlbHNlIGlmICh3aGVuY2UgPT09IDIpIHsKICAgICAgICAgICAgaWYgKEZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSkgewogICAgICAgICAgICAgIHBvc2l0aW9uICs9IHN0cmVhbS5ub2RlLnNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChwb3NpdGlvbiA8IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHBvc2l0aW9uCiAgICAgICAgfSwKICAgICAgfSwKICAgIH07CiAgICBTVEFUSUNUT1AgKz0gMTY7CiAgICBTVEFUSUNUT1AgKz0gMTY7CiAgICBTVEFUSUNUT1AgKz0gMTY7CiAgICB2YXIgRlMgPSB7CiAgICAgIHJvb3Q6IG51bGwsCiAgICAgIG1vdW50czogW10sCiAgICAgIGRldmljZXM6IHt9LAogICAgICBzdHJlYW1zOiBbXSwKICAgICAgbmV4dElub2RlOiAxLAogICAgICBuYW1lVGFibGU6IG51bGwsCiAgICAgIGN1cnJlbnRQYXRoOiAnLycsCiAgICAgIGluaXRpYWxpemVkOiBmYWxzZSwKICAgICAgaWdub3JlUGVybWlzc2lvbnM6IHRydWUsCiAgICAgIHRyYWNraW5nRGVsZWdhdGU6IHt9LAogICAgICB0cmFja2luZzogeyBvcGVuRmxhZ3M6IHsgUkVBRDogMSwgV1JJVEU6IDIgfSB9LAogICAgICBFcnJub0Vycm9yOiBudWxsLAogICAgICBnZW5lcmljRXJyb3JzOiB7fSwKICAgICAgZmlsZXN5c3RlbXM6IG51bGwsCiAgICAgIHN5bmNGU1JlcXVlc3RzOiAwLAogICAgICBoYW5kbGVGU0Vycm9yOiBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgdGhyb3cgZSArICcgOiAnICsgc3RhY2tUcmFjZSgpCiAgICAgICAgcmV0dXJuIF9fX3NldEVyck5vKGUuZXJybm8pCiAgICAgIH0sCiAgICAgIGxvb2t1cFBhdGg6IGZ1bmN0aW9uIChwYXRoLCBvcHRzKSB7CiAgICAgICAgcGF0aCA9IFBBVEgucmVzb2x2ZShGUy5jd2QoKSwgcGF0aCk7CiAgICAgICAgb3B0cyA9IG9wdHMgfHwge307CiAgICAgICAgaWYgKCFwYXRoKSByZXR1cm4geyBwYXRoOiAnJywgbm9kZTogbnVsbCB9CiAgICAgICAgdmFyIGRlZmF1bHRzID0geyBmb2xsb3dfbW91bnQ6IHRydWUsIHJlY3Vyc2VfY291bnQ6IDAgfTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGVmYXVsdHMpIHsKICAgICAgICAgIGlmIChvcHRzW2tleV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBvcHRzW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob3B0cy5yZWN1cnNlX2NvdW50ID4gOCkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUxPT1ApCiAgICAgICAgfQogICAgICAgIHZhciBwYXJ0cyA9IFBBVEgubm9ybWFsaXplQXJyYXkoCiAgICAgICAgICBwYXRoLnNwbGl0KCcvJykuZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgIHJldHVybiAhIXAKICAgICAgICAgIH0pLAogICAgICAgICAgZmFsc2UKICAgICAgICApOwogICAgICAgIHZhciBjdXJyZW50ID0gRlMucm9vdDsKICAgICAgICB2YXIgY3VycmVudF9wYXRoID0gJy8nOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBpc2xhc3QgPSBpID09PSBwYXJ0cy5sZW5ndGggLSAxOwogICAgICAgICAgaWYgKGlzbGFzdCAmJiBvcHRzLnBhcmVudCkgewogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgICAgY3VycmVudCA9IEZTLmxvb2t1cE5vZGUoY3VycmVudCwgcGFydHNbaV0pOwogICAgICAgICAgY3VycmVudF9wYXRoID0gUEFUSC5qb2luMihjdXJyZW50X3BhdGgsIHBhcnRzW2ldKTsKICAgICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQoY3VycmVudCkpIHsKICAgICAgICAgICAgaWYgKCFpc2xhc3QgfHwgKGlzbGFzdCAmJiBvcHRzLmZvbGxvd19tb3VudCkpIHsKICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5tb3VudGVkLnJvb3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNsYXN0IHx8IG9wdHMuZm9sbG93KSB7CiAgICAgICAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChGUy5pc0xpbmsoY3VycmVudC5tb2RlKSkgewogICAgICAgICAgICAgIHZhciBsaW5rID0gRlMucmVhZGxpbmsoY3VycmVudF9wYXRoKTsKICAgICAgICAgICAgICBjdXJyZW50X3BhdGggPSBQQVRILnJlc29sdmUoUEFUSC5kaXJuYW1lKGN1cnJlbnRfcGF0aCksIGxpbmspOwogICAgICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKGN1cnJlbnRfcGF0aCwgeyByZWN1cnNlX2NvdW50OiBvcHRzLnJlY3Vyc2VfY291bnQgfSk7CiAgICAgICAgICAgICAgY3VycmVudCA9IGxvb2t1cC5ub2RlOwogICAgICAgICAgICAgIGlmIChjb3VudCsrID4gNDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVMT09QKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4geyBwYXRoOiBjdXJyZW50X3BhdGgsIG5vZGU6IGN1cnJlbnQgfQogICAgICB9LAogICAgICBnZXRQYXRoOiBmdW5jdGlvbiAobm9kZSkgewogICAgICAgIHZhciBwYXRoOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpZiAoRlMuaXNSb290KG5vZGUpKSB7CiAgICAgICAgICAgIHZhciBtb3VudCA9IG5vZGUubW91bnQubW91bnRwb2ludDsKICAgICAgICAgICAgaWYgKCFwYXRoKSByZXR1cm4gbW91bnQKICAgICAgICAgICAgcmV0dXJuIG1vdW50W21vdW50Lmxlbmd0aCAtIDFdICE9PSAnLycgPyBtb3VudCArICcvJyArIHBhdGggOiBtb3VudCArIHBhdGgKICAgICAgICAgIH0KICAgICAgICAgIHBhdGggPSBwYXRoID8gbm9kZS5uYW1lICsgJy8nICsgcGF0aCA6IG5vZGUubmFtZTsKICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhhc2hOYW1lOiBmdW5jdGlvbiAocGFyZW50aWQsIG5hbWUpIHsKICAgICAgICB2YXIgaGFzaCA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuYW1lLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCArIG5hbWUuY2hhckNvZGVBdChpKSkgfCAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKChwYXJlbnRpZCArIGhhc2gpID4+PiAwKSAlIEZTLm5hbWVUYWJsZS5sZW5ndGgKICAgICAgfSwKICAgICAgaGFzaEFkZE5vZGU6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgdmFyIGhhc2ggPSBGUy5oYXNoTmFtZShub2RlLnBhcmVudC5pZCwgbm9kZS5uYW1lKTsKICAgICAgICBub2RlLm5hbWVfbmV4dCA9IEZTLm5hbWVUYWJsZVtoYXNoXTsKICAgICAgICBGUy5uYW1lVGFibGVbaGFzaF0gPSBub2RlOwogICAgICB9LAogICAgICBoYXNoUmVtb3ZlTm9kZTogZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICB2YXIgaGFzaCA9IEZTLmhhc2hOYW1lKG5vZGUucGFyZW50LmlkLCBub2RlLm5hbWUpOwogICAgICAgIGlmIChGUy5uYW1lVGFibGVbaGFzaF0gPT09IG5vZGUpIHsKICAgICAgICAgIEZTLm5hbWVUYWJsZVtoYXNoXSA9IG5vZGUubmFtZV9uZXh0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgY3VycmVudCA9IEZTLm5hbWVUYWJsZVtoYXNoXTsKICAgICAgICAgIHdoaWxlIChjdXJyZW50KSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50Lm5hbWVfbmV4dCA9PT0gbm9kZSkgewogICAgICAgICAgICAgIGN1cnJlbnQubmFtZV9uZXh0ID0gbm9kZS5uYW1lX25leHQ7CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5uYW1lX25leHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBsb29rdXBOb2RlOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgdmFyIGVyciA9IEZTLm1heUxvb2t1cChwYXJlbnQpOwogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVyciwgcGFyZW50KQogICAgICAgIH0KICAgICAgICB2YXIgaGFzaCA9IEZTLmhhc2hOYW1lKHBhcmVudC5pZCwgbmFtZSk7CiAgICAgICAgZm9yICh2YXIgbm9kZSA9IEZTLm5hbWVUYWJsZVtoYXNoXTsgbm9kZTsgbm9kZSA9IG5vZGUubmFtZV9uZXh0KSB7CiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLm5hbWU7CiAgICAgICAgICBpZiAobm9kZS5wYXJlbnQuaWQgPT09IHBhcmVudC5pZCAmJiBub2RlTmFtZSA9PT0gbmFtZSkgewogICAgICAgICAgICByZXR1cm4gbm9kZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gRlMubG9va3VwKHBhcmVudCwgbmFtZSkKICAgICAgfSwKICAgICAgY3JlYXRlTm9kZTogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgbW9kZSwgcmRldikgewogICAgICAgIGlmICghRlMuRlNOb2RlKSB7CiAgICAgICAgICBGUy5GU05vZGUgPSBmdW5jdGlvbiAocGFyZW50LCBuYW1lLCBtb2RlLCByZGV2KSB7CiAgICAgICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICAgICAgcGFyZW50ID0gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgICAgICAgICAgdGhpcy5tb3VudCA9IHBhcmVudC5tb3VudDsKICAgICAgICAgICAgdGhpcy5tb3VudGVkID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5pZCA9IEZTLm5leHRJbm9kZSsrOwogICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICB0aGlzLm1vZGUgPSBtb2RlOwogICAgICAgICAgICB0aGlzLm5vZGVfb3BzID0ge307CiAgICAgICAgICAgIHRoaXMuc3RyZWFtX29wcyA9IHt9OwogICAgICAgICAgICB0aGlzLnJkZXYgPSByZGV2OwogICAgICAgICAgfTsKICAgICAgICAgIEZTLkZTTm9kZS5wcm90b3R5cGUgPSB7fTsKICAgICAgICAgIHZhciByZWFkTW9kZSA9IDI5MiB8IDczOwogICAgICAgICAgdmFyIHdyaXRlTW9kZSA9IDE0NjsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEZTLkZTTm9kZS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgcmVhZDogewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLm1vZGUgJiByZWFkTW9kZSkgPT09IHJlYWRNb2RlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHZhbCA/ICh0aGlzLm1vZGUgfD0gcmVhZE1vZGUpIDogKHRoaXMubW9kZSAmPSB+cmVhZE1vZGUpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHdyaXRlOiB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMubW9kZSAmIHdyaXRlTW9kZSkgPT09IHdyaXRlTW9kZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPyAodGhpcy5tb2RlIHw9IHdyaXRlTW9kZSkgOiAodGhpcy5tb2RlICY9IH53cml0ZU1vZGUpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzRm9sZGVyOiB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRlMuaXNEaXIodGhpcy5tb2RlKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzRGV2aWNlOiB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRlMuaXNDaHJkZXYodGhpcy5tb2RlKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdmFyIG5vZGUgPSBuZXcgRlMuRlNOb2RlKHBhcmVudCwgbmFtZSwgbW9kZSwgcmRldik7CiAgICAgICAgRlMuaGFzaEFkZE5vZGUobm9kZSk7CiAgICAgICAgcmV0dXJuIG5vZGUKICAgICAgfSwKICAgICAgZGVzdHJveU5vZGU6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgRlMuaGFzaFJlbW92ZU5vZGUobm9kZSk7CiAgICAgIH0sCiAgICAgIGlzUm9vdDogZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZSA9PT0gbm9kZS5wYXJlbnQKICAgICAgfSwKICAgICAgaXNNb3VudHBvaW50OiBmdW5jdGlvbiAobm9kZSkgewogICAgICAgIHJldHVybiAhIW5vZGUubW91bnRlZAogICAgICB9LAogICAgICBpc0ZpbGU6IGZ1bmN0aW9uIChtb2RlKSB7CiAgICAgICAgcmV0dXJuIChtb2RlICYgNjE0NDApID09PSAzMjc2OAogICAgICB9LAogICAgICBpc0RpcjogZnVuY3Rpb24gKG1vZGUpIHsKICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDE2Mzg0CiAgICAgIH0sCiAgICAgIGlzTGluazogZnVuY3Rpb24gKG1vZGUpIHsKICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDQwOTYwCiAgICAgIH0sCiAgICAgIGlzQ2hyZGV2OiBmdW5jdGlvbiAobW9kZSkgewogICAgICAgIHJldHVybiAobW9kZSAmIDYxNDQwKSA9PT0gODE5MgogICAgICB9LAogICAgICBpc0Jsa2RldjogZnVuY3Rpb24gKG1vZGUpIHsKICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDI0NTc2CiAgICAgIH0sCiAgICAgIGlzRklGTzogZnVuY3Rpb24gKG1vZGUpIHsKICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDQwOTYKICAgICAgfSwKICAgICAgaXNTb2NrZXQ6IGZ1bmN0aW9uIChtb2RlKSB7CiAgICAgICAgcmV0dXJuIChtb2RlICYgNDkxNTIpID09PSA0OTE1MgogICAgICB9LAogICAgICBmbGFnTW9kZXM6IHsKICAgICAgICByOiAwLAogICAgICAgIHJzOiAxMDUyNjcyLAogICAgICAgICdyKyc6IDIsCiAgICAgICAgdzogNTc3LAogICAgICAgIHd4OiA3MDUsCiAgICAgICAgeHc6IDcwNSwKICAgICAgICAndysnOiA1NzgsCiAgICAgICAgJ3d4Kyc6IDcwNiwKICAgICAgICAneHcrJzogNzA2LAogICAgICAgIGE6IDEwODksCiAgICAgICAgYXg6IDEyMTcsCiAgICAgICAgeGE6IDEyMTcsCiAgICAgICAgJ2ErJzogMTA5MCwKICAgICAgICAnYXgrJzogMTIxOCwKICAgICAgICAneGErJzogMTIxOCwKICAgICAgfSwKICAgICAgbW9kZVN0cmluZ1RvRmxhZ3M6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICB2YXIgZmxhZ3MgPSBGUy5mbGFnTW9kZXNbc3RyXTsKICAgICAgICBpZiAodHlwZW9mIGZsYWdzID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGZpbGUgb3BlbiBtb2RlOiAnICsgc3RyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmxhZ3MKICAgICAgfSwKICAgICAgZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmc6IGZ1bmN0aW9uIChmbGFnKSB7CiAgICAgICAgdmFyIHBlcm1zID0gWydyJywgJ3cnLCAncncnXVtmbGFnICYgM107CiAgICAgICAgaWYgKGZsYWcgJiA1MTIpIHsKICAgICAgICAgIHBlcm1zICs9ICd3JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBlcm1zCiAgICAgIH0sCiAgICAgIG5vZGVQZXJtaXNzaW9uczogZnVuY3Rpb24gKG5vZGUsIHBlcm1zKSB7CiAgICAgICAgaWYgKEZTLmlnbm9yZVBlcm1pc3Npb25zKSB7CiAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgICBpZiAocGVybXMuaW5kZXhPZigncicpICE9PSAtMSAmJiAhKG5vZGUubW9kZSAmIDI5MikpIHsKICAgICAgICAgIHJldHVybiBFUlJOT19DT0RFUy5FQUNDRVMKICAgICAgICB9IGVsc2UgaWYgKHBlcm1zLmluZGV4T2YoJ3cnKSAhPT0gLTEgJiYgIShub2RlLm1vZGUgJiAxNDYpKSB7CiAgICAgICAgICByZXR1cm4gRVJSTk9fQ09ERVMuRUFDQ0VTCiAgICAgICAgfSBlbHNlIGlmIChwZXJtcy5pbmRleE9mKCd4JykgIT09IC0xICYmICEobm9kZS5tb2RlICYgNzMpKSB7CiAgICAgICAgICByZXR1cm4gRVJSTk9fQ09ERVMuRUFDQ0VTCiAgICAgICAgfQogICAgICAgIHJldHVybiAwCiAgICAgIH0sCiAgICAgIG1heUxvb2t1cDogZnVuY3Rpb24gKGRpcikgewogICAgICAgIHZhciBlcnIgPSBGUy5ub2RlUGVybWlzc2lvbnMoZGlyLCAneCcpOwogICAgICAgIGlmIChlcnIpIHJldHVybiBlcnIKICAgICAgICBpZiAoIWRpci5ub2RlX29wcy5sb29rdXApIHJldHVybiBFUlJOT19DT0RFUy5FQUNDRVMKICAgICAgICByZXR1cm4gMAogICAgICB9LAogICAgICBtYXlDcmVhdGU6IGZ1bmN0aW9uIChkaXIsIG5hbWUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIG5vZGUgPSBGUy5sb29rdXBOb2RlKGRpciwgbmFtZSk7CiAgICAgICAgICByZXR1cm4gRVJSTk9fQ09ERVMuRUVYSVNUCiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICByZXR1cm4gRlMubm9kZVBlcm1pc3Npb25zKGRpciwgJ3d4JykKICAgICAgfSwKICAgICAgbWF5RGVsZXRlOiBmdW5jdGlvbiAoZGlyLCBuYW1lLCBpc2RpcikgewogICAgICAgIHZhciBub2RlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBub2RlID0gRlMubG9va3VwTm9kZShkaXIsIG5hbWUpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBlLmVycm5vCiAgICAgICAgfQogICAgICAgIHZhciBlcnIgPSBGUy5ub2RlUGVybWlzc2lvbnMoZGlyLCAnd3gnKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZXR1cm4gZXJyCiAgICAgICAgfQogICAgICAgIGlmIChpc2RpcikgewogICAgICAgICAgaWYgKCFGUy5pc0Rpcihub2RlLm1vZGUpKSB7CiAgICAgICAgICAgIHJldHVybiBFUlJOT19DT0RFUy5FTk9URElSCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoRlMuaXNSb290KG5vZGUpIHx8IEZTLmdldFBhdGgobm9kZSkgPT09IEZTLmN3ZCgpKSB7CiAgICAgICAgICAgIHJldHVybiBFUlJOT19DT0RFUy5FQlVTWQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgewogICAgICAgICAgICByZXR1cm4gRVJSTk9fQ09ERVMuRUlTRElSCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwCiAgICAgIH0sCiAgICAgIG1heU9wZW46IGZ1bmN0aW9uIChub2RlLCBmbGFncykgewogICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgcmV0dXJuIEVSUk5PX0NPREVTLkVOT0VOVAogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNMaW5rKG5vZGUubW9kZSkpIHsKICAgICAgICAgIHJldHVybiBFUlJOT19DT0RFUy5FTE9PUAogICAgICAgIH0gZWxzZSBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgewogICAgICAgICAgaWYgKEZTLmZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nKGZsYWdzKSAhPT0gJ3InIHx8IGZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgIHJldHVybiBFUlJOT19DT0RFUy5FSVNESVIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIEZTLm5vZGVQZXJtaXNzaW9ucyhub2RlLCBGUy5mbGFnc1RvUGVybWlzc2lvblN0cmluZyhmbGFncykpCiAgICAgIH0sCiAgICAgIE1BWF9PUEVOX0ZEUzogNDA5NiwKICAgICAgbmV4dGZkOiBmdW5jdGlvbiAoZmRfc3RhcnQsIGZkX2VuZCkgewogICAgICAgIGZkX3N0YXJ0ID0gZmRfc3RhcnQgfHwgMDsKICAgICAgICBmZF9lbmQgPSBmZF9lbmQgfHwgRlMuTUFYX09QRU5fRkRTOwogICAgICAgIGZvciAodmFyIGZkID0gZmRfc3RhcnQ7IGZkIDw9IGZkX2VuZDsgZmQrKykgewogICAgICAgICAgaWYgKCFGUy5zdHJlYW1zW2ZkXSkgewogICAgICAgICAgICByZXR1cm4gZmQKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU1GSUxFKQogICAgICB9LAogICAgICBnZXRTdHJlYW06IGZ1bmN0aW9uIChmZCkgewogICAgICAgIHJldHVybiBGUy5zdHJlYW1zW2ZkXQogICAgICB9LAogICAgICBjcmVhdGVTdHJlYW06IGZ1bmN0aW9uIChzdHJlYW0sIGZkX3N0YXJ0LCBmZF9lbmQpIHsKICAgICAgICBpZiAoIUZTLkZTU3RyZWFtKSB7CiAgICAgICAgICBGUy5GU1N0cmVhbSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgRlMuRlNTdHJlYW0ucHJvdG90eXBlID0ge307CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhGUy5GU1N0cmVhbS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgb2JqZWN0OiB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ub2RlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHRoaXMubm9kZSA9IHZhbDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBpc1JlYWQ6IHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAodGhpcy5mbGFncyAmIDIwOTcxNTUpICE9PSAxCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNXcml0ZTogewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmZsYWdzICYgMjA5NzE1NSkgIT09IDAKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0FwcGVuZDogewogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxhZ3MgJiAxMDI0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB2YXIgbmV3U3RyZWFtID0gbmV3IEZTLkZTU3RyZWFtKCk7CiAgICAgICAgZm9yICh2YXIgcCBpbiBzdHJlYW0pIHsKICAgICAgICAgIG5ld1N0cmVhbVtwXSA9IHN0cmVhbVtwXTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtID0gbmV3U3RyZWFtOwogICAgICAgIHZhciBmZCA9IEZTLm5leHRmZChmZF9zdGFydCwgZmRfZW5kKTsKICAgICAgICBzdHJlYW0uZmQgPSBmZDsKICAgICAgICBGUy5zdHJlYW1zW2ZkXSA9IHN0cmVhbTsKICAgICAgICByZXR1cm4gc3RyZWFtCiAgICAgIH0sCiAgICAgIGNsb3NlU3RyZWFtOiBmdW5jdGlvbiAoZmQpIHsKICAgICAgICBGUy5zdHJlYW1zW2ZkXSA9IG51bGw7CiAgICAgIH0sCiAgICAgIGNocmRldl9zdHJlYW1fb3BzOiB7CiAgICAgICAgb3BlbjogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIGRldmljZSA9IEZTLmdldERldmljZShzdHJlYW0ubm9kZS5yZGV2KTsKICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3BzID0gZGV2aWNlLnN0cmVhbV9vcHM7CiAgICAgICAgICBpZiAoc3RyZWFtLnN0cmVhbV9vcHMub3BlbikgewogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29wcy5vcGVuKHN0cmVhbSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsbHNlZWs6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVTUElQRSkKICAgICAgICB9LAogICAgICB9LAogICAgICBtYWpvcjogZnVuY3Rpb24gKGRldikgewogICAgICAgIHJldHVybiBkZXYgPj4gOAogICAgICB9LAogICAgICBtaW5vcjogZnVuY3Rpb24gKGRldikgewogICAgICAgIHJldHVybiBkZXYgJiAyNTUKICAgICAgfSwKICAgICAgbWFrZWRldjogZnVuY3Rpb24gKG1hLCBtaSkgewogICAgICAgIHJldHVybiAobWEgPDwgOCkgfCBtaQogICAgICB9LAogICAgICByZWdpc3RlckRldmljZTogZnVuY3Rpb24gKGRldiwgb3BzKSB7CiAgICAgICAgRlMuZGV2aWNlc1tkZXZdID0geyBzdHJlYW1fb3BzOiBvcHMgfTsKICAgICAgfSwKICAgICAgZ2V0RGV2aWNlOiBmdW5jdGlvbiAoZGV2KSB7CiAgICAgICAgcmV0dXJuIEZTLmRldmljZXNbZGV2XQogICAgICB9LAogICAgICBnZXRNb3VudHM6IGZ1bmN0aW9uIChtb3VudCkgewogICAgICAgIHZhciBtb3VudHMgPSBbXTsKICAgICAgICB2YXIgY2hlY2sgPSBbbW91bnRdOwogICAgICAgIHdoaWxlIChjaGVjay5sZW5ndGgpIHsKICAgICAgICAgIHZhciBtID0gY2hlY2sucG9wKCk7CiAgICAgICAgICBtb3VudHMucHVzaChtKTsKICAgICAgICAgIGNoZWNrLnB1c2guYXBwbHkoY2hlY2ssIG0ubW91bnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1vdW50cwogICAgICB9LAogICAgICBzeW5jZnM6IGZ1bmN0aW9uIChwb3B1bGF0ZSwgY2FsbGJhY2spIHsKICAgICAgICBpZiAodHlwZW9mIHBvcHVsYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjYWxsYmFjayA9IHBvcHVsYXRlOwogICAgICAgICAgcG9wdWxhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgRlMuc3luY0ZTUmVxdWVzdHMrKzsKICAgICAgICBpZiAoRlMuc3luY0ZTUmVxdWVzdHMgPiAxKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygKICAgICAgICAgICAgJ3dhcm5pbmc6ICcgKyBGUy5zeW5jRlNSZXF1ZXN0cyArICcgRlMuc3luY2ZzIG9wZXJhdGlvbnMgaW4gZmxpZ2h0IGF0IG9uY2UsIHByb2JhYmx5IGp1c3QgZG9pbmcgZXh0cmEgd29yaycKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHZhciBtb3VudHMgPSBGUy5nZXRNb3VudHMoRlMucm9vdC5tb3VudCk7CiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IDA7CiAgICAgICAgZnVuY3Rpb24gZG9DYWxsYmFjayhlcnIpIHsKICAgICAgICAgIGFzc2VydChGUy5zeW5jRlNSZXF1ZXN0cyA+IDApOwogICAgICAgICAgRlMuc3luY0ZTUmVxdWVzdHMtLTsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRvbmUoZXJyKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIGlmICghZG9uZS5lcnJvcmVkKSB7CiAgICAgICAgICAgICAgZG9uZS5lcnJvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gZG9DYWxsYmFjayhlcnIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKytjb21wbGV0ZWQgPj0gbW91bnRzLmxlbmd0aCkgewogICAgICAgICAgICBkb0NhbGxiYWNrKG51bGwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBtb3VudHMuZm9yRWFjaChmdW5jdGlvbiAobW91bnQpIHsKICAgICAgICAgIGlmICghbW91bnQudHlwZS5zeW5jZnMpIHsKICAgICAgICAgICAgcmV0dXJuIGRvbmUobnVsbCkKICAgICAgICAgIH0KICAgICAgICAgIG1vdW50LnR5cGUuc3luY2ZzKG1vdW50LCBwb3B1bGF0ZSwgZG9uZSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIG1vdW50OiBmdW5jdGlvbiAodHlwZSwgb3B0cywgbW91bnRwb2ludCkgewogICAgICAgIHZhciByb290ID0gbW91bnRwb2ludCA9PT0gJy8nOwogICAgICAgIHZhciBwc2V1ZG8gPSAhbW91bnRwb2ludDsKICAgICAgICB2YXIgbm9kZTsKICAgICAgICBpZiAocm9vdCAmJiBGUy5yb290KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQlVTWSkKICAgICAgICB9IGVsc2UgaWYgKCFyb290ICYmICFwc2V1ZG8pIHsKICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKG1vdW50cG9pbnQsIHsgZm9sbG93X21vdW50OiBmYWxzZSB9KTsKICAgICAgICAgIG1vdW50cG9pbnQgPSBsb29rdXAucGF0aDsKICAgICAgICAgIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQobm9kZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJVU1kpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIUZTLmlzRGlyKG5vZGUubW9kZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PVERJUikKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIG1vdW50ID0geyB0eXBlOiB0eXBlLCBvcHRzOiBvcHRzLCBtb3VudHBvaW50OiBtb3VudHBvaW50LCBtb3VudHM6IFtdIH07CiAgICAgICAgdmFyIG1vdW50Um9vdCA9IHR5cGUubW91bnQobW91bnQpOwogICAgICAgIG1vdW50Um9vdC5tb3VudCA9IG1vdW50OwogICAgICAgIG1vdW50LnJvb3QgPSBtb3VudFJvb3Q7CiAgICAgICAgaWYgKHJvb3QpIHsKICAgICAgICAgIEZTLnJvb3QgPSBtb3VudFJvb3Q7CiAgICAgICAgfSBlbHNlIGlmIChub2RlKSB7CiAgICAgICAgICBub2RlLm1vdW50ZWQgPSBtb3VudDsKICAgICAgICAgIGlmIChub2RlLm1vdW50KSB7CiAgICAgICAgICAgIG5vZGUubW91bnQubW91bnRzLnB1c2gobW91bnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbW91bnRSb290CiAgICAgIH0sCiAgICAgIHVubW91bnQ6IGZ1bmN0aW9uIChtb3VudHBvaW50KSB7CiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgobW91bnRwb2ludCwgeyBmb2xsb3dfbW91bnQ6IGZhbHNlIH0pOwogICAgICAgIGlmICghRlMuaXNNb3VudHBvaW50KGxvb2t1cC5ub2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICB2YXIgbm9kZSA9IGxvb2t1cC5ub2RlOwogICAgICAgIHZhciBtb3VudCA9IG5vZGUubW91bnRlZDsKICAgICAgICB2YXIgbW91bnRzID0gRlMuZ2V0TW91bnRzKG1vdW50KTsKICAgICAgICBPYmplY3Qua2V5cyhGUy5uYW1lVGFibGUpLmZvckVhY2goZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICAgIHZhciBjdXJyZW50ID0gRlMubmFtZVRhYmxlW2hhc2hdOwogICAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHsKICAgICAgICAgICAgdmFyIG5leHQgPSBjdXJyZW50Lm5hbWVfbmV4dDsKICAgICAgICAgICAgaWYgKG1vdW50cy5pbmRleE9mKGN1cnJlbnQubW91bnQpICE9PSAtMSkgewogICAgICAgICAgICAgIEZTLmRlc3Ryb3lOb2RlKGN1cnJlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIG5vZGUubW91bnRlZCA9IG51bGw7CiAgICAgICAgdmFyIGlkeCA9IG5vZGUubW91bnQubW91bnRzLmluZGV4T2YobW91bnQpOwogICAgICAgIGFzc2VydChpZHggIT09IC0xKTsKICAgICAgICBub2RlLm1vdW50Lm1vdW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSwKICAgICAgbG9va3VwOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lKSB7CiAgICAgICAgcmV0dXJuIHBhcmVudC5ub2RlX29wcy5sb29rdXAocGFyZW50LCBuYW1lKQogICAgICB9LAogICAgICBta25vZDogZnVuY3Rpb24gKHBhdGgsIG1vZGUsIGRldikgewogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgcGFyZW50OiB0cnVlIH0pOwogICAgICAgIHZhciBwYXJlbnQgPSBsb29rdXAubm9kZTsKICAgICAgICB2YXIgbmFtZSA9IFBBVEguYmFzZW5hbWUocGF0aCk7CiAgICAgICAgaWYgKCFuYW1lIHx8IG5hbWUgPT09ICcuJyB8fCBuYW1lID09PSAnLi4nKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU5WQUwpCiAgICAgICAgfQogICAgICAgIHZhciBlcnIgPSBGUy5tYXlDcmVhdGUocGFyZW50LCBuYW1lKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnIpCiAgICAgICAgfQogICAgICAgIGlmICghcGFyZW50Lm5vZGVfb3BzLm1rbm9kKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcmVudC5ub2RlX29wcy5ta25vZChwYXJlbnQsIG5hbWUsIG1vZGUsIGRldikKICAgICAgfSwKICAgICAgY3JlYXRlOiBmdW5jdGlvbiAocGF0aCwgbW9kZSkgewogICAgICAgIG1vZGUgPSBtb2RlICE9PSB1bmRlZmluZWQgPyBtb2RlIDogNDM4OwogICAgICAgIG1vZGUgJj0gNDA5NTsKICAgICAgICBtb2RlIHw9IDMyNzY4OwogICAgICAgIHJldHVybiBGUy5ta25vZChwYXRoLCBtb2RlLCAwKQogICAgICB9LAogICAgICBta2RpcjogZnVuY3Rpb24gKHBhdGgsIG1vZGUpIHsKICAgICAgICBtb2RlID0gbW9kZSAhPT0gdW5kZWZpbmVkID8gbW9kZSA6IDUxMTsKICAgICAgICBtb2RlICY9IDUxMSB8IDUxMjsKICAgICAgICBtb2RlIHw9IDE2Mzg0OwogICAgICAgIHJldHVybiBGUy5ta25vZChwYXRoLCBtb2RlLCAwKQogICAgICB9LAogICAgICBta2RpclRyZWU6IGZ1bmN0aW9uIChwYXRoLCBtb2RlKSB7CiAgICAgICAgdmFyIGRpcnMgPSBwYXRoLnNwbGl0KCcvJyk7CiAgICAgICAgdmFyIGQgPSAnJzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmICghZGlyc1tpXSkgY29udGludWUKICAgICAgICAgIGQgKz0gJy8nICsgZGlyc1tpXTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZTLm1rZGlyKGQsIG1vZGUpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoZS5lcnJubyAhPSBFUlJOT19DT0RFUy5FRVhJU1QpIHRocm93IGUKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1rZGV2OiBmdW5jdGlvbiAocGF0aCwgbW9kZSwgZGV2KSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXYgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBkZXYgPSBtb2RlOwogICAgICAgICAgbW9kZSA9IDQzODsKICAgICAgICB9CiAgICAgICAgbW9kZSB8PSA4MTkyOwogICAgICAgIHJldHVybiBGUy5ta25vZChwYXRoLCBtb2RlLCBkZXYpCiAgICAgIH0sCiAgICAgIHN5bWxpbms6IGZ1bmN0aW9uIChvbGRwYXRoLCBuZXdwYXRoKSB7CiAgICAgICAgaWYgKCFQQVRILnJlc29sdmUob2xkcGF0aCkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT0VOVCkKICAgICAgICB9CiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgobmV3cGF0aCwgeyBwYXJlbnQ6IHRydWUgfSk7CiAgICAgICAgdmFyIHBhcmVudCA9IGxvb2t1cC5ub2RlOwogICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9FTlQpCiAgICAgICAgfQogICAgICAgIHZhciBuZXduYW1lID0gUEFUSC5iYXNlbmFtZShuZXdwYXRoKTsKICAgICAgICB2YXIgZXJyID0gRlMubWF5Q3JlYXRlKHBhcmVudCwgbmV3bmFtZSk7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoZXJyKQogICAgICAgIH0KICAgICAgICBpZiAoIXBhcmVudC5ub2RlX29wcy5zeW1saW5rKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcmVudC5ub2RlX29wcy5zeW1saW5rKHBhcmVudCwgbmV3bmFtZSwgb2xkcGF0aCkKICAgICAgfSwKICAgICAgcmVuYW1lOiBmdW5jdGlvbiAob2xkX3BhdGgsIG5ld19wYXRoKSB7CiAgICAgICAgdmFyIG9sZF9kaXJuYW1lID0gUEFUSC5kaXJuYW1lKG9sZF9wYXRoKTsKICAgICAgICB2YXIgbmV3X2Rpcm5hbWUgPSBQQVRILmRpcm5hbWUobmV3X3BhdGgpOwogICAgICAgIHZhciBvbGRfbmFtZSA9IFBBVEguYmFzZW5hbWUob2xkX3BhdGgpOwogICAgICAgIHZhciBuZXdfbmFtZSA9IFBBVEguYmFzZW5hbWUobmV3X3BhdGgpOwogICAgICAgIHZhciBsb29rdXAsIG9sZF9kaXIsIG5ld19kaXI7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgob2xkX3BhdGgsIHsgcGFyZW50OiB0cnVlIH0pOwogICAgICAgICAgb2xkX2RpciA9IGxvb2t1cC5ub2RlOwogICAgICAgICAgbG9va3VwID0gRlMubG9va3VwUGF0aChuZXdfcGF0aCwgeyBwYXJlbnQ6IHRydWUgfSk7CiAgICAgICAgICBuZXdfZGlyID0gbG9va3VwLm5vZGU7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJVU1kpCiAgICAgICAgfQogICAgICAgIGlmICghb2xkX2RpciB8fCAhbmV3X2RpcikgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PRU5UKQogICAgICAgIGlmIChvbGRfZGlyLm1vdW50ICE9PSBuZXdfZGlyLm1vdW50KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FWERFVikKICAgICAgICB9CiAgICAgICAgdmFyIG9sZF9ub2RlID0gRlMubG9va3VwTm9kZShvbGRfZGlyLCBvbGRfbmFtZSk7CiAgICAgICAgdmFyIHJlbGF0aXZlID0gUEFUSC5yZWxhdGl2ZShvbGRfcGF0aCwgbmV3X2Rpcm5hbWUpOwogICAgICAgIGlmIChyZWxhdGl2ZS5jaGFyQXQoMCkgIT09ICcuJykgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICByZWxhdGl2ZSA9IFBBVEgucmVsYXRpdmUobmV3X3BhdGgsIG9sZF9kaXJuYW1lKTsKICAgICAgICBpZiAocmVsYXRpdmUuY2hhckF0KDApICE9PSAnLicpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT1RFTVBUWSkKICAgICAgICB9CiAgICAgICAgdmFyIG5ld19ub2RlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBuZXdfbm9kZSA9IEZTLmxvb2t1cE5vZGUobmV3X2RpciwgbmV3X25hbWUpOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgaWYgKG9sZF9ub2RlID09PSBuZXdfbm9kZSkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHZhciBpc2RpciA9IEZTLmlzRGlyKG9sZF9ub2RlLm1vZGUpOwogICAgICAgIHZhciBlcnIgPSBGUy5tYXlEZWxldGUob2xkX2Rpciwgb2xkX25hbWUsIGlzZGlyKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnIpCiAgICAgICAgfQogICAgICAgIGVyciA9IG5ld19ub2RlID8gRlMubWF5RGVsZXRlKG5ld19kaXIsIG5ld19uYW1lLCBpc2RpcikgOiBGUy5tYXlDcmVhdGUobmV3X2RpciwgbmV3X25hbWUpOwogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVycikKICAgICAgICB9CiAgICAgICAgaWYgKCFvbGRfZGlyLm5vZGVfb3BzLnJlbmFtZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVBFUk0pCiAgICAgICAgfQogICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQob2xkX25vZGUpIHx8IChuZXdfbm9kZSAmJiBGUy5pc01vdW50cG9pbnQobmV3X25vZGUpKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJVU1kpCiAgICAgICAgfQogICAgICAgIGlmIChuZXdfZGlyICE9PSBvbGRfZGlyKSB7CiAgICAgICAgICBlcnIgPSBGUy5ub2RlUGVybWlzc2lvbnMob2xkX2RpciwgJ3cnKTsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoZXJyKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgaWYgKEZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxNb3ZlUGF0aCddKSA7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgICJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsTW92ZVBhdGgnXSgnIiArIG9sZF9wYXRoICsgIicsICciICsgbmV3X3BhdGggKyAiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBGUy5oYXNoUmVtb3ZlTm9kZShvbGRfbm9kZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG9sZF9kaXIubm9kZV9vcHMucmVuYW1lKG9sZF9ub2RlLCBuZXdfZGlyLCBuZXdfbmFtZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhyb3cgZQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBGUy5oYXNoQWRkTm9kZShvbGRfbm9kZSk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25Nb3ZlUGF0aCddKSA7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgICJGUy50cmFja2luZ0RlbGVnYXRlWydvbk1vdmVQYXRoJ10oJyIgKyBvbGRfcGF0aCArICInLCAnIiArIG5ld19wYXRoICsgIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJtZGlyOiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgcGFyZW50OiB0cnVlIH0pOwogICAgICAgIHZhciBwYXJlbnQgPSBsb29rdXAubm9kZTsKICAgICAgICB2YXIgbmFtZSA9IFBBVEguYmFzZW5hbWUocGF0aCk7CiAgICAgICAgdmFyIG5vZGUgPSBGUy5sb29rdXBOb2RlKHBhcmVudCwgbmFtZSk7CiAgICAgICAgdmFyIGVyciA9IEZTLm1heURlbGV0ZShwYXJlbnQsIG5hbWUsIHRydWUpOwogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVycikKICAgICAgICB9CiAgICAgICAgaWYgKCFwYXJlbnQubm9kZV9vcHMucm1kaXIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVQRVJNKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNNb3VudHBvaW50KG5vZGUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQlVTWSkKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsRGVsZXRlUGF0aCddKSA7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxEZWxldGVQYXRoJ10oJyIgKyBwYXRoICsgIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7CiAgICAgICAgfQogICAgICAgIHBhcmVudC5ub2RlX29wcy5ybWRpcihwYXJlbnQsIG5hbWUpOwogICAgICAgIEZTLmRlc3Ryb3lOb2RlKG5vZGUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10pIDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIgKyBwYXRoICsgIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICByZWFkZGlyOiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiB0cnVlIH0pOwogICAgICAgIHZhciBub2RlID0gbG9va3VwLm5vZGU7CiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLnJlYWRkaXIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT1RESVIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBub2RlLm5vZGVfb3BzLnJlYWRkaXIobm9kZSkKICAgICAgfSwKICAgICAgdW5saW5rOiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgcGFyZW50OiB0cnVlIH0pOwogICAgICAgIHZhciBwYXJlbnQgPSBsb29rdXAubm9kZTsKICAgICAgICB2YXIgbmFtZSA9IFBBVEguYmFzZW5hbWUocGF0aCk7CiAgICAgICAgdmFyIG5vZGUgPSBGUy5sb29rdXBOb2RlKHBhcmVudCwgbmFtZSk7CiAgICAgICAgdmFyIGVyciA9IEZTLm1heURlbGV0ZShwYXJlbnQsIG5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnIpCiAgICAgICAgfQogICAgICAgIGlmICghcGFyZW50Lm5vZGVfb3BzLnVubGluaykgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVBFUk0pCiAgICAgICAgfQogICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQobm9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVCVVNZKQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgaWYgKEZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxEZWxldGVQYXRoJ10pIDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSgnIiArIHBhdGggKyAiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgcGFyZW50Lm5vZGVfb3BzLnVubGluayhwYXJlbnQsIG5hbWUpOwogICAgICAgIEZTLmRlc3Ryb3lOb2RlKG5vZGUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10pIDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIgKyBwYXRoICsgIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICByZWFkbGluazogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoKTsKICAgICAgICB2YXIgbGluayA9IGxvb2t1cC5ub2RlOwogICAgICAgIGlmICghbGluaykgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PRU5UKQogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmsubm9kZV9vcHMucmVhZGxpbmspIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFBBVEgucmVzb2x2ZShGUy5nZXRQYXRoKGxpbmsucGFyZW50KSwgbGluay5ub2RlX29wcy5yZWFkbGluayhsaW5rKSkKICAgICAgfSwKICAgICAgc3RhdDogZnVuY3Rpb24gKHBhdGgsIGRvbnRGb2xsb3cpIHsKICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IGZvbGxvdzogIWRvbnRGb2xsb3cgfSk7CiAgICAgICAgdmFyIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICBpZiAoIW5vZGUpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT0VOVCkKICAgICAgICB9CiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLmdldGF0dHIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVQRVJNKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbm9kZS5ub2RlX29wcy5nZXRhdHRyKG5vZGUpCiAgICAgIH0sCiAgICAgIGxzdGF0OiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHJldHVybiBGUy5zdGF0KHBhdGgsIHRydWUpCiAgICAgIH0sCiAgICAgIGNobW9kOiBmdW5jdGlvbiAocGF0aCwgbW9kZSwgZG9udEZvbGxvdykgewogICAgICAgIHZhciBub2RlOwogICAgICAgIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiAhZG9udEZvbGxvdyB9KTsKICAgICAgICAgIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm9kZSA9IHBhdGg7CiAgICAgICAgfQogICAgICAgIGlmICghbm9kZS5ub2RlX29wcy5zZXRhdHRyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FUEVSTSkKICAgICAgICB9CiAgICAgICAgbm9kZS5ub2RlX29wcy5zZXRhdHRyKG5vZGUsIHsgbW9kZTogKG1vZGUgJiA0MDk1KSB8IChub2RlLm1vZGUgJiB+NDA5NSksIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTsKICAgICAgfSwKICAgICAgbGNobW9kOiBmdW5jdGlvbiAocGF0aCwgbW9kZSkgewogICAgICAgIEZTLmNobW9kKHBhdGgsIG1vZGUsIHRydWUpOwogICAgICB9LAogICAgICBmY2htb2Q6IGZ1bmN0aW9uIChmZCwgbW9kZSkgewogICAgICAgIHZhciBzdHJlYW0gPSBGUy5nZXRTdHJlYW0oZmQpOwogICAgICAgIGlmICghc3RyZWFtKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQkFERikKICAgICAgICB9CiAgICAgICAgRlMuY2htb2Qoc3RyZWFtLm5vZGUsIG1vZGUpOwogICAgICB9LAogICAgICBjaG93bjogZnVuY3Rpb24gKHBhdGgsIHVpZCwgZ2lkLCBkb250Rm9sbG93KSB7CiAgICAgICAgdmFyIG5vZGU7CiAgICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykgewogICAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6ICFkb250Rm9sbG93IH0pOwogICAgICAgICAgbm9kZSA9IGxvb2t1cC5ub2RlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlID0gcGF0aDsKICAgICAgICB9CiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLnNldGF0dHIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVQRVJNKQogICAgICAgIH0KICAgICAgICBub2RlLm5vZGVfb3BzLnNldGF0dHIobm9kZSwgeyB0aW1lc3RhbXA6IERhdGUubm93KCkgfSk7CiAgICAgIH0sCiAgICAgIGxjaG93bjogZnVuY3Rpb24gKHBhdGgsIHVpZCwgZ2lkKSB7CiAgICAgICAgRlMuY2hvd24ocGF0aCwgdWlkLCBnaWQsIHRydWUpOwogICAgICB9LAogICAgICBmY2hvd246IGZ1bmN0aW9uIChmZCwgdWlkLCBnaWQpIHsKICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGZkKTsKICAgICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgfQogICAgICAgIEZTLmNob3duKHN0cmVhbS5ub2RlLCB1aWQsIGdpZCk7CiAgICAgIH0sCiAgICAgIHRydW5jYXRlOiBmdW5jdGlvbiAocGF0aCwgbGVuKSB7CiAgICAgICAgaWYgKGxlbiA8IDApIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICB9CiAgICAgICAgdmFyIG5vZGU7CiAgICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykgewogICAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6IHRydWUgfSk7CiAgICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vZGUgPSBwYXRoOwogICAgICAgIH0KICAgICAgICBpZiAoIW5vZGUubm9kZV9vcHMuc2V0YXR0cikgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVBFUk0pCiAgICAgICAgfQogICAgICAgIGlmIChGUy5pc0Rpcihub2RlLm1vZGUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSVNESVIpCiAgICAgICAgfQogICAgICAgIGlmICghRlMuaXNGaWxlKG5vZGUubW9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICB9CiAgICAgICAgdmFyIGVyciA9IEZTLm5vZGVQZXJtaXNzaW9ucyhub2RlLCAndycpOwogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVycikKICAgICAgICB9CiAgICAgICAgbm9kZS5ub2RlX29wcy5zZXRhdHRyKG5vZGUsIHsgc2l6ZTogbGVuLCB0aW1lc3RhbXA6IERhdGUubm93KCkgfSk7CiAgICAgIH0sCiAgICAgIGZ0cnVuY2F0ZTogZnVuY3Rpb24gKGZkLCBsZW4pIHsKICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGZkKTsKICAgICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgfQogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTlZBTCkKICAgICAgICB9CiAgICAgICAgRlMudHJ1bmNhdGUoc3RyZWFtLm5vZGUsIGxlbik7CiAgICAgIH0sCiAgICAgIHV0aW1lOiBmdW5jdGlvbiAocGF0aCwgYXRpbWUsIG10aW1lKSB7CiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6IHRydWUgfSk7CiAgICAgICAgdmFyIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICBub2RlLm5vZGVfb3BzLnNldGF0dHIobm9kZSwgeyB0aW1lc3RhbXA6IE1hdGgubWF4KGF0aW1lLCBtdGltZSkgfSk7CiAgICAgIH0sCiAgICAgIG9wZW46IGZ1bmN0aW9uIChwYXRoLCBmbGFncywgbW9kZSwgZmRfc3RhcnQsIGZkX2VuZCkgewogICAgICAgIGlmIChwYXRoID09PSAnJykgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PRU5UKQogICAgICAgIH0KICAgICAgICBmbGFncyA9IHR5cGVvZiBmbGFncyA9PT0gJ3N0cmluZycgPyBGUy5tb2RlU3RyaW5nVG9GbGFncyhmbGFncykgOiBmbGFnczsKICAgICAgICBtb2RlID0gdHlwZW9mIG1vZGUgPT09ICd1bmRlZmluZWQnID8gNDM4IDogbW9kZTsKICAgICAgICBpZiAoZmxhZ3MgJiA2NCkgewogICAgICAgICAgbW9kZSA9IChtb2RlICYgNDA5NSkgfCAzMjc2ODsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbW9kZSA9IDA7CiAgICAgICAgfQogICAgICAgIHZhciBub2RlOwogICAgICAgIGlmICh0eXBlb2YgcGF0aCA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIG5vZGUgPSBwYXRoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXRoID0gUEFUSC5ub3JtYWxpemUocGF0aCk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IGZvbGxvdzogIShmbGFncyAmIDEzMTA3MikgfSk7CiAgICAgICAgICAgIG5vZGUgPSBsb29rdXAubm9kZTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQogICAgICAgIHZhciBjcmVhdGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGZsYWdzICYgNjQpIHsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIGlmIChmbGFncyAmIDEyOCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVFWElTVCkKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbm9kZSA9IEZTLm1rbm9kKHBhdGgsIG1vZGUsIDApOwogICAgICAgICAgICBjcmVhdGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9FTlQpCiAgICAgICAgfQogICAgICAgIGlmIChGUy5pc0NocmRldihub2RlLm1vZGUpKSB7CiAgICAgICAgICBmbGFncyAmPSB+NTEyOwogICAgICAgIH0KICAgICAgICBpZiAoZmxhZ3MgJiA2NTUzNiAmJiAhRlMuaXNEaXIobm9kZS5tb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PVERJUikKICAgICAgICB9CiAgICAgICAgaWYgKCFjcmVhdGVkKSB7CiAgICAgICAgICB2YXIgZXJyID0gRlMubWF5T3Blbihub2RlLCBmbGFncyk7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVycikKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZsYWdzICYgNTEyKSB7CiAgICAgICAgICBGUy50cnVuY2F0ZShub2RlLCAwKTsKICAgICAgICB9CiAgICAgICAgZmxhZ3MgJj0gfigxMjggfCA1MTIpOwogICAgICAgIHZhciBzdHJlYW0gPSBGUy5jcmVhdGVTdHJlYW0oCiAgICAgICAgICB7CiAgICAgICAgICAgIG5vZGU6IG5vZGUsCiAgICAgICAgICAgIHBhdGg6IEZTLmdldFBhdGgobm9kZSksCiAgICAgICAgICAgIGZsYWdzOiBmbGFncywKICAgICAgICAgICAgc2Vla2FibGU6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAwLAogICAgICAgICAgICBzdHJlYW1fb3BzOiBub2RlLnN0cmVhbV9vcHMsCiAgICAgICAgICAgIHVuZ290dGVuOiBbXSwKICAgICAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgICAgfSwKICAgICAgICAgIGZkX3N0YXJ0LAogICAgICAgICAgZmRfZW5kCiAgICAgICAgKTsKICAgICAgICBpZiAoc3RyZWFtLnN0cmVhbV9vcHMub3BlbikgewogICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcHMub3BlbihzdHJlYW0pOwogICAgICAgIH0KICAgICAgICBpZiAoTW9kdWxlWydsb2dSZWFkRmlsZXMnXSAmJiAhKGZsYWdzICYgMSkpIHsKICAgICAgICAgIGlmICghRlMucmVhZEZpbGVzKSBGUy5yZWFkRmlsZXMgPSB7fTsKICAgICAgICAgIGlmICghKHBhdGggaW4gRlMucmVhZEZpbGVzKSkgewogICAgICAgICAgICBGUy5yZWFkRmlsZXNbcGF0aF0gPSAxOwogICAgICAgICAgICBNb2R1bGVbJ3ByaW50RXJyJ10oJ3JlYWQgZmlsZTogJyArIHBhdGgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHRyYWNraW5nRmxhZ3M7IGlmIChGUy50cmFja2luZ0RlbGVnYXRlWydvbk9wZW5GaWxlJ10pIDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25PcGVuRmlsZSddKCciICsgcGF0aCArICInLCBmbGFncykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmVhbQogICAgICB9LAogICAgICBjbG9zZTogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIGlmIChGUy5pc0Nsb3NlZChzdHJlYW0pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQkFERikKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5nZXRkZW50cykgc3RyZWFtLmdldGRlbnRzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKHN0cmVhbS5zdHJlYW1fb3BzLmNsb3NlKSB7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3BzLmNsb3NlKHN0cmVhbSk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhyb3cgZQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBGUy5jbG9zZVN0cmVhbShzdHJlYW0uZmQpOwogICAgICAgIH0KICAgICAgICBzdHJlYW0uZmQgPSBudWxsOwogICAgICB9LAogICAgICBpc0Nsb3NlZDogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uZmQgPT09IG51bGwKICAgICAgfSwKICAgICAgbGxzZWVrOiBmdW5jdGlvbiAoc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSkgewogICAgICAgIGlmIChGUy5pc0Nsb3NlZChzdHJlYW0pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQkFERikKICAgICAgICB9CiAgICAgICAgaWYgKCFzdHJlYW0uc2Vla2FibGUgfHwgIXN0cmVhbS5zdHJlYW1fb3BzLmxsc2VlaykgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVNQSVBFKQogICAgICAgIH0KICAgICAgICBzdHJlYW0ucG9zaXRpb24gPSBzdHJlYW0uc3RyZWFtX29wcy5sbHNlZWsoc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSk7CiAgICAgICAgc3RyZWFtLnVuZ290dGVuID0gW107CiAgICAgICAgcmV0dXJuIHN0cmVhbS5wb3NpdGlvbgogICAgICB9LAogICAgICByZWFkOiBmdW5jdGlvbiAoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgIGlmIChsZW5ndGggPCAwIHx8IHBvc2l0aW9uIDwgMCkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNDbG9zZWQoc3RyZWFtKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgfQogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDEpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVCQURGKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNEaXIoc3RyZWFtLm5vZGUubW9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJU0RJUikKICAgICAgICB9CiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy5yZWFkKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU5WQUwpCiAgICAgICAgfQogICAgICAgIHZhciBzZWVraW5nID0gdHlwZW9mIHBvc2l0aW9uICE9PSAndW5kZWZpbmVkJzsKICAgICAgICBpZiAoIXNlZWtpbmcpIHsKICAgICAgICAgIHBvc2l0aW9uID0gc3RyZWFtLnBvc2l0aW9uOwogICAgICAgIH0gZWxzZSBpZiAoIXN0cmVhbS5zZWVrYWJsZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVNQSVBFKQogICAgICAgIH0KICAgICAgICB2YXIgYnl0ZXNSZWFkID0gc3RyZWFtLnN0cmVhbV9vcHMucmVhZChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKTsKICAgICAgICBpZiAoIXNlZWtpbmcpIHN0cmVhbS5wb3NpdGlvbiArPSBieXRlc1JlYWQ7CiAgICAgICAgcmV0dXJuIGJ5dGVzUmVhZAogICAgICB9LAogICAgICB3cml0ZTogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIGNhbk93bikgewogICAgICAgIGlmIChsZW5ndGggPCAwIHx8IHBvc2l0aW9uIDwgMCkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNDbG9zZWQoc3RyZWFtKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgfQogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVCQURGKQogICAgICAgIH0KICAgICAgICBpZiAoRlMuaXNEaXIoc3RyZWFtLm5vZGUubW9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJU0RJUikKICAgICAgICB9CiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy53cml0ZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUlOVkFMKQogICAgICAgIH0KICAgICAgICBpZiAoc3RyZWFtLmZsYWdzICYgMTAyNCkgewogICAgICAgICAgRlMubGxzZWVrKHN0cmVhbSwgMCwgMik7CiAgICAgICAgfQogICAgICAgIHZhciBzZWVraW5nID0gdHlwZW9mIHBvc2l0aW9uICE9PSAndW5kZWZpbmVkJzsKICAgICAgICBpZiAoIXNlZWtpbmcpIHsKICAgICAgICAgIHBvc2l0aW9uID0gc3RyZWFtLnBvc2l0aW9uOwogICAgICAgIH0gZWxzZSBpZiAoIXN0cmVhbS5zZWVrYWJsZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRVNQSVBFKQogICAgICAgIH0KICAgICAgICB2YXIgYnl0ZXNXcml0dGVuID0gc3RyZWFtLnN0cmVhbV9vcHMud3JpdGUoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgY2FuT3duKTsKICAgICAgICBpZiAoIXNlZWtpbmcpIHN0cmVhbS5wb3NpdGlvbiArPSBieXRlc1dyaXR0ZW47CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChzdHJlYW0ucGF0aCAmJiBGUy50cmFja2luZ0RlbGVnYXRlWydvbldyaXRlVG9GaWxlJ10pIEZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXShzdHJlYW0ucGF0aCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXSgnIiArIHBhdGggKyAiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ5dGVzV3JpdHRlbgogICAgICB9LAogICAgICBhbGxvY2F0ZTogZnVuY3Rpb24gKHN0cmVhbSwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgICBpZiAoRlMuaXNDbG9zZWQoc3RyZWFtKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgfQogICAgICAgIGlmIChvZmZzZXQgPCAwIHx8IGxlbmd0aCA8PSAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU5WQUwpCiAgICAgICAgfQogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVCQURGKQogICAgICAgIH0KICAgICAgICBpZiAoIUZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSAmJiAhRlMuaXNEaXIoc3RyZWFtLm5vZGUubW9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT0RFVikKICAgICAgICB9CiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy5hbGxvY2F0ZSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU9QTk9UU1VQUCkKICAgICAgICB9CiAgICAgICAgc3RyZWFtLnN0cmVhbV9vcHMuYWxsb2NhdGUoc3RyZWFtLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgIH0sCiAgICAgIG1tYXA6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBwcm90LCBmbGFncykgewogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDEpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVBQ0NFUykKICAgICAgICB9CiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy5tbWFwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FTk9ERVYpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX29wcy5tbWFwKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIHByb3QsIGZsYWdzKQogICAgICB9LAogICAgICBtc3luYzogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgbW1hcEZsYWdzKSB7CiAgICAgICAgaWYgKCFzdHJlYW0gfHwgIXN0cmVhbS5zdHJlYW1fb3BzLm1zeW5jKSB7CiAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9vcHMubXN5bmMoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBtbWFwRmxhZ3MpCiAgICAgIH0sCiAgICAgIG11bm1hcDogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiAwCiAgICAgIH0sCiAgICAgIGlvY3RsOiBmdW5jdGlvbiAoc3RyZWFtLCBjbWQsIGFyZykgewogICAgICAgIGlmICghc3RyZWFtLnN0cmVhbV9vcHMuaW9jdGwpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT1RUWSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1fb3BzLmlvY3RsKHN0cmVhbSwgY21kLCBhcmcpCiAgICAgIH0sCiAgICAgIHJlYWRGaWxlOiBmdW5jdGlvbiAocGF0aCwgb3B0cykgewogICAgICAgIG9wdHMgPSBvcHRzIHx8IHt9OwogICAgICAgIG9wdHMuZmxhZ3MgPSBvcHRzLmZsYWdzIHx8ICdyJzsKICAgICAgICBvcHRzLmVuY29kaW5nID0gb3B0cy5lbmNvZGluZyB8fCAnYmluYXJ5JzsKICAgICAgICBpZiAob3B0cy5lbmNvZGluZyAhPT0gJ3V0ZjgnICYmIG9wdHMuZW5jb2RpbmcgIT09ICdiaW5hcnknKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcgdHlwZSAiJyArIG9wdHMuZW5jb2RpbmcgKyAnIicpCiAgICAgICAgfQogICAgICAgIHZhciByZXQ7CiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLm9wZW4ocGF0aCwgb3B0cy5mbGFncyk7CiAgICAgICAgdmFyIHN0YXQgPSBGUy5zdGF0KHBhdGgpOwogICAgICAgIHZhciBsZW5ndGggPSBzdGF0LnNpemU7CiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICAgICAgRlMucmVhZChzdHJlYW0sIGJ1ZiwgMCwgbGVuZ3RoLCAwKTsKICAgICAgICBpZiAob3B0cy5lbmNvZGluZyA9PT0gJ3V0ZjgnKSB7CiAgICAgICAgICByZXQgPSBVVEY4QXJyYXlUb1N0cmluZyhidWYsIDApOwogICAgICAgIH0gZWxzZSBpZiAob3B0cy5lbmNvZGluZyA9PT0gJ2JpbmFyeScpIHsKICAgICAgICAgIHJldCA9IGJ1ZjsKICAgICAgICB9CiAgICAgICAgRlMuY2xvc2Uoc3RyZWFtKTsKICAgICAgICByZXR1cm4gcmV0CiAgICAgIH0sCiAgICAgIHdyaXRlRmlsZTogZnVuY3Rpb24gKHBhdGgsIGRhdGEsIG9wdHMpIHsKICAgICAgICBvcHRzID0gb3B0cyB8fCB7fTsKICAgICAgICBvcHRzLmZsYWdzID0gb3B0cy5mbGFncyB8fCAndyc7CiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLm9wZW4ocGF0aCwgb3B0cy5mbGFncywgb3B0cy5tb2RlKTsKICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB2YXIgYnVmID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoQnl0ZXNVVEY4KGRhdGEpICsgMSk7CiAgICAgICAgICB2YXIgYWN0dWFsTnVtQnl0ZXMgPSBzdHJpbmdUb1VURjhBcnJheShkYXRhLCBidWYsIDAsIGJ1Zi5sZW5ndGgpOwogICAgICAgICAgRlMud3JpdGUoc3RyZWFtLCBidWYsIDAsIGFjdHVhbE51bUJ5dGVzLCB1bmRlZmluZWQsIG9wdHMuY2FuT3duKTsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhkYXRhKSkgewogICAgICAgICAgRlMud3JpdGUoc3RyZWFtLCBkYXRhLCAwLCBkYXRhLmJ5dGVMZW5ndGgsIHVuZGVmaW5lZCwgb3B0cy5jYW5Pd24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGRhdGEgdHlwZScpCiAgICAgICAgfQogICAgICAgIEZTLmNsb3NlKHN0cmVhbSk7CiAgICAgIH0sCiAgICAgIGN3ZDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBGUy5jdXJyZW50UGF0aAogICAgICB9LAogICAgICBjaGRpcjogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IGZvbGxvdzogdHJ1ZSB9KTsKICAgICAgICBpZiAobG9va3VwLm5vZGUgPT09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVOT0VOVCkKICAgICAgICB9CiAgICAgICAgaWYgKCFGUy5pc0Rpcihsb29rdXAubm9kZS5tb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRU5PVERJUikKICAgICAgICB9CiAgICAgICAgdmFyIGVyciA9IEZTLm5vZGVQZXJtaXNzaW9ucyhsb29rdXAubm9kZSwgJ3gnKTsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnIpCiAgICAgICAgfQogICAgICAgIEZTLmN1cnJlbnRQYXRoID0gbG9va3VwLnBhdGg7CiAgICAgIH0sCiAgICAgIGNyZWF0ZURlZmF1bHREaXJlY3RvcmllczogZnVuY3Rpb24gKCkgewogICAgICAgIEZTLm1rZGlyKCcvdG1wJyk7CiAgICAgICAgRlMubWtkaXIoJy9ob21lJyk7CiAgICAgICAgRlMubWtkaXIoJy9ob21lL3dlYl91c2VyJyk7CiAgICAgIH0sCiAgICAgIGNyZWF0ZURlZmF1bHREZXZpY2VzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgRlMubWtkaXIoJy9kZXYnKTsKICAgICAgICBGUy5yZWdpc3RlckRldmljZShGUy5tYWtlZGV2KDEsIDMpLCB7CiAgICAgICAgICByZWFkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICB9LAogICAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcykgewogICAgICAgICAgICByZXR1cm4gbGVuZ3RoCiAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgICAgIEZTLm1rZGV2KCcvZGV2L251bGwnLCBGUy5tYWtlZGV2KDEsIDMpKTsKICAgICAgICBUVFkucmVnaXN0ZXIoRlMubWFrZWRldig1LCAwKSwgVFRZLmRlZmF1bHRfdHR5X29wcyk7CiAgICAgICAgVFRZLnJlZ2lzdGVyKEZTLm1ha2VkZXYoNiwgMCksIFRUWS5kZWZhdWx0X3R0eTFfb3BzKTsKICAgICAgICBGUy5ta2RldignL2Rldi90dHknLCBGUy5tYWtlZGV2KDUsIDApKTsKICAgICAgICBGUy5ta2RldignL2Rldi90dHkxJywgRlMubWFrZWRldig2LCAwKSk7CiAgICAgICAgdmFyIHJhbmRvbV9kZXZpY2U7CiAgICAgICAgaWYgKHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICB2YXIgcmFuZG9tQnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMSk7CiAgICAgICAgICByYW5kb21fZGV2aWNlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHJhbmRvbUJ1ZmZlcik7CiAgICAgICAgICAgIHJldHVybiByYW5kb21CdWZmZXJbMF0KICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChFTlZJUk9OTUVOVF9JU19OT0RFKSB7CiAgICAgICAgICByYW5kb21fZGV2aWNlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gcmVxdWlyZSgnY3J5cHRvJylbJ3JhbmRvbUJ5dGVzJ10oMSlbMF0KICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJhbmRvbV9kZXZpY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAoTWF0aC5yYW5kb20oKSAqIDI1NikgfCAwCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAncmFuZG9tJywgcmFuZG9tX2RldmljZSk7CiAgICAgICAgRlMuY3JlYXRlRGV2aWNlKCcvZGV2JywgJ3VyYW5kb20nLCByYW5kb21fZGV2aWNlKTsKICAgICAgICBGUy5ta2RpcignL2Rldi9zaG0nKTsKICAgICAgICBGUy5ta2RpcignL2Rldi9zaG0vdG1wJyk7CiAgICAgIH0sCiAgICAgIGNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllczogZnVuY3Rpb24gKCkgewogICAgICAgIEZTLm1rZGlyKCcvcHJvYycpOwogICAgICAgIEZTLm1rZGlyKCcvcHJvYy9zZWxmJyk7CiAgICAgICAgRlMubWtkaXIoJy9wcm9jL3NlbGYvZmQnKTsKICAgICAgICBGUy5tb3VudCgKICAgICAgICAgIHsKICAgICAgICAgICAgbW91bnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZU5vZGUoJy9wcm9jL3NlbGYnLCAnZmQnLCAxNjM4NCB8IDUxMSwgNzMpOwogICAgICAgICAgICAgIG5vZGUubm9kZV9vcHMgPSB7CiAgICAgICAgICAgICAgICBsb29rdXA6IGZ1bmN0aW9uIChwYXJlbnQsIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGZkID0gK25hbWU7CiAgICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBGUy5nZXRTdHJlYW0oZmQpOwogICAgICAgICAgICAgICAgICBpZiAoIXN0cmVhbSkgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoRVJSTk9fQ09ERVMuRUJBREYpCiAgICAgICAgICAgICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBudWxsLAogICAgICAgICAgICAgICAgICAgIG1vdW50OiB7IG1vdW50cG9pbnQ6ICdmYWtlJyB9LAogICAgICAgICAgICAgICAgICAgIG5vZGVfb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgICByZWFkbGluazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnBhdGgKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgcmV0LnBhcmVudCA9IHJldDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiBub2RlCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAge30sCiAgICAgICAgICAnL3Byb2Mvc2VsZi9mZCcKICAgICAgICApOwogICAgICB9LAogICAgICBjcmVhdGVTdGFuZGFyZFN0cmVhbXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoTW9kdWxlWydzdGRpbiddKSB7CiAgICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAnc3RkaW4nLCBNb2R1bGVbJ3N0ZGluJ10pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBGUy5zeW1saW5rKCcvZGV2L3R0eScsICcvZGV2L3N0ZGluJyk7CiAgICAgICAgfQogICAgICAgIGlmIChNb2R1bGVbJ3N0ZG91dCddKSB7CiAgICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAnc3Rkb3V0JywgbnVsbCwgTW9kdWxlWydzdGRvdXQnXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEZTLnN5bWxpbmsoJy9kZXYvdHR5JywgJy9kZXYvc3Rkb3V0Jyk7CiAgICAgICAgfQogICAgICAgIGlmIChNb2R1bGVbJ3N0ZGVyciddKSB7CiAgICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAnc3RkZXJyJywgbnVsbCwgTW9kdWxlWydzdGRlcnInXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEZTLnN5bWxpbmsoJy9kZXYvdHR5MScsICcvZGV2L3N0ZGVycicpOwogICAgICAgIH0KICAgICAgICB2YXIgc3RkaW4gPSBGUy5vcGVuKCcvZGV2L3N0ZGluJywgJ3InKTsKICAgICAgICBhc3NlcnQoc3RkaW4uZmQgPT09IDAsICdpbnZhbGlkIGhhbmRsZSBmb3Igc3RkaW4gKCcgKyBzdGRpbi5mZCArICcpJyk7CiAgICAgICAgdmFyIHN0ZG91dCA9IEZTLm9wZW4oJy9kZXYvc3Rkb3V0JywgJ3cnKTsKICAgICAgICBhc3NlcnQoc3Rkb3V0LmZkID09PSAxLCAnaW52YWxpZCBoYW5kbGUgZm9yIHN0ZG91dCAoJyArIHN0ZG91dC5mZCArICcpJyk7CiAgICAgICAgdmFyIHN0ZGVyciA9IEZTLm9wZW4oJy9kZXYvc3RkZXJyJywgJ3cnKTsKICAgICAgICBhc3NlcnQoc3RkZXJyLmZkID09PSAyLCAnaW52YWxpZCBoYW5kbGUgZm9yIHN0ZGVyciAoJyArIHN0ZGVyci5mZCArICcpJyk7CiAgICAgIH0sCiAgICAgIGVuc3VyZUVycm5vRXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoRlMuRXJybm9FcnJvcikgcmV0dXJuCiAgICAgICAgRlMuRXJybm9FcnJvciA9IGZ1bmN0aW9uIEVycm5vRXJyb3IoZXJybm8sIG5vZGUpIHsKICAgICAgICAgIHRoaXMubm9kZSA9IG5vZGU7CiAgICAgICAgICB0aGlzLnNldEVycm5vID0gZnVuY3Rpb24gKGVycm5vKSB7CiAgICAgICAgICAgIHRoaXMuZXJybm8gPSBlcnJubzsKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIEVSUk5PX0NPREVTKSB7CiAgICAgICAgICAgICAgaWYgKEVSUk5PX0NPREVTW2tleV0gPT09IGVycm5vKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvZGUgPSBrZXk7CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuc2V0RXJybm8oZXJybm8pOwogICAgICAgICAgdGhpcy5tZXNzYWdlID0gRVJSTk9fTUVTU0FHRVNbZXJybm9dOwogICAgICAgICAgaWYgKHRoaXMuc3RhY2spIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnc3RhY2snLCB7IHZhbHVlOiBuZXcgRXJyb3IoKS5zdGFjaywgd3JpdGFibGU6IHRydWUgfSk7CiAgICAgICAgfTsKICAgICAgICBGUy5FcnJub0Vycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpOwogICAgICAgIEZTLkVycm5vRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRlMuRXJybm9FcnJvcgogICAgICAgIDtbRVJSTk9fQ09ERVMuRU5PRU5UXS5mb3JFYWNoKGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgICAgICBGUy5nZW5lcmljRXJyb3JzW2NvZGVdID0gbmV3IEZTLkVycm5vRXJyb3IoY29kZSk7CiAgICAgICAgICBGUy5nZW5lcmljRXJyb3JzW2NvZGVdLnN0YWNrID0gJzxnZW5lcmljIGVycm9yLCBubyBzdGFjaz4nOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzdGF0aWNJbml0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgRlMuZW5zdXJlRXJybm9FcnJvcigpOwogICAgICAgIEZTLm5hbWVUYWJsZSA9IG5ldyBBcnJheSg0MDk2KTsKICAgICAgICBGUy5tb3VudChNRU1GUywge30sICcvJyk7CiAgICAgICAgRlMuY3JlYXRlRGVmYXVsdERpcmVjdG9yaWVzKCk7CiAgICAgICAgRlMuY3JlYXRlRGVmYXVsdERldmljZXMoKTsKICAgICAgICBGUy5jcmVhdGVTcGVjaWFsRGlyZWN0b3JpZXMoKTsKICAgICAgICBGUy5maWxlc3lzdGVtcyA9IHsgTUVNRlM6IE1FTUZTLCBJREJGUzogSURCRlMsIE5PREVGUzogTk9ERUZTLCBXT1JLRVJGUzogV09SS0VSRlMgfTsKICAgICAgfSwKICAgICAgaW5pdDogZnVuY3Rpb24gKGlucHV0LCBvdXRwdXQsIGVycm9yKSB7CiAgICAgICAgYXNzZXJ0KAogICAgICAgICAgIUZTLmluaXQuaW5pdGlhbGl6ZWQsCiAgICAgICAgICAnRlMuaW5pdCB3YXMgcHJldmlvdXNseSBjYWxsZWQuIElmIHlvdSB3YW50IHRvIGluaXRpYWxpemUgbGF0ZXIgd2l0aCBjdXN0b20gcGFyYW1ldGVycywgcmVtb3ZlIGFueSBlYXJsaWVyIGNhbGxzIChub3RlIHRoYXQgb25lIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGdlbmVyYXRlZCBjb2RlKScKICAgICAgICApOwogICAgICAgIEZTLmluaXQuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIEZTLmVuc3VyZUVycm5vRXJyb3IoKTsKICAgICAgICBNb2R1bGVbJ3N0ZGluJ10gPSBpbnB1dCB8fCBNb2R1bGVbJ3N0ZGluJ107CiAgICAgICAgTW9kdWxlWydzdGRvdXQnXSA9IG91dHB1dCB8fCBNb2R1bGVbJ3N0ZG91dCddOwogICAgICAgIE1vZHVsZVsnc3RkZXJyJ10gPSBlcnJvciB8fCBNb2R1bGVbJ3N0ZGVyciddOwogICAgICAgIEZTLmNyZWF0ZVN0YW5kYXJkU3RyZWFtcygpOwogICAgICB9LAogICAgICBxdWl0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgRlMuaW5pdC5pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICAgIHZhciBmZmx1c2ggPSBNb2R1bGVbJ19mZmx1c2gnXTsKICAgICAgICBpZiAoZmZsdXNoKSBmZmx1c2goMCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBGUy5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgc3RyZWFtID0gRlMuc3RyZWFtc1tpXTsKICAgICAgICAgIGlmICghc3RyZWFtKSB7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgICBGUy5jbG9zZShzdHJlYW0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0TW9kZTogZnVuY3Rpb24gKGNhblJlYWQsIGNhbldyaXRlKSB7CiAgICAgICAgdmFyIG1vZGUgPSAwOwogICAgICAgIGlmIChjYW5SZWFkKSBtb2RlIHw9IDI5MiB8IDczOwogICAgICAgIGlmIChjYW5Xcml0ZSkgbW9kZSB8PSAxNDY7CiAgICAgICAgcmV0dXJuIG1vZGUKICAgICAgfSwKICAgICAgam9pblBhdGg6IGZ1bmN0aW9uIChwYXJ0cywgZm9yY2VSZWxhdGl2ZSkgewogICAgICAgIHZhciBwYXRoID0gUEFUSC5qb2luLmFwcGx5KG51bGwsIHBhcnRzKTsKICAgICAgICBpZiAoZm9yY2VSZWxhdGl2ZSAmJiBwYXRoWzBdID09ICcvJykgcGF0aCA9IHBhdGguc3Vic3RyKDEpOwogICAgICAgIHJldHVybiBwYXRoCiAgICAgIH0sCiAgICAgIGFic29sdXRlUGF0aDogZnVuY3Rpb24gKHJlbGF0aXZlLCBiYXNlKSB7CiAgICAgICAgcmV0dXJuIFBBVEgucmVzb2x2ZShiYXNlLCByZWxhdGl2ZSkKICAgICAgfSwKICAgICAgc3RhbmRhcmRpemVQYXRoOiBmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHJldHVybiBQQVRILm5vcm1hbGl6ZShwYXRoKQogICAgICB9LAogICAgICBmaW5kT2JqZWN0OiBmdW5jdGlvbiAocGF0aCwgZG9udFJlc29sdmVMYXN0TGluaykgewogICAgICAgIHZhciByZXQgPSBGUy5hbmFseXplUGF0aChwYXRoLCBkb250UmVzb2x2ZUxhc3RMaW5rKTsKICAgICAgICBpZiAocmV0LmV4aXN0cykgewogICAgICAgICAgcmV0dXJuIHJldC5vYmplY3QKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX19fc2V0RXJyTm8ocmV0LmVycm9yKTsKICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICB9LAogICAgICBhbmFseXplUGF0aDogZnVuY3Rpb24gKHBhdGgsIGRvbnRSZXNvbHZlTGFzdExpbmspIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6ICFkb250UmVzb2x2ZUxhc3RMaW5rIH0pOwogICAgICAgICAgcGF0aCA9IGxvb2t1cC5wYXRoOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgdmFyIHJldCA9IHsKICAgICAgICAgIGlzUm9vdDogZmFsc2UsCiAgICAgICAgICBleGlzdHM6IGZhbHNlLAogICAgICAgICAgZXJyb3I6IDAsCiAgICAgICAgICBuYW1lOiBudWxsLAogICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgIHBhcmVudEV4aXN0czogZmFsc2UsCiAgICAgICAgICBwYXJlbnRQYXRoOiBudWxsLAogICAgICAgICAgcGFyZW50T2JqZWN0OiBudWxsLAogICAgICAgIH07CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgcGFyZW50OiB0cnVlIH0pOwogICAgICAgICAgcmV0LnBhcmVudEV4aXN0cyA9IHRydWU7CiAgICAgICAgICByZXQucGFyZW50UGF0aCA9IGxvb2t1cC5wYXRoOwogICAgICAgICAgcmV0LnBhcmVudE9iamVjdCA9IGxvb2t1cC5ub2RlOwogICAgICAgICAgcmV0Lm5hbWUgPSBQQVRILmJhc2VuYW1lKHBhdGgpOwogICAgICAgICAgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IGZvbGxvdzogIWRvbnRSZXNvbHZlTGFzdExpbmsgfSk7CiAgICAgICAgICByZXQuZXhpc3RzID0gdHJ1ZTsKICAgICAgICAgIHJldC5wYXRoID0gbG9va3VwLnBhdGg7CiAgICAgICAgICByZXQub2JqZWN0ID0gbG9va3VwLm5vZGU7CiAgICAgICAgICByZXQubmFtZSA9IGxvb2t1cC5ub2RlLm5hbWU7CiAgICAgICAgICByZXQuaXNSb290ID0gbG9va3VwLnBhdGggPT09ICcvJzsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXQuZXJyb3IgPSBlLmVycm5vOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0CiAgICAgIH0sCiAgICAgIGNyZWF0ZUZvbGRlcjogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgY2FuUmVhZCwgY2FuV3JpdGUpIHsKICAgICAgICB2YXIgcGF0aCA9IFBBVEguam9pbjIodHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycgPyBwYXJlbnQgOiBGUy5nZXRQYXRoKHBhcmVudCksIG5hbWUpOwogICAgICAgIHZhciBtb2RlID0gRlMuZ2V0TW9kZShjYW5SZWFkLCBjYW5Xcml0ZSk7CiAgICAgICAgcmV0dXJuIEZTLm1rZGlyKHBhdGgsIG1vZGUpCiAgICAgIH0sCiAgICAgIGNyZWF0ZVBhdGg6IGZ1bmN0aW9uIChwYXJlbnQsIHBhdGgsIGNhblJlYWQsIGNhbldyaXRlKSB7CiAgICAgICAgcGFyZW50ID0gdHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycgPyBwYXJlbnQgOiBGUy5nZXRQYXRoKHBhcmVudCk7CiAgICAgICAgdmFyIHBhcnRzID0gcGF0aC5zcGxpdCgnLycpLnJldmVyc2UoKTsKICAgICAgICB3aGlsZSAocGFydHMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgcGFydCA9IHBhcnRzLnBvcCgpOwogICAgICAgICAgaWYgKCFwYXJ0KSBjb250aW51ZQogICAgICAgICAgdmFyIGN1cnJlbnQgPSBQQVRILmpvaW4yKHBhcmVudCwgcGFydCk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBGUy5ta2RpcihjdXJyZW50KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICBwYXJlbnQgPSBjdXJyZW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3VycmVudAogICAgICB9LAogICAgICBjcmVhdGVGaWxlOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lLCBwcm9wZXJ0aWVzLCBjYW5SZWFkLCBjYW5Xcml0ZSkgewogICAgICAgIHZhciBwYXRoID0gUEFUSC5qb2luMih0eXBlb2YgcGFyZW50ID09PSAnc3RyaW5nJyA/IHBhcmVudCA6IEZTLmdldFBhdGgocGFyZW50KSwgbmFtZSk7CiAgICAgICAgdmFyIG1vZGUgPSBGUy5nZXRNb2RlKGNhblJlYWQsIGNhbldyaXRlKTsKICAgICAgICByZXR1cm4gRlMuY3JlYXRlKHBhdGgsIG1vZGUpCiAgICAgIH0sCiAgICAgIGNyZWF0ZURhdGFGaWxlOiBmdW5jdGlvbiAocGFyZW50LCBuYW1lLCBkYXRhLCBjYW5SZWFkLCBjYW5Xcml0ZSwgY2FuT3duKSB7CiAgICAgICAgdmFyIHBhdGggPSBuYW1lID8gUEFUSC5qb2luMih0eXBlb2YgcGFyZW50ID09PSAnc3RyaW5nJyA/IHBhcmVudCA6IEZTLmdldFBhdGgocGFyZW50KSwgbmFtZSkgOiBwYXJlbnQ7CiAgICAgICAgdmFyIG1vZGUgPSBGUy5nZXRNb2RlKGNhblJlYWQsIGNhbldyaXRlKTsKICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZShwYXRoLCBtb2RlKTsKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAgICAgICB2YXIgYXJyID0gbmV3IEFycmF5KGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyArK2kpIGFycltpXSA9IGRhdGEuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgZGF0YSA9IGFycjsKICAgICAgICAgIH0KICAgICAgICAgIEZTLmNobW9kKG5vZGUsIG1vZGUgfCAxNDYpOwogICAgICAgICAgdmFyIHN0cmVhbSA9IEZTLm9wZW4obm9kZSwgJ3cnKTsKICAgICAgICAgIEZTLndyaXRlKHN0cmVhbSwgZGF0YSwgMCwgZGF0YS5sZW5ndGgsIDAsIGNhbk93bik7CiAgICAgICAgICBGUy5jbG9zZShzdHJlYW0pOwogICAgICAgICAgRlMuY2htb2Qobm9kZSwgbW9kZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBub2RlCiAgICAgIH0sCiAgICAgIGNyZWF0ZURldmljZTogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgaW5wdXQsIG91dHB1dCkgewogICAgICAgIHZhciBwYXRoID0gUEFUSC5qb2luMih0eXBlb2YgcGFyZW50ID09PSAnc3RyaW5nJyA/IHBhcmVudCA6IEZTLmdldFBhdGgocGFyZW50KSwgbmFtZSk7CiAgICAgICAgdmFyIG1vZGUgPSBGUy5nZXRNb2RlKCEhaW5wdXQsICEhb3V0cHV0KTsKICAgICAgICBpZiAoIUZTLmNyZWF0ZURldmljZS5tYWpvcikgRlMuY3JlYXRlRGV2aWNlLm1ham9yID0gNjQ7CiAgICAgICAgdmFyIGRldiA9IEZTLm1ha2VkZXYoRlMuY3JlYXRlRGV2aWNlLm1ham9yKyssIDApOwogICAgICAgIEZTLnJlZ2lzdGVyRGV2aWNlKGRldiwgewogICAgICAgICAgb3BlbjogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICBzdHJlYW0uc2Vla2FibGUgPSBmYWxzZTsKICAgICAgICAgIH0sCiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICBpZiAob3V0cHV0ICYmIG91dHB1dC5idWZmZXIgJiYgb3V0cHV0LmJ1ZmZlci5sZW5ndGgpIHsKICAgICAgICAgICAgICBvdXRwdXQoMTApOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgcmVhZDogZnVuY3Rpb24gKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zKSB7CiAgICAgICAgICAgIHZhciBieXRlc1JlYWQgPSAwOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXQoKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU8pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCAmJiBieXRlc1JlYWQgPT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVBR0FJTikKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5lZCkgYnJlYWsKICAgICAgICAgICAgICBieXRlc1JlYWQrKzsKICAgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgaV0gPSByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCkgewogICAgICAgICAgICAgIHN0cmVhbS5ub2RlLnRpbWVzdGFtcCA9IERhdGUubm93KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJ5dGVzUmVhZAogICAgICAgICAgfSwKICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbiAoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3MpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBvdXRwdXQoYnVmZmVyW29mZnNldCArIGldKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FSU8pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsZW5ndGgpIHsKICAgICAgICAgICAgICBzdHJlYW0ubm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpCiAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgICAgIHJldHVybiBGUy5ta2RldihwYXRoLCBtb2RlLCBkZXYpCiAgICAgIH0sCiAgICAgIGNyZWF0ZUxpbms6IGZ1bmN0aW9uIChwYXJlbnQsIG5hbWUsIHRhcmdldCwgY2FuUmVhZCwgY2FuV3JpdGUpIHsKICAgICAgICB2YXIgcGF0aCA9IFBBVEguam9pbjIodHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycgPyBwYXJlbnQgOiBGUy5nZXRQYXRoKHBhcmVudCksIG5hbWUpOwogICAgICAgIHJldHVybiBGUy5zeW1saW5rKHRhcmdldCwgcGF0aCkKICAgICAgfSwKICAgICAgZm9yY2VMb2FkRmlsZTogZnVuY3Rpb24gKG9iaikgewogICAgICAgIGlmIChvYmouaXNEZXZpY2UgfHwgb2JqLmlzRm9sZGVyIHx8IG9iai5saW5rIHx8IG9iai5jb250ZW50cykgcmV0dXJuIHRydWUKICAgICAgICB2YXIgc3VjY2VzcyA9IHRydWU7CiAgICAgICAgaWYgKHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgJ0xhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLicKICAgICAgICAgICkKICAgICAgICB9IGVsc2UgaWYgKE1vZHVsZVsncmVhZCddKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBvYmouY29udGVudHMgPSBpbnRBcnJheUZyb21TdHJpbmcoTW9kdWxlWydyZWFkJ10ob2JqLnVybCksIHRydWUpOwogICAgICAgICAgICBvYmoudXNlZEJ5dGVzID0gb2JqLmNvbnRlbnRzLmxlbmd0aDsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBsb2FkIHdpdGhvdXQgcmVhZCgpIG9yIFhNTEh0dHBSZXF1ZXN0LicpCiAgICAgICAgfQogICAgICAgIGlmICghc3VjY2VzcykgX19fc2V0RXJyTm8oRVJSTk9fQ09ERVMuRUlPKTsKICAgICAgICByZXR1cm4gc3VjY2VzcwogICAgICB9LAogICAgICBjcmVhdGVMYXp5RmlsZTogZnVuY3Rpb24gKHBhcmVudCwgbmFtZSwgdXJsLCBjYW5SZWFkLCBjYW5Xcml0ZSkgewogICAgICAgIGZ1bmN0aW9uIExhenlVaW50OEFycmF5KCkgewogICAgICAgICAgdGhpcy5sZW5ndGhLbm93biA9IGZhbHNlOwogICAgICAgICAgdGhpcy5jaHVua3MgPSBbXTsKICAgICAgICB9CiAgICAgICAgTGF6eVVpbnQ4QXJyYXkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIExhenlVaW50OEFycmF5X2dldChpZHgpIHsKICAgICAgICAgIGlmIChpZHggPiB0aGlzLmxlbmd0aCAtIDEgfHwgaWR4IDwgMCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2h1bmtPZmZzZXQgPSBpZHggJSB0aGlzLmNodW5rU2l6ZTsKICAgICAgICAgIHZhciBjaHVua051bSA9IChpZHggLyB0aGlzLmNodW5rU2l6ZSkgfCAwOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0dGVyKGNodW5rTnVtKVtjaHVua09mZnNldF0KICAgICAgICB9OwogICAgICAgIExhenlVaW50OEFycmF5LnByb3RvdHlwZS5zZXREYXRhR2V0dGVyID0gZnVuY3Rpb24gTGF6eVVpbnQ4QXJyYXlfc2V0RGF0YUdldHRlcihnZXR0ZXIpIHsKICAgICAgICAgIHRoaXMuZ2V0dGVyID0gZ2V0dGVyOwogICAgICAgIH07CiAgICAgICAgTGF6eVVpbnQ4QXJyYXkucHJvdG90eXBlLmNhY2hlTGVuZ3RoID0gZnVuY3Rpb24gTGF6eVVpbnQ4QXJyYXlfY2FjaGVMZW5ndGgoKSB7CiAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICB4aHIub3BlbignSEVBRCcsIHVybCwgZmFsc2UpOwogICAgICAgICAgeGhyLnNlbmQobnVsbCk7CiAgICAgICAgICBpZiAoISgoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgfHwgeGhyLnN0YXR1cyA9PT0gMzA0KSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCBsb2FkICIgKyB1cmwgKyAnLiBTdGF0dXM6ICcgKyB4aHIuc3RhdHVzKQogICAgICAgICAgdmFyIGRhdGFsZW5ndGggPSBOdW1iZXIoeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdDb250ZW50LWxlbmd0aCcpKTsKICAgICAgICAgIHZhciBoZWFkZXI7CiAgICAgICAgICB2YXIgaGFzQnl0ZVNlcnZpbmcgPSAoaGVhZGVyID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCdBY2NlcHQtUmFuZ2VzJykpICYmIGhlYWRlciA9PT0gJ2J5dGVzJzsKICAgICAgICAgIHZhciB1c2VzR3ppcCA9IChoZWFkZXIgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ0NvbnRlbnQtRW5jb2RpbmcnKSkgJiYgaGVhZGVyID09PSAnZ3ppcCc7CiAgICAgICAgICB2YXIgY2h1bmtTaXplID0gMTAyNCAqIDEwMjQ7CiAgICAgICAgICBpZiAoIWhhc0J5dGVTZXJ2aW5nKSBjaHVua1NpemUgPSBkYXRhbGVuZ3RoOwogICAgICAgICAgdmFyIGRvWEhSID0gZnVuY3Rpb24gKGZyb20sIHRvKSB7CiAgICAgICAgICAgIGlmIChmcm9tID4gdG8pIHRocm93IG5ldyBFcnJvcignaW52YWxpZCByYW5nZSAoJyArIGZyb20gKyAnLCAnICsgdG8gKyAnKSBvciBubyBieXRlcyByZXF1ZXN0ZWQhJykKICAgICAgICAgICAgaWYgKHRvID4gZGF0YWxlbmd0aCAtIDEpIHRocm93IG5ldyBFcnJvcignb25seSAnICsgZGF0YWxlbmd0aCArICcgYnl0ZXMgYXZhaWxhYmxlISBwcm9ncmFtbWVyIGVycm9yIScpCiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgZmFsc2UpOwogICAgICAgICAgICBpZiAoZGF0YWxlbmd0aCAhPT0gY2h1bmtTaXplKSB4aHIuc2V0UmVxdWVzdEhlYWRlcignUmFuZ2UnLCAnYnl0ZXM9JyArIGZyb20gKyAnLScgKyB0byk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgVWludDhBcnJheSAhPSAndW5kZWZpbmVkJykgeGhyLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7CiAgICAgICAgICAgIGlmICh4aHIub3ZlcnJpZGVNaW1lVHlwZSkgewogICAgICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCd0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGhyLnNlbmQobnVsbCk7CiAgICAgICAgICAgIGlmICghKCh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSB8fCB4aHIuc3RhdHVzID09PSAzMDQpKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGRuJ3QgbG9hZCAiICsgdXJsICsgJy4gU3RhdHVzOiAnICsgeGhyLnN0YXR1cykKICAgICAgICAgICAgaWYgKHhoci5yZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHhoci5yZXNwb25zZSB8fCBbXSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gaW50QXJyYXlGcm9tU3RyaW5nKHhoci5yZXNwb25zZVRleHQgfHwgJycsIHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICB2YXIgbGF6eUFycmF5ID0gdGhpczsKICAgICAgICAgIGxhenlBcnJheS5zZXREYXRhR2V0dGVyKGZ1bmN0aW9uIChjaHVua051bSkgewogICAgICAgICAgICB2YXIgc3RhcnQgPSBjaHVua051bSAqIGNodW5rU2l6ZTsKICAgICAgICAgICAgdmFyIGVuZCA9IChjaHVua051bSArIDEpICogY2h1bmtTaXplIC0gMTsKICAgICAgICAgICAgZW5kID0gTWF0aC5taW4oZW5kLCBkYXRhbGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgbGF6eUFycmF5LmNodW5rc1tjaHVua051bV0gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgbGF6eUFycmF5LmNodW5rc1tjaHVua051bV0gPSBkb1hIUihzdGFydCwgZW5kKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIGxhenlBcnJheS5jaHVua3NbY2h1bmtOdW1dID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCdkb1hIUiBmYWlsZWQhJykKICAgICAgICAgICAgcmV0dXJuIGxhenlBcnJheS5jaHVua3NbY2h1bmtOdW1dCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICh1c2VzR3ppcCB8fCAhZGF0YWxlbmd0aCkgewogICAgICAgICAgICBjaHVua1NpemUgPSBkYXRhbGVuZ3RoID0gMTsKICAgICAgICAgICAgZGF0YWxlbmd0aCA9IHRoaXMuZ2V0dGVyKDApLmxlbmd0aDsKICAgICAgICAgICAgY2h1bmtTaXplID0gZGF0YWxlbmd0aDsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0xhenlGaWxlcyBvbiBnemlwIGZvcmNlcyBkb3dubG9hZCBvZiB0aGUgd2hvbGUgZmlsZSB3aGVuIGxlbmd0aCBpcyBhY2Nlc3NlZCcpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fbGVuZ3RoID0gZGF0YWxlbmd0aDsKICAgICAgICAgIHRoaXMuX2NodW5rU2l6ZSA9IGNodW5rU2l6ZTsKICAgICAgICAgIHRoaXMubGVuZ3RoS25vd24gPSB0cnVlOwogICAgICAgIH07CiAgICAgICAgaWYgKHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIGlmICghRU5WSVJPTk1FTlRfSVNfV09SS0VSKQogICAgICAgICAgICB0aHJvdyAnQ2Fubm90IGRvIHN5bmNocm9ub3VzIGJpbmFyeSBYSFJzIG91dHNpZGUgd2Vid29ya2VycyBpbiBtb2Rlcm4gYnJvd3NlcnMuIFVzZSAtLWVtYmVkLWZpbGUgb3IgLS1wcmVsb2FkLWZpbGUgaW4gZW1jYycKICAgICAgICAgIHZhciBsYXp5QXJyYXkgPSBuZXcgTGF6eVVpbnQ4QXJyYXkoKTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGxhenlBcnJheSwgewogICAgICAgICAgICBsZW5ndGg6IHsKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5sZW5ndGhLbm93bikgewogICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlTGVuZ3RoKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2h1bmtTaXplOiB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubGVuZ3RoS25vd24pIHsKICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZUxlbmd0aCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NodW5rU2l6ZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0geyBpc0RldmljZTogZmFsc2UsIGNvbnRlbnRzOiBsYXp5QXJyYXkgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB7IGlzRGV2aWNlOiBmYWxzZSwgdXJsOiB1cmwgfTsKICAgICAgICB9CiAgICAgICAgdmFyIG5vZGUgPSBGUy5jcmVhdGVGaWxlKHBhcmVudCwgbmFtZSwgcHJvcGVydGllcywgY2FuUmVhZCwgY2FuV3JpdGUpOwogICAgICAgIGlmIChwcm9wZXJ0aWVzLmNvbnRlbnRzKSB7CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gcHJvcGVydGllcy5jb250ZW50czsKICAgICAgICB9IGVsc2UgaWYgKHByb3BlcnRpZXMudXJsKSB7CiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gbnVsbDsKICAgICAgICAgIG5vZGUudXJsID0gcHJvcGVydGllcy51cmw7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG5vZGUsIHsKICAgICAgICAgIHVzZWRCeXRlczogewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50cy5sZW5ndGgKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgICAgdmFyIHN0cmVhbV9vcHMgPSB7fTsKICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG5vZGUuc3RyZWFtX29wcyk7CiAgICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHZhciBmbiA9IG5vZGUuc3RyZWFtX29wc1trZXldOwogICAgICAgICAgc3RyZWFtX29wc1trZXldID0gZnVuY3Rpb24gZm9yY2VMb2FkTGF6eUZpbGUoKSB7CiAgICAgICAgICAgIGlmICghRlMuZm9yY2VMb2FkRmlsZShub2RlKSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTykKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1fb3BzLnJlYWQgPSBmdW5jdGlvbiBzdHJlYW1fb3BzX3JlYWQoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgICAgaWYgKCFGUy5mb3JjZUxvYWRGaWxlKG5vZGUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVJTykKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjb250ZW50cyA9IHN0cmVhbS5ub2RlLmNvbnRlbnRzOwogICAgICAgICAgaWYgKHBvc2l0aW9uID49IGNvbnRlbnRzLmxlbmd0aCkgcmV0dXJuIDAKICAgICAgICAgIHZhciBzaXplID0gTWF0aC5taW4oY29udGVudHMubGVuZ3RoIC0gcG9zaXRpb24sIGxlbmd0aCk7CiAgICAgICAgICBhc3NlcnQoc2l6ZSA+PSAwKTsKICAgICAgICAgIGlmIChjb250ZW50cy5zbGljZSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGNvbnRlbnRzW3Bvc2l0aW9uICsgaV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgYnVmZmVyW29mZnNldCArIGldID0gY29udGVudHMuZ2V0KHBvc2l0aW9uICsgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzaXplCiAgICAgICAgfTsKICAgICAgICBub2RlLnN0cmVhbV9vcHMgPSBzdHJlYW1fb3BzOwogICAgICAgIHJldHVybiBub2RlCiAgICAgIH0sCiAgICAgIGNyZWF0ZVByZWxvYWRlZEZpbGU6IGZ1bmN0aW9uICgKICAgICAgICBwYXJlbnQsCiAgICAgICAgbmFtZSwKICAgICAgICB1cmwsCiAgICAgICAgY2FuUmVhZCwKICAgICAgICBjYW5Xcml0ZSwKICAgICAgICBvbmxvYWQsCiAgICAgICAgb25lcnJvciwKICAgICAgICBkb250Q3JlYXRlRmlsZSwKICAgICAgICBjYW5Pd24sCiAgICAgICAgcHJlRmluaXNoCiAgICAgICkgewogICAgICAgIEJyb3dzZXIuaW5pdCgpOwogICAgICAgIHZhciBmdWxsbmFtZSA9IG5hbWUgPyBQQVRILnJlc29sdmUoUEFUSC5qb2luMihwYXJlbnQsIG5hbWUpKSA6IHBhcmVudDsKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRGF0YShieXRlQXJyYXkpIHsKICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaChieXRlQXJyYXkpIHsKICAgICAgICAgICAgaWYgKHByZUZpbmlzaCkgcHJlRmluaXNoKCk7CiAgICAgICAgICAgIGlmICghZG9udENyZWF0ZUZpbGUpIHsKICAgICAgICAgICAgICBGUy5jcmVhdGVEYXRhRmlsZShwYXJlbnQsIG5hbWUsIGJ5dGVBcnJheSwgY2FuUmVhZCwgY2FuV3JpdGUsIGNhbk93bik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9ubG9hZCkgb25sb2FkKCk7CiAgICAgICAgICAgIHJlbW92ZVJ1bkRlcGVuZGVuY3koKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBoYW5kbGVkID0gZmFsc2U7CiAgICAgICAgICBNb2R1bGVbJ3ByZWxvYWRQbHVnaW5zJ10uZm9yRWFjaChmdW5jdGlvbiAocGx1Z2luKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVkKSByZXR1cm4KICAgICAgICAgICAgaWYgKHBsdWdpblsnY2FuSGFuZGxlJ10oZnVsbG5hbWUpKSB7CiAgICAgICAgICAgICAgcGx1Z2luWydoYW5kbGUnXShieXRlQXJyYXksIGZ1bGxuYW1lLCBmaW5pc2gsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChvbmVycm9yKSBvbmVycm9yKCk7CiAgICAgICAgICAgICAgICByZW1vdmVSdW5EZXBlbmRlbmN5KCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFoYW5kbGVkKSBmaW5pc2goYnl0ZUFycmF5KTsKICAgICAgICB9CiAgICAgICAgYWRkUnVuRGVwZW5kZW5jeSgpOwogICAgICAgIGlmICh0eXBlb2YgdXJsID09ICdzdHJpbmcnKSB7CiAgICAgICAgICBCcm93c2VyLmFzeW5jTG9hZCgKICAgICAgICAgICAgdXJsLAogICAgICAgICAgICBmdW5jdGlvbiAoYnl0ZUFycmF5KSB7CiAgICAgICAgICAgICAgcHJvY2Vzc0RhdGEoYnl0ZUFycmF5KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25lcnJvcgogICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHJvY2Vzc0RhdGEodXJsKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGluZGV4ZWREQjogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB3aW5kb3cuaW5kZXhlZERCIHx8IHdpbmRvdy5tb3pJbmRleGVkREIgfHwgd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCB3aW5kb3cubXNJbmRleGVkREIKICAgICAgfSwKICAgICAgREJfTkFNRTogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAnRU1fRlNfJyArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZQogICAgICB9LAogICAgICBEQl9WRVJTSU9OOiAyMCwKICAgICAgREJfU1RPUkVfTkFNRTogJ0ZJTEVfREFUQScsCiAgICAgIHNhdmVGaWxlc1RvREI6IGZ1bmN0aW9uIChwYXRocywgb25sb2FkLCBvbmVycm9yKSB7CiAgICAgICAgb25sb2FkID0gb25sb2FkIHx8IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIG9uZXJyb3IgPSBvbmVycm9yIHx8IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIHZhciBpbmRleGVkREIgPSBGUy5pbmRleGVkREIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oRlMuREJfTkFNRSgpLCBGUy5EQl9WRVJTSU9OKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gb25lcnJvcihlKQogICAgICAgIH0KICAgICAgICBvcGVuUmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiBvcGVuUmVxdWVzdF9vbnVwZ3JhZGVuZWVkZWQoKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRpbmcgZGInKTsKICAgICAgICAgIHZhciBkYiA9IG9wZW5SZXF1ZXN0LnJlc3VsdDsKICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKEZTLkRCX1NUT1JFX05BTUUpOwogICAgICAgIH07CiAgICAgICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gb3BlblJlcXVlc3Rfb25zdWNjZXNzKCkgewogICAgICAgICAgdmFyIGRiID0gb3BlblJlcXVlc3QucmVzdWx0OwogICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW0ZTLkRCX1NUT1JFX05BTUVdLCAncmVhZHdyaXRlJyk7CiAgICAgICAgICB2YXIgZmlsZXMgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShGUy5EQl9TVE9SRV9OQU1FKTsKICAgICAgICAgIHZhciBvayA9IDAsCiAgICAgICAgICAgIGZhaWwgPSAwLAogICAgICAgICAgICB0b3RhbCA9IHBhdGhzLmxlbmd0aDsKICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaCgpIHsKICAgICAgICAgICAgaWYgKGZhaWwgPT0gMCkgb25sb2FkKCk7CiAgICAgICAgICAgIGVsc2Ugb25lcnJvcigpOwogICAgICAgICAgfQogICAgICAgICAgcGF0aHMuZm9yRWFjaChmdW5jdGlvbiAocGF0aCkgewogICAgICAgICAgICB2YXIgcHV0UmVxdWVzdCA9IGZpbGVzLnB1dChGUy5hbmFseXplUGF0aChwYXRoKS5vYmplY3QuY29udGVudHMsIHBhdGgpOwogICAgICAgICAgICBwdXRSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIHB1dFJlcXVlc3Rfb25zdWNjZXNzKCkgewogICAgICAgICAgICAgIG9rKys7CiAgICAgICAgICAgICAgaWYgKG9rICsgZmFpbCA9PSB0b3RhbCkgZmluaXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB1dFJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIHB1dFJlcXVlc3Rfb25lcnJvcigpIHsKICAgICAgICAgICAgICBmYWlsKys7CiAgICAgICAgICAgICAgaWYgKG9rICsgZmFpbCA9PSB0b3RhbCkgZmluaXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBvbmVycm9yOwogICAgICAgIH07CiAgICAgICAgb3BlblJlcXVlc3Qub25lcnJvciA9IG9uZXJyb3I7CiAgICAgIH0sCiAgICAgIGxvYWRGaWxlc0Zyb21EQjogZnVuY3Rpb24gKHBhdGhzLCBvbmxvYWQsIG9uZXJyb3IpIHsKICAgICAgICBvbmxvYWQgPSBvbmxvYWQgfHwgZnVuY3Rpb24gKCkge307CiAgICAgICAgb25lcnJvciA9IG9uZXJyb3IgfHwgZnVuY3Rpb24gKCkge307CiAgICAgICAgdmFyIGluZGV4ZWREQiA9IEZTLmluZGV4ZWREQigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbihGUy5EQl9OQU1FKCksIEZTLkRCX1ZFUlNJT04pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBvbmVycm9yKGUpCiAgICAgICAgfQogICAgICAgIG9wZW5SZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IG9uZXJyb3I7CiAgICAgICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gb3BlblJlcXVlc3Rfb25zdWNjZXNzKCkgewogICAgICAgICAgdmFyIGRiID0gb3BlblJlcXVlc3QucmVzdWx0OwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW0ZTLkRCX1NUT1JFX05BTUVdLCAncmVhZG9ubHknKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgb25lcnJvcihlKTsKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZmlsZXMgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShGUy5EQl9TVE9SRV9OQU1FKTsKICAgICAgICAgIHZhciBvayA9IDAsCiAgICAgICAgICAgIGZhaWwgPSAwLAogICAgICAgICAgICB0b3RhbCA9IHBhdGhzLmxlbmd0aDsKICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaCgpIHsKICAgICAgICAgICAgaWYgKGZhaWwgPT0gMCkgb25sb2FkKCk7CiAgICAgICAgICAgIGVsc2Ugb25lcnJvcigpOwogICAgICAgICAgfQogICAgICAgICAgcGF0aHMuZm9yRWFjaChmdW5jdGlvbiAocGF0aCkgewogICAgICAgICAgICB2YXIgZ2V0UmVxdWVzdCA9IGZpbGVzLmdldChwYXRoKTsKICAgICAgICAgICAgZ2V0UmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiBnZXRSZXF1ZXN0X29uc3VjY2VzcygpIHsKICAgICAgICAgICAgICBpZiAoRlMuYW5hbHl6ZVBhdGgocGF0aCkuZXhpc3RzKSB7CiAgICAgICAgICAgICAgICBGUy51bmxpbmsocGF0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIEZTLmNyZWF0ZURhdGFGaWxlKFBBVEguZGlybmFtZShwYXRoKSwgUEFUSC5iYXNlbmFtZShwYXRoKSwgZ2V0UmVxdWVzdC5yZXN1bHQsIHRydWUsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgIG9rKys7CiAgICAgICAgICAgICAgaWYgKG9rICsgZmFpbCA9PSB0b3RhbCkgZmluaXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGdldFJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIGdldFJlcXVlc3Rfb25lcnJvcigpIHsKICAgICAgICAgICAgICBmYWlsKys7CiAgICAgICAgICAgICAgaWYgKG9rICsgZmFpbCA9PSB0b3RhbCkgZmluaXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBvbmVycm9yOwogICAgICAgIH07CiAgICAgICAgb3BlblJlcXVlc3Qub25lcnJvciA9IG9uZXJyb3I7CiAgICAgIH0sCiAgICB9OwogICAgdmFyIFNZU0NBTExTID0gewogICAgICBERUZBVUxUX1BPTExNQVNLOiA1LAogICAgICBtYXBwaW5nczoge30sCiAgICAgIHVtYXNrOiA1MTEsCiAgICAgIGNhbGN1bGF0ZUF0OiBmdW5jdGlvbiAoZGlyZmQsIHBhdGgpIHsKICAgICAgICBpZiAocGF0aFswXSAhPT0gJy8nKSB7CiAgICAgICAgICB2YXIgZGlyOwogICAgICAgICAgaWYgKGRpcmZkID09PSAtMTAwKSB7CiAgICAgICAgICAgIGRpciA9IEZTLmN3ZCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGRpcnN0cmVhbSA9IEZTLmdldFN0cmVhbShkaXJmZCk7CiAgICAgICAgICAgIGlmICghZGlyc3RyZWFtKSB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQkFERikKICAgICAgICAgICAgZGlyID0gZGlyc3RyZWFtLnBhdGg7CiAgICAgICAgICB9CiAgICAgICAgICBwYXRoID0gUEFUSC5qb2luMihkaXIsIHBhdGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF0aAogICAgICB9LAogICAgICBkb1N0YXQ6IGZ1bmN0aW9uIChmdW5jLCBwYXRoLCBidWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHN0YXQgPSBmdW5jKHBhdGgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGlmIChlICYmIGUubm9kZSAmJiBQQVRILm5vcm1hbGl6ZShwYXRoKSAhPT0gUEFUSC5ub3JtYWxpemUoRlMuZ2V0UGF0aChlLm5vZGUpKSkgewogICAgICAgICAgICByZXR1cm4gLUVSUk5PX0NPREVTLkVOT1RESVIKICAgICAgICAgIH0KICAgICAgICAgIHRocm93IGUKICAgICAgICB9CiAgICAgICAgSEVBUDMyW2J1ZiA+PiAyXSA9IHN0YXQuZGV2OwogICAgICAgIEhFQVAzMlsoYnVmICsgNCkgPj4gMl0gPSAwOwogICAgICAgIEhFQVAzMlsoYnVmICsgOCkgPj4gMl0gPSBzdGF0LmlubzsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDEyKSA+PiAyXSA9IHN0YXQubW9kZTsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDE2KSA+PiAyXSA9IHN0YXQubmxpbms7CiAgICAgICAgSEVBUDMyWyhidWYgKyAyMCkgPj4gMl0gPSBzdGF0LnVpZDsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDI0KSA+PiAyXSA9IHN0YXQuZ2lkOwogICAgICAgIEhFQVAzMlsoYnVmICsgMjgpID4+IDJdID0gc3RhdC5yZGV2OwogICAgICAgIEhFQVAzMlsoYnVmICsgMzIpID4+IDJdID0gMDsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDM2KSA+PiAyXSA9IHN0YXQuc2l6ZTsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDQwKSA+PiAyXSA9IDQwOTY7CiAgICAgICAgSEVBUDMyWyhidWYgKyA0NCkgPj4gMl0gPSBzdGF0LmJsb2NrczsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDQ4KSA+PiAyXSA9IChzdGF0LmF0aW1lLmdldFRpbWUoKSAvIDFlMykgfCAwOwogICAgICAgIEhFQVAzMlsoYnVmICsgNTIpID4+IDJdID0gMDsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDU2KSA+PiAyXSA9IChzdGF0Lm10aW1lLmdldFRpbWUoKSAvIDFlMykgfCAwOwogICAgICAgIEhFQVAzMlsoYnVmICsgNjApID4+IDJdID0gMDsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDY0KSA+PiAyXSA9IChzdGF0LmN0aW1lLmdldFRpbWUoKSAvIDFlMykgfCAwOwogICAgICAgIEhFQVAzMlsoYnVmICsgNjgpID4+IDJdID0gMDsKICAgICAgICBIRUFQMzJbKGJ1ZiArIDcyKSA+PiAyXSA9IHN0YXQuaW5vOwogICAgICAgIHJldHVybiAwCiAgICAgIH0sCiAgICAgIGRvTXN5bmM6IGZ1bmN0aW9uIChhZGRyLCBzdHJlYW0sIGxlbiwgZmxhZ3MpIHsKICAgICAgICB2YXIgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoSEVBUFU4LnN1YmFycmF5KGFkZHIsIGFkZHIgKyBsZW4pKTsKICAgICAgICBGUy5tc3luYyhzdHJlYW0sIGJ1ZmZlciwgMCwgbGVuLCBmbGFncyk7CiAgICAgIH0sCiAgICAgIGRvTWtkaXI6IGZ1bmN0aW9uIChwYXRoLCBtb2RlKSB7CiAgICAgICAgcGF0aCA9IFBBVEgubm9ybWFsaXplKHBhdGgpOwogICAgICAgIGlmIChwYXRoW3BhdGgubGVuZ3RoIC0gMV0gPT09ICcvJykgcGF0aCA9IHBhdGguc3Vic3RyKDAsIHBhdGgubGVuZ3RoIC0gMSk7CiAgICAgICAgRlMubWtkaXIocGF0aCwgbW9kZSwgMCk7CiAgICAgICAgcmV0dXJuIDAKICAgICAgfSwKICAgICAgZG9Na25vZDogZnVuY3Rpb24gKHBhdGgsIG1vZGUsIGRldikgewogICAgICAgIHN3aXRjaCAobW9kZSAmIDYxNDQwKSB7CiAgICAgICAgICBjYXNlIDMyNzY4OgogICAgICAgICAgY2FzZSA4MTkyOgogICAgICAgICAgY2FzZSAyNDU3NjoKICAgICAgICAgIGNhc2UgNDA5NjoKICAgICAgICAgIGNhc2UgNDkxNTI6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gLUVSUk5PX0NPREVTLkVJTlZBTAogICAgICAgIH0KICAgICAgICBGUy5ta25vZChwYXRoLCBtb2RlLCBkZXYpOwogICAgICAgIHJldHVybiAwCiAgICAgIH0sCiAgICAgIGRvUmVhZGxpbms6IGZ1bmN0aW9uIChwYXRoLCBidWYsIGJ1ZnNpemUpIHsKICAgICAgICBpZiAoYnVmc2l6ZSA8PSAwKSByZXR1cm4gLUVSUk5PX0NPREVTLkVJTlZBTAogICAgICAgIHZhciByZXQgPSBGUy5yZWFkbGluayhwYXRoKTsKICAgICAgICB2YXIgbGVuID0gTWF0aC5taW4oYnVmc2l6ZSwgbGVuZ3RoQnl0ZXNVVEY4KHJldCkpOwogICAgICAgIHZhciBlbmRDaGFyID0gSEVBUDhbYnVmICsgbGVuXTsKICAgICAgICBzdHJpbmdUb1VURjgocmV0LCBidWYsIGJ1ZnNpemUgKyAxKTsKICAgICAgICBIRUFQOFtidWYgKyBsZW5dID0gZW5kQ2hhcjsKICAgICAgICByZXR1cm4gbGVuCiAgICAgIH0sCiAgICAgIGRvQWNjZXNzOiBmdW5jdGlvbiAocGF0aCwgYW1vZGUpIHsKICAgICAgICBpZiAoYW1vZGUgJiB+NykgewogICAgICAgICAgcmV0dXJuIC1FUlJOT19DT0RFUy5FSU5WQUwKICAgICAgICB9CiAgICAgICAgdmFyIG5vZGU7CiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6IHRydWUgfSk7CiAgICAgICAgbm9kZSA9IGxvb2t1cC5ub2RlOwogICAgICAgIHZhciBwZXJtcyA9ICcnOwogICAgICAgIGlmIChhbW9kZSAmIDQpIHBlcm1zICs9ICdyJzsKICAgICAgICBpZiAoYW1vZGUgJiAyKSBwZXJtcyArPSAndyc7CiAgICAgICAgaWYgKGFtb2RlICYgMSkgcGVybXMgKz0gJ3gnOwogICAgICAgIGlmIChwZXJtcyAmJiBGUy5ub2RlUGVybWlzc2lvbnMobm9kZSwgcGVybXMpKSB7CiAgICAgICAgICByZXR1cm4gLUVSUk5PX0NPREVTLkVBQ0NFUwogICAgICAgIH0KICAgICAgICByZXR1cm4gMAogICAgICB9LAogICAgICBkb0R1cDogZnVuY3Rpb24gKHBhdGgsIGZsYWdzLCBzdWdnZXN0RkQpIHsKICAgICAgICB2YXIgc3VnZ2VzdCA9IEZTLmdldFN0cmVhbShzdWdnZXN0RkQpOwogICAgICAgIGlmIChzdWdnZXN0KSBGUy5jbG9zZShzdWdnZXN0KTsKICAgICAgICByZXR1cm4gRlMub3BlbihwYXRoLCBmbGFncywgMCwgc3VnZ2VzdEZELCBzdWdnZXN0RkQpLmZkCiAgICAgIH0sCiAgICAgIGRvUmVhZHY6IGZ1bmN0aW9uIChzdHJlYW0sIGlvdiwgaW92Y250LCBvZmZzZXQpIHsKICAgICAgICB2YXIgcmV0ID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlvdmNudDsgaSsrKSB7CiAgICAgICAgICB2YXIgcHRyID0gSEVBUDMyWyhpb3YgKyBpICogOCkgPj4gMl07CiAgICAgICAgICB2YXIgbGVuID0gSEVBUDMyWyhpb3YgKyAoaSAqIDggKyA0KSkgPj4gMl07CiAgICAgICAgICB2YXIgY3VyciA9IEZTLnJlYWQoc3RyZWFtLCBIRUFQOCwgcHRyLCBsZW4sIG9mZnNldCk7CiAgICAgICAgICBpZiAoY3VyciA8IDApIHJldHVybiAtMQogICAgICAgICAgcmV0ICs9IGN1cnI7CiAgICAgICAgICBpZiAoY3VyciA8IGxlbikgYnJlYWsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldAogICAgICB9LAogICAgICBkb1dyaXRldjogZnVuY3Rpb24gKHN0cmVhbSwgaW92LCBpb3ZjbnQsIG9mZnNldCkgewogICAgICAgIHZhciByZXQgPSAwOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW92Y250OyBpKyspIHsKICAgICAgICAgIHZhciBwdHIgPSBIRUFQMzJbKGlvdiArIGkgKiA4KSA+PiAyXTsKICAgICAgICAgIHZhciBsZW4gPSBIRUFQMzJbKGlvdiArIChpICogOCArIDQpKSA+PiAyXTsKICAgICAgICAgIHZhciBjdXJyID0gRlMud3JpdGUoc3RyZWFtLCBIRUFQOCwgcHRyLCBsZW4sIG9mZnNldCk7CiAgICAgICAgICBpZiAoY3VyciA8IDApIHJldHVybiAtMQogICAgICAgICAgcmV0ICs9IGN1cnI7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQKICAgICAgfSwKICAgICAgdmFyYXJnczogMCwKICAgICAgZ2V0OiBmdW5jdGlvbiAodmFyYXJncykgewogICAgICAgIFNZU0NBTExTLnZhcmFyZ3MgKz0gNDsKICAgICAgICB2YXIgcmV0ID0gSEVBUDMyWyhTWVNDQUxMUy52YXJhcmdzIC0gNCkgPj4gMl07CiAgICAgICAgcmV0dXJuIHJldAogICAgICB9LAogICAgICBnZXRTdHI6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmV0ID0gUG9pbnRlcl9zdHJpbmdpZnkoU1lTQ0FMTFMuZ2V0KCkpOwogICAgICAgIHJldHVybiByZXQKICAgICAgfSwKICAgICAgZ2V0U3RyZWFtRnJvbUZEOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLmdldFN0cmVhbShTWVNDQUxMUy5nZXQoKSk7CiAgICAgICAgaWYgKCFzdHJlYW0pIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKEVSUk5PX0NPREVTLkVCQURGKQogICAgICAgIHJldHVybiBzdHJlYW0KICAgICAgfSwKICAgICAgZ2V0U29ja2V0RnJvbUZEOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNvY2tldCA9IFNPQ0tGUy5nZXRTb2NrZXQoU1lTQ0FMTFMuZ2V0KCkpOwogICAgICAgIGlmICghc29ja2V0KSB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihFUlJOT19DT0RFUy5FQkFERikKICAgICAgICByZXR1cm4gc29ja2V0CiAgICAgIH0sCiAgICAgIGdldFNvY2tldEFkZHJlc3M6IGZ1bmN0aW9uIChhbGxvd051bGwpIHsKICAgICAgICB2YXIgYWRkcnAgPSBTWVNDQUxMUy5nZXQoKSwKICAgICAgICAgIGFkZHJsZW4gPSBTWVNDQUxMUy5nZXQoKTsKICAgICAgICBpZiAoYWxsb3dOdWxsICYmIGFkZHJwID09PSAwKSByZXR1cm4gbnVsbAogICAgICAgIHZhciBpbmZvID0gX19yZWFkX3NvY2thZGRyKGFkZHJwLCBhZGRybGVuKTsKICAgICAgICBpZiAoaW5mby5lcnJubykgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoaW5mby5lcnJubykKICAgICAgICBpbmZvLmFkZHIgPSBETlMubG9va3VwX2FkZHIoaW5mby5hZGRyKSB8fCBpbmZvLmFkZHI7CiAgICAgICAgcmV0dXJuIGluZm8KICAgICAgfSwKICAgICAgZ2V0NjQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbG93ID0gU1lTQ0FMTFMuZ2V0KCksCiAgICAgICAgICBoaWdoID0gU1lTQ0FMTFMuZ2V0KCk7CiAgICAgICAgaWYgKGxvdyA+PSAwKSBhc3NlcnQoaGlnaCA9PT0gMCk7CiAgICAgICAgZWxzZSBhc3NlcnQoaGlnaCA9PT0gLTEpOwogICAgICAgIHJldHVybiBsb3cKICAgICAgfSwKICAgICAgZ2V0WmVybzogZnVuY3Rpb24gKCkgewogICAgICAgIGFzc2VydChTWVNDQUxMUy5nZXQoKSA9PT0gMCk7CiAgICAgIH0sCiAgICB9OwogICAgZnVuY3Rpb24gX19fc3lzY2FsbDE0MCh3aGljaCwgdmFyYXJncykgewogICAgICBTWVNDQUxMUy52YXJhcmdzID0gdmFyYXJnczsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgc3RyZWFtID0gU1lTQ0FMTFMuZ2V0U3RyZWFtRnJvbUZEKCksCiAgICAgICAgICBvZmZzZXRfaGlnaCA9IFNZU0NBTExTLmdldCgpLAogICAgICAgICAgb2Zmc2V0X2xvdyA9IFNZU0NBTExTLmdldCgpLAogICAgICAgICAgcmVzdWx0ID0gU1lTQ0FMTFMuZ2V0KCksCiAgICAgICAgICB3aGVuY2UgPSBTWVNDQUxMUy5nZXQoKTsKICAgICAgICB2YXIgb2Zmc2V0ID0gb2Zmc2V0X2xvdzsKICAgICAgICBGUy5sbHNlZWsoc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSk7CiAgICAgICAgSEVBUDMyW3Jlc3VsdCA+PiAyXSA9IHN0cmVhbS5wb3NpdGlvbjsKICAgICAgICBpZiAoc3RyZWFtLmdldGRlbnRzICYmIG9mZnNldCA9PT0gMCAmJiB3aGVuY2UgPT09IDApIHN0cmVhbS5nZXRkZW50cyA9IG51bGw7CiAgICAgICAgcmV0dXJuIDAKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsKICAgICAgICByZXR1cm4gLWUuZXJybm8KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19fc3lzY2FsbDE0NSh3aGljaCwgdmFyYXJncykgewogICAgICBTWVNDQUxMUy52YXJhcmdzID0gdmFyYXJnczsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgc3RyZWFtID0gU1lTQ0FMTFMuZ2V0U3RyZWFtRnJvbUZEKCksCiAgICAgICAgICBpb3YgPSBTWVNDQUxMUy5nZXQoKSwKICAgICAgICAgIGlvdmNudCA9IFNZU0NBTExTLmdldCgpOwogICAgICAgIHJldHVybiBTWVNDQUxMUy5kb1JlYWR2KHN0cmVhbSwgaW92LCBpb3ZjbnQpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIEZTID09PSAndW5kZWZpbmVkJyB8fCAhKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgYWJvcnQoZSk7CiAgICAgICAgcmV0dXJuIC1lLmVycm5vCiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9fX3N5c2NhbGwxNDYod2hpY2gsIHZhcmFyZ3MpIHsKICAgICAgU1lTQ0FMTFMudmFyYXJncyA9IHZhcmFyZ3M7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIHN0cmVhbSA9IFNZU0NBTExTLmdldFN0cmVhbUZyb21GRCgpLAogICAgICAgICAgaW92ID0gU1lTQ0FMTFMuZ2V0KCksCiAgICAgICAgICBpb3ZjbnQgPSBTWVNDQUxMUy5nZXQoKTsKICAgICAgICByZXR1cm4gU1lTQ0FMTFMuZG9Xcml0ZXYoc3RyZWFtLCBpb3YsIGlvdmNudCkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsKICAgICAgICByZXR1cm4gLWUuZXJybm8KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19fc3lzY2FsbDE4Myh3aGljaCwgdmFyYXJncykgewogICAgICBTWVNDQUxMUy52YXJhcmdzID0gdmFyYXJnczsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgYnVmID0gU1lTQ0FMTFMuZ2V0KCksCiAgICAgICAgICBzaXplID0gU1lTQ0FMTFMuZ2V0KCk7CiAgICAgICAgaWYgKHNpemUgPT09IDApIHJldHVybiAtRVJSTk9fQ09ERVMuRUlOVkFMCiAgICAgICAgdmFyIGN3ZCA9IEZTLmN3ZCgpOwogICAgICAgIHZhciBjd2RMZW5ndGhJbkJ5dGVzID0gbGVuZ3RoQnl0ZXNVVEY4KGN3ZCk7CiAgICAgICAgaWYgKHNpemUgPCBjd2RMZW5ndGhJbkJ5dGVzICsgMSkgcmV0dXJuIC1FUlJOT19DT0RFUy5FUkFOR0UKICAgICAgICBzdHJpbmdUb1VURjgoY3dkLCBidWYsIHNpemUpOwogICAgICAgIHJldHVybiBidWYKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsKICAgICAgICByZXR1cm4gLWUuZXJybm8KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19fc3lzY2FsbDE5OCh3aGljaCwgdmFyYXJncykgewogICAgICBTWVNDQUxMUy52YXJhcmdzID0gdmFyYXJnczsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgcGF0aCA9IFNZU0NBTExTLmdldFN0cigpLAogICAgICAgICAgb3duZXIgPSBTWVNDQUxMUy5nZXQoKSwKICAgICAgICAgIGdyb3VwID0gU1lTQ0FMTFMuZ2V0KCk7CiAgICAgICAgRlMuY2hvd24ocGF0aCwgb3duZXIsIGdyb3VwKTsKICAgICAgICByZXR1cm4gMAogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBGUyA9PT0gJ3VuZGVmaW5lZCcgfHwgIShlIGluc3RhbmNlb2YgRlMuRXJybm9FcnJvcikpIGFib3J0KGUpOwogICAgICAgIHJldHVybiAtZS5lcnJubwogICAgICB9CiAgICB9CiAgICB2YXIgUFJPQ0lORk8gPSB7IHBwaWQ6IDEsIHBpZDogNDIsIHNpZDogNDIsIHBnaWQ6IDQyIH07CiAgICBmdW5jdGlvbiBfX19zeXNjYWxsMjAod2hpY2gsIHZhcmFyZ3MpIHsKICAgICAgU1lTQ0FMTFMudmFyYXJncyA9IHZhcmFyZ3M7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIFBST0NJTkZPLnBpZAogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBGUyA9PT0gJ3VuZGVmaW5lZCcgfHwgIShlIGluc3RhbmNlb2YgRlMuRXJybm9FcnJvcikpIGFib3J0KGUpOwogICAgICAgIHJldHVybiAtZS5lcnJubwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfX19zeXNjYWxsNih3aGljaCwgdmFyYXJncykgewogICAgICBTWVNDQUxMUy52YXJhcmdzID0gdmFyYXJnczsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgc3RyZWFtID0gU1lTQ0FMTFMuZ2V0U3RyZWFtRnJvbUZEKCk7CiAgICAgICAgRlMuY2xvc2Uoc3RyZWFtKTsKICAgICAgICByZXR1cm4gMAogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBGUyA9PT0gJ3VuZGVmaW5lZCcgfHwgIShlIGluc3RhbmNlb2YgRlMuRXJybm9FcnJvcikpIGFib3J0KGUpOwogICAgICAgIHJldHVybiAtZS5lcnJubwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfX19zeXNjYWxsNjAod2hpY2gsIHZhcmFyZ3MpIHsKICAgICAgU1lTQ0FMTFMudmFyYXJncyA9IHZhcmFyZ3M7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG1hc2sgPSBTWVNDQUxMUy5nZXQoKTsKICAgICAgICB2YXIgb2xkID0gU1lTQ0FMTFMudW1hc2s7CiAgICAgICAgU1lTQ0FMTFMudW1hc2sgPSBtYXNrOwogICAgICAgIHJldHVybiBvbGQKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsKICAgICAgICByZXR1cm4gLWUuZXJybm8KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19fc3lzY2FsbDgzKHdoaWNoLCB2YXJhcmdzKSB7CiAgICAgIFNZU0NBTExTLnZhcmFyZ3MgPSB2YXJhcmdzOwogICAgICB0cnkgewogICAgICAgIHZhciB0YXJnZXQgPSBTWVNDQUxMUy5nZXRTdHIoKSwKICAgICAgICAgIGxpbmtwYXRoID0gU1lTQ0FMTFMuZ2V0U3RyKCk7CiAgICAgICAgRlMuc3ltbGluayh0YXJnZXQsIGxpbmtwYXRoKTsKICAgICAgICByZXR1cm4gMAogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBGUyA9PT0gJ3VuZGVmaW5lZCcgfHwgIShlIGluc3RhbmNlb2YgRlMuRXJybm9FcnJvcikpIGFib3J0KGUpOwogICAgICAgIHJldHVybiAtZS5lcnJubwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfX19zeXNjYWxsOTEod2hpY2gsIHZhcmFyZ3MpIHsKICAgICAgU1lTQ0FMTFMudmFyYXJncyA9IHZhcmFyZ3M7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIGFkZHIgPSBTWVNDQUxMUy5nZXQoKSwKICAgICAgICAgIGxlbiA9IFNZU0NBTExTLmdldCgpOwogICAgICAgIHZhciBpbmZvID0gU1lTQ0FMTFMubWFwcGluZ3NbYWRkcl07CiAgICAgICAgaWYgKCFpbmZvKSByZXR1cm4gMAogICAgICAgIGlmIChsZW4gPT09IGluZm8ubGVuKSB7CiAgICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGluZm8uZmQpOwogICAgICAgICAgU1lTQ0FMTFMuZG9Nc3luYyhhZGRyLCBzdHJlYW0sIGxlbiwgaW5mby5mbGFncyk7CiAgICAgICAgICBGUy5tdW5tYXAoc3RyZWFtKTsKICAgICAgICAgIFNZU0NBTExTLm1hcHBpbmdzW2FkZHJdID0gbnVsbDsKICAgICAgICAgIGlmIChpbmZvLmFsbG9jYXRlZCkgewogICAgICAgICAgICBfZnJlZShpbmZvLm1hbGxvYyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIEZTID09PSAndW5kZWZpbmVkJyB8fCAhKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgYWJvcnQoZSk7CiAgICAgICAgcmV0dXJuIC1lLmVycm5vCiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9fX3VubG9jaygpIHt9CiAgICB2YXIgc3RydWN0UmVnaXN0cmF0aW9ucyA9IHt9OwogICAgZnVuY3Rpb24gcnVuRGVzdHJ1Y3RvcnMoZGVzdHJ1Y3RvcnMpIHsKICAgICAgd2hpbGUgKGRlc3RydWN0b3JzLmxlbmd0aCkgewogICAgICAgIHZhciBwdHIgPSBkZXN0cnVjdG9ycy5wb3AoKTsKICAgICAgICB2YXIgZGVsID0gZGVzdHJ1Y3RvcnMucG9wKCk7CiAgICAgICAgZGVsKHB0cik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNpbXBsZVJlYWRWYWx1ZUZyb21Qb2ludGVyKHBvaW50ZXIpIHsKICAgICAgcmV0dXJuIHRoaXNbJ2Zyb21XaXJlVHlwZSddKEhFQVBVMzJbcG9pbnRlciA+PiAyXSkKICAgIH0KICAgIHZhciBhd2FpdGluZ0RlcGVuZGVuY2llcyA9IHt9OwogICAgdmFyIHJlZ2lzdGVyZWRUeXBlcyA9IHt9OwogICAgdmFyIHR5cGVEZXBlbmRlbmNpZXMgPSB7fTsKICAgIHZhciBjaGFyXzAgPSA0ODsKICAgIHZhciBjaGFyXzkgPSA1NzsKICAgIGZ1bmN0aW9uIG1ha2VMZWdhbEZ1bmN0aW9uTmFtZShuYW1lKSB7CiAgICAgIGlmICh1bmRlZmluZWQgPT09IG5hbWUpIHsKICAgICAgICByZXR1cm4gJ191bmtub3duJwogICAgICB9CiAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05X10vZywgJyQnKTsKICAgICAgdmFyIGYgPSBuYW1lLmNoYXJDb2RlQXQoMCk7CiAgICAgIGlmIChmID49IGNoYXJfMCAmJiBmIDw9IGNoYXJfOSkgewogICAgICAgIHJldHVybiAnXycgKyBuYW1lCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG5hbWUKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlTmFtZWRGdW5jdGlvbihuYW1lLCBib2R5KSB7CiAgICAgIG5hbWUgPSBtYWtlTGVnYWxGdW5jdGlvbk5hbWUobmFtZSk7CiAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24oCiAgICAgICAgJ2JvZHknLAogICAgICAgICdyZXR1cm4gZnVuY3Rpb24gJyArIG5hbWUgKyAnKCkge1xuJyArICcgICAgInVzZSBzdHJpY3QiOycgKyAnICAgIHJldHVybiBib2R5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4nICsgJ307XG4nCiAgICAgICkoYm9keSkKICAgIH0KICAgIGZ1bmN0aW9uIGV4dGVuZEVycm9yKGJhc2VFcnJvclR5cGUsIGVycm9yTmFtZSkgewogICAgICB2YXIgZXJyb3JDbGFzcyA9IGNyZWF0ZU5hbWVkRnVuY3Rpb24oZXJyb3JOYW1lLCBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgIHRoaXMubmFtZSA9IGVycm9yTmFtZTsKICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICAgIHZhciBzdGFjayA9IG5ldyBFcnJvcihtZXNzYWdlKS5zdGFjazsKICAgICAgICBpZiAoc3RhY2sgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdGFjayA9IHRoaXMudG9TdHJpbmcoKSArICdcbicgKyBzdGFjay5yZXBsYWNlKC9eRXJyb3IoOlteXG5dKik/XG4vLCAnJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgZXJyb3JDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGJhc2VFcnJvclR5cGUucHJvdG90eXBlKTsKICAgICAgZXJyb3JDbGFzcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBlcnJvckNsYXNzOwogICAgICBlcnJvckNsYXNzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5tZXNzYWdlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSArICc6ICcgKyB0aGlzLm1lc3NhZ2UKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBlcnJvckNsYXNzCiAgICB9CiAgICB2YXIgSW50ZXJuYWxFcnJvciA9IHVuZGVmaW5lZDsKICAgIGZ1bmN0aW9uIHRocm93SW50ZXJuYWxFcnJvcihtZXNzYWdlKSB7CiAgICAgIHRocm93IG5ldyBJbnRlcm5hbEVycm9yKG1lc3NhZ2UpCiAgICB9CiAgICBmdW5jdGlvbiB3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChteVR5cGVzLCBkZXBlbmRlbnRUeXBlcywgZ2V0VHlwZUNvbnZlcnRlcnMpIHsKICAgICAgbXlUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgdHlwZURlcGVuZGVuY2llc1t0eXBlXSA9IGRlcGVuZGVudFR5cGVzOwogICAgICB9KTsKICAgICAgZnVuY3Rpb24gb25Db21wbGV0ZSh0eXBlQ29udmVydGVycykgewogICAgICAgIHZhciBteVR5cGVDb252ZXJ0ZXJzID0gZ2V0VHlwZUNvbnZlcnRlcnModHlwZUNvbnZlcnRlcnMpOwogICAgICAgIGlmIChteVR5cGVDb252ZXJ0ZXJzLmxlbmd0aCAhPT0gbXlUeXBlcy5sZW5ndGgpIHsKICAgICAgICAgIHRocm93SW50ZXJuYWxFcnJvcignTWlzbWF0Y2hlZCB0eXBlIGNvbnZlcnRlciBjb3VudCcpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG15VHlwZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIHJlZ2lzdGVyVHlwZShteVR5cGVzW2ldLCBteVR5cGVDb252ZXJ0ZXJzW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIHR5cGVDb252ZXJ0ZXJzID0gbmV3IEFycmF5KGRlcGVuZGVudFR5cGVzLmxlbmd0aCk7CiAgICAgIHZhciB1bnJlZ2lzdGVyZWRUeXBlcyA9IFtdOwogICAgICB2YXIgcmVnaXN0ZXJlZCA9IDA7CiAgICAgIGRlcGVuZGVudFR5cGVzLmZvckVhY2goZnVuY3Rpb24gKGR0LCBpKSB7CiAgICAgICAgaWYgKHJlZ2lzdGVyZWRUeXBlcy5oYXNPd25Qcm9wZXJ0eShkdCkpIHsKICAgICAgICAgIHR5cGVDb252ZXJ0ZXJzW2ldID0gcmVnaXN0ZXJlZFR5cGVzW2R0XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdW5yZWdpc3RlcmVkVHlwZXMucHVzaChkdCk7CiAgICAgICAgICBpZiAoIWF3YWl0aW5nRGVwZW5kZW5jaWVzLmhhc093blByb3BlcnR5KGR0KSkgewogICAgICAgICAgICBhd2FpdGluZ0RlcGVuZGVuY2llc1tkdF0gPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGF3YWl0aW5nRGVwZW5kZW5jaWVzW2R0XS5wdXNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdHlwZUNvbnZlcnRlcnNbaV0gPSByZWdpc3RlcmVkVHlwZXNbZHRdOwogICAgICAgICAgICArK3JlZ2lzdGVyZWQ7CiAgICAgICAgICAgIGlmIChyZWdpc3RlcmVkID09PSB1bnJlZ2lzdGVyZWRUeXBlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBvbkNvbXBsZXRlKHR5cGVDb252ZXJ0ZXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgaWYgKDAgPT09IHVucmVnaXN0ZXJlZFR5cGVzLmxlbmd0aCkgewogICAgICAgIG9uQ29tcGxldGUodHlwZUNvbnZlcnRlcnMpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfX2VtYmluZF9maW5hbGl6ZV92YWx1ZV9vYmplY3Qoc3RydWN0VHlwZSkgewogICAgICB2YXIgcmVnID0gc3RydWN0UmVnaXN0cmF0aW9uc1tzdHJ1Y3RUeXBlXTsKICAgICAgZGVsZXRlIHN0cnVjdFJlZ2lzdHJhdGlvbnNbc3RydWN0VHlwZV07CiAgICAgIHZhciByYXdDb25zdHJ1Y3RvciA9IHJlZy5yYXdDb25zdHJ1Y3RvcjsKICAgICAgdmFyIHJhd0Rlc3RydWN0b3IgPSByZWcucmF3RGVzdHJ1Y3RvcjsKICAgICAgdmFyIGZpZWxkUmVjb3JkcyA9IHJlZy5maWVsZHM7CiAgICAgIHZhciBmaWVsZFR5cGVzID0gZmllbGRSZWNvcmRzCiAgICAgICAgLm1hcChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgIHJldHVybiBmaWVsZC5nZXR0ZXJSZXR1cm5UeXBlCiAgICAgICAgfSkKICAgICAgICAuY29uY2F0KAogICAgICAgICAgZmllbGRSZWNvcmRzLm1hcChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkLnNldHRlckFyZ3VtZW50VHlwZQogICAgICAgICAgfSkKICAgICAgICApOwogICAgICB3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbc3RydWN0VHlwZV0sIGZpZWxkVHlwZXMsIGZ1bmN0aW9uIChmaWVsZFR5cGVzKSB7CiAgICAgICAgdmFyIGZpZWxkcyA9IHt9OwogICAgICAgIGZpZWxkUmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCwgaSkgewogICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IGZpZWxkLmZpZWxkTmFtZTsKICAgICAgICAgIHZhciBnZXR0ZXJSZXR1cm5UeXBlID0gZmllbGRUeXBlc1tpXTsKICAgICAgICAgIHZhciBnZXR0ZXIgPSBmaWVsZC5nZXR0ZXI7CiAgICAgICAgICB2YXIgZ2V0dGVyQ29udGV4dCA9IGZpZWxkLmdldHRlckNvbnRleHQ7CiAgICAgICAgICB2YXIgc2V0dGVyQXJndW1lbnRUeXBlID0gZmllbGRUeXBlc1tpICsgZmllbGRSZWNvcmRzLmxlbmd0aF07CiAgICAgICAgICB2YXIgc2V0dGVyID0gZmllbGQuc2V0dGVyOwogICAgICAgICAgdmFyIHNldHRlckNvbnRleHQgPSBmaWVsZC5zZXR0ZXJDb250ZXh0OwogICAgICAgICAgZmllbGRzW2ZpZWxkTmFtZV0gPSB7CiAgICAgICAgICAgIHJlYWQ6IGZ1bmN0aW9uIChwdHIpIHsKICAgICAgICAgICAgICByZXR1cm4gZ2V0dGVyUmV0dXJuVHlwZVsnZnJvbVdpcmVUeXBlJ10oZ2V0dGVyKGdldHRlckNvbnRleHQsIHB0cikpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbiAocHRyLCBvKSB7CiAgICAgICAgICAgICAgdmFyIGRlc3RydWN0b3JzID0gW107CiAgICAgICAgICAgICAgc2V0dGVyKHNldHRlckNvbnRleHQsIHB0ciwgc2V0dGVyQXJndW1lbnRUeXBlWyd0b1dpcmVUeXBlJ10oZGVzdHJ1Y3RvcnMsIG8pKTsKICAgICAgICAgICAgICBydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6IHJlZy5uYW1lLAogICAgICAgICAgICBmcm9tV2lyZVR5cGU6IGZ1bmN0aW9uIChwdHIpIHsKICAgICAgICAgICAgICB2YXIgcnYgPSB7fTsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGZpZWxkcykgewogICAgICAgICAgICAgICAgcnZbaV0gPSBmaWVsZHNbaV0ucmVhZChwdHIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByYXdEZXN0cnVjdG9yKHB0cik7CiAgICAgICAgICAgICAgcmV0dXJuIHJ2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvV2lyZVR5cGU6IGZ1bmN0aW9uIChkZXN0cnVjdG9ycywgbykgewogICAgICAgICAgICAgIGZvciAodmFyIGZpZWxkTmFtZSBpbiBmaWVsZHMpIHsKICAgICAgICAgICAgICAgIGlmICghKGZpZWxkTmFtZSBpbiBvKSkgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdNaXNzaW5nIGZpZWxkJykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIHB0ciA9IHJhd0NvbnN0cnVjdG9yKCk7CiAgICAgICAgICAgICAgZm9yIChmaWVsZE5hbWUgaW4gZmllbGRzKSB7CiAgICAgICAgICAgICAgICBmaWVsZHNbZmllbGROYW1lXS53cml0ZShwdHIsIG9bZmllbGROYW1lXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChkZXN0cnVjdG9ycyAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGVzdHJ1Y3RvcnMucHVzaChyYXdEZXN0cnVjdG9yLCBwdHIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gcHRyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFyZ1BhY2tBZHZhbmNlOiA4LAogICAgICAgICAgICByZWFkVmFsdWVGcm9tUG9pbnRlcjogc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXIsCiAgICAgICAgICAgIGRlc3RydWN0b3JGdW5jdGlvbjogcmF3RGVzdHJ1Y3RvciwKICAgICAgICAgIH0sCiAgICAgICAgXQogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFNoaWZ0RnJvbVNpemUoc2l6ZSkgewogICAgICBzd2l0Y2ggKHNpemUpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gMAogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiAxCiAgICAgICAgY2FzZSA0OgogICAgICAgICAgcmV0dXJuIDIKICAgICAgICBjYXNlIDg6CiAgICAgICAgICByZXR1cm4gMwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIHR5cGUgc2l6ZTogJyArIHNpemUpCiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGVtYmluZF9pbml0X2NoYXJDb2RlcygpIHsKICAgICAgdmFyIGNvZGVzID0gbmV3IEFycmF5KDI1Nik7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgICBjb2Rlc1tpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7CiAgICAgIH0KICAgICAgZW1iaW5kX2NoYXJDb2RlcyA9IGNvZGVzOwogICAgfQogICAgdmFyIGVtYmluZF9jaGFyQ29kZXMgPSB1bmRlZmluZWQ7CiAgICBmdW5jdGlvbiByZWFkTGF0aW4xU3RyaW5nKHB0cikgewogICAgICB2YXIgcmV0ID0gJyc7CiAgICAgIHZhciBjID0gcHRyOwogICAgICB3aGlsZSAoSEVBUFU4W2NdKSB7CiAgICAgICAgcmV0ICs9IGVtYmluZF9jaGFyQ29kZXNbSEVBUFU4W2MrK11dOwogICAgICB9CiAgICAgIHJldHVybiByZXQKICAgIH0KICAgIHZhciBCaW5kaW5nRXJyb3IgPSB1bmRlZmluZWQ7CiAgICBmdW5jdGlvbiB0aHJvd0JpbmRpbmdFcnJvcihtZXNzYWdlKSB7CiAgICAgIHRocm93IG5ldyBCaW5kaW5nRXJyb3IobWVzc2FnZSkKICAgIH0KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVHlwZShyYXdUeXBlLCByZWdpc3RlcmVkSW5zdGFuY2UsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIGlmICghKCdhcmdQYWNrQWR2YW5jZScgaW4gcmVnaXN0ZXJlZEluc3RhbmNlKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3JlZ2lzdGVyVHlwZSByZWdpc3RlcmVkSW5zdGFuY2UgcmVxdWlyZXMgYXJnUGFja0FkdmFuY2UnKQogICAgICB9CiAgICAgIHZhciBuYW1lID0gcmVnaXN0ZXJlZEluc3RhbmNlLm5hbWU7CiAgICAgIGlmICghcmF3VHlwZSkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCd0eXBlICInICsgbmFtZSArICciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKTsKICAgICAgfQogICAgICBpZiAocmVnaXN0ZXJlZFR5cGVzLmhhc093blByb3BlcnR5KHJhd1R5cGUpKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuaWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9ucykgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcmVnaXN0ZXIgdHlwZSAnIiArIG5hbWUgKyAiJyB0d2ljZSIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZWdpc3RlcmVkVHlwZXNbcmF3VHlwZV0gPSByZWdpc3RlcmVkSW5zdGFuY2U7CiAgICAgIGRlbGV0ZSB0eXBlRGVwZW5kZW5jaWVzW3Jhd1R5cGVdOwogICAgICBpZiAoYXdhaXRpbmdEZXBlbmRlbmNpZXMuaGFzT3duUHJvcGVydHkocmF3VHlwZSkpIHsKICAgICAgICB2YXIgY2FsbGJhY2tzID0gYXdhaXRpbmdEZXBlbmRlbmNpZXNbcmF3VHlwZV07CiAgICAgICAgZGVsZXRlIGF3YWl0aW5nRGVwZW5kZW5jaWVzW3Jhd1R5cGVdOwogICAgICAgIGNhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChjYikgewogICAgICAgICAgY2IoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfYm9vbChyYXdUeXBlLCBuYW1lLCBzaXplLCB0cnVlVmFsdWUsIGZhbHNlVmFsdWUpIHsKICAgICAgdmFyIHNoaWZ0ID0gZ2V0U2hpZnRGcm9tU2l6ZShzaXplKTsKICAgICAgbmFtZSA9IHJlYWRMYXRpbjFTdHJpbmcobmFtZSk7CiAgICAgIHJlZ2lzdGVyVHlwZShyYXdUeXBlLCB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBmcm9tV2lyZVR5cGU6IGZ1bmN0aW9uICh3dCkgewogICAgICAgICAgcmV0dXJuICEhd3QKICAgICAgICB9LAogICAgICAgIHRvV2lyZVR5cGU6IGZ1bmN0aW9uIChkZXN0cnVjdG9ycywgbykgewogICAgICAgICAgcmV0dXJuIG8gPyB0cnVlVmFsdWUgOiBmYWxzZVZhbHVlCiAgICAgICAgfSwKICAgICAgICBhcmdQYWNrQWR2YW5jZTogOCwKICAgICAgICByZWFkVmFsdWVGcm9tUG9pbnRlcjogZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICAgIHZhciBoZWFwOwogICAgICAgICAgaWYgKHNpemUgPT09IDEpIHsKICAgICAgICAgICAgaGVhcCA9IEhFQVA4OwogICAgICAgICAgfSBlbHNlIGlmIChzaXplID09PSAyKSB7CiAgICAgICAgICAgIGhlYXAgPSBIRUFQMTY7CiAgICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT09IDQpIHsKICAgICAgICAgICAgaGVhcCA9IEhFQVAzMjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gYm9vbGVhbiB0eXBlIHNpemU6ICcgKyBuYW1lKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXNbJ2Zyb21XaXJlVHlwZSddKGhlYXBbcG9pbnRlciA+PiBzaGlmdF0pCiAgICAgICAgfSwKICAgICAgICBkZXN0cnVjdG9yRnVuY3Rpb246IG51bGwsCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gQ2xhc3NIYW5kbGVfaXNBbGlhc09mKG90aGVyKSB7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBDbGFzc0hhbmRsZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIENsYXNzSGFuZGxlKSkgewogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIHZhciBsZWZ0Q2xhc3MgPSB0aGlzLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzOwogICAgICB2YXIgbGVmdCA9IHRoaXMuJCQucHRyOwogICAgICB2YXIgcmlnaHRDbGFzcyA9IG90aGVyLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzOwogICAgICB2YXIgcmlnaHQgPSBvdGhlci4kJC5wdHI7CiAgICAgIHdoaWxlIChsZWZ0Q2xhc3MuYmFzZUNsYXNzKSB7CiAgICAgICAgbGVmdCA9IGxlZnRDbGFzcy51cGNhc3QobGVmdCk7CiAgICAgICAgbGVmdENsYXNzID0gbGVmdENsYXNzLmJhc2VDbGFzczsKICAgICAgfQogICAgICB3aGlsZSAocmlnaHRDbGFzcy5iYXNlQ2xhc3MpIHsKICAgICAgICByaWdodCA9IHJpZ2h0Q2xhc3MudXBjYXN0KHJpZ2h0KTsKICAgICAgICByaWdodENsYXNzID0gcmlnaHRDbGFzcy5iYXNlQ2xhc3M7CiAgICAgIH0KICAgICAgcmV0dXJuIGxlZnRDbGFzcyA9PT0gcmlnaHRDbGFzcyAmJiBsZWZ0ID09PSByaWdodAogICAgfQogICAgZnVuY3Rpb24gc2hhbGxvd0NvcHlJbnRlcm5hbFBvaW50ZXIobykgewogICAgICByZXR1cm4gewogICAgICAgIGNvdW50OiBvLmNvdW50LAogICAgICAgIGRlbGV0ZVNjaGVkdWxlZDogby5kZWxldGVTY2hlZHVsZWQsCiAgICAgICAgcHJlc2VydmVQb2ludGVyT25EZWxldGU6IG8ucHJlc2VydmVQb2ludGVyT25EZWxldGUsCiAgICAgICAgcHRyOiBvLnB0ciwKICAgICAgICBwdHJUeXBlOiBvLnB0clR5cGUsCiAgICAgICAgc21hcnRQdHI6IG8uc21hcnRQdHIsCiAgICAgICAgc21hcnRQdHJUeXBlOiBvLnNtYXJ0UHRyVHlwZSwKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdGhyb3dJbnN0YW5jZUFscmVhZHlEZWxldGVkKG9iaikgewogICAgICBmdW5jdGlvbiBnZXRJbnN0YW5jZVR5cGVOYW1lKGhhbmRsZSkgewogICAgICAgIHJldHVybiBoYW5kbGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZQogICAgICB9CiAgICAgIHRocm93QmluZGluZ0Vycm9yKGdldEluc3RhbmNlVHlwZU5hbWUob2JqKSArICcgaW5zdGFuY2UgYWxyZWFkeSBkZWxldGVkJyk7CiAgICB9CiAgICBmdW5jdGlvbiBDbGFzc0hhbmRsZV9jbG9uZSgpIHsKICAgICAgaWYgKCF0aGlzLiQkLnB0cikgewogICAgICAgIHRocm93SW5zdGFuY2VBbHJlYWR5RGVsZXRlZCh0aGlzKTsKICAgICAgfQogICAgICBpZiAodGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSkgewogICAgICAgIHRoaXMuJCQuY291bnQudmFsdWUgKz0gMTsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjbG9uZSA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLCB7ICQkOiB7IHZhbHVlOiBzaGFsbG93Q29weUludGVybmFsUG9pbnRlcih0aGlzLiQkKSB9IH0pOwogICAgICAgIGNsb25lLiQkLmNvdW50LnZhbHVlICs9IDE7CiAgICAgICAgY2xvbmUuJCQuZGVsZXRlU2NoZWR1bGVkID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIGNsb25lCiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkRlc3RydWN0b3IoaGFuZGxlKSB7CiAgICAgIHZhciAkJCA9IGhhbmRsZS4kJDsKICAgICAgaWYgKCQkLnNtYXJ0UHRyKSB7CiAgICAgICAgJCQuc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3IoJCQuc21hcnRQdHIpOwogICAgICB9IGVsc2UgewogICAgICAgICQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLnJhd0Rlc3RydWN0b3IoJCQucHRyKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gQ2xhc3NIYW5kbGVfZGVsZXRlKCkgewogICAgICBpZiAoIXRoaXMuJCQucHRyKSB7CiAgICAgICAgdGhyb3dJbnN0YW5jZUFscmVhZHlEZWxldGVkKHRoaXMpOwogICAgICB9CiAgICAgIGlmICh0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCAmJiAhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uJyk7CiAgICAgIH0KICAgICAgdGhpcy4kJC5jb3VudC52YWx1ZSAtPSAxOwogICAgICB2YXIgdG9EZWxldGUgPSAwID09PSB0aGlzLiQkLmNvdW50LnZhbHVlOwogICAgICBpZiAodG9EZWxldGUpIHsKICAgICAgICBydW5EZXN0cnVjdG9yKHRoaXMpOwogICAgICB9CiAgICAgIGlmICghdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSkgewogICAgICAgIHRoaXMuJCQuc21hcnRQdHIgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy4kJC5wdHIgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIENsYXNzSGFuZGxlX2lzRGVsZXRlZCgpIHsKICAgICAgcmV0dXJuICF0aGlzLiQkLnB0cgogICAgfQogICAgdmFyIGRlbGF5RnVuY3Rpb24gPSB1bmRlZmluZWQ7CiAgICB2YXIgZGVsZXRpb25RdWV1ZSA9IFtdOwogICAgZnVuY3Rpb24gZmx1c2hQZW5kaW5nRGVsZXRlcygpIHsKICAgICAgd2hpbGUgKGRlbGV0aW9uUXVldWUubGVuZ3RoKSB7CiAgICAgICAgdmFyIG9iaiA9IGRlbGV0aW9uUXVldWUucG9wKCk7CiAgICAgICAgb2JqLiQkLmRlbGV0ZVNjaGVkdWxlZCA9IGZhbHNlOwogICAgICAgIG9ialsnZGVsZXRlJ10oKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gQ2xhc3NIYW5kbGVfZGVsZXRlTGF0ZXIoKSB7CiAgICAgIGlmICghdGhpcy4kJC5wdHIpIHsKICAgICAgICB0aHJvd0luc3RhbmNlQWxyZWFkeURlbGV0ZWQodGhpcyk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkICYmICF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKSB7CiAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ09iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24nKTsKICAgICAgfQogICAgICBkZWxldGlvblF1ZXVlLnB1c2godGhpcyk7CiAgICAgIGlmIChkZWxldGlvblF1ZXVlLmxlbmd0aCA9PT0gMSAmJiBkZWxheUZ1bmN0aW9uKSB7CiAgICAgICAgZGVsYXlGdW5jdGlvbihmbHVzaFBlbmRpbmdEZWxldGVzKTsKICAgICAgfQogICAgICB0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzCiAgICB9CiAgICBmdW5jdGlvbiBpbml0X0NsYXNzSGFuZGxlKCkgewogICAgICBDbGFzc0hhbmRsZS5wcm90b3R5cGVbJ2lzQWxpYXNPZiddID0gQ2xhc3NIYW5kbGVfaXNBbGlhc09mOwogICAgICBDbGFzc0hhbmRsZS5wcm90b3R5cGVbJ2Nsb25lJ10gPSBDbGFzc0hhbmRsZV9jbG9uZTsKICAgICAgQ2xhc3NIYW5kbGUucHJvdG90eXBlWydkZWxldGUnXSA9IENsYXNzSGFuZGxlX2RlbGV0ZTsKICAgICAgQ2xhc3NIYW5kbGUucHJvdG90eXBlWydpc0RlbGV0ZWQnXSA9IENsYXNzSGFuZGxlX2lzRGVsZXRlZDsKICAgICAgQ2xhc3NIYW5kbGUucHJvdG90eXBlWydkZWxldGVMYXRlciddID0gQ2xhc3NIYW5kbGVfZGVsZXRlTGF0ZXI7CiAgICB9CiAgICBmdW5jdGlvbiBDbGFzc0hhbmRsZSgpIHt9CiAgICB2YXIgcmVnaXN0ZXJlZFBvaW50ZXJzID0ge307CiAgICBmdW5jdGlvbiBlbnN1cmVPdmVybG9hZFRhYmxlKHByb3RvLCBtZXRob2ROYW1lLCBodW1hbk5hbWUpIHsKICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZSkgewogICAgICAgIHZhciBwcmV2RnVuYyA9IHByb3RvW21ldGhvZE5hbWVdOwogICAgICAgIHByb3RvW21ldGhvZE5hbWVdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlLmhhc093blByb3BlcnR5KGFyZ3VtZW50cy5sZW5ndGgpKSB7CiAgICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKAogICAgICAgICAgICAgICJGdW5jdGlvbiAnIiArCiAgICAgICAgICAgICAgICBodW1hbk5hbWUgKwogICAgICAgICAgICAgICAgIicgY2FsbGVkIHdpdGggYW4gaW52YWxpZCBudW1iZXIgb2YgYXJndW1lbnRzICgiICsKICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGggKwogICAgICAgICAgICAgICAgJykgLSBleHBlY3RzIG9uZSBvZiAoJyArCiAgICAgICAgICAgICAgICBwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlICsKICAgICAgICAgICAgICAgICcpIScKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlW2FyZ3VtZW50cy5sZW5ndGhdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICB9OwogICAgICAgIHByb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGUgPSBbXTsKICAgICAgICBwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlW3ByZXZGdW5jLmFyZ0NvdW50XSA9IHByZXZGdW5jOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBleHBvc2VQdWJsaWNTeW1ib2wobmFtZSwgdmFsdWUsIG51bUFyZ3VtZW50cykgewogICAgICBpZiAoTW9kdWxlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgdW5kZWZpbmVkID09PSBudW1Bcmd1bWVudHMgfHwKICAgICAgICAgICh1bmRlZmluZWQgIT09IE1vZHVsZVtuYW1lXS5vdmVybG9hZFRhYmxlICYmIHVuZGVmaW5lZCAhPT0gTW9kdWxlW25hbWVdLm92ZXJsb2FkVGFibGVbbnVtQXJndW1lbnRzXSkKICAgICAgICApIHsKICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcmVnaXN0ZXIgcHVibGljIG5hbWUgJyIgKyBuYW1lICsgIicgdHdpY2UiKTsKICAgICAgICB9CiAgICAgICAgZW5zdXJlT3ZlcmxvYWRUYWJsZShNb2R1bGUsIG5hbWUsIG5hbWUpOwogICAgICAgIGlmIChNb2R1bGUuaGFzT3duUHJvcGVydHkobnVtQXJndW1lbnRzKSkgewogICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoCiAgICAgICAgICAgICdDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgb3ZlcmxvYWRzIG9mIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBudW1iZXIgb2YgYXJndW1lbnRzICgnICsgbnVtQXJndW1lbnRzICsgJykhJwogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgTW9kdWxlW25hbWVdLm92ZXJsb2FkVGFibGVbbnVtQXJndW1lbnRzXSA9IHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIE1vZHVsZVtuYW1lXSA9IHZhbHVlOwogICAgICAgIGlmICh1bmRlZmluZWQgIT09IG51bUFyZ3VtZW50cykgewogICAgICAgICAgTW9kdWxlW25hbWVdLm51bUFyZ3VtZW50cyA9IG51bUFyZ3VtZW50czsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIFJlZ2lzdGVyZWRDbGFzcygKICAgICAgbmFtZSwKICAgICAgY29uc3RydWN0b3IsCiAgICAgIGluc3RhbmNlUHJvdG90eXBlLAogICAgICByYXdEZXN0cnVjdG9yLAogICAgICBiYXNlQ2xhc3MsCiAgICAgIGdldEFjdHVhbFR5cGUsCiAgICAgIHVwY2FzdCwKICAgICAgZG93bmNhc3QKICAgICkgewogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmNvbnN0cnVjdG9yID0gY29uc3RydWN0b3I7CiAgICAgIHRoaXMuaW5zdGFuY2VQcm90b3R5cGUgPSBpbnN0YW5jZVByb3RvdHlwZTsKICAgICAgdGhpcy5yYXdEZXN0cnVjdG9yID0gcmF3RGVzdHJ1Y3RvcjsKICAgICAgdGhpcy5iYXNlQ2xhc3MgPSBiYXNlQ2xhc3M7CiAgICAgIHRoaXMuZ2V0QWN0dWFsVHlwZSA9IGdldEFjdHVhbFR5cGU7CiAgICAgIHRoaXMudXBjYXN0ID0gdXBjYXN0OwogICAgICB0aGlzLmRvd25jYXN0ID0gZG93bmNhc3Q7CiAgICAgIHRoaXMucHVyZVZpcnR1YWxGdW5jdGlvbnMgPSBbXTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwY2FzdFBvaW50ZXIocHRyLCBwdHJDbGFzcywgZGVzaXJlZENsYXNzKSB7CiAgICAgIHdoaWxlIChwdHJDbGFzcyAhPT0gZGVzaXJlZENsYXNzKSB7CiAgICAgICAgaWYgKCFwdHJDbGFzcy51cGNhc3QpIHsKICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdFeHBlY3RlZCBudWxsIG9yIGluc3RhbmNlIG9mICcgKyBkZXNpcmVkQ2xhc3MubmFtZSArICcsIGdvdCBhbiBpbnN0YW5jZSBvZiAnICsgcHRyQ2xhc3MubmFtZSk7CiAgICAgICAgfQogICAgICAgIHB0ciA9IHB0ckNsYXNzLnVwY2FzdChwdHIpOwogICAgICAgIHB0ckNsYXNzID0gcHRyQ2xhc3MuYmFzZUNsYXNzOwogICAgICB9CiAgICAgIHJldHVybiBwdHIKICAgIH0KICAgIGZ1bmN0aW9uIGNvbnN0Tm9TbWFydFB0clJhd1BvaW50ZXJUb1dpcmVUeXBlKGRlc3RydWN0b3JzLCBoYW5kbGUpIHsKICAgICAgaWYgKGhhbmRsZSA9PT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLmlzUmVmZXJlbmNlKSB7CiAgICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignbnVsbCBpcyBub3QgYSB2YWxpZCAnICsgdGhpcy5uYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDAKICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJCkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdDYW5ub3QgcGFzcyAiJyArIF9lbWJpbmRfcmVwcihoYW5kbGUpICsgJyIgYXMgYSAnICsgdGhpcy5uYW1lKTsKICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJC5wdHIpIHsKICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgJyArIHRoaXMubmFtZSk7CiAgICAgIH0KICAgICAgdmFyIGhhbmRsZUNsYXNzID0gaGFuZGxlLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzOwogICAgICB2YXIgcHRyID0gdXBjYXN0UG9pbnRlcihoYW5kbGUuJCQucHRyLCBoYW5kbGVDbGFzcywgdGhpcy5yZWdpc3RlcmVkQ2xhc3MpOwogICAgICByZXR1cm4gcHRyCiAgICB9CiAgICBmdW5jdGlvbiBnZW5lcmljUG9pbnRlclRvV2lyZVR5cGUoZGVzdHJ1Y3RvcnMsIGhhbmRsZSkgewogICAgICB2YXIgcHRyOwogICAgICBpZiAoaGFuZGxlID09PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuaXNSZWZlcmVuY2UpIHsKICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdudWxsIGlzIG5vdCBhIHZhbGlkICcgKyB0aGlzLm5hbWUpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5pc1NtYXJ0UG9pbnRlcikgewogICAgICAgICAgcHRyID0gdGhpcy5yYXdDb25zdHJ1Y3RvcigpOwogICAgICAgICAgaWYgKGRlc3RydWN0b3JzICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRlc3RydWN0b3JzLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLCBwdHIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHB0cgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJCkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdDYW5ub3QgcGFzcyAiJyArIF9lbWJpbmRfcmVwcihoYW5kbGUpICsgJyIgYXMgYSAnICsgdGhpcy5uYW1lKTsKICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJC5wdHIpIHsKICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgJyArIHRoaXMubmFtZSk7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmlzQ29uc3QgJiYgaGFuZGxlLiQkLnB0clR5cGUuaXNDb25zdCkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKAogICAgICAgICAgJ0Nhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgJyArCiAgICAgICAgICAgIChoYW5kbGUuJCQuc21hcnRQdHJUeXBlID8gaGFuZGxlLiQkLnNtYXJ0UHRyVHlwZS5uYW1lIDogaGFuZGxlLiQkLnB0clR5cGUubmFtZSkgKwogICAgICAgICAgICAnIHRvIHBhcmFtZXRlciB0eXBlICcgKwogICAgICAgICAgICB0aGlzLm5hbWUKICAgICAgICApOwogICAgICB9CiAgICAgIHZhciBoYW5kbGVDbGFzcyA9IGhhbmRsZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzczsKICAgICAgcHRyID0gdXBjYXN0UG9pbnRlcihoYW5kbGUuJCQucHRyLCBoYW5kbGVDbGFzcywgdGhpcy5yZWdpc3RlcmVkQ2xhc3MpOwogICAgICBpZiAodGhpcy5pc1NtYXJ0UG9pbnRlcikgewogICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhhbmRsZS4kJC5zbWFydFB0cikgewogICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ1Bhc3NpbmcgcmF3IHBvaW50ZXIgdG8gc21hcnQgcG9pbnRlciBpcyBpbGxlZ2FsJyk7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAodGhpcy5zaGFyaW5nUG9saWN5KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGlmIChoYW5kbGUuJCQuc21hcnRQdHJUeXBlID09PSB0aGlzKSB7CiAgICAgICAgICAgICAgcHRyID0gaGFuZGxlLiQkLnNtYXJ0UHRyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93QmluZGluZ0Vycm9yKAogICAgICAgICAgICAgICAgJ0Nhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgJyArCiAgICAgICAgICAgICAgICAgIChoYW5kbGUuJCQuc21hcnRQdHJUeXBlID8gaGFuZGxlLiQkLnNtYXJ0UHRyVHlwZS5uYW1lIDogaGFuZGxlLiQkLnB0clR5cGUubmFtZSkgKwogICAgICAgICAgICAgICAgICAnIHRvIHBhcmFtZXRlciB0eXBlICcgKwogICAgICAgICAgICAgICAgICB0aGlzLm5hbWUKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHB0ciA9IGhhbmRsZS4kJC5zbWFydFB0cjsKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgaWYgKGhhbmRsZS4kJC5zbWFydFB0clR5cGUgPT09IHRoaXMpIHsKICAgICAgICAgICAgICBwdHIgPSBoYW5kbGUuJCQuc21hcnRQdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGNsb25lZEhhbmRsZSA9IGhhbmRsZVsnY2xvbmUnXSgpOwogICAgICAgICAgICAgIHB0ciA9IHRoaXMucmF3U2hhcmUoCiAgICAgICAgICAgICAgICBwdHIsCiAgICAgICAgICAgICAgICBfX2VtdmFsX3JlZ2lzdGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgY2xvbmVkSGFuZGxlWydkZWxldGUnXSgpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGlmIChkZXN0cnVjdG9ycyAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGVzdHJ1Y3RvcnMucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3IsIHB0cik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignVW5zdXBwb3J0aW5nIHNoYXJpbmcgcG9saWN5Jyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBwdHIKICAgIH0KICAgIGZ1bmN0aW9uIG5vbkNvbnN0Tm9TbWFydFB0clJhd1BvaW50ZXJUb1dpcmVUeXBlKGRlc3RydWN0b3JzLCBoYW5kbGUpIHsKICAgICAgaWYgKGhhbmRsZSA9PT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLmlzUmVmZXJlbmNlKSB7CiAgICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignbnVsbCBpcyBub3QgYSB2YWxpZCAnICsgdGhpcy5uYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDAKICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJCkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdDYW5ub3QgcGFzcyAiJyArIF9lbWJpbmRfcmVwcihoYW5kbGUpICsgJyIgYXMgYSAnICsgdGhpcy5uYW1lKTsKICAgICAgfQogICAgICBpZiAoIWhhbmRsZS4kJC5wdHIpIHsKICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgJyArIHRoaXMubmFtZSk7CiAgICAgIH0KICAgICAgaWYgKGhhbmRsZS4kJC5wdHJUeXBlLmlzQ29uc3QpIHsKICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAnICsgaGFuZGxlLiQkLnB0clR5cGUubmFtZSArICcgdG8gcGFyYW1ldGVyIHR5cGUgJyArIHRoaXMubmFtZSk7CiAgICAgIH0KICAgICAgdmFyIGhhbmRsZUNsYXNzID0gaGFuZGxlLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzOwogICAgICB2YXIgcHRyID0gdXBjYXN0UG9pbnRlcihoYW5kbGUuJCQucHRyLCBoYW5kbGVDbGFzcywgdGhpcy5yZWdpc3RlcmVkQ2xhc3MpOwogICAgICByZXR1cm4gcHRyCiAgICB9CiAgICBmdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcl9nZXRQb2ludGVlKHB0cikgewogICAgICBpZiAodGhpcy5yYXdHZXRQb2ludGVlKSB7CiAgICAgICAgcHRyID0gdGhpcy5yYXdHZXRQb2ludGVlKHB0cik7CiAgICAgIH0KICAgICAgcmV0dXJuIHB0cgogICAgfQogICAgZnVuY3Rpb24gUmVnaXN0ZXJlZFBvaW50ZXJfZGVzdHJ1Y3RvcihwdHIpIHsKICAgICAgaWYgKHRoaXMucmF3RGVzdHJ1Y3RvcikgewogICAgICAgIHRoaXMucmF3RGVzdHJ1Y3RvcihwdHIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcl9kZWxldGVPYmplY3QoaGFuZGxlKSB7CiAgICAgIGlmIChoYW5kbGUgIT09IG51bGwpIHsKICAgICAgICBoYW5kbGVbJ2RlbGV0ZSddKCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGRvd25jYXN0UG9pbnRlcihwdHIsIHB0ckNsYXNzLCBkZXNpcmVkQ2xhc3MpIHsKICAgICAgaWYgKHB0ckNsYXNzID09PSBkZXNpcmVkQ2xhc3MpIHsKICAgICAgICByZXR1cm4gcHRyCiAgICAgIH0KICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGVzaXJlZENsYXNzLmJhc2VDbGFzcykgewogICAgICAgIHJldHVybiBudWxsCiAgICAgIH0KICAgICAgdmFyIHJ2ID0gZG93bmNhc3RQb2ludGVyKHB0ciwgcHRyQ2xhc3MsIGRlc2lyZWRDbGFzcy5iYXNlQ2xhc3MpOwogICAgICBpZiAocnYgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgICB9CiAgICAgIHJldHVybiBkZXNpcmVkQ2xhc3MuZG93bmNhc3QocnYpCiAgICB9CiAgICBmdW5jdGlvbiBnZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50KCkgewogICAgICByZXR1cm4gT2JqZWN0LmtleXMocmVnaXN0ZXJlZEluc3RhbmNlcykubGVuZ3RoCiAgICB9CiAgICBmdW5jdGlvbiBnZXRMaXZlSW5oZXJpdGVkSW5zdGFuY2VzKCkgewogICAgICB2YXIgcnYgPSBbXTsKICAgICAgZm9yICh2YXIgayBpbiByZWdpc3RlcmVkSW5zdGFuY2VzKSB7CiAgICAgICAgaWYgKHJlZ2lzdGVyZWRJbnN0YW5jZXMuaGFzT3duUHJvcGVydHkoaykpIHsKICAgICAgICAgIHJ2LnB1c2gocmVnaXN0ZXJlZEluc3RhbmNlc1trXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBydgogICAgfQogICAgZnVuY3Rpb24gc2V0RGVsYXlGdW5jdGlvbihmbikgewogICAgICBkZWxheUZ1bmN0aW9uID0gZm47CiAgICAgIGlmIChkZWxldGlvblF1ZXVlLmxlbmd0aCAmJiBkZWxheUZ1bmN0aW9uKSB7CiAgICAgICAgZGVsYXlGdW5jdGlvbihmbHVzaFBlbmRpbmdEZWxldGVzKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW5pdF9lbWJpbmQoKSB7CiAgICAgIE1vZHVsZVsnZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudCddID0gZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudDsKICAgICAgTW9kdWxlWydnZXRMaXZlSW5oZXJpdGVkSW5zdGFuY2VzJ10gPSBnZXRMaXZlSW5oZXJpdGVkSW5zdGFuY2VzOwogICAgICBNb2R1bGVbJ2ZsdXNoUGVuZGluZ0RlbGV0ZXMnXSA9IGZsdXNoUGVuZGluZ0RlbGV0ZXM7CiAgICAgIE1vZHVsZVsnc2V0RGVsYXlGdW5jdGlvbiddID0gc2V0RGVsYXlGdW5jdGlvbjsKICAgIH0KICAgIHZhciByZWdpc3RlcmVkSW5zdGFuY2VzID0ge307CiAgICBmdW5jdGlvbiBnZXRCYXNlc3RQb2ludGVyKGNsYXNzXywgcHRyKSB7CiAgICAgIGlmIChwdHIgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRocm93QmluZGluZ0Vycm9yKCdwdHIgc2hvdWxkIG5vdCBiZSB1bmRlZmluZWQnKTsKICAgICAgfQogICAgICB3aGlsZSAoY2xhc3NfLmJhc2VDbGFzcykgewogICAgICAgIHB0ciA9IGNsYXNzXy51cGNhc3QocHRyKTsKICAgICAgICBjbGFzc18gPSBjbGFzc18uYmFzZUNsYXNzOwogICAgICB9CiAgICAgIHJldHVybiBwdHIKICAgIH0KICAgIGZ1bmN0aW9uIGdldEluaGVyaXRlZEluc3RhbmNlKGNsYXNzXywgcHRyKSB7CiAgICAgIHB0ciA9IGdldEJhc2VzdFBvaW50ZXIoY2xhc3NfLCBwdHIpOwogICAgICByZXR1cm4gcmVnaXN0ZXJlZEluc3RhbmNlc1twdHJdCiAgICB9CiAgICBmdW5jdGlvbiBtYWtlQ2xhc3NIYW5kbGUocHJvdG90eXBlLCByZWNvcmQpIHsKICAgICAgaWYgKCFyZWNvcmQucHRyVHlwZSB8fCAhcmVjb3JkLnB0cikgewogICAgICAgIHRocm93SW50ZXJuYWxFcnJvcignbWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZScpOwogICAgICB9CiAgICAgIHZhciBoYXNTbWFydFB0clR5cGUgPSAhIXJlY29yZC5zbWFydFB0clR5cGU7CiAgICAgIHZhciBoYXNTbWFydFB0ciA9ICEhcmVjb3JkLnNtYXJ0UHRyOwogICAgICBpZiAoaGFzU21hcnRQdHJUeXBlICE9PSBoYXNTbWFydFB0cikgewogICAgICAgIHRocm93SW50ZXJuYWxFcnJvcignQm90aCBzbWFydFB0clR5cGUgYW5kIHNtYXJ0UHRyIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgICAgIH0KICAgICAgcmVjb3JkLmNvdW50ID0geyB2YWx1ZTogMSB9OwogICAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShwcm90b3R5cGUsIHsgJCQ6IHsgdmFsdWU6IHJlY29yZCB9IH0pCiAgICB9CiAgICBmdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcl9mcm9tV2lyZVR5cGUocHRyKSB7CiAgICAgIHZhciByYXdQb2ludGVyID0gdGhpcy5nZXRQb2ludGVlKHB0cik7CiAgICAgIGlmICghcmF3UG9pbnRlcikgewogICAgICAgIHRoaXMuZGVzdHJ1Y3RvcihwdHIpOwogICAgICAgIHJldHVybiBudWxsCiAgICAgIH0KICAgICAgdmFyIHJlZ2lzdGVyZWRJbnN0YW5jZSA9IGdldEluaGVyaXRlZEluc3RhbmNlKHRoaXMucmVnaXN0ZXJlZENsYXNzLCByYXdQb2ludGVyKTsKICAgICAgaWYgKHVuZGVmaW5lZCAhPT0gcmVnaXN0ZXJlZEluc3RhbmNlKSB7CiAgICAgICAgaWYgKDAgPT09IHJlZ2lzdGVyZWRJbnN0YW5jZS4kJC5jb3VudC52YWx1ZSkgewogICAgICAgICAgcmVnaXN0ZXJlZEluc3RhbmNlLiQkLnB0ciA9IHJhd1BvaW50ZXI7CiAgICAgICAgICByZWdpc3RlcmVkSW5zdGFuY2UuJCQuc21hcnRQdHIgPSBwdHI7CiAgICAgICAgICByZXR1cm4gcmVnaXN0ZXJlZEluc3RhbmNlWydjbG9uZSddKCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHJ2ID0gcmVnaXN0ZXJlZEluc3RhbmNlWydjbG9uZSddKCk7CiAgICAgICAgICB0aGlzLmRlc3RydWN0b3IocHRyKTsKICAgICAgICAgIHJldHVybiBydgogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBtYWtlRGVmYXVsdEhhbmRsZSgpIHsKICAgICAgICBpZiAodGhpcy5pc1NtYXJ0UG9pbnRlcikgewogICAgICAgICAgcmV0dXJuIG1ha2VDbGFzc0hhbmRsZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSwgewogICAgICAgICAgICBwdHJUeXBlOiB0aGlzLnBvaW50ZWVUeXBlLAogICAgICAgICAgICBwdHI6IHJhd1BvaW50ZXIsCiAgICAgICAgICAgIHNtYXJ0UHRyVHlwZTogdGhpcywKICAgICAgICAgICAgc21hcnRQdHI6IHB0ciwKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBtYWtlQ2xhc3NIYW5kbGUodGhpcy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsIHsgcHRyVHlwZTogdGhpcywgcHRyOiBwdHIgfSkKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGFjdHVhbFR5cGUgPSB0aGlzLnJlZ2lzdGVyZWRDbGFzcy5nZXRBY3R1YWxUeXBlKHJhd1BvaW50ZXIpOwogICAgICB2YXIgcmVnaXN0ZXJlZFBvaW50ZXJSZWNvcmQgPSByZWdpc3RlcmVkUG9pbnRlcnNbYWN0dWFsVHlwZV07CiAgICAgIGlmICghcmVnaXN0ZXJlZFBvaW50ZXJSZWNvcmQpIHsKICAgICAgICByZXR1cm4gbWFrZURlZmF1bHRIYW5kbGUuY2FsbCh0aGlzKQogICAgICB9CiAgICAgIHZhciB0b1R5cGU7CiAgICAgIGlmICh0aGlzLmlzQ29uc3QpIHsKICAgICAgICB0b1R5cGUgPSByZWdpc3RlcmVkUG9pbnRlclJlY29yZC5jb25zdFBvaW50ZXJUeXBlOwogICAgICB9IGVsc2UgewogICAgICAgIHRvVHlwZSA9IHJlZ2lzdGVyZWRQb2ludGVyUmVjb3JkLnBvaW50ZXJUeXBlOwogICAgICB9CiAgICAgIHZhciBkcCA9IGRvd25jYXN0UG9pbnRlcihyYXdQb2ludGVyLCB0aGlzLnJlZ2lzdGVyZWRDbGFzcywgdG9UeXBlLnJlZ2lzdGVyZWRDbGFzcyk7CiAgICAgIGlmIChkcCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBtYWtlRGVmYXVsdEhhbmRsZS5jYWxsKHRoaXMpCiAgICAgIH0KICAgICAgaWYgKHRoaXMuaXNTbWFydFBvaW50ZXIpIHsKICAgICAgICByZXR1cm4gbWFrZUNsYXNzSGFuZGxlKHRvVHlwZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsIHsKICAgICAgICAgIHB0clR5cGU6IHRvVHlwZSwKICAgICAgICAgIHB0cjogZHAsCiAgICAgICAgICBzbWFydFB0clR5cGU6IHRoaXMsCiAgICAgICAgICBzbWFydFB0cjogcHRyLAogICAgICAgIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG1ha2VDbGFzc0hhbmRsZSh0b1R5cGUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLCB7IHB0clR5cGU6IHRvVHlwZSwgcHRyOiBkcCB9KQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbml0X1JlZ2lzdGVyZWRQb2ludGVyKCkgewogICAgICBSZWdpc3RlcmVkUG9pbnRlci5wcm90b3R5cGUuZ2V0UG9pbnRlZSA9IFJlZ2lzdGVyZWRQb2ludGVyX2dldFBvaW50ZWU7CiAgICAgIFJlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZS5kZXN0cnVjdG9yID0gUmVnaXN0ZXJlZFBvaW50ZXJfZGVzdHJ1Y3RvcjsKICAgICAgUmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWydhcmdQYWNrQWR2YW5jZSddID0gODsKICAgICAgUmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWydyZWFkVmFsdWVGcm9tUG9pbnRlciddID0gc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXI7CiAgICAgIFJlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZVsnZGVsZXRlT2JqZWN0J10gPSBSZWdpc3RlcmVkUG9pbnRlcl9kZWxldGVPYmplY3Q7CiAgICAgIFJlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZVsnZnJvbVdpcmVUeXBlJ10gPSBSZWdpc3RlcmVkUG9pbnRlcl9mcm9tV2lyZVR5cGU7CiAgICB9CiAgICBmdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcigKICAgICAgbmFtZSwKICAgICAgcmVnaXN0ZXJlZENsYXNzLAogICAgICBpc1JlZmVyZW5jZSwKICAgICAgaXNDb25zdCwKICAgICAgaXNTbWFydFBvaW50ZXIsCiAgICAgIHBvaW50ZWVUeXBlLAogICAgICBzaGFyaW5nUG9saWN5LAogICAgICByYXdHZXRQb2ludGVlLAogICAgICByYXdDb25zdHJ1Y3RvciwKICAgICAgcmF3U2hhcmUsCiAgICAgIHJhd0Rlc3RydWN0b3IKICAgICkgewogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLnJlZ2lzdGVyZWRDbGFzcyA9IHJlZ2lzdGVyZWRDbGFzczsKICAgICAgdGhpcy5pc1JlZmVyZW5jZSA9IGlzUmVmZXJlbmNlOwogICAgICB0aGlzLmlzQ29uc3QgPSBpc0NvbnN0OwogICAgICB0aGlzLmlzU21hcnRQb2ludGVyID0gaXNTbWFydFBvaW50ZXI7CiAgICAgIHRoaXMucG9pbnRlZVR5cGUgPSBwb2ludGVlVHlwZTsKICAgICAgdGhpcy5zaGFyaW5nUG9saWN5ID0gc2hhcmluZ1BvbGljeTsKICAgICAgdGhpcy5yYXdHZXRQb2ludGVlID0gcmF3R2V0UG9pbnRlZTsKICAgICAgdGhpcy5yYXdDb25zdHJ1Y3RvciA9IHJhd0NvbnN0cnVjdG9yOwogICAgICB0aGlzLnJhd1NoYXJlID0gcmF3U2hhcmU7CiAgICAgIHRoaXMucmF3RGVzdHJ1Y3RvciA9IHJhd0Rlc3RydWN0b3I7CiAgICAgIGlmICghaXNTbWFydFBvaW50ZXIgJiYgcmVnaXN0ZXJlZENsYXNzLmJhc2VDbGFzcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGlzQ29uc3QpIHsKICAgICAgICAgIHRoaXNbJ3RvV2lyZVR5cGUnXSA9IGNvbnN0Tm9TbWFydFB0clJhd1BvaW50ZXJUb1dpcmVUeXBlOwogICAgICAgICAgdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb24gPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzWyd0b1dpcmVUeXBlJ10gPSBub25Db25zdE5vU21hcnRQdHJSYXdQb2ludGVyVG9XaXJlVHlwZTsKICAgICAgICAgIHRoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc1sndG9XaXJlVHlwZSddID0gZ2VuZXJpY1BvaW50ZXJUb1dpcmVUeXBlOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZXBsYWNlUHVibGljU3ltYm9sKG5hbWUsIHZhbHVlLCBudW1Bcmd1bWVudHMpIHsKICAgICAgaWYgKCFNb2R1bGUuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgICB0aHJvd0ludGVybmFsRXJyb3IoJ1JlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sJyk7CiAgICAgIH0KICAgICAgaWYgKHVuZGVmaW5lZCAhPT0gTW9kdWxlW25hbWVdLm92ZXJsb2FkVGFibGUgJiYgdW5kZWZpbmVkICE9PSBudW1Bcmd1bWVudHMpIHsKICAgICAgICBNb2R1bGVbbmFtZV0ub3ZlcmxvYWRUYWJsZVtudW1Bcmd1bWVudHNdID0gdmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgTW9kdWxlW25hbWVdID0gdmFsdWU7CiAgICAgICAgTW9kdWxlW25hbWVdLmFyZ0NvdW50ID0gbnVtQXJndW1lbnRzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBlbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihzaWduYXR1cmUsIHJhd0Z1bmN0aW9uKSB7CiAgICAgIHNpZ25hdHVyZSA9IHJlYWRMYXRpbjFTdHJpbmcoc2lnbmF0dXJlKTsKICAgICAgZnVuY3Rpb24gbWFrZUR5bkNhbGxlcihkeW5DYWxsKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHNpZ25hdHVyZS5sZW5ndGg7ICsraSkgewogICAgICAgICAgYXJncy5wdXNoKCdhJyArIGkpOwogICAgICAgIH0KICAgICAgICB2YXIgbmFtZSA9ICdkeW5DYWxsXycgKyBzaWduYXR1cmUgKyAnXycgKyByYXdGdW5jdGlvbjsKICAgICAgICB2YXIgYm9keSA9ICdyZXR1cm4gZnVuY3Rpb24gJyArIG5hbWUgKyAnKCcgKyBhcmdzLmpvaW4oJywgJykgKyAnKSB7XG4nOwogICAgICAgIGJvZHkgKz0gJyAgICByZXR1cm4gZHluQ2FsbChyYXdGdW5jdGlvbicgKyAoYXJncy5sZW5ndGggPyAnLCAnIDogJycpICsgYXJncy5qb2luKCcsICcpICsgJyk7XG4nOwogICAgICAgIGJvZHkgKz0gJ307XG4nOwogICAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24oJ2R5bkNhbGwnLCAncmF3RnVuY3Rpb24nLCBib2R5KShkeW5DYWxsLCByYXdGdW5jdGlvbikKICAgICAgfQogICAgICB2YXIgZnA7CiAgICAgIGlmIChNb2R1bGVbJ0ZVTkNUSU9OX1RBQkxFXycgKyBzaWduYXR1cmVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmcCA9IE1vZHVsZVsnRlVOQ1RJT05fVEFCTEVfJyArIHNpZ25hdHVyZV1bcmF3RnVuY3Rpb25dOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBGVU5DVElPTl9UQUJMRSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBmcCA9IEZVTkNUSU9OX1RBQkxFW3Jhd0Z1bmN0aW9uXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZGMgPSBNb2R1bGVbJ2FzbSddWydkeW5DYWxsXycgKyBzaWduYXR1cmVdOwogICAgICAgIGlmIChkYyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkYyA9IE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfJyArIHNpZ25hdHVyZS5yZXBsYWNlKC9mL2csICdkJyldOwogICAgICAgICAgaWYgKGRjID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ05vIGR5bkNhbGwgaW52b2tlciBmb3Igc2lnbmF0dXJlOiAnICsgc2lnbmF0dXJlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnAgPSBtYWtlRHluQ2FsbGVyKGRjKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGZwICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ3Vua25vd24gZnVuY3Rpb24gcG9pbnRlciB3aXRoIHNpZ25hdHVyZSAnICsgc2lnbmF0dXJlICsgJzogJyArIHJhd0Z1bmN0aW9uKTsKICAgICAgfQogICAgICByZXR1cm4gZnAKICAgIH0KICAgIHZhciBVbmJvdW5kVHlwZUVycm9yID0gdW5kZWZpbmVkOwogICAgZnVuY3Rpb24gZ2V0VHlwZU5hbWUodHlwZSkgewogICAgICB2YXIgcHRyID0gX19fZ2V0VHlwZU5hbWUodHlwZSk7CiAgICAgIHZhciBydiA9IHJlYWRMYXRpbjFTdHJpbmcocHRyKTsKICAgICAgX2ZyZWUocHRyKTsKICAgICAgcmV0dXJuIHJ2CiAgICB9CiAgICBmdW5jdGlvbiB0aHJvd1VuYm91bmRUeXBlRXJyb3IobWVzc2FnZSwgdHlwZXMpIHsKICAgICAgdmFyIHVuYm91bmRUeXBlcyA9IFtdOwogICAgICB2YXIgc2VlbiA9IHt9OwogICAgICBmdW5jdGlvbiB2aXNpdCh0eXBlKSB7CiAgICAgICAgaWYgKHNlZW5bdHlwZV0pIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBpZiAocmVnaXN0ZXJlZFR5cGVzW3R5cGVdKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVEZXBlbmRlbmNpZXNbdHlwZV0pIHsKICAgICAgICAgIHR5cGVEZXBlbmRlbmNpZXNbdHlwZV0uZm9yRWFjaCh2aXNpdCk7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgdW5ib3VuZFR5cGVzLnB1c2godHlwZSk7CiAgICAgICAgc2Vlblt0eXBlXSA9IHRydWU7CiAgICAgIH0KICAgICAgdHlwZXMuZm9yRWFjaCh2aXNpdCk7CiAgICAgIHRocm93IG5ldyBVbmJvdW5kVHlwZUVycm9yKG1lc3NhZ2UgKyAnOiAnICsgdW5ib3VuZFR5cGVzLm1hcChnZXRUeXBlTmFtZSkuam9pbihbJywgJ10pKQogICAgfQogICAgZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3MoCiAgICAgIHJhd1R5cGUsCiAgICAgIHJhd1BvaW50ZXJUeXBlLAogICAgICByYXdDb25zdFBvaW50ZXJUeXBlLAogICAgICBiYXNlQ2xhc3NSYXdUeXBlLAogICAgICBnZXRBY3R1YWxUeXBlU2lnbmF0dXJlLAogICAgICBnZXRBY3R1YWxUeXBlLAogICAgICB1cGNhc3RTaWduYXR1cmUsCiAgICAgIHVwY2FzdCwKICAgICAgZG93bmNhc3RTaWduYXR1cmUsCiAgICAgIGRvd25jYXN0LAogICAgICBuYW1lLAogICAgICBkZXN0cnVjdG9yU2lnbmF0dXJlLAogICAgICByYXdEZXN0cnVjdG9yCiAgICApIHsKICAgICAgbmFtZSA9IHJlYWRMYXRpbjFTdHJpbmcobmFtZSk7CiAgICAgIGdldEFjdHVhbFR5cGUgPSBlbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihnZXRBY3R1YWxUeXBlU2lnbmF0dXJlLCBnZXRBY3R1YWxUeXBlKTsKICAgICAgaWYgKHVwY2FzdCkgewogICAgICAgIHVwY2FzdCA9IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKHVwY2FzdFNpZ25hdHVyZSwgdXBjYXN0KTsKICAgICAgfQogICAgICBpZiAoZG93bmNhc3QpIHsKICAgICAgICBkb3duY2FzdCA9IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGRvd25jYXN0U2lnbmF0dXJlLCBkb3duY2FzdCk7CiAgICAgIH0KICAgICAgcmF3RGVzdHJ1Y3RvciA9IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGRlc3RydWN0b3JTaWduYXR1cmUsIHJhd0Rlc3RydWN0b3IpOwogICAgICB2YXIgbGVnYWxGdW5jdGlvbk5hbWUgPSBtYWtlTGVnYWxGdW5jdGlvbk5hbWUobmFtZSk7CiAgICAgIGV4cG9zZVB1YmxpY1N5bWJvbChsZWdhbEZ1bmN0aW9uTmFtZSwgZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93VW5ib3VuZFR5cGVFcnJvcignQ2Fubm90IGNvbnN0cnVjdCAnICsgbmFtZSArICcgZHVlIHRvIHVuYm91bmQgdHlwZXMnLCBbYmFzZUNsYXNzUmF3VHlwZV0pOwogICAgICB9KTsKICAgICAgd2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQoCiAgICAgICAgW3Jhd1R5cGUsIHJhd1BvaW50ZXJUeXBlLCByYXdDb25zdFBvaW50ZXJUeXBlXSwKICAgICAgICBiYXNlQ2xhc3NSYXdUeXBlID8gW2Jhc2VDbGFzc1Jhd1R5cGVdIDogW10sCiAgICAgICAgZnVuY3Rpb24gKGJhc2UpIHsKICAgICAgICAgIGJhc2UgPSBiYXNlWzBdOwogICAgICAgICAgdmFyIGJhc2VDbGFzczsKICAgICAgICAgIHZhciBiYXNlUHJvdG90eXBlOwogICAgICAgICAgaWYgKGJhc2VDbGFzc1Jhd1R5cGUpIHsKICAgICAgICAgICAgYmFzZUNsYXNzID0gYmFzZS5yZWdpc3RlcmVkQ2xhc3M7CiAgICAgICAgICAgIGJhc2VQcm90b3R5cGUgPSBiYXNlQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYXNlUHJvdG90eXBlID0gQ2xhc3NIYW5kbGUucHJvdG90eXBlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGNvbnN0cnVjdG9yID0gY3JlYXRlTmFtZWRGdW5jdGlvbihsZWdhbEZ1bmN0aW9uTmFtZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpICE9PSBpbnN0YW5jZVByb3RvdHlwZSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBCaW5kaW5nRXJyb3IoIlVzZSAnbmV3JyB0byBjb25zdHJ1Y3QgIiArIG5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgQmluZGluZ0Vycm9yKG5hbWUgKyAnIGhhcyBubyBhY2Nlc3NpYmxlIGNvbnN0cnVjdG9yJykKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYm9keSA9IHJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W2FyZ3VtZW50cy5sZW5ndGhdOwogICAgICAgICAgICBpZiAodW5kZWZpbmVkID09PSBib2R5KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEJpbmRpbmdFcnJvcigKICAgICAgICAgICAgICAgICdUcmllZCB0byBpbnZva2UgY3RvciBvZiAnICsKICAgICAgICAgICAgICAgICAgbmFtZSArCiAgICAgICAgICAgICAgICAgICcgd2l0aCBpbnZhbGlkIG51bWJlciBvZiBwYXJhbWV0ZXJzICgnICsKICAgICAgICAgICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCArCiAgICAgICAgICAgICAgICAgICcpIC0gZXhwZWN0ZWQgKCcgKwogICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSkudG9TdHJpbmcoKSArCiAgICAgICAgICAgICAgICAgICcpIHBhcmFtZXRlcnMgaW5zdGVhZCEnCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBib2R5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGluc3RhbmNlUHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShiYXNlUHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBjb25zdHJ1Y3RvciB9IH0pOwogICAgICAgICAgY29uc3RydWN0b3IucHJvdG90eXBlID0gaW5zdGFuY2VQcm90b3R5cGU7CiAgICAgICAgICB2YXIgcmVnaXN0ZXJlZENsYXNzID0gbmV3IFJlZ2lzdGVyZWRDbGFzcygKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgY29uc3RydWN0b3IsCiAgICAgICAgICAgIGluc3RhbmNlUHJvdG90eXBlLAogICAgICAgICAgICByYXdEZXN0cnVjdG9yLAogICAgICAgICAgICBiYXNlQ2xhc3MsCiAgICAgICAgICAgIGdldEFjdHVhbFR5cGUsCiAgICAgICAgICAgIHVwY2FzdCwKICAgICAgICAgICAgZG93bmNhc3QKICAgICAgICAgICk7CiAgICAgICAgICB2YXIgcmVmZXJlbmNlQ29udmVydGVyID0gbmV3IFJlZ2lzdGVyZWRQb2ludGVyKG5hbWUsIHJlZ2lzdGVyZWRDbGFzcywgdHJ1ZSwgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgIHZhciBwb2ludGVyQ29udmVydGVyID0gbmV3IFJlZ2lzdGVyZWRQb2ludGVyKG5hbWUgKyAnKicsIHJlZ2lzdGVyZWRDbGFzcywgZmFsc2UsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICB2YXIgY29uc3RQb2ludGVyQ29udmVydGVyID0gbmV3IFJlZ2lzdGVyZWRQb2ludGVyKG5hbWUgKyAnIGNvbnN0KicsIHJlZ2lzdGVyZWRDbGFzcywgZmFsc2UsIHRydWUsIGZhbHNlKTsKICAgICAgICAgIHJlZ2lzdGVyZWRQb2ludGVyc1tyYXdUeXBlXSA9IHsgcG9pbnRlclR5cGU6IHBvaW50ZXJDb252ZXJ0ZXIsIGNvbnN0UG9pbnRlclR5cGU6IGNvbnN0UG9pbnRlckNvbnZlcnRlciB9OwogICAgICAgICAgcmVwbGFjZVB1YmxpY1N5bWJvbChsZWdhbEZ1bmN0aW9uTmFtZSwgY29uc3RydWN0b3IpOwogICAgICAgICAgcmV0dXJuIFtyZWZlcmVuY2VDb252ZXJ0ZXIsIHBvaW50ZXJDb252ZXJ0ZXIsIGNvbnN0UG9pbnRlckNvbnZlcnRlcl0KICAgICAgICB9CiAgICAgICk7CiAgICB9CiAgICBmdW5jdGlvbiBoZWFwMzJWZWN0b3JUb0FycmF5KGNvdW50LCBmaXJzdEVsZW1lbnQpIHsKICAgICAgdmFyIGFycmF5ID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgIGFycmF5LnB1c2goSEVBUDMyWyhmaXJzdEVsZW1lbnQgPj4gMikgKyBpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGFycmF5CiAgICB9CiAgICBmdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvcigKICAgICAgcmF3Q2xhc3NUeXBlLAogICAgICBhcmdDb3VudCwKICAgICAgcmF3QXJnVHlwZXNBZGRyLAogICAgICBpbnZva2VyU2lnbmF0dXJlLAogICAgICBpbnZva2VyLAogICAgICByYXdDb25zdHJ1Y3RvcgogICAgKSB7CiAgICAgIHZhciByYXdBcmdUeXBlcyA9IGhlYXAzMlZlY3RvclRvQXJyYXkoYXJnQ291bnQsIHJhd0FyZ1R5cGVzQWRkcik7CiAgICAgIGludm9rZXIgPSBlbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihpbnZva2VyU2lnbmF0dXJlLCBpbnZva2VyKTsKICAgICAgd2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQoW10sIFtyYXdDbGFzc1R5cGVdLCBmdW5jdGlvbiAoY2xhc3NUeXBlKSB7CiAgICAgICAgY2xhc3NUeXBlID0gY2xhc3NUeXBlWzBdOwogICAgICAgIHZhciBodW1hbk5hbWUgPSAnY29uc3RydWN0b3IgJyArIGNsYXNzVHlwZS5uYW1lOwogICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSkgewogICAgICAgICAgY2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5ID0gW107CiAgICAgICAgfQogICAgICAgIGlmICh1bmRlZmluZWQgIT09IGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVthcmdDb3VudCAtIDFdKSB7CiAgICAgICAgICB0aHJvdyBuZXcgQmluZGluZ0Vycm9yKAogICAgICAgICAgICAnQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIGNvbnN0cnVjdG9ycyB3aXRoIGlkZW50aWNhbCBudW1iZXIgb2YgcGFyYW1ldGVycyAoJyArCiAgICAgICAgICAgICAgKGFyZ0NvdW50IC0gMSkgKwogICAgICAgICAgICAgICIpIGZvciBjbGFzcyAnIiArCiAgICAgICAgICAgICAgY2xhc3NUeXBlLm5hbWUgKwogICAgICAgICAgICAgICInISBPdmVybG9hZCByZXNvbHV0aW9uIGlzIGN1cnJlbnRseSBvbmx5IHBlcmZvcm1lZCB1c2luZyB0aGUgcGFyYW1ldGVyIGNvdW50LCBub3QgYWN0dWFsIHR5cGUgaW5mbyEiCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVthcmdDb3VudCAtIDFdID0gZnVuY3Rpb24gdW5ib3VuZFR5cGVIYW5kbGVyKCkgewogICAgICAgICAgdGhyb3dVbmJvdW5kVHlwZUVycm9yKCdDYW5ub3QgY29uc3RydWN0ICcgKyBjbGFzc1R5cGUubmFtZSArICcgZHVlIHRvIHVuYm91bmQgdHlwZXMnLCByYXdBcmdUeXBlcyk7CiAgICAgICAgfTsKICAgICAgICB3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSwgcmF3QXJnVHlwZXMsIGZ1bmN0aW9uIChhcmdUeXBlcykgewogICAgICAgICAgY2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W2FyZ0NvdW50IC0gMV0gPSBmdW5jdGlvbiBjb25zdHJ1Y3Rvcl9ib2R5KCkgewogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gYXJnQ291bnQgLSAxKSB7CiAgICAgICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoaHVtYW5OYW1lICsgJyBjYWxsZWQgd2l0aCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgYXJndW1lbnRzLCBleHBlY3RlZCAnICsgKGFyZ0NvdW50IC0gMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkZXN0cnVjdG9ycyA9IFtdOwogICAgICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmdDb3VudCk7CiAgICAgICAgICAgIGFyZ3NbMF0gPSByYXdDb25zdHJ1Y3RvcjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmdDb3VudDsgKytpKSB7CiAgICAgICAgICAgICAgYXJnc1tpXSA9IGFyZ1R5cGVzW2ldWyd0b1dpcmVUeXBlJ10oZGVzdHJ1Y3RvcnMsIGFyZ3VtZW50c1tpIC0gMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwdHIgPSBpbnZva2VyLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgICAgICBydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7CiAgICAgICAgICAgIHJldHVybiBhcmdUeXBlc1swXVsnZnJvbVdpcmVUeXBlJ10ocHRyKQogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBbXQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBbXQogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIG5ld18oY29uc3RydWN0b3IsIGFyZ3VtZW50TGlzdCkgewogICAgICBpZiAoIShjb25zdHJ1Y3RvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ25ld18gY2FsbGVkIHdpdGggY29uc3RydWN0b3IgdHlwZSAnICsgdHlwZW9mIGNvbnN0cnVjdG9yICsgJyB3aGljaCBpcyBub3QgYSBmdW5jdGlvbicpCiAgICAgIH0KICAgICAgdmFyIGR1bW15ID0gY3JlYXRlTmFtZWRGdW5jdGlvbihjb25zdHJ1Y3Rvci5uYW1lIHx8ICd1bmtub3duRnVuY3Rpb25OYW1lJywgZnVuY3Rpb24gKCkge30pOwogICAgICBkdW1teS5wcm90b3R5cGUgPSBjb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgIHZhciBvYmogPSBuZXcgZHVtbXkoKTsKICAgICAgdmFyIHIgPSBjb25zdHJ1Y3Rvci5hcHBseShvYmosIGFyZ3VtZW50TGlzdCk7CiAgICAgIHJldHVybiByIGluc3RhbmNlb2YgT2JqZWN0ID8gciA6IG9iagogICAgfQogICAgZnVuY3Rpb24gY3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLCBhcmdUeXBlcywgY2xhc3NUeXBlLCBjcHBJbnZva2VyRnVuYywgY3BwVGFyZ2V0RnVuYykgewogICAgICB2YXIgYXJnQ291bnQgPSBhcmdUeXBlcy5sZW5ndGg7CiAgICAgIGlmIChhcmdDb3VudCA8IDIpIHsKICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcigiYXJnVHlwZXMgYXJyYXkgc2l6ZSBtaXNtYXRjaCEgTXVzdCBhdCBsZWFzdCBnZXQgcmV0dXJuIHZhbHVlIGFuZCAndGhpcycgdHlwZXMhIik7CiAgICAgIH0KICAgICAgdmFyIGlzQ2xhc3NNZXRob2RGdW5jID0gYXJnVHlwZXNbMV0gIT09IG51bGwgJiYgY2xhc3NUeXBlICE9PSBudWxsOwogICAgICB2YXIgbmVlZHNEZXN0cnVjdG9yU3RhY2sgPSBmYWxzZTsKICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmdUeXBlcy5sZW5ndGg7ICsraSkgewogICAgICAgIGlmIChhcmdUeXBlc1tpXSAhPT0gbnVsbCAmJiBhcmdUeXBlc1tpXS5kZXN0cnVjdG9yRnVuY3Rpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmVlZHNEZXN0cnVjdG9yU3RhY2sgPSB0cnVlOwogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIHJldHVybnMgPSBhcmdUeXBlc1swXS5uYW1lICE9PSAndm9pZCc7CiAgICAgIHZhciBhcmdzTGlzdCA9ICcnOwogICAgICB2YXIgYXJnc0xpc3RXaXJlZCA9ICcnOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ0NvdW50IC0gMjsgKytpKSB7CiAgICAgICAgYXJnc0xpc3QgKz0gKGkgIT09IDAgPyAnLCAnIDogJycpICsgJ2FyZycgKyBpOwogICAgICAgIGFyZ3NMaXN0V2lyZWQgKz0gKGkgIT09IDAgPyAnLCAnIDogJycpICsgJ2FyZycgKyBpICsgJ1dpcmVkJzsKICAgICAgfQogICAgICB2YXIgaW52b2tlckZuQm9keSA9CiAgICAgICAgJ3JldHVybiBmdW5jdGlvbiAnICsKICAgICAgICBtYWtlTGVnYWxGdW5jdGlvbk5hbWUoaHVtYW5OYW1lKSArCiAgICAgICAgJygnICsKICAgICAgICBhcmdzTGlzdCArCiAgICAgICAgJykge1xuJyArCiAgICAgICAgJ2lmIChhcmd1bWVudHMubGVuZ3RoICE9PSAnICsKICAgICAgICAoYXJnQ291bnQgLSAyKSArCiAgICAgICAgJykge1xuJyArCiAgICAgICAgInRocm93QmluZGluZ0Vycm9yKCdmdW5jdGlvbiAiICsKICAgICAgICBodW1hbk5hbWUgKwogICAgICAgICIgY2FsbGVkIHdpdGggJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIGFyZ3VtZW50cywgZXhwZWN0ZWQgIiArCiAgICAgICAgKGFyZ0NvdW50IC0gMikgKwogICAgICAgICIgYXJncyEnKTtcbiIgKwogICAgICAgICd9XG4nOwogICAgICBpZiAobmVlZHNEZXN0cnVjdG9yU3RhY2spIHsKICAgICAgICBpbnZva2VyRm5Cb2R5ICs9ICd2YXIgZGVzdHJ1Y3RvcnMgPSBbXTtcbic7CiAgICAgIH0KICAgICAgdmFyIGR0b3JTdGFjayA9IG5lZWRzRGVzdHJ1Y3RvclN0YWNrID8gJ2Rlc3RydWN0b3JzJyA6ICdudWxsJzsKICAgICAgdmFyIGFyZ3MxID0gWyd0aHJvd0JpbmRpbmdFcnJvcicsICdpbnZva2VyJywgJ2ZuJywgJ3J1bkRlc3RydWN0b3JzJywgJ3JldFR5cGUnLCAnY2xhc3NQYXJhbSddOwogICAgICB2YXIgYXJnczIgPSBbdGhyb3dCaW5kaW5nRXJyb3IsIGNwcEludm9rZXJGdW5jLCBjcHBUYXJnZXRGdW5jLCBydW5EZXN0cnVjdG9ycywgYXJnVHlwZXNbMF0sIGFyZ1R5cGVzWzFdXTsKICAgICAgaWYgKGlzQ2xhc3NNZXRob2RGdW5jKSB7CiAgICAgICAgaW52b2tlckZuQm9keSArPSAndmFyIHRoaXNXaXJlZCA9IGNsYXNzUGFyYW0udG9XaXJlVHlwZSgnICsgZHRvclN0YWNrICsgJywgdGhpcyk7XG4nOwogICAgICB9CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJnQ291bnQgLSAyOyArK2kpIHsKICAgICAgICBpbnZva2VyRm5Cb2R5ICs9CiAgICAgICAgICAndmFyIGFyZycgKwogICAgICAgICAgaSArCiAgICAgICAgICAnV2lyZWQgPSBhcmdUeXBlJyArCiAgICAgICAgICBpICsKICAgICAgICAgICcudG9XaXJlVHlwZSgnICsKICAgICAgICAgIGR0b3JTdGFjayArCiAgICAgICAgICAnLCBhcmcnICsKICAgICAgICAgIGkgKwogICAgICAgICAgJyk7IC8vICcgKwogICAgICAgICAgYXJnVHlwZXNbaSArIDJdLm5hbWUgKwogICAgICAgICAgJ1xuJzsKICAgICAgICBhcmdzMS5wdXNoKCdhcmdUeXBlJyArIGkpOwogICAgICAgIGFyZ3MyLnB1c2goYXJnVHlwZXNbaSArIDJdKTsKICAgICAgfQogICAgICBpZiAoaXNDbGFzc01ldGhvZEZ1bmMpIHsKICAgICAgICBhcmdzTGlzdFdpcmVkID0gJ3RoaXNXaXJlZCcgKyAoYXJnc0xpc3RXaXJlZC5sZW5ndGggPiAwID8gJywgJyA6ICcnKSArIGFyZ3NMaXN0V2lyZWQ7CiAgICAgIH0KICAgICAgaW52b2tlckZuQm9keSArPQogICAgICAgIChyZXR1cm5zID8gJ3ZhciBydiA9ICcgOiAnJykgKyAnaW52b2tlcihmbicgKyAoYXJnc0xpc3RXaXJlZC5sZW5ndGggPiAwID8gJywgJyA6ICcnKSArIGFyZ3NMaXN0V2lyZWQgKyAnKTtcbic7CiAgICAgIGlmIChuZWVkc0Rlc3RydWN0b3JTdGFjaykgewogICAgICAgIGludm9rZXJGbkJvZHkgKz0gJ3J1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtcbic7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSA9IGlzQ2xhc3NNZXRob2RGdW5jID8gMSA6IDI7IGkgPCBhcmdUeXBlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgdmFyIHBhcmFtTmFtZSA9IGkgPT09IDEgPyAndGhpc1dpcmVkJyA6ICdhcmcnICsgKGkgLSAyKSArICdXaXJlZCc7CiAgICAgICAgICBpZiAoYXJnVHlwZXNbaV0uZGVzdHJ1Y3RvckZ1bmN0aW9uICE9PSBudWxsKSB7CiAgICAgICAgICAgIGludm9rZXJGbkJvZHkgKz0gcGFyYW1OYW1lICsgJ19kdG9yKCcgKyBwYXJhbU5hbWUgKyAnKTsgLy8gJyArIGFyZ1R5cGVzW2ldLm5hbWUgKyAnXG4nOwogICAgICAgICAgICBhcmdzMS5wdXNoKHBhcmFtTmFtZSArICdfZHRvcicpOwogICAgICAgICAgICBhcmdzMi5wdXNoKGFyZ1R5cGVzW2ldLmRlc3RydWN0b3JGdW5jdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChyZXR1cm5zKSB7CiAgICAgICAgaW52b2tlckZuQm9keSArPSAndmFyIHJldCA9IHJldFR5cGUuZnJvbVdpcmVUeXBlKHJ2KTtcbicgKyAncmV0dXJuIHJldDtcbic7CiAgICAgIH0KICAgICAgaW52b2tlckZuQm9keSArPSAnfVxuJzsKICAgICAgYXJnczEucHVzaChpbnZva2VyRm5Cb2R5KTsKICAgICAgdmFyIGludm9rZXJGdW5jdGlvbiA9IG5ld18oRnVuY3Rpb24sIGFyZ3MxKS5hcHBseShudWxsLCBhcmdzMik7CiAgICAgIHJldHVybiBpbnZva2VyRnVuY3Rpb24KICAgIH0KICAgIGZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX2Z1bmN0aW9uKAogICAgICByYXdDbGFzc1R5cGUsCiAgICAgIG1ldGhvZE5hbWUsCiAgICAgIGFyZ0NvdW50LAogICAgICByYXdBcmdUeXBlc0FkZHIsCiAgICAgIGludm9rZXJTaWduYXR1cmUsCiAgICAgIHJhd0ludm9rZXIsCiAgICAgIGNvbnRleHQsCiAgICAgIGlzUHVyZVZpcnR1YWwKICAgICkgewogICAgICB2YXIgcmF3QXJnVHlwZXMgPSBoZWFwMzJWZWN0b3JUb0FycmF5KGFyZ0NvdW50LCByYXdBcmdUeXBlc0FkZHIpOwogICAgICBtZXRob2ROYW1lID0gcmVhZExhdGluMVN0cmluZyhtZXRob2ROYW1lKTsKICAgICAgcmF3SW52b2tlciA9IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGludm9rZXJTaWduYXR1cmUsIHJhd0ludm9rZXIpOwogICAgICB3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSwgW3Jhd0NsYXNzVHlwZV0sIGZ1bmN0aW9uIChjbGFzc1R5cGUpIHsKICAgICAgICBjbGFzc1R5cGUgPSBjbGFzc1R5cGVbMF07CiAgICAgICAgdmFyIGh1bWFuTmFtZSA9IGNsYXNzVHlwZS5uYW1lICsgJy4nICsgbWV0aG9kTmFtZTsKICAgICAgICBpZiAoaXNQdXJlVmlydHVhbCkgewogICAgICAgICAgY2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5wdXJlVmlydHVhbEZ1bmN0aW9ucy5wdXNoKG1ldGhvZE5hbWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1bmJvdW5kVHlwZXNIYW5kbGVyKCkgewogICAgICAgICAgdGhyb3dVbmJvdW5kVHlwZUVycm9yKCdDYW5ub3QgY2FsbCAnICsgaHVtYW5OYW1lICsgJyBkdWUgdG8gdW5ib3VuZCB0eXBlcycsIHJhd0FyZ1R5cGVzKTsKICAgICAgICB9CiAgICAgICAgdmFyIHByb3RvID0gY2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZTsKICAgICAgICB2YXIgbWV0aG9kID0gcHJvdG9bbWV0aG9kTmFtZV07CiAgICAgICAgaWYgKAogICAgICAgICAgdW5kZWZpbmVkID09PSBtZXRob2QgfHwKICAgICAgICAgICh1bmRlZmluZWQgPT09IG1ldGhvZC5vdmVybG9hZFRhYmxlICYmIG1ldGhvZC5jbGFzc05hbWUgIT09IGNsYXNzVHlwZS5uYW1lICYmIG1ldGhvZC5hcmdDb3VudCA9PT0gYXJnQ291bnQgLSAyKQogICAgICAgICkgewogICAgICAgICAgdW5ib3VuZFR5cGVzSGFuZGxlci5hcmdDb3VudCA9IGFyZ0NvdW50IC0gMjsKICAgICAgICAgIHVuYm91bmRUeXBlc0hhbmRsZXIuY2xhc3NOYW1lID0gY2xhc3NUeXBlLm5hbWU7CiAgICAgICAgICBwcm90b1ttZXRob2ROYW1lXSA9IHVuYm91bmRUeXBlc0hhbmRsZXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVuc3VyZU92ZXJsb2FkVGFibGUocHJvdG8sIG1ldGhvZE5hbWUsIGh1bWFuTmFtZSk7CiAgICAgICAgICBwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlW2FyZ0NvdW50IC0gMl0gPSB1bmJvdW5kVHlwZXNIYW5kbGVyOwogICAgICAgIH0KICAgICAgICB3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSwgcmF3QXJnVHlwZXMsIGZ1bmN0aW9uIChhcmdUeXBlcykgewogICAgICAgICAgdmFyIG1lbWJlckZ1bmN0aW9uID0gY3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLCBhcmdUeXBlcywgY2xhc3NUeXBlLCByYXdJbnZva2VyLCBjb250ZXh0KTsKICAgICAgICAgIGlmICh1bmRlZmluZWQgPT09IHByb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGUpIHsKICAgICAgICAgICAgbWVtYmVyRnVuY3Rpb24uYXJnQ291bnQgPSBhcmdDb3VudCAtIDI7CiAgICAgICAgICAgIHByb3RvW21ldGhvZE5hbWVdID0gbWVtYmVyRnVuY3Rpb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlW2FyZ0NvdW50IC0gMl0gPSBtZW1iZXJGdW5jdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbXQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBbXQogICAgICB9KTsKICAgIH0KICAgIHZhciBlbXZhbF9mcmVlX2xpc3QgPSBbXTsKICAgIHZhciBlbXZhbF9oYW5kbGVfYXJyYXkgPSBbe30sIHsgdmFsdWU6IHVuZGVmaW5lZCB9LCB7IHZhbHVlOiBudWxsIH0sIHsgdmFsdWU6IHRydWUgfSwgeyB2YWx1ZTogZmFsc2UgfV07CiAgICBmdW5jdGlvbiBfX2VtdmFsX2RlY3JlZihoYW5kbGUpIHsKICAgICAgaWYgKGhhbmRsZSA+IDQgJiYgMCA9PT0gLS1lbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXS5yZWZjb3VudCkgewogICAgICAgIGVtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdID0gdW5kZWZpbmVkOwogICAgICAgIGVtdmFsX2ZyZWVfbGlzdC5wdXNoKGhhbmRsZSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGNvdW50X2VtdmFsX2hhbmRsZXMoKSB7CiAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgIGZvciAodmFyIGkgPSA1OyBpIDwgZW12YWxfaGFuZGxlX2FycmF5Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKGVtdmFsX2hhbmRsZV9hcnJheVtpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICArK2NvdW50OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY291bnQKICAgIH0KICAgIGZ1bmN0aW9uIGdldF9maXJzdF9lbXZhbCgpIHsKICAgICAgZm9yICh2YXIgaSA9IDU7IGkgPCBlbXZhbF9oYW5kbGVfYXJyYXkubGVuZ3RoOyArK2kpIHsKICAgICAgICBpZiAoZW12YWxfaGFuZGxlX2FycmF5W2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiBlbXZhbF9oYW5kbGVfYXJyYXlbaV0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIGZ1bmN0aW9uIGluaXRfZW12YWwoKSB7CiAgICAgIE1vZHVsZVsnY291bnRfZW12YWxfaGFuZGxlcyddID0gY291bnRfZW12YWxfaGFuZGxlczsKICAgICAgTW9kdWxlWydnZXRfZmlyc3RfZW12YWwnXSA9IGdldF9maXJzdF9lbXZhbDsKICAgIH0KICAgIGZ1bmN0aW9uIF9fZW12YWxfcmVnaXN0ZXIodmFsdWUpIHsKICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgIGNhc2UgdW5kZWZpbmVkOiB7CiAgICAgICAgICByZXR1cm4gMQogICAgICAgIH0KICAgICAgICBjYXNlIG51bGw6IHsKICAgICAgICAgIHJldHVybiAyCiAgICAgICAgfQogICAgICAgIGNhc2UgdHJ1ZTogewogICAgICAgICAgcmV0dXJuIDMKICAgICAgICB9CiAgICAgICAgY2FzZSBmYWxzZTogewogICAgICAgICAgcmV0dXJuIDQKICAgICAgICB9CiAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgdmFyIGhhbmRsZSA9IGVtdmFsX2ZyZWVfbGlzdC5sZW5ndGggPyBlbXZhbF9mcmVlX2xpc3QucG9wKCkgOiBlbXZhbF9oYW5kbGVfYXJyYXkubGVuZ3RoOwogICAgICAgICAgZW12YWxfaGFuZGxlX2FycmF5W2hhbmRsZV0gPSB7IHJlZmNvdW50OiAxLCB2YWx1ZTogdmFsdWUgfTsKICAgICAgICAgIHJldHVybiBoYW5kbGUKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2VtdmFsKHJhd1R5cGUsIG5hbWUpIHsKICAgICAgbmFtZSA9IHJlYWRMYXRpbjFTdHJpbmcobmFtZSk7CiAgICAgIHJlZ2lzdGVyVHlwZShyYXdUeXBlLCB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBmcm9tV2lyZVR5cGU6IGZ1bmN0aW9uIChoYW5kbGUpIHsKICAgICAgICAgIHZhciBydiA9IGVtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdLnZhbHVlOwogICAgICAgICAgX19lbXZhbF9kZWNyZWYoaGFuZGxlKTsKICAgICAgICAgIHJldHVybiBydgogICAgICAgIH0sCiAgICAgICAgdG9XaXJlVHlwZTogZnVuY3Rpb24gKGRlc3RydWN0b3JzLCB2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIF9fZW12YWxfcmVnaXN0ZXIodmFsdWUpCiAgICAgICAgfSwKICAgICAgICBhcmdQYWNrQWR2YW5jZTogOCwKICAgICAgICByZWFkVmFsdWVGcm9tUG9pbnRlcjogc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXIsCiAgICAgICAgZGVzdHJ1Y3RvckZ1bmN0aW9uOiBudWxsLAogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIF9lbWJpbmRfcmVwcih2KSB7CiAgICAgIGlmICh2ID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuICdudWxsJwogICAgICB9CiAgICAgIHZhciB0ID0gdHlwZW9mIHY7CiAgICAgIGlmICh0ID09PSAnb2JqZWN0JyB8fCB0ID09PSAnYXJyYXknIHx8IHQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICByZXR1cm4gdi50b1N0cmluZygpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICcnICsgdgogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmbG9hdFJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsIHNoaWZ0KSB7CiAgICAgIHN3aXRjaCAoc2hpZnQpIHsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXNbJ2Zyb21XaXJlVHlwZSddKEhFQVBGMzJbcG9pbnRlciA+PiAyXSkKICAgICAgICAgIH0KICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXNbJ2Zyb21XaXJlVHlwZSddKEhFQVBGNjRbcG9pbnRlciA+PiAzXSkKICAgICAgICAgIH0KICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBmbG9hdCB0eXBlOiAnICsgbmFtZSkKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZmxvYXQocmF3VHlwZSwgbmFtZSwgc2l6ZSkgewogICAgICB2YXIgc2hpZnQgPSBnZXRTaGlmdEZyb21TaXplKHNpemUpOwogICAgICBuYW1lID0gcmVhZExhdGluMVN0cmluZyhuYW1lKTsKICAgICAgcmVnaXN0ZXJUeXBlKHJhd1R5cGUsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGZyb21XaXJlVHlwZTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICB9LAogICAgICAgIHRvV2lyZVR5cGU6IGZ1bmN0aW9uIChkZXN0cnVjdG9ycywgdmFsdWUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0ICInICsgX2VtYmluZF9yZXByKHZhbHVlKSArICciIHRvICcgKyB0aGlzLm5hbWUpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICB9LAogICAgICAgIGFyZ1BhY2tBZHZhbmNlOiA4LAogICAgICAgIHJlYWRWYWx1ZUZyb21Qb2ludGVyOiBmbG9hdFJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsIHNoaWZ0KSwKICAgICAgICBkZXN0cnVjdG9yRnVuY3Rpb246IG51bGwsCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gaW50ZWdlclJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsIHNoaWZ0LCBzaWduZWQpIHsKICAgICAgc3dpdGNoIChzaGlmdCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiBzaWduZWQKICAgICAgICAgICAgPyBmdW5jdGlvbiByZWFkUzhGcm9tUG9pbnRlcihwb2ludGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gSEVBUDhbcG9pbnRlcl0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDogZnVuY3Rpb24gcmVhZFU4RnJvbVBvaW50ZXIocG9pbnRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIEhFQVBVOFtwb2ludGVyXQogICAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gc2lnbmVkCiAgICAgICAgICAgID8gZnVuY3Rpb24gcmVhZFMxNkZyb21Qb2ludGVyKHBvaW50ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBIRUFQMTZbcG9pbnRlciA+PiAxXQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgOiBmdW5jdGlvbiByZWFkVTE2RnJvbVBvaW50ZXIocG9pbnRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIEhFQVBVMTZbcG9pbnRlciA+PiAxXQogICAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gc2lnbmVkCiAgICAgICAgICAgID8gZnVuY3Rpb24gcmVhZFMzMkZyb21Qb2ludGVyKHBvaW50ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBIRUFQMzJbcG9pbnRlciA+PiAyXQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgOiBmdW5jdGlvbiByZWFkVTMyRnJvbVBvaW50ZXIocG9pbnRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIEhFQVBVMzJbcG9pbnRlciA+PiAyXQogICAgICAgICAgICAgIH0KICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBpbnRlZ2VyIHR5cGU6ICcgKyBuYW1lKQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9pbnRlZ2VyKHByaW1pdGl2ZVR5cGUsIG5hbWUsIHNpemUsIG1pblJhbmdlLCBtYXhSYW5nZSkgewogICAgICBuYW1lID0gcmVhZExhdGluMVN0cmluZyhuYW1lKTsKICAgICAgaWYgKG1heFJhbmdlID09PSAtMSkgewogICAgICAgIG1heFJhbmdlID0gNDI5NDk2NzI5NTsKICAgICAgfQogICAgICB2YXIgc2hpZnQgPSBnZXRTaGlmdEZyb21TaXplKHNpemUpOwogICAgICB2YXIgZnJvbVdpcmVUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgIH07CiAgICAgIGlmIChtaW5SYW5nZSA9PT0gMCkgewogICAgICAgIHZhciBiaXRzaGlmdCA9IDMyIC0gOCAqIHNpemU7CiAgICAgICAgZnJvbVdpcmVUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gKHZhbHVlIDw8IGJpdHNoaWZ0KSA+Pj4gYml0c2hpZnQKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBpc1Vuc2lnbmVkVHlwZSA9IG5hbWUuaW5kZXhPZigndW5zaWduZWQnKSAhPSAtMTsKICAgICAgcmVnaXN0ZXJUeXBlKHByaW1pdGl2ZVR5cGUsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGZyb21XaXJlVHlwZTogZnJvbVdpcmVUeXBlLAogICAgICAgIHRvV2lyZVR5cGU6IGZ1bmN0aW9uIChkZXN0cnVjdG9ycywgdmFsdWUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0ICInICsgX2VtYmluZF9yZXByKHZhbHVlKSArICciIHRvICcgKyB0aGlzLm5hbWUpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUgPCBtaW5SYW5nZSB8fCB2YWx1ZSA+IG1heFJhbmdlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCiAgICAgICAgICAgICAgJ1Bhc3NpbmcgYSBudW1iZXIgIicgKwogICAgICAgICAgICAgICAgX2VtYmluZF9yZXByKHZhbHVlKSArCiAgICAgICAgICAgICAgICAnIiBmcm9tIEpTIHNpZGUgdG8gQy9DKysgc2lkZSB0byBhbiBhcmd1bWVudCBvZiB0eXBlICInICsKICAgICAgICAgICAgICAgIG5hbWUgKwogICAgICAgICAgICAgICAgJyIsIHdoaWNoIGlzIG91dHNpZGUgdGhlIHZhbGlkIHJhbmdlIFsnICsKICAgICAgICAgICAgICAgIG1pblJhbmdlICsKICAgICAgICAgICAgICAgICcsICcgKwogICAgICAgICAgICAgICAgbWF4UmFuZ2UgKwogICAgICAgICAgICAgICAgJ10hJwogICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaXNVbnNpZ25lZFR5cGUgPyB2YWx1ZSA+Pj4gMCA6IHZhbHVlIHwgMAogICAgICAgIH0sCiAgICAgICAgYXJnUGFja0FkdmFuY2U6IDgsCiAgICAgICAgcmVhZFZhbHVlRnJvbVBvaW50ZXI6IGludGVnZXJSZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLCBzaGlmdCwgbWluUmFuZ2UgIT09IDApLAogICAgICAgIGRlc3RydWN0b3JGdW5jdGlvbjogbnVsbCwKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldyhyYXdUeXBlLCBkYXRhVHlwZUluZGV4LCBuYW1lKSB7CiAgICAgIHZhciB0eXBlTWFwcGluZyA9IFsKICAgICAgICBJbnQ4QXJyYXksCiAgICAgICAgVWludDhBcnJheSwKICAgICAgICBJbnQxNkFycmF5LAogICAgICAgIFVpbnQxNkFycmF5LAogICAgICAgIEludDMyQXJyYXksCiAgICAgICAgVWludDMyQXJyYXksCiAgICAgICAgRmxvYXQzMkFycmF5LAogICAgICAgIEZsb2F0NjRBcnJheSwKICAgICAgXTsKICAgICAgdmFyIFRBID0gdHlwZU1hcHBpbmdbZGF0YVR5cGVJbmRleF07CiAgICAgIGZ1bmN0aW9uIGRlY29kZU1lbW9yeVZpZXcoaGFuZGxlKSB7CiAgICAgICAgaGFuZGxlID0gaGFuZGxlID4+IDI7CiAgICAgICAgdmFyIGhlYXAgPSBIRUFQVTMyOwogICAgICAgIHZhciBzaXplID0gaGVhcFtoYW5kbGVdOwogICAgICAgIHZhciBkYXRhID0gaGVhcFtoYW5kbGUgKyAxXTsKICAgICAgICByZXR1cm4gbmV3IFRBKGhlYXBbJ2J1ZmZlciddLCBkYXRhLCBzaXplKQogICAgICB9CiAgICAgIG5hbWUgPSByZWFkTGF0aW4xU3RyaW5nKG5hbWUpOwogICAgICByZWdpc3RlclR5cGUoCiAgICAgICAgcmF3VHlwZSwKICAgICAgICB7IG5hbWU6IG5hbWUsIGZyb21XaXJlVHlwZTogZGVjb2RlTWVtb3J5VmlldywgYXJnUGFja0FkdmFuY2U6IDgsIHJlYWRWYWx1ZUZyb21Qb2ludGVyOiBkZWNvZGVNZW1vcnlWaWV3IH0sCiAgICAgICAgeyBpZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zOiB0cnVlIH0KICAgICAgKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX3N0ZF9zdHJpbmcocmF3VHlwZSwgbmFtZSkgewogICAgICBuYW1lID0gcmVhZExhdGluMVN0cmluZyhuYW1lKTsKICAgICAgcmVnaXN0ZXJUeXBlKHJhd1R5cGUsIHsKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGZyb21XaXJlVHlwZTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gSEVBUFUzMlt2YWx1ZSA+PiAyXTsKICAgICAgICAgIHZhciBhID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGFbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKEhFQVBVOFt2YWx1ZSArIDQgKyBpXSk7CiAgICAgICAgICB9CiAgICAgICAgICBfZnJlZSh2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gYS5qb2luKCcnKQogICAgICAgIH0sCiAgICAgICAgdG9XaXJlVHlwZTogZnVuY3Rpb24gKGRlc3RydWN0b3JzLCB2YWx1ZSkgewogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgdmFsdWUgPSBuZXcgVWludDhBcnJheSh2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRUQUVsZW1lbnQodGEsIGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0YVtpbmRleF0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldFN0cmluZ0VsZW1lbnQoc3RyaW5nLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nLmNoYXJDb2RlQXQoaW5kZXgpCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZ2V0RWxlbWVudDsKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICAgICAgZ2V0RWxlbWVudCA9IGdldFRBRWxlbWVudDsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSkgewogICAgICAgICAgICBnZXRFbGVtZW50ID0gZ2V0VEFFbGVtZW50OwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEludDhBcnJheSkgewogICAgICAgICAgICBnZXRFbGVtZW50ID0gZ2V0VEFFbGVtZW50OwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIGdldEVsZW1lbnQgPSBnZXRTdHJpbmdFbGVtZW50OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3dCaW5kaW5nRXJyb3IoJ0Nhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gc3RkOjpzdHJpbmcnKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgICB2YXIgcHRyID0gX21hbGxvYyg0ICsgbGVuZ3RoKTsKICAgICAgICAgIEhFQVBVMzJbcHRyID4+IDJdID0gbGVuZ3RoOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICB2YXIgY2hhckNvZGUgPSBnZXRFbGVtZW50KHZhbHVlLCBpKTsKICAgICAgICAgICAgaWYgKGNoYXJDb2RlID4gMjU1KSB7CiAgICAgICAgICAgICAgX2ZyZWUocHRyKTsKICAgICAgICAgICAgICB0aHJvd0JpbmRpbmdFcnJvcignU3RyaW5nIGhhcyBVVEYtMTYgY29kZSB1bml0cyB0aGF0IGRvIG5vdCBmaXQgaW4gOCBiaXRzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgSEVBUFU4W3B0ciArIDQgKyBpXSA9IGNoYXJDb2RlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRlc3RydWN0b3JzICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRlc3RydWN0b3JzLnB1c2goX2ZyZWUsIHB0cik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHRyCiAgICAgICAgfSwKICAgICAgICBhcmdQYWNrQWR2YW5jZTogOCwKICAgICAgICByZWFkVmFsdWVGcm9tUG9pbnRlcjogc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXIsCiAgICAgICAgZGVzdHJ1Y3RvckZ1bmN0aW9uOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICBfZnJlZShwdHIpOwogICAgICAgIH0sCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmcocmF3VHlwZSwgY2hhclNpemUsIG5hbWUpIHsKICAgICAgbmFtZSA9IHJlYWRMYXRpbjFTdHJpbmcobmFtZSk7CiAgICAgIHZhciBnZXRIZWFwLCBzaGlmdDsKICAgICAgaWYgKGNoYXJTaXplID09PSAyKSB7CiAgICAgICAgZ2V0SGVhcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBIRUFQVTE2CiAgICAgICAgfTsKICAgICAgICBzaGlmdCA9IDE7CiAgICAgIH0gZWxzZSBpZiAoY2hhclNpemUgPT09IDQpIHsKICAgICAgICBnZXRIZWFwID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIEhFQVBVMzIKICAgICAgICB9OwogICAgICAgIHNoaWZ0ID0gMjsKICAgICAgfQogICAgICByZWdpc3RlclR5cGUocmF3VHlwZSwgewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgZnJvbVdpcmVUeXBlOiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgIHZhciBIRUFQID0gZ2V0SGVhcCgpOwogICAgICAgICAgdmFyIGxlbmd0aCA9IEhFQVBVMzJbdmFsdWUgPj4gMl07CiAgICAgICAgICB2YXIgYSA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgICAgICAgdmFyIHN0YXJ0ID0gKHZhbHVlICsgNCkgPj4gc2hpZnQ7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGFbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKEhFQVBbc3RhcnQgKyBpXSk7CiAgICAgICAgICB9CiAgICAgICAgICBfZnJlZSh2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gYS5qb2luKCcnKQogICAgICAgIH0sCiAgICAgICAgdG9XaXJlVHlwZTogZnVuY3Rpb24gKGRlc3RydWN0b3JzLCB2YWx1ZSkgewogICAgICAgICAgdmFyIEhFQVAgPSBnZXRIZWFwKCk7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwogICAgICAgICAgdmFyIHB0ciA9IF9tYWxsb2MoNCArIGxlbmd0aCAqIGNoYXJTaXplKTsKICAgICAgICAgIEhFQVBVMzJbcHRyID4+IDJdID0gbGVuZ3RoOwogICAgICAgICAgdmFyIHN0YXJ0ID0gKHB0ciArIDQpID4+IHNoaWZ0OwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBIRUFQW3N0YXJ0ICsgaV0gPSB2YWx1ZS5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRlc3RydWN0b3JzICE9PSBudWxsKSB7CiAgICAgICAgICAgIGRlc3RydWN0b3JzLnB1c2goX2ZyZWUsIHB0cik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHRyCiAgICAgICAgfSwKICAgICAgICBhcmdQYWNrQWR2YW5jZTogOCwKICAgICAgICByZWFkVmFsdWVGcm9tUG9pbnRlcjogc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXIsCiAgICAgICAgZGVzdHJ1Y3RvckZ1bmN0aW9uOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICBfZnJlZShwdHIpOwogICAgICAgIH0sCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfdmFsdWVfb2JqZWN0KAogICAgICByYXdUeXBlLAogICAgICBuYW1lLAogICAgICBjb25zdHJ1Y3RvclNpZ25hdHVyZSwKICAgICAgcmF3Q29uc3RydWN0b3IsCiAgICAgIGRlc3RydWN0b3JTaWduYXR1cmUsCiAgICAgIHJhd0Rlc3RydWN0b3IKICAgICkgewogICAgICBzdHJ1Y3RSZWdpc3RyYXRpb25zW3Jhd1R5cGVdID0gewogICAgICAgIG5hbWU6IHJlYWRMYXRpbjFTdHJpbmcobmFtZSksCiAgICAgICAgcmF3Q29uc3RydWN0b3I6IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGNvbnN0cnVjdG9yU2lnbmF0dXJlLCByYXdDb25zdHJ1Y3RvciksCiAgICAgICAgcmF3RGVzdHJ1Y3RvcjogZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oZGVzdHJ1Y3RvclNpZ25hdHVyZSwgcmF3RGVzdHJ1Y3RvciksCiAgICAgICAgZmllbGRzOiBbXSwKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdF9maWVsZCgKICAgICAgc3RydWN0VHlwZSwKICAgICAgZmllbGROYW1lLAogICAgICBnZXR0ZXJSZXR1cm5UeXBlLAogICAgICBnZXR0ZXJTaWduYXR1cmUsCiAgICAgIGdldHRlciwKICAgICAgZ2V0dGVyQ29udGV4dCwKICAgICAgc2V0dGVyQXJndW1lbnRUeXBlLAogICAgICBzZXR0ZXJTaWduYXR1cmUsCiAgICAgIHNldHRlciwKICAgICAgc2V0dGVyQ29udGV4dAogICAgKSB7CiAgICAgIHN0cnVjdFJlZ2lzdHJhdGlvbnNbc3RydWN0VHlwZV0uZmllbGRzLnB1c2goewogICAgICAgIGZpZWxkTmFtZTogcmVhZExhdGluMVN0cmluZyhmaWVsZE5hbWUpLAogICAgICAgIGdldHRlclJldHVyblR5cGU6IGdldHRlclJldHVyblR5cGUsCiAgICAgICAgZ2V0dGVyOiBlbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihnZXR0ZXJTaWduYXR1cmUsIGdldHRlciksCiAgICAgICAgZ2V0dGVyQ29udGV4dDogZ2V0dGVyQ29udGV4dCwKICAgICAgICBzZXR0ZXJBcmd1bWVudFR5cGU6IHNldHRlckFyZ3VtZW50VHlwZSwKICAgICAgICBzZXR0ZXI6IGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKHNldHRlclNpZ25hdHVyZSwgc2V0dGVyKSwKICAgICAgICBzZXR0ZXJDb250ZXh0OiBzZXR0ZXJDb250ZXh0LAogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQocmF3VHlwZSwgbmFtZSkgewogICAgICBuYW1lID0gcmVhZExhdGluMVN0cmluZyhuYW1lKTsKICAgICAgcmVnaXN0ZXJUeXBlKHJhd1R5cGUsIHsKICAgICAgICBpc1ZvaWQ6IHRydWUsCiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBhcmdQYWNrQWR2YW5jZTogMCwKICAgICAgICBmcm9tV2lyZVR5cGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICB9LAogICAgICAgIHRvV2lyZVR5cGU6IGZ1bmN0aW9uIChkZXN0cnVjdG9ycywgbykgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgIH0sCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gX2Fib3J0KCkgewogICAgICBNb2R1bGVbJ2Fib3J0J10oKTsKICAgIH0KICAgIHZhciBfZW52aXJvbiA9IFNUQVRJQ1RPUDsKICAgIFNUQVRJQ1RPUCArPSAxNjsKICAgIGZ1bmN0aW9uIF9fX2J1aWxkRW52aXJvbm1lbnQoZW52KSB7CiAgICAgIHZhciBNQVhfRU5WX1ZBTFVFUyA9IDY0OwogICAgICB2YXIgVE9UQUxfRU5WX1NJWkUgPSAxMDI0OwogICAgICB2YXIgcG9vbFB0cjsKICAgICAgdmFyIGVudlB0cjsKICAgICAgaWYgKCFfX19idWlsZEVudmlyb25tZW50LmNhbGxlZCkgewogICAgICAgIF9fX2J1aWxkRW52aXJvbm1lbnQuY2FsbGVkID0gdHJ1ZTsKICAgICAgICBFTlZbJ1VTRVInXSA9IEVOVlsnTE9HTkFNRSddID0gJ3dlYl91c2VyJzsKICAgICAgICBFTlZbJ1BBVEgnXSA9ICcvJzsKICAgICAgICBFTlZbJ1BXRCddID0gJy8nOwogICAgICAgIEVOVlsnSE9NRSddID0gJy9ob21lL3dlYl91c2VyJzsKICAgICAgICBFTlZbJ0xBTkcnXSA9ICdDLlVURi04JzsKICAgICAgICBFTlZbJ18nXSA9IE1vZHVsZVsndGhpc1Byb2dyYW0nXTsKICAgICAgICBwb29sUHRyID0gc3RhdGljQWxsb2MoVE9UQUxfRU5WX1NJWkUpOwogICAgICAgIGVudlB0ciA9IHN0YXRpY0FsbG9jKE1BWF9FTlZfVkFMVUVTICogNCk7CiAgICAgICAgSEVBUDMyW2VudlB0ciA+PiAyXSA9IHBvb2xQdHI7CiAgICAgICAgSEVBUDMyW19lbnZpcm9uID4+IDJdID0gZW52UHRyOwogICAgICB9IGVsc2UgewogICAgICAgIGVudlB0ciA9IEhFQVAzMltfZW52aXJvbiA+PiAyXTsKICAgICAgICBwb29sUHRyID0gSEVBUDMyW2VudlB0ciA+PiAyXTsKICAgICAgfQogICAgICB2YXIgc3RyaW5ncyA9IFtdOwogICAgICB2YXIgdG90YWxTaXplID0gMDsKICAgICAgZm9yICh2YXIga2V5IGluIGVudikgewogICAgICAgIGlmICh0eXBlb2YgZW52W2tleV0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB2YXIgbGluZSA9IGtleSArICc9JyArIGVudltrZXldOwogICAgICAgICAgc3RyaW5ncy5wdXNoKGxpbmUpOwogICAgICAgICAgdG90YWxTaXplICs9IGxpbmUubGVuZ3RoOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodG90YWxTaXplID4gVE9UQUxfRU5WX1NJWkUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vudmlyb25tZW50IHNpemUgZXhjZWVkZWQgVE9UQUxfRU5WX1NJWkUhJykKICAgICAgfQogICAgICB2YXIgcHRyU2l6ZSA9IDQ7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBsaW5lID0gc3RyaW5nc1tpXTsKICAgICAgICB3cml0ZUFzY2lpVG9NZW1vcnkobGluZSwgcG9vbFB0cik7CiAgICAgICAgSEVBUDMyWyhlbnZQdHIgKyBpICogcHRyU2l6ZSkgPj4gMl0gPSBwb29sUHRyOwogICAgICAgIHBvb2xQdHIgKz0gbGluZS5sZW5ndGggKyAxOwogICAgICB9CiAgICAgIEhFQVAzMlsoZW52UHRyICsgc3RyaW5ncy5sZW5ndGggKiBwdHJTaXplKSA+PiAyXSA9IDA7CiAgICB9CiAgICB2YXIgRU5WID0ge307CiAgICBmdW5jdGlvbiBfZ2V0ZW52KG5hbWUpIHsKICAgICAgaWYgKG5hbWUgPT09IDApIHJldHVybiAwCiAgICAgIG5hbWUgPSBQb2ludGVyX3N0cmluZ2lmeShuYW1lKTsKICAgICAgaWYgKCFFTlYuaGFzT3duUHJvcGVydHkobmFtZSkpIHJldHVybiAwCiAgICAgIGlmIChfZ2V0ZW52LnJldCkgX2ZyZWUoX2dldGVudi5yZXQpOwogICAgICBfZ2V0ZW52LnJldCA9IGFsbG9jYXRlVVRGOChFTlZbbmFtZV0pOwogICAgICByZXR1cm4gX2dldGVudi5yZXQKICAgIH0KICAgIGZ1bmN0aW9uIF9nZXRncm5hbSgpIHsKICAgICAgTW9kdWxlWydwcmludEVyciddKCdtaXNzaW5nIGZ1bmN0aW9uOiBnZXRncm5hbScpOwogICAgICBhYm9ydCgtMSk7CiAgICB9CiAgICBmdW5jdGlvbiBfZ2V0cHduYW0oKSB7CiAgICAgIHRocm93ICdnZXRwd25hbTogVE9ETycKICAgIH0KICAgIGZ1bmN0aW9uIF9qc0Nsb3NlKCkgewogICAgICByZXR1cm4ganNBUEkuY2xvc2UuYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfQogICAgZnVuY3Rpb24gX2pzQ3JlYXRlKGZpbGVuYW1lKSB7CiAgICAgIHJldHVybiBqc0FQSS5jcmVhdGUuY2FsbChudWxsLCBVVEYzMlRvU3RyaW5nKGZpbGVuYW1lKSkKICAgIH0KICAgIGZ1bmN0aW9uIF9qc09wZW4oZmlsZW5hbWUpIHsKICAgICAgcmV0dXJuIGpzQVBJLm9wZW4uY2FsbChudWxsLCBVVEYzMlRvU3RyaW5nKGZpbGVuYW1lKSkKICAgIH0KICAgIGZ1bmN0aW9uIF9qc1JlYWQoKSB7CiAgICAgIHJldHVybiBqc0FQSS5yZWFkLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0KICAgIGZ1bmN0aW9uIF9qc1NlZWsoZmQsIG9mZnNldCwgbWV0aG9kKSB7CiAgICAgIHJldHVybiBqc0FQSS5zZWVrLmNhbGwobnVsbCwgZmQsIG9mZnNldCwgVVRGOFRvU3RyaW5nKG1ldGhvZCkpCiAgICB9CiAgICBmdW5jdGlvbiBfanNUZWxsKCkgewogICAgICByZXR1cm4ganNBUEkudGVsbC5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9CiAgICBmdW5jdGlvbiBfanNXcml0ZSgpIHsKICAgICAgcmV0dXJuIGpzQVBJLndyaXRlLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0KICAgIGZ1bmN0aW9uIF9sbHZtX2VoX3R5cGVpZF9mb3IodHlwZSkgewogICAgICByZXR1cm4gdHlwZQogICAgfQogICAgdmFyIF9fX3RtX2N1cnJlbnQgPSBTVEFUSUNUT1A7CiAgICBTVEFUSUNUT1AgKz0gNDg7CiAgICBhbGxvY2F0ZShpbnRBcnJheUZyb21TdHJpbmcoJ0dNVCcpLCAnaTgnLCBBTExPQ19TVEFUSUMpOwogICAgdmFyIF90em5hbWUgPSBTVEFUSUNUT1A7CiAgICBTVEFUSUNUT1AgKz0gMTY7CiAgICB2YXIgX2RheWxpZ2h0ID0gU1RBVElDVE9QOwogICAgU1RBVElDVE9QICs9IDE2OwogICAgdmFyIF90aW1lem9uZSA9IFNUQVRJQ1RPUDsKICAgIFNUQVRJQ1RPUCArPSAxNjsKICAgIGZ1bmN0aW9uIF90enNldCgpIHsKICAgICAgaWYgKF90enNldC5jYWxsZWQpIHJldHVybgogICAgICBfdHpzZXQuY2FsbGVkID0gdHJ1ZTsKICAgICAgSEVBUDMyW190aW1lem9uZSA+PiAyXSA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwOwogICAgICB2YXIgd2ludGVyID0gbmV3IERhdGUoMmUzLCAwLCAxKTsKICAgICAgdmFyIHN1bW1lciA9IG5ldyBEYXRlKDJlMywgNiwgMSk7CiAgICAgIEhFQVAzMltfZGF5bGlnaHQgPj4gMl0gPSBOdW1iZXIod2ludGVyLmdldFRpbWV6b25lT2Zmc2V0KCkgIT0gc3VtbWVyLmdldFRpbWV6b25lT2Zmc2V0KCkpOwogICAgICBmdW5jdGlvbiBleHRyYWN0Wm9uZShkYXRlKSB7CiAgICAgICAgdmFyIG1hdGNoID0gZGF0ZS50b1RpbWVTdHJpbmcoKS5tYXRjaCgvXCgoW0EtWmEteiBdKylcKSQvKTsKICAgICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICdHTVQnCiAgICAgIH0KICAgICAgdmFyIHdpbnRlck5hbWUgPSBleHRyYWN0Wm9uZSh3aW50ZXIpOwogICAgICB2YXIgc3VtbWVyTmFtZSA9IGV4dHJhY3Rab25lKHN1bW1lcik7CiAgICAgIHZhciB3aW50ZXJOYW1lUHRyID0gYWxsb2NhdGUoaW50QXJyYXlGcm9tU3RyaW5nKHdpbnRlck5hbWUpLCAnaTgnLCBBTExPQ19OT1JNQUwpOwogICAgICB2YXIgc3VtbWVyTmFtZVB0ciA9IGFsbG9jYXRlKGludEFycmF5RnJvbVN0cmluZyhzdW1tZXJOYW1lKSwgJ2k4JywgQUxMT0NfTk9STUFMKTsKICAgICAgaWYgKHN1bW1lci5nZXRUaW1lem9uZU9mZnNldCgpIDwgd2ludGVyLmdldFRpbWV6b25lT2Zmc2V0KCkpIHsKICAgICAgICBIRUFQMzJbX3R6bmFtZSA+PiAyXSA9IHdpbnRlck5hbWVQdHI7CiAgICAgICAgSEVBUDMyWyhfdHpuYW1lICsgNCkgPj4gMl0gPSBzdW1tZXJOYW1lUHRyOwogICAgICB9IGVsc2UgewogICAgICAgIEhFQVAzMltfdHpuYW1lID4+IDJdID0gc3VtbWVyTmFtZVB0cjsKICAgICAgICBIRUFQMzJbKF90em5hbWUgKyA0KSA+PiAyXSA9IHdpbnRlck5hbWVQdHI7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9sb2NhbHRpbWVfcih0aW1lLCB0bVB0cikgewogICAgICBfdHpzZXQoKTsKICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShIRUFQMzJbdGltZSA+PiAyXSAqIDFlMyk7CiAgICAgIEhFQVAzMlt0bVB0ciA+PiAyXSA9IGRhdGUuZ2V0U2Vjb25kcygpOwogICAgICBIRUFQMzJbKHRtUHRyICsgNCkgPj4gMl0gPSBkYXRlLmdldE1pbnV0ZXMoKTsKICAgICAgSEVBUDMyWyh0bVB0ciArIDgpID4+IDJdID0gZGF0ZS5nZXRIb3VycygpOwogICAgICBIRUFQMzJbKHRtUHRyICsgMTIpID4+IDJdID0gZGF0ZS5nZXREYXRlKCk7CiAgICAgIEhFQVAzMlsodG1QdHIgKyAxNikgPj4gMl0gPSBkYXRlLmdldE1vbnRoKCk7CiAgICAgIEhFQVAzMlsodG1QdHIgKyAyMCkgPj4gMl0gPSBkYXRlLmdldEZ1bGxZZWFyKCkgLSAxOTAwOwogICAgICBIRUFQMzJbKHRtUHRyICsgMjQpID4+IDJdID0gZGF0ZS5nZXREYXkoKTsKICAgICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCAxKTsKICAgICAgdmFyIHlkYXkgPSAoKGRhdGUuZ2V0VGltZSgpIC0gc3RhcnQuZ2V0VGltZSgpKSAvICgxZTMgKiA2MCAqIDYwICogMjQpKSB8IDA7CiAgICAgIEhFQVAzMlsodG1QdHIgKyAyOCkgPj4gMl0gPSB5ZGF5OwogICAgICBIRUFQMzJbKHRtUHRyICsgMzYpID4+IDJdID0gLShkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MCk7CiAgICAgIHZhciBzdW1tZXJPZmZzZXQgPSBuZXcgRGF0ZSgyZTMsIDYsIDEpLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICAgIHZhciB3aW50ZXJPZmZzZXQgPSBzdGFydC5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICB2YXIgZHN0ID0gKHN1bW1lck9mZnNldCAhPSB3aW50ZXJPZmZzZXQgJiYgZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpID09IE1hdGgubWluKHdpbnRlck9mZnNldCwgc3VtbWVyT2Zmc2V0KSkgfCAwOwogICAgICBIRUFQMzJbKHRtUHRyICsgMzIpID4+IDJdID0gZHN0OwogICAgICB2YXIgem9uZVB0ciA9IEhFQVAzMlsoX3R6bmFtZSArIChkc3QgPyA0IDogMCkpID4+IDJdOwogICAgICBIRUFQMzJbKHRtUHRyICsgNDApID4+IDJdID0gem9uZVB0cjsKICAgICAgcmV0dXJuIHRtUHRyCiAgICB9CiAgICBmdW5jdGlvbiBfbG9jYWx0aW1lKHRpbWUpIHsKICAgICAgcmV0dXJuIF9sb2NhbHRpbWVfcih0aW1lLCBfX190bV9jdXJyZW50KQogICAgfQogICAgZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZyhkZXN0LCBzcmMsIG51bSkgewogICAgICBIRUFQVTguc2V0KEhFQVBVOC5zdWJhcnJheShzcmMsIHNyYyArIG51bSksIGRlc3QpOwogICAgICByZXR1cm4gZGVzdAogICAgfQogICAgZnVuY3Rpb24gX21rdGltZSh0bVB0cikgewogICAgICBfdHpzZXQoKTsKICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgKICAgICAgICBIRUFQMzJbKHRtUHRyICsgMjApID4+IDJdICsgMTkwMCwKICAgICAgICBIRUFQMzJbKHRtUHRyICsgMTYpID4+IDJdLAogICAgICAgIEhFQVAzMlsodG1QdHIgKyAxMikgPj4gMl0sCiAgICAgICAgSEVBUDMyWyh0bVB0ciArIDgpID4+IDJdLAogICAgICAgIEhFQVAzMlsodG1QdHIgKyA0KSA+PiAyXSwKICAgICAgICBIRUFQMzJbdG1QdHIgPj4gMl0sCiAgICAgICAgMAogICAgICApOwogICAgICB2YXIgZHN0ID0gSEVBUDMyWyh0bVB0ciArIDMyKSA+PiAyXTsKICAgICAgdmFyIGd1ZXNzZWRPZmZzZXQgPSBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSk7CiAgICAgIHZhciBzdW1tZXJPZmZzZXQgPSBuZXcgRGF0ZSgyZTMsIDYsIDEpLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICAgIHZhciB3aW50ZXJPZmZzZXQgPSBzdGFydC5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICB2YXIgZHN0T2Zmc2V0ID0gTWF0aC5taW4od2ludGVyT2Zmc2V0LCBzdW1tZXJPZmZzZXQpOwogICAgICBpZiAoZHN0IDwgMCkgewogICAgICAgIEhFQVAzMlsodG1QdHIgKyAzMikgPj4gMl0gPSBOdW1iZXIoc3VtbWVyT2Zmc2V0ICE9IHdpbnRlck9mZnNldCAmJiBkc3RPZmZzZXQgPT0gZ3Vlc3NlZE9mZnNldCk7CiAgICAgIH0gZWxzZSBpZiAoZHN0ID4gMCAhPSAoZHN0T2Zmc2V0ID09IGd1ZXNzZWRPZmZzZXQpKSB7CiAgICAgICAgdmFyIG5vbkRzdE9mZnNldCA9IE1hdGgubWF4KHdpbnRlck9mZnNldCwgc3VtbWVyT2Zmc2V0KTsKICAgICAgICB2YXIgdHJ1ZU9mZnNldCA9IGRzdCA+IDAgPyBkc3RPZmZzZXQgOiBub25Ec3RPZmZzZXQ7CiAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKHRydWVPZmZzZXQgLSBndWVzc2VkT2Zmc2V0KSAqIDZlNCk7CiAgICAgIH0KICAgICAgSEVBUDMyWyh0bVB0ciArIDI0KSA+PiAyXSA9IGRhdGUuZ2V0RGF5KCk7CiAgICAgIHZhciB5ZGF5ID0gKChkYXRlLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKSkgLyAoMWUzICogNjAgKiA2MCAqIDI0KSkgfCAwOwogICAgICBIRUFQMzJbKHRtUHRyICsgMjgpID4+IDJdID0geWRheTsKICAgICAgcmV0dXJuIChkYXRlLmdldFRpbWUoKSAvIDFlMykgfCAwCiAgICB9CiAgICB2YXIgUFRIUkVBRF9TUEVDSUZJQyA9IHt9OwogICAgZnVuY3Rpb24gX3B0aHJlYWRfZ2V0c3BlY2lmaWMoa2V5KSB7CiAgICAgIHJldHVybiBQVEhSRUFEX1NQRUNJRklDW2tleV0gfHwgMAogICAgfQogICAgdmFyIFBUSFJFQURfU1BFQ0lGSUNfTkVYVF9LRVkgPSAxOwogICAgZnVuY3Rpb24gX3B0aHJlYWRfa2V5X2NyZWF0ZShrZXksIGRlc3RydWN0b3IpIHsKICAgICAgaWYgKGtleSA9PSAwKSB7CiAgICAgICAgcmV0dXJuIEVSUk5PX0NPREVTLkVJTlZBTAogICAgICB9CiAgICAgIEhFQVAzMltrZXkgPj4gMl0gPSBQVEhSRUFEX1NQRUNJRklDX05FWFRfS0VZOwogICAgICBQVEhSRUFEX1NQRUNJRklDW1BUSFJFQURfU1BFQ0lGSUNfTkVYVF9LRVldID0gMDsKICAgICAgUFRIUkVBRF9TUEVDSUZJQ19ORVhUX0tFWSsrOwogICAgICByZXR1cm4gMAogICAgfQogICAgZnVuY3Rpb24gX3B0aHJlYWRfb25jZShwdHIsIGZ1bmMpIHsKICAgICAgaWYgKCFfcHRocmVhZF9vbmNlLnNlZW4pIF9wdGhyZWFkX29uY2Uuc2VlbiA9IHt9OwogICAgICBpZiAocHRyIGluIF9wdGhyZWFkX29uY2Uuc2VlbikgcmV0dXJuCiAgICAgIE1vZHVsZVsnZHluQ2FsbF92J10oZnVuYyk7CiAgICAgIF9wdGhyZWFkX29uY2Uuc2VlbltwdHJdID0gMTsKICAgIH0KICAgIGZ1bmN0aW9uIF9wdGhyZWFkX3NldHNwZWNpZmljKGtleSwgdmFsdWUpIHsKICAgICAgaWYgKCEoa2V5IGluIFBUSFJFQURfU1BFQ0lGSUMpKSB7CiAgICAgICAgcmV0dXJuIEVSUk5PX0NPREVTLkVJTlZBTAogICAgICB9CiAgICAgIFBUSFJFQURfU1BFQ0lGSUNba2V5XSA9IHZhbHVlOwogICAgICByZXR1cm4gMAogICAgfQogICAgZnVuY3Rpb24gX3RpbWUocHRyKSB7CiAgICAgIHZhciByZXQgPSAoRGF0ZS5ub3coKSAvIDFlMykgfCAwOwogICAgICBpZiAocHRyKSB7CiAgICAgICAgSEVBUDMyW3B0ciA+PiAyXSA9IHJldDsKICAgICAgfQogICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBGUy5zdGF0aWNJbml0KCk7CiAgICBfX0FUSU5JVF9fLnVuc2hpZnQoZnVuY3Rpb24gKCkgewogICAgICBpZiAoIU1vZHVsZVsnbm9GU0luaXQnXSAmJiAhRlMuaW5pdC5pbml0aWFsaXplZCkgRlMuaW5pdCgpOwogICAgfSk7CiAgICBfX0FUTUFJTl9fLnB1c2goZnVuY3Rpb24gKCkgewogICAgICBGUy5pZ25vcmVQZXJtaXNzaW9ucyA9IGZhbHNlOwogICAgfSk7CiAgICBfX0FURVhJVF9fLnB1c2goZnVuY3Rpb24gKCkgewogICAgICBGUy5xdWl0KCk7CiAgICB9KTsKICAgIF9fQVRJTklUX18udW5zaGlmdChmdW5jdGlvbiAoKSB7CiAgICB9KTsKICAgIF9fQVRFWElUX18ucHVzaChmdW5jdGlvbiAoKSB7CiAgICB9KTsKICAgIEludGVybmFsRXJyb3IgPSBNb2R1bGVbJ0ludGVybmFsRXJyb3InXSA9IGV4dGVuZEVycm9yKEVycm9yLCAnSW50ZXJuYWxFcnJvcicpOwogICAgZW1iaW5kX2luaXRfY2hhckNvZGVzKCk7CiAgICBCaW5kaW5nRXJyb3IgPSBNb2R1bGVbJ0JpbmRpbmdFcnJvciddID0gZXh0ZW5kRXJyb3IoRXJyb3IsICdCaW5kaW5nRXJyb3InKTsKICAgIGluaXRfQ2xhc3NIYW5kbGUoKTsKICAgIGluaXRfUmVnaXN0ZXJlZFBvaW50ZXIoKTsKICAgIGluaXRfZW1iaW5kKCk7CiAgICBVbmJvdW5kVHlwZUVycm9yID0gTW9kdWxlWydVbmJvdW5kVHlwZUVycm9yJ10gPSBleHRlbmRFcnJvcihFcnJvciwgJ1VuYm91bmRUeXBlRXJyb3InKTsKICAgIGluaXRfZW12YWwoKTsKICAgIF9fX2J1aWxkRW52aXJvbm1lbnQoRU5WKTsKICAgIERZTkFNSUNUT1BfUFRSID0gc3RhdGljQWxsb2MoNCk7CiAgICBTVEFDS19CQVNFID0gU1RBQ0tUT1AgPSBhbGlnbk1lbW9yeShTVEFUSUNUT1ApOwogICAgU1RBQ0tfTUFYID0gU1RBQ0tfQkFTRSArIFRPVEFMX1NUQUNLOwogICAgRFlOQU1JQ19CQVNFID0gYWxpZ25NZW1vcnkoU1RBQ0tfTUFYKTsKICAgIEhFQVAzMltEWU5BTUlDVE9QX1BUUiA+PiAyXSA9IERZTkFNSUNfQkFTRTsKICAgIHN0YXRpY1NlYWxlZCA9IHRydWU7CiAgICBmdW5jdGlvbiBpbnRBcnJheUZyb21TdHJpbmcoc3RyaW5neSwgZG9udEFkZE51bGwsIGxlbmd0aCkgewogICAgICB2YXIgbGVuID0gbGVuZ3RoID4gMCA/IGxlbmd0aCA6IGxlbmd0aEJ5dGVzVVRGOChzdHJpbmd5KSArIDE7CiAgICAgIHZhciB1OGFycmF5ID0gbmV3IEFycmF5KGxlbik7CiAgICAgIHZhciBudW1CeXRlc1dyaXR0ZW4gPSBzdHJpbmdUb1VURjhBcnJheShzdHJpbmd5LCB1OGFycmF5LCAwLCB1OGFycmF5Lmxlbmd0aCk7CiAgICAgIGlmIChkb250QWRkTnVsbCkgdThhcnJheS5sZW5ndGggPSBudW1CeXRlc1dyaXR0ZW47CiAgICAgIHJldHVybiB1OGFycmF5CiAgICB9CiAgICBNb2R1bGVbJ3dhc21UYWJsZVNpemUnXSA9IDMxNjsKICAgIE1vZHVsZVsnd2FzbU1heFRhYmxlU2l6ZSddID0gMzE2OwogICAgZnVuY3Rpb24gaW52b2tlX2koaW5kZXgpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gTW9kdWxlWydkeW5DYWxsX2knXShpbmRleCkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfaWkoaW5kZXgsIGExKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIE1vZHVsZVsnZHluQ2FsbF9paSddKGluZGV4LCBhMSkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfaWlpKGluZGV4LCBhMSwgYTIpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gTW9kdWxlWydkeW5DYWxsX2lpaSddKGluZGV4LCBhMSwgYTIpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIGUgIT09ICdudW1iZXInICYmIGUgIT09ICdsb25nam1wJykgdGhyb3cgZQogICAgICAgIE1vZHVsZVsnc2V0VGhyZXcnXSgxLCAwKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW52b2tlX2lpaWkoaW5kZXgsIGExLCBhMiwgYTMpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gTW9kdWxlWydkeW5DYWxsX2lpaWknXShpbmRleCwgYTEsIGEyLCBhMykKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfaWlpaWkoaW5kZXgsIGExLCBhMiwgYTMsIGE0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIE1vZHVsZVsnZHluQ2FsbF9paWlpaSddKGluZGV4LCBhMSwgYTIsIGEzLCBhNCkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfaWlpaWlpaShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNikgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBNb2R1bGVbJ2R5bkNhbGxfaWlpaWlpaSddKGluZGV4LCBhMSwgYTIsIGEzLCBhNCwgYTUsIGE2KQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV9paWlpaWlpaWlpKGluZGV4LCBhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5KSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIE1vZHVsZVsnZHluQ2FsbF9paWlpaWlpaWlpJ10oaW5kZXgsIGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTkpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIGUgIT09ICdudW1iZXInICYmIGUgIT09ICdsb25nam1wJykgdGhyb3cgZQogICAgICAgIE1vZHVsZVsnc2V0VGhyZXcnXSgxLCAwKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW52b2tlX2lpaWlpaWppaShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSkgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBNb2R1bGVbJ2R5bkNhbGxfaWlpaWlpamlpJ10oaW5kZXgsIGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTkpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIGUgIT09ICdudW1iZXInICYmIGUgIT09ICdsb25nam1wJykgdGhyb3cgZQogICAgICAgIE1vZHVsZVsnc2V0VGhyZXcnXSgxLCAwKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW52b2tlX2lqaihpbmRleCwgYTEsIGEyLCBhMywgYTQpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gTW9kdWxlWydkeW5DYWxsX2lqaiddKGluZGV4LCBhMSwgYTIsIGEzLCBhNCkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfamkoaW5kZXgsIGExKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIE1vZHVsZVsnZHluQ2FsbF9qaSddKGluZGV4LCBhMSkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfdihpbmRleCkgewogICAgICB0cnkgewogICAgICAgIE1vZHVsZVsnZHluQ2FsbF92J10oaW5kZXgpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV92aShpbmRleCwgYTEpIHsKICAgICAgdHJ5IHsKICAgICAgICBNb2R1bGVbJ2R5bkNhbGxfdmknXShpbmRleCwgYTEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV92aWkoaW5kZXgsIGExLCBhMikgewogICAgICB0cnkgewogICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aWknXShpbmRleCwgYTEsIGEyKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfdmlpaShpbmRleCwgYTEsIGEyLCBhMykgewogICAgICB0cnkgewogICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aWlpJ10oaW5kZXgsIGExLCBhMiwgYTMpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV92aWlpaShpbmRleCwgYTEsIGEyLCBhMywgYTQpIHsKICAgICAgdHJ5IHsKICAgICAgICBNb2R1bGVbJ2R5bkNhbGxfdmlpaWknXShpbmRleCwgYTEsIGEyLCBhMywgYTQpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV92aWlpaWkoaW5kZXgsIGExLCBhMiwgYTMsIGE0LCBhNSkgewogICAgICB0cnkgewogICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aWlpaWknXShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfdmlpaWlpaShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNikgewogICAgICB0cnkgewogICAgICAgIE1vZHVsZVsnZHluQ2FsbF92aWlpaWlpJ10oaW5kZXgsIGExLCBhMiwgYTMsIGE0LCBhNSwgYTYpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAnbnVtYmVyJyAmJiBlICE9PSAnbG9uZ2ptcCcpIHRocm93IGUKICAgICAgICBNb2R1bGVbJ3NldFRocmV3J10oMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGludm9rZV92aWlpaWlpaWlpKGluZGV4LCBhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5KSB7CiAgICAgIHRyeSB7CiAgICAgICAgTW9kdWxlWydkeW5DYWxsX3ZpaWlpaWlpaWknXShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIGUgIT09ICdudW1iZXInICYmIGUgIT09ICdsb25nam1wJykgdGhyb3cgZQogICAgICAgIE1vZHVsZVsnc2V0VGhyZXcnXSgxLCAwKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW52b2tlX3ZpaWlpaWlpaWlpKGluZGV4LCBhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTApIHsKICAgICAgdHJ5IHsKICAgICAgICBNb2R1bGVbJ2R5bkNhbGxfdmlpaWlpaWlpaWknXShpbmRleCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfdmlqKGluZGV4LCBhMSwgYTIsIGEzKSB7CiAgICAgIHRyeSB7CiAgICAgICAgTW9kdWxlWydkeW5DYWxsX3ZpaiddKGluZGV4LCBhMSwgYTIsIGEzKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ251bWJlcicgJiYgZSAhPT0gJ2xvbmdqbXAnKSB0aHJvdyBlCiAgICAgICAgTW9kdWxlWydzZXRUaHJldyddKDEsIDApOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpbnZva2VfdmlqaShpbmRleCwgYTEsIGEyLCBhMywgYTQpIHsKICAgICAgdHJ5IHsKICAgICAgICBNb2R1bGVbJ2R5bkNhbGxfdmlqaSddKGluZGV4LCBhMSwgYTIsIGEzLCBhNCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBpZiAodHlwZW9mIGUgIT09ICdudW1iZXInICYmIGUgIT09ICdsb25nam1wJykgdGhyb3cgZQogICAgICAgIE1vZHVsZVsnc2V0VGhyZXcnXSgxLCAwKTsKICAgICAgfQogICAgfQogICAgTW9kdWxlLmFzbUdsb2JhbEFyZyA9IHt9OwogICAgTW9kdWxlLmFzbUxpYnJhcnlBcmcgPSB7CiAgICAgIGFib3J0OiBhYm9ydCwKICAgICAgZW5sYXJnZU1lbW9yeTogZW5sYXJnZU1lbW9yeSwKICAgICAgZ2V0VG90YWxNZW1vcnk6IGdldFRvdGFsTWVtb3J5LAogICAgICBhYm9ydE9uQ2Fubm90R3Jvd01lbW9yeTogYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnksCiAgICAgIGludm9rZV9pOiBpbnZva2VfaSwKICAgICAgaW52b2tlX2lpOiBpbnZva2VfaWksCiAgICAgIGludm9rZV9paWk6IGludm9rZV9paWksCiAgICAgIGludm9rZV9paWlpOiBpbnZva2VfaWlpaSwKICAgICAgaW52b2tlX2lpaWlpOiBpbnZva2VfaWlpaWksCiAgICAgIGludm9rZV9paWlpaWlpOiBpbnZva2VfaWlpaWlpaSwKICAgICAgaW52b2tlX2lpaWlpaWlpaWk6IGludm9rZV9paWlpaWlpaWlpLAogICAgICBpbnZva2VfaWlpaWlpamlpOiBpbnZva2VfaWlpaWlpamlpLAogICAgICBpbnZva2VfaWpqOiBpbnZva2VfaWpqLAogICAgICBpbnZva2Vfamk6IGludm9rZV9qaSwKICAgICAgaW52b2tlX3Y6IGludm9rZV92LAogICAgICBpbnZva2Vfdmk6IGludm9rZV92aSwKICAgICAgaW52b2tlX3ZpaTogaW52b2tlX3ZpaSwKICAgICAgaW52b2tlX3ZpaWk6IGludm9rZV92aWlpLAogICAgICBpbnZva2VfdmlpaWk6IGludm9rZV92aWlpaSwKICAgICAgaW52b2tlX3ZpaWlpaTogaW52b2tlX3ZpaWlpaSwKICAgICAgaW52b2tlX3ZpaWlpaWk6IGludm9rZV92aWlpaWlpLAogICAgICBpbnZva2VfdmlpaWlpaWlpaTogaW52b2tlX3ZpaWlpaWlpaWksCiAgICAgIGludm9rZV92aWlpaWlpaWlpaTogaW52b2tlX3ZpaWlpaWlpaWlpLAogICAgICBpbnZva2VfdmlqOiBpbnZva2VfdmlqLAogICAgICBpbnZva2VfdmlqaTogaW52b2tlX3ZpamksCiAgICAgIF9fX2N4YV9hbGxvY2F0ZV9leGNlcHRpb246IF9fX2N4YV9hbGxvY2F0ZV9leGNlcHRpb24sCiAgICAgIF9fX2N4YV9iZWdpbl9jYXRjaDogX19fY3hhX2JlZ2luX2NhdGNoLAogICAgICBfX19jeGFfZW5kX2NhdGNoOiBfX19jeGFfZW5kX2NhdGNoLAogICAgICBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8yOiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8yLAogICAgICBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zOiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zLAogICAgICBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF80OiBfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF80LAogICAgICBfX19jeGFfZnJlZV9leGNlcHRpb246IF9fX2N4YV9mcmVlX2V4Y2VwdGlvbiwKICAgICAgX19fY3hhX3Rocm93OiBfX19jeGFfdGhyb3csCiAgICAgIF9fX2xvY2s6IF9fX2xvY2ssCiAgICAgIF9fX21hcF9maWxlOiBfX19tYXBfZmlsZSwKICAgICAgX19fcmVzdW1lRXhjZXB0aW9uOiBfX19yZXN1bWVFeGNlcHRpb24sCiAgICAgIF9fX3NldEVyck5vOiBfX19zZXRFcnJObywKICAgICAgX19fc3lzY2FsbDE0MDogX19fc3lzY2FsbDE0MCwKICAgICAgX19fc3lzY2FsbDE0NTogX19fc3lzY2FsbDE0NSwKICAgICAgX19fc3lzY2FsbDE0NjogX19fc3lzY2FsbDE0NiwKICAgICAgX19fc3lzY2FsbDE4MzogX19fc3lzY2FsbDE4MywKICAgICAgX19fc3lzY2FsbDE5ODogX19fc3lzY2FsbDE5OCwKICAgICAgX19fc3lzY2FsbDIwOiBfX19zeXNjYWxsMjAsCiAgICAgIF9fX3N5c2NhbGw2OiBfX19zeXNjYWxsNiwKICAgICAgX19fc3lzY2FsbDYwOiBfX19zeXNjYWxsNjAsCiAgICAgIF9fX3N5c2NhbGw4MzogX19fc3lzY2FsbDgzLAogICAgICBfX19zeXNjYWxsOTE6IF9fX3N5c2NhbGw5MSwKICAgICAgX19fdW5sb2NrOiBfX191bmxvY2ssCiAgICAgIF9fZW1iaW5kX2ZpbmFsaXplX3ZhbHVlX29iamVjdDogX19lbWJpbmRfZmluYWxpemVfdmFsdWVfb2JqZWN0LAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl9ib29sOiBfX2VtYmluZF9yZWdpc3Rlcl9ib29sLAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzczogX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3MsCiAgICAgIF9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX2NvbnN0cnVjdG9yOiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvciwKICAgICAgX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfZnVuY3Rpb246IF9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX2Z1bmN0aW9uLAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl9lbXZhbDogX19lbWJpbmRfcmVnaXN0ZXJfZW12YWwsCiAgICAgIF9fZW1iaW5kX3JlZ2lzdGVyX2Zsb2F0OiBfX2VtYmluZF9yZWdpc3Rlcl9mbG9hdCwKICAgICAgX19lbWJpbmRfcmVnaXN0ZXJfaW50ZWdlcjogX19lbWJpbmRfcmVnaXN0ZXJfaW50ZWdlciwKICAgICAgX19lbWJpbmRfcmVnaXN0ZXJfbWVtb3J5X3ZpZXc6IF9fZW1iaW5kX3JlZ2lzdGVyX21lbW9yeV92aWV3LAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nOiBfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nLAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl9zdGRfd3N0cmluZzogX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmcsCiAgICAgIF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdDogX19lbWJpbmRfcmVnaXN0ZXJfdmFsdWVfb2JqZWN0LAogICAgICBfX2VtYmluZF9yZWdpc3Rlcl92YWx1ZV9vYmplY3RfZmllbGQ6IF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdF9maWVsZCwKICAgICAgX19lbWJpbmRfcmVnaXN0ZXJfdm9pZDogX19lbWJpbmRfcmVnaXN0ZXJfdm9pZCwKICAgICAgX2Fib3J0OiBfYWJvcnQsCiAgICAgIF9lbXNjcmlwdGVuX21lbWNweV9iaWc6IF9lbXNjcmlwdGVuX21lbWNweV9iaWcsCiAgICAgIF9nZXRlbnY6IF9nZXRlbnYsCiAgICAgIF9nZXRncm5hbTogX2dldGdybmFtLAogICAgICBfZ2V0cHduYW06IF9nZXRwd25hbSwKICAgICAgX2pzQ2xvc2U6IF9qc0Nsb3NlLAogICAgICBfanNDcmVhdGU6IF9qc0NyZWF0ZSwKICAgICAgX2pzT3BlbjogX2pzT3BlbiwKICAgICAgX2pzUmVhZDogX2pzUmVhZCwKICAgICAgX2pzU2VlazogX2pzU2VlaywKICAgICAgX2pzVGVsbDogX2pzVGVsbCwKICAgICAgX2pzV3JpdGU6IF9qc1dyaXRlLAogICAgICBfbGx2bV9laF90eXBlaWRfZm9yOiBfbGx2bV9laF90eXBlaWRfZm9yLAogICAgICBfbG9jYWx0aW1lOiBfbG9jYWx0aW1lLAogICAgICBfbWt0aW1lOiBfbWt0aW1lLAogICAgICBfcHRocmVhZF9nZXRzcGVjaWZpYzogX3B0aHJlYWRfZ2V0c3BlY2lmaWMsCiAgICAgIF9wdGhyZWFkX2tleV9jcmVhdGU6IF9wdGhyZWFkX2tleV9jcmVhdGUsCiAgICAgIF9wdGhyZWFkX29uY2U6IF9wdGhyZWFkX29uY2UsCiAgICAgIF9wdGhyZWFkX3NldHNwZWNpZmljOiBfcHRocmVhZF9zZXRzcGVjaWZpYywKICAgICAgX3RpbWU6IF90aW1lLAogICAgICBEWU5BTUlDVE9QX1BUUjogRFlOQU1JQ1RPUF9QVFIsCiAgICAgIFNUQUNLVE9QOiBTVEFDS1RPUCwKICAgIH07CiAgICB2YXIgYXNtID0gTW9kdWxlWydhc20nXShNb2R1bGUuYXNtR2xvYmFsQXJnLCBNb2R1bGUuYXNtTGlicmFyeUFyZywgYnVmZmVyKTsKICAgIE1vZHVsZVsnYXNtJ10gPSBhc207CiAgICB2YXIgX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwID0gKE1vZHVsZVsnX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydfX0dMT0JBTF9fc3ViX0lfYmluZF9jcHAnXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIHZhciBfX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcCA9IChNb2R1bGVbJ19fR0xPQkFMX19zdWJfSV9icmlkZ2VfY3BwJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydfX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcCddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgdmFyIF9fR0xPQkFMX19zdWJfSV9jcmNfY3BwID0gKE1vZHVsZVsnX19HTE9CQUxfX3N1Yl9JX2NyY19jcHAnXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ19fR0xPQkFMX19zdWJfSV9jcmNfY3BwJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICB2YXIgX19HTE9CQUxfX3N1Yl9JX2dsb2JhbF9jcHAgPSAoTW9kdWxlWydfX0dMT0JBTF9fc3ViX0lfZ2xvYmFsX2NwcCddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnX19HTE9CQUxfX3N1Yl9JX2dsb2JhbF9jcHAnXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ19fX2N4YV9jYW5fY2F0Y2gnXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ19fX2N4YV9jYW5fY2F0Y2gnXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ19fX2N4YV9pc19wb2ludGVyX3R5cGUnXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ19fX2N4YV9pc19wb2ludGVyX3R5cGUnXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ19fX2Vycm5vX2xvY2F0aW9uJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydfX19lcnJub19sb2NhdGlvbiddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgdmFyIF9fX2dldFR5cGVOYW1lID0gKE1vZHVsZVsnX19fZ2V0VHlwZU5hbWUnXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ19fX2dldFR5cGVOYW1lJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICB2YXIgX2Vtc2NyaXB0ZW5fcmVwbGFjZV9tZW1vcnkgPSAoTW9kdWxlWydfZW1zY3JpcHRlbl9yZXBsYWNlX21lbW9yeSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnX2Vtc2NyaXB0ZW5fcmVwbGFjZV9tZW1vcnknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIHZhciBfZnJlZSA9IChNb2R1bGVbJ19mcmVlJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydfZnJlZSddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgdmFyIF9tYWxsb2MgPSAoTW9kdWxlWydfbWFsbG9jJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydfbWFsbG9jJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICB2YXIgc2V0VGVtcFJldDAgPSAoTW9kdWxlWydzZXRUZW1wUmV0MCddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnc2V0VGVtcFJldDAnXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ3NldFRocmV3J10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydzZXRUaHJldyddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgdmFyIHN0YWNrQWxsb2MgPSAoTW9kdWxlWydzdGFja0FsbG9jJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydzdGFja0FsbG9jJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2RpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9kaWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9pJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lpJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX2lpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9paWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfaWlpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9paWlpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lpaWlpJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX2lpaWlpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lpaWlpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9paWlpaWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfaWlpaWlpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9paWlpaWlpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lpaWlpaWlpaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfaWlpaWlpaWlpaSddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgKE1vZHVsZVsnZHluQ2FsbF9paWlpaWlqaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfaWlpaWlpamlpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX2lqaiddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF9pamonXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfamknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfamknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfdiddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF92J10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX3ZpJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX3ZpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX3ZpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF92aWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfdmlpZCddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF92aWlkJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX3ZpaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfdmlpaSddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgKE1vZHVsZVsnZHluQ2FsbF92aWlpaSddID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTW9kdWxlWydhc20nXVsnZHluQ2FsbF92aWlpaSddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgKE1vZHVsZVsnZHluQ2FsbF92aWlpaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfdmlpaWlpJ10uYXBwbHkobnVsbCwgYXJndW1lbnRzKQogICAgfSk7CiAgICAoTW9kdWxlWydkeW5DYWxsX3ZpaWlpaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfdmlpaWlpaSddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgKE1vZHVsZVsnZHluQ2FsbF92aWlpaWlpaWlpJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX3ZpaWlpaWlpaWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfdmlpaWlpaWlpaWknXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE1vZHVsZVsnYXNtJ11bJ2R5bkNhbGxfdmlpaWlpaWlpaWknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIChNb2R1bGVbJ2R5bkNhbGxfdmlqJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX3ZpaiddLmFwcGx5KG51bGwsIGFyZ3VtZW50cykKICAgIH0pOwogICAgKE1vZHVsZVsnZHluQ2FsbF92aWppJ10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNb2R1bGVbJ2FzbSddWydkeW5DYWxsX3ZpamknXS5hcHBseShudWxsLCBhcmd1bWVudHMpCiAgICB9KTsKICAgIE1vZHVsZVsnYXNtJ10gPSBhc207CiAgICBmdW5jdGlvbiBFeGl0U3RhdHVzKHN0YXR1cykgewogICAgICB0aGlzLm5hbWUgPSAnRXhpdFN0YXR1cyc7CiAgICAgIHRoaXMubWVzc2FnZSA9ICdQcm9ncmFtIHRlcm1pbmF0ZWQgd2l0aCBleGl0KCcgKyBzdGF0dXMgKyAnKSc7CiAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgfQogICAgRXhpdFN0YXR1cy5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICAgIEV4aXRTdGF0dXMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRXhpdFN0YXR1czsKICAgIHZhciBpbml0aWFsU3RhY2tUb3A7CiAgICBkZXBlbmRlbmNpZXNGdWxmaWxsZWQgPSBmdW5jdGlvbiBydW5DYWxsZXIoKSB7CiAgICAgIGlmICghTW9kdWxlWydjYWxsZWRSdW4nXSkgcnVuKCk7CiAgICAgIGlmICghTW9kdWxlWydjYWxsZWRSdW4nXSkgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gcnVuQ2FsbGVyOwogICAgfTsKICAgIGZ1bmN0aW9uIHJ1bihhcmdzKSB7CiAgICAgIGFyZ3MgPSBhcmdzIHx8IE1vZHVsZVsnYXJndW1lbnRzJ107CiAgICAgIGlmIChydW5EZXBlbmRlbmNpZXMgPiAwKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgcHJlUnVuKCk7CiAgICAgIGlmIChydW5EZXBlbmRlbmNpZXMgPiAwKSByZXR1cm4KICAgICAgaWYgKE1vZHVsZVsnY2FsbGVkUnVuJ10pIHJldHVybgogICAgICBmdW5jdGlvbiBkb1J1bigpIHsKICAgICAgICBpZiAoTW9kdWxlWydjYWxsZWRSdW4nXSkgcmV0dXJuCiAgICAgICAgTW9kdWxlWydjYWxsZWRSdW4nXSA9IHRydWU7CiAgICAgICAgaWYgKEFCT1JUKSByZXR1cm4KICAgICAgICBlbnN1cmVJbml0UnVudGltZSgpOwogICAgICAgIHByZU1haW4oKTsKICAgICAgICBpZiAoTW9kdWxlWydvblJ1bnRpbWVJbml0aWFsaXplZCddKSBNb2R1bGVbJ29uUnVudGltZUluaXRpYWxpemVkJ10oKTsKICAgICAgICBwb3N0UnVuKCk7CiAgICAgIH0KICAgICAgaWYgKE1vZHVsZVsnc2V0U3RhdHVzJ10pIHsKICAgICAgICBNb2R1bGVbJ3NldFN0YXR1cyddKCdSdW5uaW5nLi4uJyk7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgTW9kdWxlWydzZXRTdGF0dXMnXSgnJyk7CiAgICAgICAgICB9LCAxKTsKICAgICAgICAgIGRvUnVuKCk7CiAgICAgICAgfSwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9SdW4oKTsKICAgICAgfQogICAgfQogICAgTW9kdWxlWydydW4nXSA9IHJ1bjsKICAgIGZ1bmN0aW9uIGV4aXQoc3RhdHVzLCBpbXBsaWNpdCkgewogICAgICBpZiAoaW1wbGljaXQgJiYgTW9kdWxlWydub0V4aXRSdW50aW1lJ10gJiYgc3RhdHVzID09PSAwKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgaWYgKE1vZHVsZVsnbm9FeGl0UnVudGltZSddKSA7IGVsc2UgewogICAgICAgIEFCT1JUID0gdHJ1ZTsKICAgICAgICBTVEFDS1RPUCA9IGluaXRpYWxTdGFja1RvcDsKICAgICAgICBleGl0UnVudGltZSgpOwogICAgICAgIGlmIChNb2R1bGVbJ29uRXhpdCddKSBNb2R1bGVbJ29uRXhpdCddKHN0YXR1cyk7CiAgICAgIH0KICAgICAgaWYgKEVOVklST05NRU5UX0lTX05PREUpIHsKICAgICAgICBwcm9jZXNzWydleGl0J10oc3RhdHVzKTsKICAgICAgfQogICAgICBNb2R1bGVbJ3F1aXQnXShzdGF0dXMsIG5ldyBFeGl0U3RhdHVzKHN0YXR1cykpOwogICAgfQogICAgTW9kdWxlWydleGl0J10gPSBleGl0OwogICAgZnVuY3Rpb24gYWJvcnQod2hhdCkgewogICAgICBpZiAoTW9kdWxlWydvbkFib3J0J10pIHsKICAgICAgICBNb2R1bGVbJ29uQWJvcnQnXSh3aGF0KTsKICAgICAgfQogICAgICBpZiAod2hhdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgTW9kdWxlLnByaW50KHdoYXQpOwogICAgICAgIE1vZHVsZS5wcmludEVycih3aGF0KTsKICAgICAgICB3aGF0ID0gSlNPTi5zdHJpbmdpZnkod2hhdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2hhdCA9ICcnOwogICAgICB9CiAgICAgIEFCT1JUID0gdHJ1ZTsKICAgICAgdGhyb3cgJ2Fib3J0KCcgKyB3aGF0ICsgJykuIEJ1aWxkIHdpdGggLXMgQVNTRVJUSU9OUz0xIGZvciBtb3JlIGluZm8uJwogICAgfQogICAgTW9kdWxlWydhYm9ydCddID0gYWJvcnQ7CiAgICBpZiAoTW9kdWxlWydwcmVJbml0J10pIHsKICAgICAgaWYgKHR5cGVvZiBNb2R1bGVbJ3ByZUluaXQnXSA9PSAnZnVuY3Rpb24nKSBNb2R1bGVbJ3ByZUluaXQnXSA9IFtNb2R1bGVbJ3ByZUluaXQnXV07CiAgICAgIHdoaWxlIChNb2R1bGVbJ3ByZUluaXQnXS5sZW5ndGggPiAwKSB7CiAgICAgICAgTW9kdWxlWydwcmVJbml0J10ucG9wKCkoKTsKICAgICAgfQogICAgfQogICAgTW9kdWxlWydub0V4aXRSdW50aW1lJ10gPSB0cnVlOwogICAgcnVuKCk7CgogICAgcmV0dXJuIHVucGFjawogIH07CiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8qKgogICAqIFJldHVybnMgYSBQcm9taXNlIGNvbnRhaW5pbmcgdGhlIHJhciBleHRyYWN0b3IgZm9yIHRoZSBnaXZlbiBmaWxlbmFtZS4KICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIGdldEV4dHJhY3Rvcih1cmwpIHsKICAgIHJldHVybiBmZXRjaChuZXcgUmVxdWVzdCh1cmwpKQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2Uub2spIHJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJzQwNCBFcnJvcjogRmlsZSBub3QgZm91bmQuJykKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC50aGVuKChidWZmZXIpID0+IHVucGFja0JyaWRnZS5jcmVhdGVFeHRyYWN0b3JGcm9tRGF0YShidWZmZXIpKQogIH0KCiAgLyoqCiAgICogIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBmb3JtYXR0ZWQgY29udGVudHMgb2YgdGhlIGdpdmVuIGZpbGUuCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBleHRyYWN0KHsgcmVzb3VyY2VJZCwgdXJsIH0pIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIGlmICghdW5wYWNrQnJpZGdlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bnBhY2tCcmlkZ2Ugbm90IGRldGVjdGVkJykKICAgICAgfQogICAgICBpZiAoIXVucGFjaykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigndW5wYWNrIG5vdCBkZXRlY3RlZCcpCiAgICAgIH0KCiAgICAgIGdldEV4dHJhY3Rvcih1cmwpLnRoZW4oCiAgICAgICAgKGV4dHJhY3RvcikgPT4gewogICAgICAgICAgLy8gcmV0dXJuIGV4dHJhY3Rvci5leHRyYWN0QWxsKCk7CiAgICAgICAgICByZXNvbHZlKGV4dHJhY3Rvci5leHRyYWN0QWxsKCkpOwogICAgICAgIH0sCiAgICAgICAgKGVycikgPT4gewogICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgfQogICAgICApOwogICAgfSkKICB9CgogIC8qKgogICAqIExpc3RlbiBmb3IgbWVzc2FnZXMgc2VudCB0byB0aGUgd29ya2VyLgogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShkYXRhLCBwb3N0TWVzc2FnZSkgewogICAgaWYgKGRhdGEudHlwZSA9PSAnaW5pdCcpIHsKICAgICAgdW5wYWNrID0gaW5pdHVucGFjayhkYXRhLmJ1ZmZlcik7CiAgICAgIHVucGFjay5vblJ1bnRpbWVJbml0aWFsaXplZCA9ICgpID0+IHsKICAgICAgICBwb3N0TWVzc2FnZSh7IHR5cGU6ICdXQVNNX0xPQURFRCcgfSk7CiAgICAgIH07CiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PSAnZmV0Y2gnKSB7CiAgICAgIGV4dHJhY3QoZGF0YSkudGhlbigKICAgICAgICAodW5wYWNrZWQpID0+IHsKICAgICAgICAgIHJldHVybkRhdGEoZGF0YSwgdW5wYWNrZWQsIHBvc3RNZXNzYWdlKTsKICAgICAgICB9LAogICAgICAgIChlcnIpID0+IHsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgICAgICAgdGFza0lkOiBkYXRhLnRhc2tJZCwKICAgICAgICAgICAgdHlwZTogJ0VSUk9SJywKICAgICAgICAgICAgcmVzb3VyY2VJZDogZGF0YS5yZXNvdXJjZUlkLAogICAgICAgICAgICB1cmw6IGRhdGEudXJsLAogICAgICAgICAgfTsKICAgICAgICAgIHBvc3RNZXNzYWdlKHJlc3VsdCk7CiAgICAgICAgfQogICAgICApOwogICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT0gJ3VucGFjaycpIHsKICAgICAgY29uc3QgeyBidWZmZXIgfSA9IGRhdGE7CgogICAgICBpZiAoIXVucGFja0JyaWRnZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigndW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCcpCiAgICAgIH0KICAgICAgaWYgKCF1bnBhY2spIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VucGFjayBub3QgZGV0ZWN0ZWQnKQogICAgICB9CgogICAgICBjb25zdCBleHRyYWN0b3IgPSB1bnBhY2tCcmlkZ2UuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGEoYnVmZmVyKTsKICAgICAgY29uc3QgdW5wYWNrZWQgPSBleHRyYWN0b3IuZXh0cmFjdEFsbCgpOwogICAgICByZXR1cm5EYXRhKGRhdGEsIHVucGFja2VkLCBwb3N0TWVzc2FnZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZXR1cm5EYXRhKGRhdGEsIHVucGFja2VkLCBwb3N0TWVzc2FnZSkgewogICAgY29uc3QgW3N0YXRlLCBsaXN0XSA9IHVucGFja2VkOwogICAgaWYgKHN0YXRlLnN0YXRlID09ICdGQUlMJykgewogICAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgICAgdGFza0lkOiBkYXRhLnRhc2tJZCwKICAgICAgICB0eXBlOiAnRVJST1InLAogICAgICAgIHJlYXNvbjogc3RhdGUucmVhc29uLAogICAgICAgIG1zZzogc3RhdGUubXNnLAogICAgICAgIHJlc291cmNlSWQ6IGRhdGEucmVzb3VyY2VJZCwKICAgICAgICB1cmw6IGRhdGEudXJsLAogICAgICB9OwogICAgICBwb3N0TWVzc2FnZShyZXN1bHQpOwogICAgICByZXR1cm4KICAgIH0KICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgdGFza0lkOiBkYXRhLnRhc2tJZCwKICAgICAgdHlwZTogJ0ZJTklTSEVEJywKICAgICAgcmVzb3VyY2VJZDogZGF0YS5yZXNvdXJjZUlkLAogICAgICBlbnRyaWVzOiB7fSwKICAgIH07CgogICAgY29uc3QgdHJhbnNmZXJhYmxlcyA9IFtdOwogICAgaWYgKGxpc3QgJiYgbGlzdC5maWxlcykgewogICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgbGlzdC5maWxlcykgewogICAgICAgIHJlc3VsdC5lbnRyaWVzW2ZpbGUuZmlsZUhlYWRlci5uYW1lXSA9IGZpbGUuZXh0cmFjdFsxXTsKICAgICAgICB0cmFuc2ZlcmFibGVzLnB1c2goZmlsZS5leHRyYWN0WzFdLmJ1ZmZlcik7CiAgICAgIH0KICAgIH0KICAgIHBvc3RNZXNzYWdlKHJlc3VsdCwgdHJhbnNmZXJhYmxlcyk7CiAgfQoKICAvKiBOT0RFX1NUQVJUCiAgZXhwb3J0IHsgaGFuZGxlTWVzc2FnZSB9CiAgLy8gTk9ERV9FTFNFICovCiAgb25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBoYW5kbGVNZXNzYWdlKGV2ZW50LmRhdGEsIHNlbGYucG9zdE1lc3NhZ2UpOwogIH07CiAgLy8gTk9ERV9FTkQKICAvKioKICAgKiBXaGVuIHRoZSBXQVNNIHJ1bnRpbWUgaGFzIGJlZW4gaW5pdGlhbGl6ZWQgb24gdGhlIHVucGFjay5qcyBtb2R1bGUsIHNlbmQgYSBtZXNzYWdlIGluZGljYXRpbmcKICAgKiB0aGF0IHRoZSBsaWJyYXJ5IGlzIHJlYWR5LgogICAqLwogIC8vIDwhLS0gcHJldHRpZXItaWdub3JlLWVuZCAtLT4KCn0pKCk7Cgo=",null,!1);const uA=Uint8Array.from(atob("AGFzbQEAAAABrgIlYAF/AX5gA39/fwF/YAN/fn8AYAR/f39/AX9gAn9/AX9gAAF/YAJ/fwBgA39/fwBgAABgAX8Bf2AEf39/fwBgBn9/f39/fwBgBX9/f39/AGACf38BfGAFf39/f38Bf2AGf39/f39/AX9gCX9/f39/f39/fwF/YAh/f39/f35/fwF/YAJ+fgF/YAF/AGADf398AGAJf39/f39/f39/AGAKf39/f39/f39/fwBgAn9+AGAHf39/f39/fwF/YAp/f39/f39/f39/AX9gB39/f39/f38AYAt/f39/f39/f39/fwBgDX9/f39/f39/f39/f38AYAh/f39/f39/fwBgA39+fwF/YAN+f38Bf2ACfn8Bf2AGf3x/f39/AX9gAnx/AXxgA39/fwF8YAR/f398AAKID1cDZW52Bm1lbW9yeQIAgAIDZW52BXRhYmxlAXABvAK8AgNlbnYJdGFibGVCYXNlA38AA2Vudg5EWU5BTUlDVE9QX1BUUgN/AANlbnYIU1RBQ0tUT1ADfwADZW52BWFib3J0ABMDZW52DWVubGFyZ2VNZW1vcnkABQNlbnYOZ2V0VG90YWxNZW1vcnkABQNlbnYXYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnkABQNlbnYIaW52b2tlX2kACQNlbnYJaW52b2tlX2lpAAQDZW52Cmludm9rZV9paWkAAQNlbnYLaW52b2tlX2lpaWkAAwNlbnYMaW52b2tlX2lpaWlpAA4DZW52Dmludm9rZV9paWlpaWlpABgDZW52EWludm9rZV9paWlpaWlpaWlpABkDZW52CGludm9rZV92ABMDZW52CWludm9rZV92aQAGA2VudgppbnZva2VfdmlpAAcDZW52C2ludm9rZV92aWlpAAoDZW52DGludm9rZV92aWlpaQAMA2Vudg1pbnZva2VfdmlpaWlpAAsDZW52Dmludm9rZV92aWlpaWlpABoDZW52EWludm9rZV92aWlpaWlpaWlpABYDZW52Emludm9rZV92aWlpaWlpaWlpaQAbA2VudhlfX19jeGFfYWxsb2NhdGVfZXhjZXB0aW9uAAkDZW52El9fX2N4YV9iZWdpbl9jYXRjaAAJA2VudhBfX19jeGFfZW5kX2NhdGNoAAgDZW52HF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoXzIABQNlbnYcX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2hfMwAJA2VudhxfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF80AAQDZW52FV9fX2N4YV9mcmVlX2V4Y2VwdGlvbgATA2VudgxfX19jeGFfdGhyb3cABwNlbnYHX19fbG9jawATA2VudgtfX19tYXBfZmlsZQAEA2VudhJfX19yZXN1bWVFeGNlcHRpb24AEwNlbnYLX19fc2V0RXJyTm8AEwNlbnYNX19fc3lzY2FsbDE0MAAEA2Vudg1fX19zeXNjYWxsMTQ1AAQDZW52DV9fX3N5c2NhbGwxNDYABANlbnYNX19fc3lzY2FsbDE4MwAEA2Vudg1fX19zeXNjYWxsMTk4AAQDZW52DF9fX3N5c2NhbGwyMAAEA2VudgtfX19zeXNjYWxsNgAEA2VudgxfX19zeXNjYWxsNjAABANlbnYMX19fc3lzY2FsbDgzAAQDZW52DF9fX3N5c2NhbGw5MQAEA2VudglfX191bmxvY2sAEwNlbnYeX19lbWJpbmRfZmluYWxpemVfdmFsdWVfb2JqZWN0ABMDZW52Fl9fZW1iaW5kX3JlZ2lzdGVyX2Jvb2wADANlbnYXX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3MAHANlbnYjX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfY29uc3RydWN0b3IACwNlbnYgX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfZnVuY3Rpb24AHQNlbnYXX19lbWJpbmRfcmVnaXN0ZXJfZW12YWwABgNlbnYXX19lbWJpbmRfcmVnaXN0ZXJfZmxvYXQABwNlbnYZX19lbWJpbmRfcmVnaXN0ZXJfaW50ZWdlcgAMA2Vudh1fX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldwAHA2VudhxfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nAAYDZW52HV9fZW1iaW5kX3JlZ2lzdGVyX3N0ZF93c3RyaW5nAAcDZW52Hl9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdAALA2VudiRfX2VtYmluZF9yZWdpc3Rlcl92YWx1ZV9vYmplY3RfZmllbGQAFgNlbnYWX19lbWJpbmRfcmVnaXN0ZXJfdm9pZAAGA2VudgZfYWJvcnQACANlbnYWX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZwABA2VudgdfZ2V0ZW52AAkDZW52CV9nZXRncm5hbQAJA2VudglfZ2V0cHduYW0ACQNlbnYIX2pzQ2xvc2UAEwNlbnYJX2pzQ3JlYXRlAAkDZW52B19qc09wZW4ACQNlbnYHX2pzUmVhZAABA2VudgdfanNTZWVrAAEDZW52CF9qc1dyaXRlAAEDZW52E19sbHZtX2VoX3R5cGVpZF9mb3IACQNlbnYKX2xvY2FsdGltZQAJA2VudgdfbWt0aW1lAAkDZW52FF9wdGhyZWFkX2dldHNwZWNpZmljAAkDZW52E19wdGhyZWFkX2tleV9jcmVhdGUABANlbnYNX3B0aHJlYWRfb25jZQAEA2VudhRfcHRocmVhZF9zZXRzcGVjaWZpYwAEA2VudgVfdGltZQAJA2VudhBpbnZva2VfaWlpaWlpamlpABkDZW52Cmludm9rZV9pamoADgNlbnYJaW52b2tlX2ppAAQDZW52Cmludm9rZV92aWoACgNlbnYLaW52b2tlX3ZpamkADANlbnYHX2pzVGVsbAAJA4QEggQTAQEGEwQJCRMGEwEBCQcAEwcGBwwJCgEEAQkGCQETCQkEBAQHBAETAQEJBxMHAwkGBhMIBgkTARMEBBMTAQEBIAkJExMGEwEDCQIEEwcEExMKBgEJDAsIBAwEBAEEBAcJBwkDChMGEAERDAAFCwwKBwMBBwEEBgEJAQEOAQkEABMAAQYHBBMTAQkTEwYTBhMJCgYMCgEABwcGBAcTBAQEAhcKDwQHBwoBExMTBQEDBAcJDgQECQEBAwQJASIJAQQJBAkGCQEBBwQHBBMBCQ4JBgMBEwYTAQwBBwcHBhMXBhMHBhMTEwkPBAkTEwQGFR0MBgYGBwkTCQkJAQEJAQAJBAoTCQkJEwYGBBMEAAIBARMMCgQOGRYVCBQSERIGEA4BDRsWGgsMCiQHBhMZGA8OAwEEIwkBCgwLBwETCQkIEwYICgwLCgwLAQgEBh0BAQkEBh0EBgYGCQMEBAEEAQEBAQEEBAQJAwMHBAEhIB8DAwQBBAQBBAkBBQEBCQQJEwgECQEEHhMDFA0FCgUHBBMFAQcEBg4MBRMJEwcIAwYPExMTBgcHBgMEAQYBBgMJCQYTBAYTBhMEBgQTARMTBh4GFw8BBwkDBgQDBwcBBAQGBgYBCQkGEwYGAwcTEwoTBhMTBwoGEwcGBwYTBwcTFQcHExMTBgkGBgQLEwQJBAMBEwgJBhoFfwEjAQt/ASMCC38BQQALfwFBAAt/AUEACweXBSUYX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwANEDGl9fR0xPQkFMX19zdWJfSV9icmlkZ2VfY3BwAO0DF19fR0xPQkFMX19zdWJfSV9jcmNfY3BwANIEGl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwAOoCEF9fX2N4YV9jYW5fY2F0Y2gAhwMWX19fY3hhX2lzX3BvaW50ZXJfdHlwZQCGAxFfX19lcnJub19sb2NhdGlvbgDKAw5fX19nZXRUeXBlTmFtZQDPAwVfZnJlZQBSB19tYWxsb2MAbAtkeW5DYWxsX2RpaQCFAwlkeW5DYWxsX2kAnwIKZHluQ2FsbF9paQCEAwtkeW5DYWxsX2lpaQCDAwxkeW5DYWxsX2lpaWkAggMNZHluQ2FsbF9paWlpaQCBAw5keW5DYWxsX2lpaWlpaQCAAw9keW5DYWxsX2lpaWlpaWkA/wISZHluQ2FsbF9paWlpaWlpaWlpAP4CEWR5bkNhbGxfaWlpaWlpamlpAOcCC2R5bkNhbGxfaWpqAOYCCmR5bkNhbGxfamkA5QIJZHluQ2FsbF92AP0CCmR5bkNhbGxfdmkA/AILZHluQ2FsbF92aWkA+wIMZHluQ2FsbF92aWlkAPoCDGR5bkNhbGxfdmlpaQD5Ag1keW5DYWxsX3ZpaWlpAPgCDmR5bkNhbGxfdmlpaWlpAPcCD2R5bkNhbGxfdmlpaWlpaQD2AhJkeW5DYWxsX3ZpaWlpaWlpaWkA9QITZHluQ2FsbF92aWlpaWlpaWlpaQD0AgtkeW5DYWxsX3ZpagDkAgxkeW5DYWxsX3ZpamkA4wILc2V0VGVtcFJldDAA3AIIc2V0VGhyZXcA7wIKc3RhY2tBbGxvYwDTBAnKBAEAIwALvALzAtoDvgHoA+ED3QPbA/4BvgG+AYEBzQOPA44DX8YEfKkD0wOlBM0EuwKmAcoCywK4ApYC0QKWArIBcVjqA58CxwKBAYEBgQGBAYEBgQGBAaoB8QHdAu8BvgJqc5kE0gLbAs4E8AHMBLoCyQTSA9UD5APXAd8DnAKaAtcBnAKaAtcBuwOi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DiAAQThqIQ8gAEGQAWohECAAQfAAaiELIABBzABqIREgAEEIaiESIABBBGohDAJAAkADQCAERQRAIAMhAgwCCyANKAIAIQcgACwAAARAIAEgEigCACAMKAIAEFMaIAwoAgAhAiAMQQA2AgAFIAopAwAiEyAErVMhCCATpyECIAgEfyACBSAEIgILBEAgDiwAAARAIAksAAAEQCACIAIgBmpBD3FrIgNBAEoEQCADIQILIAhFBEAgBCECCwsLIAcoAgRFDQQgByAFIAIgBygCACgCDEEfcUHKAGoRAQAhAiAHQbCnAWohCCAPKAIAIgMEfyADBSAIC0GJwQBqLAAABEAgECAFIAIQqwILBSADIQILCyALIAspAwAgAqwiE3w3AwAgAiAGaiEGIAogCikDACATfSITNwMAIBNCAFEgDiwAAEEAR3FFDQEgAgRAIAZBD3FFIAksAABFcg0CCyAFIAJqIQUgBCACayEEIAcgAEEBIBEoAgAQtQEEQCACIQMMAQsLIABBAToAUkF/DwsgDSgCACIDBEAgCykDACADQYi8A2opAwB8IRQgACwAKARAIAApA1ghFSAAKQOIASITQgBRBEAgFSETBSAAKQOAASAUfCEUCyADQazzAGooAgAhAyATIBRTBH9B5AAFIBNCAFEEf0EABSAUQuQAfiATf6cLCyEFIANBzIQDaiwAAEUEQCAFIABByABqIgMoAgBHBEAgAyAFNgIACwsLCyACQX9GBEBBfyEGBSAJLAAABEAgACgCRCABIAYQ6gELCxCFASAGDwtBfwtiAQF/IABFBEBBASEACwJAAkACQANAIAAQbCIBDQJBsLwDQbC8AygCACIBNgIAIAFFDQEgAUEHcUGOAWoRCAAMAAsAC0EEEBQiAEHEJTYCACAAQdgKQQoQGwwBCyABDwtBAAtTAQF/IwQhACMEQeAgaiQEIABBgCBqIgMgAjYCACAAQYAIIAEgAxCAAhogAEGQIGoiAUEANgJEIAFBATYCSCABQUBrQQE2AgAgASAANgIAIAAkBAt6AgV/AX4gAEEYaiIDKAIAIgEgACgCFCIETwRAQgAPCyAAKAIAIQUgASEAAkADQCADIABBAWoiATYCACAFIABqLQAAIgBB/wBxrSACrYYgBnwhBiAAQYABcUUNASACQQdqIQIgASAESQRAIAEhAAwBBUIAIQYL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IAQgAGogAy0AAHM6AAAgAEEBaiIAQYAERw0ACyACQfwDagUgAgshAyAFIQAgA0EANgIAIAEsAIAEBH8gACABQYAEEFMaIwQhASMEQRBqJARBFCABECUhAyABJAQgA0HLAGohBEEAIQEDQCAAIAFqIgMgBCABaiADLQAAczoAACABQQFqIgFBgARHDQALIABB/ANqBSAAC0EANgIAIAIgABBzIQEgAkEAOgAAIAJBADoAASACQQA6AAIgAkEAOgADIAJBADoABCACQQA6AAUgAkEAOgAGIAJBADoAByACQQA6AAggAkEAOgAJIAJBADoACiACQQA6AAsgAkEAOgAMIAJBADoADSACQQA6AA4gAkEAOgAPIAJBADoAECACQQA6ABEgAkEAOgASIAJBADoAEyACQQA6ABQgAkEAOgAVIAJBADoAFiACQQA6ABcgAkEAOgAYIAJBADoAGSACQQA6ABogAkEAOgAbIAJBADoAHCACQQA6AB0gAkEAOgAeIAJBADoAHyACQQA6ACAgAkEAOgAhIAJBADoAIiACQQA6ACMgAkEAOgAkIAJBADoAJSACQQA6ACYgAkEAOgAnIAJBADoAKCACQQA6ACkgAkEAOgAqIAJBADoAKyACQQA6ACwgAkEAOgAtIAJBADoALiACQQA6AC8gAkEAOgAwIAJBADoAMSACQQA6ADIgAkEAOgAzIAJBADoANCACQQA6ADUgAkEAOgA2IAJBADoANyACQQA6ADggAkEAOgA5IAJBADoAOiACQQA6ADsgAkEAOgA8IAJBADoAPSACQQA6AD4gAkEAOgA/IAJBQGtBADoAACACQQA6AEEgAkEAOgBCIAJBADoAQyACQQA6AEQgAkEAOgBFIAJBADoARiACQQA6AEcgAkEAOgBIIAJBADoASSACQQA6AEogAkEAOgBLIAJBADoATCACQQA6AE0gAkEAOgBOIAJBADoATyACQQA6AFAgAkEAOgBRIAJBADoAUiACQQA6AFMgAkEAOgBUIAJBADoAVSACQQA6AFYgAkEAOgBXIAJBADoAWCACQQA6AFkgAkEAOgBaIAJBADoAWyACQQA6AFwgAkEAOgBdIAJBADoAXiACQQA6AF8gAkEAOgBgIAJBADoAYSACQQA6AGIgAkEAOgBjIAJBADoAZCACQQA6AGUgAkEAOgBmIAJBADoAZyACQQA6AGggAkEAOgBpIAJBADoAaiACQQA6AGsgAkEAOgBsIAJBADoAbSACQQA6AG4gAkEAOgBvIAJBADoAcCACQQA6AHEgAkEAOgByIAJBADoAcyACQQA6AHQgAkEAOgB1IAJBADoAdiACQQA6AHcgAkEAOgB4IAJBADoAeSACQQA6AHogAkEAOgB7IAJBADoAfCACQQA6AH0gAkEAOgB+IAJBADoAfyAAQQA6AAAgAEEAOgABIABBADoAAiAAQQA6AAMgAEEAOgAEIABBADoABSAAQQA6AAYgAEEAOgAHIABBADoACCAAQQA6AAkgAEEAOgAKIABBADoACyAAQQA6AAwgAEEAOgANIABBADoADiAAQQA6AA8gAEEAOgAQIABBADoAESAAQQA6ABIgAEEAOgATIABBADoAFCAAQQA6ABUgAEEAOgAWIABBADoAFyAAQQA6ABggAEEAOgAZIABBADoAGiAAQQA6ABsgAEEAOgAcIABBADoAHSAAQQA6AB4gAEEAOgAfIABBADoAICAAQQA6ACEgAEEAOgAiIABBADoAIyAAQQA6ACQgAEEAOgAlIABBADoAJiAAQQA6ACcgAEEAOgAoIABBADoAKSAAQQA6ACogAEEAOgArIABBADoALCAAQQA6AC0gAEEAOgAuIABBADoALyAAQQA6ADAgAEEAOgAxIABBADoAMiAAQQA6ADMgAEEAOgA0IABBADoANSAAQQA6ADYgAEEAOgA3IABBADoAOCAAQQA6ADkgAEEAOgA6IABBADoAOyAAQQA6ADwgAEEAOgA9IABBADoAPiAAQQA6AD8gAEFAa0EAOgAAIABBADoAQSAAQQA6AEIgAEEAOgBDIABBADoARCAAQQA6AEUgAEEAOgBGIABBADoARyAAQQA6AEggAEEAOgBJIABBADoASiAAQQA6AEsgAEEAOgBMIABBADoATSAAQQA6AE4gAEEAOgBPIABBADoAUCAAQQA6AFEgAEEAOgBSIABBADoAUyAAQQA6AFQgAEEAOgBVIABBADoAViAAQQA6AFcgAEEAOgBYIABBADoAWSAAQQA6AFogAEEAOgBbIABBADoAXCAAQQA6AF0gAEEAOgBeIABBADoAXyAAQQA6AGAgAEEAOgBhIABBADoAYiAAQQA6AGMgAEEAOgBkIABBADoAZSAAQQA6AGYgAEEAOgBnIABBADoAaCAAQQA6AGkgAEEAOgBqIABBADoAayAAQQA6AGwgAEEAOgBtIABBADoAbiAAQQA6AG8gAEEAOgBwIABBADoAcSAAQQA6AHIgAEEAOgBzIABBADoAdCAAQQA6AHUgAEEAOgB2IABBADoAdyAAQQA6AHggAEEAOgB5IABBADoAeiAAQQA6AHsgAEEAOgB8IABBADoAfSAAQQA6AH4gAEEAOgB/IAAkBCABRQslAQF/IAIgABBZa0F/aiIDQQBMBEAgAA8LIAAgASADELIDGiAACxYAIABBAEHAywQQVBogAEGowAJqEFwLbQEEfyAAKAIUIABBGGoiBCgCACIFayIDIAJJIgYEfyADBSACIgMLBEAgASAAKAIAIAVqIAMQUxoLIAZFBEAgBCAEKAIAIANqNgIAIAMPCyABIANqQQAgAiADaxBUGiAEIAQoAgAgA2o2AgAgAwueAwEIfyMEIQQjBEEgaiQEIARBCGohBSABQQA2AgAgBEIANwMAIARBEGoiAyAANgIAAkACQAJAAkACQAJAIAEgAyACIAQQuQNBf2sOAgABAgsMAgsgACwAAA0BQQEhAAwCC0EBIQAMAQsgAkEBSwRAQQAhAwJAAkADQCAAIAhqIgYsAABFDQEgBUIANwMAIAEgA0ECdGoiCSAGQawjKAIAKAIABH9BBAVBAQsgBRCKAkF/RgR/IAYsAAAiB0EATg0DIApFBEAgCUH+/wM2AgAgA0EBaiIDIAJPDQQgBiwAACEHCyABIANBAnRqIAdB/wFxQYDAA3I2AgBBASEKIAhBAWoFIAVCADcDACAGQawjKAIAKAIABH9BBAVBAQsgBRCIAiIHQQFKBH8gBwVBAQsgCGoLIQggA0EBaiIDIAJJDQBBACEADAULAAsgASADQQJ0akEANgIAQQEhAAwDC0EAIQAFQQAhAAwBCwwBCyACRQRAIAQkBCAAQf8BcUEARw8LCyABIAJBf2pBAnRqQQA2AgAgBCQEIABB/wFxQQBHC/EBAgN/AX4jBCEBIwRB0ABqJAQgAEGtvANqLAAABEAgASQEQQAPCyAAQYi8A2oiAyAAIAAoAgAoAhRBB3FBhgFqEQAAIgQ3AwACQAJAAkACQAJAAkAgAEGYvANqKAIAQQFrDgMAAQIDCyAAENcCIQIMAwsgABDWAiECDAILIAAQ1QIhAgwBCwwBCyACBEAgAykDACEEBSABJARBAA8LCyAAQZC8A2opAwAgBFUEQCABJAQgAg8LIAFBADYCRCABQRg2AkggAUFAa0EBNgIAIAEgAEEYajYCACAAQay8A2pBAToAAEGs9QJBAxBkIAEkBEEAC9cBAgZ/AX4jBCEDIwRBoAJqJAQgA0EgaiEGIAMhBSAAQSBqIgMpAwAhCSADIAkgAq18NwMAIAJFBEAgBUEgEFsgBkGAAhBbIAUkBA8LIABBKGohByAAQSxqIQggCadBP3EhAwNAIAJBwAAgA2siBEsEfyAEBSACIgQLQcAARgRAIAcgATYCAAUgByAINgIAIABBLGogA2ogASAEEFMaCyAEIANqIgNBwABGBEAgABDhAUEAIQMLIAEgBGohASACIARrIgINAAsgBUEgEFsgBkGAAhBbIAUkBAt4AQF/IABB9A02AgAgAEGo8wBqLAAABEAgAEGs8wBqKAIAIgEEQCABEHkgARBSCwsgAEGQ7gJqKAIAIgEEQCABEFILIABB0OcBaigCACIBBEAgARBSCyAAQdjzAGoQtQIgAEHw8QBqEIQBIABBnMAAahCOASAAEHALBgBBEBAACwgAQQUQAEEACwgAQQIQAEEACzABAX8jBCECIwRBEGokBCACIAE2AgBB8CAoAgAiASAAIAIQzgEaQQogARCrAxoQOQujAgEEfyABRQRAIABBvM0DakEANgIAIABByM0DakEANgIAIABBnM0DaiIEKAIAIgEEQCAAQZjNA2ohBQNAIAUoAgAgAkECdGooAgAiAwRAIAMoAjwiAQRAIAEQUgsgAygCLCIBBEAgARBSCyADKAIUIgEEQCABEFILIAMQUiAEKAIAIQELIAJBAWoiAiABSQ0ACwsgBEEANgIACyAAQazNA2oiAygCACICRQRAIANBADYCAA8LIABBqM0DaiEEQQAhASACIQADQCAEKAIAIAFBAnRqKAIAIgIEQCACKAI8IgAEQCAAEFILIAIoAiwiAARAIAAQUgsgAigCFCIABEAgABBSCyACEFIgAygCACEACyABQQFqIgEgAEkNAAsgA0EANgIAC0gBAX8gAEFAaygCACIBBEAgARCOASABEFILIAAoAkQiAQRAIAEQjgEgARBSCyAAQagBahCNASAAQZwBahCNASAAQZABahCNAQsYAEG39QIsAABFBEAPC0Gs9QJB/wEQ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TBogACABEKwDIgALQQEBfwJAIAAQWSICQX9KBEAgACACQQJ0aiECA0AgAigCACABRg0CIAJBfGoiAiAATw0AQQAhAgsFQQAhAgsLIAILZAEDfwJAIAIEQCABIQMgACEBA0AgAygCACIFRQ0CIANBBGohAyABQQRqIQQgASAFNgIAIAJBf2oiAgRAIAQhAQwBBSAEIQFBACECCwsFIAAhAUEAIQILCyABQQAgAhCwAxogAAvCBAEKfyMEIQYjBEGAQGskBCAAIQcDQAJAA0AgACIEKAIAIQgCQAJAA0ACQAJAAkACQCAIDjAAAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgECCyAHIQAMBwsMAQsMAgsgBEEEaiIAKAIAIghBLkYNAiAAIQQMAAsACyAEQQRqIQAMAQsgBCgCCEEuRw0ACyAEQRBqIQggBCgCDEEvRgRAIAghBwsMAQsLAkACQANAAkACQAJAAkACQCAAKAIAIgcOXQACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAQILDAMLIAAoAgRB3ABGBEAgAEEIakHcABB0IgIEQCACQQRqQdwAEHQiA0EEaiECIAMEfyACBSAAIgILIQMFIAAiAyECCwUgACIDIQILQQ0hBQwBCyAAIgohCSAHIQsLA0AgBUENRgRAQQAhBSADIQogAiEJIAMoAgAhCwsCQAJAAkAgC0Euaw4CAAECCyAKQQRqIQMgCSECQQ0hBQwCCyAKQQRqIgIhA0ENIQUMAQsLIAkgAEYNAiAJIQAMAQsLDAELIAAoAgBBLkYEQCAAKAIEQS5GBEAgAEEIaiICKAIARQRAIAIhAAsLCwsgAUUEQCAGJAQgAA8LIAYgAEGAEBBvGiABIAYQahogBiQEIAALEwAgAAR/IAAgAUEAEJEBBUEACwvaAwMBfwF+AXwCQCABQRRNBEACQAJAAkACQAJAAkACQAJAAkACQAJAIAFBCWsOCgABAgMEBQYHCAkKCyACKAIAQQNqQXxxIgEoAgAhAyACIAFBBGo2AgAgACADNgIADAsLIAIoAgBBA2pBfHEiASgCACEDIAIgAUEEajYCACAAIAOsNwMADAoLIAIoAgBBA2pBfHEiASgCACEDIAIgAUEEajYCACAAIAOtNwMADAkLIAIoAgBBB2pBeHEiASkDACEEIAIgAUEIajYCACAAIAQ3AwAMCAsgAigCAEEDakF8cSIBKAIAIQMgAiABQQRqNgIAIAAgA0H//wNxQRB0QRB1rDcDAAwHCyACKAIAQQNqQXxxIgEoAgAhAyACIAFBBGo2AgAgACADQf//A3GtNwMADAYLIAIoAgBBA2pBfHEiASgCACEDIAIgAUEEajYCACAAIANB/wFxQRh0QRh1rDcDAAwFCyACKAIAQQNqQXxxIgEoAgAhAyACIAFBBGo2AgAgACADQf8Bca03AwAMBAsgAigCAEEHakF4cSIBKwMAIQUgAiABQQhqNgIAIAAgBTkDAAwDCyACKAIAQQdqQXhxIgErAwAhBSACIAFBCGo2AgAgACAFOQMACwsLCzABAn8gAEEEaiIBKAIAIgIEQCAALAAQRQRAIAIQPgsgAUEANgIACyAAQQA2AgxBAQuABAIHfwJ+IAIgAUcEQCAAQbqYAWpBAToAAAsgAiABSSIDBEAgAEG5mAFqQQE6AAALIABBqJgBaiwAAARAIABB0M0DaiIHKAIAIgMgAiABa3EiBEUEQA8LIABBqJYBaiEFIABBsJgBaiEIIAEhAiAAQcCYAWoiBikDACEKIAMhAQNAIAUgAiAEEPwDIQMgCCkDACILIApVBEAgBSACEHUhASALIAp9IgqnIQkgACgCACABIAogA60iClMEfyAJBSADCxBlIAYgBikDACAKfCIKNwMAIAcoAgAhAQsgASADIAJqcSECIAQgA2siBA0ACw8LIABBpJYBaiIFKAIAIAFqIQQgA0UEQCAAQbCYAWopAwAiCiAAQcCYAWoiAykDACILVwRADwsgCiALfSIKpyEFIAAoAgAgBCAKIAIgAWsiAK0iClMEfyAFBSAACxBlIAMgAykDACAKfDcDAA8LIABBzM0DaigCACABayEDIABBsJgBaiIGKQMAIgsgAEHAmAFqIgEpAwAiClUEQCALIAp9IgqnIQcgACgCACAEIAogA60iClMEfyAHBSADCxBlIAEgASkDACAKfCIKNwMAIAYpAwAhCwsgCyAKVwRADwsgCyAKfSIKpyEEIAAoAgAgBSgCACAKIAKtIgpTBH8gBAUgAgsQZSABIAEpAwAgCnw3AwALug8BGX8jBCEGIwRBoAhqJAQgAEEEaiIJKAIAIgUgAEHoAGoiDSgCACICQWdqSgRAIAIgBWsiAUEASARAIAYkBEEADwsgAEHwAGoiByAAQfgAaiIDKAIAIAVrIAcoAgBqNgIAIAVBgIABSgRAIAFBAEoEQCAAKAIQIgIgAiAFaiABEF0aCyAJQQA2AgAgDSABNgIAIAEhAgsgAkGAgAJGBEBBACEBQYCAAiECBSAAKAIAIAAoAhAgAmpBgIACIAJrEF4hASANKAIAIgIgAWohBSABQQBKBEAgDSAFNgIAIAUhAgsLIABB7ABqIgQgAkFiaiIINgIAIAMgCSgCACICNgIAIAJBf2ogBygCACIFaiEDIAVBf0cEQCAEIAggA0gEfyAIBSADCzYCAAsgAUF/RgRAIAYkBEEADwsFIAUhAgsgAEG4rgJqIhMgAEEQaiIPKAIAIgcgAkEBamotAABBCHQgByACai0AAEEQdHIgByACQQJqai0AAHJBCCAAQQhqIgooAgAiAWt2IgRBgIACcSIFNgIAIARBgIABcUUEQCAAQbSmAmpBAEGECBBUGgsgCSABQQJqIgFBA3YgAmoiAjYCACAKIAFBB3EiATYCACAFBH8gAEG8rgJqIARBDHZBA3EiA0EBaiIENgIAIABBwK4CaiIFKAIAIANKBEAgBUEANgIACyAJIAFBAmoiAUEDdiACaiICNgIAIAogAUEHcSIBNgIAIARBgQJsBUH2AgshDiAGQYQIaiEEIAYhCEEAIQYDQCAEIAZqIAcgAkEBamotAABBCHQgByACai0AAEEQdHIgByACQQJqai0AAHJBCCABa3ZBDHZBD3E6AAAgCSABQQRqIgFBA3YgAmoiBTYCACAKIAFBB3EiATYCACAGQQFqIgJBE0cEQCACIQYgBSECDAELC0EAIAQgAEG0+ABqIhRBExBoIABB+ABqIREgAEHwAGohECAAQewAaiESIABBuPkAaiEVIAhBf2ohFkEAIQUgCSgCACEBIA0oAgAhAgJAAkADQCAFIA5IIRcgBUEASiEYIAIhBgJAAkACQANAIBdFDQUgASAGQXtqSgRAIAYgAWsiBEEASA0HIBAgESgCACABayAQKAIAajYCACABQYCAAUoEQCAEQQBKBEAgDygCACICIAIgAWogBBBdGgsgCUEANgIAIA0gBDYCACAEIgYhAgsgEiAGQYCAAkYEf0EAIQFBgIACBSAAKAIAIA8oAgAgBmpBgIACIAZrEF4hASANKAIAIgIgAWohBiABQQBKBH8gDSAGNgIAIAYiAgUgAgsLIgZBYmoiCzYCACARIAkoAgAiBDYCACAEQX9qIBAoAgAiA2ohByADQX9HBEAgEiALIAdIBH8gCwUgBws2AgALIAFBf0YNBwUgASEECyAPKAIAIgwgBEEBamotAABBCHQgDCAEai0AAEEQdHIgDCAEQQJqai0AAHJBCCAKKAIAIgdrdkH+/wNxIgsgAEG4+ABqIBUoAgAiAUECdGooAgBJBH8gCSAHIABBvPkAaiALQRAgAWt2IgdqLQAAaiIDQQN2IARqIgE2AgAgCiADQQdxIgQ2AgAgAEG8gQFqIAdBAXRqBQNAAkAgAUEBaiIBQQ9PBEBBDyEDDAELIAsgAEG4+ABqIAFBAnRqKAIATw0BIAEhAwsLIAkgAyAHaiIHQQN2IARqIgE2AgAgCiAHQQdxIgQ2AgAgAEG8kQFqIAsgACADQQJ0akG0+ABqKAIAa0EQIANrdiAAQfj4AGogA0ECdGooAgBqIgMgFCgCAE8Ef0EABSADC0EBdGoLIgMuAQAiA0H//wNxQRBIDQEgA0EQRw0DIAwgAWotAAAhGSAMIAFBAWpqLQAAIQsgDCABQQJqai0AACEHIAkgBEECaiIDQQN2IAFqIgE2AgAgCiADQQdxNgIAIBhFDQAMAgsACyAIIAVqIABBtKYCaiAFai0AACADQf//A3FqQQ9xOgAAIAVBAWohBQwCCyAWIAVqLAAAIQMgC0H/AXFBCHQgGUEQdHIgB0H/AXFyQQggBGt2QQ52QQNxQQNqIQQDQCAEQX9qIQYgCCAFaiADOgAAIARBAUogBUEBaiIFIA5IcUUNAiAGIQQMAAsACyAMIAFBAWpqLQAAQQh0IAwgAWotAABBEHRyIAwgAUECamotAAByQQggBGt2Qf//A3EgA0ERRiIDBH9BDQVBCQt2IAMEf0EDBUELC2ohBiAJIAQgAwR/QQMFQQcLaiIDQQN2IAFqIgQ2AgAgCiADQQdxNgIAIAggBWpBAEEAQQAgBmsiAyAFIA5rIgFLBH8gAwUgAQtrEFQaIAYhAQNAIAFBf2ohBiABQQFKIAVBAWoiBSAOSHEEQCAGIQEMAQUgBCEBDAILAAsACwALIAYgAUgEQCAIJARBAQ8LIBMoAgAEQCAAQbyuAmoiASgCAEEASgRAQQAhAgNAQQAgCCACQYECbGogAEGErwFqIAJB7B1sakGBAhBoIAJBAWoiAiABKAIASA0ACwsFQQAgCCAAQYQBakGqAhBoQQAgCEGqAmogAEHwHmpBMBBoQQAgCEHaAmogAEHI2gBqQRwQaAsgAEG0pgJqIAhBhAgQUxogCCQEQQEPC0EAIQAgCCQEQQAL9wwCE38CfiMEIQUjBEGgoAFqJAQgBUGYwABqIQQgAEGs8wBqKAIAIQkgAEHwrQJqIQggAEGwpwFqIQYgAEHM8wBqIhUoAgAiE0EDRwRAIAYhCAsCQCATQQFyQQNGBEAgAUEARyILIAhBicEAaiwAAEEARyIPcQRAIABBmLwDaigCAEEDRwRAIAgtABlBE0wEQEEBIQtBASEPDAQLIAhB5MAAaigCAEF/RgRAQQEhC0EBIQ8MBAsLIAhBu8EAaiEGIAFBkAFqIAhB4MAAaiAIQbrBAGosAAAEfyAGBUEACxCqAkUEQCAEQQA2AkQgBEEFNgJIIAQgAEEYajYCACAEQUBrQQI2AgAgBCAIQSBqNgIEC0EBIQ9BASELCwUgAUEARyELCwsgACAAKAIAKAIUQQdxQYYBahEAACEXIAsEQCAAENEBIRggAUGAAWoiBiAGKQMAIBh8NwMACyAFQQhqIRYgBSIMQZiQAWohBiAMQZiAAWohECAAELIBGiAMQRhqIgUgAEEYaiIREGoaIAVBgBAgAEGivANqLAAARRDCAQJAIAAgBSAJQZ2FA2osAAAEf0EEBUEACyIOIAAoAgAoAghBH3FBygBqEQEARQRAIAFBiAFqIRQgCUGwywRqIQogCUG0ywRqIQ0gCUGsywRqIRICQAJAIAsEQCAUQgA3AwAgBCAREGoaIARBgBBBARDCASAAIAQgDiAAKAIAKAIIQR9xQcoAahEBAA0BA0ACQAJAIAooAgAEQCAEIAUQahpBAyASKAIAIAVBACAKKAIAQQ9xQeoAahEDAEF/RgRAQQEhBwwCCyAEIAUQcw0CIAUgBkGAEBBpGiAQIAYQ0AEaQQAgEigCACAGQQAgCigCAEEPcUHqAGoRAwBBf0YEQEEBIQcFIBAgBhCLAQRAIAYgBUGAEBB7GgwEBUEAIQcLCwVBACEHCwsgDSgCAEUEQCAHBEAMBgUMAgsACyAFIARBgBAQaRogBEEAIA0oAgBBH3FBKmoRBABFDQQgBCAFQYAQEHsaIAcNBAsgCigCAEUEQCANKAIARQ0ECyAAIAUgDiAAKAIAKAIIQR9xQcoAahEBAA0FIBRCADcDAAwACwAFIAQgERBqGiAEQYAQQQEQwgEgACAEIA4gACgCACgCCEEfcUHKAGoRAQANAQNAAkACQCAKKAIABEAgBCAFEGoaQQMgEigCACAFQQAgCigCAEEPcUHqAGoRAwBBf0YEQEEBIQcMAgsgBCAFEHMNAiAFIAZBgBAQaRogECAGENABGkEAIBIoAgAgBkEAIAooAgBBD3FB6gBqEQMAQX9GBEBBASEHBSAQIAYQiwEEQCAGIAVBgBAQexoMBAVBACEHCwsFQQAhBwsLIA0oAgBFBEAgBwRADAYFDAILAAsgBSAEQYAQEGkaIARBACANKAIAQR9xQSpqEQQARQ0EIAQgBUGAEBB7GiAHDQQLIAooAgBFBEAgDSgCAEUNBAsgACAFIA4gACgCACgCCEEfcUHKAGoRAQBFDQAMBQsACwALIAUgBBBqGgwCCyAJQajLBGpBDzYCACAEQQA2AkQgBEHEADYCSCAEQUBrQQE2AgAgBCAFNgIAIAAgESAOIAAoAgAoAghBH3FBygBqEQEAGiAAIBdBACAAKAIAKAIQQQNxQbgCahECACAMJARBAA8LCwJAAkAgA0HFAGsOFAABAQEBAQEBAQEBAQEBAQABAQEAAQsgDCARNgIACyAAQQEQ2QIgBSAGQYAQEGkaAkACQCAJQbDLBGoiAygCACIHRQ0AQQMgCUGsywRqIgQoAgAgBUEBIAdBD3FB6gBqEQMAQX9HBEBBACAEKAIAIAZBASADKAIAQQ9xQeoAahEDAEF/Rw0BCwwBCyAJQbTLBGooAgAiAwRAIAZBASADQR9xQSpqEQQARQ0BCyAPBH8gACATEO8BBSAAEHwLGiAVKAIAQQJGBEAgABDuASAAIABBkLwDaikDACAAQfjnAWopAwB9QQAgACgCACgCEEEDcUG4AmoRAgALIAIEQCAWIABB0KcBajYCACAJQcyEA2osAAAaCyALRQRAIAwkBEEBDwsgE0EFRgRAQQAhAAUgCEGJwQBqLAAAIQAgASAIQcjAAGopAwA3AyALIAEgADoAUSABQgA3A3AgAUGQAWogCEHgwABqKAIAIAlBoIsEaigCABCsAiAMJARBAQ8LIAwkBEEACzkAIAFBgIAQTwRADwsgACgCECABaiIAIAJGBEAPCyAAIAJBgIAQIAFrIgAgA0sEfyADBSAACxBdGgsDAAELMwAgAEIANwIAIABCADcCCCAAIAE2AhAgAEEANgIEIABBADYCGCAAQQA2AhQgAEEANgIcC/8DAQJ/IwQhCSMEQYAFaiQEIAJFIAMsAIAERXIEQCAJJARBAA8LIABBqCVqIAI2AgAgAyAJQYABELMEIAkgCUGABGoiCkGAARBpGgJAAkACQAJAAkACQCACQQFrDgUAAQIDBAULIABBxjFqIgVBADoAACAAQcUxaiIGQQA6AAAgAEHEMWoiB0EAOgAAIAosAAAiAARAQQAhAUEAIQJBACEDQQAhBANAIAJB/wFxIABB/wFxIghqIQIgACADcyEDIARB/wFxIAhqIgBBB3ZBAXEgAEEBdHIhBCAKIAFBAWoiAWosAAAiAA0ACyAHIAI6AAAgBiADOgAAIAUgBDoAAAsMBAsgAEG0J2oQvAIgAEHIMWpBfyAKIAoQbhCZASIBOwEAIABByjFqIAFBEHY7AQAgAEHOMWoiBkEAOwEAIABBzDFqIgdBADsBACAKLAAAIgEEQEEAIQJBACEDQQAhBANAIABBtCdqIAFB/wFxIgFBAnRqIQUgByADQf//A3EgAXMgBSgCAHMiAzsBACAGIARB//8DcSABaiAFKAIAQRB2aiIEOwEAIAogAkEBaiICaiwAACIBDQALCwwDCyAAIAoQxQIMAgsgACABIAMgCSAEEMICDAELIAAgASADIAkgBCAFIAYgByAIEMACCyAKQYABEFsgCUGABBBbIAkkBEEBC/UGAQd/IAAhBCACQX9qIQBBASECIAEhBgJAAkADQAJAAkAgBkEARyIJBEADQAJAIAQsAAAiBUUNBiAEQQFqIQMgBUH/AXEhAQJ/IAVBf0oEfyADBSABQeABcUHAAUYEQCADLAAAIgNBwAFxQYABRwRAQQAhAgwKCyADQT9xIAFBBnRBwA9xciEBIARBAmoMAgsgAUHwAXFB4AFGBEAgAywAACIFQcABcUGAAUcEQEEAIQIMCgsgBCwAAiIDQcABcUGAAUcEQEEAIQIMCgsgBUEGdEHAH3EgAUEMdEGA4ANxciADQT9xciEBIARBA2oMAgsgAUH4AXFB8AFHBEBBACECDAkLIAMsAAAiB0HAAXFBgAFHBEBBACECDAkLIAQsAAIiBUHAAXFBgAFHBEBBACECDAkLIAQsAAMiA0HAAXFBgAFHBEBBACECDAkLIAdBDHRBgOAPcSABQRJ0QYCA8ABxciAFQQZ0QcAfcXIgA0E/cXIhASAEQQRqCwshBCAAQQFIDQYgAUH//wNNDQAgAEECSA0GIABBfmohACABQf//wwBNDQNBACECDAELCyAAQX9qIQAMAgUDQCAELAAAIgVFDQYgBEEBaiEDIAVB/wFxIQEgBUF/SgRAIAMhBAwECwJ/IAFB4AFxQcABRgR/IAMsAAAiA0HAAXFBgAFHBEBBACECDAkLQQIhCCADQT9xIQUgAUEGdEHAD3EFIAFB8AFxQeABRgRAIAMsAAAiBUHAAXFBgAFHBEBBACECDAoLIAQsAAIiA0HAAXFBgAFHBEBBACECDAoLQQMhCCAFQQZ0QcAfcSABQQx0QYDgA3FyIQUgA0E/cQwCCyABQfgBcUHwAUcEQEEAIQIMCQsgAywAACIHQcABcUGAAUcEQEEAIQIMCQsgBCwAAiIFQcABcUGAAUcEQEEAIQIMCQsgBCwAAyIDQcABcUGAAUcEQEEAIQIMCQtBBCEIIAdBDHRBgOAPcSABQRJ0QYCA8ABxciAFQQZ0QcAfcXIhBSADQT9xCwshASAEIAhqIQQgBSABciIBQf//A00NAyABQf//wwBLBEBBACECDAELCwsLIAlFBEBBACEGDAILIAYgATYCACAGQQRqIQYMAQsgCQRAIAYgATYCACAGQQRqIQYMAQVBACEGDAELAAsACyAGQQA2AgAgAg8LIAILOQAgBARAIARBADoAAAsgAUUEQEEBDwsgASACIAcEf0ESBUERCyIAEJcCBEBBAQ8LIAEgAiAAEJcCCwYAQRIQAAsIAEELEABCAAsIAEEBEABBAAtaAQN/IAAoAgQiB0EIdSEGIAdBAXEEQCADKAIAIAZqKAIAIQYLIAAoAgAiACgCACgCFCEIIAAgASACIAMgBmogB0ECcQR/IAQFQQILIAUgCEEHcUGoAmoRCwALtgEAIAFBAToANQJAIAEoAgQgA0YEQCABQQE6ADQgAUEQaiIAKAIAIgNFBEAgACACNgIAIAEgBDYCGCABQQE2AiQgASgCMEEBRiAEQQFGcUUNAiABQQE6ADYMAgsgAyACRwRAIAFBJGoiACAAKAIAQQFqNgIAIAFBAToANgwCCyABQRhqIgIoAgAiAEECRgRAIAIgBDYCAAUgACEECyABKAIwQQFGIARBAUZxBEAgAUEBOgA2CwsLC20BAX8CQCABQRBqIgAoAgAiBARAIAQgAkcEQCABQSRqIgAgACgCAEEBajYCACABQQI2AhggAUEBOgA2DAILIAFBGGoiACgCAEECRgRAIAAgAzYCAAsFIAAgAjYCACABIAM2AhggAUEBNgIkCwsLsQQBBH8CQCAABEAgABBZIQQCQAJAA0ACQCAEQQBMBEAgACEDDAELIAAgBEF/aiIDQQJ0aigCAEEvRg0CIAMhBAwBCwsMAQsgACAEQQJ0aiEDCyADQS4QrQEiAwRAAkACQCADQQRqIgQoAgANACAAEFkgAUF9ak8NAAwBCyAEQZgNEOwBBEAgBEHsDBDsAQ0ECwsgBEGoDRBqGgUgAEGEDSABEHgaIAAQWSEDAkACQANAAkAgA0EATARAIAAhAQwBCyAAIANBf2oiAUECdGooAgBBL0YNAiABIQMMAQsLDAELIAAgA0ECdGohAQsgAUEuEK0BIQMLBUEAQYQNIAEQeBoLCyACRQRAIAAQoQMhAgNAAkAgAiACKAIAQQFqIgE2AgAgAUE6RwRAQSEhBQwBCyACQTA2AgAgAkF8aiIGIABJDQAgBigCAEFQakEKSQRAIAYhAgwCCwsLIAVBIUYEQA8LIAAgABBZQQJ0aiIAIAZHBEADQCAAIAAoAgA2AgQgAEF8aiEBIAAgAkcEQCABIQAMAQsLCyACQTE2AgAPCyADQQhqIgEoAgBBUGpBCkkEQCADQQxqIgAoAgBBUGpBCkkEQCAAIAAoAgBBAWoiATYCACABQTpHBEAPCwNAIABBfGoiASgCACICQS5HBEAgAEEwNgIAIAEgAkEBaiICNgIAIAJBOkYEQCABIQAMAgVBISEFCwsLIAVBIUYEQA8LIABBwQA2AgAPCwsgAUG4DRBqGgtaAAJAAkAgAUUNACABKAIARQ0AIAIgAUcEQCACIAEgAxCuARoLDAELIAAEQCAAIAIgAxB7GgUgAkEANgIACwsgA0UEQCACDwsgAiADQX9qQQJ0akEANgIAIAILzQEBBX8gACgCVCEEAkACQCAAKAIcIgMgAUYNACAAIAMgACgCFCADaxDEAUF/Rw0AQX8hAAwBCwJAIAJBAEcgBEEEaiIFKAIAQQBHcQRAIAIhACAEKAIAIQYDQCAGIAEgABDMASIDQX9MBEAgAyEADAMLIAEgA2ohASAFIAUoAgBBf2oiBzYCACAEIAQoAgBBBGoiBjYCACAAIANrIgBBAEcgB0EAR3ENACADIQALBUEAIQALCyAEKAIAQQA2AgAgAEEATgRAIAIhAAsLIAALOwEBfwJAIAIEQANAIAAoAgBBIHENAiABQQRqIQMgASgCACAAEKwBGiACQX9qIgIEQCADIQEMAQsLCwsLDgAgACABIAIQsQMaIAALHgEBfyAAIAAgARC0A0ECdGoiAigCAAR/IAIFQQALCzcBAX8gABBZIgJFBEAPCyACQQFqIAFJIAAgAkF/akECdGooAgBBL0dxRQRADwsgAEH8DBCGAhoLUQECfwJ/IAIEfwNAIAEoAgAiA0UgACgCACIERSAEIANHcnJFBEAgAEEEaiEAIAFBBGohAUEAIAJBf2oiAkUNAxoMAQsLIAQgA2sFQQALCyIACxYAIABFBEBBAA8LIABB2A4QxwFBAEcLSgEBfyMEIQMjBEEQaiQEIAMgADYCACADIAE2AgQgAyACNgIIQcYBIAMQJCIAQYBgSwRAQYi8A0EAIABrNgIAQX8hAAsgAyQEIAALygIBA38jBCEEIwRBEGokBAJ/IAEEfwJAIAIEQCAARQRAIAQhAAsgASwAACIDQX9KBEAgACADQf8BcTYCACADQQBHDAQLIAEsAAAhA0GsIygCACgCAEUEQCAAIANB/78DcTYCAEEBDAQLIANB/wFxQb5+aiIDQTJNBEAgA0ECdEGkHmooAgAhAyACQQRJBEAgA0GAgICAeCACQQZsQXpqdnENAwsgAS0AASICQQN2IgVBcGogBSADQRp1anJBB00EQCACQYB/aiADQQZ0ciICQQBOBEAgACACNgIAQQIMBgsgAS0AAkGAf2oiA0E/TQRAIAMgAkEGdHIiAkEATgRAIAAgAjYCAEEDDAcLIAEtAANBgH9qIgFBP00EQCAAIAEgAkEGdHI2AgBBBAwHCwsLCwsLQYi8A0HUADYCAEF/BUEACwshACAEJAQgAAuxFAIUfwF+IwQhCyMEQUBrJAQgC0EUaiETIAtBEGoiDSABNgIAIABBAEchEiALQRhqIgFBKGoiECEVIAFBJ2ohFiALQQhqIhRBBGohGEEAIQECQAJAA0ACQCAMQX9KBEAgBUH/////ByAMa0oEf0GIvANBywA2AgBBfwUgBSAMagshDAsgDSgCACIJLAAAIgZFDQIgCSEFAkACQANAAkACQAJAAkAgBkEYdEEYdQ4mAQICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgACCyAFIQYMBAsMAQsgDSAFQQFqIgU2AgAgBSwAACEGDAELCwwBCwNAIAYsAAFBJUcNASAFQQFqIQUgDSAGQQJqIgY2AgAgBiwAAEElRg0ACwsgBSAJayEFIBIEQCAAIAkgBRBjCyAFDQEgDSANKAIAIgUgDSgCACwAAUFQakEKTwR/QX8hCkEBBSAFLAACQSRGBH8gBSwAAUFQaiEKQQEhAUEDBUF/IQpBAQsLaiIFNgIAIAUsAAAiCEFgaiIGQR9LQQEgBnRBidEEcUVyBEBBACEGBUEAIQcgCCEGA0BBASAGQRh0QRh1QWBqdCAHciEGIA0gBUEBaiIFNgIAIAUsAAAiCEFgaiIHQR9LQQEgB3RBidEEcUVyRQRAIAYhByAIIQYMAQsLCwJAIAhB/wFxQSpGBH8CfwJAIAUsAAFBUGpBCk8NACANKAIAIgUsAAJBJEcNACAEIAVBAWoiASwAAEFQakECdGpBCjYCACADIAEsAABBUGpBA3RqKQMApyEBQQEhByAFQQNqDAELIAEEQEF/IQwMBAsgEgRAIAIoAgBBA2pBfHEiBSgCACEBIAIgBUEEajYCAAVBACEBC0EAIQcgDSgCAEEBagshBSANIAU2AgAgBkGAwAByIQhBACABayEPIAFBAEgiDkUEQCAGIQgLIA5FBEAgASEPCyAHIQEgBQUgDRCPAiIPQQBIBEBBfyEMDAMLIAYhCCANKAIACyIGLAAAQS5GBEAgBiwAAUEqRwRAIA0gBkEBajYCACANEI8CIQUgDSgCACEGDAILIAYsAAJBUGpBCkkEQCANKAIAIgYsAANBJEYEQCAEIAZBAmoiBSwAAEFQakECdGpBCjYCACADIAUsAABBUGpBA3RqKQMApyEFIA0gBkEEaiIGNgIADAMLCyABBEBBfyEMDAMLIBIEQCACKAIAQQNqQXxxIgYoAgAhBSACIAZBBGo2AgAFQQAhBQsgDSANKAIAQQJqIgY2AgAFQX8hBQsLQQAhDgNAIAYsAABBv39qQTlLBEBBfyEMDAILIA0gBkEBaiIHNgIAIA5BOmwgBiwAAGpBzOUAaiwAACIRQf8BcSIGQX9qQQhJBEAgBiEOIAchBgwBCwsgEUUEQEF/IQwMAQsgCkF/SiEXAkACQCARQRNGBEAgFwRAQX8hDAwEBQwCCwAFIBcEQCAEIApBAnRqIAY2AgAgCyADIApBA3RqKQMANwMADAILIBJFBEBBACEMDAQLIAsgBiACELEBIA0oAgAhBwsMAQsgEkUEQEEAIQUMAwsLIAdBf2osAAAiBkFfcSEHIA5BAEcgBkEPcUEDRnFFBEAgBiEHCyAIQf//e3EhCiAIQYDAAHEEfyAKBSAICyEGAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCAHQcEAaw44CwwJDAsLCwwMDAwMDAwMDAwMCgwMDAwCDAwMDAwMDAwLDAYECwsLDAQMDAwHAAMBDAwIDAUMDAIMCwJAAkACQAJAAkACQAJAAkAgDkH/AXFBGHRBGHUOCAABAgMEBwUGBwsgCygCACAMNgIAQQAhBQwbCyALKAIAIAw2AgBBACEFDBoLIAsoAgAgDKw3AwBBACEFDBkLIAsoAgAgDDsBAEEAIQUMGAsgCygCACAMOgAAQQAhBQwXCyALKAIAIAw2AgBBACEFDBYLIAsoAgAgDKw3AwBBACEFDBULQQAhBQwUC0H4ACEHIAVBCE0EQEEIIQULIAZBCHIhBgwLCwwKCyAVIAspAwAiGSAQEL4DIghrIgpBAWohDkEAIQlB3ekAIQcgBkEIcUUgBSAKSnJFBEAgDiEFCwwNCyALKQMAIhlCAFMEQCALQgAgGX0iGTcDAEEBIQlB3ekAIQcFIAZBgBBxRSEIIAZBAXEEf0Hf6QAFQd3pAAshByAGQYEQcUEARyEJIAhFBEBB3ukAIQcLCwwJC0EAIQlB3ekAIQcgCykDACEZDAgLIBYgCykDADwAACAWIQhBACEJQd3pACEOIBAhB0EBIQUgCiEGDAwLQYi8AygCABCSAiEIDAcLIAsoAgAiCEUEQEGC7gAhCAsMBgsgFCALKQMAPgIAIBhBADYCACALIBQ2AgBBfyEKIBQhCAwGCyALKAIAIQggBQRAIAUhCgwGBSAAQSAgD0EAIAYQZkEAIQUMCAsACyAAIAsrAwAgDyAFIAYgBxC9AyEFDAkLIAkhCEEAIQlB3ekAIQ4gECEHDAYLIAspAwAiGSAQIAdBIHEQvwMhCCAHQQR1Qd3pAGohByAGQQhxRSAZQgBRciIJBEBB3ekAIQcLIAkEf0EABUECCyEJDAMLIBkgEBCSASEIDAILIAhBACAFEMMDIgZFIREgBiAIayEJIAggBWohByARRQRAIAkhBQtBACEJQd3pACEOIBFFBEAgBiEHCyAKIQYMAwsgCCEJQQAhBUEAIQcDQAJAIAkoAgAiDkUNACATIA4QsAEiB0EASCAHIAogBWtLcg0AIAlBBGohCSAKIAcgBWoiBUsNAQsLIAdBAEgEQEF/IQwMBAsgAEEgIA8gBSAGEGYgBQRAQQAhBwNAIAgoAgAiCUUNAyATIAkQsAEiCSAHaiIHIAVKDQMgCEEEaiEIIAAgEyAJEGMgByAFSQ0ADAMLAAVBACEFDAILAAsgBkH//3txIQogBUF/SgRAIAohBgsgBUEARyAZQgBSIgpyIQ4gBSAVIAhrIApBAXNBAXFqIgpKBEAgBSEKCyAOBEAgCiEFCyAORQRAIBAhCAsgByEOIBAhBwwBCyAAQSAgDyAFIAZBgMAAcxBmIA8gBUoEQCAPIQULDAILIABBICAPIAUgByAIayIKSAR/IAoFIAULIhEgCWoiB0gEfyAHBSAPCyIFIAcgBhBmIAAgDiAJEGMgAEEwIAUgByAGQYCABHMQZiAAQTAgESAKQQAQZiAAIAggChBjIABBICAFIAcgBkGAwABzEGYMAQsLDAELIABFBEAgAQRAQQEhAANAIAQgAEECdGooAgAiAQRAIAMgAEEDdGogASACELEBIABBAWohASAAQQlIBEAgASEADAIFIAEhAAsLCyAAQQpIBEADQCAEIABBAnRqKAIABEBBfyEMDAULIABBAWohASAAQQlIBEAgASEADAEFQQEhDAsLBUEBIQwLBUEAIQwLCwsgCyQEIAwL7QIBC38jBCEEIwRB4AFqJAQgBEGIAWohBSAEQdAAaiIDQgA3AgAgA0IANwIIIANCADcCECADQgA3AhggA0IANwIgIARB+ABqIgYgAigCADYCAEEAIAEgBiAEIAMQzQFBAEgEQEF/IQEFIAAoAkwaQQAhAiAAKAIAIQcgACwASkEBSARAIAAgB0FfcTYCAAsgAEEwaiIIKAIABEAgACABIAYgBCADEM0BIQEFIABBLGoiCSgCACEKIAkgBTYCACAAQRxqIgwgBTYCACAAQRRqIgsgBTYCACAIQdAANgIAIABBEGoiDSAFQdAAajYCACAAIAEgBiAEIAMQzQEhASAKBEAgAEEAQQAgACgCJEEfcUHKAGoRAQAaIAsoAgBFBEBBfyEBCyAJIAo2AgAgCEEANgIAIA1BADYCACAMQQA2AgAgC0EANgIACwsgACAAKAIAIgMgB0EgcXI2AgAgA0EgcQRAQX8hAQsLIAQkBCABCx8BAn8gACAAEFkiAUECdGpBfGohAiABBH8gAgUgAAsLDAAgACABEMIDGiAAC+8BAgJ/An4gACAAKAIAKAIUQQdxQYYBahEAACEDIAAoAgAoAhAhAUEAJAUgASAAQQBBAEECEFAjBSEBQQAkBSABQQFxRQRAIAAoAgAoAhQhAUEAJAUgASAAEE6tIwetQiCGhCEEIwUhAUEAJAUgAUEBcUUEQCAAKAIAKAIQIQFBACQFIAEgACADpyADQiCIp0EAEFAjBSEBQQAkBSABQQFxBEBBABAYEFoFIAQPCwsLEBchASAAKAIAKAIQIQJBACQFIAIgACADpyADQiCIp0EAEFAjBSEAQQAkBSAAQQFxBEBBABAYEFoFIAEQHgtCAAtcAQF/IABBxB02AgAgAEEANgIEIABBADYCGCAAQQA6AAggAEGYwABqQQA2AgAgAEEAOgAVIABBDGoiAUEANgIAIAFBADsBBCABQQA6AAYgAEEBOgATIABBAToAFAs/AQJ/IABBBGoiAigCACIBRQRAIAAsABQEQEGs9QIgAEEYahC0AiACKAIAIQEFQn8PCwsgARBRrSMHrUIghoQL5QICCX8BfiAAQRFqIgUsAAAEfiAAIAAoAgAoAhRBB3FBhgFqEQAABUIACyEMIABBDGohCEHwHygCACEJIABBBGohBiAAQQhqIQcgAEGYwABqIQogAEEUaiELIABBGGohAwJAAkACQANAIAgoAgBBAUYEQCAGIAk2AgALIAcsAAAEQCAHQQA6AAALIAYoAgAgASACEEEiBEF/Rw0DIApBAjYCACALLAAARQRAQX8hBAwECyAFLAAADQEgCCgCAA0CDAILAAsgAkUEQEEADwtBACEEQQAhAwNAIAAgDCADrXxBACAAKAIAKAIQQQNxQbgCahECACAIKAIAQQFGBEAgBiAJNgIACyAHLAAABEAgB0EAOgAACyAGKAIAIAEgAiADayIFQYAESQR/IAUFQYAECxBBIgVBf0YEf0GABAUgBQsgBGohBCADQYAEaiIDIAJJDQALIAQPC0Gs9QIgAxC6BEF/DwsgBAuMAgEDfyABKAIAIQIgAEIANwIAIABBADYCCCACQe////8DSwRAIAAQigELIAFBBGohBAJAIAJBAkkEQCAAIAI6AAsgAgRAIAAhAwUgACACQQJ0akEANgIADwsFIAJBBGpBfHEiAUH/////A00EQCAAIAFBAnQQXyIDNgIAIAAgAUGAgICAeHI2AgggACACNgIEDAILQQgQFCEAQQAkBUEXIABBzO4AEA0jBSEBQQAkBSABQQFxBEAQFyEBIAAQGiABEB4FIABB7CU2AgAgAEH4CkEMEBsLCwtBACQFQR0gAyAEIAIQBxojBSEAQQAkBSAAQQFxBEBBABAYIgAQWgUgAyACQQJ0akEANgIACwsPACABIAAoAgBqIAI2AgALDQAgASAAKAIAaigCAAvQBgECfyAAKAIAIgEEQCABEFIgAEEANgIACyAAQQRqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBCGoiASgCACICBEAgAhBSIAFBADYCAAsgAEEMaiIBKAIAIgIEQCACEFIgAUEANgIACyAAQRBqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBFGoiASgCACICBEAgAhBSIAFBADYCAAsgAEEYaiIBKAIAIgIEQCACEFIgAUEANgIACyAAQRxqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBIGoiASgCACICBEAgAhBSIAFBADYCAAsgAEEkaiIBKAIAIgIEQCACEFIgAUEANgIACyAAQShqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBLGoiASgCACICBEAgAhBSIAFBADYCAAsgAEEwaiIBKAIAIgIEQCACEFIgAUEANgIACyAAQTRqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBOGoiASgCACICBEAgAhBSIAFBADYCAAsgAEE8aiIBKAIAIgIEQCACEFIgAUEANgIACyAAQUBrIgEoAgAiAgRAIAIQUiABQQA2AgALIABBxABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABByABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABBzABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB0ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB1ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB2ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB3ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB4ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB5ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB6ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB7ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB8ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB9ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB+ABqIgEoAgAiAgRAIAIQUiABQQA2AgALIABB/ABqIgAoAgAiAUUEQA8LIAEQUiAAQQA2AgAL6AoBGn8jBCECIwRBEGokBCACQQhqIRIgAiEJIABB4ABqIgooAgAgAEHkAGoiDCgCACICayAAQdDNA2oiDSgCACIDcSETIABBNGohBwJAAkAgAEE4aiILKAIARQ0AIABBHGohDiAAQRhqIRQgAEEgaiEXIABBFGohDyAAQczNA2ohGCAAQaiYAWohFSAAQaSWAWohECAAQaiWAWohESAAQbqYAWohGSAAQcCYAWohFiATIQECQAJAAkACQANAAkAgBygCACIGIAVBBHRqIhosAABBCEcEQCAGIAVBBHRqKAIEIQQgBiAFQQR0akENaiIILAAABEAgBCAMKAIAayADcSATSw0CIAhBADoAAAwCCyAGIAVBBHRqKAIIIQYgAyAEIAJrcSABSQRAIAQgAkcEQCAAIAIgBBCzASAEIQIgCigCACAEayANKAIAIgNxIQELIAYgAUsNBCAGBEAgDigCACEBIBQgBjYCACABIAZJBEAgFygCACICQQBHIAYgAktxBH8gCSACNgIAQaz1AkHYGyAJEGBBrPUCEFYgDigCACEBIBQoAgAFIAYLIQIgDygCACACIAFBIGogAUECdmoiAUsEfyACBSABIgILEFciAUUEQEGs9QIQVgsgDyABNgIAIA4gAjYCAAsgDygCACEBAkAg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ACADIAFBlJUBaiAEai0AACIEQQR0aiEDIAIgBGshAgsgASACakG5lQFqLQAAIQQLIAMgAUHIlgFqIARBAnRqIgEoAgA2AgAgASADNgIACyAKIAA2AgALIA0gADYCACAGJAQLuxIBCX8gAEHwDGpBAEGAAhBUGiAAQZCVAWoiBhCOBCAAQewMaiIIIABB5AxqIgUoAgAiA0F/cyIBQXNKBH8gAQVBcws2AgAgAEHElgFqIgcoAgAiASAAQcCWAWoiAigCAEYEQCAAQciWAWoiBCgCACIBBEAgBCABKAIANgIABSAGQQAQoAEhASAFKAIAIQMLBSAHIAFBcGoiATYCAAsgAEHQDGogATYCACAAQcgMaiIFIAE2AgAgAUEANgIMIABB4AxqIAM2AgAgAUGAAjsBACABQYECOwEEIABByJYBaiAAQbmWAWotAAAiA0ECdGoiBCgCACIBBEAgBCABKAIANgIABSACIAIoAgAiASAAQZSVAWogA2oiCS0AAEEEdGoiBDYCACAEIAcoAgBLBEAgAiAEIAktAABBBHRrNgIAIAYgAxCgASEBCwsgBSgCACABNgIIIABB1AxqIAE2AgAgAEHoDGogCCgCADYCACAAQfEUakEAOgAAIAUoAgBBCGohA0EAIQEDQCADKAIAIAFBA3RqIAE6AAAgAygCACABQQN0akEBOgABIAMoAgAgAUEDdGpBADYCBCABQQFqIgFBgAJHDQBBACEBCwNAIABB9BRqIAFBB3RqQYCAAUHd+QAgAUECaiIDbmtB//8DcSICOwEAIAAgAUEHdGpBhBVqIAI7AQAgACABQQd0akGUFWogAjsBACAAIAFBB3RqQaQVaiACOwEAIAAgAUEHdGpBtBVqIAI7AQAgACABQQd0akHEFWogAjsBACAAIAFBB3RqQdQVaiACOwEAIAAgAUEHdGpB5BVqIAI7AQAgACABQQd0akH2FGpBgIABQb8+IANua0H//wNxIgI7AQAgACABQQd0akGGFWogAjsBACAAIAFBB3RqQZYVaiACOwEAIAAgAUEHdGpBphVqIAI7AQAgACABQQd0akG2FWogAjsBACAAIAFBB3RqQcYVaiACOwEAIAAgAUEHdGpB1hVqIAI7AQAgACABQQd0akHmFWogAjsBACAAIAFBB3RqQfgUakGAgAFBv7MBIANua0H//wNxIgI7AQAgACABQQd0akGIFWogAjsBACAAIAFBB3RqQZgVaiACOwEAIAAgAUEHdGpBqBVqIAI7AQAgACABQQd0akG4FWogAjsBACAAIAFBB3RqQcgVaiACOwEAIAAgAUEHdGpB2BVqIAI7AQAgACABQQd0akHoFWogAjsBACAAIAFBB3RqQfoUakGAgAFB85EBIANua0H//wNxIgI7AQAgACABQQd0akGKFWogAjsBACAAIAFBB3RqQZoVaiACOwEAIAAgAUEHdGpBqhVqIAI7AQAgACABQQd0akG6FWogAjsBACAAIAFBB3RqQcoVaiACOwEAIAAgAUEHdGpB2hVqIAI7AQAgACABQQd0akHqFWogAjsBACAAIAFBB3RqQfwUakGAgAFBockBIANua0H//wNxIgI7AQAgACABQQd0akGMFWogAjsBACAAIAFBB3RqQZwVaiACOwEAIAAgAUEHdGpBrBVqIAI7AQAgACABQQd0akG8FWogAjsBACAAIAFBB3RqQcwVaiACOwEAIAAgAUEHdGpB3BVqIAI7AQAgACABQQd0akHsFWogAjsBACAAIAFBB3RqQf4UakGAgAFBvLUBIANua0H//wNxIgI7AQAgACABQQd0akGOFWogAjsBACAAIAFBB3RqQZ4VaiACOwEAIAAgAUEHdGpBrhVqIAI7AQAgACABQQd0akG+FWogAjsBACAAIAFBB3RqQc4VaiACOwEAIAAgAUEHdGpB3hVqIAI7AQAgACABQQd0akHuFWogAjsBACAAIAFBB3RqQYAVakGAgAFBsswBIANua0H//wNxIgI7AQAgACABQQd0akGQFWogAjsBACAAIAFBB3RqQaAVaiACOwEAIAAgAUEHdGpBsBVqIAI7AQAgACABQQd0akHAFWogAjsBACAAIAFBB3RqQdAVaiACOwEAIAAgAUEHdGpB4BVqIAI7AQAgACABQQd0akHwFWogAjsBACAAIAFBB3RqQYIVakGAgAFB0cABIANua0H//wNxIgM7AQAgACABQQd0akGSFWogAzsBACAAIAFBB3RqQaIVaiADOwEAIAAgAUEHdGpBshVqIAM7AQAgACABQQd0akHCFWogAzsBACAAIAFBB3RqQdIVaiADOwEAIAAgAUEHdGpB4hVqIAM7AQAgACABQQd0akHyFWogAzsBACABQQFqIgFBgAFHDQBB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QEEAEBgQWgUgBhAeCwsgByAZNwMAIAMgGjcDACACIAo2AgAgACgCACgCECECQQAkBSACIAAgF6cgF0IgiKdBABBQIwUhAkEAJAUgAkEBcQRAQQAQGBBaBSABIQ8LCyAPLAAABEAgAEGhvANqLAAARQRAIAUkBEEBDwsLIABB5LwDaiAAQRhqEGoaIAUkBEEBDwsgBSQEQQALBgBBFxAACwYAQRYQAAsGAEEREAALCABBBxAAQQALLQEBfyAAQTsQrQEiAgRAIAJBBGoQyQIhACABBEAgAkEANgIACwVBACEACyAAC9YBAQJ/IwQhAyMEQYAQaiQEAkAgAARAAkACQAJAAkAgACgCAA4wAAICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIBAgsMBAsgAUEANgIADAELIANBgBAQtgNFBEAgA0EAOgAACyADIAEgAhB7GiABEFkiBARAIARBAWogAkkgASAEQX9qQQJ0aigCAEEvR3EEQCABQfwMEIYCGgsLCyABIAAgAhB4GiADJAQPCwsgAkUEQCADJAQPCyABQQA2AgAgAyQEC78BAQJ/AkAgAkF/aiIEBEBBACECA0ACQAJAAkAgACACQQJ0aigCACIDDl0AAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgECCwwEC0EvIQMLIAEgAkECdGogAzYCACACQQFqIgIgBEkNAAsFQQAhAgsLIAEgAkECdGpBADYCAAtWAQN/IAAoAgQiBUEIdSEEIAVBAXEEQCACKAIAIARqKAIAIQQLIAAoAgAiACgCACgCHCEGIAAgASACIARqIAVBAnEEfyADBUECCyAGQQdxQZgCahEKAAsHACAAIAFGCwsAIAAQ/AEgABBSCxIAIABB2CU2AgAgAEEEahCNAwuDAQEBfyMEIQEjBEEQaiQEQQAkBSAAEAsjBSEAQQAkBSAAQQFxRQRAQQAkBUEZQbvyACABEA1BACQFC0EAEBgiABAVGkEAJAVBGUHj8gAgAUEIahANQQAkBUEAEBghAUEAJAVBBBALIwUhAEEAJAUgAEEBcQRAQQAQGCIAEFoFIAEQWgsLOAECfyMEIQAjBEEQaiQEQai8A0EDEEkEQEGj8QAgABCCAQVBrLwDKAIAEEchASAAJAQgAQ8LQQALuAEBBX8jBCEFIwRBEGokBCAAQQtqIgYsAAAiA0EASCIEBH8gACgCCEH/////B3FBf2oFQQoLIgcgAkkEQCAAIAcgAiAHayAEBH8gACgCBAUgA0H/AXELIgNBACADIAIgARCkAwUgBAR/IAAoAgAFIAALIgMhBCACBEAgBCABIAIQXRoLIAVBADoAACADIAJqIAUsAAA6AAAgBiwAAEEASARAIAAgAjYCBAUgBiACOgAACwsgBSQEIAALpwEBAn8jBCEFIwRBkANqJAQgBSAANgIAIAUgAUF/ajYCBCAFQQhqIgRBAEH8ABBUGiAEQX86AEsgBEEeNgIkIARBgAI2AjAgBCAFQYgBajYCLCAEQX82AkwgBCAFNgJUIAEEQCABQQBIBEBBiLwDQcsANgIAQX8hAAUgBCACIAMQrQMhACAEQQBBABDEARogACABTwRAQX8hAAsLBUF/IQALIAUkBCAAC6kBAQV/IwQhAiMEQRBqJAQgAiABQf8BcSIGOgAAAkACQCAAQRBqIgMoAgAiBA0AIAAQjAIEQEF/IQEFIAMoAgAhBAwBCwwBCyAAQRRqIgMoAgAiBSAESQRAIAFB/wFxIgEgACwAS0cEQCADIAVBAWo2AgAgBSAGOgAADAILCyAAIAJBASAAKAIkQR9xQcoAahEBAEEBRgR/IAItAAAFQX8LIQELIAIkBCABC9EBAQN/IAJFBEAPCyACQX9qIQQgABBZIQMCQAJAA0ACQCADQQBMBEAgACECDAELIAAgA0F/aiICQQJ0aigCAEEvRg0CIAIhAwwBCwsMAQsgACADQQJ0aiECCyAEIAIgACIFa0ECdU8EQCAAEFkhAwJAAkADQAJAIANBAEwEQCAAIQIMAQsgACADQX9qIgJBAnRqKAIAQS9GDQIgAiEDDAELCwwBCyAAIANBAnRqIQILIAIgBWtBAnUhBAsgASAAIAQQrgEaIAEgBEECdGpBADYCAAtIAQJ/IAAoAgAoAgBBUGpBCkkEQANAIAJBCmxBUGogACgCACIBKAIAaiECIAAgAUEEaiIBNgIAIAEoAgBBUGpBCkkNAAsLIAIL3hIDFn8BfgF8IwQhCCMEQYABaiQEIAhB2ABqIREgCEHIAGohEiAIQShqIQ4gCEEgaiETIAhBGGohFCAIQRBqIRUgCEEIaiEWIAhB8ABqIRcgCEHoAGohGCAIQewAaiIKIAE2AgAgAEEARyEQQQAhAQJAAkADQAJAAkAgCUF/SgRAIAVB/////wcgCWtMBEAgBSAJaiEJDAILIAAoAgBBIHFFBEBBiLwDQcsANgIAC0F/IQkLCyAKKAIAIgYoAgAiB0UNAiAGIQUDQAJAAkACQCAHDiYAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAELDAELIAogBUEEaiIFNgIAIAUoAgAhBwwBCwsgBUHgJBCuAyEFIAogCigCACIHIAVBfnFBAnRqNgIAIAcgBUEBdkECdGogBmtBAnUhBSAQBEAgACAGIAUQxQELIAUNASAKIAooAgAiBSAKKAIAKAIEQVBqQQpPBH9BfyEPQQEFIAUoAghBJEYEfyAFKAIEQVBqIQ9BASEBQQMFQX8hD0EBCwtBAnRqIgU2AgAgBSgCACIHQWBqIgZBH0tBASAGdEGJ0QRxRXIEQEEAIQYFQQAhCyAHIQYDQEEBIAZBYGp0IAtyIQYgBUEEaiIFKAIAIgdBYGoiC0EfS0EBIAt0QYnRBHFFckUEQCAGIQsgByEGDAELCyAKIAU2AgALAkAgB0EqRgR/An8CQCAFKAIEQVBqQQpPDQAgCigCACIFKAIIQSRHDQAgBCAFQQRqIgEoAgBBUGpBAnRqQQo2AgAgAyABKAIAQVBqQQN0aikDAKchAUEBIQcgBUEMagwBCyABBEBBfyEJDAQLIBAEQCACKAIAQQNqQXxxIgUoAgAhASACIAVBBGo2AgAFQQAhAQtBACEHIAooAgBBBGoLIQUgCiAFNgIAIAZBgMAAciELQQAgAWshDSABQQBIIgxFBEAgBiELCyAMRQRAIAEhDQsgByEBIAUFIAoQgwIiDUEASARAQX8hCQwDCyAGIQsgCigCAAsiBigCAEEuRgRAIAYoAgRBKkcEQCAKIAZBBGo2AgAgChCDAiEFIAooAgAhBgwCCyAGKAIIQVBqQQpJBEAgCigCACIGKAIMQSRGBEAgBCAGQQhqIgUoAgBBUGpBAnRqQQo2AgAgAyAFKAIAQVBqQQN0aikDAKchBSAKIAZBEGoiBjYCAAwDCwsgAQRAQX8hCQwDCyAQBEAgAigCAEEDakF8cSIGKAIAIQUgAiAGQQRqNgIABUEAIQULIAogCigCAEEIaiIGNgIABUF/IQULC0EAIQcDQCAGKAIAQb9/aiIMQTlLBEBBfyEJDAILIAogBkEEaiIGNgIAIAdBOmxBruoAaiAMaiwAACIZQf8BcSIMQX9qQQhJBEAgDCEHDAELCyAZRQRAQX8hCQwBCyAPQX9KIRoCQAJAIBlBE0YEQCAaBEBBfyEJDAQFDAILAAUgGgRAIAQgD0ECdGogDDYCACAIIAMgD0EDdGopAwA3AwAMAgsgEEUEQEEAIQkMBAsgCCAMIAIQsQEgCigCACEGCwwBCyAQRQRAQQAhBQwDCwsgBkF8aigCACIMQV9xIQYCQAJAAkACQAJAAkACQAJAIAdBAEcgDEEPcUEDRnEEfyAGBSAMIgYLQcMAaw4xAgYGBgYGBgYGBgYGBgYGBgMGBgYGBgYGBgYGBgYGBgYBBgYGBgYGBgYGBAAGBgYGBQYLAkACQAJAAkACQAJAAkACQCAHQf8BcUEYdEEYdQ4IAAECAwQHBQYHCyAIKAIAIAk2AgBBACEFDA8LIAgoAgAgCTYCAEEAIQUMDgsgCCgCACAJrDcDAEEAIQUMDQsgCCgCACAJOwEAQQAhBQwMCyAIKAIAIAk6AABBACEFDAsLIAgoAgAgCTYCAEEAIQUMCgsgCCgCACAJrDcDAEEAIQUMCQtBACEFDAgLIAgpAwCnELcDIAAQrAEaQQEhBQwHCyAIKQMApyAAEKwBGkEBIQUMBgsgCCgCACIHQQAgBRCzAyIGIAdrQQJ1IQwgDSAGBH8gDAUgBQsiBkgEfyAGBSANCyEFIAtBgMAAcQRAIAAgByAGEMUBIBUgBSAGazYCACAVQYyLBDYCBCAAQf7tACAVEJABGgUgFiAFIAZrNgIAIBZBjIsENgIEIABB/u0AIBYQkAEaIAAgByAGEMUBCwwFCyAIQYi8AygCABCSAiIHNgIADAILIAgoAgAhBwwBCyAGQSByIgdBsu0AaiwAACEMIA4gC0EDdkEBcUEBc0GJ7gBqNgIAIA4gC0ELdkEBcUEBc0GL7gBqNgIEIA4gC0ENdkEBcUEBc0GN7gBqNgIIIA4gC0EBcUEBc0GP7gBqNgIMIA4gC0EQdkEBcUEBc0GR7gBqNgIQIA4gDDYCFCAOIAY2AhggF0EQQavuACAOEMEDGgJAAkACQCAHQeEAaw4YAAICAQAAAAIBAgICAgIBAQICAgIBAgIBAgsgCCsDACEcIBIgDTYCACASIAU2AgQgEiAcOQMIIAAgFyASEJABIQUMBAsgCCkDACEbIBEgDTYCACARIAU2AgQgESAbNwMIIAAgFyAREJABIQUMAwtBACEFDAILIAdFBEAgCEGC7gA2AgBBgu4AIQcLAkAgBUH/////B0kEfyAFBUH/////BwsiDEEASgRAIAchBUEAIQYDQCAYIAVBBBDMASIPQQBKBEAgBSAPaiEFIAZBAWoiBiAMSA0BIAYhBQwDCwsgD0EASARAQX8hCQwDBSAGIQULBUEAIQULCyANIAVIBH8gBQUgDQshBiALQYDAAHFBAEciDUUEQCAUIAYgBWs2AgAgFEGMiwQ2AgQgAEH+7QAgFBCQARoLIAUEQCAFIQsDQCAHIBggB0EEEMwBaiEHIBgoAgAgABCsARogC0F/aiILDQALCyANBEAgEyAGIAVrNgIAIBNBjIsENgIEIABB/u0AIBMQkAEaCyAGIQUMAQsLDAELIABFBEAgAQRAQQEhAANAIAQgAEECdGooAgAiAQRAIAMgAEEDdGogASACELEBIABBAWohASAAQQlIBEAgASEADAIFIAEhAAsLCyAAQQpIBEADQCAEIABBAnRqKAIABEBBfyEJDAULIABBAWohASAAQQlIBEAgASEADAEFQQEhCQsLBUEBIQkLBUEAIQkLCwsgCCQEIAkLcAEBfyAAKAJMGiABBEAgAEH4AGoiAigCAEUEQCACQawjKAIAKAIABH9BjB4FQbC7Aws2AgALIABBygBqIgAsAAAiAgRAIAIhAQUgACABQQBKBH9BAQVBfwsiAToAAAsFIAAsAEohAQsgAUEYdEEYdQsTACAAIAAQWUECdGogARBqGiAACyEBAn8gABBuQQFqIgEQbCICBH8gAiAAIAEQUwVBAAsiAAsXAEEAIAAgASACBH8gAgVBpLwDCxCKAgtCAQN/IAIEQCABIQMgACEBA0AgA0EEaiEEIAFBBGohBSABIAMoAgA2AgAgAkF/aiICBEAgBCEDIAUhAQwBCwsLIAAL7AIBBX8jBCEGIwRBEGokBCADBH8gAwVBoLwDCyIEKAIAIQMCfwJAIAEEfyAABH8gAAUgBgshBSACBEACQAJAIAMEQCADIQAgAiEDDAEFIAEsAAAiAEF/SgRAIAUgAEH/AXE2AgAgAEEARwwHCyABLAAAIQBBrCMoAgAoAgBFBEAgBSAAQf+/A3E2AgBBAQwHCyAAQf8BcUG+fmoiAEEySw0FIAFBAWohASAAQQJ0QaQeaigCACEAIAJBf2oiAw0BCwwBCyABLAAAIgdB/wFxQQN2IghBcGogCCAAQRp1anJBB0sNAwNAAkAgA0F/aiEDIAdB/wFxQYB/aiAAQQZ0ciIAQQBODQAgA0UNAiABQQFqIgEsAAAiB0HAAXFBgAFGDQEMBQsLIARBADYCACAFIAA2AgAgAiADawwECyAEIAA2AgALQX4FIAMNAUEACwwBCyAEQQA2AgBBiLwDQdQANgIAQX8LIQAgBiQEIAALQAAgAQRAIABBAnRB8LsDaiAAIAEQxQMiADYCAAUgAEECdEHwuwNqKAIAIQALIABBCGohASAABH8gAQVBrOoACwtrAQJ/IABBygBqIgIsAAAhASACIAFB/wFqIAFyOgAAIAAoAgAiAUEIcQR/IAAgAUEgcjYCAEF/BSAAQQA2AgggAEEANgIEIAAgACgCLCIBNgIcIAAgATYCFCAAIAEgACgCMGo2AhBBAAsiAAvtAQEEfwJAAkAgAkEQaiIEKAIAIgMNACACEIwCBEBBACECBSAEKAIAIQMMAQsMAQsgAyACQRRqIgUoAgAiBGsgAUkEQCACIAAgASACKAIkQR9xQcoAahEBACECDAELAkAgAiwAS0F/SgRAIAEhAwNAIANFBEBBACEDDAMLIAAgA0F/aiIGaiwAAEEKRwRAIAYhAwwBCwsgAiAAIAMgAigCJEEfcUHKAGoRAQAiAiADSQ0CIAAgA2ohACABIANrIQEgBSgCACEEBUEAIQMLCyAEIAAgARBTGiAFIAUoAgAgAWo2AgAgAyABaiECCyACC5kBAgF/An4CQAJAAkAgAL0iA0I0iCIEp0H/D3EiAgRAIAJB/w9GBEAMBAUMAwsACyABIABEAAAAAAAAAABiBH8gAEQAAAAAAADwQ6IgARCOAiEAIAEoAgBBQGoFQQALIgI2AgAMAgALAAALIAEgBKdB/w9xQYJ4ajYCACADQv////////+HgH+DQoCAgICAgIDwP4S/IQALIAALSAECfyAAKAIALAAAQVBqQQpJBEADQCACQQpsQVBqIAAoAgAiASwAAGohAiAAIAFBAWoiATYCACABLAAAQVBqQQpJDQALCyACC3QBAn8gAgR/AkAgACwAACIDBEAgACEEIAMhAANAIABBGHRBGHUgASwAACIDRiACQX9qIgJBAEcgA0EAR3FxRQ0CIAFBAWohASAEQQFqIgQsAAAiAA0AQQAhAAsFQQAhAAsLIABB/wFxIAEtAABrBUEACyIAC/sBAQN/AkAgAUH/AXEiAgRAIABBA3EEQCABQf8BcSEDA0AgACwAACIERSAEIANBGHRBGHVGcg0DIABBAWoiAEEDcQ0ACwsgAkGBgoQIbCEDAkAgACgCACICQYCBgoR4cUGAgYKEeHMgAkH//ft3anFFBEADQCACIANzIgJBgIGChHhxQYCBgoR4cyACQf/9+3dqcQ0CIABBBGoiACgCACICQYCBgoR4cUGAgYKEeHMgAkH//ft3anFFDQALCwsgAUH/AXEhAgNAIABBAWohASAALAAAIgNFIAMgAkEYdEEYdUZyRQRAIAEhAAwBCwsFIAAgABBuaiEACwsgAAsNACAAQawjKAIAEMcDC6QDAQZ/IAFBAXRBf2ohAyABQX9qIQQCQCAAQYCwfWpBgK4BSSAAQYCkf2pBwPABSSAAQYB0akGAFEkgABDIA0VycnJFBEAgAUEARyICIABB4F5qQS5JcQRAIABBxSFKBEACQAJAAkAgAEHHIWsOBwABAQEBAQABCwwBCwwECwsgAEHgOGohAAwCCyAAQYCmf2pBJkkgAkEBc3EEQCAAQaBHaiEADAIFQQAhAgsCQAJAA0AgACACQQJ0Qdwqai8BAGsiBSAEIAJBAnRB3ipqLAAAIgYiB3FrIAJBAnRB3ypqLQAASQ0BIAJBAWoiAkE9Rw0ACwwBCyAGQQFGBEAgASAAaiAFQQFxayEABSADIAdsIABqIQALDAILAkBBASABayIEQQF0QfQmai4BACICBEBBACEDA0AgAkH//wNxIABHBEAgA0EBaiIDQQJ0QfQmaiAEQQF0ai4BACICRQ0DDAELCyADQQJ0QfQmaiABQQF0ai8BACEADAMLCyAAQVhqIAFB0ABsaiECIABB2Pd7aiABQShsakEoSQR/IAIFIAALDwsLIAALOwEBfyMEIQEjBEEQaiQEIAEgADYCAEE8IAEQJyIAQYBgSwRAQYi8A0EAIABrNgIAQX8hAAsgASQEIAALywwBBn8CQCAAIAFqIQUCQCAAKAIEIgNBAXFFBEAgACgCACECIANBA3FFBEAPCyACIAFqIQFB1LcDKAIAIAAgAmsiAEYEQCAFQQRqIgIoAgAiA0EDcUEDRw0CQci3AyABNgIAIAIgA0F+cTYCACAAIAFBAXI2AgQgBSABNgIADwsgAkEDdiEEIAJBgAJJBEAgACgCDCICIAAoAggiA0YEQEHAtwNBwLcDKAIAQQEgBHRBf3NxNgIABSADIAI2AgwgAiADNgIICwwCCyAAKAIYIQcCQCAAKAIMIgIgAEYEQCAAQRBqIgNBBGoiBCgCACICBEAgBCEDBSADKAIAIgJFBEBBACECDAMLCwNAIAJBFGoiBCgCACIGBEAgBiECIAQhAwwBCyACQRBqIgQoAgAiBgRAIAYhAiAEIQMMAQsLIANBADYCAAUgACgCCCIDIAI2AgwgAiADNgIICwsgBwRAIAAoAhwiA0ECdEHwuQNqIgQoAgAgAEYEQCAEIAI2AgAgAkUEQEHEtwNBxLcDKAIAQQEgA3RBf3NxNgIADAQLBSAHQRBqIAcoAhAgAEdBAnRqIAI2AgAgAkUNAwsgAiAHNgIYIABBEGoiBCgCACIDBEAgAiADNgIQIAMgAjYCGAsgBCgCBCIDBEAgAiADNgIUIAMgAjYCGAsLCwsgBUEEaiIDKAIAIgJBAnEEQCADIAJBfnE2AgAgACABQQFyNgIEIAAgAWogATYCACABIQIFQdi3AygCACAFRgRAQcy3A0HMtwMoAgAgAWoiATYCAEHYtwMgADYCACAAIAFBAXI2AgQgAEHUtwMoAgBHBEAPC0HUtwNBADYCAEHItwNBADYCAA8LQdS3AygCACAFRgRAQci3A0HItwMoAgAgAWoiATYCAEHUtwMgADYCACAAIAFBAXI2AgQgACABaiABNgIADwsgAkF4cSABaiEGIAJBA3YhAwJAIAJBgAJJBEAgBSgCDCIBIAUoAggiAkYEQEHAtwNBwLcDKAIAQQEgA3RBf3NxNgIABSACIAE2AgwgASACNgIICwUgBSgCGCEHAkAgBSgCDCIBIAVGBEAgBUEQaiICQQRqIgMoAgAiAQRAIAMhAgUgAigCACIBRQRAQQAhAQwDCwsDQCABQRRqIgMoAgAiBARAIAQhASADIQIMAQsgAUEQaiIDKAIAIgQEQCAEIQEgAyECDAELCyACQQA2AgAFIAUoAggiAiABNgIMIAEgAjYCCAsLIAcEQCAFKAIcIgJBAnRB8LkDaiIDKAIAIAVGBEAgAyABNgIAIAFFBEBBxLcDQcS3AygCAEEBIAJ0QX9zcTYCAAwECwUgB0EQaiAHKAIQIAVHQQJ0aiABNgIAIAFFDQMLIAEgBzYCGCAFQRBqIgMoAgAiAgRAIAEgAjYCECACIAE2AhgLIAMoAgQiAgRAIAEgAjYCFCACIAE2AhgLCwsLIAAgBkEBcjYCBCAAIAZqIAY2AgAgAEHUtwMoAgBGBEBByLcDIAY2AgAPBSAGIQILCyACQQN2IQMgAkGAAkkEQCADQQN0Qei3A2ohAUHAtwMoAgAiAkEBIAN0IgNxBH8gAUEIaiIDKAIABUHAtwMgAiADcjYCACABQQhqIQMgAQshAiADIAA2AgAgAiAANgIMIAAgAjYCCCAAIAE2AgwPCyACQQh2IgEEfyACQf///wdLBH9BHwUgAkEOIAEgAUGA/j9qQRB2QQhxIgF0IgNBgOAfakEQdkEEcSIEIAFyIAMgBHQiAUGAgA9qQRB2QQJxIgNyayABIAN0QQ92aiIBQQdqdkEBcSABQQF0cgsFQQALIgNBAnRB8LkDaiEBIAAgAzYCHCAAQQA2AhQgAEEANgIQQcS3AygCACIEQQEgA3QiBnFFBEBBxLcDIAQgBnI2AgAgASAANgIADAELIAEoAgAhAUEZIANBAXZrIQQgAiADQR9GBH9BAAUgBAt0IQMCQANAIAEoAgRBeHEgAkYNASADQQF0IQQgAUEQaiADQR92QQJ0aiIDKAIAIgYEQCAEIQMgBiEBDAELCyADIAA2AgAMAQsgAUEIaiICKAIAIgMgADYCDCACIAA2AgAgACADNgIIIAAgATYCDCAAQQA2AhgPCyAAIAE2AhggACAANgIMIAAgADYCCAsEAEEAC1oBAX8jBCECIwRBgBBqJAQgASACQYAQEGkaIABBBGoiAyABED82AgAgAEEBOgASIABBADYCDCAAQQA6ABAgAEEYaiABQYAQEG8aIAMoAgBBAEchACACJAQgAAuHAQECfyMEIQIjBEGAEGokBCAAQZjAAGoiA0EANgIAIAEgAkGAEBBpGiABEEAiBEUEQEGIvAMoAgBBAkYEQCADQQE2AgALCyAAQQA6ABIgAEEANgIMIABBADoAECAEQQBHIgNFBEAgAiQEIAMPCyAAIAQ2AgQgAEEYaiABQYAQEG8aIAIkBCADC4sBAQF/IwQhAyMEQRBqJAQgAyACENUBIAEgACgCAGoiAEELaiIBLAAAQQBIBEAgACgCAEEANgIAIABBADYCBAUgAEEANgIAIAFBADoAAAtBACQFQRYgAEEAEA0jBSEBQQAkBSABQQFxBEBBABAYIgAQWgUgACADKQIANwIAIAAgAygCCDYCCCADJAQLC2ABA38gASAAKAIAaiIBLAALIgJBAEghAyABKAIEIQAgAkH/AXEhAiADBH8gAAUgAiIAC0ECdEEEahBsIgIgADYCACABKAIAIQQgAkEEaiADBH8gBAUgAQsgABCJAhogAgskAQF/IAEgACgCAGoiAyACKAIANgIAIANBBGogAkEEahClAxoLTgAgASAAKAIAaiEBQRAQXyIAIAEoAgA2AgBBACQFQRUgAEEEaiABQQRqEA0jBSEBQQAkBSABQQFxBEAQFyEBIAAQUiABEB4FIAAPC0EACzgBAX8gAEUEQA8LIAAsABtBAEgEQCAAKAIQEFILIABBBGoiASwAC0EASARAIAEoAgAQUgsgABBSCygBAX8gAkUEQCAADwsgACABIAJBf2oiAxDGARogACADakEAOgAAIAALDQAgAEEHcUECahEFAAv2AwEHfyMEIQYjBEGQwAFqJAQgAkEAEK8BIQcgBkGIgAFqIghBADYCACAAQQA2AhAgACAGQYjAAGoiBUGAEBDaAUUEQCAGJARBAA8LIAZBBGohCiAGQQhqIQsgAQRAA0ACfyAFEM8BIgEoAgBBL0YEQCABQQA2AgALAkACQCADRQ0AIAUoAgBBL0cNACAIKAIARQRAIAIgCEGAEBD3AQsgBSAIIAQQpQEEQEEBIQFBGwwDCwwBCyAFQQAQrwEiCSgCAEEqRgR/IAkoAgRBL0YEfyAGQS42AgAgCkEvNgIAIAsgB0GAEBBvGiAGBSAHCwUgBwshASAJIAEgBBClAQRAQQEhAUEbDAILCyAAIAVBgBAQ2gENAUEAIQFBGwshAAsFA0ACfyAFEM8BKAIAQS9GBEAgBUGIHUGAEBB4GgsCQAJAIANFDQAgBSgCAEEvRw0AIAgoAgBFBEAgAiAIQYAQEPcBCyAFIAggBBClAQRAQQEhAUEbDAMLDAELIAVBABCvASIJKAIAQSpGBH8gCSgCBEEvRgR/IAZBLjYCACAKQS82AgAgCyAHQYAQEG8aIAYFIAcLBSAHCyEBIAkgASAEEKUBBEBBASEBQRsMAgsLIAAgBUGAEBDaAQ0BQQAhAUEbCyEACwsgAEEbRgRAIAYkBCABDwtBAAs4AQJ/IABBEGoiAigCACIBIAAoAgRPBEBBAA8LIAIgAUEBaiAAKAIAIAFBAnRqIgAQWWo2AgAgAAuMBwEGfyAAQQRqIgVBARDkASAAQaiWAWoiBkEAQYACEFQaIABB0MYDaiIDQQA2AgAgAEGIvgJqQQA2AgAgAEGQvgJqQQA2AgAgAEGMvgJqQQA2AgAgAEEUaiICQgA3AgAgAkIANwIIIAJCADcCECACQgA3AhggAkIANwIgIAJCADcCKEEAJAVBJCAAQdDMA2oiBxAMIwUhBEEAJAUCQCAEQQFxBEAQFyEBBUEAJAVBESAAQYjNA2pBARANIwUhBEEAJAUgBEEBcQRAEBchASAHELICDAILIABBmM0DaiICQgA3AgAgAkIANwIIIAJCADcCECACQgA3AhggAkIANwIgIAJCADcCKCAAIAE2AgAgAEGomAFqQQA6AAAgAEG4mAFqQQA6AAAgAEG5mAFqQQA6AAAgAEG6mAFqQQA6AAAgAEHMzQNqQQA2AgAgAEHQzQNqQQA2AgAgAEEANgI4IABBADYCCCAAQQA2AgQgAEHAmAFqQgA3AwAgAEHEAGpBAEHklQEQVBogAEF/NgJwIABBwK4CakEANgIAIABBxK4CakEANgIAIABBuK4CakEANgIAIABBvK4CakEBNgIAIABByK4CakEAQfACEFQaIABBhK8BakEAQbT/ABBUGiAAQczMA2pBADoAACAAQbTJA2pBAEGUAxBUGiAAQbDJA2pBAjYCACAAQcjMA2pBADYCACAAQQAQgwEgAEHUrgFqIgFCADcCACABQgA3AgggAUIANwIQIABB0K4BakGA6gA2AgAgAEGArwFqQYHAADYCACAAQfyuAWpBgAE2AgAgAEH4rgFqQYABNgIAIABB9K4BakEANgIAIABBzK4BakEANgIAIABB7K4BakEANgIAIABB8K4BakEANgIAIABBADYCaEEAIQEDQCAAQcqgAWogAUEBdGogAUEIdEH//wNxIgI7AQAgAEHKmAFqIAFBAXRqIAI7AQAgAEHKnAFqIAFBAXRqIAE7AQAgAEHKpAFqIAFBAXRqQQAgAWtBCHQ7AQAgAUEBaiIBQYACRw0ACyAAQcqoAWpBAEGABhBUGkEAIABByqABaiAAQcqqAWoQnwEPCwsgAygCAARAIANBADYCACAAQfzHA2ooAgAQUgsgBhDYASAAKAI0IgMEQCADEFILIAAoAiQiAARAIAAQUgsgAigCACIARQRAIAUQmAEgARAeCyAAEFIgBRCYASABEB4Lmw0BE38jBCEIIwRB0ANqJAQgAiwAEUUEQCAIJARBAQ8LIAFBCGoiECwAAEUEQCABKAIAIABB6ABqIgYoAgAiBEFnakoEQCAEIABBBGoiBygCACIFayICQQBIBEAgCCQEQQAPCyAAQfAAaiIKIABB+ABqIgsoAgAgBWsgCigCAGo2AgAgBUGAgAFKBEAgAkEASgRAIAAoAhAiBCAEIAVqIAIQXRoLIAdBADYCACAGIAI2AgAFIAQhAgsgAkGAgAJGBEBBACECQYCAAiEEBSAAKAIAIAAoAhAgAmpBgIACIAJrEF4hAiAGKAIAIgUgAmohBCACQQBKBEAgBiAENgIABSAFIQQLCyAAQewAaiIGIARBYmoiBDYCACALIAcoAgAiBTYCACAFQX9qIAooAgAiB2ohBSAHQX9HBEAgBiAEIAVIBH8gBAUgBQs2AgALIAJBf0YEQCAIJARBAA8LCwsgCEGwA2ohB0EAIQIDQCABEFhBDHYhBCABQQQQVQJAAkAgBEH/AXFBD0YEQCABEFhBDHZB/wFxIQUgAUEEEFUgBQRAIAVBAmohBCAHIAJqQQBBAEF+IAVrIgUgAkFsaiIGSwR/IAUFIAYLaxBUGgNAIARBf2ohBSAEQQFKIAJBAWoiBkEUSXEEQCAFIQQgBiECDAELCwVBDyEEDAILBSAEQf8BcSEEDAELDAELIAcgAmogBDoAAAsgAkEBaiICQRRJDQALQQAgByADQbD3AGoiEUEUEGggAEHoAGohByAAQQRqIQogAEH4AGohDSAAQfAAaiELIABBEGohDiAAQewAaiEPIAFBDGohEiABQQRqIQwgA0G0+ABqIRMgCEF/aiEUQQAhAgJAAkADQAJAIAJBrgNIIRUgAkEASiEWAkACQAJAA0AgECwAAEUhBCAVRQ0GIAQEQCABKAIAIAcoAgAiBUF7akoEQCAFIAooAgAiBmsiBEEASA0GIAsgDSgCACAGayALKAIAajYCACAGQYCAAUoEQCAEQQBKBEAgDigCACIFIAUgBmogBBBdGgsgCkEANgIAIAcgBDYCAAUgBSEECyAEQYCAAkYEQEEAIQRBgIACIQUFIAAoAgAgDigCACAEakGAgAIgBGsQXiEEIAcoAgAiBiAEaiEFIARBAEoEQCAHIAU2AgAFIAYhBQsLIA8gBUFiaiIFNgIAIA0gCigCACIGNgIAIAZBf2ogCygCACIJaiEGIAlBf0cEQCAPIAUgBkgEfyAFBSAGCzYCAAsgBEF/Rg0GCwsgEigCACIEIAEoAgAiBUEBamotAABBCHQgBCAFai0AAEEQdHIgBCAFQQJqai0AAHJBCCAMKAIAIglrdkH+/wNxIgYgA0G09wBqIBMoAgAiBEECdGooAgBJBH8gASAJIANBuPgAaiAGQRAgBGt2IgRqLQAAaiIGQQN2IAVqNgIAIAwgBkEHcTYCACADQbiAAWogBEEBdGoFA0ACQCAEQQFqIgRBD08EQEEPIQQMAQsgBiADQbT3AGogBEECdGooAgBPDQELCyABIAQgCWoiCUEDdiAFajYCACAMIAlBB3E2AgAgA0G4kAFqIAYgAyAEQQJ0akGw9wBqKAIAa0EQIARrdiADQfT3AGogBEECdGooAgBqIgQgESgCAE8Ef0EABSAEC0EBdGoLIgQuAQAiBEH//wNxQRBIDQEgBEH//wNxQRJODQMgARBYIQUgBEEQRgR/IAFBAxBVIAVBDXZBA2oFIAFBBxBVIAVBCXZBC2oLIQUgFkUNAAwCCwALIAggAmogBDoAACACQQFqIQIMAwsgFCACaiwAACEJIAIhBANAIAVBf2ohBiAIIARqIAk6AAAgBEEBaiECIARBrQNIIAVBAUpxRQ0DIAYhBSACIQQMAAsACyABEFghBSAEQRJGBH8gAUEDEFUgBUENdkEDagUgAUEHEFUgBUEJdkELagshBCAIIAJqQQBBACACQX9qIAJBrQNKBH8gAgVBrQMLayIFQX4gBGsgBEF/cyIGQX5KBH8gBgVBfgtrIgZLBH8gBQUgBgtrEFQaIAIhBQNAIARBf2ohBiAFQQFqIQIgBUGtA0ggBEEBSnFFDQIgBiEEIAIhBQwACwALQQAhAAsMAQsgBARAIAEoAgAgBygCAEoEQEEAIQAMAgsLQQAgCCADQbICEGhBACAIQbICaiADQewdakHAABBoQQAgCEHyAmogA0HYO2pBEBBoQQAgCEGCA2ogA0HE2QBqQSwQaEEBIQALIAgkBCAAC+cEAQl/IAJBDGoiCUEANgIAIAEsAAhFBEAgASgCACAAQegAaiIGKAIAIgRBeWpKBEAgBCAAQQRqIgcoAgAiBWsiA0EASARAQQAPCyAAQfAAaiIIIABB+ABqIgooAgAgBWsgCCgCAGo2AgAgBUGAgAFKBEAgA0EASgRAIAAoAhAiBCAEIAVqIAMQXRoLIAdBADYCACAGIAM2AgAFIAQhAwsgA0GAgAJGBEBBACEDQYCAAiEEBSAAKAIAIAAoAhAgA2pBgIACIANrEF4hAyAGKAIAIgUgA2ohBCADQQBKBEAgBiAENgIABSAFIQQLCyAAQewAaiIGIARBYmoiBDYCACAKIAcoAgAiBTYCACAFQX9qIAgoAgAiB2ohBSAHQX9HBEAgBiAEIAVIBH8gBAUgBQs2AgALIANBf0YEQEEADwsLCyABQQAgAUEEaiIHKAIAa0EHcRBVIAEQWCEGIAFBCBBVIAZBC3ZBA3EiCEEDRgRAQQAPCyAJIAhBA2o2AgAgAiAGQQh2IgpBB3FBAWo2AgQgARBYIQsgAUEIEFVBACEEQQAhAwNAIAEQWEEIdiAEQQN0dCADaiEDIAEgBygCAEEIaiIFQQN2IAEoAgBqIgk2AgAgByAFQQdxNgIAIARBAWohBSAEIAhHBEAgBSEEDAELCyACIAM2AgAgCkHaAHMgC0EIdnMgA3MgA0EIdnMgA0EQdnNB/wFxBEBBAA8LIAIgCTYCCCAAQewAaiIBKAIAIQAgASAAIAlBf2ogA2oiAUgEfyAABSABCzYCACACIAZBDnZBAXE6ABAgAiAGQQ92QQFxOgARQQELsBABHH8CQCMEIQIjBEEgaiQEIAJBGGohFiACQRBqIRcgAkEIaiEYIAIhESAAQeQAaiIZKAIAIQEgAEHQzQNqIRMgAEHgAGoiFCgCACEDAkAgAEGszQNqIhIoAgAiDwRAIABBqM0DaiEMIABBzM0DaiEbIABB0MwDaiENIABBpJYBaiEVIABBmM0DaiEaIABBupgBaiEcIABBwJgBaiEOIAMgAWsgEygCACIEcSEFQQAhAgNAAkACQCAMKAIAIAJBAnRqKAIAIgcEQCAHQQxqIgssAAAEQCALQQA6AAAMAgsgBygCBCEIIAQgBygCACILIAFrcSAFSQRAIAsgAUcEQCAAIAEgCxCzASALIQEgFCgCACALayATKAIAIgRxIQULIAggBUsNAyAEIAggC2pxIg9Bf2ogC0kEQCANQQAgFSgCACALaiAbKAIAIAtrIgEQtgEgDSABIBUoAgAgDxC2AQUgDUEAIBUoAgAgC2ogCBC2AQsgGigCACAHKAIQQQJ0aigCACIJQSxqIQUgCUEwaiIIKAIAIgFBwABLBH8gB0EsaiEGIAdBNGoiCigCACEEIAdBMGoiAyABNgIAIAQgAUkEQCAHKAI4IhBBAEcgASAQS3EEQCARIBA2AgBBrPUCQdgbIBEQYEGs9QIQViAKKAIAIQQgAygCACEBCyAGKAIAIAEgBEEgaiAEQQJ2aiIESwR/IAEFIAQiAQsQVyIERQRAQaz1AhBWCyAGIAQ2AgAgCiABNgIACyAGKAIAQUBrIAUoAgBBQGsgCCgCAEFAahBTGiADBSAHQTBqCyEEIAdBFGohAQJAAkAgBCgCAEUNACAHIA4pAwCnIgM2AmQgB0EsaiIGKAIAQSRqIgogAzoAACAKIANBCHY6AAEgCiADQRB2OgACIAogA0EYdjoAAyAGKAIAQShqIgMgDikDAEIgiKciBjoAACADIAZBCHY6AAEgAyAGQRB2OgACIAMgBkEYdjoAAyANIAEQsQIgBCgCACIBQcAATQ0AIAgoAgAgAUkEQCAJQTRqIgYoAgAhAyAIIAE2AgAgAyABSQRAIAkoAjgiCUEARyABIAlLcQRAIBggCTYCAEGs9QJB2BsgGBBgQaz1AhBWIAYoAgAhAyAIKAIAIQELIAUoAgAgASADQSBqIANBAnZqIgNLBH8gAQUgAyIBCxBXIgNFBEBBrPUCEFYLIAUgAzYCACAGIAE2AgALCyAFKAIAQUBrIAcoAixBQGsgBCgCAEFAahBTGgwBCyAFKAIAIgEEQCABEFIgBUEANgIACyAIQQA2AgAgCUEANgI0CyAHKAJoIQQgBygCbCEBIAwoAgAiAyACQQJ0aigCACIFBEAgBSgCPCIDBEAgAxBSCyAFKAIsIgMEQCADEFILIAUoAhQiAwRAIAMQUgsgBRBSIAwoAgAhAwsgAyACQQJ0akEANgIAAkAgAkEBaiIDIBIoAgBJBEADQCAMKAIAIANBAnRqKAIAIgVFDQIgBSgCACALRw0CIAUoAgQgAUcNAiAFLAAMDQIgDUEAIAQgARC2ASAaKAIAIAUoAhBBAnRqKAIAIglBLGohByAJQTBqIggoAgAiAkHAAEsEfyAFQSxqIQYgBUE0aiIKKAIAIQEgBUEwaiIEIAI2AgAgASACSQRAIAUoAjgiEEEARyACIBBLcQRAIBcgEDYCAEGs9QJB2BsgFxBgQaz1AhBWIAooAgAhASAEKAIAIQILIAYoAgAgAiABQSBqIAFBAnZqIgFLBH8gAgUgASICCxBXIgFFBEBBrPUCEFYLIAYgATYCACAKIAI2AgALIAYoAgBBQGsgBygCAEFAayAIKAIAQUBqEFMaIAQFIAVBMGoLIQEgBUEUaiECAkACQCABKAIARQ0AIAUgDikDAKciBDYCZCAFQSxqIgYoAgBBJGoiCiAEOgAAIAogBEEIdjoAASAKIARBEHY6AAIgCiAEQRh2OgADIAYoAgBBKGoiBCAOKQMAQiCIpyIGOgAAIAQgBkEIdjoAASAEIAZBEHY6AAIgBCAGQRh2OgADIA0gAhCxAiABKAIAIgJBwABNDQACQCAIKAIAIAJJBEAgCUE0aiIGKAIAIQQgCCACNgIAIAQgAk8NASAJKAI4IglBAEcgAiAJS3EEQCAWIAk2AgBBrPUCQdgbIBYQYEGs9QIQViAGKAIAIQQgCCgCACECCyAHKAIAIAIgBEEgaiAEQQJ2aiIESwR/IAIFIAQiAgsQVyIERQRAQaz1AhBWCyAHIAQ2AgAgBiACNgIACwsgBygCAEFAayAFKAIsQUBrIAEoAgBBQGoQUxoMAQsgBygCACICBEAgAhBSIAdBADYCAAsgCEEANgIAIAlBADYCNAsgBSgCaCEEIAUoAmwhASAMKAIAIgIgA0ECdGooAgAiBQRAIAUoAjwiAgRAIAIQUgsgBSgCLCICBEAgAhBSCyAFKAIUIgIEQCACEFILIAUQUiAMKAIAIQILIAIgA0ECdGpBADYCACADQQFqIgUgEigCAEkEQCADIQIgBSEDDAEFIAMhAgsLCwsgACgCACAEIAEQZSAcQQE6AAAgDiAOKQMAIAGtfDcDACAUKAIAIgMgDyIBayATKAIAIgRxIQUgEigCACEPCwsLIAJBAWoiAiAPSQ0BDAMLCyACIBIoAgAiAE8NAiAMKAIAIQQDQCAEIAJBAnRqKAIAIgMEQCADQQxqIgMsAAAEQCADQQA6AAALCyACQQFqIgIgAEkNAAsMAgsLIAAgASADELMBIBkgFCgCADYCACARJAQPCyAZIAE2AgAgESQEC5oCAQd/IwQhAiMEQRBqJAQgAEEEaiIEKAIAIgVBAWogAQR/IAEFQby1AwsiBhBZaiEBIAQgATYCACABIABBCGoiBygCACIITQRAIAAoAgAgBUECdGogBhBqGiAAQRRqIgAoAgBBAWohASAAIAE2AgAgAiQEDwsgAiEDIAAoAgwiAkEARyABIAJLcQR/IAMgAjYCAEGs9QJB2BsgAxBgQaz1AhBWIAQoAgAhASAHKAIABSAICyECIAAoAgAgASACQSBqIAJBAnZqIgJLBH8gAQUgAiIBC0ECdBBXIgJFBEBBrPUCEFYLIAAgAjYCACAHIAE2AgAgAiAFQQJ0aiAGEGoaIABBFGoiACgCAEEBaiEBIAAgATYCACADJAQL5AsBC38gAEHorgFqQQA2AgAgAEH8rgFqIgIoAgBBEGohASACIAE2AgAgAUH/AUsEQCACQZABNgIAIABB+K4BaiIBIAEoAgBBAXY2AgALIABB3K4BaiIEKAIAIQogAEEEaiIGEFghBQJAIAQoAgAiAUH5AEsEf0GAwAIgBUHw/wNxIgVLBH8gBkEDEFVBAyEBQQAFQQMhAQNAIAFBAWohASADQQFqIgJBAnRB9BRqKAIAIAVNBEAgAiEDDAELCyAGIAEQVSADQQJ0QfQUaigCAAshAiAFIAJrQRAgAWt2IAFBAnRBnBVqKAIAagUgAUE/TQRAIAVBgAJJBEAgBkEQEFUMAwVBACEBCwNAIAFBAWohAkGAgAIgAXYgBXFFBEAgAiEBDAELCyAGIAIQVSABIQUMAgtBgIACIAVB8P8DcSIFSwR/IAZBAhBVQQIhAUEABUECIQEDQCABQQFqIQEgA0EBaiICQQJ0QdAVaigCACAFTQRAIAIhAwwBCwsgBiABEFUgA0ECdEHQFWooAgALIQIgBSACa0EQIAFrdiABQQJ0QfwVaigCAGoLIQULIAQgBCgCACAFaiIBIAFBBXZrNgIAIAYQWCECIABB1K4BaiIHKAIAIgFB/9EASwR/QYAgIAJB8P8DcSIESwR/IAZBBRBVQQUhAUEABUEFIQFBACEDA0AgAUEBaiEBIANBAWoiAkECdEGwFmooAgAgBE0EQCACIQMMAQsLIAYgARBVIANBAnRBsBZqKAIACyECIAQgAmtBECABa3YhAiABQQJ0QdAWagUgAkHw/wNxIQQgAUH/DUsEfyAEQYDAACAESwR/IAZBBRBVQQUhAUEABUEFIQFBACEDA0AgAUEBaiEBIANBAWoiAkECdEGEF2ooAgAgBE0EQCACIQMMAQsLIAYgARBVIANBAnRBhBdqKAIACyICa0EQIAFrdiECIAFBAnRBpBdqBSAEQYCAAiAESwR/IAZBBBBVQQQhAUEABUEEIQFBACEDA0AgAUEBaiEBIANBAWoiAkECdEHYF2ooAgAgBE0EQCACIQMMAQsLIAYgARBVIANBAnRB2BdqKAIACyICa0EQIAFrdiECIAFBAnRB/BdqCwshASAHIAcoAgAgASgCACACaiIJaiIBIAFBCHZrNgIAIABByqoBaiAAQcqgAWogCUH/AXFBAXRqIgsuAQAiBEH//wNxIgFB/wFxaiIDLAAAIQIgAyACQQFqOgAAIARBAWpBEHRBEHUiA0H/AXFFBEAgAEHKoAFqIQggAEHKqgFqIQcDQEEAIAggBxCfASAAQcqqAWogCy4BACIEQf//A3EiAUH/AXFqIgMsAAAhAiADIAJBAWo6AAAgBEEBakEQdEEQdSIDQf8BcUUNAAsLIABByqABaiAJQQF0aiAAQcqgAWogAkH/AXFBAXRqIgIuAQA7AQAgAiABQQFqOwEAIAYQWEEIdiADQYD+A3FyIgRBAXYhCCAGQQcQVSAAQeCuAWoiASgCACEHAkACQAJAAkACQCAFDgUBAAICAAILDAMLIAggAEGArwFqKAIASw0BIAEgB0EBaiIBIAFBCHZrNgIADAILCyAHBEAgASAHQX9qNgIACwsgCCAAQYCvAWoiAygCAEkEf0EDBUEECyAFaiICQQhqIQEgBEGCBE8EQCACIQELIAMCfwJAIAdBsAFLDQAgCkHAAEkgAEHQrgFqKAIAQf/TAEtxDQBBgcAADAELQYD+AQsiAjYCACAAQdQAaiIDKAIAIQIgAyACQQFqNgIAIABBxABqIAJBAnRqIAg2AgAgAyADKAIAQQNxNgIAIAAgATYCWCAAIAg2AlwgAEGwmAFqIgIgAikDACABrX03AwAgAUUEQA8LIABBpJYBaiEEIABB4ABqIgcoAgAhAyAAQdDNA2oiBSgCACECA0AgBCgCACIAIANqIAAgAyAIayACcWosAAA6AAAgByAHKAIAQQFqIAUoAgAiAnEiADYCACABQX9qIgEEQCAAIQMMAQsLC8QFAQx/IwQhCyMEQYACaiQEIAshCiAAQcgMaigCACEGIABB1AxqIgwoAgAiDSgCBCEOAkACQCABBEAgCiEBDAEFIApBBGohASAKIA02AgAgBigCDA0BIAYhAwsMAQsgBigCDCEGIAIEQCAGIQMgAiEIIAEhBEEIIQkFIAEhByAGIQULA0ACQCAJQQhGBEAgCCgCBCIBIA5HBEAgASEDIAQhAQwCCyAEQQRqIQEgBCAINgIAIAMoAgwiBUUNASABIQcLIAUuAQBBAUYEQCAFIQMgBUEEaiEIIAchBEEIIQkMAgsgBSgCCCIILAAAIAwoAgAsAAAiAUYEQCAFIQMgByEEQQghCQwCCwNAIAhBCGoiCCwAACABRgRAIAUhAyAHIQRBCCEJDAMFDAELAAsACwsgASAKRgRAIAskBCADDwsLIA4sAAAhCSADLgEAIgVBAUYEfyADLAAFBSAAQeCXAWooAgAgA08EQCALJARBAA8LIAMoAggiAiwAACAJRwRAA0AgAkEIaiICLAAAIAlHDQALCyACLQABIgRBf2oiB0EBdCICIAMvAQQgBUH//wNxa0EBIARraiIESwR/IAJBf2ogBEEDbGogBEEBdG4FIAdBBWwgBEsLIgJBAWpB/wFxCyECIA5BAWohBiAAQZCVAWohCCAAQcSWAWohDCAAQcCWAWohBSAAQciWAWohDSACQf8BcUEIdCAJQf8BcXIhBAJAA0AgAUF8aiICKAIAIQcCQAJAIAwoAgAiACAFKAIARgRAIA0oAgAiAARAIA0gACgCADYCAAUgCEEAEKABIQALIAANAQUgDCAAQXBqIgA2AgAMAQsMAQsgACEBIABBATsBACAAIAQ2AgQgACAGNgIIIAAgAzYCDCAHIAA2AgQLIABFBEBBACEADAILIAIgCkcEQCAAIQMgAiEBDAELCwsgCyQEIAAL+gIBAn8gAyAAQQhqIgUoAgBBmIABaiAEEG8aIAUoAgBBmIABaiIAKAIABEAgABDPASgCAEEvRwRAIAMgBBDIAQsLIAUoAgAiAEGQywNqLAAABEAgAyABQeS8A2oQmwEgBBB4GiADQQAgBBC6AyADIAQQyAEgBSgCACEACwJAIABBqIACahBZIgYEQCACIAYgAhBZIgFJBH8gBgUgAQtBAnRqIQIDQAJAAkACQAJAAkAgAigCAA4wAAICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIBAgsMAwsMAQsMBAsgAkEEaiECDAELCyADQQA2AgAPCwsCQAJAIABByMsEaigCACIBQdgARiAAQeCEA2ooAgBBBEZxBEBBACEBBSABQcUARgRAQQAhAQwCBUEAIQELCyAFKAIAQeCEA2ooAgBBAUYNACADIAIgBBB4GgwBCyADIAIQmwEgBBB4GgsgAygCABCTASEADwv4AQEDfyMEIQMjBEHwFmokBCADQSRqIQQgAyAAKAIAIgU2AgACQAJAAkACQCAFQQFrDgMAAQIDCyADIAAoAgQ2AgQMAgsgAyAAKAIEQX9zNgIEDAELIAQgACgCCBCmBCAEIANBBGoQqQQLIAIEQCADIAIQvwILIAMoAgAiAkUEQCADJARBAQ8LIAEoAgAiAEUEQCADJARBAQ8LIAJBAUYgAEEBRnFFBEAgAkECRiAAQQJGcUUEQCACQQNGIABBA0ZxRQRAIAMkBEEADwsgA0EEaiABQQRqQSAQa0UhACADJAQgAA8LCyADKAIEIAEoAgRGIQAgAyQEIAALcgEBfyAAKAIAIgNBAUYEQCAAQQRqIgMgAygCAEH//wNxIAEgAhDQBEH//wNxNgIAIAAoAgAhAwsgA0ECRgRAIABBBGoiAyADKAIAIAEgAhCZATYCACAAKAIAIQMLIANBA0cEQA8LIAAoAgggASACEKsEC74FAQJ/IABBCGoiBCgCACICRQRAQQBBzBYQXyICIgNrQT9xIANqIQMgAiADNgLwASACIANBgAFqNgL0ASACIANBoAFqNgL4ASACIANBqAFqNgL8ASACQQAgAkGIAmoiA2tBP3EgA2oiAzYC+AMgAiADQYABajYC/AMgAiADQaABajYCgAQgAiADQagBajYChAQgAkEAIAJBkARqIgNrQT9xIANqIgM2AoAGIAIgA0GAAWo2AoQGIAIgA0GgAWo2AogGIAIgA0GoAWo2AowGIAJBiAhqQQAgAkGYBmoiA2tBP3EgA2oiAzYCACACQYwIaiADQYABajYCACACQZAIaiADQaABajYCACAC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AUGg0ABqIAIEfyADBSAECzYAACABQZjQAGogAEHstwdqIgIoAgA2AABBACQFQQUgAEG4twdqEAUhAyMFIQRBACQFIARBAXFFBEAgAUGc0ABqIAM2AAAgAUGk0ABqIABBovcGai0AAEEwajYAACABQajQAGogAEGk9wZqKAIANgAAIAFBtNAAakEANgAAIAFBuNAAakEANgAAIAFBvNAAaiAAQey4B2ooAgBBCnY2AAACQAJAAkACQCAAQei3B2ooAgBBAWsOAwAAAQILIAFBwNAAakEBNgAADAILIAFBwNAAakECNgAAIAFBxNAAaiIDIAIpAAA3AAAgAyACKQAINwAIIAMgAikAEDcAECADIAIpABg3ABgMAQsgAUHA0ABqQQA2AAALIAFB5NAAaiAAQfi4B2ooAgAiAjYAACACBEAgAUHo0ABqKAAAIgIEQCABQezQAGooAAAiA0F/akGfjQZJBEBBACQFQRAgAiAAQfy4B2ogAxAHGiMFIQJBACQFIAJBAXENCQsLCyABQfDQAGogAEH8+AdqLQAANgAAQQAPCwsLCwsLC0GACBAYIQEjB0GACBBERwRAIAEQHgsgARAVIQECQCAAQajLBGooAgAiAEUEQAJAAkACQAJAAkACQAJAAkACQCABKAIADgwHCAABCAIDCAUECAYIC0ESIQAMCQtBDCEADAgLQRMhAAwHC0EPIQAMBgtBECEADAULQQshAAwEC0EYIQAMAwtBACEADAILQRUhAAsLEBYgAAvEAwEEfyMEIQIjBEFAayQEIAJBIGohAyAAKAIAIgRBAkYEQCADIABBBGoiBSgCACIEOgAAIAMgBEEIdjoAASADIARBEHY6AAIgAyAEQRh2OgADIAFBICADQQQgAhCnASAFQQA2AgAgBSACLQAfQRh0IAItAB5BEHQgAi0AHUEIdCACLQAbQRh0IAItABpBEHQgAi0AGUEIdCACLQAXQRh0IAItABZBEHQgAi0AFUEIdCACLQATQRh0IAItABJBEHQgAi0AEUEIdCACLQAPQRh0IAItAA5BEHQgAi0ADUEIdCACLQALQRh0IAItAApBEHQgAi0ACUEIdCACLQAHQRh0IAItAAZBEHQgAi0ABUEIdCACLQADQRh0IAItAAJBEHQgAi0AAUEIdCACLQAAcnJyIAItAARzc3NzIAItAAhzc3NzIAIt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IBwgAa18NwMAAkACQAJAAkACQAJAAkACQAJAAkAgFCgCACIBQQFrDnkAAQEIAggICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAMFBwYECAtBACQFQRsgAEG4pgFqIgEQDCMFIQJBACQFIAJBAXENDSABIAcpAgA3AgAgASAHKQIINwIIIAEgBygCEDYCEEEAJAVBCiAEEAUhASMFIQJBACQFIAJBAXENDSAAQcymAWoiAyABOwEAQQAkBUEMIAQQBSECIwUhAUEAJAUgAUEBcQ0NIABB0KYBaiACNgIAIABBnbwDaiAAQcCmAWooAgAiAUEBcToAACAAQZy8A2ogAUEDdkEBcToAACAAQZ+8A2ogAUECdkEBcToAACAAQaO8A2ogAUEGdkEBcToAACAIIAFBB3ZBAXE6AAAgAEGgvANqIAIEf0EBBSADLgEAQQBHC0EBcToAACAAQdSmAWogAUEBdkEBcToAACAAQaG8A2ogAUEIdkEBcToAACAAQaK8A2ogAUEEdkEBcToAAAwICyAAQbCnAWohAyAAQfCtAmohAkEAJAVBCCABQQJGIg8EfyADBSACIgMLQQAQDSMFIQFBACQFIAFBAXFFBEAgAyAHKQIANwIAIAMgBykCCDcCCCADIAcoAhA2AhAgA0GIwQBqIANBCGoiCSgCACIBQQFxOgAAIANBicEAaiABQQF2QQFxOgAAIANBi8EAaiIGIAFBAnZBAXE6AAAgA0GQwQBqIAFBCnZBAXE6AAAgA0HgwQBqIA8Ef0EAIQUgAUEEdkEBcQUgAUEQcUEARyEFQQALOgAAIANB6sEAaiAFQQFxOgAAIANB4cEAaiIMIAFB4AFxQeABRiICOgAAIANB5MEAaiACBH9BAAVBgIAEIAFBBXZBB3F0CzYCACADQeLBAGoiGSABQQN2QQFxOgAAIANB48EAaiABQQt2QQFxOgAAQQAkBUEMIAQQBSEBIwUhAkEAJAUgAkEBcUUEQCADQRRqIhogATYCAEEAJAVBDCAEEAUhAiMFIQFBACQFAkAgAUEBcUUEQEEAJAVBCyAEEAUhASMFIQVBACQFIAVBAXFF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AGoiBxAMIwUhAkEAJAUCQCACQQFxBEAQFyECBSAAQdDnAWoiAkIANwIAIAJCADcCCCACQgA3AhAgAkIANwIYIAJCADcCICAAQZDuAmoiAkIANwIAIAJCADcCCCACQgA3AhAgAkIANwIYIAJCADcCICAAQazzAGoiCEEANgIAIABBqPMAaiABRSICOgAAAkAgAgRAQQAkBUEEQcDLBBAFIQMjBSEBQQAkBSABQQFxBEAQFyECBUEAJAVBGiADEAwjBSEBQQAkBSABQQFxRQRAIAMhAQwDCxAXIQIgAxBSIABBkO4CaigCACIDBEAgAxBSCwsgAEHQ5wFqKAIAIgMEQCADEFILIAcQtQIMAwsLIAggATYCACAAIAFBnYUDaiwAADoAFSAAQZi8A2pBAjYCACAAQai8A2pBADYCACAGQgA3AwAgAEGtvANqQQA6AAAgAEGsvANqQQA6AAAgAEHI8wBqQQA2AgAgAEGIvANqIgFCADcDACABQgA3AwggAEGcvANqIgFCADcCACABQQA6AAggAEGw8wBqQn83AwAgAEG48wBqQX82AgAgAEGwrQJqIgFCADcDACABQgA3AwggAUIANwMQIAFCADcDGCAAQcC8A2pBADYCACAAQeS8A2pBADYCACAAQb68A2pBADoAACAAQdDzAGpBADoAACAAQbimAWoiAUIANwMAIAFCADcDCCABQgA3AxAgAUIANwMYIAFCADcDICABQgA3AyggAUIANwMwIAFCADcDOCABQUBrQgA3AwAgAUIANwNIIAFCADcDUCABQgA3A1ggAUIANwNgIAFCADcDaCABQQA2AnAgAEHIvANqIgBCADcDACAAQgA3AwggAEIANwMQIABBADoAGA8LCyAFEIQBCyAEEI4BIAAQcCACEB4LjwgBC38jBCECIwRBMGokBCACQRBqIQogAkEIaiEHIAIiCUEYaiIFQgA3AgAgBUIANwIIQQAkBUEUIAAgBUEAEAchAiMFIQNBACQFAkAgA0EBcUUEQCACBH8gBUEEaiIGKAIAIgtBAWohAiAGIAI2AgAgAiAFQQhqIggoAgAiBEsEfyAFKAIMIgNBAEcgAiADS3EEf0EAJAUgCSADNgIAQQJBrPUCQdgbIAkQDiMFIQNBACQFIANBAXENBEEAJAVBFEGs9QIQDCMFIQNBACQFIANBAXENBCAIKAIA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IABBwJgBaiIaQgA3AwAgAEHoAGoiA0IANwMAIANCADcDCCADQgA3AxAgA0EANgIYIABB8ABqIgZBfzYCACABRQRAIABBwK4CakEANgIAIABBxK4CakEANgIAIABBuK4CakEANgIAIABBvK4CakEBNgIAIABByK4CakEAQfACEFQaIABBhK8BakEAQbT/ABBUGiAAQczMA2pBADoAACAAQbTJA2pBAEGUAxBUGiAAQbDJA2pBAjYCACAAQcjMA2pBADYCAAsgACABEIMBIAMoAgAiAiAFKAIAIghrIgFBAEgNASAGIABB+ABqIhIoAgAgCGsgBigCAGo2AgAgCEGAgAFKBEAgAUEASgRAIAAoAhAiAiACIAhqIAEQXRoLIAVBADYCACADIAE2AgAFIAIhAQsgAUGAgAJGBEBBACEBQYCAAiECBSAAKAIAIAAoAhAgAWpBgIACIAFrEF4hASADKAIAIgggAWohAiABQQBKBEAgAyACNgIABSAIIQILCyAAQewAaiIOIAJBYmoiAjYCACASIAUoAgAiCDYCACAIQX9qIAYoAgAiDGohCCAMQX9HBEAgDiACIAhIBH8gAgUgCAs2AgALIAFBf0YNASAAIABBBGoiDCAAQfAAaiITEKQCRQ0BIAAgDCATIABBhAFqIhsQowJFDQECQCADIQggBSEXIAYhGAsLIAQhDyAAQdDNA2ohECAAQeAAaiEJIABBBGohCiAAQaCWAWohICAAQRBqIRQgAEGIAmohISAAQaiYAWohFSAAQaSWAWohIiAAQaiWAWohDSAAQfQfaiEjIABBzABqIRwgAEHQAGohJCAAQcgAaiEdIABBxABqIRYgAEHYAGohGSAAQeA9aiElIABB3DxqISYgAEHwHmohJyAAQczbAGohKCAAQcjaAGohKSAAQYQBaiEqIABBsJgBaiErIABB8ABqISwgAEH0AGohLSAAQYABaiEuAkACQAJAA0ACQCAJIAkoAgAgECgCACIEcSICNgIAIAooAgAiASAOKAIATgRAA0ACQCABICwoAgAiAyASKAIAIgVqIgJIBEAgASACQX9qRw0BIAcoAgAgLSgCAEgNAQsgLiwAAA0DIAAgDCATEKQCRQ0GIAAgDCATIBsQowJFDQYgCigCACEBDAELCyAIKAIAIgQgAWsiAkEASA0BIBggBSABayADajYCACAB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NwIIIAJCADcCECACQgA3AhggAkEANgIgIABBoJYBaiAAQczNA2ooAgAiAkGAgIACSQR/IAIFQYCAgAILIABB0M0DaigCAHE2AgALIABBADYCOCAAQQhqIghBADYCACAAQQRqIgdBADYCACAAQcCYAWoiGkIANwMAIABB6ABqIgJCADcDACACQgA3AwggAkIANwMQIAJBADYCGCAAQX82AnAgAUUEQCAAQcCuAmpBADYCACAAQcSuAmpBADYCACAAQbiuAmpBADYCACAAQbyuAmpBATYCACAAQciuAmpBAEHwAhBUGiAAQYSvAWpBAEG0/wAQVBogAEHMzANqQQA6AAAgAEG0yQNqQQBBlAMQVBogAEGwyQNqQQI2AgAgAEHIzANqQQA2AgALIAAgARCDASACKAIAIgogBygCACIJayIDQQBIBEAPCyAJQYCAAUoEQCADQQBKBEAgACgCECIKIAogCWogAxBdGgsgB0EANgIAIAIgAzYCAAUgCiEDCyAAKAIAIABBEGoiDigCACADakGAgAIgA2sQXiEDIAIoAgAiCSADaiEKIANBAEoEQCACIAo2AgAgACAKQWJqNgJsBSAAIAlBYmo2AmwgA0F/RgRADwsLIAEEQCAAQczMA2osAAAEQCACIQkgACEKDAMLCyAAENsBBEAgAiEJIAAhCgUPCwsLIABB0M0DaiERIABB4ABqIQsgAEHsAGohFyAAQeQAaiEfIABByMwDaiESIABBwLECaiEMIABBsMkDaiEgIABBpJYBaiETIABBiAJqISEgAEH0H2ohIiAAQcwAaiEUIABB0ABqIRsgAEHIAGohFSAAQcQAaiEPIABB2ABqIRYgAEG8sQJqIRggAEG4sQJqIRkgAEHgPWohIyAAQdw8aiEkIABB8B5qISUgAEHM2wBqISYgAEHI2gBqIScgAEHMzQNqISggAEHMzANqIRwgAEGEAWohKSAAQbCYAWohKkEAIQECQAJAAkACQAJAAkACQAJAA0ACQCALIAsoAgAgESgCAHE2AgAgBygCACIEIBcoAgBKBEAgCSgCACIDIARrIgJBAEgNASAEQYCAAUoEQCACQQBKBEAgDigCACIDIAMgBGogAhBdGgsgB0EANgIAIAkgAjYCAAUgAyECCyAKKAIAIA4oAgAgAmpBgIACIAJrEF4hAiAJKAIAIgQgAmohAyAC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wQBqEJsECwwBCyABQcytAmosAABFDQEgASAAQRBqQQAgDRC1AQRAIAEgAUGIvANqKQMAQQAgASgCACgCEEEDcUG4AmoRAgAgBiQEQQEPBUGs9QJBARBkDAILAAsgASABQZC8A2opAwBBACABKAIAKAIQQQNxQbgCahECACAGJARBAQ8LIAYkBEEAC5oBAQJ/IABCADcDACAAQRBqIgMQtwIgACABNgIIIABBADYC3AEgAEHgwQBqQQA2AgAgAEEANgLMAUEAJAVBBEHYzQMQBSEBIwUhAkEAJAUgAkEBcQRAEBchAiADEIQBIAIQHgtBACQFQQcgASADEA0jBSECQQAkBSACQQFxRQRAIAAgATYCyAEPCxAXIQAgARBSIAMQhAEgABAeC4IDAgd/AX4gAEGQMmohBkGAgAQgAEGUMmoiAygCACICa0GAAkkEQCAAKAIQIgUgBSACaiAGKAIAIAJrIgIQUxogA0EANgIAIAYgAjYCACAAEOIBGiADKAIAIQILIAJBB2ogBigCAEsEQEEADwsgASAAQRBqIgcoAgAgAmpBBxDpASADIAMoAgBBB2o2AgAgARCmASEIIAFBBBC6AiICQX1qIAEQYSIJp2ohBCAJQgBRIAJFIARBAEhycgRAIABB6DFqQQA6AABBAA8LIAYoAgAgAygCACICayEFAkAgBEEASgRAIAEgBygCACACaiAFIARJBH8gBQUgBAsiAhDpASADIAMoAgAgAmo2AgAgBCACayICQQBKBEADQAJAIANBADYCACAGQQA2AgAgABDiAUUEQEEAIQAMAQsgASAHKAIAIAMoAgBqIAUgAkkEfyAFBSACCyIEEOkBIAMgAygCACAEajYCACACIARrIgJBAEoNAQwECwtBAA8LCwsgCCABELgCRgtOAQF/AkACQAJAIAJBmLwDaigCAEECaw4CAAECCyMEIQQjBEGAEGokBCACQcynAWooAgAaIAQkBEEADwsgACADIAJBsKcBahCdBA8LQQALRwAgAEHJiQNqLAAABEAPCyAAQZCFA2osAABFBEAPCyABQZi8A2ooAgBBAkcEQA8LIAFBkK4CakHMERBzBEAPCyABIAIQoQQLOAAgAEHJiQNqLAAABEAPCyABQeitAmouAQBBgQJHBEAPCyAAQZCFA2osAABFBEAPCyABIAIQogQLrQEBAn8jBCED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IABBpA5qIAJBgAFqNgIAIABBqA5qIAJBoAFqNgIAIABBrA5qIAJBqAFqNgIAIABBqBBqQQAgAEG4DmoiAmtBP3EgAmoiAjYCACAAQawQaiACQYABajYCACAAQbAQaiACQaABajYCACAAQbQQaiACQagBajYCAAUgAiABKALwAUGwARBTGiAAIAEoAoACNgKAAiAAIAEsAIQCOgCEAiAAQQAgAEGIAmoiAmtBP3EgAmoiAjYC+AMgACACQYABajYC/AMgACACQaABajYCgAQgACACQagBajYChAQgAiABKAL4A0GwARBTGiAAIAEoAogENgKIBCAAIAEsAIwEOgCMBCAAQQAgAEGQBGoiAmtBP3EgAmoiAjYCgAYgACACQYABajYChAYgACACQaABajYCiAYgACACQagBajYCjAYgAiABKAKABkGwARBTGiAAIAEoApAGNgKQBiAAIAEsAJQGOgCUBiAAQYgIakEAIABBmAZqIgJrQT9xIAJqIgI2AgAgAEGMCGogAkGAAWo2AgAgAEGQCGogAkGgAWo2AgAgAEGUCGogAkGoAWo2AgAgAiABQYgIaigCAEGwARBTGiAAQZgIaiABQZgIaigCADYCACAAQZwIaiABQZwIaiwAADoAACAAQZAKakEAIABBoAhqIgJrQT9xIAJqIgI2AgAgAEGUCmogAkGAAWo2AgAgAEGYCmogAkGgAWo2AgAgAEGcCmogAkGoAWo2AgAgAiABQZAKaigCAEGwARBTGiAAQaAKaiABQaAKaigCADYCACAAQaQKaiABQaQKaiwAADoAACAAQZgMakEAIABBqApqIgJrQT9xIAJqIgI2AgAgAEGcDGogAkGAAWo2AgAgAEGgDGogAkGgAWo2AgAgAEGkDGogAkGoAWo2AgAgAiABQZgMaigCAEGwARBTGiAAQagMaiABQagMaigCADYCACAAQawMaiABQawMaiwAADoAACAAQaAOakEAIABBsAxqIgJrQT9xIAJqIgI2AgAgAEGkDmogAkGAAWo2AgAgAEGoDmogAkGgAWo2AgAgAEGsDmogAkGoAWo2AgAgAiABQaAOaigCAEGwARBTGiAAQbAOaiABQbAOaigCADYCACAAQbQOaiABQbQOaiwAADoAACAAQagQakEAIABBuA5qIgJrQT9xIAJqIgI2AgAgAEGsEGogAkGAAWo2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ABggACACKQAgNwAgIAAgAikAKDcAKCAAIAIpADA3ADAgACACKQA4NwA4IAQgBCgCAEFAaiIANgIAIAMgBmohAyAFIAZrIgUNAAsMAQsgAiADIAUQUxogBCAEKAIAIAVqIgA2AgALQSAhBSAKQYABaiEDAkACQANAIAcoAgAgAGohAiAFQYABIABrIgZNDQEgAiADIAYQUxogBCAEKAIAIAZqNgIAIAkoAgAiACgCACECIAAgAkFAazYCACAAQQRqIgAgACgCACACQb9/S2o2AgAgCCAHKAIAEG0gBygCACIAQUBrIQIgACACKQAANwAAIAAgAikACDcACCAAIAIpABA3ABAgACACKQAYNwAYIAAgAikAIDcAICAAIAIpACg3ACggACACKQAwNwAwIAAgAikAODcAOCAEIAQoAgBBQGoiADYCACADIAZqIQMgBSAGayIFDQALDAELIAIgAyAFEFMaIAQgBCgCACAFaiIANgIAC0EgIQUgCkGgAWohAwJAAkADQCAHKAIAIABqIQIgBUGAASAAayIGTQ0BIAIgAyAGEFMaIAQgBCgCACAGajYCACAJKAIAIgAoAgAhAiAAIAJBQGs2AgAgAEEEaiIAIAAoAgAgAkG/f0tqNgIAIAggBygCABBtIAcoAgAiAEFAayECIAAgAikAADcAACAAIAIpAAg3AAggACACKQAQNwAQIAAgAikAGDcAGCAAIAIpACA3ACAgACACKQAoNwAoIAAgAikAMDcAMCAAIAIpADg3ADggBCAEKAIAQUBqIgA2AgAgAyAGaiEDIAUgBmsiBQ0ACwwBCyACIAMgBRBTGiAEIAQoAgAgBWoiADYCAAtBICEFIApBwAFqIQMCQAJAA0AgBygCACAAaiECIAVBgAEgAGsiBk0NASACIAMgBhBTGiAEIAQoAgAgBmo2AgAgCSgCACIAKAIAIQIgACACQUBrNgIAIABBBGoiACAAKAIAIAJBv39LajYCACAIIAcoAgAQbSAHKAIAIgBBQGshAiAAIAIpAAA3AAAgACACKQAINwAIIAAgAikAEDcAECAAIAIpABg3ABggACACKQAgNwAgIAAgAikAKDcAKCAAIAIpADA3ADAgACACKQA4NwA4IAQgBCgCAEFAaiIANgIAIAMgBmohAyAFIAZrIgUNAAsMAQsgAiADIAUQUxogBCAEKAIAIAVqIgA2AgALQSAhBSAKQeABaiEKAkACQANAAkAgBygCACAAaiEDIAVBgAEgAGsiAk0NACADIAogAhBTGiAEIAQoAgAgAmo2AgAgCSgCACIAKAIAIQMgACADQUBrNgIAIABBBGoiACAAKAIAIANBv39LajYCACAIIAcoAgAQbSAHKAIAIgBBQGshAyAAIAMpAAA3AAAgACADKQAINwAIIAAgAykAEDcAECAAIAMpABg3ABggACADKQAgNwAgIAAgAykAKDcAKCAAIAMpADA3ADAgACADKQA4NwA4IAQgBCgCAEFAaiIANgIAIAUgAmsiBUUNAiAKIAJqIQoMAQsLDAELIAggARDgASALJAQPCyADIAogBRBTGiAEIAQoAgAgBWo2AgAgCCABEOABIAskBAuwAgIEfwN+IABB6DFqIgYsAABFBEBBAA8LIABBqDJqIQUgAEGcMmohByAAQbAyaiEEA0AgBSkDACAHKAIArXwgBCkDAFgEQCAAEKQEDQELCyAGLAAARQRAIABBuDJqLAAARQRAQQAPCyAAKAIAIAQpAwBBABCcAUEADwsgBCkDACIIIAUpAwAiCVoEQCAIIAKtIgp8IAkgBygCAK18WARAIAEgAEGYMmooAgAgCCAJfadqIAIQUxogAyACNgIAIAQgBCkDACAKfDcDACAAQbgyakEBOgAAQQEPCwsgAEG4MmoiBSwAAARAIAAoAgAgCEEAEJwBIAVBADoAAAsgACgCACABIAIQ1AEiAEEASAR/IAZBADoAAEEABSADIAA2AgAgBCAEKQMAIACsfDcDAEEBCwv2BgEPf0GABCAAQcgWaiIOKAIAIgdrIQYgB0UgBiACS3IEfyABIQkgAgUgAEHIEmogB2ogASAGEFMaA0AgACADQYgCbGohDCAAIANBiAJsakHwAWohCCAAIANBiAJsakH4AWohDUHAACEKIABByBJqIANBBnRqIQsgACADQYgCbGpBgAJqIgcoAgAhBAJAAkADQCAIKAIAIARqIQUgCkGAASAEayIJTQ0BIAUgCyAJEFMaIAcgBygCACAJajYCACANKAIAIgQoAgAhBSAEIAVBQGs2AgAgBEEEaiIEIAQoAgAgBUG/f0tqNgIAIAwgCCgCABBtIAgoAgAiBEFAayEFIAQgBSkAADcAACAEIAUpAAg3AAggBCAFKQAQNwAQIAQgBSkAGDcAGCAEIAUpACA3ACAgBCAFKQAoNwAoIAQgBSkAMDcAMCAEIAUpADg3ADggByAHKAIAQUBqIgQ2AgAgCyAJaiELIAogCWsiCg0ACwwBCyAFIAsgChBTGiAHIAcoAgAgCmo2AgALIANBAWoiA0EIRw0ACyABIAZqIQlBACEHIAIgBmsLIgtB/wNLIQ9BACEEA0AgACAEQYgCbGohECAPBEAgACAEQYgCbGpB8AFqIQ0gACAEQYgCbGpB+AFqIREgCSAEQQZ0aiECIAshCiAAIARBiAJsakGAAmoiCCgCACEDA0BBwAAhBSACIQECQAJAA0AgDSgCACADaiEGIAVBgAEgA2siDE0NASAGIAEgDBBTGiAIIAgoAgAgDGo2AgAgESgCACIDKAIAIQYgAyAGQUBrNgIAIANBBGoiAyADKAIAIAZBv39LajYCACAQIA0oAgAQbSANKAIAIgNBQGshBiADIAYpAAA3AAAgAyAGKQAINwAIIAMgBikAEDcAECADIAYpABg3ABggAyAGKQAgNwAgIAMgBikAKDcAKCADIAYpADA3ADAgAyAGKQA4NwA4IAggCCgCAEFAaiIDNgIAIAEgDGohASAFIAxrIgUNACADIQELDAELIAYgASAFEFMaIAggCCgCACAFaiIBNgIACyACQYAEaiECIApBgHxqIgpB/wNLBEAgASEDDAELCwsgBEEBaiIEQQhJDQALIAtB/wNxIgFFBEAgDiABIAdqNgIADwsgAEHIEmogB2ogCSALIAFraiABEFMaIA4gASAHajYCAAu5CgEDfyAAQcAQakEAQfABEFQaIABBwBJqQQA2AgAgAEHEEmoiA0EAOgAAIABByBJqQQBBhAQQVBogAEG0EmoiAigCACIBQawRKQIANwIAIAFBtBEpAgA3AgggAUG8ESkCADcCECABQcQRKQIANwIYIAIoAgAiASABKAIAQaCAoBBzNgIAIAFBDGoiASABKAIAQYCAhIACczYCACAAQQBB8AEQVBogAEEANgKAAiAAQQA6AIQCIABB9AFqIgIoAgAiAUGsESkCADcCACABQbQRKQIANwIIIAFBvBEpAgA3AhAgAUHEESkCADcCGCACKAIAIgEgASgCAEGggKAQczYCACABQQxqIgEgASgCAEGAgICAAnM2AgAgAEGIAmpBAEHwARBUGiAAQQA2AogEIABBADoAjAQgAEH8A2oiAigCACIBQawRKQIANwIAIAFBtBEpAgA3AgggAUG8ESkCADcCECABQcQRKQIANwIYIAIoAgAiASABKAIAQaCAoBBzNgIAIAFBCGoiAiACKAIAQQFzNgIAIAFBDGoiASABKAIAQYCAgIACczYCACAAQZAEakEAQfABEFQaIABBADYCkAYgAEEAOgCUBiAAQYQGaiICKAIAIgFBrBEpAgA3AgAgAUG0ESkCADcCCCABQbwRKQIANwIQIAFBxBEpAgA3AhggAigCACIBIAEoAgBBoICgEHM2AgAgAUEIaiICIAIoAgBBAnM2AgAgAUEMaiIBIAEoAgBBgICAgAJzNgIAIABBmAZqQQBB8AEQVBogAEGYCGpBADYCACAAQZwIakEAOgAAIABBjAhqIgIoAgAiAUGsESkCADcCACABQbQRKQIANwIIIAFBvBEpAgA3AhAgAUHEESkCADcCGCACKAIAIgEgASgCAEGggKAQczYCACABQQhqIgIgAigCAEEDczYCACABQQxqIgEgASgCAEGAgICAAnM2AgAgAEGgCGpBAEHwARBUGiAAQaAKakEANgIAIABBpApqQQA6AAAgAEGUCmoiAigCACIBQawRKQIANwIAIAFBtBEpAgA3AgggAUG8ESkCADcCECABQcQRKQIANwIYIAIoAgAiASABKAIAQaCAoBBzNgIAIAFBCGoiAiACKAIAQQRzNgIAIAFBDGoiASABKAIAQYCAgIACczYCACAAQagKakEAQfABEFQaIABBqAxqQQA2AgAgAEGsDGpBADoAACAAQZwMaiICKAIAIgFBrBEpAgA3AgAgAUG0ESkCADcCCCABQbwRKQIANwIQIAFBxBEpAgA3AhggAigCACIBIAEoAgBBoICgEHM2AgAgAUEIaiICIAIoAgBBBXM2AgAgAUEMaiIBIAEoAgBBgICAgAJzNgIAIABBsAxqQQBB8AEQVBogAEGwDmpBADYCACAAQbQOakEAOgAAIABBpA5qIgIoAgAiAUGsESkCADcCACABQbQRKQIANwIIIAFBvBEpAgA3AhAgAUHEESkCADcCGCACKAIAIgEgASgCAEGggKAQczYCACABQQhqIgIgAigCAEEGczYCACABQQxqIgEgASgCAEGAgICAAnM2AgAgAEG4DmpBAEHwARBUGiAAQbgQakEANgIA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BgYGaWkAdgBSYXJBcmNoaXZlAHZpAG9wZW4AaWlpaWlpAGdldEZpbGVIZWFkZXIAaWlpAHJlYWRGaWxlAGlpaWkAU3RhdGUAaQBlcnJDb2RlAHZpaWkAZXJyVHlwZQBBcmNIZWFkZXIAc3RhdGUAY29tbWVudABmbGFncwBBcmNGaWxlSGVhZGVyAG5hbWUAcGFja1NpemUAZGlpAHZpaWQAdW5wU2l6ZQBob3N0T1MAY3JjAHRpbWUAdW5wVmVyAG1ldGhvZABmaWxlQXR0cgAxM0FyY0ZpbGVIZWFkZXIATlN0M19fMjEyYmFzaWNfc3RyaW5nSXdOU18xMWNoYXJfdHJhaXRzSXdFRU5TXzlhbGxvY2F0b3JJd0VFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQA5QXJjSGVhZGVyAE5TdDNfXzIxMmJhc2ljX3N0cmluZ0ljTlNfMTFjaGFyX3RyYWl0c0ljRUVOU185YWxsb2NhdG9ySWNFRUVFADVTdGF0ZQBFUlJfUFJPQ0VTUwBFUlJfUkVBRABFUlJfT1BFTgBQSzEwUmFyQXJjaGl2ZQBQMTBSYXJBcmNoaXZlADEwUmFyQXJjaGl2ZQBTRVQARU5EAENVUgA0RmlsZQB2b2lkAGJvb2wAY2hhcgBzaWduZWQgY2hhcgB1bnNpZ25lZCBjaGFyAHNob3J0AHVuc2lnbmVkIHNob3J0AGludAB1bnNpZ25lZCBpbnQAbG9uZwB1bnNpZ25lZCBsb25nAGZsb2F0AGRvdWJsZQBzdGQ6OnN0cmluZwBzdGQ6OmJhc2ljX3N0cmluZzx1bnNpZ25lZCBjaGFyPgBzdGQ6OndzdHJpbmcAZW1zY3JpcHRlbjo6dmFsAGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGNoYXI+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHNpZ25lZCBjaGFyPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1bnNpZ25lZCBjaGFyPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaG9ydD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgc2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgaW50PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxsb25nPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1bnNpZ25lZCBsb25nPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ4X3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVpbnQ4X3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGludDE2X3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQzMl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZmxvYXQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGRvdWJsZT4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZyBkb3VibGU+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWVFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lkRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJZkVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SW1FRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lsRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJakVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWlFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0l0RUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJc0VFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWhFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lhRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJY0VFAE4xMGVtc2NyaXB0ZW4zdmFsRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQASERMUFRYXGBkaGxwdHh8gIREiIyQRJSYnKCkqKywRLS4vEBAwEBAQEBAQEDEyMxA0NRAQERERERERERERERERERERERERERERERERETYRERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERE3ERERETgROTo7PD0+ERERERERERERERERERERERERERERERERERERERERERERERERERERERERET8QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBARQEERQkNERUZHSEkQEBBKS0xNThAQEE9QEBAQEFEQEBAQEBAQEBARERFSUxAQEBAQEBAQEBAQEREREVQQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAREVUQEBAQVhAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBBXEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBBYWVpbEBAQEBAQEBAQEBAQEBAQEBAQEBAQEFwQEBAQEBAQEBAQEBAQEBAQEABBusMACyD//////////////////////////////////////////wBB4sMACzb+//8H/v//BwAAAAAABCAE//9/////f//////////////////////////////////D/wMAH1AAQaLEAAukASAAAAAAAN88QNf///v///////////+///////////////////////8D/P////////////////////////8A/v///38C/v////8AAAAAAP+/tgD///8HBwAAAP8H//////////7/w////////////////+8f/uH/nwAA////////AOD///////////////8DAP//////BzAE/////P8fAAD///8BAEHOxQAL5AH9HwAAAAAAAPAD/3//////////7//f4f/P//7+7p/5///9xeOfWYCwz/8DAO6H+f///W3DhxkCXsD/PwDuv/v///3t478bAQDP/wAA7p/5///97eOfGcCwz/8CAOzHPdYYx//Dxx2BAMD/AADu3/3///3v498dYAPP/wAA7N/9///97+PfHWBAz/8GAOzf/f/////n312AAM//APzs/3/8///7L3+AX/8AAAwA/v////9//wc/IP8DAAAAAJYl8P6u7P87XyD/8wAAAAABAAAA/wMAAP/+////H/7/A////v///x8AQbrHAAuVAv///////3/5/wP//+fB//9/QP8z/////78g///////3////////////PX89//////89/////z1/Pf9//////////z3//////////4cAAAAA//8AAP////////////8fAP7//////////////////////////////////////////////////////////5////7//wf////////////HAQD/3w8A//8PAP//DwD/3w0A////////z///AYAQ/wMAAAAA/wP//////////////wD//////wf//////////z8A////H/8P/wHA/////z8fAP//////D////wP/AwAAAAD///8P/////////3/+/x8A/wP/A4AAQdrJAAsw////////7//vD/8DAAAAAP//////8////////7//AwD///////8/AP/j//////8/AEGXygALG95vAP///////////////////////////////wBBusoACyD//z8//////z8//6r///8/////////31/cH88P/x/cHwBB6MoACwYCgAAA/x8AQfrKAAsShPwvPlC9//PgQwAA//////8BAEGwywALUMD///////8DAAD//////3///////3//////////////////////H3gMAP////+/IP////////+AAAD//38Af39/f39/f3//////AAAAAACAAEGazAALV+AAAAD+Az4f/v///////////3/g/v/////////////34P////8//v////////////9/AAD///8HAAAAAAAA////////////////////////////////PwBB+swACzL/////////////////////////////////HwAAAAAAAP//////////////////////HwBBtM0ACzz//////z//H////w8AAP//////f/CP////gP////////////8AAAAAgP/8////////////////eQ8A/wcAQfnNAAtn/7v3////AAAA////////DwD//////////w8A/wMAAPwI//////8H/////wcA////H/////////f/AID/AwAAAAD///////9/AP8//wP//38E/////////38FAAA4//88AH5+fgB/fwBB8s4AC4gB//////8H/wP//////////////////////////w8A//9/+P//////D/////////////////8//////////////////wMAAAAAfwD44P/9f1/b/////////////////wMAAAD4////////////////PwAA///////////8////////AAAAAAD/DwBBiNAAC1Lf/////////////////////x8AAP8D/v//B/7//wfA/////////////3/8/PwcAAAAAP/v//9///+3/z//PwAAAAD///////////////////8HAEHi0AALB////////x8AQYrRAAtG////H////////wEAAAAAAP///38AAP///wcAAAAAAAD///8//////w//PgAAAAAA/////////////////////////z//AwBB2tEACws//f////+/kf//PwBB+tEACwj//z8A////AwBBitIACwj/////////wABBmtIACxBv8O/+//8PAAAAAAD///8fAEG60gALD////////z8A//8/AP//BwBB2tIACwr///////////8BAEH60gALKP//////////PwAAAMD/AAD8////////AQAA////Af8D////////x/8AQarTAAsM//////////8eAP8DAEHK0wALHv///////z8A/wMAAAAAAAD/////////////////fwBB+tMACw3///////////////8HAEGa1AALBv//////fwBButQACwj/////////AQBB2tQACxT//////////x8A//////9/AAD4/wBB+tQACwEDAEGa1QALmAH/////////////3///////////32Te/+vv/////////7/n39////97X/z9//////////////////////////////////////////////////////8//////f//9/////f//9/////f//9/////f/////3////9///3z////////+////+W/vcKhOqWqpb3917/+/8P7vv/DwBButYAC+sPVCEiGQ0BAgMRSxwMEAQLHRIeJ2hub3BxYiAFBg8TFBUaCBYHKCQXGAkKDhsfJSODgn0mKis8PT4/Q0dKTVhZWltcXV5fYGFjZGVmZ2lqa2xyc3R5ent8AElsbGVnYWwgYnl0ZSBzZXF1ZW5jZQBEb21haW4gZXJyb3IAUmVzdWx0IG5vdCByZXByZXNlbnRhYmxlAE5vdCBhIHR0eQBQZXJtaXNzaW9uIGRlbmllZABPcGVyYXRpb24gbm90IHBlcm1pdHRlZABObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5AE5vIHN1Y2ggcHJvY2VzcwBGaWxlIGV4aXN0cwBWYWx1ZSB0b28gbGFyZ2UgZm9yIGRhdGEgdHlwZQBObyBzcGFjZSBsZWZ0IG9uIGRldmljZQBPdXQgb2YgbWVtb3J5AFJlc291cmNlIGJ1c3kASW50ZXJydXB0ZWQgc3lzdGVtIGNhbGwAUmVzb3VyY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUASW52YWxpZCBzZWVrAENyb3NzLWRldmljZSBsaW5rAFJlYWQtb25seSBmaWxlIHN5c3RlbQBEaXJlY3Rvcnkgbm90IGVtcHR5AENvbm5lY3Rpb24gcmVzZXQgYnkgcGVlcgBPcGVyYXRpb24gdGltZWQgb3V0AENvbm5lY3Rpb24gcmVmdXNlZABIb3N0IGlzIGRvd24ASG9zdCBpcyB1bnJlYWNoYWJsZQBBZGRyZXNzIGluIHVzZQBCcm9rZW4gcGlwZQBJL08gZXJyb3IATm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcwBCbG9jayBkZXZpY2UgcmVxdWlyZWQATm8gc3VjaCBkZXZpY2UATm90IGEgZGlyZWN0b3J5AElzIGEgZGlyZWN0b3J5AFRleHQgZmlsZSBidXN5AEV4ZWMgZm9ybWF0IGVycm9yAEludmFsaWQgYXJndW1lbnQAQXJndW1lbnQgbGlzdCB0b28gbG9uZwBTeW1ib2xpYyBsaW5rIGxvb3AARmlsZW5hbWUgdG9vIGxvbmcAVG9vIG1hbnkgb3BlbiBmaWxlcyBpbiBzeXN0ZW0ATm8gZmlsZSBkZXNjcmlwdG9ycyBhdmFpbGFibGUAQmFkIGZpbGUgZGVzY3JpcHRvcgBObyBjaGlsZCBwcm9jZXNzAEJhZCBhZGRyZXNzAEZpbGUgdG9vIGxhcmdlAFRvbyBtYW55IGxpbmtzAE5vIGxvY2tzIGF2YWlsYWJsZQBSZXNvdXJjZSBkZWFkbG9jayB3b3VsZCBvY2N1cgBTdGF0ZSBub3QgcmVjb3ZlcmFibGUAUHJldmlvdXMgb3duZXIgZGllZABPcGVyYXRpb24gY2FuY2VsZWQARnVuY3Rpb24gbm90IGltcGxlbWVudGVkAE5vIG1lc3NhZ2Ugb2YgZGVzaXJlZCB0eXBlAElkZW50aWZpZXIgcmVtb3ZlZABEZXZpY2Ugbm90IGEgc3RyZWFtAE5vIGRhdGEgYXZhaWxhYmxlAERldmljZSB0aW1lb3V0AE91dCBvZiBzdHJlYW1zIHJlc291cmNlcwBMaW5rIGhhcyBiZWVuIHNldmVyZWQAUHJvdG9jb2wgZXJyb3IAQmFkIG1lc3NhZ2UARmlsZSBkZXNjcmlwdG9yIGluIGJhZCBzdGF0ZQBOb3QgYSBzb2NrZXQARGVzdGluYXRpb24gYWRkcmVzcyByZXF1aXJlZABNZXNzYWdlIHRvbyBsYXJnZQBQcm90b2NvbCB3cm9uZyB0eXBlIGZvciBzb2NrZXQAUHJvdG9jb2wgbm90IGF2YWlsYWJsZQBQcm90b2NvbCBub3Qgc3VwcG9ydGVkAFNvY2tldCB0eXBlIG5vdCBzdXBwb3J0ZWQATm90IHN1cHBvcnRlZABQcm90b2NvbCBmYW1pbHkgbm90IHN1cHBvcnRlZABBZGRyZXNzIGZhbWlseSBub3Qgc3VwcG9ydGVkIGJ5IHByb3RvY29sAEFkZHJlc3Mgbm90IGF2YWlsYWJsZQBOZXR3b3JrIGlzIGRvd24ATmV0d29yayB1bnJlYWNoYWJsZQBDb25uZWN0aW9uIHJlc2V0IGJ5IG5ldHdvcmsAQ29ubmVjdGlvbiBhYm9ydGVkAE5vIGJ1ZmZlciBzcGFjZSBhdmFpbGFibGUAU29ja2V0IGlzIGNvbm5lY3RlZABTb2NrZXQgbm90IGNvbm5lY3RlZABDYW5ub3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24AT3BlcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MAT3BlcmF0aW9uIGluIHByb2dyZXNzAFN0YWxlIGZpbGUgaGFuZGxlAFJlbW90ZSBJL08gZXJyb3IAUXVvdGEgZXhjZWVkZWQATm8gbWVkaXVtIGZvdW5kAFdyb25nIG1lZGl1bSB0eXBlAE5vIGVycm9yIGluZm9ybWF0aW9uAABMQ19BTEwATENfQ1RZUEUAAAAATENfTlVNRVJJQwAATENfVElNRQAAAAAATENfQ09MTEFURQAATENfTU9ORVRBUlkATENfTUVTU0FHRVMATEFORwBDLlVURi04AFBPU0lYAE1VU0xfTE9DUEFUSAARAAoAERERAAAAAAUAAAAAAAAJAAAAAAsAQa3mAAshEQAPChEREQMKBwABEwkLCwAACQYLAAALAAYRAAAAERERAEHe5gALAQsAQefmAAsYEQAKChEREQAKAAACAAkLAAAACQALAAALAEGY5wALAQwAQaTnAAsVDAAAAAAMAAAAAAkMAAAAAAAMAAAMAEHS5wALAQ4AQd7nAAsVDQAAAAQNAAAAAAkOAAAAAAAOAAAOAEGM6AALARAAQZjoAAseDwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhISAEHP6AALDhIAAAASEhIAAAAAAAAJAEGA6QALAQsAQYzpAAsVCgAAAAAKAAAAAAkLAAAAAAALAAALAEG66QALAQwAQcbpAAtdDAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAtKyAgIDBYMHgALTBYKzBYIDBYLTB4KzB4IDB4AGluZgBJTkYAbmFuAE5BTgAwMTIzNDU2Nzg5QUJDREVGLgBDLlVURi04AEGs6gALGkMAEQAKABEREQAAAAAFAAAAAAAACQAAAAALAEHO6gALGhEADwoREREDCgcAARMJCwsAAAkGCwAACwAGAEH/6gALAQsAQYrrAAsWCgoAAAAACgAAAgAJCwAAAAkACwAACwBBuesACwEMAEHF6wALFQwAAAAADAAAAAAJDAAAAAAADAAADABB8+sACwEOAEH/6wALFQ0AAAAEDQAAAAAJDgAAAAAADgAADgBBrewACwEQAEG57AALHg8AAAAADwAAAAAJEAAAAAAAEAAAEAAAEgAAABISEgBB8OwACw4SAAAAEhISAAAAAAAACQBBoe0ACwELAEGt7QALFQoAAAAACgAAAAAJCwAAAAAACwAACwBB2+0ACwEMAEHn7QALvAcMAAAAAAwAAAAACQwAAAAAAAwAAAwAACUqcwAobnVsbCkAIwArAC0AIAAwAEwAAGpMTEwAagAAAAAAamoAAAAAagAAaiUlJXMlcyVzJXMlcyouKiVjJWMAYmFzaWNfc3RyaW5nAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUAdGVybWluYXRpbmcgd2l0aCAlcyBleGNlcHRpb24gb2YgdHlwZSAlczogJXMAdGVybWluYXRpbmcgd2l0aCAlcyBleGNlcHRpb24gb2YgdHlwZSAlcwB0ZXJtaW5hdGluZyB3aXRoICVzIGZvcmVpZ24gZXhjZXB0aW9uAHRlcm1pbmF0aW5nAHVuY2F1Z2h0AFN0OWV4Y2VwdGlvbgBOMTBfX2N4eGFiaXYxMTZfX3NoaW1fdHlwZV9pbmZvRQBTdDl0eXBlX2luZm8ATjEwX19jeHhhYml2MTIwX19zaV9jbGFzc190eXBlX2luZm9FAE4xMF9fY3h4YWJpdjExN19fY2xhc3NfdHlwZV9pbmZvRQBwdGhyZWFkX29uY2UgZmFpbHVyZSBpbiBfX2N4YV9nZXRfZ2xvYmFsc19mYXN0KCkAY2Fubm90IGNyZWF0ZSBwdGhyZWFkIGtleSBmb3IgX19jeGFfZ2V0X2dsb2JhbHMoKQBjYW5ub3QgemVybyBvdXQgdGhyZWFkIHZhbHVlIGZvciBfX2N4YV9nZXRfZ2xvYmFscygpAHRlcm1pbmF0ZV9oYW5kbGVyIHVuZXhwZWN0ZWRseSByZXR1cm5lZAB0ZXJtaW5hdGVfaGFuZGxlciB1bmV4cGVjdGVkbHkgdGhyZXcgYW4gZXhjZXB0aW9uAHN0ZDo6YmFkX2FsbG9jAFN0OWJhZF9hbGxvYwBTdDExbG9naWNfZXJyb3IAU3QxMmxlbmd0aF9lcnJvcgBOMTBfX2N4eGFiaXYxMTlfX3BvaW50ZXJfdHlwZV9pbmZvRQBOMTBfX2N4eGFiaXYxMTdfX3BiYXNlX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTIzX19mdW5kYW1lbnRhbF90eXBlX2luZm9FAHYARG4AYgBjAGgAYQBzAHQAaQBqAGwAbQBmAGQATjEwX19jeHhhYml2MTE2X19lbnVtX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTIxX192bWlfY2xhc3NfdHlwZV9pbmZvRQ=="),(A=>A.charCodeAt(0)));class RA extends EA{constructor(){super(!0)}constructWorker(){return new Promise((A=>{const g=new yA;g.onmessage=I=>{"WASM_LOADED"==I.data.type&&A(g)},g.postMessage({type:"init",buffer:uA.buffer})}))}}class VA extends V{constructor(){super(),this.baseUrl="",this.loadCount=0,this.queue=[],this.__totalWork=0,this.__doneWork=0,this.plugins={},this.systemUrls={};const A="https://storage.googleapis.com/visualive-tmp/zea-engine-resources";this.systemUrls["ZeaEngine/Vive.vla"]=A+"/Vive.vla",this.systemUrls["ZeaEngine/Oculus.vla"]=A+"/Oculus.vla",this.commonResources={}}registerPlugin(A){A.init(this),this.plugins[A.getType()]=A}loadFile(A,g,I=!0){const C=this.plugins[A];if(!C)throw new Error(`There's no plugin registered for the type of file "${A}". Did you add the plugins script? See: https://docs.zea.live/zea-engine/#/adding-default-plugins`);if(I&&this.incrementWorkload(),this.loadCount<2e3){this.loadCount++;const A=C.loadFile(g);return A.then((()=>{for(this.loadCount--,this.incrementWorkDone(),this.emit("loaded",{url:g});this.loadCount<2e3&&this.queue.length>0;){this.queue.pop()()}}),(()=>{this.incrementWorkDone()})),A}return new Promise(((A,I)=>{this.queue.push((()=>{this.loadCount++;C.loadFile(g).then((I=>{for(this.loadCount--,this.incrementWorkDone(),this.emit("loaded",{url:g});this.loadCount<2e3&&this.queue.length>0;){this.queue.pop()()}A(I)}),(()=>{this.incrementWorkDone()}))}))}))}getCommonResource(A){return this.commonResources[A]}setCommonResource(A,g){this.commonResources[A]=g}incrementWorkload(A=1){this.__totalWork+=A;const g=this.__doneWork/this.__totalWork*100;this.emit("progressIncremented",{percent:g})}incrementWorkDone(A=1){this.__doneWork+=A;const g=this.__doneWork/this.__totalWork*100;if(this.emit("progressIncremented",{percent:g}),this.__doneWork>this.__totalWork)throw new Error("Mismatch between work loaded and work done.")}}const FA=new VA,SA=new class{constructor(){this.threadPool=new RA}init(A){this.resourceLoader=A}getType(){return"archive"}loadFile(A){this.resourceLoader.incrementWorkload(1);const g=new Promise(((g,I)=>{fetch(A).then((g=>(this.resourceLoader.incrementWorkDone(1),function(A){return!!A.ok&&A}(g)?g.arrayBuffer():(I(new Error(`loadArchive: ${g.status} - ${g.statusText} : ${A}`)),null)))).then((C=>{if(!C)return void I("Buffer is null");const i=A;this.threadPool.addTask({type:"unpack",resourceId:i,buffer:C},[C]).then((A=>{"FINISHED"===A.type?g(A.entries):"ERROR"===A.type&&I(new Error(`Unable to load Resource: ${i}`))}))}))}));return g}};FA.registerPlugin(SA);const wA=new class{init(A){this.resourceLoader=A}getType(){return"json"}loadFile(A){this.resourceLoader.incrementWorkload(1);return new Promise(((g,I)=>{fetch(A).then((C=>{this.resourceLoader.incrementWorkDone(1),!function(A){return!!A.ok&&A}(C)?I(`loadJSON: ${C.status} - ${C.statusText} : ${A}`):g(C.json())}))}))}};FA.registerPlugin(wA);const XA=new class{init(A){this.resourceLoader=A}getType(){return"text"}loadFile(A){this.resourceLoader.incrementWorkload(1);return new Promise(((g,I)=>{fetch(A).then((C=>{this.resourceLoader.incrementWorkDone(1),!function(A){return!!A.ok&&A}(C)?I(`loadText: ${C.status} - ${C.statusText} : ${A}`):g(C.text())}))}))}};FA.registerPlugin(XA);const HA=new class{init(A){this.resourceLoader=A}getType(){return"binary"}loadFile(A){this.resourceLoader.incrementWorkload(1);return new Promise(((g,I)=>{fetch(A).then((C=>{this.resourceLoader.incrementWorkDone(1),!function(A){return!!A.ok&&A}(C)?I(`loadBinary: ${C.status} - ${C.statusText} : ${A}`):g(C.arrayBuffer())}))}))}};FA.registerPlugin(HA);class WA{constructor(A=""){if(this.branch="",A){const g=A.split("-"),I=g[0].split(".");this.major=parseInt(I[0]),this.minor=parseInt(I[1]),this.patch=parseInt(I[2]),2==g.length&&(this.branch=g[1])}else this.major=0,this.minor=0,this.patch=0}compare(A){const g=[this.major,this.minor,this.patch];for(let I=0;I<3;I++)if(g[I]!==A[I])return g[I]-A[I];return 0}toString(){return`v${this.major}.${this.minor}.${this.patch}`+(""!=this.branch?`-${this.branch}`:"")}}class YA{constructor(A,g=0,I=!0){this.__data=A,this.__byteOffset=g,this.__dataView=new DataView(this.__data),this.__isMobileDevice=I,this.utf8decoder=new TextDecoder}get isMobileDevice(){return this.__isMobileDevice}get data(){return this.__data}get byteLength(){return this.__dataView.byteLength}get remainingByteLength(){return this.__dataView.byteLength-this.__byteOffset}pos(){return this.__byteOffset}seek(A){this.__byteOffset=A}advance(A){this.__byteOffset+=A}loadUInt8(){const A=this.__dataView.getUint8(this.__byteOffset);return this.__byteOffset+=1,A}loadUInt16(){const A=this.__dataView.getUint16(this.__byteOffset,!0);return this.__byteOffset+=2,A}loadUInt32(){const A=this.__dataView.getUint32(this.__byteOffset,!0);return this.__byteOffset+=4,A}loadSInt32(){const A=this.__dataView.getInt32(this.__byteOffset,!0);return this.__byteOffset+=4,A}loadFloat16(){const A=this.loadUInt16();return r.decode16BitFloat(A)}loadUFloat16(){const A=this.loadFloat16();return A<0?2048-A:A}loadFloat16From2xUInt8(){throw Error("loadFloat16From2xUInt8 not implemented!")}loadUInt32From2xUFloat16(){return this.loadUFloat16()+4096*this.loadUFloat16()}loadSInt32From2xFloat16(){return this.loadFloat16()+2048*this.loadFloat16()}loadFloat32(){const A=this.__dataView.getFloat32(this.__byteOffset,!0);return this.__byteOffset+=4,A}loadUInt8Array(A,g=!1){let I;return null==A&&(A=this.loadUInt32()),g?(I=new Uint8Array(this.__data.slice(this.__byteOffset,this.__byteOffset+A)),I.length!=A&&console.log("broken")):I=new Uint8Array(this.__data,this.__byteOffset,A),this.__byteOffset+=A,I}loadUInt16Array(A,g=!1){if(null==A&&(A=this.loadUInt32()),0==A)return new Uint16Array;let I;if(this.readPad(2),this.__isMobileDevice){I=new Uint16Array(A);for(let g=0;g<A;g++)I[g]=this.__dataView.getUint16(this.__byteOffset,!0),this.__byteOffset+=2}else g?(I=new Uint16Array(this.__data.slice(this.__byteOffset,this.__byteOffset+2*A)),I.length!=A&&console.log("broken")):I=new Uint16Array(this.__data,this.__byteOffset,A),this.__byteOffset+=2*A;return I}loadUInt32Array(A,g=!1){if(null==A&&(A=this.loadUInt32()),0==A)return new Uint32Array;let I;if(this.readPad(4),this.__isMobileDevice){I=new Uint32Array(A);for(let g=0;g<A;g++)I[g]=this.__dataView.getUint32(this.__byteOffset,!0),this.__byteOffset+=4}else g?(I=new Uint32Array(this.__data.slice(this.__byteOffset,this.__byteOffset+4*A)),I.length!=A&&console.log("broken")):I=new Uint32Array(this.__data,this.__byteOffset,A),this.__byteOffset+=4*A;return I}loadFloat32Array(A,g=!1){if(null==A&&(A=this.loadUInt32()),0==A)return new Float32Array;let I;if(this.readPad(4),this.__isMobileDevice){I=new Float32Array(A);for(let g=0;g<A;g++)I[g]=this.__dataView.getFloat32(this.__byteOffset,!0),this.__byteOffset+=4}else I=g?new Float32Array(this.__data.slice(this.__byteOffset,this.__byteOffset+4*A)):new Float32Array(this.__data,this.__byteOffset,A),this.__byteOffset+=4*A;return I}loadStr(){const A=this.loadUInt32(),g=new Uint8Array(this.__data,this.__byteOffset,A);return this.__byteOffset+=A,this.utf8decoder.decode(g)}loadStrArray(){const A=this.loadUInt32(),g=[];for(let I=0;I<A;I++)g[I]=this.loadStr();return g}loadSInt32Vec2(){const A=this.loadSInt32(),g=this.loadSInt32();return new B(A,g)}loadUInt32Vec2(){const A=this.loadUInt32(),g=this.loadUInt32();return new B(A,g)}loadFloat16Vec2(){const A=this.loadFloat16(),g=this.loadFloat16();return new B(A,g)}loadFloat32Vec2(){const A=this.loadFloat32(),g=this.loadFloat32();return new B(A,g)}loadFloat16Vec3(){const A=this.loadFloat16(),g=this.loadFloat16(),I=this.loadFloat16();return new o(A,g,I)}loadFloat32Vec3(){const A=this.loadFloat32(),g=this.loadFloat32(),I=this.loadFloat32();return new o(A,g,I)}loadFloat16Quat(){const A=this.loadFloat16(),g=this.loadFloat16(),I=this.loadFloat16(),C=this.loadFloat16();return new c(A,g,I,C)}loadFloat32Quat(){const A=this.loadFloat32(),g=this.loadFloat32(),I=this.loadFloat32(),C=this.loadFloat32();return new c(A,g,I,C)}loadRGBFloat32Color(){const A=this.loadFloat32(),g=this.loadFloat32(),I=this.loadFloat32();return new l(A,g,I)}loadRGBAFloat32Color(){const A=this.loadFloat32(),g=this.loadFloat32(),I=this.loadFloat32(),C=this.loadFloat32();return new l(A,g,I,C)}loadRGBUInt8Color(){const A=this.loadUInt8(),g=this.loadUInt8(),I=this.loadUInt8();return new l(A/255,g/255,I/255)}loadRGBAUInt8Color(){const A=this.loadUInt8(),g=this.loadUInt8(),I=this.loadUInt8(),C=this.loadUInt8();return new l(A/255,g/255,I/255,C/255)}loadBox2(){return new Q(this.loadFloat32Vec2(),this.loadFloat32Vec2())}loadBox3(){return new b(this.loadFloat32Vec3(),this.loadFloat32Vec3())}readPad(A){const g=this.__byteOffset%A;0!=g&&(this.__byteOffset+=A-g)}}var KA,pA;!function(A){A[A.OP_WRITE=0]="OP_WRITE",A[A.OP_READ_WRITE=1]="OP_READ_WRITE"}(KA||(KA={}));class NA extends V{constructor(A="",g,I){super(),this.dirty=!1,this.boundInputs=[],this.boundOutputs=[],this.cleaning=!1,this.dirtyOpIndex=0,this.firstOP_WRITE=0,this.name=A,this.__value=g,this.dataType=I}getName(){return this.name}setName(A){if(A===this.name)return;const g=this.name;this.name=A,this.emit("nameChanged",{newName:this.name,prevName:g})}getOwner(){return this.ownerItem}setOwner(A){this.ownerItem=A}getPath(){return this.ownerItem&&this.ownerItem instanceof hA?[...this.ownerItem.getPath(),this.name]:[this.name]}getDataType(){return this.dataType}bindOperatorInput(A){this.boundInputs.push(A)}unbindOperatorInput(A){const g=this.boundInputs.indexOf(A);this.boundInputs.splice(g,1)}bindOperatorOutput(A,g=-1){-1==g&&(g=this.boundOutputs.length),this.boundOutputs.splice(g,0,A);for(let A=g;A<this.boundOutputs.length;A++)this.boundOutputs[A].setParamBindIndex(A);return this.__findFirstOP_WRITE(),this.dirtyOpIndex=this.boundOutputs.length,this.setDirty(g),g}unbindOperatorOutput(A){const g=A.getParamBindIndex();this.boundOutputs.splice(g,1);for(let A=g;A<this.boundOutputs.length;A++)this.boundOutputs[A].setParamBindIndex(A);return this.__findFirstOP_WRITE(),this.dirtyOpIndex=this.boundOutputs.length,this.setDirty(Math.max(0,g-1)),g}__findFirstOP_WRITE(){if(this.firstOP_WRITE=this.boundOutputs.length,this.boundOutputs.length>0)for(this.firstOP_WRITE--;this.firstOP_WRITE>0&&this.boundOutputs[this.firstOP_WRITE].getMode()!=KA.OP_WRITE;this.firstOP_WRITE--);}setDirty(A){if(A<this.dirtyOpIndex){let g=this.firstOP_WRITE;if(g<=A){for(this.dirtyOpIndex=g,g++;g<this.boundOutputs.length;g++)g!=A&&this.boundOutputs[g].getOperator().setDirty();for(let A=0;A<this.boundInputs.length;A++)this.boundInputs[A].setDirty();return this.emit("valueChanged"),!0}}return!1}isDirty(){return this.dirtyOpIndex<this.boundOutputs.length}getDirtyBindingIndex(){return this.dirtyOpIndex}setCleanFromOp(A,g){if(g!=this.dirtyOpIndex)if(g<this.dirtyOpIndex)console.log("Parameter is cleaned when it was already clean to that point in the stack:",this.getPath());else if(this.boundOutputs[g].getMode()!=KA.OP_WRITE){const A=this.getClassName(),I=this.boundOutputs[g].getOperator(),C=I.getClassName();throw new Error(`Parameter: ${A} with name: ${this.getName()} is not cleaning all outputs during evaluation of op: ${C} with name: ${I.getName()}`)}this.__value=A,this.dirtyOpIndex=g+1}getValueFromOp(A){return this.dirtyOpIndex<A&&this._clean(A),this.__value}_clean(A){if(this.cleaning)throw new Error(`Cycle detected when cleaning: ${this.getPath()}. Operators need to be rebound to fix errors`);for(this.cleaning=!0;this.dirtyOpIndex<A;){const A=this.dirtyOpIndex;if(this.boundOutputs[this.dirtyOpIndex].getOperator().evaluate(),A==this.dirtyOpIndex){const A=this.boundOutputs[this.dirtyOpIndex].getOperator(),g=A.getClassName();console.warn(`Operator: ${g} with name: ${A.getName()} is not cleaning its outputs during evaluation`),this.dirtyOpIndex++}}this.cleaning=!1}getValue(){return this.dirtyOpIndex<this.boundOutputs.length&&this._clean(this.boundOutputs.length),this.__value}setValue(A){if(null==A)throw"undefined was passed into the set value for param:"+this.getName();if(this.boundOutputs.length>0)for(let g=this.boundOutputs.length-1;g>=0;g--){const I=this.boundOutputs[g];if(A=I.backPropagateValue(A),0==I.getMode())return}if("object"==typeof A||this.__value!=A){this.__value=A;for(let A=0;A<this.boundInputs.length;A++)this.boundInputs[A].paramValueChanged();this.emit("valueChanged")}}get value(){return this.getValue()}set value(A){this.setValue(A)}loadValue(A){this.__value=A}copyFrom(A,g){this.loadValue(A.__value)}readBinary(A,g){console.warn(`TODO: Parameter: ${this.constructor.name} with name: ${this.name} does not implement readBinary`)}destroy(){console.warn("nothing destroyed. This method was not overwritten in subclass")}}class JA extends NA{constructor(A="",g=0,I,C){super(A,g,"Number"),this.range=I,this.step=C}getRange(){return this.range}setRange(A){this.range=A}getStep(){return this.step}setStep(A){this.step=A}toJSON(A){const g={value:this.__value};return this.range&&(g.range=this.range),this.step&&(g.step=this.step),g}fromJSON(A,g){this.__value=A.value,A.range&&(this.range=A.range),A.step&&(this.step=A.step)}readBinary(A,g){this.__value=A.loadFloat32()}clone(){return new JA(this.name,this.__value,this.range,this.step)}}e.register("NumberParameter",JA),e.register("Property_SInt32",class extends JA{readBinary(A,g){this.__value=A.loadSInt32()}}),e.register("Property_UInt32",class extends JA{readBinary(A,g){this.__value=A.loadUInt32()}}),e.register("Property_Float32",class extends JA{readBinary(A,g){this.__value=A.loadFloat32()}});class DA extends JA{constructor(A,g,I=[]){super(A,g,[0,I.length],1),this.choices=I}getChoices(){return this.choices}setValue(A){"string"==typeof A?super.setValue(this.choices.indexOf(A)):super.setValue(A)}}e.register("MultiChoiceParameter",DA);class fA extends NA{constructor(A="",g){super(A,null!=g&&g,"Boolean")}readBinary(A,g){this.__value=0!=A.loadUInt8()}toJSON(A){return{value:this.__value}}fromJSON(A,g){this.__value=A.value,this.emit("valueChanged",{mode:0})}clone(){return new fA(this.name,this.__value)}}e.register("BooleanParameter",fA),e.register("Property_Boolean",fA);class MA extends NA{constructor(A="",g,I){super(A,g||new B,"Vec2"),this.range=I}getRange(){return this.range}setRange(A){this.range=A,this.emit("rangeChanged",{range:A})}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{name:this.name,value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new B;I.fromJSON(A.value),this.__value=I,A.name&&(this.name=A.name)}clone(){var A;const g=new MA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone());return this.range&&g.setRange(this.range),g}}e.register("Vec2Parameter",MA),e.register("Property_Vec2_32f",MA);class LA extends NA{constructor(A="",g,I){super(A,g||new o,"Vec3"),this.range=I}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{name:this.name,value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new o;I.fromJSON(A.value),this.__value=I,A.name&&(this.name=A.name)}clone(){var A;return new LA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Vec3Parameter",LA),e.register("Property_Vec3_32f",LA);class UA extends NA{constructor(A="",g){super(A,g||new s,"Vec4")}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{name:this.name,value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new s;I.fromJSON(A.value),this.__value=I,A.name&&(this.name=A.name)}clone(){var A;return new UA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Vec4Parameter",UA),e.register("Property_Vec4_32f",UA);class vA extends NA{constructor(A="",g){super(A,g||new Q,"Box2")}readBinary(A,g){this.__value.p0.readBinary(A),this.__value.p1.readBinary(A)}toJSON(A){return{value:{p0:this.__value.p0.toJSON(),p1:this.__value.p1.toJSON()}}}fromJSON(A,g){this.__value.p0.fromJSON(A.p0),this.__value.p1.fromJSON(A.p1)}clone(){var A;return new vA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Box2Parameter",vA),e.register("Property_Box2_32f",vA);class kA extends NA{constructor(A="",g){super(A,g||new b,"Box3")}readBinary(A,g){this.__value.p0.readBinary(A),this.__value.p1.readBinary(A)}toJSON(A){return{value:{p0:this.__value.p0.toJSON(),p1:this.__value.p1.toJSON()}}}fromJSON(A,g){A.value&&(this.__value.p0.fromJSON(A.value.p0),this.__value.p1.fromJSON(A.value.p1))}clone(){var A;return new kA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Box3Parameter",kA),e.register("Property_Box3_32f",kA);class xA extends NA{constructor(A="",g){super(A,g||new l,"Color")}readBinary(A,g){const I=A.loadRGBAFloat32Color();I.applyGamma(2.2),this.__value=I}toJSON(A){var g;return{value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){var I;null===(I=this.__value)||void 0===I||I.fromJSON(A.value)}clone(){var A;return new xA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("ColorParameter",xA),e.register("Property_Color_32f",xA);class zA extends NA{constructor(A="",g){super(A,g||new c,"Quat")}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new c;I.fromJSON(A.value),this.__value=I}clone(){var A;return new zA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("QuatParameter",zA),e.register("Property_Quat_32f",zA);class TA extends NA{constructor(A="",g){super(A,g||new d,"Mat3")}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new d;I.fromJSON(A.value),this.__value=I}clone(){var A;return new TA(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Mat3Parameter",TA),e.register("Property_Mat3_32f",TA);class _A extends NA{constructor(A="",g){super(A,g||new h,"Mat4")}readBinary(A,g){var I;null===(I=this.__value)||void 0===I||I.readBinary(A)}toJSON(A){var g;return{value:null===(g=this.__value)||void 0===g?void 0:g.toJSON()}}fromJSON(A,g){const I=new h;I.fromJSON(A.value),this.__value=I}clone(){var A;return new _A(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone())}}e.register("Mat4Parameter",_A),e.register("Property_Mat4_32f",_A);class PA extends NA{constructor(A="",g){super(A,g||new m,"Xfo")}readBinary(A,g){this.__value.readBinary(A)}toJSON(A){return{name:this.name,value:this.__value.toJSON()}}fromJSON(A,g){const I=new m;I.fromJSON(A.value),this.__value=I,A.name&&(this.name=A.name)}clone(){return new PA(this.name,this.__value.clone())}}e.register("XfoParameter",PA),e.register("Property_Xfo_32f",PA);class OA extends NA{constructor(A="",g){super(A,g,"BaseImage")}toJSON(A){const g={name:this.name};return this.__value&&(g.imageType=this.__value.getClassName(),g.value=this.__value.toJSON()),g}fromJSON(A,g){var I;A.imageType&&(this.__value=e.constructClass(A.imageType),A.value&&(null===(I=this.__value)||void 0===I||I.fromJSON(A.value,g)))}clone(){return new OA(this.name,this.__value)}}e.register("ImageParameter",OA);class jA extends NA{constructor(A="",g=""){super(A,g,"String"),this.multiLine=!1}setMultiLine(A){this.multiLine=A}getMultiLine(){return this.multiLine}readBinary(A,g){this.__value=A.loadStr()}toJSON(A){return{value:this.__value}}fromJSON(A,g){this.__value=A.value?A.value:"",this.emit("valueChanged",{mode:0})}clone(){return new jA(this.name,this.__value)}}e.register("StringParameter",jA),e.register("Property_String",jA);class qA extends NA{constructor(A="",g=[]){super(A,g,"String[]")}readBinary(A,g){this.__value=A.loadStrArray()}toJSON(A){return{value:this.__value}}fromJSON(A,g){this.__value=A.value,this.emit("valueChanged",{mode:0})}clone(){return new qA(this.name,this.__value)}}e.register("StringListParameter",qA),e.register("Property_StringList",qA);class $A extends NA{constructor(A="",g){super(A,[],g)}filter(A){return!0}getCount(){var A;return(null===(A=this.__value)||void 0===A?void 0:A.length)||0}getElement(A){if(this.__value)return this.__value[A]}setElement(A,g){this.__value||(this.__value=[]),this.__value[A]=g,this.emit("valueChanged")}addElement(A){if((A||0==A)&&this.filter(A))return this.__value||(this.__value=[]),this.__value.push(A),this.emit("elementAdded",{elem:A,index:this.__value.length-1}),this.emit("valueChanged"),A}removeElement(A){this.__value||(this.__value=[]);const g=this.__value[A];this.__value.splice(A,1),this.emit("elementRemoved",{elem:g,index:A}),this.emit("valueChanged")}insertElement(A,g){this.__value&&this.filter(g)&&(this.__value.splice(A,0,g),this.emit("elementAdded",{elem:g,index:A}),this.emit("valueChanged"))}toJSON(A){const g=[];if(this.__value)for(const I of this.__value)"string"==typeof this.dataType?g.push(I):g.push(I.toJSON(A));return{value:g}}fromJSON(A,g){if(null!=A.items){this.__value=[];for(let I=0;I<A.items.length;I++){let C;if("string"==typeof this.dataType)C=A.items[I];else{if(!this.dataType)throw"No DataType";C=e.constructClass(this.dataType),C.fromJSON(A.items[I],g)}this.__value.push(C),this.emit("elementAdded",{elem:C,index:this.__value.length-1})}this.emit("valueChanged",{mode:0})}else console.warn("Invalid Parameter JSON")}clone(){const A=this.__value?this.__value.slice(0):[];if(!this.dataType)throw"This parameter does not have a DataType";const g=new $A(this.name,this.dataType);return g.setValue(A),g}destroy(){if(this.__value)for(let A=0;A<this.__value.length;A++)this.__value[A]instanceof NA&&this.__value[A].destroy(),this.removeElement(A)}}class Ag extends NA{constructor(A){super(A,{},"Struct"),this.members=[]}addMember(A){return this.__value&&(this.__value[A.getName()]=A.value),A.on("valueChanged",(()=>{this.__value&&(this.__value[A.getName()]=A.value)})),this.members.push(A),this.emit("valueChanged"),A}getParameter(A){for(const g of this.members)if(g.getName()==A)return g}getMember(A){return this.getParameter(A)}getMemberNames(){const A=[];for(let g=0;g<this.members.length;g++){const I=this.members[g];null!=I&&(A[g]=I.getName())}return A}toJSON(A){const g={},I=[];for(const g of this.members)I.push(g.toJSON(A));return g.members=I,g.name=this.name,g}fromJSON(A,g){if(null!=A.members){for(let I=0;I<A.members.length;I++)A.members[I]&&this.members[I].fromJSON(A.members[I],g);this.name=A.name}else console.warn("Invalid Parameter JSON")}clone(){return new Ag(this.name)}destroy(){for(const A of this.members)A.destroy()}}e.register("StructParameter",Ag);class gg extends V{constructor(A,g=KA.OP_WRITE){super(),this._op=null,this.__name=A,this._mode=g,this._param=void 0,this._paramBindIndex=-1,this.detached=!1}getName(){return this.__name}setOperator(A){this._op=A}getOperator(){return this._op}getMode(){return this._mode}isConnected(){return null!=this._param}getParam(){return this._param}setParam(A,g=-1){this._param&&this._param.unbindOperatorOutput(this),this._param=A,this._param&&(this._paramBindIndex=this._param.bindOperatorOutput(this,g)),this.emit("paramSet",{param:this._param})}getParamBindIndex(){return this._paramBindIndex}setParamBindIndex(A){this._paramBindIndex=A}setDirty(){this._param&&this._param.setDirty(this._paramBindIndex)}getValue(){if(this._param)return this._param.getValueFromOp(this._paramBindIndex);throw new Error("Cannot call getValue on OperatorOutput that is not connected:",this.__name)}backPropagateValue(A){return this._op&&(A=this._op.backPropagateValue(A)),A}setClean(A){this._param&&this._param.setCleanFromOp(A,this._paramBindIndex)}toJSON(A){const g=this._param?this._param.getPath():"";return{name:this.__name,paramPath:A&&A.makeRelative?A.makeRelative(g):g,paramBindIndex:this._paramBindIndex}}fromJSON(A,g){A.paramPath&&(null==g||g.resolvePath(A.paramPath,(g=>{this.setParam(g,A.paramBindIndex)}),(g=>{console.warn("OperatorOutput: '"+this.getName()+"'. Unable to connect to:"+A.paramPath)})))}detach(){this.detached=!0,this._paramBindIndex=this._param?this._param.unbindOperatorOutput(this):-1}reattach(){this.detached=!1,this._param&&(this._paramBindIndex=this._param.bindOperatorOutput(this,this._paramBindIndex))}rebind(){this._param&&(this._param.unbindOperatorOutput(this),this._paramBindIndex=this._param.bindOperatorOutput(this))}}class Ig extends gg{}class Cg extends gg{}class ig extends gg{}class eg extends hA{constructor(A=""){super(A),this.__inputs=new Map,this.__outputs=new Map}setDirty(){this.__outputs.forEach((A=>A.setDirty()))}parameterValueChanged(A){super.parameterValueChanged(A),this.setDirty()}addInput(A){return A.setOperator(this),this.__inputs.set(A.getName(),A),this.setDirty(),A}removeInput(A){"string"==typeof A&&(A=this.getInput(A)),A.getParam()&&A.setParam(void 0),this.__inputs.delete(A.getName())}getNumInputs(){return this.__inputs.size}getInputByIndex(A){return Array.from(this.__inputs.values())[A]}getInput(A){const g=this.__inputs.get(A);if(!g)throw`Couldn't find an Input with the name of '${A}'`;return g}addOutput(A){return A.setOperator(this),this.__outputs.set(A.getName(),A),this.setDirty(),A}removeOutput(A){if("string"==typeof A&&(A=this.getOutput(A)),!(A instanceof gg))throw new Error("removeOutput only accepts string or OperatorInput");A.getParam()&&A.setParam(),this.__outputs.delete(A.getName())}getNumOutputs(){return this.__outputs.size}getOutputByIndex(A){return Array.from(this.__outputs.values())[A]}getOutput(A){const g=this.__outputs.get(A);if(!g)throw new Error(`Couldn't find an Output with the name of '${A}'`);return g}evaluate(){throw new Error("Not yet implemented")}backPropagateValue(A){return A}toJSON(A){const g=super.toJSON(A);g.type=this.getClassName();const I=[];this.__inputs.forEach((g=>{I.push(g.toJSON(A))})),g.inputs=I;const C=[];return this.__outputs.forEach((g=>{C.push(g.toJSON(A))})),g.outputs=C,g}fromJSON(A,g){super.fromJSON(A,g),A.inputs&&A.inputs.forEach(((A,I)=>{let C;A.name?(C=this.getInput(A.name),C||(C=this.addInput(A.name))):C=this.getInputByIndex(I),C.fromJSON(A,g)})),A.outputs&&A.outputs.forEach(((A,I)=>{let C;A.name?(C=this.getOutput(A.name),C||(C=this.addOutput(A.name))):C=this.getOutputByIndex(I),C.fromJSON(A,g)}))}detach(){this.__inputs.forEach((A=>A.detach())),this.__outputs.forEach((A=>A.detach()))}reattach(){this.__inputs.forEach((A=>A.reattach())),this.__outputs.forEach((A=>A.reattach()))}rebind(){this.__outputs.forEach((A=>A.rebind()))}}class tg extends V{constructor(A){super(),this.detached=!1,this.name=A}getName(){return this.name}setOperator(A){this._op=A}getOperator(){return this._op}isConnected(){return null!=this.param}getParam(){return this.param}paramValueChanged(){this._op&&this._op.setDirty()}setParam(A){this.param&&this.param.unbindOperatorInput(this),this.param=A,this.param&&this.param.bindOperatorInput(this),this.emit("paramSet",{param:this.param})}getValue(){if(this.param)return this.param.value;throw new Error("Unable to getValue")}setValue(A){this.param&&this.param.setValue(A)}setDirty(){this._op&&this._op.setDirty()}toJSON(A){const g=this.param?this.param.getPath():[],I=A&&A.makeRelative?A.makeRelative(g):g;return{name:this.name,paramPath:I}}fromJSON(A,g){A.paramPath&&(null==g||g.resolvePath(A.paramPath,(A=>{this.setParam(A)}),(()=>{console.warn("OperatorInput: '"+this.getName()+"'. Unable to connect to:"+A.paramPath)})))}detach(){this.param&&this.param.unbindOperatorInput(this)}reattach(){this.detached=!1,this.param&&this.param.bindOperatorInput(this)}}class Bg extends tg{}class og extends eg{constructor(A,g){super("CalcGlobalXfoOperator"),this.parentGlobal=new Bg("ParentGlobal"),this.localXfo=new Bg("LocalXfo"),this.globalXfo=new Cg("GlobalXfo"),this.localXfo.setParam(g),this.globalXfo.setParam(A),this.addInput(this.parentGlobal),this.addInput(this.localXfo),this.addOutput(this.globalXfo)}backPropagateValue(A){if(this.parentGlobal.isConnected()){const g=this.parentGlobal.getValue();this.localXfo.setValue(g.inverse().multiply(A))}else this.localXfo.setValue(A)}evaluate(){const A=this.localXfo.getValue();if(this.parentGlobal.isConnected()){const g=this.parentGlobal.getValue();this.globalXfo.setClean(g.multiply(A))}else this.globalXfo.setClean(A)}}e.register("CalcGlobalXfoOperator",og);class sg extends kA{constructor(A="",g){super(A),this.dirty=!0,this.treeItem=g}setDirty(A){return this.dirty||(this.dirty=!0,this.emit("valueChanged")),!0}getValue(){return this.dirty&&(this.__value=this.treeItem._cleanBoundingBox(),this.dirty=!1),this.__value}clone(){var A;const g=new sg(this.name,this.treeItem);return g.value=null===(A=this.__value)||void 0===A?void 0:A.clone(),g}loadValue(A){this.__value=A.clone()}}class ag extends hA{constructor(A){super(A),this.disableBoundingBox=!1,this.__childItems=[],this.__childItemsEventHandlers=[],this.__childItemsMapping={},this.__childItemsMappingCorrupt=!1,this.globalXfoParam=new PA("GlobalXfo",new m),this.localXfoParam=new PA("LocalXfo",new m),this.boundingBoxParam=new sg("BoundingBox",this),this.visibleParam=new fA("Visible",!0),this.opacityParam=new JA("Opacity",1,[0,1]),this.__highlightMapping={},this.__highlights=[],this.__visible=!0,this.__visibleCounter=1,this.__opacity=1,this.addParameter(this.visibleParam),this.addParameter(this.opacityParam),this.addParameter(this.localXfoParam),this.addParameter(this.globalXfoParam),this.addParameter(this.boundingBoxParam),this.globalXfoOp=new og(this.globalXfoParam,this.localXfoParam),this.globalXfoParam.on("valueChanged",(A=>{this.setBoundingBoxDirty(),this.emit("globalXfoChanged",A)})),this.visibleParam.on("valueChanged",(()=>{this.__visibleCounter+=this.visibleParam.value?1:-1,this.updateVisibility()})),this.opacityParam.on("valueChanged",(()=>{this.updateOpacity()}))}setOwner(A){if(this.__ownerItem){const A=this.__ownerItem;if(A&&A instanceof ag){A.isVisible()||this.__visibleCounter++;const g=A.getChildIndex(this);g>=0&&A.unbindChild(g,this)}}if(super.setOwner(A),this.__ownerItem){const A=this.__ownerItem;A&&(A.isVisible()||this.__visibleCounter--,this.globalXfoOp.getInput("ParentGlobal").setParam(A.globalXfoParam))}else this.globalXfoOp.getInput("ParentGlobal").setParam(void 0);this.updateVisibility()}updatePath(){super.updatePath();for(const A of this.__childItems)A&&A.updatePath()}getParentItem(){return this.getOwner()}setParentItem(A){this.setOwner(A)}isVisible(){return this.__visibleCounter>0}setVisible(A){this.visibleParam.value=A}propagateVisibility(A){this.__visibleCounter+=A,this.updateVisibility()}updateVisibility(){const A=this.__visibleCounter>0;if(A!=this.__visible){this.__visible=A;for(const A of this.__childItems)A.propagateVisibility(this.__visible?1:-1);this.emit("visibilityChanged",new O(A));const g=this.__ownerItem;return g&&g instanceof ag&&g.setBoundingBoxDirty(),!0}return!1}get opacity(){return this.__opacity}isOpaque(){return this.__opacity>.999}updateOpacity(){const A=this.__opacity>.999,g=this.getParentItem();this.__opacity=g?this.opacityParam.value*g.__opacity:this.opacityParam.value;for(const A of this.__childItems)A.updateOpacity();const I=this.__opacity>.999;this.emit("opacityChanged",new _(I,A!=I))}addHighlight(A,g,I=!1){if(A in this.__highlightMapping)if(this.__highlights[this.__highlights.length-1]!=A){const I=this.__highlights.indexOf(A);this.__highlights.splice(I,1),this.__highlights.push(A),this.emit("highlightChanged",{name:A,color:g})}else this.__highlightMapping[A].isEqual(g)||(this.__highlightMapping[A]=g,this.emit("highlightChanged",{name:A,color:g}));else this.__highlights.push(A),this.__highlightMapping[A]=g,this.emit("highlightChanged",{name:A,color:g});I&&this.__childItems.forEach((C=>{C.addHighlight(A,g,I)}))}removeHighlight(A,g=!1){if(A in this.__highlightMapping){if(this.__highlights[this.__highlights.length-1]==A)if(this.__highlights.pop(),delete this.__highlightMapping[A],this.__highlights.length>0){const A=this.__highlights[this.__highlights.length-1],g=this.__highlightMapping[A];this.emit("highlightChanged",{name:A,color:g})}else this.emit("highlightChanged");else{const g=this.__highlights.indexOf(A);this.__highlights.splice(g,1),delete this.__highlightMapping[A],this.emit("highlightChanged")}g&&this.__childItems.forEach((I=>{I.removeHighlight(A,g)}))}}getHighlight(){return 0==this.__highlights.length?null:this.__highlightMapping[this.__highlights[this.__highlights.length-1]]}getHighlightName(){return 0==this.__highlights.length?null:this.__highlights[this.__highlights.length-1]}isHighlighted(){return this.__highlights.length>0}_cleanBoundingBox(){const A=new b;return this.__childItems.forEach((g=>{if(g.isVisible()){const I=g.boundingBoxParam.value;I&&A.addBox3(I)}})),A}setBoundingBoxDirty(){this.boundingBoxParam&&this.boundingBoxParam.setDirty(-1);const A=this.__ownerItem;A&&A instanceof ag&&A.setBoundingBoxDirty()}getChildren(){return this.__childItems}getNumChildren(){return this.__childItems.length}generateUniqueName(A){if(!(A in this.__childItemsMapping))return A;let g=1;A.length>4&&!Number.isNaN(parseInt(A.substring(A.length-4)))?g=parseInt(A.substr(A.length-4)):A.length>3&&!Number.isNaN(parseInt(A.substring(A.length-3)))?g=parseInt(A.substr(A.length-3)):A.length>2&&!Number.isNaN(parseInt(A.substring(A.length-2)))&&(g=parseInt(A.substr(A.length-2)));const I=[];for(const A of this.__childItems)A&&I.push(A.getName());let C=A;for(;;){let i=""+g;for(;i.length<2;)i="0"+i;if(C=A+i,!I.includes(C))break;g++}return C}updateChildNameMapping(A){for(let g=A;g<this.__childItems.length;g++)this.__childItemsMapping[this.__childItems[g].getName()]=g}childNameChanged(A){if(this.__childItemsMappingCorrupt)this.updateChildNameMapping(0),this.__childItemsMappingCorrupt=!1;else{const g=this.__childItemsMapping[A.oldName];null!=this.__childItemsMapping[A.newName]&&(this.__childItemsMappingCorrupt=!0),delete this.__childItemsMapping[A.oldName],this.__childItemsMapping[A.newName]=g}}insertChild(A,g,I=!1,C=!0){if(A.getName()in this.__childItemsMapping){if(!C)throw new Error("Item '"+A.getName()+"' is already a child of :"+this.getPath());A.setName(this.generateUniqueName(A.getName()))}if(!(A instanceof ag))throw new Error("Object is is not a tree item :"+A);const i={};if(i.nameChanged=A.on("nameChanged",(A=>{this.childNameChanged(A)})),I){const g=this.globalXfoParam.value,I=A.globalXfoParam.value,C=g.inverse().multiply(I);A.localXfoParam.value=C}this.setBoundingBoxDirty(),this.__highlights.forEach((g=>{const I=this.__highlightMapping[g];A.addHighlight(g,I,!0)})),this.__childItems.splice(g,0,A),this.__childItemsEventHandlers.splice(g,0,i);const e=A.getName();return this.__childItemsMapping[e]&&(this.__childItemsMappingCorrupt=!0),this.__childItemsMapping[e]=g,this.updateChildNameMapping(g),A.setOwner(this),this.emit("childAdded",new oA(g,A)),A}addChild(A,g=!0,I=!0){const C=this.__childItems.length;return this.insertChild(A,C,g,I),A}getChild(A){return this.__childItems[A]}getChildByName(A){const g=this.__childItemsMapping[A];return null!=g?this.__childItems[g]:null}getChildNames(){const A=[];for(let g=0;g<this.__childItems.length;g++){const I=this.__childItems[g];null!=I&&(A[g]=I.getName())}return A}unbindChild(A,g){const I=this.__childItemsEventHandlers[A];for(const A in I)g.removeListenerById(A,I[A]);this.__childItems.splice(A,1),this.__childItemsEventHandlers.splice(A,1),delete this.__childItemsMapping[g.getName()],this.updateChildNameMapping(A),this.setBoundingBoxDirty(),this.emit("childRemoved",{childItem:g,index:A})}removeChild(A){const g=this.__childItems[A];g&&(this.unbindChild(A,g),g.setOwner(void 0))}removeChildByName(A){const g=this.__childItemsMapping[A];if(null!=g)return this.removeChild(g)}removeChildByHandle(A){const g=this.__childItems.indexOf(A);if(-1==g)throw new Error("Error in removeChildByHandle. Child not found:"+A.getName());this.removeChild(g)}removeAllChildren(){let A=this.__childItems.length;for(;A--;)this.removeChild(A);this.setBoundingBoxDirty()}getChildIndex(A){return this.__childItems.indexOf(A)}resolvePath(A,g=0,I=!1){if("string"==typeof A&&(A=A.split("/")),0==g)if("."==A[0]||A[0]==this.__name)g++;else if(".."==A[0]){if(this.__ownerItem)return this.__ownerItem.resolvePath(A,g+1);if(I)throw Error("this.__ownerItem is undefined");console.warn("this.__ownerItem is undefined")}if(g==A.length)return this;const C=A[g],i=this.getChildByName(C);if(null==i){const I=this.getParameter(A[g]);if(I)return I;throw new Error(`Unable to resolve path : [${A.toString()}] after: ${this.getName()} \nNo child or parameter called : "${A[g]}"`)}return i.resolvePath(A,g+1)}traverse(A,g=!0){const I=(A,g)=>{const I=A.getChildren();for(const A of I)A&&C(A,g+1)},C=(g,C)=>{0!=A(g,C)&&I(g,C)};g?C(this,1):I(this,0)}onPointerDown(A){this.emit("pointerDown",A);const g=this.__ownerItem;A.propagating&&g&&g.onPointerDown(A)}onPointerUp(A){this.emit("pointerUp",A);const g=this.__ownerItem;A.propagating&&g&&g.onPointerUp(A)}onPointerMove(A){this.emit("pointerMove",A);const g=this.__ownerItem;A.propagating&&g&&g.onPointerMove(A)}onPointerEnter(A){this.emit("pointerEnter",A);const g=this.__ownerItem;A.propagating&&g&&g.onPointerEnter(A)}onPointerLeave(A){this.emit("pointerLeave",A);const g=this.__ownerItem;A.propagating&&g&&g.onPointerLeave(A)}onWheel(A){this.emit("mouseWheel",A);const g=this.__ownerItem;A.propagating&&g&&g.onWheel(A)}onTouchCancel(A){this.emit("touchCancel",A);const g=this.__ownerItem;A.propagating&&g&&g.onTouchCancel(A)}toJSON(A){let g=super.toJSON(A);const I={};for(const g of this.__childItems)if(g){const C=g.toJSON(A);C&&(I[g.getName()]=C)}return Object.keys(I).length>0&&(g?g.children=I:g={name:this.__name,children:I}),g}fromJSON(A,g,I){if(super.fromJSON(A,g),null!=A.children){const I=A.children;if(Array.isArray(I))for(const A of I){let I=this.getChildByName(A.name);I?I.fromJSON(A,g):A.type&&(I=e.constructClass(A.type),I&&(I.fromJSON(A,g),this.addChild(I,!1,!1)))}else for(const A in I){const C=I[A];let i=this.getChildByName(A);i?i.fromJSON(C,g):C.type&&(i=e.constructClass(C.type),i&&(i.fromJSON(C,g),this.addChild(i,!1,!1)))}}}readBinary(A,g){super.readBinary(A,g);const I=A.loadUInt8();this.setVisible(0!=(2&I));if(4&I){const g=new m;if(g.tr=A.loadFloat32Vec3(),g.ori=A.loadFloat32Quat(),32&I)g.sc=A.loadFloat32Vec3();else{const I=A.loadFloat32();g.sc.set(I,I,I)}this.localXfoParam.value=g}8&I&&this.boundingBoxParam.loadValue(new b(A.loadFloat32Vec3(),A.loadFloat32Vec3()));const C=A.loadUInt32();if(C>0){const I=A.loadUInt32Array(C);for(let i=0;i<C;i++)try{A.seek(I[i]);let C=A.loadStr();const t=e.constructClass(C);if(!t){const g=A.loadStr();console.warn("Unable to construct child:"+g+" of type:"+C);continue}A.seek(I[i]),t.readBinary(A,g),this.addChild(t,!1,!0)}catch(A){console.warn("Error loading tree item: ",A)}}}clone(A){const g=new ag("");return g.copyFrom(this,A),g}copyFrom(A,g){super.copyFrom(A,g),A.getChildren().forEach((A=>{A&&this.addChild(A.clone(g),!1,!1)}))}}e.register("TreeItem",ag);class lg extends NA{constructor(A="",g){super(A,void 0,"TreeItem"),this.listenerIDs={},this.owner=new ag(""),this.filterFn=g}emitTreeItemGlobalXfoChanged(A){this.emit("treeItemGlobalXfoChanged",A)}setOwner(A){this.owner=A}getOwner(){return this.owner}setFilterFn(A){this.filterFn=A}getFilterFn(){return this.filterFn}setValue(A){this.filterFn&&!this.filterFn(A)||this.__value!==A&&(this.__value&&this.__value.removeListenerById("globalXfoChanged",this.listenerIDs.globalXfoChanged),this.__value=A,this.__value&&(this.listenerIDs.globalXfoChanged=this.__value.on("globalXfoChanged",(A=>{this.emitTreeItemGlobalXfoChanged(A)}))),this.emit("valueChanged"))}toJSON(A){var g;return{value:A.makeRelative(null===(g=this.__value)||void 0===g?void 0:g.getPath())}}fromJSON(A,g){null!=A.value?g.resolvePath(A.value,(A=>{this.setValue(A)}),(()=>{console.warn("Unable to resolve tree item parameter value:"+A.paramPath)})):console.warn("Invalid Parameter JSON")}clone(A){const g=new lg(this.name,this.filterFn);return this.__value&&g.setValue(this.__value.clone(A)),g}}e.register("TreeItemParameter",lg);class ng extends R{constructor(A,g){super(),this.index=g,this.item=A}}class dg extends NA{constructor(A="",g){super(A,new Set,"TreeItem"),this.filterFn=g}setFilterFn(A){this.filterFn=A}getFilterFn(){return this.filterFn}getItem(A){return Array.from(this.__value)[A]}addItem(A,g=!0){if(this.filterFn&&!this.filterFn(A))return void console.warn("ItemSet __filterFn rejecting item:",A.getPath());this.__value.add(A);const I=Array.from(this.__value).indexOf(A);return this.emit("itemAdded",new ng(A,I)),g&&this.emit("valueChanged"),I}addItems(A,g=!0){A.forEach((A=>this.addItem(A,!1))),g&&this.emit("valueChanged")}removeItem(A,g=!0){const I=Array.from(this.__value)[A];return this.__value.delete(I),this.emit("itemRemoved",new ng(I,A)),g&&this.emit("valueChanged"),I}setItems(A,g=!0){const I=Array.from(this.__value);for(let g=I.length-1;g>=0;g--){const C=I[g];A.has(C)||this.removeItem(g,!1)}for(const g of A)this.__value.has(g)||this.addItem(g,!1);g&&this.emit("valueChanged")}clearItems(A=!0){this.__value.clear(),A&&this.emit("valueChanged")}getNumItems(){return this.__value.size}toJSON(A){this.__value||(this.__value=new Set);const g=[];if(A)for(const A of this.__value)g.push(A.getPath());return{value:g}}fromJSON(A,g){if(g)for(const I in A.value){const A=g.resolvePath(I);this.__value.add(A)}}clone(){return new dg(this.name,this.filterFn)}}class hg extends NA{constructor(A="",g){super(A,g,"Geometry"),this.listenerIDs={},g&&this.setValue(g)}emitBoundingBoxDirtied(A){this.emit("boundingBoxChanged",A)}setValue(A){this.__value!==A&&(this.__value&&this.__value.removeListenerById("boundingBoxChanged",this.listenerIDs.boundingBoxChanged),this.__value=A,this.__value&&(this.listenerIDs.boundingBoxChanged=this.__value.on("boundingBoxChanged",(A=>{this.emitBoundingBoxDirtied(A)}))),this.emit("valueChanged"))}loadValue(A){this.__value&&this.__value.removeListenerById("boundingBoxChanged",this.listenerIDs.boundingBoxChanged),this.__value=A,this.__value&&(this.listenerIDs.boundingBoxChanged=this.__value.on("boundingBoxChanged",(A=>{this.emitBoundingBoxDirtied(A)})))}toJSON(A){var g;return{name:this.name,value:null===(g=this.__value)||void 0===g?void 0:g.toJSON(A)}}fromJSON(A,g){A.name&&(this.name=A.name);const I=e.constructClass(A.value.type);I.fromJSON(A.value,g),this.__value=I}clone(){return new hg(this.name,this.__value)}}e.register("GeometryParameter",hg);class cg extends NA{constructor(A=""){super(A,"","FilePath")}getFilename(){if(!this.__value)throw"No file value";return this.__value.lastIndexOf("/")>-1?this.__value.substring(this.__value.lastIndexOf("/")+1):""}getExt(){const A=this.getFilename(),g=A.lastIndexOf(".");if(-1!=g)return A.substring(g).toLowerCase()}getStem(){const A=this.getFilename();if(A){const g=A.split(".");return 2==g.length?g[0]:A}return null}setValue(A){if(!A)throw new Error("Invalid value for setValue.");A!=this.__value&&(this.__value=A,this.emit("valueChanged"))}toJSON(A){return{value:this.__value}}fromJSON(A,g){A.value&&(this.__value=A.value)}clone(){const A=new cg(this.name);return this.__value&&A.setValue(this.__value),A}}e.register("FilePathParameter",cg);class rg extends NA{constructor(A="",g){super(A,g,"Material"),this.listenerIDs={},g&&this.setValue(g)}valueParameterValueChanged(A){this.emit("valueParameterValueChanged",A)}setValue(A){this.__value!==A&&(this.__value&&this.__value.removeListenerById("parameterValueChanged",this.listenerIDs.parameterValueChanged),this.__value=A,this.__value&&(this.listenerIDs.parameterValueChanged=this.__value.on("parameterValueChanged",(A=>{this.valueParameterValueChanged(A)}))),this.emit("valueChanged"))}loadValue(A){this.__value&&this.__value.removeListenerById("parameterValueChanged",this.listenerIDs.parameterValueChanged),this.__value=A,this.__value&&(this.listenerIDs.parameterValueChanged=this.__value.on("parameterValueChanged",(A=>{this.valueParameterValueChanged(A)})))}toJSON(A){let g={};return g.name=this.name,this.__value&&(g={value:A&&A.onlyPath?this.__value.getPath():this.__value.toJSON(A)}),g}fromJSON(A,g){if(null!=A.value)if(A.value instanceof Array||A.value instanceof String){if(g&&g.assetItem){const I=g.assetItem.getMaterialLibrary().getMaterial(A.value instanceof Array?A.value[1]:A.value);I&&this.loadValue(I)}}else{const I=e.constructClass(A.value.type);A.value&&I.fromJSON(A.value,g),this.loadValue(I)}else console.warn("Invalid Parameter JSON")}clone(){return new rg(this.name,this.__value)}}e.register("MaterialParameter",rg);class Gg extends hA{constructor(A){super(A),this.width=0,this.height=0,this.format="RGB",this.type="UNSIGNED_BYTE",this.loaded=!1,this.mipMapped=!0,this.wrapS="REPEAT",this.wrapT="REPEAT",this.minFilter="LINEAR",this.magFilter="LINEAR",this.alphaFromLuminance=!1,this.on("parameterValueChanged",(()=>{this.emit("updated")}))}isLoaded(){return this.loaded}getParams(){return{type:this.type,format:this.format,width:this.width,height:this.height,wrapS:this.wrapS,wrapT:this.wrapT,minFilter:this.minFilter,magFilter:this.magFilter,mipMapped:this.mipMapped,alphaFromLuminance:this.alphaFromLuminance}}}class mg extends JA{constructor(A="",g,I){super(A,g,I)}getImage(){return this.image}setImage(A){const g=()=>{this.emit("textureDisconnected")};A?(null!=this.image&&this.image!==A&&g(),this.image=A,this.emit("textureConnected"),this.emit("valueChanged",{mode:0})):null!=this.image&&(g(),this.image=void 0,this.emit("textureDisconnected"))}setValue(A){A instanceof Gg?this.setImage(A):super.setValue(A)}readBinary(A,g){super.readBinary(A,g);const I=A.loadStr();""!=I&&(console.log("Load Texture"),this.setImage(g.assetItem.materialLibrary.getImage(I)))}clone(){return new mg(this.name,this.__value,this.range)}}e.register("MaterialFloatParam",mg),function(A){A.Gamma="Gamma",A.Linear="Linear"}(pA||(pA={}));class Qg extends xA{constructor(A,g){super(A,g),this.listenerIDs={},this.colorSpace=pA.Gamma}getImage(){return this.image}imageUpdated(){this.emit("valueChanged")}setImage(A){const g=()=>{this.image&&(this.image.removeListenerById("updated",this.listenerIDs.updated),this.image=void 0),this.emit("textureDisconnected")};A?(null!=this.image&&this.image!==A&&g(),this.image=A,this.listenerIDs.updated=this.image.on("updated",(()=>{this.imageUpdated()})),this.emit("textureConnected"),this.emit("valueChanged")):null!=this.image&&(g(),this.image=void 0,this.emit("textureDisconnected"))}setValue(A){A instanceof Gg?this.setImage(A):super.setValue(A)}readBinary(A,g){super.readBinary(A,g);const I=A.loadStr();""!=I&&this.setImage(g.assetItem.materialLibrary.getImage(I)),this.colorSpace=pA.Linear}clone(){var A;const g=new Qg(this.name,null===(A=this.__value)||void 0===A?void 0:A.clone());return g.colorSpace=this.colorSpace,g}}function Eg(A,g){return!A.some(((A,I)=>Math.abs(g[I]-A)>.001))}e.register("MaterialColorParam",Qg);class bg extends u{constructor(A,g){super(),this.data=new Float32Array(0),this.dataTypeName=A,this.stride=g,this.initRange(0),this.splits={},this.splitValues=[]}setMesh(A){this.mesh=A}asArray(){return this.data}getDataTypeName(){return this.dataTypeName}getCount(){return this.data.length/this.stride}setCount(A){const g=this.data.length,I=A*this.stride;if(I>g){const A=new Float32Array(I);A.set(this.data,0),this.data=A,this.initRange(g)}else I<g&&(this.data=this.data.slice(0,I));this.splits={},this.splitValues=[]}initRange(A){for(let g=A;g<this.data.length;g++)this.data[g]=Number.NaN}get numElements(){return this.stride}getFloat32Value(A){return this.data[A]}setFloat32Value(A,g){this.data[A]=g}getSplits(){return this.splits}getFaceVertexValueRef_array(A,g){const I=this.mesh.getFaceVertexIndex(A,g);return I in this.splits&&A in this.splits[I]?this.splitValues[this.splits[I][A]]:this.data.subarray(I*this.stride,(I+1)*this.stride)}setFaceVertexValue_array(A,g,I){const C=this.mesh.getFaceVertexIndex(A,g);this.setFaceVertexValue_ByVertexIndex(A,C,I)}setFaceVertexValue_ByVertexIndex(A,g,I){const C=this.data.subarray(g*this.stride,(g+1)*this.stride);if(function(A){for(let g=0;g<A.length;g++)if(!Number.isNaN(A[g]))return!0;return!1}(C))if(Eg(C,I));else{if(g in this.splits){const C=this.splits[g];for(const g in C){const i=C[g];if(Eg(this.splitValues[i],I))return void(C[A]=i)}if(A in this.splits[g])return void(this.splitValues[this.splits[g][A]]=I)}else this.splits[g]={};this.splits[g][A]=this.splitValues.length,this.splitValues.push(I)}else C.set(I)}setSplitVertexValue_array(A,g,I){if(A in this.splits||(this.splits[A]={}),g in this.splits[A]){if(Eg(this.splitValues[this.splits[A][g]],I))return;console.warn("Face Vertex Already Split with different value")}this.splits[A][g]=this.splitValues.length,this.splitValues.push(I)}setSplitVertexValues(A,g,I){A in this.splits||(this.splits[A]={});const C=this.splitValues.length;this.splitValues.push(I);for(const I of g)this.splits[A][I]=C}generateSplitValues(A,g){if(0==g)return this.data;const I=this.getCount(),C=new Float32Array((I+g)*this.stride);C.set(this.data);for(const g in A){const i=A[g];for(const A in i){const e=I+i[A];if(g in this.splits&&A in this.splits[g]){const I=this.splits[g][A];this.splitValues[I].forEach(((A,g)=>{C[e*this.stride+g]=A}))}else{const A=parseInt(g);for(let g=0;g<this.stride;g++)C[e*this.stride+g]=this.data[A*this.stride+g]}}}return C}toJSON(A){return{data:this.data,dataType:this.dataTypeName,length:this.data.length/this.stride}}fromJSON(A){const g=A.data.map((A=>r.isNumeric(A)?A:Number.POSITIVE_INFINITY));this.data=Float32Array.from(g)}loadSplitValues(A){const g=A.loadUInt32Array();if(0==g.length)return;let I=0,C=0;for(;;){const A=g[I++],i=g[I++],e={};for(let A=0;A<i;A++){const A=g[I++],i=g[I++];e[A]=i,i>=C&&(C=i+1)}if(this.splits[A]=e,I>=g.length)break}const i=this.stride,e=A.loadFloat32Array(C*i);this.splitValues=[];for(let A=0;A<C;A++){const g=e.slice(A*i,A*i+i);this.splitValues.push(g)}}toString(){return JSON.stringify(this.toJSON(),null,2)}genBuffer(){return{values:this.data,count:this.getCount(),dataType:this.dataTypeName,normalized:this.normalized}}}class Zg extends bg{constructor(){super("Vec3",3),this.normalized=!1}getValueRef(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.subarray(g,g+this.stride);return new o(I)}getValue(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.slice(g,g+this.stride);return new o(I)}setValue(A,g){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const I=A*this.stride;this.data.set(g.asArray(),I)}getFaceVertexValueRef(A,g){const I=this.getFaceVertexValueRef_array(A,g);return new o(I)}setFaceVertexValue(A,g,I){this.setFaceVertexValue_array(A,g,I.asArray())}setSplitVertexValue(A,g,I){this.setSplitVertexValue_array(A,g,I.asArray())}}e.register("Vec3Attribute",Zg);class yg extends bg{constructor(){super("Vec2",2),this.normalized=!1}getValueRef(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.subarray(g,g+this.stride);return new B(I)}getValue(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.slice(g,g+this.stride);return new B(I)}setValue(A,g){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const I=A*this.stride;this.data.set(g.asArray(),I)}getFaceVertexValueRef(A,g){const I=this.getFaceVertexValueRef_array(A,g);return new B(I)}setFaceVertexValue(A,g,I){this.setFaceVertexValue_array(A,g,I.asArray())}setSplitVertexValue(A,g,I){this.setSplitVertexValue_array(A,g,I.asArray())}}e.register("Vec2Attribute",yg);const ug=(A,g,I,C,i)=>{for(let e=A[0];e<A[1];e++){const A=new o(C[3*e+0]/255,C[3*e+1]/255,C[3*e+2]/255);A.multiplyInPlace(I),A.addInPlace(g),i.setValue(e,A)}},Rg=(A,g,I,C,i)=>{for(let e=A[0];e<A[1];e++){const A=new o(C[3*e+0]/65535,C[3*e+1]/65535,C[3*e+2]/65535);A.multiplyInPlace(I),A.addInPlace(g),i.setValue(e,A)}},Vg=(A,g,I,C,i)=>{I.isNull()&&I.set(1,1,1);for(let e=A[0];e<A[1];e++){const A=new o(C[3*e+0]/255,C[3*e+1]/255,C[3*e+2]/255);A.multiplyInPlace(I),A.addInPlace(g),A.normalizeInPlace(),i.setValue(e,A)}},Fg=(A,g,I,C,i)=>{for(let e=A[0];e<A[1];e++){const A=new B(C[2*e+0]/255,C[2*e+1]/255);A.multiplyInPlace(I),A.addInPlace(g),i.setValue(e,A)}},Sg=(A,g,I,C,i)=>{for(let e=A[0];e<A[1];e++){const A=new B(C[2*e+0]/65535,C[2*e+1]/65535);A.multiplyInPlace(I),A.addInPlace(g),i.setValue(e,A)}};class wg extends nA{constructor(){super(),this.__boundingBox=new b,this.__boundingBoxDirty=!0,this.__metaData=new Map,this.__name="",this.__numVertices=0,this.__vertexAttributes=new Map,this.debugColor=new l(1,0,0,1),this.name="",this.addVertexAttribute("positions",new Zg)}clear(){this.setNumVertices(0)}setDebugName(A){this.name=A}addVertexAttribute(A,g){g.setCount(this.__numVertices),this.__vertexAttributes.set(A,g)}hasVertexAttribute(A){return this.__vertexAttributes.has(A)}getVertexAttribute(A){return this.__vertexAttributes.get(A)}getVertexAttributes(){const A={};for(const[g,I]of this.__vertexAttributes.entries())A[g]=I;return A}get positions(){return this.__vertexAttributes.get("positions")}numVertices(){return this.__numVertices}getNumVertices(){return this.__numVertices}setNumVertices(A){this.__numVertices=A,this.__vertexAttributes.forEach((A=>A.setCount(this.__numVertices))),this.setBoundingBoxDirty()}getBoundingBox(){return this.__boundingBoxDirty&&this.updateBoundingBox(),this.__boundingBox}setBoundingBoxDirty(){this.__boundingBoxDirty=!0,this.emit("boundingBoxChanged")}updateBoundingBox(){const A=this.positions,g=new b;if(A){const I=A.getCount();for(let C=0;C<I;C++)g.addPoint(A.getValueRef(C))}this.__boundingBox=g,this.__boundingBoxDirty=!1}getMetadata(A){return this.__metaData.get(A)}hasMetadata(A){return this.__metaData.has(A)}setMetadata(A,g){this.__metaData.set(A,g)}deleteMetadata(A){this.__metaData.delete(A)}genBuffers(A){const g={};for(const[A,I]of this.__vertexAttributes)g[A]=I.genBuffer();return{numVertices:this.numVertices(),attrBuffers:g}}freeBuffers(){}loadBaseGeomBinary(A,g){this.name=A.loadStr();const I=A.loadUInt8();this.debugColor=A.loadRGBFloat32Color();const C=A.loadUInt32();this.__boundingBox.set(A.loadFloat32Vec3(),A.loadFloat32Vec3()),this.setNumVertices(C);const i=this.positions;let e,t;2&I&&(e=this.getVertexAttribute("normals"),e||(e=new Zg,this.addVertexAttribute("normals",e))),4&I&&(t=this.getVertexAttribute("texCoords"),t||(t=new yg,this.addVertexAttribute("texCoords",t)));const B=A.loadUInt32();if(1==B){{const I=this.__boundingBox;if(g.versions["zea-engine"].compare([3,9,1])>=0){const g=A.loadUInt16Array(3*C);Rg([0,C],I.p0,I.diagonal(),g,i)}else{const g=A.loadUInt8Array(3*C);ug([0,C],I.p0,I.diagonal(),g,i)}}if(e){const g=new b(A.loadFloat32Vec3(),A.loadFloat32Vec3()),I=A.loadUInt8Array(3*C);Vg([0,C],g.p0,g.diagonal(),I,e),e.loadSplitValues(A)}if(t){const I=new Q(A.loadFloat32Vec2(),A.loadFloat32Vec2());if(g.versions["zea-engine"].compare([3,9,1])>=0){const g=A.loadUInt16Array(2*C);Sg([0,C],I.p0,I.diagonal(),g,t)}else{const g=A.loadUInt8Array(2*C);Fg([0,C],I.p0,I.diagonal(),g,t)}t.loadSplitValues(A)}}else{const I=[];let o,s=0;for(let g=0;g<B;g++){const g=A.loadUInt32(),C={range:[s,s+g],bbox:new b(A.loadFloat32Vec3(),A.loadFloat32Vec3()),normalsRange:new b,texCoordsRange:new Q};e&&C.normalsRange.set(A.loadFloat32Vec3(),A.loadFloat32Vec3()),t&&C.texCoordsRange.set(A.loadFloat32Vec2(),A.loadFloat32Vec2()),I.push(C),s+=g}o=g.versions["zea-engine"].compare([3,9,1])>=0?A.loadUInt16Array(3*C):A.loadUInt8Array(3*C);let a=null,l=null;e&&(a=A.loadUInt8Array(3*C)),t&&(l=A.loadUInt8Array(2*C));for(let A=0;A<B;A++){{const C=I[A].bbox;g.versions["zea-engine"].compare([3,9,1])>=0?Rg(I[A].range,C.p0,C.diagonal(),o,i):ug(I[A].range,C.p0,C.diagonal(),o,i)}if(a){const g=I[A].normalsRange;Vg(I[A].range,g.p0,g.diagonal(),a,e)}if(l){const i=I[A].texCoordsRange;g.versions["zea-engine"].compare([3,9,1])>=0?Sg([0,C],i.p0,i.diagonal(),l,t):Fg(I[A].range,i.p0,i.diagonal(),l,t)}}e&&e.loadSplitValues(A),t&&t.loadSplitValues(A)}}toJSON(A){const g=super.toJSON(A);A&&A.skipTopology||(g.numVertices=this.__numVertices||0);const I={};for(const[g,C]of this.__vertexAttributes.entries())A&&"skipAttributes"in A&&A.skipAttributes.includes(g)||(I[g]=C.toJSON(A));return g.vertexAttributes=I,g}fromJSON(A,g){this.clear(),super.fromJSON(A,g),this.setNumVertices(A.numVertices);for(const g in A.vertexAttributes){let I=this.__vertexAttributes.get(g);const C=A.vertexAttributes[g];I?I.fromJSON(C):console.warn("attr undefined, cannot execute fromJSON()")}this.emit("geomDataTopologyChanged")}toString(){return JSON.stringify(this.toJSON(),null,2)}}class Xg extends bg{constructor(){super("Vec4",4),this.normalized=!1}getValueRef(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.subarray(g,g+this.stride);return new s(I)}getValue(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.slice(g,g+this.stride);return new s(I)}setValue(A,g){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const I=A*this.stride;this.data.set(g.asArray(),I)}getFaceVertexValueRef(A,g){const I=this.getFaceVertexValueRef_array(A,g);return new s(I)}setFaceVertexValue(A,g,I){this.setFaceVertexValue_array(A,g,I.asArray())}setSplitVertexValue(A,g,I){this.setSplitVertexValue_array(A,g,I.asArray())}}e.register("Vec4Attribute",Xg);class Hg extends bg{constructor(){super("Color",4),this.normalized=!1}getValueRef(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.subarray(g,g+this.stride);return new l(I)}getValue(A){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const g=A*this.stride,I=this.data.slice(g,g+this.stride);return new l(I)}setValue(A,g){if(A>=this.data.length/this.stride)throw new Error("Invalid vertex index:"+A+". Num Vertices:"+this.data.length/3);const I=A*this.stride;this.data.set(g.asArray(),I)}getFaceVertexValueRef(A,g){const I=this.getFaceVertexValueRef_array(A,g);return new l(I)}setFaceVertexValue(A,g,I){this.setFaceVertexValue_array(A,g,I.asArray())}setSplitVertexValue(A,g,I){this.setSplitVertexValue_array(A,g,I.asArray())}}e.register("ColorAttribute",Hg);class Wg extends wg{constructor(){super()}clear(){this.setNumVertices(0),this.emit("geomDataTopologyChanged")}readBinary(A,g){super.loadBaseGeomBinary(A,g),this.emit("geomDataChanged")}}e.register("Points",Wg);class Yg extends wg{constructor(){super(),this.__indices=new Uint32Array}clear(){this.setNumSegments(0),this.setNumVertices(0),this.emit("geomDataTopologyChanged")}getIndices(){return this.__indices}getNumSegments(){return this.__indices.length/2}getNumLineSegments(){return this.__indices.length/2}setNumSegments(A){if(A>this.getNumSegments()){const g=new Uint32Array(2*A);g.set(this.__indices),this.__indices=g}else this.__indices=this.__indices.slice(0,2*A)}setSegmentVertexIndices(A,g,I){if(A>=this.__indices.length/2)throw new Error("Invalid line index:"+A+". Num Segments:"+this.__indices.length/2);this.__indices[2*A+0]=g,this.__indices[2*A+1]=I}getSegmentVertexIndex(A,g){return A<this.getNumSegments()?this.__indices[2*A+g]:-1}genBuffers(A){const g=super.genBuffers();let I;return I=g.numVertices<Math.pow(2,8)?new Uint8Array(this.__indices):g.numVertices<Math.pow(2,16)?new Uint16Array(this.__indices):this.__indices,g.indices=I,g}readBinary(A,g){super.loadBaseGeomBinary(A,g),this.setNumSegments(A.loadUInt32());const I=A.loadUInt8();1==I?this.__indices=A.loadUInt8Array():2==I?this.__indices=A.loadUInt16Array():4==I&&(this.__indices=A.loadUInt32Array()),this.emit("geomDataChanged")}toJSON(A){const g=super.toJSON(A);return A&&A.skipTopology||(g.indices=Array.from(this.__indices)),g}fromJSON(A,g){super.fromJSON(A,g),A.indices&&(this.__indices=Uint32Array.from(A.indices))}}e.register("Lines",Yg);class Kg extends wg{constructor(){super(),this.edgeFaces=[],this.faceEdges=[[]],this.faceCounts=[],this.__faceVertexIndices=new Uint32Array,this.__logTopologyWarnings=!1,this.__edgeAttributes=new Map,this.__faceAttributes=new Map,this.numEdges=0,this.edgeVerts=[],this.vertexEdges=[],this.edgeAngles=new Float32Array,this.edgeVecs=[]}clear(){super.clear(),this.edgeVerts=[],this.vertexEdges=[],this.numEdges=0,this.edgeAngles=new Float32Array,this.emit("geomDataTopologyChanged")}addVertexAttribute(A,g){super.addVertexAttribute(A,g),g.setMesh(this)}getFaceCounts(){return this.faceCounts}getNumFaces(){return 0==this.faceCounts.length?0:this.faceCounts.reduce(((A,g)=>A+g))}getNumTriangles(){let A=0,g=1;for(const I of this.faceCounts)A+=I*g,g++;return A}setFaceCounts(A){let g=0,I=3;for(const C of A)g+=C*I,I++;if(0==this.getNumFaces())this.__faceVertexIndices=new Uint32Array(g);else{const C=new Uint32Array(g);let i=0,e=0;g=0,I=3,A.forEach(((A,g)=>{const t=i+Math.min(A,this.faceCounts[g])*I;C.set(this.__faceVertexIndices.slice(i,t),e),i+=this.faceCounts[g]*I,e+=A*I,I++})),this.__faceVertexIndices=C}this.faceCounts=A}getFaceVertexCount(A){let g=0,I=0;return this.faceCounts.some(((C,i)=>(g+=C,g>A&&(I=i+3,!0)))),I}getFaceVertexOffset(A){let g=0,I=0;return this.faceCounts.some(((C,i)=>g+C>A?(I+=(A-g)*(i+3),!0):(g+=C,I+=C*(i+3),!1))),I}setFaceVertexIndices(A,g){const I=this.getFaceVertexCount(A);if(g.length!=I)throw new Error(`Invalid indices for face:${A} vertexIndices:${g}. Expected ${I} indices`);const C=this.getFaceVertexOffset(A);this.__faceVertexIndices.set(g,C)}addFace(A){const g=[...this.faceCounts];if(g.length<=A.length-3){for(let I=g.length;I<A.length-3;I++)g[I]=0;g[A.length-3]=1}else g[A.length-3]++;this.setFaceCounts(g);let I=0,C=0;return this.faceCounts.some(((g,i)=>i+3==A.length?(I+=g-1,C+=(g-1)*(i+3),!0):(I+=g,C+=g*(i+3),!1))),this.__faceVertexIndices.set(A,C),I}getFaceVertexIndices(A){const g=[],I=this.getFaceVertexOffset(A),C=this.getFaceVertexCount(A);for(let A=0;A<C;A++)g.push(this.__faceVertexIndices[I+A]);return g}getFaceVertexIndex(A,g){const I=this.getFaceVertexOffset(A);return this.__faceVertexIndices[I+g]}addFaceAttribute(A,g){return g.setCount(this.getNumFaces()),this.__faceAttributes.set(A,g),g}hasFaceAttribute(A){return this.__faceAttributes.has(A)}getFaceAttribute(A){return this.__faceAttributes.get(A)}addEdgeAttribute(A,g){g.setCount(this.numEdges),this.__edgeAttributes.set(A,g)}hasEdgeAttribute(A){return this.__edgeAttributes.has(A)}getEdgeAttribute(A){return this.__edgeAttributes.get(A)}genTopologyInfo(){let A={};this.vertexEdges=[],this.edgeFaces=[],this.edgeVerts=[],this.faceEdges=[],this.numEdges=0;const g=this.positions,I=(I,C)=>{let i=I,e=C;if(e<i){const A=i;i=e,e=A}const t=i+">"+e;if(t in A)return A[t];const B=g.getValueRef(i),o=g.getValueRef(e).subtract(B),s={edgeIndex:this.edgeFaces.length/2,edgeVec:o};return A[t]=s,this.edgeFaces.push(-1),this.edgeFaces.push(-1),this.edgeVerts.push(i),this.edgeVerts.push(e),this.numEdges++,s},C=(A,g,C)=>{const i=I(A,g).edgeIndex;if(g<A){const A=2*i+0;this.__logTopologyWarnings&&-1!=this.edgeFaces[A]&&console.warn("Edge poly 0 already set. Mesh is non-manifold."),this.edgeFaces[A]=C}else{const A=2*i+1;this.__logTopologyWarnings&&-1!=this.edgeFaces[A]&&console.warn("Edge poly 1 already set. Mesh is non-manifold."),this.edgeFaces[A]=C}C in this.faceEdges||(this.faceEdges[C]=[]),this.faceEdges[C].push(i),null==this.vertexEdges[A]&&(this.vertexEdges[A]=new Set),null==this.vertexEdges[g]&&(this.vertexEdges[g]=new Set),this.vertexEdges[A].add(i),this.vertexEdges[g].add(i)},i=this.getNumFaces();for(let A=0;A<i;A++){const g=this.getFaceVertexIndices(A);for(let I=0;I<g.length;I++){C(g[I],g[(I+1)%g.length],A)}}}computeFaceNormals(){const A=this.positions,g=new Zg;this.addFaceAttribute("normals",g);const I=this.getNumFaces();for(let C=0;C<I;C++){const I=this.getFaceVertexIndices(C),i=A.getValueRef(I[0]);let e=A.getValueRef(I[1]);const t=new o;for(let g=2;g<I.length;g++){const C=A.getValueRef(I[g]),B=e.subtract(i),o=C.subtract(i);t.addInPlace(B.cross(o).normalize()),e=C}t.lengthSquared()<Number.EPSILON||g.setValue(C,t.normalize())}}calculateEdgeAngles(){0==this.vertexEdges.length&&this.genTopologyInfo(),this.computeFaceNormals();const A=this.positions,g=this.getFaceAttribute("normals");this.edgeVecs=[],this.edgeAngles=new Float32Array(this.numEdges);for(let I=0;I<this.edgeFaces.length;I+=2){const C=this.edgeVerts[I],i=this.edgeVerts[I+1],e=A.getValueRef(i).subtract(A.getValueRef(C));e.normalizeInPlace(),this.edgeVecs.push(e);const t=this.edgeFaces[I],B=this.edgeFaces[I+1];if(-1==t||-1==B){this.edgeAngles[I/2]=2*Math.PI;continue}const o=g.getValueRef(t),s=g.getValueRef(B);this.edgeAngles[I/2]=o.angleTo(s)}}computeVertexNormals(A=1){this.calculateEdgeAngles();const g=this.getFaceAttribute("normals"),I=new Zg;this.addVertexAttribute("normals",I);const C=(A,g)=>{I.setValue(A,g)},i=(A,g)=>{let I,C;const i=this.faceEdges[A];for(const A of i)(this.edgeVerts[2*A]==g||this.edgeVerts[2*A+1]==g)&&(I?C=this.edgeVecs[A]:I=this.edgeVecs[A]);return[I,C]};for(let t=0;t<this.vertexEdges.length;t++){if(null==this.vertexEdges[t])continue;const B=this.vertexEdges[t],s=[],a=A=>{let g=!1;for(const I of s)if(g=I.includes(A),g)break;g||s.push([A])};for(const g of B){const I=this.edgeFaces[2*g],C=this.edgeFaces[2*g+1];if(-1!=I&&-1!=C&&this.edgeAngles[g]<A){let A=-1,g=-1;for(let i=0;i<s.length;i++)-1==A&&s[i].includes(I)&&(A=i),-1==g&&s[i].includes(C)&&(g=i);-1==A&&-1==g?s.push([I,C]):-1!=A&&-1!=g?A!=g&&(s[A]=s[A].concat(s[g]),s.splice(g,1)):(-1==A&&s[g].push(I),-1==g&&s[A].push(C))}else-1!=I&&a(I),-1!=C&&a(C)}s.sort(((A,g)=>A.length<g.length?1:A.length>g.length?-1:0));let l=!0;for(const A of s){const B=new o;for(const I of A){const A=i(I,t);let C;A[0]&&A[1]?(C=A[0].angleTo(A[1]),B.addInPlace((e=I,g.getValueRef(e)).scale(C))):console.warn("variable weight is undefined because faceEdges[0] or faceEdges[1] is undefined")}B.normalizeInPlace(),l?(C(t,B),l=!1):I.setSplitVertexValues(t,A,B.asArray())}}var e;return I}computeHardEdgesIndices(A=1){0==this.edgeVerts.length&&this.calculateEdgeAngles();const g=[],I=A=>{g.push(this.edgeVerts[A]),g.push(this.edgeVerts[A+1])};for(let g=0;g<this.edgeAngles.length;g++)this.edgeAngles[g]>A&&I(2*g);return Uint32Array.from(g)}genBuffers(A){const g={};let I=0;for(const[,A]of this.__vertexAttributes){const C=A.getSplits();for(const A in C){A in g||(g[A]={});const i=C[A];for(const C in i){const i=parseInt(C);i in g[A]||(g[A][i]=I,I++)}}}const C=this.positions.getCount(),i=C+I;let e;A&&0==A.includeIndices||(e=this.generateTriangulatedIndices(i,C,g));const t={};for(const[A,C]of this.__vertexAttributes){let i;i=0==I?C.asArray():C.generateSplitValues(g,I);const e=C.stride,B=i.length/e;t[A]={values:i,count:B,dimension:e,normalized:"normals"==A,dataType:C.getDataTypeName()}}return{numVertices:this.numVertices(),numRenderVerts:i,indices:e,attrBuffers:t}}computeNumTriangles(){let A=3,g=0;for(const I of this.faceCounts)g+=I*(A-2),A++;return g}generateTriangulatedIndices(A,g,I){const C=this.computeNumTriangles();let i;i=A<Math.pow(2,8)?new Uint8Array(3*C):A<Math.pow(2,16)?new Uint16Array(3*C):new Uint32Array(3*C);let e=0;const t=function(A,C){A in I&&C in I[A]&&(A=g+I[A][C]),i[e]=A,e++},B=this.getNumFaces();for(let A=0;A<B;A++){const g=this.getFaceVertexIndices(A);for(let I=0;I<g.length;I++)I>=3&&(t(g[0],A),t(g[I-1],A)),t(g[I],A)}return i}readBinary(A,g){super.loadBaseGeomBinary(A,g),this.setFaceCounts(Array.from(A.loadUInt32Array()));const I=this.getNumFaces(),C=A.loadUInt8Array(I),i=A.loadSInt32Vec2(),e=A.loadUInt8();let t;if(1==e)t=A.loadUInt8Array();else if(2==e)t=A.loadUInt16Array();else{if(4!=e)throw Error("faceVertexIndexDeltas undefined");t=A.loadUInt32Array()}let B=3,o=0;const s=this.faceCounts.map(((A,g)=>{const I=o;return o+=A*B,B++,I}));let a=0,l=0;const n=[];for(let A=0;A<I;A++){const g=C[A],I=s[g],e=g+3;n[A]=I;for(let g=0;g<e;g++){const C=I+g,e=t[a+g]+i.x;if(0==A)this.__faceVertexIndices[C]=e;else{let I=n[A-1];I+=g<l?g:l-1,this.__faceVertexIndices[C]=this.__faceVertexIndices[I]+e}}a+=e,s[g]+=e,l=e}this.hasVertexAttribute("normals")||this.computeVertexNormals(),this.emit("geomDataChanged")}toJSON(A){const g=super.toJSON(A);return A&&A.skipTopology||(g.faceCounts=Array.from(this.faceCounts),g.faceVertexIndices=Array.from(this.__faceVertexIndices)),g}fromJSON(A,g){super.fromJSON(A,g),A.faceCounts&&(this.faceCounts=A.faceCounts),A.faceVertexIndices&&(this.__faceVertexIndices=Uint32Array.from(A.faceVertexIndices))}}e.register("Mesh",Kg);class pg extends V{constructor(A){super(),this.name=A.name,this.__buffers=A.geomBuffers,this.__buffers.attrBuffers,this.boundingBox=new b,this.boundingBox.p0.__data=A.bbox.p0.__data,this.boundingBox.p1.__data=A.bbox.p1.__data,this.__metaData=new Map}getNumVertices(){return this.__buffers.numVertices}getBoundingBox(){return this.boundingBox}genBuffers(){return this.__buffers}freeBuffers(){for(const A in this.__buffers.attrBuffers){this.__buffers.attrBuffers[A].values=null}this.__buffers.indices&&(this.__buffers.indices=null)}}class Ng extends pg{constructor(A){super(A)}}class Jg extends pg{constructor(A){super(A)}getNumLineSegments(){return this.__buffers.indices.length/2}}class Dg extends pg{constructor(A){super(A)}getNumTriangles(){return this.__buffers.indices.length/3}}class fg extends hA{}e.register("SubGeom",fg);class Mg extends pg{constructor(A,g){super(A),this.materials=[],this.subGeomMaterialIndices=new Uint8Array(0),this.subGeoms=[],this.counts=A.geomBuffers.counts;const I=g.getMaterials();A.geomBuffers.materialLibraryIndices.forEach(((A,g)=>{this.materials[g]=I[A]})),this.subGeomMaterialIndices=A.geomBuffers.subGeomMaterialIndices,this.__buffers.materials=this.materials}getNumTriangles(){return this.counts.TRIANGLES/3}getNumLineSegments(){return this.counts.LINES/2}getNumPoints(){return this.counts.POINTS}loadMetadata(A,g){A.loadUInt32Array().forEach(((I,C)=>{const i=new fg;A.seek(I),i.readBinary(A,g),this.subGeoms[C]=i}))}}class Lg extends Wg{constructor(){super(),this.dirtyTopology=!0,this.dirtyVertices=!0,this.topologyParams=[]}parameterValueChanged(A){this.setBoundingBoxDirty(),this.topologyParams.includes(A.param.getName())?(this.dirtyTopology=!0,this.emit("geomDataTopologyChanged")):(this.dirtyVertices=!0,this.setBoundingBoxDirty(),this.emit("geomDataChanged")),super.parameterValueChanged(A)}update(){this.dirtyTopology?(this.rebuild(),this.dirtyTopology=!1,this.dirtyVertices=!1,this.rebuild()):this.dirtyVertices&&(this.dirtyVertices=!1,this.resize(),this.dirtyVertices=!1)}getBoundingBox(){return this.update(),super.getBoundingBox()}getNumVertices(){return this.update(),super.getNumVertices()}genBuffers(A){return this.update(),super.genBuffers(A)}toJSON(A){A||(A={}),A.skipTopology=!0,A.skipAttributes=["positions","normals","texCoords"];const g=super.toJSON(A);return A.skipTopology=!1,A.skipAttributes=[],g}}class Ug extends Yg{constructor(){super(),this.dirtyTopology=!0,this.dirtyVertices=!0,this.topologyParams=[]}parameterValueChanged(A){this.setBoundingBoxDirty(),this.topologyParams.includes(A.param.getName())?(this.dirtyTopology=!0,this.emit("geomDataTopologyChanged")):(this.dirtyVertices=!0,this.setBoundingBoxDirty(),this.emit("geomDataChanged")),super.parameterValueChanged(A)}update(){this.dirtyTopology?(this.rebuild(),this.dirtyTopology=!1,this.dirtyVertices=!1,this.rebuild()):this.dirtyVertices&&(this.resize(),this.dirtyVertices=!1,this.resize())}getBoundingBox(){return this.update(),super.getBoundingBox()}getNumVertices(){return this.update(),super.getNumVertices()}genBuffers(A){return this.update(),super.genBuffers()}toJSON(A){A||(A={}),A.skipTopology=!0,A.skipAttributes=["positions","normals","texCoords"];const g=super.toJSON(A);return A.skipTopology=!1,A.skipAttributes=[],g}}class vg extends Kg{constructor(){super(),this.dirtyTopology=!0,this.dirtyVertices=!0,this.topologyParams=[]}parameterValueChanged(A){this.setBoundingBoxDirty(),this.topologyParams.includes(A.param.getName())?(this.dirtyTopology=!0,this.emit("geomDataTopologyChanged")):(this.dirtyVertices=!0,this.setBoundingBoxDirty(),this.emit("geomDataChanged")),super.parameterValueChanged(A)}update(){this.dirtyTopology?(this.vertexEdges=[],this.dirtyTopology=!1,this.dirtyVertices=!1,this.rebuild()):this.dirtyVertices&&(this.dirtyVertices=!1,this.resize())}getBoundingBox(){return this.update(),super.getBoundingBox()}getNumVertices(){return this.update(),super.getNumVertices()}computeVertexNormals(A=1){return this.update(),super.computeVertexNormals(A)}computeHardEdgesIndices(A=1){return this.update(),super.computeHardEdgesIndices(A)}genBuffers(A){return this.update(),super.genBuffers(A)}toJSON(A){A||(A={}),A.skipTopology=!0,A.skipAttributes=["positions","normals","texCoords"];const g=super.toJSON(A);return A.skipTopology=!1,A.skipAttributes=[],g}}class kg extends Lg{constructor(A=1,g=1,I=1,C=1,i=!1){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g)||isNaN(I)||isNaN(C))throw new Error("Invalid geom args");this.sizeXParam=this.addParameter(new JA("X",A)),this.sizeYParam=this.addParameter(new JA("Y",g)),this.divisionsXParam=this.addParameter(new JA("XDivisions",I)),this.divisionsYParam=this.addParameter(new JA("YDivisions",C)),i&&this.addVertexAttribute("texCoords",new yg),this.topologyParams.push("XDivisions"),this.topologyParams.push("YDivisions")}rebuild(){const A=this.divisionsXParam.value,g=this.divisionsYParam.value;this.setNumVertices(A*g);const I=this.getVertexAttribute("texCoords");if(I)for(let C=0;C<g;C++){const i=C/(g-1);for(let g=0;g<A;g++){const e=g/(A-1);I.getValueRef(C*A+g).set(e,i)}}this.resize()}resize(){const A=this.divisionsXParam.value,g=this.divisionsYParam.value,I=this.sizeXParam.value,C=this.sizeYParam.value,i=this.getVertexAttribute("positions");if(i)for(let e=0;e<g;e++){const t=(e/(g-1)-.5)*C;for(let g=0;g<A;g++){const C=(g/(A-1)-.5)*I;i.getValueRef(e*A+g).set(C,t,0)}}}}e.register("PointGrid",kg);class xg extends Ug{constructor(A=1,g=1){if(super(),isNaN(A)||isNaN(g))throw new Error("Invalid geom args");this.sizeXParam=this.addParameter(new JA("X",A)),this.sizeXParam.on("valueChanged",this.resize.bind(this)),this.sizeYParam=this.addParameter(new JA("Y",g)),this.sizeYParam.on("valueChanged",this.resize.bind(this)),this.rebuild()}rebuild(){this.setNumVertices(4),this.setNumSegments(4),this.setSegmentVertexIndices(0,0,1),this.setSegmentVertexIndices(1,1,2),this.setSegmentVertexIndices(2,2,3),this.setSegmentVertexIndices(3,3,0),this.resize(!1)}resize(){const A=this.sizeXParam.value,g=this.sizeYParam.value,I=this.getVertexAttribute("positions");I&&(I.getValueRef(0).set(-.5*A,-.5*g,0),I.getValueRef(1).set(.5*A,-.5*g,0),I.getValueRef(2).set(.5*A,.5*g,0),I.getValueRef(3).set(-.5*A,.5*g,0))}}e.register("Rect",xg);class zg extends Ug{constructor(A=1,g=32,I=2*Math.PI){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g))throw new Error("Invalid geom args");this.radiusParam=this.addParameter(new JA("Radius",A)),this.angleParam=this.addParameter(new JA("Angle",I)),this.sidesParam=this.addParameter(new JA("Sides",g>=3?g:3,[3,200],1)),this.topologyParams.push("Sides")}rebuild(){const A=this.sidesParam.value;this.setNumVertices(A);const g=this.angleParam.value<2*Math.PI;g?this.setNumSegments(A-1):this.setNumSegments(A);for(let I=0;I<(g?A-1:A);I++)this.setSegmentVertexIndices(I,I,(I+1)%A);this.resize()}resize(){const A=this.radiusParam.value,g=this.sidesParam.value,I=this.angleParam.value/g,C=this.getVertexAttribute("positions");if(C)for(let i=0;i<g;i++)C.getValueRef(i).set(Math.cos(I*i)*A,Math.sin(I*i)*A,0)}}e.register("Circle",zg);class Tg extends Ug{constructor(A=1){if(super(),isNaN(A))throw new Error("Invalid geom args");this.sizeParam=this.addParameter(new JA("Size",A))}rebuild(){this.setNumVertices(6),this.setNumSegments(3),this.setSegmentVertexIndices(0,0,1),this.setSegmentVertexIndices(1,2,3),this.setSegmentVertexIndices(2,4,5),this.resize()}resize(){const A=this.sizeParam.value,g=this.getVertexAttribute("positions");g&&(g.getValueRef(0).set(-.5*A,0,0),g.getValueRef(1).set(.5*A,0,0),g.getValueRef(2).set(0,.5*A,0),g.getValueRef(3).set(0,-.5*A,0),g.getValueRef(4).set(0,0,.5*A),g.getValueRef(5).set(0,0,-.5*A))}}e.register("Cross",Tg);class _g extends Ug{constructor(A=1,g=1,I=1,C=!1){super(),this.sizeXParam=this.addParameter(new JA("X",A)),this.sizeYParam=this.addParameter(new JA("Y",g)),this.sizeZParam=this.addParameter(new JA("Z",I)),this.baseZAtZeroParam=this.addParameter(new fA("BaseZAtZero",C))}rebuild(){this.setNumVertices(8),this.setNumSegments(12),this.setSegmentVertexIndices(0,0,1),this.setSegmentVertexIndices(1,1,2),this.setSegmentVertexIndices(2,2,3),this.setSegmentVertexIndices(3,3,0),this.setSegmentVertexIndices(4,4,5),this.setSegmentVertexIndices(5,5,6),this.setSegmentVertexIndices(6,6,7),this.setSegmentVertexIndices(7,7,4),this.setSegmentVertexIndices(8,0,4),this.setSegmentVertexIndices(9,1,5),this.setSegmentVertexIndices(10,2,6),this.setSegmentVertexIndices(11,3,7),this.resize()}resize(){const A=this.sizeXParam.value,g=this.sizeYParam.value,I=this.sizeZParam.value,C=this.baseZAtZeroParam.value,i=this.getVertexAttribute("positions");if(i){let e=.5;C&&(e=1),i.getValueRef(0).set(.5*A,-.5*g,e*I),i.getValueRef(1).set(.5*A,.5*g,e*I),i.getValueRef(2).set(-.5*A,.5*g,e*I),i.getValueRef(3).set(-.5*A,-.5*g,e*I),e=-.5,C&&(e=0),i.getValueRef(4).set(.5*A,-.5*g,e*I),i.getValueRef(5).set(.5*A,.5*g,e*I),i.getValueRef(6).set(-.5*A,.5*g,e*I),i.getValueRef(7).set(-.5*A,-.5*g,e*I)}}}e.register("LinesCuboid",_g);class Pg extends Ug{constructor(A=1,g=1,I=10,C=10,i=!1){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g)||isNaN(I)||isNaN(C))throw new Error("Invalid geom args");this.xParam=this.addParameter(new JA("X",A)),this.yParam=this.addParameter(new JA("Y",g)),this.xDivisionsParam=this.addParameter(new JA("XDivisions",I)),this.yDivisionsParam=this.addParameter(new JA("YDivisions",C)),this.skipCenterLinesParam=this.addParameter(new fA("SkipCenterLines",i)),this.topologyParams.push("XDivisions"),this.topologyParams.push("YDivisions"),this.topologyParams.push("SkipCenterLines")}rebuild(){const A=this.xDivisionsParam.value,g=this.yDivisionsParam.value,I=this.skipCenterLinesParam.value&&A%2==0&&g%2==0;this.setNumVertices(2*(A+g+2-(I?1:0))),this.setNumSegments(A+g+2-(I?1:0));let C=0;for(let g=0;g<=A;g++){if(I&&g==A/2)continue;const i=2*C,e=2*C+1;this.setSegmentVertexIndices(C,i,e),C++}for(let i=0;i<=g;i++){if(I&&i==A/2)continue;const g=2*C,e=2*C+1;this.setSegmentVertexIndices(C,g,e),C++}this.resize()}resize(){const A=this.getVertexAttribute("positions"),g=this.xDivisionsParam.value,I=this.yDivisionsParam.value,C=this.xParam.value,i=this.yParam.value,e=this.skipCenterLinesParam.value&&g%2==0&&I%2==0;let t=0;for(let I=0;I<=g;I++){if(e&&I==g/2)continue;const B=2*t,o=2*t+1,s=(I/g-.5)*C;A&&(A.getValueRef(B).set(s,-.5*i,0),A.getValueRef(o).set(s,.5*i,0)),t++}for(let B=0;B<=I;B++){if(e&&B==g/2)continue;const o=2*t,s=2*t+1,a=(B/I-.5)*i;A&&(A.getValueRef(o).set(-.5*C,a,0),A.getValueRef(s).set(.5*C,a,0)),t++}}}e.register("Grid",Pg);class Og extends vg{constructor(A=.5,g=1,I=32,C=!0,i=!0,e=!0){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g)||isNaN(I))throw new Error("Invalid geom args");this.radiusParam=this.addParameter(new JA("Radius",A)),this.heightParam=this.addParameter(new JA("Height",g)),this.detailParam=this.addParameter(new JA("Detail",I>=3?I:3,[3,200],1)),this.capParam=this.addParameter(new fA("Cap",C)),i&&this.addVertexAttribute("normals",new Zg),e&&this.addVertexAttribute("texCoords",new yg),this.topologyParams.push("Detail"),this.topologyParams.push("Cap")}rebuild(){const A=this.detailParam.value,g=this.radiusParam.value,I=this.heightParam.value,C=this.capParam.value;let i=A+1;C&&(i+=1),this.setNumVertices(i);const e=A,t=A+1,o=this.getVertexAttribute("positions");if(o){o.getValueRef(e).set(0,0,I);for(let I=0;I<A;I++){const C=-I/A*2*Math.PI;o.getValueRef(I).set(g*Math.cos(C),g*Math.sin(C),0)}C&&o.getValueRef(t).set(0,0,0)}this.setFaceCounts([A+(C?A:0)]);for(let g=0;g<A;g++){const I=(g+1)%A;this.setFaceVertexIndices(g,[I,g,e])}if(C)for(let g=0;g<A;g++){const I=(g+1)%A;this.setFaceVertexIndices(A+g,[g,I,t])}const s=this.getVertexAttribute("texCoords");if(s){let g=0;for(let I=0;I<A;I++)"setFaceVertexValue"in s&&(s.setFaceVertexValue(g,0,new B((I+1)/A,0)),s.setFaceVertexValue(g,1,new B(I/A,0)),s.setFaceVertexValue(g,2,new B((I+.5)/A,1)));if(C)for(let I=0;I<A;I++)s.setFaceVertexValue(g,0,new B(I/A,0)),s.setFaceVertexValue(g,1,new B((I+1)/A,0)),s.setFaceVertexValue(g,2,new B((I+.5)/A,1)),g++}this.resize()}resize(){const A=this.detailParam.value,g=this.radiusParam.value,I=this.heightParam.value,C=A,i=A+1,e=this.getVertexAttribute("positions");if(e){e.getValueRef(C).set(0,0,I);for(let I=0;I<A;I++){const C=-I/A*2*Math.PI;e.getValueRef(I).set(g*Math.cos(C),g*Math.sin(C),0)}this.capParam.value&&e.getValueRef(i).set(0,0,0)}this.dirtyTopology=!1,this.dirtyVertices=!1;this.getVertexAttribute("normals")&&this.computeVertexNormals()}}e.register("Cone",Og);class jg extends vg{constructor(A=1,g=1,I=1,C=!1){if(super(),isNaN(A)||isNaN(g)||isNaN(I))throw new Error("Invalid geom args");this.sizeXParam=this.addParameter(new JA("X",A)),this.sizeYParam=this.addParameter(new JA("Y",g)),this.sizeZParam=this.addParameter(new JA("Z",I)),this.baseZAtZeroParam=this.addParameter(new fA("BaseZAtZero",C)),this.setFaceCounts([0,6]),this.setFaceVertexIndices(0,[0,1,2,3]),this.setFaceVertexIndices(1,[7,6,5,4]),this.setFaceVertexIndices(2,[1,0,4,5]),this.setFaceVertexIndices(3,[3,2,6,7]),this.setFaceVertexIndices(4,[0,3,7,4]),this.setFaceVertexIndices(5,[2,1,5,6]),this.setNumVertices(8),this.addVertexAttribute("normals",new Zg)}rebuild(){const A=this.getVertexAttribute("normals");if(A)for(let g=0;g<6;g++){let I;switch(g){case 0:I=new o(0,0,1);break;case 1:I=new o(0,0,-1);break;case 2:I=new o(1,0,0);break;case 3:I=new o(-1,0,0);break;case 4:I=new o(0,-1,0);break;default:I=new o(0,1,0)}A.setFaceVertexValue(g,0,I),A.setFaceVertexValue(g,1,I),A.setFaceVertexValue(g,2,I),A.setFaceVertexValue(g,3,I)}this.resize()}resize(){const A=this.sizeXParam.value,g=this.sizeYParam.value,I=this.sizeZParam.value,C=this.baseZAtZeroParam.value;let i=.5;const e=this.getVertexAttribute("positions");C&&(i=1),e&&(e.getValueRef(0).set(.5*A,-.5*g,i*I),e.getValueRef(1).set(.5*A,.5*g,i*I),e.getValueRef(2).set(-.5*A,.5*g,i*I),e.getValueRef(3).set(-.5*A,-.5*g,i*I),i=-.5,C&&(i=0),e.getValueRef(4).set(.5*A,-.5*g,i*I),e.getValueRef(5).set(.5*A,.5*g,i*I),e.getValueRef(6).set(-.5*A,.5*g,i*I),e.getValueRef(7).set(-.5*A,-.5*g,i*I))}}e.register("Cuboid",jg);class qg extends vg{constructor(A=.5,g=1,I=32,C=2,i=!0,e=!1){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g)||isNaN(I)||isNaN(C))throw new Error("Invalid geom args");this.radiusParam=this.addParameter(new JA("Radius",A)),this.heightParam=this.addParameter(new JA("Height",g)),this.sidesParam=this.addParameter(new JA("Sides",I>=3?I:3,[3,200],1)),this.loopsParam=this.addParameter(new JA("Loops",C>=2?C:2,[1,200],1)),this.capsParam=this.addParameter(new fA("Caps",i)),this.baseZAtZeroParam=this.addParameter(new fA("BaseZAtZero",e)),this.addVertexAttribute("texCoords",new yg),this.addVertexAttribute("normals",new Zg),this.topologyParams.push("Sides"),this.topologyParams.push("Loops"),this.topologyParams.push("Caps")}rebuild(){const A=this.sidesParam.value,g=this.loopsParam.value,I=this.capsParam.value;let C=A*g;I&&(C+=2),this.setNumVertices(C),I?this.setFaceCounts([2*A,A]):this.setFaceCounts([0,A]);let i=0;if(I){for(let g=0;g<A;g++){const I=C-1,e=g,t=(g+1)%A;this.setFaceVertexIndices(i++,[I,e,t])}for(let I=0;I<A;I++){const e=A*(g-1)+I,t=C-2,B=A*(g-1)+(I+1)%A;this.setFaceVertexIndices(i++,[e,t,B])}}for(let I=0;I<g-1;I++)for(let g=0;g<A;g++){const C=A*I+(g+1)%A,e=A*I+g,t=A*(I+1)+g,B=A*(I+1)+(g+1)%A;this.setFaceVertexIndices(i++,[C,e,t,B])}const e=this.getVertexAttribute("normals");if(e){if(i=0,I){const g=new o(0,0,-1);for(let I=0;I<A;I++)e.setFaceVertexValue(i,0,g),e.setFaceVertexValue(i,1,g),e.setFaceVertexValue(i,2,g),i++;g.set(0,0,1);for(let I=0;I<A;I++)e.setFaceVertexValue(i,0,g),e.setFaceVertexValue(i,1,g),e.setFaceVertexValue(i,2,g),i++}for(let I=0;I<g-1;I++)for(let g=0;g<A;g++){let I=g/A*2*Math.PI;const C=new o(Math.sin(I),Math.cos(I),0);e.setFaceVertexValue(i,0,C),e.setFaceVertexValue(i,1,C),I=(g+1)/A*2*Math.PI;const t=new o(Math.sin(I),Math.cos(I),0);e.setFaceVertexValue(i,2,t),e.setFaceVertexValue(i,3,t),i++}}const t=this.getVertexAttribute("texCoords");if(t){if(i=0,I){for(let g=0;g<A;g++)t.setFaceVertexValue(i,0,new B(g/A,0)),t.setFaceVertexValue(i,1,new B((g+1)/A,0)),t.setFaceVertexValue(i,2,new B((g+.5)/A,1)),i++;for(let g=0;g<A;g++)t.setFaceVertexValue(i,0,new B(g/A,0)),t.setFaceVertexValue(i,1,new B((g+1)/A,0)),t.setFaceVertexValue(i,2,new B((g+.5)/A,1)),i++}for(let g=0;g<A;g++)t.setFaceVertexValue(i,0,new B((g+1)/A,0)),t.setFaceVertexValue(i,2,new B((g+1)/A,1)),t.setFaceVertexValue(i,1,new B(g/A,0)),t.setFaceVertexValue(i,3,new B(g/A,1)),i++}this.resize()}resize(){const A=this.sidesParam.value,g=this.loopsParam.value,I=this.radiusParam.value,C=this.heightParam.value,i=this.capsParam.value,e=this.baseZAtZeroParam.value;let t=A*g;i&&(t+=2);let B=0,o=.5;e&&(o=0);const s=this.getVertexAttribute("positions");if(s){for(let i=0;i<g;i++){const e=i/(g-1)*C-C*o;for(let g=0;g<A;g++){const C=g/A*2*Math.PI;s.getValueRef(B).set(Math.sin(C)*I,Math.cos(C)*I,e),B++}}i&&(s.getValueRef(t-1).set(0,0,C*(e?0:-.5)),s.getValueRef(t-2).set(0,0,C*(e?1:.5)))}this.dirtyTopology=!1,this.dirtyVertices=!1,this.computeVertexNormals()}}e.register("Cylinder",qg);class $g extends vg{constructor(A=.5,g=32){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g))throw new Error("Invalid geom args");this.radiusParam=this.addParameter(new JA("Radius",A)),this.sidesParam=this.addParameter(new JA("Sides",g>=3?g:3,[3,200],1)),this.addVertexAttribute("texCoords",new yg),this.addVertexAttribute("normals",new Zg),this.topologyParams.push("Sides")}rebuild(){const A=this.sidesParam.value;this.setNumVertices(A+1),this.setFaceCounts([A]);const g=this.getVertexAttribute("positions");g&&g.getValueRef(0).set(0,0,0);for(let g=0;g<A;g++){const I=g%A+1,C=(g+1)%A+1;this.setFaceVertexIndices(g,[0,I,C])}const I=this.getVertexAttribute("normals");if(I){const g=new o(0,0,1);I.setValue(0,g);for(let C=0;C<A;C++)I.setValue(C+1,g)}const C=this.getVertexAttribute("texCoords");if(C){C.getValueRef(0).set(.5,.5);for(let g=0;g<A;g++){const I=g/A*2*Math.PI;C.getValueRef(g+1).set(.5*Math.sin(I)+.5,.5*Math.cos(I)+.5)}}this.resize()}resize(){const A=this.sidesParam.value,g=this.radiusParam.value,I=this.getVertexAttribute("positions");if(I)for(let C=0;C<A;C++){const i=C/A*2*Math.PI;I.getValueRef(C+1).set(Math.sin(i)*g,Math.cos(i)*g,0)}}}e.register("Disc",$g);class AI extends vg{constructor(A=1,g=1,I=1,C=1,i=!0,e=!0){if(super(),this.topologyParams=[],isNaN(A)||isNaN(g)||isNaN(I)||isNaN(C))throw new Error("Invalid geom args");this.sizeXParam=this.addParameter(new JA("SizeX",A)),this.sizeYParam=this.addParameter(new JA("SizeY",g)),this.detailXParam=this.addParameter(new JA("DetailX",I)),this.detailYParam=this.addParameter(new JA("DetailY",C)),i&&this.addVertexAttribute("normals",new Zg),e&&this.addVertexAttribute("texCoords",new yg),this.topologyParams.push("DetailX"),this.topologyParams.push("DetailY")}rebuild(){const A=this.detailXParam.value,g=this.detailYParam.value;this.setNumVertices((A+1)*(g+1)),this.setFaceCounts([0,A*g]);let I=0;for(let C=0;C<g;C++)for(let g=0;g<A;g++){const i=(A+1)*(C+1)+g,e=(A+1)*C+g,t=(A+1)*C+(g+1),B=(A+1)*(C+1)+(g+1);this.setFaceVertexIndices(I,[i,e,t,B]),I+=1}let C=0;const i=this.getVertexAttribute("normals");if(i)for(let I=0;I<=g;I++)for(let g=0;g<=A;g++)i.getValueRef(C).set(0,0,1),C++;C=0;const e=this.getVertexAttribute("texCoords");if(e)for(let I=0;I<=g;I++){const i=I/g;for(let g=0;g<=A;g++){const I=g/A;e.getValueRef(C).set(I,i),C++}}this.resize()}resize(){const A=this.sizeXParam.value,g=this.sizeYParam.value,I=this.detailXParam.value,C=this.detailYParam.value,i=this.getVertexAttribute("positions");if(!i)return;let e=0;for(let t=0;t<=C;t++){const B=(t/C-.5)*g;for(let g=0;g<=I;g++){const C=(g/I-.5)*A;i.getValueRef(e).set(C,B,0),e++}}}}e.register("Plane",AI);class gI extends vg{constructor(A=1,g=12,I=12,C=!0,i=!0){if(super(),this.radiusParam=new JA("Radius",1),this.sidesParam=new JA("Sides",12,[3,200],1),this.loopsParam=new JA("Loops",6,[3,200],1),isNaN(A)||isNaN(g)||isNaN(I))throw new Error("Invalid geom args");this.addParameter(this.radiusParam),this.addParameter(this.sidesParam),this.addParameter(this.loopsParam),this.radiusParam.value=A,this.sidesParam.value=g,this.loopsParam.value=I,C&&this.addVertexAttribute("normals",new Zg),i&&this.addVertexAttribute("texCoords",new yg),this.topologyParams.push("Sides"),this.topologyParams.push("Loops")}rebuild(){const A=this.radiusParam.value,g=this.sidesParam.value,I=this.loopsParam.value,C=2+g*I,i=2*g,e=g*I;this.setNumVertices(C),this.setFaceCounts([i,e]);const t=this.getVertexAttribute("positions"),s=this.getVertexAttribute("normals"),a=new o(0,0,1);let l=0;if(!t)return;t.getValueRef(l).set(0,0,A),s&&s.getValueRef(l).set(0,0,1),l++;for(let C=0;C<I;C++){const i=(C+1)/(I+1)*Math.PI;for(let I=0;I<g;I++){const C=-I/g*2*Math.PI;a.set(Math.sin(i)*Math.cos(C),Math.sin(i)*Math.sin(C),Math.cos(i)),t.getValueRef(l).setFromOther(a.scale(A)),s&&s.getValueRef(l).setFromOther(a),l++}}t.getValueRef(l).set(0,0,-A),s&&s.getValueRef(l).set(0,0,-1),l++;const n=this.getVertexAttribute("texCoords");let d=0;for(let A=0;A<g;A++){const C=0,i=(A+1)%g+1,e=A+1;if(this.setFaceVertexIndices(d,[C,i,e]),n){const C=new B(.5,0),i=new B((A+1)/(g-1),1/(I+1)),e=new B(A/(g-1),1/(I+1));n.setFaceVertexValue(d,0,C),n.setFaceVertexValue(d,1,i),n.setFaceVertexValue(d,2,e)}d++}for(let A=0;A<g;A++){const i=C-1,e=g*(I-1)+(A+1)%g+1,t=g*(I-1)+A+1;if(this.setFaceVertexIndices(d,[i,t,e]),n){const C=new B(.5,1),i=new B((A+1)/(g-1),1-1/(I+1)),e=new B(A/(g-1),1-1/(I+1));n.setFaceVertexValue(d,0,C),n.setFaceVertexValue(d,1,i),n.setFaceVertexValue(d,2,e)}d++}for(let A=0;A<I-1;A++)for(let C=0;C<g;C++){const i=g*A+C+1,e=g*A+(C+1)%g+1,t=g*(A+1)+(C+1)%g+1,o=g*(A+1)+C+1;this.setFaceVertexIndices(d,[i,e,t,o]),n&&(n.setFaceVertexValue(d,0,new B(C/g,(A+1)/I)),n.setFaceVertexValue(d,1,new B((C+1)/g,(A+1)/I)),n.setFaceVertexValue(d,2,new B((C+1)/g,(A+2)/I)),n.setFaceVertexValue(d,3,new B(C/g,(A+2)/I))),d++}}resize(){const A=this.radiusParam.value,g=this.sidesParam.value,I=this.loopsParam.value;if(!g||!I)return void console.warn("resize() failed");const C=this.getVertexAttribute("positions"),i=this.getVertexAttribute("normals");let e=0;const t=new o(0,0,1);C.getValueRef(e).set(0,0,A),i&&i.getValueRef(e).set(0,0,1),e++;for(let B=0;B<I;B++){const o=(B+1)/(I+1)*Math.PI;for(let I=0;I<g;I++){const B=-I/g*2*Math.PI;t.set(Math.sin(o)*Math.cos(B),Math.sin(o)*Math.sin(B),Math.cos(o)),C.getValueRef(e).setFromOther(t.scale(A)),i&&i.getValueRef(e).setFromOther(t),e++}}C.getValueRef(e).set(0,0,-A),i&&i.getValueRef(e).set(0,0,-1),e++}}e.register("Sphere",gI);class II extends vg{constructor(A=.5,g=3,I=32,C=2*Math.PI){if(super(),isNaN(A)||isNaN(g)||isNaN(I))throw new Error("Invalid geom args");this.innerRadiusParam=this.addParameter(new JA("InnerRadius",A)),this.outerRadiusParam=this.addParameter(new JA("OuterRadius",g)),this.detailParam=this.addParameter(new JA("Detail",I>=3?I:3,[3,200],1)),this.arcAngleParam=this.addParameter(new JA("ArcAngle",C)),this.addVertexAttribute("texCoords",new yg),this.addVertexAttribute("normals",new Zg),this.topologyParams.push("Detail"),this.topologyParams.push("ArcAngle")}rebuild(){const A=this.arcAngleParam.value<2*Math.PI,g=this.detailParam.value,I=g,C=2*g+(A?1:0),i=I*C;this.setNumVertices(i),this.setFaceCounts([0,I*C]);const e=this.getVertexAttribute("texCoords");if(e){let g=0;for(let i=0;i<(A?C-1:C);i++)for(let A=0;A<I;A++){const t=(i+1)%C,o=(A+1)%I,s=I*i+A,a=I*i+o,l=I*t+o,n=I*t+A;this.setFaceVertexIndices(g,[s,a,l,n]),e.setFaceVertexValue(g,0,new B(i/C,A/C)),e.setFaceVertexValue(g,1,new B(i/C,(A+1)/C)),e.setFaceVertexValue(g,2,new B((i+1)/C,(A+1)/C)),e.setFaceVertexValue(g,3,new B((i+1)/C,A/C)),g++}}this.resize()}resize(){const A=this.innerRadiusParam.value,g=this.outerRadiusParam.value,I=this.arcAngleParam.value,C=this.detailParam.value,i=I<2*Math.PI,e=C,t=2*C+(i?1:0),B=this.getVertexAttribute("positions"),o=this.getVertexAttribute("normals");if(!B||!o)return;let s=0;for(let C=0;C<t;C++){const a=-C/(i?t-1:t)*I,l=Math.cos(a),n=Math.sin(a);for(let I=0;I<e;I++){const C=I/e*2*Math.PI,i=Math.sin(C),t=Math.cos(C),a=g+t*A;B.getValueRef(s).set(l*a,n*a,A*i),o.getValueRef(s).set(l*t,n*t,i),s++}}}}e.register("Torus",II);class CI extends Gg{constructor(A){super(A),this.__data=new Uint8Array(4),this.format="RGBA",this.type="UNSIGNED_BYTE",this.width=1,this.height=1}isLoaded(){return this.loaded}isStream(){return!1}setData(A,g,I){this.__data!=I&&(this.width=A,this.height=g,this.__data=I,this.loaded?this.emit("updated"):(this.loaded=!0,this.emit("loaded")))}getParams(){const A=super.getParams();return A.data=this.__data,A}}e.register("DataImage2D",CI),e.register("DataImage",CI);const iI={};class eI extends Gg{constructor(A,g="",I={}){super(A),this.__data=null,this.type="UNSIGNED_BYTE",this.crossOrigin="anonymous",g&&""!=g&&this.load(g)}setCrossOrigin(A){this.crossOrigin=A}getDOMElement(){return this.__data}load(A,g="RGB"){return new Promise(((I,C)=>{if(!g){const I=A.lastIndexOf(".");if(-1!=I){".png"==A.substring(I).toLowerCase()&&(g="RGBA")}}this.format=g,this.loaded=!1;const i=()=>{this.url=A,this.width=this.__data.width,this.height=this.__data.height,this.loaded=!0,this.emit("loaded"),I()};A in iI?(this.__data=iI[A],this.__data.complete?i():(this.__data.addEventListener("load",i),this.__data.addEventListener("error",C))):(this.__data=new Image,this.__data.crossOrigin=this.crossOrigin,this.__data.src=A,this.__data.addEventListener("load",i),this.__data.addEventListener("error",C),iI[A]=this.__data)}))}setImageURL(A,g="RGB"){this.load(A,g)}getParams(){const A=super.getParams();return this.loaded&&(A.data=this.__data),A}readBinary(A,g){this.setName(A.loadStr());const I=A.loadStr();if("string"==typeof I&&""!=I){const A=g.url.substring(0,g.url.lastIndexOf("/"));this.load(A+"/"+I)}}}e.register("FileImage2D",eI),e.register("FileImage",eI);class tI extends eI{constructor(A,g,I){super(A,g,I)}}e.register("LDRImage",tI);class BI extends Gg{constructor(A,g={}){let I;super(A),this.exposure=1,this.hdrTint=new l(1,1,1,1),null!=A&&A.includes(".")&&(I=A,this.setName(A.substring(A.lastIndexOf("/")+1,A.lastIndexOf(".")))),this.type="FLOAT",I&&this.load(I)}__decodeData(A){return new Promise(((g,I)=>{const C=A.ldr,i=A.cdm,e=new Blob([C.buffer]),t=new Image;t.onload=()=>{this.width=t.width,this.height=t.height,this.__data={ldr:t,cdm:i},this.loaded?this.emit("updated"):(this.loaded=!0,this.emit("loaded")),g()},t.src=URL.createObjectURL(e)}))}load(A){return this.loaded=!1,new Promise(((g,I)=>{const C=A.lastIndexOf("/")>-1?A.substring(A.lastIndexOf("/")+1):"",i=C.substring(0,C.lastIndexOf("."));""==this.getName()&&this.setName(i),this.type="FLOAT",FA.loadFile("archive",A).then((A=>{if(!A.ldr||!A.cdm)for(const g in A)g.endsWith(".jpg")?(A.ldr=A[g],delete A[g]):g.endsWith(".bin")&&(A.cdm=A[g],delete A[g]);this.__decodeData(A).then((()=>{g()}))}),(A=>{this.emit("error",A),I(A)}))}))}isStream(){return!1}getParams(){const A=super.getParams();return this.loaded&&(A.data=this.__data,A.exposure=this.exposure),A}setHDRTint(A){this.hdrTint=A}getHDRTint(){return this.hdrTint}readBinary(A,g){this.setName(A.loadStr());let I=A.loadStr();"string"==typeof I&&""!=I&&this.load(I)}}e.register("HDRImage",BI);class oI extends eI{constructor(A,g,I){super(A,g,I),this.videoElem=new HTMLVideoElement,this.muteParam=new fA("Mute",!1),this.loopParam=new fA("Loop",!0),this.spatializeAudioParam=new fA("SpatializeAudio",!0),this.refDistanceParam=new JA("refDistance",2),this.maxDistanceParam=new JA("maxDistance",1e4),this.rolloffFactorParam=new JA("rolloffFactor",1),this.coneInnerAngleParam=new JA("coneInnerAngle",360),this.coneOuterAngleParam=new JA("coneOuterAngle",0),this.coneOuterGainParam=new JA("coneOuterGain",1),this.gainParam=new JA("Gain",2),this.format="RGB",this.type="UNSIGNED_BYTE",this.addParameter(this.muteParam),this.addParameter(this.loopParam),this.addParameter(this.spatializeAudioParam),this.addParameter(this.refDistanceParam),this.addParameter(this.maxDistanceParam),this.addParameter(this.rolloffFactorParam),this.addParameter(this.coneInnerAngleParam),this.addParameter(this.coneOuterAngleParam),this.addParameter(this.coneOuterGainParam),this.addParameter(this.gainParam).setRange([0,5])}getAudioSource(){return this.videoElem}load(A,g="RGB"){return new Promise(((g,I)=>{FA.incrementWorkload(1),this.videoElem.style.display="none",this.videoElem.preload="auto",this.videoElem.crossOrigin="anonymous",document.body.appendChild(this.videoElem),this.videoElem.addEventListener("loadedmetadata",(()=>{this.videoElem.muted=this.muteParam.value,this.muteParam.on("valueChanged",(()=>{this.videoElem.muted=this.muteParam.value})),this.videoElem.loop=this.loopParam.value,this.loopParam.on("valueChanged",(()=>{this.videoElem.loop=this.loopParam.value})),this.width=this.videoElem.videoHeight,this.height=this.videoElem.videoWidth,this.loaded=!0,FA.incrementWorkDone(1),this.emit("loaded"),g(C);let A=0;const I=()=>{if(this.videoElem.paused||this.videoElem.ended)return;const g=Math.floor(29.97*this.videoElem.currentTime);A!=g&&(this.emit("updated"),A=g),setTimeout(I,20)};I()}),!1),this.videoElem.src=A;const C=this.videoElem.play();void 0!==C&&C.then((A=>{console.log("Autoplay started!")})).catch((()=>{console.log("Autoplay was prevented.")}))}))}getParams(){const A=super.getParams();return this.loaded&&(A.data=this.videoElem),A}}function sI(A){this.data=A,this.pos=0}function aI(A){this.stream=new sI(A),this.output={}}e.register("LDRVideo",oI),sI.prototype.readByte=function(){return this.data[this.pos++]},sI.prototype.peekByte=function(){return this.data[this.pos]},sI.prototype.readBytes=function(A){for(var g=new Array(A),I=0;I<A;I++)g[I]=this.readByte();return g},sI.prototype.peekBytes=function(A){for(var g=new Array(A),I=0;I<A;I++)g[I]=this.data[this.pos+I];return g},sI.prototype.readString=function(A){for(var g="",I=0;I<A;I++)g+=String.fromCharCode(this.readByte());return g},sI.prototype.readBitArray=function(){for(var A=[],g=this.readByte(),I=7;I>=0;I--)A.push(!!(g&1<<I));return A},sI.prototype.readUnsigned=function(A){var g=this.readBytes(2);return A?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]},aI.prototype.parse=function(A){return this.parseParts(this.output,A),this.output},aI.prototype.parseParts=function(A,g){for(var I=0;I<g.length;I++){var C=g[I];this.parsePart(A,C)}},aI.prototype.parsePart=function(A,g){var I,C=g.label;if(!g.requires||g.requires(this.stream,this.output,A))if(g.loop){for(var i=[];g.loop(this.stream);){var e={};this.parseParts(e,g.parts),i.push(e)}A[C]=i}else g.parts?(I={},this.parseParts(I,g.parts),A[C]=I):g.parser?(I=g.parser(this.stream,this.output,A),g.skip||(A[C]=I)):g.bits&&(A[C]=this.parseBits(g.bits))},aI.prototype.parseBits=function(A){var g={},I=this.stream.readBitArray();for(var C in A){var i=A[C];i.length?g[C]=I.slice(i.index,i.index+i.length).reduce((function(A,g){return 2*A+g}),0):g[C]=I[i.index]}return g};var lI=function(){return function(A){return A.readByte()}},nI=function(A){return function(g){return g.readBytes(A)}},dI=function(A){return function(g){return g.readString(A)}},hI=function(A){return function(g){return g.readUnsigned(A)}},cI=function(A,g){return function(I,C,i){for(var e=g(I,C,i),t=new Array(e),B=0;B<e;B++)t[B]=I.readBytes(A);return t}},rI={label:"blocks",parser:function(A){for(var g=[],I=A.readByte();0!==I;I=A.readByte())g=g.concat(A.readBytes(I));return g}},GI={label:"gce",requires:function(A){var g=A.peekBytes(2);return 33===g[0]&&249===g[1]},parts:[{label:"codes",parser:nI(2),skip:!0},{label:"byteSize",parser:lI()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:hI(!0)},{label:"transparentColorIndex",parser:lI()},{label:"terminator",parser:lI(),skip:!0}]},mI={label:"image",requires:function(A){return 44===A.peekByte()},parts:[{label:"code",parser:lI(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:hI(!0)},{label:"top",parser:hI(!0)},{label:"width",parser:hI(!0)},{label:"height",parser:hI(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(A,g,I){return I.descriptor.lct.exists},parser:cI(3,(function(A,g,I){return Math.pow(2,I.descriptor.lct.size+1)}))},{label:"data",parts:[{label:"minCodeSize",parser:lI()},rI]}]},QI={label:"text",requires:function(A){var g=A.peekBytes(2);return 33===g[0]&&1===g[1]},parts:[{label:"codes",parser:nI(2),skip:!0},{label:"blockSize",parser:lI()},{label:"preData",parser:function(A,g,I){return A.readBytes(I.text.blockSize)}},rI]},EI={label:"frames",parts:[GI,{label:"application",requires:function(A,g,I){var C=A.peekBytes(2);return 33===C[0]&&255===C[1]},parts:[{label:"codes",parser:nI(2),skip:!0},{label:"blockSize",parser:lI()},{label:"id",parser:function(A,g,I){return A.readString(I.blockSize)}},rI]},{label:"comment",requires:function(A,g,I){var C=A.peekBytes(2);return 33===C[0]&&254===C[1]},parts:[{label:"codes",parser:nI(2),skip:!0},rI]},mI,QI],loop:function(A){var g=A.peekByte();return 33===g||44===g}},bI=[{label:"header",parts:[{label:"signature",parser:dI(3)},{label:"version",parser:dI(3)}]},{label:"lsd",parts:[{label:"width",parser:hI(!0)},{label:"height",parser:hI(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:lI()},{label:"pixelAspectRatio",parser:lI()}]},{label:"gct",requires:function(A,g){return g.lsd.gct.exists},parser:cI(3,(function(A,g){return Math.pow(2,g.lsd.gct.size+1)}))},EI];function ZI(A){var g=new aI(new Uint8Array(A));this.raw=g.parse(bI),this.raw.hasImages=!1;for(var I=0;I<this.raw.frames.length;I++)if(this.raw.frames[I].image){this.raw.hasImages=!0;break}}ZI.prototype.decompressFrame=function(A,g){if(A>=this.raw.frames.length)return null;var I=this.raw.frames[A];if(I.image){var C=I.image.descriptor.width*I.image.descriptor.height,i=function(A,g,I){var C,i,e,t,B,o,s,a,l,n,d,h,c,r,G,m,Q=4096,E=-1,b=I,Z=new Array(I),y=new Array(Q),u=new Array(Q),R=new Array(Q+1);for(B=(i=1<<(h=A))+1,C=i+2,s=E,e=(1<<(t=h+1))-1,l=0;l<i;l++)y[l]=0,u[l]=l;for(d=a=c=r=m=G=0,n=0;n<b;){if(0===r){if(a<t){d+=g[G]<<a,a+=8,G++;continue}if(l=d&e,d>>=t,a-=t,l>C||l==B)break;if(l==i){e=(1<<(t=h+1))-1,C=i+2,s=E;continue}if(s==E){R[r++]=u[l],s=l,c=l;continue}for(o=l,l==C&&(R[r++]=c,l=s);l>i;)R[r++]=u[l],l=y[l];c=255&u[l],R[r++]=c,C<Q&&(y[C]=s,u[C]=c,0==(++C&e)&&C<Q&&(t++,e+=C)),s=o}r--,Z[m++]=R[r],n++}for(n=m;n<b;n++)Z[n]=0;return Z}(I.image.data.minCodeSize,I.image.data.blocks,C);I.image.descriptor.lct.interlaced&&(i=function(A,g){for(var I=new Array(A.length),C=A.length/g,i=function(C,i){var e=A.slice(i*g,(i+1)*g);I.splice.apply(I,[C*g,g].concat(e))},e=[0,4,2,1],t=[8,8,4,2],B=0,o=0;o<4;o++)for(var s=e[o];s<C;s+=t[o])i(s,B),B++;return I}(i,I.image.descriptor.width));var e={pixels:i,dims:{top:I.image.descriptor.top,left:I.image.descriptor.left,width:I.image.descriptor.width,height:I.image.descriptor.height}};return I.image.descriptor.lct&&I.image.descriptor.lct.exists?e.colorTable=I.image.lct:e.colorTable=this.raw.gct,I.gce&&(e.delay=10*(I.gce.delay||10),e.disposalType=I.gce.extras.disposal,I.gce.extras.transparentColorGiven&&(e.transparentIndex=I.gce.transparentColorIndex)),g&&(e.patch=function(A){for(var g=A.pixels.length,I=new Uint8ClampedArray(4*g),C=0;C<g;C++){var i=4*C,e=A.pixels[C],t=A.colorTable[e];I[i]=t[0],I[i+1]=t[1],I[i+2]=t[2],I[i+3]=e!==A.transparentIndex?255:0}return I}(e)),e}return null},ZI.prototype.decompressFrames=function(A){for(var g=[],I=0;I<this.raw.frames.length;I++){this.raw.frames[I].image&&g.push(this.decompressFrame(I,A))}return g};const yI={};class uI extends eI{constructor(A,g="",I={}){super(A,g,I),this.streamAtlasDescParam=new UA("StreamAtlasDesc"),this.streamAtlasIndexParam=new JA("StreamAtlasIndex",0),this.format="RGBA",this.type="UNSIGNED_BYTE",this.__streamAtlas=!0,this.addParameter(this.streamAtlasDescParam),this.addParameter(this.streamAtlasIndexParam);const C=this.streamAtlasIndexParam;let i;C.setRange([0,1]);let e=0;const t=A=>{C.value=e,i&&setTimeout((()=>t(A)),this.getFrameDelay(e)),e=(e+1)%A};this.play=()=>{this.__resourcePromise.then((()=>{i=!0;let A=C.getRange();if(!A)return void console.warn("numFrames is null");const g=A[1];t(g)}))},this.stop=()=>{i=!1}}getFrameDelay(A){return 10*this.__unpackedData.frameDelays[A]}load(A,g="RGB"){return A in yI?(this.__resourcePromise=yI[A],this.__resourcePromise):(this.__resourcePromise=new Promise(((g,I)=>{FA.incrementWorkload(1),GA(A,(I=>{console.warn("Unpacking Gif client side:"+A);const C=performance.now(),i=new ZI(I).decompressFrames(!0),e=Math.sqrt(i.length),t=[e,e];r.fract(e)>0&&(t[0]=Math.floor(t[0]+1),r.fract(e)>.5?t[1]=Math.floor(t[1]+1):t[1]=Math.floor(t[1]));const B=i[0].dims.width,o=i[0].dims.height,s=document.createElement("canvas"),a=s.getContext("2d"),l=document.createElement("canvas"),n=l.getContext("2d");l.width=B,l.height=o;const d=document.createElement("canvas"),h=d.getContext("2d");let c;d.width=t[0]*B,d.height=t[1]*o;const G=[],m=(A,g)=>{const I=A.dims;G.push(A.delay/10),c&&I.width==c.width&&I.height==c.height||(s.width=I.width,s.height=I.height,c=null==a?void 0:a.createImageData(I.width,I.height)),c.data.set(A.patch),null==a||a.putImageData(c,0,0),2==A.disposalType&&(null==n||n.clearRect(0,0,l.width,l.height)),null==n||n.drawImage(s,I.left,I.top),null==h||h.drawImage(l,g%t[0]*B,Math.floor(g/t[0])*o)};for(let A=0;A<i.length;A++)m(i[A],A);FA.incrementWorkDone(1);const Q=null==h?void 0:h.getImageData(0,0,d.width,d.height),E=performance.now()-C;console.log(`Decode GIF '${A}' time:`+E),g({width:d.width,height:d.height,atlasSize:t,frameRange:[0,i.length],frameDelays:G,imageData:Q})}),(g=>{const C="Unable to Load URL:"+g+":"+A;console.warn(C),I(C)}))})),yI[A]=this.__resourcePromise,this.__resourcePromise.then((A=>{this.width=A.width,this.height=A.height,this.streamAtlasDescParam.value=new s(A.atlasSize[0],A.atlasSize[1],0,0),this.streamAtlasIndexParam.setRange(A.frameRange),this.__unpackedData=A,this.__data=A.imageData,this.loaded=!0,this.emit("loaded")})),this.__resourcePromise)}}e.register("GIFImage",uI);class RI extends BI{constructor(A,g={}){super(A,g),this.headlightModeParam=new fA("HeadLightMode",!1),this.addParameter(this.headlightModeParam),this.utf8decoder=new TextDecoder,this.shCoeffs=[]}__decodeData(A){const g=A.samples;if(g&&(this.luminanceData=JSON.parse(this.utf8decoder.decode(g)),this.luminanceData.shCoeffs))for(let A=0;A<9;A++)this.shCoeffs[A]=new l(this.luminanceData.shCoeffs[3*A+0],this.luminanceData.shCoeffs[3*A+1],this.luminanceData.shCoeffs[3*A+2]);return super.__decodeData(A)}dirToLuminance(A){const g=A.x,I=A.y,C=A.z,i=this.shCoeffs[0].scale(.886227);return i.addInPlace(this.shCoeffs[1].scale(1.023328*I)),i.addInPlace(this.shCoeffs[2].scale(1.023328*C)),i.addInPlace(this.shCoeffs[3].scale(1.023328*g)),i.addInPlace(this.shCoeffs[4].scale(.858086*g*I)),i.addInPlace(this.shCoeffs[5].scale(.858086*I*C)),i.addInPlace(this.shCoeffs[6].scale(.743125*C*C-.247708)),i.addInPlace(this.shCoeffs[7].scale(.858086*g*C)),i.addInPlace(this.shCoeffs[8].scale(.429043*(g*g-I*I))),i.luminance()}}e.register("EnvMap",RI);class VI extends V{constructor(){super(),this.__labelLibraries={},this.__language=function(){if(!globalThis.navigator)return"en";const A=new URLSearchParams(window.location.search);if(A.has("lang"))return A.get("lang");const g=globalThis.navigator;let I,C;const i=A=>A.startsWith("en")?"En":A.startsWith("es")?"Es":A.startsWith("fr")?"Fr":A.startsWith("gb")||A.startsWith("de")?"Gb":A;if(Array.isArray(g.languages))for(I=0;I<g.languages.length;I++)if(C=g.languages[I],C&&C.length)return i(C);return null}(),this.__foundLabelLibraries={}}loadLibrary(A,g){const I=A.substring(0,A.lastIndexOf("."));if(this.__foundLabelLibraries[I]=g,A.endsWith(".labels"))rA(g,(A=>{this.__labelLibraries[I]=JSON.parse(A),this.emit("labelLibraryLoaded",{library:I})}));else if(A.endsWith(".xlsx")){const A=globalThis.XLSX;GA(g,(g=>{const C=new Uint8Array(g),i=A.read(C,{type:"array"}),e={};i.SheetNames.forEach((function(g){A.utils.sheet_to_json(i.Sheets[g],{}).forEach((function(A){const g=A.Identifier;delete A.Identifier,e[g]=A}))})),this.__labelLibraries[I]=e,this.emit("labelLibraryLoaded",{library:I})}))}}isLibraryFound(A){return A in this.__foundLabelLibraries}isLibraryLoaded(A){return A in this.__labelLibraries}getLabelText(A,g){const I=this.__labelLibraries[A];if(!I)throw new Error("LabelLibrary: '"+A+"' not found in LabelManager. Found: ["+Object.keys(this.__labelLibraries)+"]");const C=I[g];if(!C)throw new Error("Label: '"+g+"' not found in LabelLibrary: '"+A+"'. Found: ["+Object.keys(I)+"]");const i=C[this.__language];if(!i){if(C.En)return C.En;throw new Error("labelText: '"+this.__language+"' not found in Label. Found: ["+Object.keys(C)+"]")}return i}setLabelText(A,g,I){let C=this.__labelLibraries[A];C||(C={},this.__labelLibraries[A]=C);let i=C[g];i||(i={},C[g]=i),i[this.__language]=I}setLanguage(A){this.__language=A}}const FI=new VI;class SI extends CI{constructor(A,g){super(A),this.requestedReRender=!1,this.libraryParam=new jA("Library"),this.textParam=new jA("Text",""),this.fontColorParam=new xA("FontColor",new l(0,0,0)),this.fontSizeParam=new JA("FontSize",22),this.fontParam=new jA("Font","Helvetica"),this.borderWidthParam=new JA("BorderWidth",2),this.outlineParam=new fA("Outline",!1),this.outlineColorParam=new xA("OutlineColor",new l(0,0,0)),this.backgroundParam=new fA("Background",!0),this.backgroundColorParam=new xA("BackgroundColor",new l("#FBC02D")),this.fillBackgroundParam=new fA("FillBackground",!0),this.strokeBackgroundOutlineParam=new fA("StrokeBackgroundOutline",!0),this.canvasElem=document.createElement("canvas");this.marginParam=new JA("Margin",11),this.borderRadiusParam=new JA("BorderRadius",11),this.addParameter(this.marginParam),this.addParameter(this.borderRadiusParam),this.addParameter(this.libraryParam),this.addParameter(this.textParam),this.addParameter(this.fontColorParam),this.addParameter(this.fontSizeParam),this.addParameter(this.fontParam),this.addParameter(this.borderWidthParam),this.addParameter(this.outlineParam),this.addParameter(this.outlineColorParam),this.addParameter(this.backgroundParam),this.addParameter(this.backgroundColorParam),this.addParameter(this.fillBackgroundParam),this.addParameter(this.strokeBackgroundOutlineParam);this.on("nameChanged",(()=>{this.loadLabelData()})),g&&(this.libraryParam.value=g),this.requestedReRender=!1,this.needsRender=!1,this.loadLabelData()}__parameterValueChanged(A){super.parameterValueChanged(A),this.requestedReRender||(this.requestedReRender=!0,this.loadLabelData())}loadLabelData(){Promise.all([(()=>new Promise((A=>{const g=this.libraryParam.value;if(""==g)return void A();if(!FI.isLibraryFound(g))return console.warn("Label Library not found:",g),void A();const I=()=>{try{const A=this.getName(),I=FI.getLabelText(g,A);this.textParam.value=I}catch(A){console.warn(A)}A()};FI.isLibraryLoaded(g)?I():FI.on("labelLibraryLoaded",(A=>{A.library==g&&I()}))})))(),(()=>new Promise((A=>{if(null!=document.fonts){const g=this.fontParam.value,I=this.fontSizeParam.value;document.fonts.load(I+'px "'+g+'"').then((()=>{A()}))}else A()})))()]).then((()=>{this.requestedReRender=!1,this.needsRender=!0,this.loaded?this.emit("updated"):(this.loaded=!0,this.emit("loaded"))}))}renderLabelToImage(){const A=this.canvasElem.getContext("2d",{alpha:!0});let g=this.textParam.value;""==g&&(g=this.getName());const I=this.fontParam.value,C=this.fontColorParam.value,i=this.fontSizeParam.value,e=this.marginParam.value,t=this.borderWidthParam.value,B=this.borderRadiusParam.value,o=this.outlineParam.value,s=this.outlineColorParam.value,a=this.backgroundParam.value,l=this.backgroundColorParam.value,n=this.fillBackgroundParam.value,d=this.strokeBackgroundOutlineParam.value,h=e+t,c=g.split("\n");A.font=i+'px "'+I+'"';let r=0;c.forEach((g=>{r=Math.max(A.measureText(g).width,r)}));const G=i;this.width=Math.ceil(r+2*h),this.height=Math.ceil(G*c.length+2*h),A.canvas.width=this.width,A.canvas.height=this.height,this.canvasElem.width=this.width,this.canvasElem.height=this.height,A.fillStyle="rgba(0, 0, 0, 0.0)",A.fillRect(0,0,this.width,this.height),a&&(A.fillStyle=l.toHex(),A.strokeStyle=s.toHex(),function(A,g,I,C,i,e,t=!1,B=!0,o){if(void 0===B&&(B=!0),void 0===e&&(e=5),"number"==typeof e)e={tl:e,tr:e,br:e,bl:e};else{const A={tl:0,tr:0,br:0,bl:0};for(const g in A)e[g]=e[g]||A[g]}A.beginPath(),A.moveTo(g+e.tl,I),A.lineTo(g+C-e.tr,I),A.quadraticCurveTo(g+C,I,g+C,I+e.tr),A.lineTo(g+C,I+i-e.br),A.quadraticCurveTo(g+C,I+i,g+C-e.br,I+i),A.lineTo(g+e.bl,I+i),A.quadraticCurveTo(g,I+i,g,I+i-e.bl),A.lineTo(g,I+e.tl),A.quadraticCurveTo(g,I,g+e.tl,I),A.closePath(),t&&A.fill(),B&&(A.lineWidth=o,A.stroke())}(A,t,t,this.width-2*t,this.height-2*t,B,n,d,t)),A.font=i+'px "'+I+'"',A.textAlign="left",A.fillStyle=C.toHex(),A.textBaseline="hanging",c.forEach(((g,I)=>{A.fillText(g,h,h+I*G)})),o&&(A.strokeStyle=s.toHex(),A.lineWidth=1.5,A.strokeText(g,h,h)),this.__data=A.getImageData(0,0,this.width,this.height),this.needsRender=!1,this.emit("labelRendered",{width:this.width,height:this.height,data:this.__data})}getParams(){return this.needsRender&&this.renderLabelToImage(),super.getParams()}}e.register("Label",SI);class wI extends Gg{constructor(){super("")}connectWebcam(A,g,I=!1){const C={width:A,height:g,frameRate:{ideal:60,max:60}};C.facingMode=I?{exact:"environment"}:{facingMode:"user"};const i=document.createElement("video");i.style.display="none",i.preload="auto",i.crossOrigin="anonymous",document.body.appendChild(i),navigator.mediaDevices.getUserMedia({audio:!1,video:C}).then((A=>{i.srcObject=A,i.onloadedmetadata=A=>{i.play(),this.width=i.videoWidth,this.height=i.videoHeight,console.log("Webcam:["+this.width+", "+this.height+"]"),this.__data=i,this.loaded=!0,this.emit("loaded");let g=0;const I=()=>{if(i.paused||i.ended)return;const A=Math.floor(60*i.currentTime);g!=A&&(this.emit("updated"),g=A),setTimeout(I,20)};I()}})).catch((function(A){}))}setVideoStream(A){this.loaded=!1,this.width=A.videoWidth,this.height=A.videoHeight,this.start(),this.__data=A,this.loaded=!0,this.emit("loaded")}stop(){clearInterval(this.__intervalId)}start(){this.__intervalId=setInterval((()=>{this.emit("updated")}),20)}isLoaded(){return this.loaded}getParams(){return{type:this.type,format:this.format,width:this.width,height:this.height,data:this.__data,flipY:!0}}}e.register("VideoStreamImage2D",wI);class XI extends hA{constructor(A,g){super(A),this.__isOpaque=!0,this.__isTextured=!1,this.__shaderName="",g&&this.setShaderName(g)}getShaderName(){return this.__shaderName}setShaderName(A){if(this.__shaderName==A)return;this.__shaderName=A;const g=e.getClassDefinition(A).getMaterialTemplate();if(!g)throw new Error("Error setting Shader. Material template not registered found:"+A);const I={};let C=g.getNumParameters();for(;C--;){const A=g.getParameterByIndex(C);this.getParameter(A.getName())||this.addParameter(A.clone()),I[A.getName()]=!0}for(const A of this.params)I[A.getName()]||this.removeParameter(A.getName());this.__shaderName=A,this.__checkOpacity({});const i=new k(A);this.emit("shaderNameChanged",i)}removeAllTextures(){for(const A of this.params)A instanceof Qg?A.getImage()&&A.setImage(null):A instanceof mg&&A.getImage()&&A.setImage(null)}getParamTextures(){const A={};for(const g of this.params)g instanceof Qg?g.getImage()&&(A[g.getName()]=g.getImage()):g instanceof mg&&g.getImage()&&(A[g.getName()]=g.getImage());return A}isOpaque(){return this.__isOpaque}__checkOpacity(A){let g=!0;try{this.getShaderClass().isOpaque()||(g=!1)}catch(A){}if(g){const A=this.getParameter("Opacity");if(A&&(A.value<.99||A instanceof mg&&A.getImage()))g=!1;else{const A=this.getParameter("BaseColor");if(A){if(A instanceof Qg){const I=A.getImage();I&&"RGBA"==I.format&&(g=!1)}if(g&&A.value){A.value.a<1&&(g=!1)}}}}if(g!=this.__isOpaque){this.__isOpaque=g;const A=new _(g,!0);this.emit("opacityChanged",A),this.emit("transparencyChanged",A)}}isTextured(){return this.__isTextured}__checkTextures(A){const g=A||{};let I=!1;for(const A of this.params)if(A instanceof Qg){if(A.getImage()){I=!0;break}}else if(A instanceof mg&&A.getImage()){I=!0;break}if(I!=this.__isTextured){this.__isTextured=I;let A=new T(I,g);this.emit("texturedChanged",A)}}parameterValueChanged(A){this.__checkOpacity(A),this.__checkTextures(A),super.parameterValueChanged(A)}getShaderClass(){return e.getClassDefinition(this.getShaderName())}toJSON(A){const g=super.toJSON(A);return g.shader=this.__shaderName,g}fromJSON(A,g={}){A.shader?(this.setShaderName(A.shader),super.fromJSON(A,g)):console.warn("Invalid Material JSON")}readBinary(A,g){let I=A.loadStr();if("StandardMaterial"==I&&(I="StandardSurfaceShader"),"TransparentMaterial"==I&&(I="StandardSurfaceShader"),this.setShaderName(I),g.versions["zea-engine"].compare([0,0,3])<0)throw`Loading zcad files of version ${g.versions["zea-engine"]} is not longer support`;super.readBinary(A,g),this.__checkOpacity(),this.__checkTextures()}clone(A){const g=new XI("clone","");return g.copyFrom(this,A),g}copyFrom(A,g){this.setShaderName(A.getShaderName()),super.copyFrom(A,g)}}e.register("Material",XI);class HI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.opacityParam=new JA("Opacity",1),this.lineThicknessParam=new JA("LineThickness",.01),this.overlayParam=new JA("Overlay",0),this.__shaderName="FatLinesShader",this.addParameter(this.baseColorParam),this.addParameter(this.opacityParam),this.addParameter(this.overlayParam),this.addParameter(this.lineThicknessParam)}}e.register("FatLinesMaterial",HI);class WI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.pointSizeParam=new JA("PointSize",1),this.roundedParam=new JA("Rounded",1),this.borderWidthParam=new JA("BorderWidth",.2),this.overlayParam=new JA("Overlay",0),this.__shaderName="FatPointsShader",this.addParameter(this.baseColorParam),this.addParameter(this.pointSizeParam),this.addParameter(this.roundedParam),this.addParameter(this.borderWidthParam),this.addParameter(this.overlayParam)}clone(A){const g=new WI;return g.copyFrom(this,A),g}}e.register("FatPointsMaterial",WI);class YI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.overlayParam=new mg("Overlay",0),this.__shaderName="FlatSurfaceShader",this.addParameter(this.baseColorParam),this.addParameter(this.overlayParam)}clone(A){const g=new YI;return g.copyFrom(this,A),g}}e.register("FlatSurfaceMaterial",YI);class KI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.opacityParam=new mg("Opacity",.7,[0,1]),this.overlayParam=new mg("Overlay",1e-6),this.hiddenEdgeColorParam=new Qg("HiddenEdgeColor",new l(.2,.2,.2,0)),this.__shaderName="LinesShader",this.addParameter(this.baseColorParam),this.addParameter(this.opacityParam),this.addParameter(this.overlayParam),this.addParameter(this.hiddenEdgeColorParam)}clone(A){const g=new KI;return g.copyFrom(this,A),g}}e.register("LinesMaterial",KI);class pI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.pointSizeParam=new mg("PointSize",2),this.overlayParam=new mg("Overlay",2e-5),this.__shaderName="PointsShader",this.addParameter(this.baseColorParam),this.addParameter(this.pointSizeParam),this.addParameter(this.overlayParam)}clone(A){const g=new pI;return g.copyFrom(this,A),g}}e.register("PointsMaterial",pI);class NI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.__shaderName="ScreenSpaceShader",this.addParameter(this.baseColorParam)}clone(A){const g=new NI;return g.copyFrom(this,A),g}}e.register("ScreenSpaceMaterial",NI);class JI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.opacityParam=new mg("Opacity",1,[0,1]),this.emissiveStrengthParam=new mg("EmissiveStrength",0,[0,1]),this.__shaderName="SimpleSurfaceShader",this.addParameter(this.baseColorParam),this.addParameter(this.opacityParam),this.addParameter(this.emissiveStrengthParam)}clone(A){const g=new JI;return g.copyFrom(this,A),g}}e.register("SimpleSurfaceMaterial",JI);class DI extends XI{constructor(A){super(A),this.baseColorParam=new Qg("BaseColor",new l(1,1,.5)),this.normalParam=new Qg("Normal",new l(1,1,.5)),this.ambientOcclusion=new mg("AmbientOcclusion",1,[0,1]),this.metallicParam=new mg("Metallic",.05,[0,1]),this.roughnessParam=new mg("Roughness",.5,[0,1]),this.reflectanceParam=new mg("Reflectance",.5,[0,1]),this.emissiveStrengthParam=new mg("EmissiveStrength",0,[0,1]),this.opacityParam=new mg("Opacity",1,[0,1]),this.edgeColorParam=new Qg("EdgeColor",new l(.2,.2,.2)),this.pointColorParam=new Qg("PointColor",new l(.1,.1,.1)),this.hiddenEdgeColorParam=new Qg("HiddenEdgeColor",new l(.2,.2,.2,0)),this.__shaderName="StandardSurfaceShader",this.addParameter(this.baseColorParam),this.addParameter(this.normalParam),this.addParameter(this.ambientOcclusion),this.addParameter(this.metallicParam),this.addParameter(this.roughnessParam),this.addParameter(this.reflectanceParam),this.addParameter(this.emissiveStrengthParam),this.addParameter(this.opacityParam),this.addParameter(this.edgeColorParam),this.addParameter(this.pointColorParam),this.addParameter(this.hiddenEdgeColorParam)}clone(A){const g=new DI;return g.copyFrom(this,A),g}}e.register("StandardSurfaceMaterial",DI);class fI extends V{constructor(){super(),this.assetItem=null}}class MI extends ag{constructor(A){super(A),this.srcTreePath=[],this.srcTree=null}setSrcTree(A){this.srcTree=A;const g=new fI,I=this.srcTree.clone(g);I.localXfoParam.value=new m,this.addChild(I,!1,!1)}getSrcTree(){return this.srcTree}readBinary(A,g){if(super.readBinary(A,g),this.srcTreePath=A.loadStrArray(),this.srcTreePath.length>0)try{g.addPLCB((()=>{g.resolvePath(this.srcTreePath,(A=>{this.setSrcTree(A)}),(A=>{console.warn(`Error loading InstanceItem: ${this.getPath()}, unable to resolve: ${this.srcTreePath}. `+A.message)}))}))}catch(A){console.warn(`Error loading InstanceItem: ${this.getPath()}: `+A)}}clone(A){const g=new MI;return g.copyFrom(this,A),g}copyFrom(A,g){super.copyFrom(A,g),this.srcTreePath=A.srcTreePath,this.srcTreePath.length>0&&0==this.getNumChildren()&&A.once("childAdded",(A=>{const g=A.childItem;this.setSrcTree(g)}))}}e.register("InstanceItem",MI);class LI extends ag{constructor(A){super(A),this.materialParam=new rg("Material"),this.overlay=!1,this.__cutAway=!1,this.__cutAwayVector=new o(1,0,0),this.__cutAwayDist=0,this.__layers=[]}setOverlay(A){this.overlay=A}isOverlay(){return this.overlay}addLayer(A){this.__layers.push(A)}getLayers(){return this.__layers}isCutawayEnabled(){return this.__cutAway}setCutawayEnabled(A){this.__cutAway=A,this.emit("cutAwayChanged")}getCutVector(){return this.__cutAwayVector}setCutVector(A){this.__cutAwayVector=A,this.emit("cutAwayChanged")}getCutDist(){return this.__cutAwayDist}setCutDist(A){this.__cutAwayDist=A,this.emit("cutAwayChanged")}readBinary(A,g){if(super.readBinary(A,g),g.versions["zea-engine"].compare([0,0,4])>=0){const I=A.loadStr();let C=g.assetItem.getMaterialLibrary().getMaterial(I,!1);if(C||(C=new XI(I,"SimpleSurfaceShader"),C.getParameter("BaseColor").loadValue(l.random(.25)),g.assetItem.getMaterialLibrary().addMaterial(C)),this.materialParam.loadValue(C),this.__layers=A.loadStrArray(),this.__layers.length>0)for(const A of this.__layers)g.addGeomToLayer(this,A)}}}let UI=!1;class vI extends eg{constructor(A,g,I){super("CalcGeomMatOperator"),this.globalXfo=new Bg("GlobalXfo"),this.geomOffsetXfo=new Bg("GeomOffsetXfo"),this.geomMat=new ig("GeomMat"),this.globalXfo.setParam(A),this.geomOffsetXfo.setParam(g),this.geomMat.setParam(I),this.addInput(this.globalXfo),this.addInput(this.geomOffsetXfo),this.addOutput(this.geomMat)}evaluate(){const A=this.globalXfo.getValue().toMat4(),g=this.geomOffsetXfo.getValue().toMat4();this.geomMat.setClean(A.multiply(g))}}class kI extends LI{constructor(A,g,I,C){super(A),this.listenerIDs={},this.geomIndex=-1,this.assetItem=null,this.cullable=!0,this.geomOffsetXfoParam=new PA("GeomOffsetXfo"),this.geomParam=new hg("Geometry"),this.geomMatParam=new _A("GeomMat"),this.addParameter(this.geomParam),this.addParameter(this.materialParam),this.addParameter(this.geomOffsetXfoParam),this.addParameter(this.geomMatParam);const i=()=>{this.setBoundingBoxDirty()};this.geomParam.on("valueChanged",i),this.geomParam.on("boundingBoxChanged",i),this.calcGeomMatOperator=new vI(this.globalXfoParam,this.geomOffsetXfoParam,this.geomMatParam),g&&this.geomParam.loadValue(g),I&&this.materialParam.loadValue(I),C&&(this.localXfoParam.value=C)}_cleanBoundingBox(){if(this.disableBoundingBox)return new b;const A=super._cleanBoundingBox();if(this.geomBBox){const g=this.geomMatParam.value;A.addPoint(g.transformVec3(this.geomBBox.p0)),A.addPoint(g.transformVec3(this.geomBBox.p1))}else{const g=this.geomParam.value;if(g)if(UI){const I=this.geomMatParam.value;if(g instanceof pg){const C=g.__buffers.attrBuffers.positions.values,i=A=>{const g=3*A;return new o(C.subarray(g,g+3))};for(let C=0;C<g.getNumVertices();C++)A.addPoint(I.transformVec3(i(C)))}else{const C=g.getVertexAttribute("positions");for(let i=0;i<g.getNumVertices();i++)A.addPoint(I.transformVec3(C.getValueRef(i)))}}else A.addBox3(g.getBoundingBox(),this.geomMatParam.value)}return A}fromJSON(A,g){super.fromJSON(A,g)}readBinary(A,g){super.readBinary(A,g);const I=A.loadUInt8(),C=A.loadUInt32(),i=g.assetItem.getGeometryLibrary();this.geomIndex=C,this.assetItem=g.assetItem;const e=i.getGeom(C);if(e)this.geomParam.loadValue(e);else{const A=A=>{const{range:I}=A;if(C>=I[0]&&C<I[1]){const A=i.getGeom(C);A?this.geomParam.value=A:console.warn("Geom not loaded:",this.getName()),i.removeListenerById("rangeLoaded",g)}},g=i.on("rangeLoaded",A)}if(4&I&&(this.geomOffsetXfoParam.value=new m(A.loadFloat32Vec3(),A.loadFloat32Quat(),A.loadFloat32Vec3())),g.versions["zea-engine"].compare([0,0,4])<0){if(I&8){const I=g.assetItem.getMaterialLibrary(),C=A.loadStr();let i=I.getMaterial(C);i||(console.warn("Geom :'"+this.__name+"' Material not found:"+C),i=I.getMaterial("Default")),this.materialParam.loadValue(i)}else this.materialParam.loadValue(g.assetItem.getMaterialLibrary().getMaterial("Default"))}g.versions["zea-engine"].compare([3,0,0])<0?A.loadFloat32Vec2():this.geomBBox=new b(A.loadFloat32Vec3(),A.loadFloat32Vec3())}toString(A){return JSON.stringify(this.toJSON(A),null,2)}clone(A){const g=new kI;return g.copyFrom(this,A),g}copyFrom(A,g){if(super.copyFrom(A,g),!A.geomParam.value&&-1!=A.geomIndex){const g=A.assetItem.getGeometryLibrary();this.assetItem=A.assetItem,this.geomIndex=A.geomIndex,this.geomBBox=A.geomBBox;const I=A=>{const{range:I}=A;if(this.geomIndex>=I[0]&&this.geomIndex<I[1]){const A=g.getGeom(this.geomIndex);A?this.geomParam.value=A:console.warn("Geom not loaded:",this.getName()),g.removeListenerById("rangeLoaded",this.listenerIDs.rangeLoaded)}};this.listenerIDs.rangeLoaded=g.on("rangeLoaded",I)}this.geomMatParam.setDirty(0)}static setCalculatePreciseBoundingBoxes(A){UI=A}}e.register("GeomItem",kI);class xI extends ag{constructor(A){super(A),this.itemsParam=new dg("Items",(A=>A instanceof ag)),this.__itemsEventHandlers=[],this.addParameter(this.itemsParam),this.__itemsParam=this.itemsParam,this.itemsParam.on("itemAdded",(A=>{this.bindItem(A.item,A.index)})),this.itemsParam.on("itemRemoved",(A=>{this.unbindItem(A.item,A.index)}))}setSearchRoot(A){this.searchRoot=A}setOwner(A){this.searchRoot&&this.searchRoot!=this.getOwner()||(this.searchRoot=A),super.setOwner(A)}bindItem(A,g){if(!(A instanceof ag))return;const I={};I.pointerDown=A.on("pointerDown",(A=>{this.onPointerDown(A)})),I.pointerUp=A.on("pointerUp",(A=>{this.onPointerUp(A)})),I.pointerMove=A.on("pointerMove",(A=>{this.onPointerMove(A)})),I.pointerEnter=A.on("pointerEnter",(A=>{this.onPointerEnter(A)})),I.pointerLeave=A.on("pointerLeave",(A=>{this.onPointerLeave(A)})),this.__itemsEventHandlers.splice(g,0,I)}unbindItem(A,g){if(!(A instanceof ag))return;const I=this.__itemsEventHandlers[g];for(let g in I){const C=g.split(".");if(C.length>1){const i=A.getParameter(C[0]);i&&i.removeListenerById(C[1],I[g])}else A.removeListenerById(g,I[g])}this.__itemsEventHandlers.splice(g,1)}addItem(A,g=!0){A?this.itemsParam.addItem(A,g):console.warn("Error adding item to group. Item is null")}removeItem(A,g=!0){const I=this.itemsParam.value;if(!I)return;const C=Array.from(I).indexOf(A);C&&this.itemsParam.removeItem(C,g)}clearItems(A=!0){const g=this.itemsParam.value;if(!g)return;const I=Array.from(g);for(let A=I.length-1;A>=0;A--)this.unbindItem(I[A],A);this.itemsParam.clearItems(A)}getItems(){return this.itemsParam.value}setItems(A){this.clearItems(!1),this.itemsParam.setItems(A)}toJSON(A){const g=super.toJSON(A),I=this.itemsParam.value;if(I){const C=Array.from(I),i=[];C.forEach((g=>{const I=g.getPath();i.push(A?A.makeRelative(I):I)})),g.treeItems=i}return g}fromJSON(A,g){if(super.fromJSON(A,g),!A.treeItems)return void console.warn("Invalid Parameter JSON");if(!g)throw new Error("Unable to load JSON on a BaseGroup without a load context");let I=A.treeItems.length;const C=A=>{g.resolvePath(A,(A=>{this.addItem(A),I--,0==I&&this.loadDone()}),(()=>{console.warn("BaseGroup: '"+this.getName()+"'. Unable to load item:"+A)}))};for(const g of A.treeItems)C(g)}loadDone(){}}class zI extends xI{constructor(A){super(A),this.highlightedParam=new fA("Highlighted",!1),this.highlightColorParam=new xA("HighlightColor",new l(.5,.5,1)),this.highlightFillParam=new JA("HighlightFill",0,[0,1]),this.addParameter(this.highlightedParam),this.highlightedParam.on("valueChanged",(()=>{this.updateHighlight()})),this.addParameter(this.highlightColorParam),this.highlightColorParam.on("valueChanged",(()=>{this.updateHighlight()})),this.addParameter(this.highlightFillParam),this.highlightFillParam.on("valueChanged",(()=>{this.updateHighlight()}))}updateVisibility(){if(super.updateVisibility()){const A=this.isVisible();return Array.from(this.itemsParam.value).forEach((g=>{g instanceof ag&&g.propagateVisibility(A?1:-1)})),!0}return!1}updateHighlight(){this.__updateHighlightHelper()}__updateHighlightHelper(){let A,g=!1;(this.highlightedParam.value||this.isSelected())&&(g=!0,A=this.highlightColorParam.value,A.a=this.highlightFillParam.value);const I="groupItemHighlight"+this.getId();Array.from(this.itemsParam.value).forEach((C=>{C instanceof ag&&(g?C.addHighlight(I,A,!0):C.removeHighlight(I,!0))}))}setSelected(A){super.setSelected(A),this.updateHighlight()}bindItem(A,g){super.bindItem(A,g);const I=this.__itemsEventHandlers[g];if(A instanceof ag){if(A instanceof ag&&this.highlightedParam.value){const g=this.highlightColorParam.value;g.a=this.highlightFillParam.value,A.addHighlight("groupItemHighlight"+this.getId(),g,!0)}this.isVisible()||A.propagateVisibility(-1),I["BoundingBox.valueChanged"]=A.boundingBoxParam.on("valueChanged",(A=>{this.setBoundingBoxDirty()}))}}unbindItem(A,g){super.unbindItem(A,g),A instanceof ag&&(this.highlightedParam.value&&A.removeHighlight("groupItemHighlight"+this.getId(),!0),this.isVisible()||A.propagateVisibility(1),A.traverse((A=>{A instanceof LI&&A.setCutawayEnabled(!1)}),!0))}clone(A){const g=new zI(this.__name+" clone");return g.copyFrom(this,A),g}}e.register("SelectionSet",zI);var TI=ZA("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qKgogICAgICogU3RyaW5nIGZ1bmN0aW9ucwogICAgICoKICAgICAqLwogICAgY2xhc3MgU3RyaW5nRnVuY3Rpb25zIHsKICAgICAgICAvKioKICAgICAgICAgKiBSZXBsYWNlcyBhbGwgbWF0Y2hlcyBpbiBhIHN0cmluZy4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gc3RyIC0KICAgICAgICAgKiBAcGFyYW0gcGF0dGVybiAtCiAgICAgICAgICogQHBhcmFtIHJlcGxhY2VtZW50IC0KICAgICAgICAgKiBAcmV0dXJuIC0KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgcmVwbGFjZUFsbChzdHIsIHBhdHRlcm4sIHJlcGxhY2VtZW50KSB7CiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKHBhdHRlcm4sICdnJyksIHJlcGxhY2VtZW50KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBKU09OIG9iamVjdCBhcyBhIGZvcm1hdHRlZCBzdHJpbmcsIGJ1dCB0aGUgbnVtZXJpYyB2YWx1ZXMgYXJlIGZpeGVkIHRvIHRoZSBzcGVjaWZpZWQgcHJlY2lzaW9uLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSB2YWwgLQogICAgICAgICAqIEBwYXJhbSBzcGFjZSAtCiAgICAgICAgICogQHBhcmFtIHByZWNpc2lvbiAtCiAgICAgICAgICogQHJldHVybiAtCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIHN0cmluZ2lmeUpTT05XaXRoRml4ZWRQcmVjaXNpb24odmFsLCBzcGFjZSA9IDAsIHByZWNpc2lvbiA9IDUpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbCwgKF8sIHZhbCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbCA/ICh2YWwudG9GaXhlZCA/IE51bWJlcih2YWwudG9GaXhlZChwcmVjaXNpb24pKSA6IHZhbCkgOiB2YWw7CiAgICAgICAgICAgIH0sIHNwYWNlKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gc3RyaW5nIGludG8gYSBudW1lcmljIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSBzdHIgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBoYXNoU3RyKHN0cikgewogICAgICAgICAgICBsZXQgaGFzaCA9IDA7CiAgICAgICAgICAgIGxldCBpOwogICAgICAgICAgICBsZXQgY2hyOwogICAgICAgICAgICBsZXQgbGVuOwogICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBoYXNoOwogICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzdHIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGNociA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgICAgICAgaGFzaCA9IChoYXNoIDw8IDUpIC0gaGFzaCArIGNocjsKICAgICAgICAgICAgICAgIGhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGhhc2gpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudGluZyBhIFZlYzIodHdvLWRpbWVuc2lvbmFsIGZsb2F0aW5nIHBvaW50IHZlY3RvcikuIEEgVmVjMiBpcyBmb3IgcmVwcmVzZW50aW5nIDIgZGltZW5zaW9uYWwgdmFsdWVzLCBzdWNoIGFzIHNjcmVlbiBjb29yZGluYXRlcyBvciBwaXhlbCBjb29yZGluYXRlcyB3aXRoaW4gYW4gaW1hZ2UuCiAgICAgKgogICAgICogTWF0aCB0eXBlcyBpbnRlcm5hbGx5IHN0b3JlIHZhbHVlcyBpbiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRmxvYXQzMkFycmF5fEZsb2F0MzJBcnJheX0gYW5kCiAgICAgKiBleHBvc2UgZ2V0dGVycyBhbmQgc2V0dGVycyBmb3IgdGhlIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAgKgogICAgICovCiAgICBjbGFzcyBWZWMyIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIFRoZSB0eXBlIG9mIHZhbHVlcyBvZiB0aGUgYCh4LCB5KWAgY29vcmRpbmF0ZXMgY2FuIGJlIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GbG9hdDMyQXJyYXl8RmxvYXQzMkFycmF5fSwKICAgICAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvVWludDMyQXJyYXl8VWludDMyQXJyYXl9LAogICAgICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9JbnQzMkFycmF5fEludDMyQXJyYXl9IGFuZAogICAgICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lcy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jaWEvT2JqZXRvc19nbG9iYWxlcy9BcnJheUJ1ZmZlcnxBcnJheUJ1ZmZlcn0uCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIGBgYGphdmFzY3JpcHQKICAgICAgICAgKiAgY29uc3QgbXlWZWMyID0gbmV3IFZlYzIoMS4yLCAzLjQpCiAgICAgICAgICogYGBgCiAgICAgICAgICoKICAgICAgICAgKiBHaXZlbiBhbiBhcnJheSBvZiBmbG9hdHMsIGNyZWF0ZSBhIFZlYzIgdGhhdCB3cmFwcyBzb21lIHBhcnQgb2YgaXQuCiAgICAgICAgICogYGBgamF2YXNjcmlwdAogICAgICAgICAqICBjb25zdCBmbG9hdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSg2KQogICAgICAgICAqICBmbG9hdEFycmF5WzBdID0gMS4yCiAgICAgICAgICogIGZsb2F0QXJyYXlbMV0gPSAzLjQKICAgICAgICAgKiAgY29uc3QgbXlWZWMyID0gbmV3IFZlYzIoZmxvYXRBcnJheSkKICAgICAgICAgKiAgY29uc29sZS5sb2cobXlWZWMyLnRvSlNPTigpKQogICAgICAgICAqIGBgYAogICAgICAgICAqIFRoZSByZXN1bHRpbmcgb3V0cHV0CiAgICAgICAgICogYGBganNvbgogICAgICAgICAqICA+IHsgeDoxLjIsIHk6My40IH0KICAgICAgICAgKiBgYGAKICAgICAgICAgKgogICAgICAgICAqIEdpdmVuIGFuIGFycmF5IG9mIGZsb2F0cywgY3JlYXRlIGEgVmVjMiB0aGF0IHdyYXBzIHNvbWUgcGFydCBvZiBpdC4KICAgICAgICAgKiBgYGBqYXZhc2NyaXB0CiAgICAgICAgICogIGNvbnN0IGZsb2F0QXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDYpCiAgICAgICAgICogIGZsb2F0QXJyYXlbMF0gPSAxLjIKICAgICAgICAgKiAgZmxvYXRBcnJheVsxXSA9IDMuNAogICAgICAgICAqICBmbG9hdEFycmF5WzJdID0gNS42CiAgICAgICAgICogIGZsb2F0QXJyYXlbM10gPSA3LjgKICAgICAgICAgKiAgZmxvYXRBcnJheVs0XSA9IDkuMAogICAgICAgICAqICBmbG9hdEFycmF5WzVdID0gMS45CiAgICAgICAgICogIGNvbnN0IG15VmVjMiA9IG5ldyBWZWMyKGZsb2F0QXJyYXkuYnVmZmVyLCA4KQogICAgICAgICAqICBjb25zb2xlLmxvZyhteVZlYzIudG9KU09OKCkpCiAgICAgICAgICogYGBgCiAgICAgICAgICogVGhlIHJlc3VsdGluZyBvdXRwdXQKICAgICAgICAgKiBgYGBqc29uCiAgICAgICAgICogID4geyB4OjUuNiwgeTo3LjggfQogICAgICAgICAqIGBgYAogICAgICAgICAqCiAgICAgICAgICogWW91IGNhbiBhbHNvIHBhc3Mgb25lIEpTT04gb2JqZWN0IHBhcmFtZXRlci4KICAgICAgICAgKiBgYGBqYXZhc2NyaXB0CiAgICAgICAgICogIGNvbnN0IG15VmVjMiA9IG5ldyBWZWMyKHsgeDoxLjIsIHk6My40IH0pCiAgICAgICAgICogYGBgCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0geCAtIFRoZSB4IHZhbHVlLiBEZWZhdWx0IGlzIDAuCiAgICAgICAgICogQHBhcmFtIHkgLSBUaGUgeSB2YWx1ZS4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCkgewogICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSB8fCB4IGluc3RhbmNlb2YgVWludDMyQXJyYXkgfHwgeCBpbnN0YW5jZW9mIEludDMyQXJyYXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0geDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgeCA9PSAnbnVtYmVyJyAmJiB0eXBlb2YgeSA9PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDIpOwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSB4OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB4ID09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMik7CiAgICAgICAgICAgICAgICB0aGlzLmZyb21KU09OKHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHhgIGNvbXBvbmVudC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgeCBjb21wb25lbnQuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVswXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciBgeGAgY29tcG9uZW50LgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCB4KHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciBgeWAgY29tcG9uZW50LgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB5IGNvbXBvbmVudC4KICAgICAgICAgKi8KICAgICAgICBnZXQgeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzFdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB5YCBjb21wb25lbnQuCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHkodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZnJvbSBzY2FsYXIgY29tcG9uZW50cy4KICAgICAgICAgKiBAcGFyYW0geCAtIFRoZSB4IGNvbXBvbmVudC4KICAgICAgICAgKiBAcGFyYW0geSAgLSBUaGUgeSBjb21wb25lbnQuCiAgICAgICAgICovCiAgICAgICAgc2V0KHgsIHkpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSB4OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJlcGxhY2VzIHRoaXMgVmVjMiBkYXRhIHdpdGggdGhlIFZlYzIgZGF0YSBwYXNzZWQgYXMgcGFyYW1ldGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gc2V0IGZyb20uCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbU90aGVyKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCA9IG90aGVyLng7CiAgICAgICAgICAgIHRoaXMueSA9IG90aGVyLnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGlzIFZlYzIgY29udGFpbnMgdGhlIHNhbWUgdmFsdWVzIGFzIHRoZSBvdGhlciBWZWMyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGB0cnVlYCBpZiBhcmUgdGhlIHNhbWUgVmVjdG9yLCBvdGhlcndpc2UsIGBmYWxzZWAuCiAgICAgICAgICovCiAgICAgICAgaXNFcXVhbChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy54ID09IG90aGVyLnggJiYgdGhpcy55ID09IG90aGVyLnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGlzIFZlYzIgaXMgZGlmZmVyZW50IGZyb20gYW5vdGhlciBWZWMyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgVmVjMnMgYXJlIGRpZmZlcmVudCwgb3RoZXJ3aXNlLCBgZmFsc2VgLgogICAgICAgICAqLwogICAgICAgIG5vdEVxdWFsKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggIT0gb3RoZXIueCAmJiB0aGlzLnkgIT0gb3RoZXIueTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgVmVjMiBpcyBhcHByb3hpbWF0ZWx5IHRoZSBzYW1lIGFzIG90aGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEBwYXJhbSBwcmVjaXNpb24gLSBUaGUgcHJlY2lzaW9uIHRvIHdoaWNoIHRoZSB2YWx1ZXMgbXVzdCBtYXRjaC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0cnVlIG9yIGZhbHNlLgogICAgICAgICAqLwogICAgICAgIGFwcHJveEVxdWFsKG90aGVyLCBwcmVjaXNpb24gPSBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnModGhpcy54IC0gb3RoZXIueCkgPCBwcmVjaXNpb24gJiYgTWF0aC5hYnModGhpcy55IC0gb3RoZXIueSkgPCBwcmVjaXNpb247CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgb3RoZXIgdG8gdGhpcyBWZWMyIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMyIHRvIGFkZC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMyLgogICAgICAgICAqLwogICAgICAgIGFkZChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIodGhpcy54ICsgb3RoZXIueCwgdGhpcy55ICsgb3RoZXIueSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYSBWZWMyIHRvIHRoaXMgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMyIHRvIGFkZC4KICAgICAgICAgKi8KICAgICAgICBhZGRJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCArPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgKz0gb3RoZXIueTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU3VidHJhY3RzIGEgVmVjMiBmcm9tIHRoaXMgVmVjMiBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMiB0byBzdWJ0cmFjdC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMyLgogICAgICAgICAqLwogICAgICAgIHN1YnRyYWN0KG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih0aGlzLnggLSBvdGhlci54LCB0aGlzLnkgLSBvdGhlci55KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU3VidHJhY3RzIGEgVmVjMiBmcm9tIHRoaXMgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMyIHRvIHN1YnRyYWN0LgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzIuCiAgICAgICAgICovCiAgICAgICAgc3VidHJhY3RJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCAtPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgLT0gb3RoZXIueTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNjYWxlcyB0aGlzIFZlYzIgYnkgc2NhbGFyIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzY2FsYXIgLSBUaGUgc2NhbGFyIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzIuCiAgICAgICAgICovCiAgICAgICAgc2NhbGUoc2NhbGFyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhcik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNjYWxlcyB0aGlzIFZlYzIgYnkgc2NhbGFyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2NhbGVJblBsYWNlKHNjYWxhcikgewogICAgICAgICAgICB0aGlzLnggKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLnkgKj0gc2NhbGFyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBJbnZlcnRzIHRoaXMgVmVjMiBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMyLgogICAgICAgICAqLwogICAgICAgIGludmVydCgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMyKDEuMCAvIHRoaXMueCwgMS4wIC8gdGhpcy55KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogSW52ZXJ0cyB0aGlzIFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBpbnZlcnRJblBsYWNlKCkgewogICAgICAgICAgICB0aGlzLnggPSAxLjAgLyB0aGlzLng7CiAgICAgICAgICAgIHRoaXMueSA9IDEuMCAvIHRoaXMueTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE11bHRpcGxpZXMgYSBWZWMyIHdpdGggdGhpcyBWZWMyIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMyIHRvIG11bHRpcGx5IHdpdGguCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgVmVjMi4KICAgICAgICAgKi8KICAgICAgICBtdWx0aXBseShvdGhlcikgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIodGhpcy54ICogb3RoZXIueCwgdGhpcy55ICogb3RoZXIueSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE11bHRpcGxpZXMgYSBWZWMyIHdpdGggdGhpcyBWZWMyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gbXVsdGlwbHkgd2l0aC4KICAgICAgICAgKi8KICAgICAgICBtdWx0aXBseUluUGxhY2Uob3RoZXIpIHsKICAgICAgICAgICAgdGhpcy54ICo9IG90aGVyLng7CiAgICAgICAgICAgIHRoaXMueSAqPSBvdGhlci55OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGlzIFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbGVuZ3RoIHNxdWFyZWQuCiAgICAgICAgICovCiAgICAgICAgbGVuZ3RoU3F1YXJlZCgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIHJldHVybiB4ICogeCArIHkgKiB5OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBsZW5ndGggb2YgdGhpcyBWZWMyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGxlbmd0aC4KICAgICAgICAgKi8KICAgICAgICBsZW5ndGgoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy5sZW5ndGhTcXVhcmVkKCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBkaXN0YW5jZSB0byBhbm90aGVyIHZlY3Rvci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgZGlzdGFuY2UgYmV0d2VlbiB2ZWN0b3JzLgogICAgICAgICAqLwogICAgICAgIGRpc3RhbmNlVG8ob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdIC0gb3RoZXIueDsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuX19kYXRhWzFdIC0gb3RoZXIueTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCh4ICogeCArIHkgKiB5KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTm9ybWFsaXplcyB0aGUgVmVjMiBhbmQgcmV0dXJucyBpdCBhcyBhIG5ldyBWZWMyLgogICAgICAgICAqIE11bHRpcGxpZXMgY29vcmRpbmF0ZXMgdmFsdWUgYnkgdGhlIGludmVyc2Ugb2YgdGhlIHZlY3RvciBsZW5ndGguCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgVmVjMiBub3JtYWxpemVkLgogICAgICAgICAqLwogICAgICAgIG5vcm1hbGl6ZSgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGxldCBsZW4gPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgICBpZiAobGVuIDwgTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFRPRE86IGV2YWx1YXRlIHVzZSBvZiBnbG1faW52c3FydCBoZXJlPwogICAgICAgICAgICBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih4ICogbGVuLCB5ICogbGVuKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTm9ybWFsaXplcyB0aGlzIFZlYzIgbXVsdGlwbHlpbmcgY29vcmRpbmF0ZSB2YWx1ZXMgYnkgdGhlIGludmVyc2Ugb2YgdGhlIHZlY3RvciBsZW5ndGguCiAgICAgICAgICovCiAgICAgICAgbm9ybWFsaXplSW5QbGFjZSgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGxldCBsZW4gPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgICBpZiAobGVuIDwgTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgICAgIHRoaXMuc2V0KHggKiBsZW4sIHkgKiBsZW4pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGlzIFZlYzIgYWdhaW5zdCBhbm90aGVyIFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMiB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGRvdCBwcm9kdWN0LgogICAgICAgICAqLwogICAgICAgIGRvdChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy54ICogb3RoZXIueCArIHRoaXMueSAqIG90aGVyLnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhpcyBWZWMyIGFnYWluc3QgYW5vdGhlciBWZWMyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBjcm9zcyBwcm9kdWN0LgogICAgICAgICAqLwogICAgICAgIGNyb3NzKG90aGVyKSB7CiAgICAgICAgICAgIC8vIGp1c3QgY2FsY3VsYXRlIHRoZSB6LWNvbXBvbmVudAogICAgICAgICAgICByZXR1cm4gdGhpcy54ICogb3RoZXIueSAtIHRoaXMueSAqIG90aGVyLng7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIGFuZ2xlIGJldHdlZW4gdGhpcyBWZWMyIGFuZCBvdGhlciBhc3N1bWluZyBib3RoIGFyZSBub3JtYWxpemVkIHZlY3RvcnMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMiB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgICAgICovCiAgICAgICAgYW5nbGVUbyhvdGhlcikgewogICAgICAgICAgICBjb25zdCBjb3NpbmUgPSB0aGlzLm5vcm1hbGl6ZSgpLmRvdChvdGhlci5ub3JtYWxpemUoKSk7CiAgICAgICAgICAgIGlmIChjb3NpbmUgPiAxLjApCiAgICAgICAgICAgICAgICByZXR1cm4gMC4wOwogICAgICAgICAgICBlbHNlIGlmIChjb3NpbmUgPCAtMS4wKQogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguUEk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFjb3MoY29zaW5lKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0cyB0aGUgYW5nbGUgYmV0d2VlbiB0aGlzIFZlYzIgYW5kIG90aGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzIgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgICAgICAqLwogICAgICAgIHNpZ25lZEFuZ2xlVG8ob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLmFuZ2xlVG8ob3RoZXIpOwogICAgICAgICAgICBpZiAodGhpcy5jcm9zcyhvdGhlcikgPCAwLjApCiAgICAgICAgICAgICAgICByZXR1cm4gLWFuZ2xlOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gYW5nbGU7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJvdGF0ZXMgYSBWZWMyIGluIGEgY2xvY2t3aXNlIGRpcmVjdGlvbiBhbmQgcmV0dXJucyBhIG5ldyByb3RhdGVkIFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gYW5nbGUgLSBUaGUgYW5nbGUgb2Ygcm90YXRpb24uCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHJvdGF0ZWQgdmVjdG9yLgogICAgICAgICAqLwogICAgICAgIHJvdGF0ZShhbmdsZSkgewogICAgICAgICAgICBjb25zdCBjb3NBID0gTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgICBjb25zdCBzaW5BID0gTWF0aC5zaW4oYW5nbGUpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIodGhpcy54ICogY29zQSAtIHRoaXMueSAqIHNpbkEsIHRoaXMueCAqIHNpbkEgKyB0aGlzLnkgKiBjb3NBKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUGVyZm9ybXMgYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHRoaXMgVmVjMiBhbmQgb3RoZXIgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMyIHRvIGludGVycG9sYXRlIGJldHdlZW4uCiAgICAgICAgICogQHBhcmFtIHQgLSBJbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzIuCiAgICAgICAgICovCiAgICAgICAgbGVycChvdGhlciwgdCkgewogICAgICAgICAgICBjb25zdCBheCA9IHRoaXMueDsKICAgICAgICAgICAgY29uc3QgYXkgPSB0aGlzLnk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMihheCArIHQgKiAob3RoZXIueCAtIGF4KSwgYXkgKyB0ICogKG90aGVyLnkgLSBheSkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZW5lcmF0ZXMgYSByYW5kb20gdmVjdG9yIHdpdGggdGhlIGdpdmVuIHNjYWxlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxlIC0gTGVuZ3RoIG9mIHRoZSByZXN1bHRpbmcgdmVjdG9yLiBJZiBvbWl0dGVkLCBhIHVuaXQgdmVjdG9yIHdpbGwgYmUgcmV0dXJuZWQuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0UmFuZG9tRGlyKHNjYWxlID0gMS4wKSB7CiAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnJhbmRvbSgpICogMi4wICogTWF0aC5QSTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSBNYXRoLmNvcyhyKSAqIHNjYWxlOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IE1hdGguc2luKHIpICogc2NhbGU7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSYW5kb21pemVzIHRoZSBzY2FsZSBvZiB0aGlzIFZlYzIgY29vcmRpbmF0ZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2NhbGUgLSBUaGUgc2NhbGUgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0UmFuZG9tKHNjYWxlID0gMS4wKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gTWF0aC5yYW5kb20oKSAqIHNjYWxlOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IE1hdGgucmFuZG9tKCkgKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENsb25lcyB0aGlzIFZlYzIgYW5kIHJldHVybnMgYSBuZXcgVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzIuCiAgICAgICAgICovCiAgICAgICAgY2xvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih0aGlzLl9fZGF0YVswXSwgdGhpcy5fX2RhdGFbMV0pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGN1cnJlbnQgVmVjMiBkYXRhIGFzIGFycmF5LiBPZnRlbiB1c2VkIHRvIHBhc3MgdHlwZXMgdG8gdGhlIEdQVS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGFzIGFuIGFycmF5LgogICAgICAgICAqLwogICAgICAgIGFzQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGVyc2lzdGVuY2UKICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFZlYzMgdG8gYSBzdHJpbmcgaW4gSlNPTiBmb3JtYXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5ldy1jYXAKICAgICAgICAgICAgcmV0dXJuIFN0cmluZ0Z1bmN0aW9ucy5zdHJpbmdpZnlKU09OV2l0aEZpeGVkUHJlY2lzaW9uKHRoaXMudG9KU09OKCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBFbmNvZGVzIFZlYzIgQ2xhc3MgYXMgYSBKU09OIG9iamVjdCBmb3IgcGVyc2lzdGVuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHg6IHRoaXMueCwKICAgICAgICAgICAgICAgIHk6IHRoaXMueSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlcyBhIEpTT04gb2JqZWN0IHRvIHNldCB0aGUgc3RhdGUgb2YgdGhpcyBjbGFzcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGopIHsKICAgICAgICAgICAgdGhpcy54ID0gai54OwogICAgICAgICAgICB0aGlzLnkgPSBqLnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIExvYWRzIHRoZSBzdGF0ZSBvZiB0aGUgdmFsdWUgZnJvbSBhIGJpbmFyeSByZWFkZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmVhZGVyIC0gVGhlIHJlYWRlciB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlcikgewogICAgICAgICAgICB0aGlzLnggPSByZWFkZXIubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgdGhpcy55ID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZSB0aGUgaW50ZXJzZWN0aW9uIHBvaW50IG9mIDIgMmQgbGluZXMsIHJldHVybmluZyB0aGUgcGFyYW1ldGVycyB2YWx1ZXMgZm9yIGVhY2ggbGluZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBwMCAtIFRoZSBwb2ludCBvZiB0aGUgZmlyc3QgbGluZQogICAgICAgICAqIEBwYXJhbSBkMCAtIFRoZSBkaXJlY3Rpb24gb2YgdGhlIGZpcnN0IGxpbmUKICAgICAgICAgKiBAcGFyYW0gcDEgLSBUaGUgcG9pbnQgb2YgdGhlIHNlY29uZCBsaW5lCiAgICAgICAgICogQHBhcmFtIGQxIC0gVGhlIGRpcmVjdGlvbiBvZiB0aGUgc2Vjb25kIGxpbmUKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIDIgcGFyYW1ldGVyIHZhbHVlcyBmb3IgdGhlIDIgbGluZXMuCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIGludGVyc2VjdGlvbk9mTGluZXMocDEsIHAyLCBwMywgcDQpIHsKICAgICAgICAgICAgLy8gaHR0cHM6Ly9kaXJhc2suY29tL3Bvc3RzL0phdmFTY3JpcHQtaG93LXRvLWNhbGN1bGF0ZS1pbnRlcnNlY3Rpb24tcG9pbnQtb2YtdHdvLWxpbmVzLWZvci1naXZlbi00LXBvaW50cy1WanZuQWoKICAgICAgICAgICAgLy8gZG93biBwYXJ0IG9mIGludGVyc2VjdGlvbiBwb2ludCBmb3JtdWxhCiAgICAgICAgICAgIGNvbnN0IGQxID0gKHAxLnggLSBwMi54KSAqIChwMy55IC0gcDQueSk7IC8vICh4MSAtIHgyKSAqICh5MyAtIHk0KQogICAgICAgICAgICBjb25zdCBkMiA9IChwMS55IC0gcDIueSkgKiAocDMueCAtIHA0LngpOyAvLyAoeTEgLSB5MikgKiAoeDMgLSB4NCkKICAgICAgICAgICAgY29uc3QgZCA9IGQxIC0gZDI7CiAgICAgICAgICAgIGlmIChkID09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHVwcGVyIHBhcnQgb2YgaW50ZXJzZWN0aW9uIHBvaW50IGZvcm11bGEKICAgICAgICAgICAgY29uc3QgdTEgPSBwMS54ICogcDIueSAtIHAxLnkgKiBwMi54OyAvLyAoeDEgKiB5MiAtIHkxICogeDIpCiAgICAgICAgICAgIGNvbnN0IHU0ID0gcDMueCAqIHA0LnkgLSBwMy55ICogcDQueDsgLy8gKHgzICogeTQgLSB5MyAqIHg0KQogICAgICAgICAgICBjb25zdCB1MnggPSBwMy54IC0gcDQueDsgLy8gKHgzIC0geDQpCiAgICAgICAgICAgIGNvbnN0IHUzeCA9IHAxLnggLSBwMi54OyAvLyAoeDEgLSB4MikKICAgICAgICAgICAgY29uc3QgdTJ5ID0gcDMueSAtIHA0Lnk7IC8vICh5MyAtIHk0KQogICAgICAgICAgICBjb25zdCB1M3kgPSBwMS55IC0gcDIueTsgLy8gKHkxIC0geTIpCiAgICAgICAgICAgIC8vIGludGVyc2VjdGlvbiBwb2ludCBmb3JtdWxhCiAgICAgICAgICAgIGNvbnN0IHB4ID0gKHUxICogdTJ4IC0gdTN4ICogdTQpIC8gZDsKICAgICAgICAgICAgY29uc3QgcHkgPSAodTEgKiB1MnkgLSB1M3kgKiB1NCkgLyBkOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIocHgsIHB5KTsKICAgICAgICB9CiAgICAgICAgaXNWYWxpZCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHRoaXMuX19kYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAodiA9PSBJbmZpbml0eSB8fCBpc05hTih2KSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIHRocmVlIGRpbWVuc2lvbmFsIGNvb3JkaW5hdGUsIHN1Y2ggYXMgM0Qgc2NlbmUgdmFsdWVzLCBvciBtZXNoIHZlcnRleCBwb3NpdGlvbnMuCiAgICAgKgogICAgICogTWF0aCB0eXBlcyBpbnRlcm5hbGx5IHN0b3JlIHZhbHVlcyBpbiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRmxvYXQzMkFycmF5fEZsb2F0MzJBcnJheX0gYW5kCiAgICAgKiBleHBvc2UgZ2V0dGVycyBhbmQgc2V0dGVycyBmb3IgdGhlIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAgKi8KICAgIGNsYXNzIFZlYzMgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogVGhlIHR5cGUgb2YgdmFsdWVzIG9mIHRoZSBgKHgsIHksIHopYCBjb29yZGluYXRlcyBjYW4gYmUge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Zsb2F0MzJBcnJheXxGbG9hdDMyQXJyYXl9LAogICAgICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9VaW50MzJBcnJheXxVaW50MzJBcnJheX0sCiAgICAgICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0ludDMyQXJyYXl8SW50MzJBcnJheX0gYW5kCiAgICAgICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VzL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNpYS9PYmpldG9zX2dsb2JhbGVzL0FycmF5QnVmZmVyfEFycmF5QnVmZmVyfS4KICAgICAgICAgKgogICAgICAgICAqIFlvdSBjYW4gYWxzbyBwYXNzIG9uZSBKU09OIG9iamVjdCBwYXJhbWV0ZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0geCAtIFRoZSB4IHZhbHVlLiBEZWZhdWx0IGlzIDAuCiAgICAgICAgICogQHBhcmFtIHkgLSBUaGUgeSB2YWx1ZS4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSB6IC0gVGhlIHogdmFsdWUuIERlZmF1bHQgaXMgMC4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3Rvcih4ID0gMCwgeSA9IDAsIHogPSAwKSB7CiAgICAgICAgICAgIGlmICh4IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8IHggaW5zdGFuY2VvZiBVaW50MzJBcnJheSkgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHggaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIG5ldyBWZWMzKG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCAzKSlgKTsKICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IHg7CiAgICAgICAgICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0geTsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheShidWZmZXIsIGJ5dGVPZmZzZXQsIDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB4ID09ICdudW1iZXInICYmIHR5cGVvZiB5ID09ICdudW1iZXInICYmIHR5cGVvZiB6ID09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHo7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoeCAhPSBudWxsICYmIHR5cGVvZiB4ID09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgICAgICAgICAgICAgICB0aGlzLmZyb21KU09OKHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHhgIGNvbXBvbmVudC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB4IGNvbXBvbmVudC4KICAgICAgICAgKi8KICAgICAgICBnZXQgeCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzBdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB4YCBjb21wb25lbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgeCh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHlgIGNvbXBvbmVudC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB5IGNvbXBvbmVudC4KICAgICAgICAgKi8KICAgICAgICBnZXQgeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzFdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB5YCBjb21wb25lbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgeSh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHpgIGNvbXBvbmVudC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB6IGNvbXBvbmVudC4KICAgICAgICAgKi8KICAgICAgICBnZXQgeigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzJdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB6YCBjb21wb25lbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgeih2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHh5YCBzd2l6emVsLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHh5IGNvbXBvbmVudHMgYXMgYSBWZWMyLgogICAgICAgICAqLwogICAgICAgIGdldCB4eSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMyKHRoaXMuX19kYXRhWzBdLCB0aGlzLl9fZGF0YVsxXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgYHl6YCBzd2l6emVsLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHl6IGNvbXBvbmVudHMgYXMgYSBWZWMyLgogICAgICAgICAqLwogICAgICAgIGdldCB5eigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMyKHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmcm9tIHNjYWxhciBjb21wb25lbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHggLSBUaGUgeCBjb21wb25lbnQuCiAgICAgICAgICogQHBhcmFtIHkgLSBUaGUgeSBjb21wb25lbnQuCiAgICAgICAgICogQHBhcmFtIHogLSBUaGUgeSBjb21wb25lbnQuCiAgICAgICAgICovCiAgICAgICAgc2V0KHgsIHksIHopIHsKICAgICAgICAgICAgdGhpcy54ID0geDsKICAgICAgICAgICAgdGhpcy55ID0geSAhPT0gdW5kZWZpbmVkID8geSA6IHg7CiAgICAgICAgICAgIHRoaXMueiA9IHogIT09IHVuZGVmaW5lZCA/IHogOiB4OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBzdGF0ZSBvZiBhIFZlYzMgT2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGZsb2F0MzJBcnJheSAtIFRoZSBmbG9hdDMyQXJyYXkgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0RGF0YUFycmF5KGZsb2F0MzJBcnJheSkgewogICAgICAgICAgICB0aGlzLl9fZGF0YSA9IGZsb2F0MzJBcnJheTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgc3RhdGUgb2YgYSBWZWMzIE9iamVjdCBmcm9tIGFub3RoZXIgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIHNldCBmcm9tLgogICAgICAgICAqLwogICAgICAgIHNldEZyb21PdGhlcihvdGhlcikgewogICAgICAgICAgICB0aGlzLnggPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgPSBvdGhlci55OwogICAgICAgICAgICB0aGlzLnogPSBvdGhlci56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDaGVja3MgaWYgdGhlIGNvb3JkaW5hdGVzIG9mIHRoaXMgVmVjMyBhcmUgMCAwIDAuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGNvb3JkaW5hdGVzIGFyZSgwLCAwLCAwKSwgb3RoZXJ3aXNlLCBgZmFsc2VgLgogICAgICAgICAqLwogICAgICAgIGlzTnVsbCgpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKHRoaXMueCkgPCBOdW1iZXIuRVBTSUxPTiAmJiBNYXRoLmFicyh0aGlzLnkpIDwgTnVtYmVyLkVQU0lMT04gJiYgTWF0aC5hYnModGhpcy56KSA8IE51bWJlci5FUFNJTE9OOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDaGVja3MgaWYgdGhlIGNvb3JkaW5hdGVzIG9mIHRoaXMgVmVjMyBhcmUgMSAxIDEuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGNvb3JkaW5hdGVzIGFyZSgxLCAxLCAxKSwgb3RoZXJ3aXNlLCBgZmFsc2VgLgogICAgICAgICAqLwogICAgICAgIGlzMTExKCkgewogICAgICAgICAgICByZXR1cm4gKE1hdGguYWJzKDEuMCAtIHRoaXMueCkgPCBOdW1iZXIuRVBTSUxPTiAmJgogICAgICAgICAgICAgICAgTWF0aC5hYnMoMS4wIC0gdGhpcy55KSA8IE51bWJlci5FUFNJTE9OICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicygxLjAgLSB0aGlzLnopIDwgTnVtYmVyLkVQU0lMT04pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDaGVja3MgaWYgdGhpcyBWZWMzIGNvbnRhaW5zIHRoZSBzYW1lIHZhbHVlcyBhcyB0aGUgb3RoZXIgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgdGhlIHNhbWUsIG90aGVyd2lzZSwgYGZhbHNlYC4KICAgICAgICAgKi8KICAgICAgICBpc0VxdWFsKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggPT0gb3RoZXIueCAmJiB0aGlzLnkgPT0gb3RoZXIueSAmJiB0aGlzLnogPT0gb3RoZXIuejsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2tzIGlmIHRoaXMgVmVjMiBpcyBkaWZmZXJlbnQgZnJvbSBhbm90aGVyIFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYHRydWVgIGlmIHRoZSBWZWMzcyBhcmUgZGlmZmVyZW50LCBvdGhlcndpc2UsIGBmYWxzZWAuCiAgICAgICAgICovCiAgICAgICAgbm90RXF1YWwob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMueCAhPSBvdGhlci54ICYmIHRoaXMueSAhPSBvdGhlci55ICYmIHRoaXMueiAhPSBvdGhlci56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBWZWMyIGlzIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgYXMgb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHBhcmFtIHByZWNpc2lvbiAtIFRoZSBwcmVjaXNpb24gdG8gd2hpY2ggdGhlIHZhbHVlcyBtdXN0IG1hdGNoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgYXBwcm94RXF1YWwob3RoZXIsIHByZWNpc2lvbiA9IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgIHJldHVybiAoTWF0aC5hYnModGhpcy54IC0gb3RoZXIueCkgPCBwcmVjaXNpb24gJiYKICAgICAgICAgICAgICAgIE1hdGguYWJzKHRoaXMueSAtIG90aGVyLnkpIDwgcHJlY2lzaW9uICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicyh0aGlzLnogLSBvdGhlci56KSA8IHByZWNpc2lvbik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgb3RoZXIgdG8gdGhpcyBWZWMzIGFuZCByZXR1cm4gdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzMgdG8gYWRkLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgYWRkKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggKyBvdGhlci54LCB0aGlzLnkgKyBvdGhlci55LCB0aGlzLnogKyBvdGhlci56KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkcyBvdGhlciB0byB0aGlzIFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBhZGQuCiAgICAgICAgICovCiAgICAgICAgYWRkSW5QbGFjZShvdGhlcikgewogICAgICAgICAgICB0aGlzLnggKz0gb3RoZXIueDsKICAgICAgICAgICAgdGhpcy55ICs9IG90aGVyLnk7CiAgICAgICAgICAgIHRoaXMueiArPSBvdGhlci56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTdWJ0cmFjdHMgb3RoZXIgZnJvbSB0aGlzIFZlYzMgYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzMgdG8gc3VidHJhY3QuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgVmVjMy4KICAgICAgICAgKi8KICAgICAgICBzdWJ0cmFjdChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54IC0gb3RoZXIueCwgdGhpcy55IC0gb3RoZXIueSwgdGhpcy56IC0gb3RoZXIueik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFN1YnRyYWN0cyBvdGhlciBmcm9tIHRoaXMgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIHN1YnRyYWN0LgogICAgICAgICAqLwogICAgICAgIHN1YnRyYWN0SW5QbGFjZShvdGhlcikgewogICAgICAgICAgICB0aGlzLnggLT0gb3RoZXIueDsKICAgICAgICAgICAgdGhpcy55IC09IG90aGVyLnk7CiAgICAgICAgICAgIHRoaXMueiAtPSBvdGhlci56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBNdWx0aXBsaWVzIHR3byBWZWMzcyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBtdWx0aXBseSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHkob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHRoaXMueCAqIG90aGVyLngsIHRoaXMueSAqIG90aGVyLnksIHRoaXMueiAqIG90aGVyLnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBNdWx0aXBsaWVzIHR3byBWZWMzcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIG11bHRpcGx5IHdpdGguCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHlJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCAqPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgKj0gb3RoZXIueTsKICAgICAgICAgICAgdGhpcy56ICo9IG90aGVyLno7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIERpdmlkZXMgdHdvIFZlYzNzIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2ZWMzIC0gVGhlIG90aGVyIFZlYzMgdG8gZGl2aWRlIGJ5LgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZGl2aWRlKHZlYzMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHRoaXMueCAvIHZlYzMueCwgdGhpcy55IC8gdmVjMy55LCB0aGlzLnogLyB2ZWMzLnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEaXZpZGVzIHR3byBWZWMzcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2ZWMzIC0gVGhlIG90aGVyIFZlYzMgdG8gZGl2aWRlIGJ5LgogICAgICAgICAqLwogICAgICAgIGRpdmlkZUluUGxhY2UodmVjMykgewogICAgICAgICAgICB0aGlzLnggLz0gdmVjMy54OwogICAgICAgICAgICB0aGlzLnkgLz0gdmVjMy55OwogICAgICAgICAgICB0aGlzLnogLz0gdmVjMy56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTY2FsZXMgdGhpcyBWZWMzIGJ5IHNjYWxhciBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIHNjYWxlKHNjYWxhcikgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICogc2NhbGFyLCB0aGlzLnkgKiBzY2FsYXIsIHRoaXMueiAqIHNjYWxhcik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNjYWxlcyB0aGlzIFZlYzMgYnkgc2NhbGFyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2NhbGVJblBsYWNlKHNjYWxhcikgewogICAgICAgICAgICB0aGlzLnggKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLnkgKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLnogKj0gc2NhbGFyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBOZWdhdGVzIHRoaXMgVmVjMyAoeCA9IC14LCB5ID0gLXkgYW5kIHogPSAteiksIGJ1dCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgbmVnYXRlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMoLXRoaXMueCwgLXRoaXMueSwgLXRoaXMueik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGludmVyc2Ugb2YgdGhpcyBWZWMzLCBidXQgcmV0dXJucy4gdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWMzCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIGludmVyc2UoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMygxLjAgLyB0aGlzLngsIDEuMCAvIHRoaXMueSwgMS4wIC8gdGhpcy56KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsY3VsYXRlcyB0aGUgc3F1YXJlZCBsZW5ndGggb2YgdGhpcyBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGxlbmd0aC4KICAgICAgICAgKi8KICAgICAgICBsZW5ndGhTcXVhcmVkKCkgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl9fZGF0YVsxXTsKICAgICAgICAgICAgY29uc3QgeiA9IHRoaXMuX19kYXRhWzJdOwogICAgICAgICAgICByZXR1cm4geCAqIHggKyB5ICogeSArIHogKiB6OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBsZW5ndGggb2YgdGhpcyBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGxlbmd0aC4KICAgICAgICAgKi8KICAgICAgICBsZW5ndGgoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy5sZW5ndGhTcXVhcmVkKCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBkaXN0YW5jZSB0byBhbm90aGVyIFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIHRvLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHZlY3RvcnMuCiAgICAgICAgICovCiAgICAgICAgZGlzdGFuY2VUbyhvdGhlcikgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fX2RhdGFbMF0gLSBvdGhlci54OwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV0gLSBvdGhlci55OwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fX2RhdGFbMl0gLSBvdGhlci56OwogICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE5vcm1hbGl6ZXMgdGhlIFZlYzMgYW5kIHJldHVybnMgaXQgYXMgYSBuZXcgVmVjMy4KICAgICAgICAgKiBNdWx0aXBsaWVzIGNvb3JkaW5hdGVzIHZhbHVlIGJ5IHRoZSBpbnZlcnNlIG9mIHRoZSB2ZWN0b3IgbGVuZ3RoLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIFZlYzMgbm9ybWFsaXplZC4KICAgICAgICAgKi8KICAgICAgICBub3JtYWxpemUoKSB7CiAgICAgICAgICAgIGxldCBsZW4gPSB0aGlzLl9fZGF0YVswXSAqIHRoaXMuX19kYXRhWzBdICsgdGhpcy5fX2RhdGFbMV0gKiB0aGlzLl9fZGF0YVsxXSArIHRoaXMuX19kYXRhWzJdICogdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGlmIChsZW4gPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gVE9ETzogZXZhbHVhdGUgdXNlIG9mIGdsbV9pbnZzcXJ0IGhlcmU/CiAgICAgICAgICAgIGxlbiA9IDEuMCAvIE1hdGguc3FydChsZW4pOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy5fX2RhdGFbMF0gKiBsZW4sIHRoaXMuX19kYXRhWzFdICogbGVuLCB0aGlzLl9fZGF0YVsyXSAqIGxlbik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE5vcm1hbGl6ZXMgdGhpcyBWZWMzIG11bHRpcGx5aW5nIGNvb3JkaW5hdGUgdmFsdWVzIGJ5IHRoZSBpbnZlcnNlIG9mIHRoZSB2ZWN0b3IgbGVuZ3RoLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbm9ybWFsaXplSW5QbGFjZSgpIHsKICAgICAgICAgICAgbGV0IGxlbiA9IHRoaXMuX19kYXRhWzBdICogdGhpcy5fX2RhdGFbMF0gKyB0aGlzLl9fZGF0YVsxXSAqIHRoaXMuX19kYXRhWzFdICsgdGhpcy5fX2RhdGFbMl0gKiB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgaWYgKGxlbiA8IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVuID0gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgICAgIGNvbnN0IHRtcCA9IDEuMCAvIGxlbjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gKj0gdG1wOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSAqPSB0bXA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdICo9IHRtcDsKICAgICAgICAgICAgcmV0dXJuIGxlbjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIG5ldyBWZWMzIHdpdGggdGhlIG5ldyBjb29yZGluYXRlcyhjYWxjdWxhdGVkIHdpdGggdGhpcyBWZWMzIGNvb3JkaW5hdGVzIGFuZCB0aGUgc3BlY2lmaWVkIGxlbmd0aCkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbGVuZ3RoIC0gVGhlIGxlbmd0aCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZXNpemUobGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJMZW4gPSB0aGlzLl9fZGF0YVswXSAqIHRoaXMuX19kYXRhWzBdICsgdGhpcy5fX2RhdGFbMV0gKiB0aGlzLl9fZGF0YVsxXSArIHRoaXMuX19kYXRhWzJdICogdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGlmIChjdXJyTGVuIDwgTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzY2wgPSBsZW5ndGggLyBNYXRoLnNxcnQoY3Vyckxlbik7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLl9fZGF0YVswXSAqIHNjbCwgdGhpcy5fX2RhdGFbMV0gKiBzY2wsIHRoaXMuX19kYXRhWzJdICogc2NsKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTW9kaWZpZXMgY3VycmVudCBjb29yZGluYXRlcyB1c2luZyB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBsZW5ndGggLSBUaGUgbGVuZ3RoIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHJlc2l6ZUluUGxhY2UobGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJMZW4gPSB0aGlzLl9fZGF0YVswXSAqIHRoaXMuX19kYXRhWzBdICsgdGhpcy5fX2RhdGFbMV0gKiB0aGlzLl9fZGF0YVsxXSArIHRoaXMuX19kYXRhWzJdICogdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGlmIChjdXJyTGVuIDwgTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzY2wgPSBsZW5ndGggLyBNYXRoLnNxcnQoY3Vyckxlbik7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdICo9IHNjbDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gKj0gc2NsOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSAqPSBzY2w7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoaXMgVmVjMyBhZ2FpbnN0IGFub3RoZXIgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgZG90IHByb2R1Y3QuCiAgICAgICAgICovCiAgICAgICAgZG90KG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggKiBvdGhlci54ICsgdGhpcy55ICogb3RoZXIueSArIHRoaXMueiAqIG90aGVyLno7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdHdvIFZlYzNzIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIGNhbGN1bGF0ZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBjcm9zcyBwcm9kdWN0IGFzIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgY3Jvc3Mob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgICAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICAgICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgICAgICAgY29uc3QgYnggPSBvdGhlci54OwogICAgICAgICAgICBjb25zdCBieSA9IG90aGVyLnk7CiAgICAgICAgICAgIGNvbnN0IGJ6ID0gb3RoZXIuejsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKGF5ICogYnogLSBheiAqIGJ5LCBheiAqIGJ4IC0gYXggKiBieiwgYXggKiBieSAtIGF5ICogYngpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXRzIHRoZSBhbmdsZSBiZXR3ZWVuIHRoaXMgVmVjMyBhbmQgYi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWMzIHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgYW5nbGUgaW4gcmFkaWFucy4KICAgICAgICAgKi8KICAgICAgICBhbmdsZVRvKG90aGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGNvc2luZSA9IHRoaXMuZG90KG90aGVyKTsKICAgICAgICAgICAgaWYgKGNvc2luZSA+IDEuMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hY29zKGNvc2luZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUGVyZm9ybXMgYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHRoaXMgVmVjMyBhbmQgb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjMyB0byBpbnRlcnBvbGF0ZSBiZXR3ZWVuLgogICAgICAgICAqIEBwYXJhbSB0IC0gSW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgdHdvIGlucHV0cy4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIGxlcnAob3RoZXIsIHQpIHsKICAgICAgICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgICAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICAgICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKGF4ICsgdCAqIChvdGhlci54IC0gYXgpLCBheSArIHQgKiAob3RoZXIueSAtIGF5KSwgYXogKyB0ICogKG90aGVyLnogLSBheikpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgbmV3IFZlYzMgd2hvc2UgY29tcG9uZW50IHZhbHVlcyBhcmUgdGhlIGFicyBvZiB0aGlzIFZlYzNzIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIGFicygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKE1hdGguYWJzKHRoaXMueCksIE1hdGguYWJzKHRoaXMueSksIE1hdGguYWJzKHRoaXMueikpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSB2ZWN0b3IgYSByYW5kb20gdmVjdG9yIG9uIHRoZSBzdXJmYWNlIG9mIGEgc3BoZXJlIHdpdGggdGhlIHJhZGl1cyBvZiB0aGUgZ2l2ZW4gc2NhbGUgdmFsdWUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2NhbGUgLSBUaGUgcmFkaXVzIG9mIHRoZSBzdXJmYWNlIHNwaGVyZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJhbmRvbSBWZWMzLgogICAgICAgICAqLwogICAgICAgIHNldFJhbmRvbURpcihzY2FsZSA9IDEuMCkgewogICAgICAgICAgICBjb25zdCByID0gTWF0aC5yYW5kb20oKSAqIDIuMCAqIE1hdGguUEk7CiAgICAgICAgICAgIGNvbnN0IHogPSBNYXRoLnJhbmRvbSgpICogMi4wIC0gMS4wOwogICAgICAgICAgICBjb25zdCB6U2NhbGUgPSBNYXRoLnNxcnQoMS4wIC0geiAqIHopICogc2NhbGU7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gTWF0aC5jb3MocikgKiB6U2NhbGU7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gTWF0aC5zaW4ocikgKiB6U2NhbGU7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0geiAqIHNjYWxlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGVzIGEgcmFuZG9tIHZlY3RvciBhbnl3aGVyZSBpbiB0aGUgc3BoZXJlIGRlZmluZWQgYnkgdGhlIHByb3ZpZGVkIHNjYWxlIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxlIC0gVGhlIHJhZGl1cyBvZiB0aGUgYm91bmRpbmcgc3BoZXJlLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmFuZG9tIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgc2V0UmFuZG9tKHNjYWxlID0gMS4wKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2NhbGU7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2NhbGU7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2NhbGU7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDbG9uZXMgdGhpcyBWZWMzIGFuZCByZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIGNsb25lKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy5fX2RhdGFbMF0sIHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHR5cGUgYXMgYW4gYXJyYXkuIE9mdGVuIHVzZWQgdG8gcGFzcyB0eXBlcyB0byB0aGUgR1BVLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYXMgYW4gYXJyYXkuCiAgICAgICAgICovCiAgICAgICAgYXNBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOyAvLyBUT0RPOiByZXR1cm4gdHlwZSArIGNhc3QgaXMgYSB0ZW1wIGZpeAogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRoaXMgVmVjMyB0byBhIHN0cmluZyBpbiBKU09OIGZvcm1hdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcAogICAgICAgICAgICByZXR1cm4gU3RyaW5nRnVuY3Rpb25zLnN0cmluZ2lmeUpTT05XaXRoRml4ZWRQcmVjaXNpb24odGhpcy50b0pTT04oKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEVuY29kZXMgVmVjMyBDbGFzcyBhcyBhIEpTT04gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUganNvbiBvYmplY3QuCiAgICAgICAgICovCiAgICAgICAgdG9KU09OKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgeDogdGhpcy54LAogICAgICAgICAgICAgICAgeTogdGhpcy55LAogICAgICAgICAgICAgICAgejogdGhpcy56LAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEZWNvZGVzIGEgSlNPTiBvYmplY3QgdG8gc2V0IHRoZSBzdGF0ZSBvZiB0aGlzIGNsYXNzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGogLSBUaGUganNvbiBvYmplY3QuCiAgICAgICAgICovCiAgICAgICAgZnJvbUpTT04oaikgewogICAgICAgICAgICB0aGlzLnggPSBqLng7CiAgICAgICAgICAgIHRoaXMueSA9IGoueTsKICAgICAgICAgICAgdGhpcy56ID0gai56OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBMb2FkcyB0aGUgc3RhdGUgb2YgdGhlIHZhbHVlIGZyb20gYSBiaW5hcnkgcmVhZGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgcmVhZEJpbmFyeShyZWFkZXIpIHsKICAgICAgICAgICAgdGhpcy54ID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgICAgIHRoaXMueSA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICB0aGlzLnogPSByZWFkZXIubG9hZEZsb2F0MzIoKTsKICAgICAgICB9CiAgICAgICAgaXNWYWxpZCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHRoaXMuX19kYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAodiA9PSBJbmZpbml0eSB8fCBpc05hTih2KSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIGZvdXItZGltZW5zaW9uYWwgY29vcmRpbmF0ZS4KICAgICAqIE1hdGggdHlwZXMgaW50ZXJuYWxseSBzdG9yZSB2YWx1ZXMgaW4ge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Zsb2F0MzJBcnJheXxGbG9hdDMyQXJyYXl9IGFuZAogICAgICogZXhwb3NlIGdldHRlcnMgYW5kIHNldHRlcnMgZm9yIHRoZSBjb21wb25lbnQgdmFsdWVzLgogICAgICoKICAgICAqLwogICAgY2xhc3MgVmVjNCB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBUaGUgdHlwZSBvZiB2YWx1ZXMgb2YgdGhlIGAoeCwgeSwgeiwgdClgIGNvb3JkaW5hdGVzIGNhbiBiZSB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRmxvYXQzMkFycmF5fEZsb2F0MzJBcnJheX0sCiAgICAgICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL1VpbnQzMkFycmF5fFVpbnQzMkFycmF5fSwKICAgICAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvSW50MzJBcnJheXxJbnQzMkFycmF5fSBhbmQKICAgICAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZXMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2lhL09iamV0b3NfZ2xvYmFsZXMvQXJyYXlCdWZmZXJ8QXJyYXlCdWZmZXJ9LgogICAgICAgICAqCiAgICAgICAgICogWW91IGNhbiBhbHNvIHBhc3Mgb25lIEpTT04gb2JqZWN0IHBhcmFtZXRlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB4IC0gVGhlIHggdmFsdWUuIERlZmF1bHQgaXMgMC4KICAgICAgICAgKiBAcGFyYW0geSAtIFRoZSB5IHZhbHVlLiBEZWZhdWx0IGlzIDAuCiAgICAgICAgICogQHBhcmFtIHogLSBUaGUgeSB2YWx1ZS4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSB0IC0gVGhlIHQgdmFsdWUuIERlZmF1bHQgaXMgMC4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3Rvcih4ID0gMCwgeSA9IDAsIHogPSAwLCB0ID0gMCkgewogICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSB8fCB4IGluc3RhbmNlb2YgVWludDMyQXJyYXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0geDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh4IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBuZXcgVmVjNChuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgNCkpYCk7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPSB4OwogICAgICAgICAgICAgICAgY29uc3QgYnl0ZU9mZnNldCA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCA0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgeCA9PSAnbnVtYmVyJyAmJiB0eXBlb2YgeSA9PSAnbnVtYmVyJyAmJiB0eXBlb2YgeiA9PSAnbnVtYmVyJyAmJiB0eXBlb2YgdCA9PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSB4OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB5OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSB6OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSB0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHggIT0gbnVsbCAmJiB0eXBlb2YgeCA9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICAgICAgICAgICAgICAgdGhpcy5mcm9tSlNPTih4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB4YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB4IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCB4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHhgIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHgodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB5YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB5IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCB5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHlgIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHkodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB6YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIGdldCB6KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHpgIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHoodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB0YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIGdldCB0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbM107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHRgIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHQodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB3YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIGdldCB3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbM107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHdgIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHcodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB4eXpgIHN3aXp6ZWwuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgeiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgeHl6KCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy5fX2RhdGFbMF0sIHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmcm9tIHNjYWxhciBjb21wb25lbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHggLSBUaGUgeCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0geSAgLSBUaGUgeSB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0geiAgLSBUaGUgeSB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gdCAgLSBUaGUgdCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXQoeCwgeSwgeiwgdCkgewogICAgICAgICAgICB0aGlzLnggPSB4OwogICAgICAgICAgICB0aGlzLnkgPSB5OwogICAgICAgICAgICB0aGlzLnogPSB6OwogICAgICAgICAgICB0aGlzLnQgPSB0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBzdGF0ZSBvZiBhIFZlYzQgT2JqZWN0IGZyb20gYW5vdGhlciBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gc2V0IGZyb20uCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbU90aGVyKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCA9IG90aGVyLng7CiAgICAgICAgICAgIHRoaXMueSA9IG90aGVyLnk7CiAgICAgICAgICAgIHRoaXMueiA9IG90aGVyLno7CiAgICAgICAgICAgIHRoaXMudCA9IG90aGVyLnQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGlzIFZlYzQgY29udGFpbnMgdGhlIHNhbWUgdmFsdWVzIGFzIHRoZSBvdGhlciBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgaXNFcXVhbChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy54ID09IG90aGVyLnggJiYgdGhpcy55ID09IG90aGVyLnkgJiYgdGhpcy56ID09IG90aGVyLnogJiYgdGhpcy50ID09IG90aGVyLnQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGlzIFZlYzQgaXMgZGlmZmVyZW50IGZyb20gYW5vdGhlciBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgbm90RXF1YWwob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMueCAhPSBvdGhlci54ICYmIHRoaXMueSAhPSBvdGhlci55ICYmIHRoaXMueiAhPSBvdGhlci56ICYmIHRoaXMudCAhPSBvdGhlci50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBWZWM0IGlzIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgYXMgb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHBhcmFtIHByZWNpc2lvbiAtIFRoZSBwcmVjaXNpb24gdG8gd2hpY2ggdGhlIHZhbHVlcyBtdXN0IG1hdGNoLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGFwcHJveEVxdWFsKG90aGVyLCBwcmVjaXNpb24gPSBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICByZXR1cm4gKE1hdGguYWJzKHRoaXMueCAtIG90aGVyLngpIDwgcHJlY2lzaW9uICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicyh0aGlzLnkgLSBvdGhlci55KSA8IHByZWNpc2lvbiAmJgogICAgICAgICAgICAgICAgTWF0aC5hYnModGhpcy56IC0gb3RoZXIueikgPCBwcmVjaXNpb24gJiYKICAgICAgICAgICAgICAgIE1hdGguYWJzKHRoaXMudCAtIG90aGVyLnQpIDwgcHJlY2lzaW9uKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkcyBvdGhlciB0byB0aGlzIFZlYzQgYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gYWRkLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzQuCiAgICAgICAgICovCiAgICAgICAgYWRkKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNCh0aGlzLnggKyBvdGhlci54LCB0aGlzLnkgKyBvdGhlci55LCB0aGlzLnogKyBvdGhlci56LCB0aGlzLnQgKyBvdGhlci50KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkcyBvdGhlciB0byB0aGlzIFZlYzQgbXV0YXRpbmcgdGhlIHZhbHVlcyBvZiB0aGlzIGluc3RhbmNlCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBhZGQuCiAgICAgICAgICovCiAgICAgICAgYWRkSW5QbGFjZShvdGhlcikgewogICAgICAgICAgICB0aGlzLnggKz0gb3RoZXIueDsKICAgICAgICAgICAgdGhpcy55ICs9IG90aGVyLnk7CiAgICAgICAgICAgIHRoaXMueiArPSBvdGhlci56OwogICAgICAgICAgICB0aGlzLnQgKz0gb3RoZXIudDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU3VidHJhY3RzIG90aGVyIGZyb20gdGhpcyBWZWM0IGFuZCByZXR1cm5zIHRoZW4gcmVzdWx0IGFzIGEgbmV3IFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBzdWJ0cmFjdC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWM0LgogICAgICAgICAqLwogICAgICAgIHN1YnRyYWN0KG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNCh0aGlzLnggLSBvdGhlci54LCB0aGlzLnkgLSBvdGhlci55LCB0aGlzLnogLSBvdGhlci56LCB0aGlzLnQgLSBvdGhlci50KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU3VidHJhY3RzIG90aGVyIGZyb20gdGhpcyBWZWM0IG11dGF0aW5nIHRoZSB2YWx1ZXMgb2YgdGhpcyBpbnN0YW5jZQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gc3VidHJhY3QuCiAgICAgICAgICovCiAgICAgICAgc3VidHJhY3RJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCAtPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgLT0gb3RoZXIueTsKICAgICAgICAgICAgdGhpcy56IC09IG90aGVyLno7CiAgICAgICAgICAgIHRoaXMudCAtPSBvdGhlci50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBNdWx0aXBsaWVzIHR3byBWZWM0cyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBtdWx0aXBseSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzQuCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHkob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWM0KHRoaXMueCAqIG90aGVyLngsIHRoaXMueSAqIG90aGVyLnksIHRoaXMueiAqIG90aGVyLnosIHRoaXMudCAqIG90aGVyLnQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBNdWx0aXBsaWVzIHR3byBWZWM0cyBtdXRhdGluZyB0aGUgdmFsdWVzIG9mIHRoaXMgaW5zdGFuY2UKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWM0IHRvIG11bHRpcGx5IHdpdGguCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHlJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCAqPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgKj0gb3RoZXIueTsKICAgICAgICAgICAgdGhpcy56ICo9IG90aGVyLno7CiAgICAgICAgICAgIHRoaXMudCAqPSBvdGhlci50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEaXZpZGVzIHR3byBWZWM0cyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBkaXZpZGUgYnkuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgVmVjNC4KICAgICAgICAgKi8KICAgICAgICBkaXZpZGUob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWM0KHRoaXMueCAvIG90aGVyLngsIHRoaXMueSAvIG90aGVyLnksIHRoaXMueiAvIG90aGVyLnosIHRoaXMudCAvIG90aGVyLnQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEaXZpZGVzIHR3byBWZWM0cy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWM0IHRvIGRpdmlkZSBieS4KICAgICAgICAgKi8KICAgICAgICBkaXZpZGVJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCAvPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgLz0gb3RoZXIueTsKICAgICAgICAgICAgdGhpcy56IC89IG90aGVyLno7CiAgICAgICAgICAgIHRoaXMudCAvPSBvdGhlci50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTY2FsZXMgdGhpcyBWZWM0IGJ5IHNjYWxhciBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzY2FsZShzY2FsYXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWM0KHRoaXMueCAqIHNjYWxhciwgdGhpcy55ICogc2NhbGFyLCB0aGlzLnogKiBzY2FsYXIsIHRoaXMudCAqIHNjYWxhcik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNjYWxlcyB0aGlzIFZlYzQgYnkgc2NhbGFyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2NhbGVJblBsYWNlKHNjYWxhcikgewogICAgICAgICAgICB0aGlzLnNldCh0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhciwgdGhpcy56ICogc2NhbGFyLCB0aGlzLnQgKiBzY2FsYXIpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBsZW5ndGggb2YgdGhpcyBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGxlbmd0aC4KICAgICAgICAgKi8KICAgICAgICBsZW5ndGgoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCh4ICogeCArIHkgKiB5ICsgeiAqIHogKyB0ICogdCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIHNxdWFyZWQgbGVuZ3RoIG9mIHRoaXMgVmVjNC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBsZW5ndGguCiAgICAgICAgICovCiAgICAgICAgbGVuZ3RoU3F1YXJlZCgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuX19kYXRhWzNdOwogICAgICAgICAgICByZXR1cm4geCAqIHggKyB5ICogeSArIHogKiB6ICsgdCAqIHQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE5vcm1hbGl6ZXMgdGhlIFZlYzQgYW5kIHJldHVybnMgaXQgYXMgYSBuZXcgVmVjNC4KICAgICAgICAgKiBNdWx0aXBsaWVzIGNvb3JkaW5hdGVzIHZhbHVlIGJ5IHRoZSBpbnZlcnNlIG9mIHRoZSB2ZWN0b3IgbGVuZ3RoLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIFZlYzQgbm9ybWFsaXplZC4KICAgICAgICAgKi8KICAgICAgICBub3JtYWxpemUoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgbGV0IGxlbiA9IHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHQgKiB0OwogICAgICAgICAgICBpZiAobGVuIDwgTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFRPRE86IGV2YWx1YXRlIHVzZSBvZiBnbG1faW52c3FydCBoZXJlPwogICAgICAgICAgICBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNCh4ICogbGVuLCB5ICogbGVuLCB6ICogbGVuKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTm9ybWFsaXplcyB0aGlzIFZlYzQgbXVsdGlwbHlpbmcgY29vcmRpbmF0ZSB2YWx1ZXMgYnkgdGhlIGludmVyc2Ugb2YgdGhlIHZlY3RvciBsZW5ndGguCiAgICAgICAgICovCiAgICAgICAgbm9ybWFsaXplSW5QbGFjZSgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuX19kYXRhWzNdOwogICAgICAgICAgICBsZXQgbGVuID0geCAqIHggKyB5ICogeSArIHogKiB6ICsgdCAqIHQ7CiAgICAgICAgICAgIGlmIChsZW4gPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgdGhpcy5zZXQoeCAqIGxlbiwgeSAqIGxlbiwgeiAqIGxlbiwgdCAqIGxlbik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoaXMgVmVjNCBhZ2FpbnN0IGFub3RoZXIgVmVjNC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWM0IHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgZG90IHByb2R1Y3QuCiAgICAgICAgICovCiAgICAgICAgZG90KG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggKiBvdGhlci54ICsgdGhpcy55ICogb3RoZXIueSArIHRoaXMueiAqIG90aGVyLnogKyB0aGlzLnQgKiBvdGhlci50OyAvLyBUT0RPOiBvdGhlci50IHVzZWQgdG8gYmUgYi50PwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHR3byBWZWM0cyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFZlYzQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgVmVjNCB0byBjYWxjdWxhdGUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgY3Jvc3MgcHJvZHVjdCBhcyBhIG5ldyBWZWM0LgogICAgICAgICAqLwogICAgICAgIGNyb3NzKG90aGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICAgICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IGF0ID0gdGhpcy50OwogICAgICAgICAgICBjb25zdCBieCA9IG90aGVyLng7CiAgICAgICAgICAgIGNvbnN0IGJ5ID0gb3RoZXIueTsKICAgICAgICAgICAgY29uc3QgYnogPSBvdGhlci56OwogICAgICAgICAgICBjb25zdCBidCA9IG90aGVyLnQ7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNChheSAqIGJ6IC0gYXogKiBieSwgYXogKiBidCAtIGF0ICogYnosIGF0ICogYnggLSBheCAqIGJ0LCBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIGFuZ2xlIGJldHdlZW4gdGhpcyBWZWM0IGFuZCBiLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFZlYzQgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgICAgICAqLwogICAgICAgIGFuZ2xlVG8ob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgdGVtcEEgPSB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCB0ZW1wQiA9IG90aGVyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBjb3NpbmUgPSB0ZW1wQS5kb3QodGVtcEIpOwogICAgICAgICAgICBpZiAoY29zaW5lID4gMS4wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFjb3MoY29zaW5lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBQZXJmb3JtcyBhIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdGhpcyBWZWM0IGFuZCBvdGhlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBWZWM0IHRvIGludGVycG9sYXRlIGJldHdlZW4uCiAgICAgICAgICogQHBhcmFtIHQgLSBJbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzQuCiAgICAgICAgICovCiAgICAgICAgbGVycChvdGhlciwgdCkgewogICAgICAgICAgICBjb25zdCBheCA9IHRoaXMueDsKICAgICAgICAgICAgY29uc3QgYXkgPSB0aGlzLnk7CiAgICAgICAgICAgIGNvbnN0IGF6ID0gdGhpcy56OwogICAgICAgICAgICBjb25zdCBhdCA9IHRoaXMudDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWM0KGF4ICsgdCAqIChvdGhlci54IC0gYXgpLCBheSArIHQgKiAob3RoZXIueSAtIGF5KSwgYXogKyB0ICogKG90aGVyLnogLSBheiksIGF0ICsgdCAqIChvdGhlci50IC0gYXQpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGVzIGEgcmFuZG9tIHZlY3RvciB3aXRoIHRoZSBnaXZlbiBzY2FsZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzY2FsZSAtIExlbmd0aCBvZiB0aGUgcmVzdWx0aW5nIHZlY3Rvci4gSWYgb21pdHRlZCwgYSB1bml0IHZlY3RvciB3aWxsIGJlIHJldHVybmVkLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIC8vIHJhbmRvbShzY2FsZSA9IDEuMCkgewogICAgICAgIC8vICAgY29uc3QgciA9IGdsTWF0cml4LlJBTkRPTSgpICogMi4wICogTWF0aC5QSQogICAgICAgIC8vICAgY29uc3QgeiA9IGdsTWF0cml4LlJBTkRPTSgpICogMi4wIC0gMS4wCiAgICAgICAgLy8gICBjb25zdCB6U2NhbGUgPSBNYXRoLnNxcnQoMS4wIC0geiAqIHopICogc2NhbGUKICAgICAgICAvLyAgIG91dFswXSA9IE1hdGguY29zKHIpICogelNjYWxlCiAgICAgICAgLy8gICBvdXRbMV0gPSBNYXRoLnNpbihyKSAqIHpTY2FsZQogICAgICAgIC8vICAgb3V0WzJdID0geiAqIHNjYWxlCiAgICAgICAgLy8gICByZXR1cm4gb3V0CiAgICAgICAgLy8gfQogICAgICAgIC8qKgogICAgICAgICAqIENsb25lcyB0aGlzIFZlYzQgYW5kIHJldHVybnMgYSBuZXcgVmVjNC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzQuCiAgICAgICAgICovCiAgICAgICAgY2xvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjNCh0aGlzLl9fZGF0YVswXSwgdGhpcy5fX2RhdGFbMV0sIHRoaXMuX19kYXRhWzJdLCB0aGlzLl9fZGF0YVszXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRoaXMgVmVjNCBpbnRvIGEgVmVjMy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB2YWx1ZSBhcyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIHRvVmVjMygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHRoaXMuX19kYXRhWzBdLCB0aGlzLl9fZGF0YVsxXSwgdGhpcy5fX2RhdGFbMl0pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSB0eXBlIGFzIGFuIGFycmF5LiBPZnRlbiB1c2VkIHRvIHBhc3MgdHlwZXMgdG8gdGhlIEdQVS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGFzIGFuIGFycmF5LgogICAgICAgICAqLwogICAgICAgIGFzQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGVyc2lzdGVuY2UKICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFZlYzMgdG8gYSBzdHJpbmcgaW4gSlNPTiBmb3JtYXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5ldy1jYXAKICAgICAgICAgICAgcmV0dXJuIFN0cmluZ0Z1bmN0aW9ucy5zdHJpbmdpZnlKU09OV2l0aEZpeGVkUHJlY2lzaW9uKHRoaXMudG9KU09OKCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgdG9KU09OIG1ldGhvZCBlbmNvZGVzIHRoaXMgdHlwZSBhcyBhIGpzb24gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHg6IHRoaXMueCwKICAgICAgICAgICAgICAgIHk6IHRoaXMueSwKICAgICAgICAgICAgICAgIHo6IHRoaXMueiwKICAgICAgICAgICAgICAgIHQ6IHRoaXMudCwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlcyBhIEpTT04gb2JqZWN0IHRvIHNldCB0aGUgc3RhdGUgb2YgdGhpcyBjbGFzcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGopIHsKICAgICAgICAgICAgdGhpcy54ID0gai54OwogICAgICAgICAgICB0aGlzLnkgPSBqLnk7CiAgICAgICAgICAgIHRoaXMueiA9IGouejsKICAgICAgICAgICAgdGhpcy50ID0gai50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBMb2FkcyB0aGUgc3RhdGUgb2YgdGhlIHZhbHVlIGZyb20gYSBiaW5hcnkgcmVhZGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgcmVhZEJpbmFyeShyZWFkZXIpIHsKICAgICAgICAgICAgdGhpcy54ID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgICAgIHRoaXMueSA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICB0aGlzLnogPSByZWFkZXIubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgdGhpcy50ID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFZlcmlmaWVzIGlmIHRoZSB2YWx1ZXMgc3RvcmVkIGluIHRoaXMgTWF0aCB0eXBlIGFyZSB2YWxpZCBudW1lcmljIHZhbHVlcy4KICAgICAgICAgKiBSZXR1cm5zIGBmYWxzZWAgSWYgYXQgbGVhc3Qgb25lIG9mIHRoZSB2YWx1ZXMgaXMgZWl0aGVyIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jaWEvT2JqZXRvc19nbG9iYWxlcy9JbmZpbml0eXxJbmZpbml0eX0gb3IKICAgICAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2lhL09iamV0b3NfZ2xvYmFsZXMvTmFOfE5hTn0uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgYm9vbGVhbi4KICAgICAgICAgKi8KICAgICAgICBpc1ZhbGlkKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdGhpcy5fX2RhdGEpIHsKICAgICAgICAgICAgICAgIGlmICh2ID09IEluZmluaXR5IHx8IGlzTmFOKHYpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBjb2xvciBhcyA0IGZsb2F0aW5nIHBvaW50IHZhbHVlcy4KICAgICAqLwogICAgY2xhc3MgQ29sb3IgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBgQ29sb3JgIG9iamVjdCB3aXRoIGFuIFJHQkEgc3RydWN0dXJlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHIgLSBUaGUgcmVkIGNoYW5uZWwgb2YgYSBjb2xvci4KICAgICAgICAgKiBAcGFyYW0gZyAtIFRoZSBncmVlbiBjaGFubmVsIG9mIGEgY29sb3IuCiAgICAgICAgICogQHBhcmFtIGIgLSBUaGUgYmx1ZSBjaGFubmVsIG9mIGEgY29sb3IuCiAgICAgICAgICogQHBhcmFtIGEgLSBUaGUgYWxwaGEgKHRyYW5zcGFyZW5jeSkgY2hhbm5lbCBvZiBhIGNvbG9yLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKHIgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAxLjApIHsKICAgICAgICAgICAgaWYgKHIgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBuZXcgVmVjNChuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgNCkpYCk7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPSByOwogICAgICAgICAgICAgICAgY29uc3QgYnl0ZU9mZnNldCA9IGc7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCA0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgciA9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIGlmIChyLnN0YXJ0c1dpdGgoJyMnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21IZXgocik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21DU1NDb2xvck5hbWUocik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSByOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gZzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IGI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSBhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgcmVkIGNoYW5uZWwuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgcmVkIGNoYW5uZWwuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVswXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByZWQgY2hhbm5lbC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCByKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciBncmVlbiBjaGFubmVsLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGdyZWVuIGNoYW5uZWwuCiAgICAgICAgICovCiAgICAgICAgZ2V0IGcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciBncmVlbiBjaGFubmVsLgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBnKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciBibHVlIGNoYW5uZWwuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgYmx1ZSBjaGFubmVsLgogICAgICAgICAqLwogICAgICAgIGdldCBiKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYmx1ZSBjaGFubmVsLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IGIodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGFscGhhIGNoYW5uZWwuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgYWxwaGEgY2hhbm5lbC4KICAgICAgICAgKi8KICAgICAgICBnZXQgYSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzNdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGFscGhhIHZhbHVlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IGEodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZnJvbSBzY2FsYXIgY29tcG9uZW50cy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByIC0gVGhlIHJlZCBjaGFubmVsLgogICAgICAgICAqIEBwYXJhbSBnICAtIFRoZSBncmVlbiBjaGFubmVsLgogICAgICAgICAqIEBwYXJhbSBiICAtIFRoZSBibHVlIGNoYW5uZWwuCiAgICAgICAgICogQHBhcmFtIGEgIC0gVGhlIGFscGhhIGNoYW5uZWwuCiAgICAgICAgICovCiAgICAgICAgc2V0KHIsIGcsIGIsIGEgPSAxLjApIHsKICAgICAgICAgICAgdGhpcy5yID0gcjsKICAgICAgICAgICAgdGhpcy5nID0gZzsKICAgICAgICAgICAgdGhpcy5iID0gYjsKICAgICAgICAgICAgdGhpcy5hID0gYTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBjdXJyZW50IGNvbG9yIHN0YXRlIHdpdGggYW5vdGhlciBgQ29sb3JgIG9iamVjdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBjb2xvciB0byBzZXQgZnJvbS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tT3RoZXIob3RoZXIpIHsKICAgICAgICAgICAgdGhpcy5yID0gb3RoZXIucjsKICAgICAgICAgICAgdGhpcy5nID0gb3RoZXIuZzsKICAgICAgICAgICAgdGhpcy5iID0gb3RoZXIuYjsKICAgICAgICAgICAgdGhpcy5hID0gb3RoZXIuYTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZyb20gYSBzY2FsYXIgYXJyYXkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFscyAtIFRoZSB2YWxzIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldEZyb21TY2FsYXJBcnJheSh2YWxzKSB7CiAgICAgICAgICAgIHRoaXMuciA9IHZhbHNbMF07CiAgICAgICAgICAgIHRoaXMuZyA9IHZhbHNbMV07CiAgICAgICAgICAgIHRoaXMuYiA9IHZhbHNbMl07CiAgICAgICAgICAgIHRoaXMuYSA9IHZhbHMubGVuZ3RoID09IDQgPyB2YWxzWzNdIDogMS4wOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZnJvbSBhbiBSR0IgYXJyYXkuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRBc1JHQkFycmF5KCkgewogICAgICAgICAgICByZXR1cm4gW3RoaXMuciAqIDI1NSwgdGhpcy5nICogMjU1LCB0aGlzLmIgKiAyNTVdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZnJvbSBhbiBSR0IgZGljdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldEFzUkdCRGljdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHI6IHRoaXMuciAqIDI1NSwKICAgICAgICAgICAgICAgIGc6IHRoaXMuZyAqIDI1NSwKICAgICAgICAgICAgICAgIGI6IHRoaXMuYiAqIDI1NSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZyb20gYSBSR0IgdmFsdWUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gciAtIFRoZSByZWQgY2hhbm5lbC4KICAgICAgICAgKiBAcGFyYW0gZyAgLSBUaGUgZ3JlZW4gY2hhbm5lbC4KICAgICAgICAgKiBAcGFyYW0gYiAgLSBUaGUgYmx1ZSBjaGFubmVsLgogICAgICAgICAqIEBwYXJhbSBhICAtIFRoZSBhbHBoYSBjaGFubmVsLgogICAgICAgICAqLwogICAgICAgIHNldEZyb21SR0IociwgZywgYiwgYSkgewogICAgICAgICAgICB0aGlzLnIgPSByIC8gMjU1OwogICAgICAgICAgICB0aGlzLmcgPSBnIC8gMjU1OwogICAgICAgICAgICB0aGlzLmIgPSBiIC8gMjU1OwogICAgICAgICAgICB0aGlzLmEgPSBhID8gYSAvIDI1NSA6IDEuMDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZyb20gYW4gUkdCIGFycmF5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbHMgLSBUaGUgdmFscyBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tUkdCQXJyYXkodmFscykgewogICAgICAgICAgICB0aGlzLnIgPSB2YWxzWzBdIC8gMjU1OwogICAgICAgICAgICB0aGlzLmcgPSB2YWxzWzFdIC8gMjU1OwogICAgICAgICAgICB0aGlzLmIgPSB2YWxzWzJdIC8gMjU1OwogICAgICAgICAgICB0aGlzLmEgPSB2YWxzLmxlbmd0aCA9PSA0ID8gdmFsc1szXSAvIDI1NSA6IDEuMDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZyb20gYW4gUkdCIGRpY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFscyAtIFRoZSB2YWxzIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldEZyb21SR0JEaWN0KHZhbHMpIHsKICAgICAgICAgICAgdGhpcy5yID0gdmFscy5yIC8gMjU1OwogICAgICAgICAgICB0aGlzLmcgPSB2YWxzLmcgLyAyNTU7CiAgICAgICAgICAgIHRoaXMuYiA9IHZhbHMuYiAvIDI1NTsKICAgICAgICAgICAgdGhpcy5hID0gdmFscy5hID09IDQgPyB2YWxzLmEgLyAyNTUgOiAxLjA7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmcm9tIGEgaGV4YWRlY2ltYWwgdmFsdWUuCiAgICAgICAgICogRS5nLiAjZmYwMDAwCiAgICAgICAgICogQHBhcmFtIGhleCAtIFRoZSBoZXggdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbUhleChoZXgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSAvXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWMoaGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksCiAgICAgICAgICAgICAgICAgICAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLAogICAgICAgICAgICAgICAgICAgICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgOiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJnYiA9IGhleFRvUmdiKGhleCk7CiAgICAgICAgICAgIGlmICghcmdiKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0ludmFsaWQgaGV4IGNvZGU6JyArIGhleCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zZXRGcm9tUkdCKHJnYi5yLCByZ2IuZywgcmdiLmIpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBDb2xvciB2YWx1ZXMgZnJvbSBhIENTUyBjb2xvciBuYW1lLgogICAgICAgICAqIEUuZy4gInJlZCIKICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBDU1MgY29sb3IgbmFtZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tQ1NTQ29sb3JOYW1lKG5hbWUpIHsKICAgICAgICAgICAgY29uc3QgY29sb3VyTmFtZVRvSGV4ID0gKGNvbG91cikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY29sb3JzID0gewogICAgICAgICAgICAgICAgICAgIGFsaWNlYmx1ZTogJyNmMGY4ZmYnLAogICAgICAgICAgICAgICAgICAgIGFudGlxdWV3aGl0ZTogJyNmYWViZDcnLAogICAgICAgICAgICAgICAgICAgIGFxdWE6ICcjMDBmZmZmJywKICAgICAgICAgICAgICAgICAgICBhcXVhbWFyaW5lOiAnIzdmZmZkNCcsCiAgICAgICAgICAgICAgICAgICAgYXp1cmU6ICcjZjBmZmZmJywKICAgICAgICAgICAgICAgICAgICBiZWlnZTogJyNmNWY1ZGMnLAogICAgICAgICAgICAgICAgICAgIGJpc3F1ZTogJyNmZmU0YzQnLAogICAgICAgICAgICAgICAgICAgIGJsYWNrOiAnIzAwMDAwMCcsCiAgICAgICAgICAgICAgICAgICAgYmxhbmNoZWRhbG1vbmQ6ICcjZmZlYmNkJywKICAgICAgICAgICAgICAgICAgICBibHVlOiAnIzAwMDBmZicsCiAgICAgICAgICAgICAgICAgICAgYmx1ZXZpb2xldDogJyM4YTJiZTInLAogICAgICAgICAgICAgICAgICAgIGJyb3duOiAnI2E1MmEyYScsCiAgICAgICAgICAgICAgICAgICAgYnVybHl3b29kOiAnI2RlYjg4NycsCiAgICAgICAgICAgICAgICAgICAgY2FkZXRibHVlOiAnIzVmOWVhMCcsCiAgICAgICAgICAgICAgICAgICAgY2hhcnRyZXVzZTogJyM3ZmZmMDAnLAogICAgICAgICAgICAgICAgICAgIGNob2NvbGF0ZTogJyNkMjY5MWUnLAogICAgICAgICAgICAgICAgICAgIGNvcmFsOiAnI2ZmN2Y1MCcsCiAgICAgICAgICAgICAgICAgICAgY29ybmZsb3dlcmJsdWU6ICcjNjQ5NWVkJywKICAgICAgICAgICAgICAgICAgICBjb3Juc2lsazogJyNmZmY4ZGMnLAogICAgICAgICAgICAgICAgICAgIGNyaW1zb246ICcjZGMxNDNjJywKICAgICAgICAgICAgICAgICAgICBjeWFuOiAnIzAwZmZmZicsCiAgICAgICAgICAgICAgICAgICAgZGFya2JsdWU6ICcjMDAwMDhiJywKICAgICAgICAgICAgICAgICAgICBkYXJrY3lhbjogJyMwMDhiOGInLAogICAgICAgICAgICAgICAgICAgIGRhcmtnb2xkZW5yb2Q6ICcjYjg4NjBiJywKICAgICAgICAgICAgICAgICAgICBkYXJrZ3JheTogJyNhOWE5YTknLAogICAgICAgICAgICAgICAgICAgIGRhcmtncmVlbjogJyMwMDY0MDAnLAogICAgICAgICAgICAgICAgICAgIGRhcmtraGFraTogJyNiZGI3NmInLAogICAgICAgICAgICAgICAgICAgIGRhcmttYWdlbnRhOiAnIzhiMDA4YicsCiAgICAgICAgICAgICAgICAgICAgZGFya29saXZlZ3JlZW46ICcjNTU2YjJmJywKICAgICAgICAgICAgICAgICAgICBkYXJrb3JhbmdlOiAnI2ZmOGMwMCcsCiAgICAgICAgICAgICAgICAgICAgZGFya29yY2hpZDogJyM5OTMyY2MnLAogICAgICAgICAgICAgICAgICAgIGRhcmtyZWQ6ICcjOGIwMDAwJywKICAgICAgICAgICAgICAgICAgICBkYXJrc2FsbW9uOiAnI2U5OTY3YScsCiAgICAgICAgICAgICAgICAgICAgZGFya3NlYWdyZWVuOiAnIzhmYmM4ZicsCiAgICAgICAgICAgICAgICAgICAgZGFya3NsYXRlYmx1ZTogJyM0ODNkOGInLAogICAgICAgICAgICAgICAgICAgIGRhcmtzbGF0ZWdyYXk6ICcjMmY0ZjRmJywKICAgICAgICAgICAgICAgICAgICBkYXJrdHVycXVvaXNlOiAnIzAwY2VkMScsCiAgICAgICAgICAgICAgICAgICAgZGFya3Zpb2xldDogJyM5NDAwZDMnLAogICAgICAgICAgICAgICAgICAgIGRlZXBwaW5rOiAnI2ZmMTQ5MycsCiAgICAgICAgICAgICAgICAgICAgZGVlcHNreWJsdWU6ICcjMDBiZmZmJywKICAgICAgICAgICAgICAgICAgICBkaW1ncmF5OiAnIzY5Njk2OScsCiAgICAgICAgICAgICAgICAgICAgZG9kZ2VyYmx1ZTogJyMxZTkwZmYnLAogICAgICAgICAgICAgICAgICAgIGZpcmVicmljazogJyNiMjIyMjInLAogICAgICAgICAgICAgICAgICAgIGZsb3JhbHdoaXRlOiAnI2ZmZmFmMCcsCiAgICAgICAgICAgICAgICAgICAgZm9yZXN0Z3JlZW46ICcjMjI4YjIyJywKICAgICAgICAgICAgICAgICAgICBmdWNoc2lhOiAnI2ZmMDBmZicsCiAgICAgICAgICAgICAgICAgICAgZ2FpbnNib3JvOiAnI2RjZGNkYycsCiAgICAgICAgICAgICAgICAgICAgZ2hvc3R3aGl0ZTogJyNmOGY4ZmYnLAogICAgICAgICAgICAgICAgICAgIGdvbGQ6ICcjZmZkNzAwJywKICAgICAgICAgICAgICAgICAgICBnb2xkZW5yb2Q6ICcjZGFhNTIwJywKICAgICAgICAgICAgICAgICAgICBncmF5OiAnIzgwODA4MCcsCiAgICAgICAgICAgICAgICAgICAgZ3JlZW46ICcjMDA4MDAwJywKICAgICAgICAgICAgICAgICAgICBncmVlbnllbGxvdzogJyNhZGZmMmYnLAogICAgICAgICAgICAgICAgICAgIGhvbmV5ZGV3OiAnI2YwZmZmMCcsCiAgICAgICAgICAgICAgICAgICAgaG90cGluazogJyNmZjY5YjQnLAogICAgICAgICAgICAgICAgICAgICdpbmRpYW5yZWQgJzogJyNjZDVjNWMnLAogICAgICAgICAgICAgICAgICAgIGluZGlnbzogJyM0YjAwODInLAogICAgICAgICAgICAgICAgICAgIGl2b3J5OiAnI2ZmZmZmMCcsCiAgICAgICAgICAgICAgICAgICAga2hha2k6ICcjZjBlNjhjJywKICAgICAgICAgICAgICAgICAgICBsYXZlbmRlcjogJyNlNmU2ZmEnLAogICAgICAgICAgICAgICAgICAgIGxhdmVuZGVyYmx1c2g6ICcjZmZmMGY1JywKICAgICAgICAgICAgICAgICAgICBsYXduZ3JlZW46ICcjN2NmYzAwJywKICAgICAgICAgICAgICAgICAgICBsZW1vbmNoaWZmb246ICcjZmZmYWNkJywKICAgICAgICAgICAgICAgICAgICBsaWdodGJsdWU6ICcjYWRkOGU2JywKICAgICAgICAgICAgICAgICAgICBsaWdodGNvcmFsOiAnI2YwODA4MCcsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRjeWFuOiAnI2UwZmZmZicsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6ICcjZmFmYWQyJywKICAgICAgICAgICAgICAgICAgICBsaWdodGdyZXk6ICcjZDNkM2QzJywKICAgICAgICAgICAgICAgICAgICBsaWdodGdyZWVuOiAnIzkwZWU5MCcsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRwaW5rOiAnI2ZmYjZjMScsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRzYWxtb246ICcjZmZhMDdhJywKICAgICAgICAgICAgICAgICAgICBsaWdodHNlYWdyZWVuOiAnIzIwYjJhYScsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRza3libHVlOiAnIzg3Y2VmYScsCiAgICAgICAgICAgICAgICAgICAgbGlnaHRzbGF0ZWdyYXk6ICcjNzc4ODk5JywKICAgICAgICAgICAgICAgICAgICBsaWdodHN0ZWVsYmx1ZTogJyNiMGM0ZGUnLAogICAgICAgICAgICAgICAgICAgIGxpZ2h0eWVsbG93OiAnI2ZmZmZlMCcsCiAgICAgICAgICAgICAgICAgICAgbGltZTogJyMwMGZmMDAnLAogICAgICAgICAgICAgICAgICAgIGxpbWVncmVlbjogJyMzMmNkMzInLAogICAgICAgICAgICAgICAgICAgIGxpbmVuOiAnI2ZhZjBlNicsCiAgICAgICAgICAgICAgICAgICAgbWFnZW50YTogJyNmZjAwZmYnLAogICAgICAgICAgICAgICAgICAgIG1hcm9vbjogJyM4MDAwMDAnLAogICAgICAgICAgICAgICAgICAgIG1lZGl1bWFxdWFtYXJpbmU6ICcjNjZjZGFhJywKICAgICAgICAgICAgICAgICAgICBtZWRpdW1ibHVlOiAnIzAwMDBjZCcsCiAgICAgICAgICAgICAgICAgICAgbWVkaXVtb3JjaGlkOiAnI2JhNTVkMycsCiAgICAgICAgICAgICAgICAgICAgbWVkaXVtcHVycGxlOiAnIzkzNzBkOCcsCiAgICAgICAgICAgICAgICAgICAgbWVkaXVtc2VhZ3JlZW46ICcjM2NiMzcxJywKICAgICAgICAgICAgICAgICAgICBtZWRpdW1zbGF0ZWJsdWU6ICcjN2I2OGVlJywKICAgICAgICAgICAgICAgICAgICBtZWRpdW1zcHJpbmdncmVlbjogJyMwMGZhOWEnLAogICAgICAgICAgICAgICAgICAgIG1lZGl1bXR1cnF1b2lzZTogJyM0OGQxY2MnLAogICAgICAgICAgICAgICAgICAgIG1lZGl1bXZpb2xldHJlZDogJyNjNzE1ODUnLAogICAgICAgICAgICAgICAgICAgIG1pZG5pZ2h0Ymx1ZTogJyMxOTE5NzAnLAogICAgICAgICAgICAgICAgICAgIG1pbnRjcmVhbTogJyNmNWZmZmEnLAogICAgICAgICAgICAgICAgICAgIG1pc3R5cm9zZTogJyNmZmU0ZTEnLAogICAgICAgICAgICAgICAgICAgIG1vY2Nhc2luOiAnI2ZmZTRiNScsCiAgICAgICAgICAgICAgICAgICAgbmF2YWpvd2hpdGU6ICcjZmZkZWFkJywKICAgICAgICAgICAgICAgICAgICBuYXZ5OiAnIzAwMDA4MCcsCiAgICAgICAgICAgICAgICAgICAgb2xkbGFjZTogJyNmZGY1ZTYnLAogICAgICAgICAgICAgICAgICAgIG9saXZlOiAnIzgwODAwMCcsCiAgICAgICAgICAgICAgICAgICAgb2xpdmVkcmFiOiAnIzZiOGUyMycsCiAgICAgICAgICAgICAgICAgICAgb3JhbmdlOiAnI2ZmYTUwMCcsCiAgICAgICAgICAgICAgICAgICAgb3JhbmdlcmVkOiAnI2ZmNDUwMCcsCiAgICAgICAgICAgICAgICAgICAgb3JjaGlkOiAnI2RhNzBkNicsCiAgICAgICAgICAgICAgICAgICAgcGFsZWdvbGRlbnJvZDogJyNlZWU4YWEnLAogICAgICAgICAgICAgICAgICAgIHBhbGVncmVlbjogJyM5OGZiOTgnLAogICAgICAgICAgICAgICAgICAgIHBhbGV0dXJxdW9pc2U6ICcjYWZlZWVlJywKICAgICAgICAgICAgICAgICAgICBwYWxldmlvbGV0cmVkOiAnI2Q4NzA5MycsCiAgICAgICAgICAgICAgICAgICAgcGFwYXlhd2hpcDogJyNmZmVmZDUnLAogICAgICAgICAgICAgICAgICAgIHBlYWNocHVmZjogJyNmZmRhYjknLAogICAgICAgICAgICAgICAgICAgIHBlcnU6ICcjY2Q4NTNmJywKICAgICAgICAgICAgICAgICAgICBwaW5rOiAnI2ZmYzBjYicsCiAgICAgICAgICAgICAgICAgICAgcGx1bTogJyNkZGEwZGQnLAogICAgICAgICAgICAgICAgICAgIHBvd2RlcmJsdWU6ICcjYjBlMGU2JywKICAgICAgICAgICAgICAgICAgICBwdXJwbGU6ICcjODAwMDgwJywKICAgICAgICAgICAgICAgICAgICByZWJlY2NhcHVycGxlOiAnIzY2MzM5OScsCiAgICAgICAgICAgICAgICAgICAgcmVkOiAnI2ZmMDAwMCcsCiAgICAgICAgICAgICAgICAgICAgcm9zeWJyb3duOiAnI2JjOGY4ZicsCiAgICAgICAgICAgICAgICAgICAgcm95YWxibHVlOiAnIzQxNjllMScsCiAgICAgICAgICAgICAgICAgICAgc2FkZGxlYnJvd246ICcjOGI0NTEzJywKICAgICAgICAgICAgICAgICAgICBzYWxtb246ICcjZmE4MDcyJywKICAgICAgICAgICAgICAgICAgICBzYW5keWJyb3duOiAnI2Y0YTQ2MCcsCiAgICAgICAgICAgICAgICAgICAgc2VhZ3JlZW46ICcjMmU4YjU3JywKICAgICAgICAgICAgICAgICAgICBzZWFzaGVsbDogJyNmZmY1ZWUnLAogICAgICAgICAgICAgICAgICAgIHNpZW5uYTogJyNhMDUyMmQnLAogICAgICAgICAgICAgICAgICAgIHNpbHZlcjogJyNjMGMwYzAnLAogICAgICAgICAgICAgICAgICAgIHNreWJsdWU6ICcjODdjZWViJywKICAgICAgICAgICAgICAgICAgICBzbGF0ZWJsdWU6ICcjNmE1YWNkJywKICAgICAgICAgICAgICAgICAgICBzbGF0ZWdyYXk6ICcjNzA4MDkwJywKICAgICAgICAgICAgICAgICAgICBzbm93OiAnI2ZmZmFmYScsCiAgICAgICAgICAgICAgICAgICAgc3ByaW5nZ3JlZW46ICcjMDBmZjdmJywKICAgICAgICAgICAgICAgICAgICBzdGVlbGJsdWU6ICcjNDY4MmI0JywKICAgICAgICAgICAgICAgICAgICB0YW46ICcjZDJiNDhjJywKICAgICAgICAgICAgICAgICAgICB0ZWFsOiAnIzAwODA4MCcsCiAgICAgICAgICAgICAgICAgICAgdGhpc3RsZTogJyNkOGJmZDgnLAogICAgICAgICAgICAgICAgICAgIHRvbWF0bzogJyNmZjYzNDcnLAogICAgICAgICAgICAgICAgICAgIHR1cnF1b2lzZTogJyM0MGUwZDAnLAogICAgICAgICAgICAgICAgICAgIHZpb2xldDogJyNlZTgyZWUnLAogICAgICAgICAgICAgICAgICAgIHdoZWF0OiAnI2Y1ZGViMycsCiAgICAgICAgICAgICAgICAgICAgd2hpdGU6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgICAgICB3aGl0ZXNtb2tlOiAnI2Y1ZjVmNScsCiAgICAgICAgICAgICAgICAgICAgeWVsbG93OiAnI2ZmZmYwMCcsCiAgICAgICAgICAgICAgICAgICAgeWVsbG93Z3JlZW46ICcjOWFjZDMyJywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3JzW2NvbG91ci50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgICAgICAgIC8vICBpZiAodHlwZW9mIGNvbG9yc1tjb2xvdXIudG9Mb3dlckNhc2UoKV0gIT0gJ3VuZGVmaW5lZCcpIHJldHVybiBjb2xvcnNbY29sb3VyLnRvTG93ZXJDYXNlKCldCiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aCgnIycpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21IZXgobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBoZXhDb2xvciA9IGNvbG91ck5hbWVUb0hleChuYW1lKTsKICAgICAgICAgICAgICAgIGlmIChoZXhDb2xvcikKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21IZXgoaGV4Q29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGhleGFkZWNpbWFsIHZhbHVlIG9mIHRoaXMgY29sb3IsIGluY2x1ZGluZyB0aGUgbGVhZGluZyAiIyIgY2hhcmFjdGVyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGhleCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b0hleCgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gY29tcG9uZW50VG9IZXgoYykgewogICAgICAgICAgICAgICAgY29uc3QgaW50ID0gTWF0aC5yb3VuZChjICogMjU1KTsKICAgICAgICAgICAgICAgIGNvbnN0IGhleCA9IGludC50b1N0cmluZygxNik7CiAgICAgICAgICAgICAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PSAxID8gJzAnICsgaGV4IDogaGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnIycgKyBjb21wb25lbnRUb0hleCh0aGlzLnIpICsgY29tcG9uZW50VG9IZXgodGhpcy5nKSArIGNvbXBvbmVudFRvSGV4KHRoaXMuYik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGlzIENvbG9yICBjb250YWlucyB0aGUgc2FtZSB2YWx1ZXMgYXMgdGhlIG90aGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIENvbG9yIHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgdGhlIHNhbWUsIG90aGVyd2lzZSwgYGZhbHNlYC4KICAgICAgICAgKi8KICAgICAgICBpc0VxdWFsKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnIgPT0gb3RoZXIuciAmJiB0aGlzLmcgPT0gb3RoZXIuZyAmJiB0aGlzLmIgPT0gb3RoZXIuYiAmJiB0aGlzLmEgPT0gb3RoZXIuYTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgY29sb3IgaXMgTk9UIGV4YWN0bHkgdGhlIHNhbWUgYXMgb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgY29sb3IgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgbm90RXF1YWxzKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnIgIT0gb3RoZXIuciAmJiB0aGlzLmcgIT0gb3RoZXIuZyAmJiB0aGlzLmIgIT0gb3RoZXIuYiAmJiB0aGlzLmEgIT0gb3RoZXIuYTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgY29sb3IgaXMgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBhcyBvdGhlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBjb2xvciB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHBhcmFtIHByZWNpc2lvbiAtIFRoZSBwcmVjaXNpb24gdG8gd2hpY2ggdGhlIHZhbHVlcyBtdXN0IG1hdGNoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgYXBwcm94RXF1YWwob3RoZXIsIHByZWNpc2lvbiA9IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgIHJldHVybiAoTWF0aC5hYnModGhpcy5yIC0gb3RoZXIucikgPCBwcmVjaXNpb24gJiYKICAgICAgICAgICAgICAgIE1hdGguYWJzKHRoaXMuZyAtIG90aGVyLmcpIDwgcHJlY2lzaW9uICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicyh0aGlzLmIgLSBvdGhlci5iKSA8IHByZWNpc2lvbiAmJgogICAgICAgICAgICAgICAgTWF0aC5hYnModGhpcy5hIC0gb3RoZXIuYSkgPCBwcmVjaXNpb24pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgbmV3IENvbG9yIHdoaWNoIGlzIHRoaXMgQ29sb3IgYWRkZWQgdG8gb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgY29sb3IgdG8gYWRkLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IGNvbG9yLgogICAgICAgICAqLwogICAgICAgIGFkZChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKHRoaXMuciArIG90aGVyLnIsIHRoaXMuZyArIG90aGVyLmcsIHRoaXMuYiArIG90aGVyLmIsIHRoaXMuYSArIG90aGVyLmEpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBVcGRhdGVzIHRoaXMgQ29sb3IgYnkgYWRkaW5nIHRoZSB2YWx1ZXMgZnJvbSB0aGUgb3RoZXIgY29sb3IuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgY29sb3IgdG8gYWRkLgogICAgICAgICAqLwogICAgICAgIGFkZEluUGxhY2Uob3RoZXIpIHsKICAgICAgICAgICAgdGhpcy5yICs9IG90aGVyLnI7CiAgICAgICAgICAgIHRoaXMuZyArPSBvdGhlci5nOwogICAgICAgICAgICB0aGlzLmIgKz0gb3RoZXIuYjsKICAgICAgICAgICAgdGhpcy5hICs9IG90aGVyLmE7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYSBuZXcgY29sb3Igd2hpY2ggaXMgdGhpcyBjb2xvciBzdWJ0cmFjdGVkIGZyb20gb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgY29sb3IgdG8gc3VidHJhY3QuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgY29sb3IuCiAgICAgICAgICovCiAgICAgICAgc3VidHJhY3Qob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcih0aGlzLnIgLSBvdGhlci5yLCB0aGlzLmcgLSBvdGhlci5nLCB0aGlzLmIgLSBvdGhlci5iLCB0aGlzLmEgLSBvdGhlci5hKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2NhbGVzIHRoaXMgY29sb3IgYnkgc2NhbGFyIGFuZCByZXR1cm4gdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWM0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgY29sb3IuCiAgICAgICAgICovCiAgICAgICAgc2NhbGUoc2NhbGFyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IodGhpcy5yICogc2NhbGFyLCB0aGlzLmcgKiBzY2FsYXIsIHRoaXMuYiAqIHNjYWxhciwgdGhpcy5hICogc2NhbGFyKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2NhbGVzIHRoaXMgY29sb3IgYnkgc2NhbGFyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2NhbGVJblBsYWNlKHNjYWxhcikgewogICAgICAgICAgICB0aGlzLnIgKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLmcgKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLmIgKj0gc2NhbGFyOwogICAgICAgICAgICB0aGlzLmEgKj0gc2NhbGFyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBcHBseSBnYW1tYSBjb3JyZWN0aW9uIHRvIHRoaXMgY29sb3IKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBnYW1tYSAtIFRoZSBnYW1tYSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBhcHBseUdhbW1hKGdhbW1hKSB7CiAgICAgICAgICAgIHRoaXMuc2V0KE1hdGgucG93KHRoaXMuciwgZ2FtbWEpLCBNYXRoLnBvdyh0aGlzLmcsIGdhbW1hKSwgTWF0aC5wb3codGhpcy5iLCBnYW1tYSksIHRoaXMuYSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRvIGxpbmVhciBjb2xvciBzcGFjZSBhbmQgcmV0dXJucyBhIG5ldyBjb2xvcgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGdhbW1hIC0gVGhlIGdhbW1hIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IGNvbG9yLgogICAgICAgICAqLwogICAgICAgIHRvTGluZWFyKGdhbW1hID0gMi4yKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IoTWF0aC5wb3codGhpcy5yLCBnYW1tYSksIE1hdGgucG93KHRoaXMuZywgZ2FtbWEpLCBNYXRoLnBvdyh0aGlzLmIsIGdhbW1hKSwgdGhpcy5hKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogcmV0dXJucyBhIG5ldyBjb2xvciB2YWx1ZSB2YWx1ZSBpcyBtYXBwZWQgaW50byBhIGdhbW1hIGN1cnZlCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZ2FtbWEgLSBUaGUgZ2FtbWEgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgY29sb3IuCiAgICAgICAgICovCiAgICAgICAgdG9HYW1tYShnYW1tYSA9IDIuMikgewogICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKE1hdGgucG93KHRoaXMuciwgMS4wIC8gZ2FtbWEpLCBNYXRoLnBvdyh0aGlzLmcsIDEuMCAvIGdhbW1hKSwgTWF0aC5wb3codGhpcy5iLCAxLjAgLyBnYW1tYSksIHRoaXMuYSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgYW5kIHJldHVybnMgdGhlIGx1bWluYW5jZSBvZiB0aGUgbGluZWFyIFJHQiBjb21wb25lbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbHVtaW5hbmNlKCkgewogICAgICAgICAgICByZXR1cm4gMC4yMTI2ICogdGhpcy5yICsgMC43MTUyICogdGhpcy5nICsgMC4wNzIyICogdGhpcy5iOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBQZXJmb3JtcyBhIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdGhpcyBjb2xvciBhbmQgb3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgY29sb3IgdG8gaW50ZXJwb2xhdGUgYmV0d2Vlbi4KICAgICAgICAgKiBAcGFyYW0gdCAtIEludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHR3byBpbnB1dHMuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgY29sb3IuCiAgICAgICAgICovCiAgICAgICAgbGVycChvdGhlciwgdCkgewogICAgICAgICAgICBjb25zdCBhciA9IHRoaXMucjsKICAgICAgICAgICAgY29uc3QgYWcgPSB0aGlzLmc7CiAgICAgICAgICAgIGNvbnN0IGFiID0gdGhpcy5iOwogICAgICAgICAgICBjb25zdCBhYSA9IHRoaXMuYTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihhciArIHQgKiAob3RoZXIuciAtIGFyKSwgYWcgKyB0ICogKG90aGVyLmcgLSBhZyksIGFiICsgdCAqIChvdGhlci5iIC0gYWIpLCBhYSArIHQgKiAob3RoZXIuYSAtIGFhKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSByYW5kb20gY29sb3IuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZ2FtbWFPZmZzZXQgLSBUaGUgZ2FtbWEgb2Zmc2V0LiBWYWx1ZXMgYmV0d2VlbiAwIGFuZCAxIGluY3JlYXNlIHRoZSBhdmVyYWdlIGJyaWdodG5lc3Mgb2YgdGhlIGdlbmVyYXRlZCBjb2xvci4gVmFsdWVzIGJldHdlZW4gMCBhbmQgLTEgZGFya2VuIHRoZSBnZW5lcmF0ZWQgY29sb3IgdmFsdWVzLgogICAgICAgICAqIEBwYXJhbSByYW5kb21BbHBoYSAtIERldGVybWluZXMgd2hldGhlciB0aGUgYWxwaGEgY2hhbm5lbCBpcyByYW5kb20uIElmIG5vdCwgdGhlIGFscGhhIHZhbHVlcyB3aWxsIGJlIDEuMC4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIG5ldyByYW5kb20gY29sb3IuCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIHJhbmRvbShnYW1tYU9mZnNldCA9IDAuMCwgcmFuZG9tQWxwaGEgPSBmYWxzZSkgewogICAgICAgICAgICBpZiAoZ2FtbWFPZmZzZXQgPiAwLjApIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IoZ2FtbWFPZmZzZXQgKyBNYXRoLnJhbmRvbSgpICogKDEuMCAtIGdhbW1hT2Zmc2V0KSwgZ2FtbWFPZmZzZXQgKyBNYXRoLnJhbmRvbSgpICogKDEuMCAtIGdhbW1hT2Zmc2V0KSwgZ2FtbWFPZmZzZXQgKyBNYXRoLnJhbmRvbSgpICogKDEuMCAtIGdhbW1hT2Zmc2V0KSwgcmFuZG9tQWxwaGEgPyBnYW1tYU9mZnNldCArIE1hdGgucmFuZG9tKCkgKiAoMS4wIC0gZ2FtbWFPZmZzZXQpIDogMS4wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZ2FtbWFPZmZzZXQgPCAwLjApIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IoTWF0aC5yYW5kb20oKSAqICgxLjAgKyBnYW1tYU9mZnNldCksIE1hdGgucmFuZG9tKCkgKiAoMS4wICsgZ2FtbWFPZmZzZXQpLCBNYXRoLnJhbmRvbSgpICogKDEuMCArIGdhbW1hT2Zmc2V0KSwgcmFuZG9tQWxwaGEgPyBNYXRoLnJhbmRvbSgpICogKDEuMCArIGdhbW1hT2Zmc2V0KSA6IDEuMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihNYXRoLnJhbmRvbSgpLCBNYXRoLnJhbmRvbSgpLCBNYXRoLnJhbmRvbSgpLCByYW5kb21BbHBoYSA/IE1hdGgucmFuZG9tKCkgOiAxLjApOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDbG9uZXMgdGhpcyBjb2xvciBhbmQgcmV0dXJucyBhIG5ldyBjb2xvci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IGNvbG9yLgogICAgICAgICAqLwogICAgICAgIGNsb25lKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKHRoaXMuX19kYXRhWzBdLCB0aGlzLl9fZGF0YVsxXSwgdGhpcy5fX2RhdGFbMl0sIHRoaXMuX19kYXRhWzNdKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgdHlwZSBhcyBhbiBhcnJheS4gT2Z0ZW4gdXNlZCB0byBwYXNzIHR5cGVzIHRvIHRoZSBHUFUuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhcyBhbiBhcnJheS4KICAgICAgICAgKi8KICAgICAgICBhc0FycmF5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGE7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHR5cGUgYXMgYSAzIGNvbXBvbmVudCBhcnJheS4gT2Z0ZW4gdXNlZCB0byBwYXNzIHR5cGVzIHRvIHRoZSBHUFUuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhcyBhIDMgY29tcG9uZW50IGFycmF5LgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYXMzQ29tcG9uZW50QXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5fX2RhdGFbMF0sIHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXV07CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSB0b0pTT04gbWV0aG9kIGVuY29kZXMgdGhpcyB0eXBlIGFzIGEganNvbiBvYmplY3QgZm9yIHBlcnNpc3RlbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICB0b0pTT04oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICByOiB0aGlzLnIsCiAgICAgICAgICAgICAgICBnOiB0aGlzLmcsCiAgICAgICAgICAgICAgICBiOiB0aGlzLmIsCiAgICAgICAgICAgICAgICBhOiB0aGlzLmEsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBmcm9tSlNPTiBtZXRob2QgZGVjb2RlcyBhIGpzb24gb2JqZWN0IGZvciB0aGlzIHR5cGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaiAtIFRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICBmcm9tSlNPTihqKSB7CiAgICAgICAgICAgIHRoaXMuciA9IGoucjsKICAgICAgICAgICAgdGhpcy5nID0gai5nOwogICAgICAgICAgICB0aGlzLmIgPSBqLmI7CiAgICAgICAgICAgIHRoaXMuYSA9IGouYTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTG9hZHMgdGhlIHN0YXRlIG9mIHRoZSB2YWx1ZSBmcm9tIGEgYmluYXJ5IHJlYWRlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByZWFkZXIgLSBUaGUgcmVhZGVyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHJlYWRCaW5hcnkocmVhZGVyKSB7CiAgICAgICAgICAgIHRoaXMuciA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICB0aGlzLmcgPSByZWFkZXIubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgdGhpcy5iID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgICAgIHRoaXMuYSA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBDU1MgcmdiYSBzdHJpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b0NTU1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuICgncmdiYSgnICsKICAgICAgICAgICAgICAgIE1hdGgucm91bmQodGhpcy5yICogMjU1KSArCiAgICAgICAgICAgICAgICAnLCAnICsKICAgICAgICAgICAgICAgIE1hdGgucm91bmQodGhpcy5nICogMjU1KSArCiAgICAgICAgICAgICAgICAnLCAnICsKICAgICAgICAgICAgICAgIE1hdGgucm91bmQodGhpcy5iICogMjU1KSArCiAgICAgICAgICAgICAgICAnLCAnICsKICAgICAgICAgICAgICAgIHRoaXMuYSArCiAgICAgICAgICAgICAgICAnKScpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyBldWxlciBhbmdsZXMuIEV1bGVyIGFuZ2xlcyBkZXNjcmliZSByb3RhdGluZyBhbiBvYmplY3QKICAgICAqIGFyb3VuZCBpdHMgdmFyaW91cyBheGlzIGluIGEgc3BlY2lmaWVkIGF4aXMgb3JkZXIuCiAgICAgKgogICAgICovCiAgICBjbGFzcyBFdWxlckFuZ2xlcyB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlIGEgZXVsZXIgYW5nbGUuIFJlY2VpdmVzIHRoZSB4eXogdmFsdWVzIGluIHJhZGlhbnMgYW5kIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAgICAgICoKICAgICAgICAgKiBPcmRlciBwYXJhbWV0ZXIgdmFsdWVzOiBgWFlaOiAwYCwgYFlaWDogMWAsIGBaWFk6IDJgLCBgWFpZOiAzYCwgYFpZWDogNGAsIGBZWFo6IDVgCiAgICAgICAgICoKICAgICAgICAgKiBJdCBjb3VsZCBiZSBlaXRoZXIgdGhlIGBzdHJpbmdgIG9yIHRoZSBgbnVtYmVyYCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB4IC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gZGVncmVlcy4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSB5IC0gVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMgaW4gZGVncmVlcy4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSB6IC0gVGhlIGFuZ2xlIG9mIHRoZSB6IGF4aXMgaW4gZGVncmVlcy4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSBvcmRlciAtIFRoZSBvcmRlciBpbiB3aGljaCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDAsIG9yZGVyID0gMCkgewogICAgICAgICAgICBpZiAodHlwZW9mIG9yZGVyID09PSAnbnVtYmVyJyAmJiAhaXNOYU4ob3JkZXIpKQogICAgICAgICAgICAgICAgdGhpcy5vcmRlciA9IG9yZGVyOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdYWVonOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9yZGVyID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnWVpYJzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmRlciA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ1pYWSc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JkZXIgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdYWlknOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9yZGVyID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnWllYJzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmRlciA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ1lYWic6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JkZXIgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgRXVsZXIgQW5nbGVzIE9yZGVyOicgKyBvcmRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHggaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0geDsKICAgICAgICAgICAgICAgIGNvbnN0IGJ5dGVPZmZzZXQgPSB5OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgNCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHo7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciB4IGF4aXMgcm90YXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgeCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqLwogICAgICAgIGdldCB4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgeCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHgodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHkgYXhpcyByb3RhdGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB5IGF4aXMgcm90YXRpb24uCiAgICAgICAgICovCiAgICAgICAgZ2V0IHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciB5IGF4aXMgcm90YXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgeSh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgeiBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHogYXhpcyByb3RhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBnZXQgeigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzJdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHogYXhpcyByb3RhdGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCB6KHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgRXVsZXJBbmdsZXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB4IC0gVGhlIHggYXhpcyByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgICAgICAqIEBwYXJhbSB5IC0gVGhlIHkgYXhpcyByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgICAgICAqIEBwYXJhbSB6IC0gVGhlIHogYXhpcyByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgICAgICAqLwogICAgICAgIHNldCh4LCB5LCB6KSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0geDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB5OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHo7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgdGhpcyBWZWMzIHRvIGEgc3RyaW5nIGluIEpTT04gZm9ybWF0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuZXctY2FwCiAgICAgICAgICAgIHJldHVybiBTdHJpbmdGdW5jdGlvbnMuc3RyaW5naWZ5SlNPTldpdGhGaXhlZFByZWNpc2lvbih0aGlzLnRvSlNPTigpKTsKICAgICAgICB9CiAgICAgICAgdG9KU09OKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgeDogdGhpcy5fX2RhdGFbMF0sCiAgICAgICAgICAgICAgICB5OiB0aGlzLl9fZGF0YVsxXSwKICAgICAgICAgICAgICAgIHo6IHRoaXMuX19kYXRhWzJdLAogICAgICAgICAgICAgICAgb3JkZXI6IHRoaXMub3JkZXIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZyb21KU09OKGpzb24pIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSBqc29uLng7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0ganNvbi55OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IGpzb24uejsKICAgICAgICAgICAgdGhpcy5vcmRlciA9IGpzb24ub3JkZXI7CiAgICAgICAgfQogICAgfQoKICAgIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICAgIC8qKgogICAgICogQSBjbGFzcyByZXByZXNlbnRpbmcgYSAzeDMgbWF0cml4LgogICAgICogVGhpcyBtYXRyaXggY2xhc3MgaXMgYmFzZWQgb24gR0xNLCBhbmQgaXMgY29sdW1uIG1ham9yLgogICAgICoKICAgICAqLwogICAgY2xhc3MgTWF0MyB7CiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdGhlIE1hdDMgY2xhc3Mgd2l0aCBnaXZlbiBkYXRhLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG0wMCAtIFJvdyAwLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcGFyYW0gbTAxIC0gUm93IDAsIGNvbHVtbiAxLgogICAgICAgICAqIEBwYXJhbSBtMDIgLSBSb3cgMCwgY29sdW1uIDIuCiAgICAgICAgICogQHBhcmFtIG0xMCAtIFJvdyAxLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcGFyYW0gbTExIC0gUm93IDEsIGNvbHVtbiAxLgogICAgICAgICAqIEBwYXJhbSBtMTIgLSBSb3cgMSwgY29sdW1uIDIuCiAgICAgICAgICogQHBhcmFtIG0yMCAtIFJvdyAyLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcGFyYW0gbTIxIC0gUm93IDIsIGNvbHVtbiAxLgogICAgICAgICAqIEBwYXJhbSBtMjIgLSBSb3cgMiwgY29sdW1uIDIuCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IobTAwID0gMSwgbTAxID0gMCwgbTAyID0gMCwgbTEwID0gMCwgbTExID0gMSwgbTEyID0gMCwgbTIwID0gMCwgbTIxID0gMCwgbTIyID0gMSkgewogICAgICAgICAgICBpZiAobTAwIGluc3RhbmNlb2YgVmVjMyAmJiBtMDEgaW5zdGFuY2VvZiBWZWMzICYmIG0wMiBpbnN0YW5jZW9mIFZlYzMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSg5KTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KG0wMC54LCBtMDAueSwgbTAwLnosIG0wMS54LCBtMDEueSwgbTAxLnosIG0wMi54LCBtMDIueSwgbTAyLnopOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKG0wMCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSkgewogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBtMDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobTAwIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBuZXcgVmVjMyhuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgOSkpYCk7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPSBtMDA7CiAgICAgICAgICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gbTAxOwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgOSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoOSk7CiAgICAgICAgICAgICAgICB0aGlzLnNldChtMDAsIG0wMSwgbTAyLCBtMTAsIG0xMSwgbTEyLCBtMjAsIG0yMSwgbTIyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIHByb3BlcnRpZXMKICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAwLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTAwIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMDAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVswXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMCwgY29sdW1uIDAuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTAwKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMCwgY29sdW1uIDEuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTAxIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMDEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMCwgY29sdW1uIDEuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTAxKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMCwgY29sdW1uIDIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTAyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMDIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsyXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMCwgY29sdW1uIDIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTAyKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMSwgY29sdW1uIDAuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTEwIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMTAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVszXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMSwgY29sdW1uIDAuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTEwKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVszXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMSwgY29sdW1uIDEKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMTEgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0xMSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzRdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAxLCBjb2x1bW4gMS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMTEodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzRdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAxLCBjb2x1bW4gMi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMTIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0xMigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzVdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAxLCBjb2x1bW4gMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMTIodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzVdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMjAgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0yMCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzZdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMjAodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzZdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMjEgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0yMSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzddOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMjEodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzddID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMjIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0yMigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzhdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMjIodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzhdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHRoZSBgeGAgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBgeGAgYXhpcyBhcyBhIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHhBeGlzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMobmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YS5idWZmZXIsIDAsIDMpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciB0aGUgYHhgIGF4aXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjMyAtIFRoZSB2ZWMzIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldCB4QXhpcyh2ZWMzKSB7CiAgICAgICAgICAgIHRoaXMueEF4aXMuc2V0KHZlYzMueCwgdmVjMy55LCB2ZWMzLnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHRoZSBgeWAgYXhpcy4KICAgICAgICAgKiAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBgeWAgYXhpcyBhcyBhIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHlBeGlzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMobmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YS5idWZmZXIsIDMgKiA0LCAzKSk7IC8vIDQgYnl0ZXMgcGVyIDMyYml0IGZsb2F0CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgdGhlIGB5YCBheGlzLgogICAgICAgICAqIEBwYXJhbSB2ZWMzIC0gVGhlIHZlYzMgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0IHlBeGlzKHZlYzMpIHsKICAgICAgICAgICAgdGhpcy55QXhpcy5zZXQodmVjMy54LCB2ZWMzLnksIHZlYzMueik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgdGhlIGB6YCBheGlzLgogICAgICAgICAqICogQHJldHVybiAtIFJldHVybnMgdGhlIGB6YCBheGlzIGFzIGEgVmVjMy4KICAgICAgICAgKi8KICAgICAgICBnZXQgekF4aXMoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyhuZXcgRmxvYXQzMkFycmF5KHRoaXMuX19kYXRhLmJ1ZmZlciwgNiAqIDQsIDMpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciB0aGUgYHpgIGF4aXMuCiAgICAgICAgICogQHBhcmFtIHZlYzMgLSBUaGUgdmVjMyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXQgekF4aXModmVjMykgewogICAgICAgICAgICB0aGlzLnpBeGlzLnNldCh2ZWMzLngsIHZlYzMueSwgdmVjMy56KTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBTZXR0ZXJzCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgc3RhdGUgb2YgdGhlIE1hdDMgY2xhc3MKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtMDAgLSBSb3cgMCwgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0wMSAtIFJvdyAwLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTAyIC0gUm93IDAsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMTAgLSBSb3cgMSwgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0xMSAtIFJvdyAxLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTEyIC0gUm93IDEsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMjAgLSBSb3cgMiwgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0yMSAtIFJvdyAyLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTIyIC0gUm93IDIsIGNvbHVtbiAyLgogICAgICAgICAqLwogICAgICAgIHNldChtMDAgPSAxLCBtMDEgPSAwLCBtMDIgPSAwLCBtMTAgPSAwLCBtMTEgPSAxLCBtMTIgPSAwLCBtMjAgPSAwLCBtMjEgPSAwLCBtMjIgPSAxKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gbTAwOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IG0wMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSBtMDI7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gbTEwOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs0XSA9IG0xMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNV0gPSBtMTI7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzZdID0gbTIwOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs3XSA9IG0yMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOF0gPSBtMjI7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgc3RhdGUgb2YgdGhlIE1hdDMgd2l0aCB0aGUgaWRlbnRpdHkgIE1hdHJpeAogICAgICAgICAqLwogICAgICAgIHNldElkZW50aXR5KCkgewogICAgICAgICAgICB0aGlzLnNldCgpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHN0YXRlIG9mIHRoZSBNYXQzIGZyb20gYW5vdGhlciBNYXQzCiAgICAgICAgICoKICAgICAgICAgKiBOb3RlOiB3b3JrcyB3aXRoIGVpdGhlciBNYXQzIG9yIE1hdDQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbWF0IC0gVGhlIG1hdCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tTWF0KG1hdCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVswXSA9IG1hdC5tMDA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gbWF0Lm0wMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSBtYXQubTAyOwogICAgICAgICAgICB0aGlzLl9fZGF0YVszXSA9IG1hdC5tMTA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzRdID0gbWF0Lm0xMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNV0gPSBtYXQubTEyOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs2XSA9IG1hdC5tMjA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzddID0gbWF0Lm0yMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOF0gPSBtYXQubTIyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTY2FsZXMgYW5kIGNhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIGBWZWMzYCBhbmQgc2V0cyB0aGUgcmVzdWx0IGluIHRoZSBNYXQzCiAgICAgICAgICogTm90ZTogdGhlIHJlc3VsdGluZyBtYXRyaXggK1ogYXhpcyBpcyBhbGlnbmVkIHdpdGggdGhlIHByb3ZpZGVkIGRpcmVjdGlvbiB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBkaXIgLSBUaGUgZGlyIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSB1cCAtIFRoZSB1cCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IoZGlyLCB1cCkgewogICAgICAgICAgICBjb25zdCB6QXhpcyA9IGRpcjsKICAgICAgICAgICAgY29uc3QgekxlbiA9IHpBeGlzLmxlbmd0aCgpOwogICAgICAgICAgICBpZiAoekxlbiA8IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElkZW50aXR5KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgekF4aXMuc2NhbGVJblBsYWNlKDEgLyB6TGVuKTsKICAgICAgICAgICAgY29uc3QgeEF4aXMgPSB1cC5jcm9zcyh6QXhpcyk7CiAgICAgICAgICAgIGNvbnN0IHhMZW4gPSB4QXhpcy5sZW5ndGgoKTsKICAgICAgICAgICAgaWYgKHhMZW4gPiBOdW1iZXIuRVBTSUxPTikKICAgICAgICAgICAgICAgIHhBeGlzLnNjYWxlSW5QbGFjZSgxIC8geExlbik7CiAgICAgICAgICAgIGNvbnN0IHlBeGlzID0gekF4aXMuY3Jvc3MoeEF4aXMpOwogICAgICAgICAgICBjb25zdCB5TGVuID0geUF4aXMubGVuZ3RoKCk7CiAgICAgICAgICAgIGlmICh5TGVuID4gTnVtYmVyLkVQU0lMT04pCiAgICAgICAgICAgICAgICB5QXhpcy5zY2FsZUluUGxhY2UoMSAvIHlMZW4pOwogICAgICAgICAgICB0aGlzLnNldCh4QXhpcy54LCB4QXhpcy55LCB4QXhpcy56LCB5QXhpcy54LCB5QXhpcy55LCB5QXhpcy56LCB6QXhpcy54LCB6QXhpcy55LCB6QXhpcy56KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogSW52ZXJ0cyBhIE1hdDMgYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBpbnN0YW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IE1hdDMuCiAgICAgICAgICovCiAgICAgICAgaW52ZXJzZSgpIHsKICAgICAgICAgICAgY29uc3QgYTAwID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTEwID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMSA9IHRoaXMuX19kYXRhWzRdOwogICAgICAgICAgICBjb25zdCBhMTIgPSB0aGlzLl9fZGF0YVs1XTsKICAgICAgICAgICAgY29uc3QgYTIwID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGEyMSA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjIgPSB0aGlzLl9fZGF0YVs4XTsKICAgICAgICAgICAgY29uc3QgYjAxID0gYTIyICogYTExIC0gYTEyICogYTIxOwogICAgICAgICAgICBjb25zdCBiMTEgPSAtYTIyICogYTEwICsgYTEyICogYTIwOwogICAgICAgICAgICBjb25zdCBiMjEgPSBhMjEgKiBhMTAgLSBhMTEgKiBhMjA7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnQKICAgICAgICAgICAgbGV0IGRldCA9IGEwMCAqIGIwMSArIGEwMSAqIGIxMSArIGEwMiAqIGIyMTsKICAgICAgICAgICAgaWYgKCFkZXQpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGludmVydCBNYXQzJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1hdDMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWF0MyhiMDEgKiBkZXQsICgtYTIyICogYTAxICsgYTAyICogYTIxKSAqIGRldCwgKGExMiAqIGEwMSAtIGEwMiAqIGExMSkgKiBkZXQsIGIxMSAqIGRldCwgKGEyMiAqIGEwMCAtIGEwMiAqIGEyMCkgKiBkZXQsICgtYTEyICogYTAwICsgYTAyICogYTEwKSAqIGRldCwgYjIxICogZGV0LCAoLWEyMSAqIGEwMCArIGEwMSAqIGEyMCkgKiBkZXQsIChhMTEgKiBhMDAgLSBhMDEgKiBhMTApICogZGV0KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogSW52ZXJ0cyBhIE1hdDMgaW4gcGxhY2UgbW9kaWZ5aW5nIGl0cyB2YWx1ZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBpbnZlcnRJblBsYWNlKCkgewogICAgICAgICAgICBjb25zdCBhMDAgPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgYTAxID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IGEwMiA9IHRoaXMuX19kYXRhWzJdOwogICAgICAgICAgICBjb25zdCBhMTAgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgY29uc3QgYTExID0gdGhpcy5fX2RhdGFbNF07CiAgICAgICAgICAgIGNvbnN0IGExMiA9IHRoaXMuX19kYXRhWzVdOwogICAgICAgICAgICBjb25zdCBhMjAgPSB0aGlzLl9fZGF0YVs2XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gdGhpcy5fX2RhdGFbN107CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IHRoaXMuX19kYXRhWzhdOwogICAgICAgICAgICBjb25zdCBiMDEgPSBhMjIgKiBhMTEgLSBhMTIgKiBhMjE7CiAgICAgICAgICAgIGNvbnN0IGIxMSA9IC1hMjIgKiBhMTAgKyBhMTIgKiBhMjA7CiAgICAgICAgICAgIGNvbnN0IGIyMSA9IGEyMSAqIGExMCAtIGExMSAqIGEyMDsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBkZXRlcm1pbmFudAogICAgICAgICAgICBsZXQgZGV0ID0gYTAwICogYjAxICsgYTAxICogYjExICsgYTAyICogYjIxOwogICAgICAgICAgICBpZiAoIWRldCkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdVbmFibGUgdG8gaW52ZXJ0IE1hdDMnKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7CiAgICAgICAgICAgIHRoaXMuc2V0KGIwMSAqIGRldCwgKC1hMjIgKiBhMDEgKyBhMDIgKiBhMjEpICogZGV0LCAoYTEyICogYTAxIC0gYTAyICogYTExKSAqIGRldCwgYjExICogZGV0LCAoYTIyICogYTAwIC0gYTAyICogYTIwKSAqIGRldCwgKC1hMTIgKiBhMDAgKyBhMDIgKiBhMTApICogZGV0LCBiMjEgKiBkZXQsICgtYTIxICogYTAwICsgYTAxICogYTIwKSAqIGRldCwgKGExMSAqIGEwMCAtIGEwMSAqIGExMCkgKiBkZXQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNwb3NlcyAoZXhjaGFuZ2VzIGNvbHVtbnMgd2l0aCByb3dzKSB0aGlzIG1hdHJpeAogICAgICAgICAqIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgaW5zdGFuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJuIGEgbmV3IHRyYW5zcG9zZWQgTWF0My4KICAgICAgICAgKi8KICAgICAgICB0cmFuc3Bvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWF0Myh0aGlzLl9fZGF0YVswXSwgdGhpcy5fX2RhdGFbM10sIHRoaXMuX19kYXRhWzZdLCB0aGlzLl9fZGF0YVsxXSwgdGhpcy5fX2RhdGFbNF0sIHRoaXMuX19kYXRhWzddLCB0aGlzLl9fZGF0YVsyXSwgdGhpcy5fX2RhdGFbNV0sIHRoaXMuX19kYXRhWzhdKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNwb3NlcyAoZXhjaGFuZ2VzIGNvbHVtbnMgd2l0aCByb3dzKSB0aGlzIG1hdHJpeCBtb2RpZnlpbmcgaXRzIHZhbHVlcy4KICAgICAgICAgKi8KICAgICAgICB0cmFuc3Bvc2VJblBsYWNlKCkgewogICAgICAgICAgICAvLyBJZiB3ZSBhcmUgdHJhbnNwb3Npbmcgb3Vyc2VsdmVzIHdlIGNhbiBza2lwIGEgZmV3IHN0ZXBzIGJ1dCBoYXZlIHRvIGNhY2hlIHNvbWUgdmFsdWVzCiAgICAgICAgICAgIGNvbnN0IGEwMSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTEyID0gdGhpcy5fX2RhdGFbNV07CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gYTAxOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs1XSA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs2XSA9IGEwMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbN10gPSBhMTI7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRyYW5zZm9ybXMgdGhlIFZlYzMgd2l0aCBhIE1hdDMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjMyAtIFRoZSB2ZWMzIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm4gdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIHRyYW5zZm9ybVZlYzModmVjMykgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy5fX2RhdGFbMF0gKiB2ZWMzLnggKyB0aGlzLl9fZGF0YVsxXSAqIHZlYzMueSArIHRoaXMuX19kYXRhWzJdICogdmVjMy56LCB0aGlzLl9fZGF0YVszXSAqIHZlYzMueCArIHRoaXMuX19kYXRhWzRdICogdmVjMy55ICsgdGhpcy5fX2RhdGFbNV0gKiB2ZWMzLnosIHRoaXMuX19kYXRhWzZdICogdmVjMy54ICsgdGhpcy5fX2RhdGFbN10gKiB2ZWMzLnkgKyB0aGlzLl9fZGF0YVs4XSAqIHZlYzMueik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENsb25lcyB0aGlzIE1hdDMgcmV0dXJuaW5nIGEgbmV3IGluc3RhbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgTWF0My4KICAgICAgICAgKi8KICAgICAgICBjbG9uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXQzKHRoaXMuX19kYXRhWzBdLCB0aGlzLl9fZGF0YVsxXSwgdGhpcy5fX2RhdGFbMl0sIHRoaXMuX19kYXRhWzNdLCB0aGlzLl9fZGF0YVs0XSwgdGhpcy5fX2RhdGFbNV0sIHRoaXMuX19kYXRhWzZdLCB0aGlzLl9fZGF0YVs3XSwgdGhpcy5fX2RhdGFbOF0pOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIExvYWRzIHRoZSBzdGF0ZSBvZiB0aGUgdmFsdWUgZnJvbSBhIGJpbmFyeSByZWFkZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmVhZGVyIC0gVGhlIHJlYWRlciB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9fZGF0YSA9IHJlYWRlci5sb2FkRmxvYXQzMkFycmF5KDkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgdG9KU09OIG1ldGhvZCBlbmNvZGVzIHRoaXMgdHlwZSBhcyBhIGpzb24gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKiBAcmV0dXJuIHtGbG9hdDMyQXJyYXl9IC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZnJvbUpTT04gbWV0aG9kIGRlY29kZXMgYSBqc29uIG9iamVjdCBmb3IgdGhpcyB0eXBlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGpzb24gLSBUaGUganNvbiBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheShqc29uKTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gRGVidWdnaW5nCiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgdGhpcyBWZWMzIHRvIGEgc3RyaW5nIGluIEpTT04gZm9ybWF0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuZXctY2FwCiAgICAgICAgICAgIHJldHVybiBTdHJpbmdGdW5jdGlvbnMuc3RyaW5naWZ5SlNPTldpdGhGaXhlZFByZWNpc2lvbih0aGlzLnRvSlNPTigpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBjdXJyZW50IE1hdGggdHlwZSBkYXRhIGFzIGFycmF5LiBPZnRlbiB1c2VkIHRvIHBhc3MgdHlwZXMgdG8gdGhlIEdQVS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSByZXN1bHQgYXMgYW4gYXJyYXkuCiAgICAgICAgICovCiAgICAgICAgYXNBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEgY2xhc3MgcmVwcmVzZW50aW5nIGEgNHg0IG1hdHJpeC4KICAgICAqIFRoaXMgbWF0cml4IGNsYXNzIGlzIGJhc2VkIG9uIEdMTSwgYW5kIGlzIGNvbHVtbiBtYWpvci4KICAgICAqCiAgICAgKi8KICAgIGNsYXNzIE1hdDQgewogICAgICAgIC8qKgogICAgICAgICAqIEluaXRpYWxpemVzIHRoZSBNYXQzIGNsYXNzIHdpdGggZ2l2ZW4gZGF0YS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtMDAgLSBSb3cgMCwgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0wMSAtIFJvdyAwLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTAyIC0gUm93IDAsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMDMgLSBSb3cgMCwgY29sdW1uIDMuCiAgICAgICAgICogQHBhcmFtIG0xMCAtIFJvdyAxLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcGFyYW0gbTExIC0gUm93IDEsIGNvbHVtbiAxLgogICAgICAgICAqIEBwYXJhbSBtMTIgLSBSb3cgMSwgY29sdW1uIDIuCiAgICAgICAgICogQHBhcmFtIG0xMyAtIFJvdyAxLCBjb2x1bW4gMy4KICAgICAgICAgKiBAcGFyYW0gbTIwIC0gUm93IDIsIGNvbHVtbiAwLgogICAgICAgICAqIEBwYXJhbSBtMjEgLSBSb3cgMiwgY29sdW1uIDEuCiAgICAgICAgICogQHBhcmFtIG0yMiAtIFJvdyAyLCBjb2x1bW4gMi4KICAgICAgICAgKiBAcGFyYW0gbTIzIC0gUm93IDIsIGNvbHVtbiAzLgogICAgICAgICAqIEBwYXJhbSBtMzAgLSBSb3cgMywgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0zMSAtIFJvdyAzLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTMyIC0gUm93IDMsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMzMgLSBSb3cgMywgY29sdW1uIDMuCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IobTAwID0gMSwgbTAxID0gMCwgbTAyID0gMCwgbTAzID0gMCwgbTEwID0gMCwgbTExID0gMSwgbTEyID0gMCwgbTEzID0gMCwgbTIwID0gMCwgbTIxID0gMCwgbTIyID0gMSwgbTIzID0gMCwgbTMwID0gMCwgbTMxID0gMCwgbTMyID0gMCwgbTMzID0gMSkgewogICAgICAgICAgICBpZiAobTAwIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG0wMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChtMDAgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gbTAwOwogICAgICAgICAgICAgICAgY29uc3QgYnl0ZU9mZnNldCA9IG0wMTsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheShidWZmZXIsIGJ5dGVPZmZzZXQsIDE2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgICAgICB0aGlzLnNldChtMDAsIG0wMSwgbTAyLCBtMDMsIG0xMCwgbTExLCBtMTIsIG0xMywgbTIwLCBtMjEsIG0yMiwgbTIzLCBtMzAsIG0zMSwgbTMyLCBtMzMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gcHJvcGVydGllcwogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDAsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0wMCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTAwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDAsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0wMCh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDAsIGNvbHVtbiAxLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0wMSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTAxKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDAsIGNvbHVtbiAxLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0wMSh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDAsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0wMiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTAyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDAsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0wMih2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDAsIGNvbHVtbiAzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0wMyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTAzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbM107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDAsIGNvbHVtbiAzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0wMyh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDEsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0xMCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTEwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbNF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDEsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0xMCh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNF0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDEsIGNvbHVtbiAxLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0xMSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTExKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbNV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDEsIGNvbHVtbiAxLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0xMSh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDEsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0xMiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTEyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDEsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0xMih2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNl0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDEsIGNvbHVtbiAzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0xMyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTEzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbN107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDEsIGNvbHVtbiAzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0xMyh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbN10gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDIsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0yMCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTIwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbOF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDIsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0yMCh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOF0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDIsIGNvbHVtbiAxLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0yMSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTIxKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbOV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDIsIGNvbHVtbiAxCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTIxKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVs5XSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMiwgY29sdW1uIDIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTIyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMjIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxMF07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDIsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0yMih2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTBdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAyLCBjb2x1bW4gMy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMjMgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0yMygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzExXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMiwgY29sdW1uIDMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTIzKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsxMV0gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDMsIGNvbHVtbiAwCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTMwIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMzAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxMl07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDMsIGNvbHVtbiAwLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0zMCh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTJdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHJvdyAzLCBjb2x1bW4gMS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtMzEgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG0zMSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzEzXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciByb3cgMywgY29sdW1uIDEuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmFsIC0gVGhlIHZhbCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZXQgbTMxKHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVsxM10gPSB2YWw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3Igcm93IDMsIGNvbHVtbiAyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG0zMiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbTMyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbMTRdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHJvdyAzLCBjb2x1bW4gMi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCBtMzIodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzE0XSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciByb3cgMywgY29sdW1uIDMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbTMzIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCBtMzMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YVsxNV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3Igcm93IDMsIGNvbHVtbiAzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IG0zMyh2YWwpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTVdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHRoZSBgeGAgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBgeGAgYXhpcyBhcyBhIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHhBeGlzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMobmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YS5idWZmZXIsIDAsIDMpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciB0aGUgYHhgIGF4aXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjMyAtIFRoZSB2ZWMzIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldCB4QXhpcyh2ZWMzKSB7CiAgICAgICAgICAgIHRoaXMueEF4aXMuc2V0KHZlYzMueCwgdmVjMy55LCB2ZWMzLnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHRoZSBgeWAgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBgeWAgYXhpcyBhcyBhIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZ2V0IHlBeGlzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMobmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YS5idWZmZXIsIDQgKiA0LCAzKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgdGhlIGB5YCBheGlzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZlYzMgLSBUaGUgdmVjMyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXQgeUF4aXModmVjMykgewogICAgICAgICAgICB0aGlzLnlBeGlzLnNldCh2ZWMzLngsIHZlYzMueSwgdmVjMy56KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0dGVyIGZvciB0aGUgYHpgIGF4aXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgYHpgIGF4aXMgYXMgYSBWZWMzLgogICAgICAgICAqLwogICAgICAgIGdldCB6QXhpcygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKG5ldyBGbG9hdDMyQXJyYXkodGhpcy5fX2RhdGEuYnVmZmVyLCA4ICogNCwgMykpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIHRoZSBgemAgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2ZWMzIC0gVGhlIHZlYzMgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0IHpBeGlzKHZlYzMpIHsKICAgICAgICAgICAgdGhpcy56QXhpcy5zZXQodmVjMy54LCB2ZWMzLnksIHZlYzMueik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZSBtYXRyaXguIEFzc3VtZXMgdGhlIHRyYW5zbGF0aW9uIHZhbHVlcyBhcmUgMTIsIDEzLCAmIDE0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHRyYW5zbGF0aW9uLgogICAgICAgICAqLwogICAgICAgIGdldCB0cmFuc2xhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKG5ldyBGbG9hdDMyQXJyYXkodGhpcy5fX2RhdGEuYnVmZmVyLCAxMiAqIDQsIDMpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZvciB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIG1hdHJpeC4gQXNzdW1lcyB0aGUgdHJhbnNsYXRpb24gdmFsdWVzIGFyZSAxMiwgMTMsICYgMTQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjMyAtIFRoZSB0cmFuc2xhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBzZXQgdHJhbnNsYXRpb24odmVjMykgewogICAgICAgICAgICB0aGlzLnRyYW5zbGF0aW9uLnNldCh2ZWMzLngsIHZlYzMueSwgdmVjMy56KTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBTZXR0ZXJzCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgc3RhdGUgb2YgdGhlIE1hdDQgY2xhc3MKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtMDAgLSBSb3cgMCwgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0wMSAtIFJvdyAwLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTAyIC0gUm93IDAsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMDMgLSBSb3cgMCwgY29sdW1uIDMuCiAgICAgICAgICogQHBhcmFtIG0xMCAtIFJvdyAxLCBjb2x1bW4gMC4KICAgICAgICAgKiBAcGFyYW0gbTExIC0gUm93IDEsIGNvbHVtbiAxLgogICAgICAgICAqIEBwYXJhbSBtMTIgLSBSb3cgMSwgY29sdW1uIDIuCiAgICAgICAgICogQHBhcmFtIG0xMyAtIFJvdyAxLCBjb2x1bW4gMy4KICAgICAgICAgKiBAcGFyYW0gbTIwIC0gUm93IDIsIGNvbHVtbiAwLgogICAgICAgICAqIEBwYXJhbSBtMjEgLSBSb3cgMiwgY29sdW1uIDEuCiAgICAgICAgICogQHBhcmFtIG0yMiAtIFJvdyAyLCBjb2x1bW4gMi4KICAgICAgICAgKiBAcGFyYW0gbTIzIC0gUm93IDIsIGNvbHVtbiAzLgogICAgICAgICAqIEBwYXJhbSBtMzAgLSBSb3cgMywgY29sdW1uIDAuCiAgICAgICAgICogQHBhcmFtIG0zMSAtIFJvdyAzLCBjb2x1bW4gMS4KICAgICAgICAgKiBAcGFyYW0gbTMyIC0gUm93IDMsIGNvbHVtbiAyLgogICAgICAgICAqIEBwYXJhbSBtMzMgLSBSb3cgMywgY29sdW1uIDMuCiAgICAgICAgICovCiAgICAgICAgc2V0KG0wMCA9IDEsIG0wMSA9IDAsIG0wMiA9IDAsIG0wMyA9IDAsIG0xMCA9IDAsIG0xMSA9IDEsIG0xMiA9IDAsIG0xMyA9IDAsIG0yMCA9IDAsIG0yMSA9IDAsIG0yMiA9IDEsIG0yMyA9IDAsIG0zMCA9IDAsIG0zMSA9IDAsIG0zMiA9IDAsIG0zMyA9IDEpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSBtMDA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gbTAxOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IG0wMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSBtMDM7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzRdID0gbTEwOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs1XSA9IG0xMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNl0gPSBtMTI7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzddID0gbTEzOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs4XSA9IG0yMDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOV0gPSBtMjE7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzEwXSA9IG0yMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTFdID0gbTIzOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxMl0gPSBtMzA7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzEzXSA9IG0zMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTRdID0gbTMyOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxNV0gPSBtMzM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgc3RhdGUgb2YgdGhlIE1hdDQgd2l0aCB0aGUgaWRlbnRpdHkgIE1hdHJpeAogICAgICAgICAqLwogICAgICAgIHNldElkZW50aXR5KCkgewogICAgICAgICAgICB0aGlzLnNldCgpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBzdGF0ZSBvZiB0aGUgTWF0NCBPYmplY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZmxvYXQzMkFycmF5IC0gVGhlIGZsb2F0MzJBcnJheSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXREYXRhQXJyYXkoZmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhID0gZmxvYXQzMkFycmF5OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHN0YXRlIG9mIHRoZSBNYXQ0IGZyb20gYW5vdGhlciBNYXQ0CiAgICAgICAgICoKICAgICAgICAgKiBOb3RlOiB3b3JrcyB3aXRoIGVpdGhlciBNYXQzIG9yIE1hdDQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbWF0NCAtIFRoZSBtYXQ0IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldEZyb21NYXQ0KG1hdDQpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSBtYXQ0Lm0wMDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSBtYXQ0Lm0wMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSBtYXQ0Lm0wMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSBtYXQ0Lm0wMzsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNF0gPSBtYXQ0Lm0xMDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNV0gPSBtYXQ0Lm0xMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNl0gPSBtYXQ0Lm0xMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbN10gPSBtYXQ0Lm0xMzsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOF0gPSBtYXQ0Lm0yMDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbOV0gPSBtYXQ0Lm0yMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTBdID0gbWF0NC5tMjI7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzExXSA9IG1hdDQubTIzOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxMl0gPSBtYXQ0Lm0zMDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTNdID0gbWF0NC5tMzE7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzE0XSA9IG1hdDQubTMyOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxNV0gPSBtYXQ0Lm0zMzsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgYSBNYXQ0IHRvIGEgTWF0My4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IE1hdDMuCiAgICAgICAgICovCiAgICAgICAgdG9NYXQzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1hdDModGhpcy5fX2RhdGFbMF0sIHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXSwgdGhpcy5fX2RhdGFbNF0sIHRoaXMuX19kYXRhWzVdLCB0aGlzLl9fZGF0YVs2XSwgdGhpcy5fX2RhdGFbOF0sIHRoaXMuX19kYXRhWzldLCB0aGlzLl9fZGF0YVsxMF0pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc3Bvc2VzIChleGNoYW5nZXMgY29sdW1ucyB3aXRoIHJvd3MpIHRoaXMgbWF0cml4LgogICAgICAgICAqLwogICAgICAgIHRyYW5zcG9zZUluUGxhY2UoKSB7CiAgICAgICAgICAgIC8vIElmIHdlIGFyZSB0cmFuc3Bvc2luZyBvdXJzZWx2ZXMgd2UgY2FuIHNraXAgYSBmZXcgc3RlcHMgYnV0IGhhdmUgdG8gY2FjaGUgc29tZSB2YWx1ZXMKICAgICAgICAgICAgY29uc3QgYTAxID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IGEwMiA9IHRoaXMuX19kYXRhWzJdOwogICAgICAgICAgICBjb25zdCBhMDMgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgY29uc3QgYTEyID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjMgPSB0aGlzLl9fZGF0YVsxMV07CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gdGhpcy5fX2RhdGFbNF07CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gdGhpcy5fX2RhdGFbOF07CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdGhpcy5fX2RhdGFbMTJdOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs0XSA9IGEwMTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbNl0gPSB0aGlzLl9fZGF0YVs5XTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbN10gPSB0aGlzLl9fZGF0YVsxM107CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzhdID0gYTAyOwogICAgICAgICAgICB0aGlzLl9fZGF0YVs5XSA9IGExMjsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTFdID0gdGhpcy5fX2RhdGFbMTRdOwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxMl0gPSBhMDM7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzEzXSA9IGExMzsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMTRdID0gYTIzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc3Bvc2VzIChleGNoYW5nZXMgY29sdW1ucyB3aXRoIHJvd3MpIHRoaXMgbWF0cml4CiAgICAgICAgICogYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBpbnN0YW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm4gYSBuZXcgdHJhbnNwb3NlZCBNYXQ0LgogICAgICAgICAqLwogICAgICAgIHRyYW5zcG9zZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXQ0KHRoaXMuX19kYXRhWzBdLCB0aGlzLl9fZGF0YVs0XSwgdGhpcy5fX2RhdGFbOF0sIHRoaXMuX19kYXRhWzEyXSwgdGhpcy5fX2RhdGFbMV0sIHRoaXMuX19kYXRhWzVdLCB0aGlzLl9fZGF0YVs5XSwgdGhpcy5fX2RhdGFbMTNdLCB0aGlzLl9fZGF0YVsyXSwgdGhpcy5fX2RhdGFbNl0sIHRoaXMuX19kYXRhWzEwXSwgdGhpcy5fX2RhdGFbMTRdLCB0aGlzLl9fZGF0YVszXSwgdGhpcy5fX2RhdGFbN10sIHRoaXMuX19kYXRhWzExXSwgdGhpcy5fX2RhdGFbMTVdKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogSW52ZXJ0cyBhIE1hdDQgYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBpbnN0YW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IE1hdDQuCiAgICAgICAgICovCiAgICAgICAgaW52ZXJzZSgpIHsKICAgICAgICAgICAgY29uc3QgYTAwID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTAzID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMCA9IHRoaXMuX19kYXRhWzRdOwogICAgICAgICAgICBjb25zdCBhMTEgPSB0aGlzLl9fZGF0YVs1XTsKICAgICAgICAgICAgY29uc3QgYTEyID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjAgPSB0aGlzLl9fZGF0YVs4XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gdGhpcy5fX2RhdGFbOV07CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IHRoaXMuX19kYXRhWzEwXTsKICAgICAgICAgICAgY29uc3QgYTIzID0gdGhpcy5fX2RhdGFbMTFdOwogICAgICAgICAgICBjb25zdCBhMzAgPSB0aGlzLl9fZGF0YVsxMl07CiAgICAgICAgICAgIGNvbnN0IGEzMSA9IHRoaXMuX19kYXRhWzEzXTsKICAgICAgICAgICAgY29uc3QgYTMyID0gdGhpcy5fX2RhdGFbMTRdOwogICAgICAgICAgICBjb25zdCBhMzMgPSB0aGlzLl9fZGF0YVsxNV07CiAgICAgICAgICAgIGNvbnN0IGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgICAgICAgY29uc3QgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwOwogICAgICAgICAgICBjb25zdCBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTA7CiAgICAgICAgICAgIGNvbnN0IGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgY29uc3QgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExOwogICAgICAgICAgICBjb25zdCBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTI7CiAgICAgICAgICAgIGNvbnN0IGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMDsKICAgICAgICAgICAgY29uc3QgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwOwogICAgICAgICAgICBjb25zdCBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzA7CiAgICAgICAgICAgIGNvbnN0IGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgICAgICAgY29uc3QgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxOwogICAgICAgICAgICBjb25zdCBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzI7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnQKICAgICAgICAgICAgbGV0IGRldCA9IGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjsKICAgICAgICAgICAgaWYgKCFkZXQpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGludmVydCBNYXQ0Jyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWF0NCgoYTExICogYjExIC0gYTEyICogYjEwICsgYTEzICogYjA5KSAqIGRldCwgKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQsIChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0LCAoYTIyICogYjA0IC0gYTIxICogYjA1IC0gYTIzICogYjAzKSAqIGRldCwgKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQsIChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0LCAoYTMyICogYjAyIC0gYTMwICogYjA1IC0gYTMzICogYjAxKSAqIGRldCwgKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQsIChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0LCAoYTAxICogYjA4IC0gYTAwICogYjEwIC0gYTAzICogYjA2KSAqIGRldCwgKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQsIChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0LCAoYTExICogYjA3IC0gYTEwICogYjA5IC0gYTEyICogYjA2KSAqIGRldCwgKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQsIChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0LCAoYTIwICogYjAzIC0gYTIxICogYjAxICsgYTIyICogYjAwKSAqIGRldCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEludmVydHMgYSBNYXQ0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaW52ZXJ0SW5QbGFjZSgpIHsKICAgICAgICAgICAgY29uc3QgYTAwID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTAzID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMCA9IHRoaXMuX19kYXRhWzRdOwogICAgICAgICAgICBjb25zdCBhMTEgPSB0aGlzLl9fZGF0YVs1XTsKICAgICAgICAgICAgY29uc3QgYTEyID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjAgPSB0aGlzLl9fZGF0YVs4XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gdGhpcy5fX2RhdGFbOV07CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IHRoaXMuX19kYXRhWzEwXTsKICAgICAgICAgICAgY29uc3QgYTIzID0gdGhpcy5fX2RhdGFbMTFdOwogICAgICAgICAgICBjb25zdCBhMzAgPSB0aGlzLl9fZGF0YVsxMl07CiAgICAgICAgICAgIGNvbnN0IGEzMSA9IHRoaXMuX19kYXRhWzEzXTsKICAgICAgICAgICAgY29uc3QgYTMyID0gdGhpcy5fX2RhdGFbMTRdOwogICAgICAgICAgICBjb25zdCBhMzMgPSB0aGlzLl9fZGF0YVsxNV07CiAgICAgICAgICAgIGNvbnN0IGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgICAgICAgY29uc3QgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwOwogICAgICAgICAgICBjb25zdCBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTA7CiAgICAgICAgICAgIGNvbnN0IGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgY29uc3QgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExOwogICAgICAgICAgICBjb25zdCBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTI7CiAgICAgICAgICAgIGNvbnN0IGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMDsKICAgICAgICAgICAgY29uc3QgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwOwogICAgICAgICAgICBjb25zdCBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzA7CiAgICAgICAgICAgIGNvbnN0IGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgICAgICAgY29uc3QgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxOwogICAgICAgICAgICBjb25zdCBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzI7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnQKICAgICAgICAgICAgbGV0IGRldCA9IGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjsKICAgICAgICAgICAgaWYgKCFkZXQpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGludmVydCBNYXQ0Jyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGV0ID0gMS4wIC8gZGV0OwogICAgICAgICAgICB0aGlzLnNldCgoYTExICogYjExIC0gYTEyICogYjEwICsgYTEzICogYjA5KSAqIGRldCwgKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQsIChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0LCAoYTIyICogYjA0IC0gYTIxICogYjA1IC0gYTIzICogYjAzKSAqIGRldCwgKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQsIChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0LCAoYTMyICogYjAyIC0gYTMwICogYjA1IC0gYTMzICogYjAxKSAqIGRldCwgKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQsIChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0LCAoYTAxICogYjA4IC0gYTAwICogYjEwIC0gYTAzICogYjA2KSAqIGRldCwgKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQsIChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0LCAoYTExICogYjA3IC0gYTEwICogYjA5IC0gYTEyICogYjA2KSAqIGRldCwgKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQsIChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0LCAoYTIwICogYjAzIC0gYTIxICogYjAxICsgYTIyICogYjAwKSAqIGRldCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoaXMgbWF0cml4IGFzIHRoZSBpbnZlcnNlIG9mIHRoZSBnaXZlbiBNYXQ0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG1hdDQgLSBUaGUgbWF0NCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gSW4gY2FzZSB0aGUgYGRldGVybWluYW50YCBjYW4ndCBiZSBjYWxjdWxhdGVkLCBhIGBudWxsYCB3aWxsIGJlIHJldHVybmVkLCBvdGhlcndpc2UsIG5vdGhpbmcgaXMgcmV0dXJuZWQKICAgICAgICAgKi8KICAgICAgICBzZXRJbnZlcnNlKG1hdDQpIHsKICAgICAgICAgICAgY29uc3QgYTAwID0gbWF0NC5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IG1hdDQuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSBtYXQ0Ll9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTAzID0gbWF0NC5fX2RhdGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMCA9IG1hdDQuX19kYXRhWzRdOwogICAgICAgICAgICBjb25zdCBhMTEgPSBtYXQ0Ll9fZGF0YVs1XTsKICAgICAgICAgICAgY29uc3QgYTEyID0gbWF0NC5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IG1hdDQuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjAgPSBtYXQ0Ll9fZGF0YVs4XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gbWF0NC5fX2RhdGFbOV07CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IG1hdDQuX19kYXRhWzEwXTsKICAgICAgICAgICAgY29uc3QgYTIzID0gbWF0NC5fX2RhdGFbMTFdOwogICAgICAgICAgICBjb25zdCBhMzAgPSBtYXQ0Ll9fZGF0YVsxMl07CiAgICAgICAgICAgIGNvbnN0IGEzMSA9IG1hdDQuX19kYXRhWzEzXTsKICAgICAgICAgICAgY29uc3QgYTMyID0gbWF0NC5fX2RhdGFbMTRdOwogICAgICAgICAgICBjb25zdCBhMzMgPSBtYXQ0Ll9fZGF0YVsxNV07CiAgICAgICAgICAgIGNvbnN0IGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgICAgICAgY29uc3QgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwOwogICAgICAgICAgICBjb25zdCBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTA7CiAgICAgICAgICAgIGNvbnN0IGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgY29uc3QgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExOwogICAgICAgICAgICBjb25zdCBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTI7CiAgICAgICAgICAgIGNvbnN0IGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMDsKICAgICAgICAgICAgY29uc3QgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwOwogICAgICAgICAgICBjb25zdCBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzA7CiAgICAgICAgICAgIGNvbnN0IGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgICAgICAgY29uc3QgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxOwogICAgICAgICAgICBjb25zdCBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzI7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnQKICAgICAgICAgICAgbGV0IGRldCA9IGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjsKICAgICAgICAgICAgaWYgKCFkZXQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGludmVydCBNYXQ0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGV0ID0gMS4wIC8gZGV0OwogICAgICAgICAgICB0aGlzLnNldCgoYTExICogYjExIC0gYTEyICogYjEwICsgYTEzICogYjA5KSAqIGRldCwgKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQsIChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0LCAoYTIyICogYjA0IC0gYTIxICogYjA1IC0gYTIzICogYjAzKSAqIGRldCwgKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQsIChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0LCAoYTMyICogYjAyIC0gYTMwICogYjA1IC0gYTMzICogYjAxKSAqIGRldCwgKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQsIChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0LCAoYTAxICogYjA4IC0gYTAwICogYjEwIC0gYTAzICogYjA2KSAqIGRldCwgKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQsIChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0LCAoYTExICogYjA3IC0gYTEwICogYjA5IC0gYTEyICogYjA2KSAqIGRldCwgKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQsIChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0LCAoYTIwICogYjAzIC0gYTIxICogYjAxICsgYTIyICogYjAwKSAqIGRldCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE11bHRpcGxpZXMgdHdvIE1hdDRzIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgaW5zdGFuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgTWF0NCB0byBtdWx0aXBseSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IE1hdDQuCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHkob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgYTAwID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBhMDIgPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYTAzID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMCA9IHRoaXMuX19kYXRhWzRdOwogICAgICAgICAgICBjb25zdCBhMTEgPSB0aGlzLl9fZGF0YVs1XTsKICAgICAgICAgICAgY29uc3QgYTEyID0gdGhpcy5fX2RhdGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IHRoaXMuX19kYXRhWzddOwogICAgICAgICAgICBjb25zdCBhMjAgPSB0aGlzLl9fZGF0YVs4XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gdGhpcy5fX2RhdGFbOV07CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IHRoaXMuX19kYXRhWzEwXTsKICAgICAgICAgICAgY29uc3QgYTIzID0gdGhpcy5fX2RhdGFbMTFdOwogICAgICAgICAgICBjb25zdCBhMzAgPSB0aGlzLl9fZGF0YVsxMl07CiAgICAgICAgICAgIGNvbnN0IGEzMSA9IHRoaXMuX19kYXRhWzEzXTsKICAgICAgICAgICAgY29uc3QgYTMyID0gdGhpcy5fX2RhdGFbMTRdOwogICAgICAgICAgICBjb25zdCBhMzMgPSB0aGlzLl9fZGF0YVsxNV07CiAgICAgICAgICAgIC8vIENhY2hlIG9ubHkgdGhlIGN1cnJlbnQgbGluZSBvZiB0aGUgc2Vjb25kIG1hdHJpeAogICAgICAgICAgICBjb25zdCBiID0gb3RoZXIuYXNBcnJheSgpOwogICAgICAgICAgICBsZXQgYjAgPSBiWzBdOwogICAgICAgICAgICBsZXQgYjEgPSBiWzFdOwogICAgICAgICAgICBsZXQgYjIgPSBiWzJdOwogICAgICAgICAgICBsZXQgYjMgPSBiWzNdOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgTWF0NCgpOwogICAgICAgICAgICByZXN1bHQubTAwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHJlc3VsdC5tMDEgPSBiMCAqIGEwMSArIGIxICogYTExICsgYjIgKiBhMjEgKyBiMyAqIGEzMTsKICAgICAgICAgICAgcmVzdWx0Lm0wMiA9IGIwICogYTAyICsgYjEgKiBhMTIgKyBiMiAqIGEyMiArIGIzICogYTMyOwogICAgICAgICAgICByZXN1bHQubTAzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIGIwID0gYls0XTsKICAgICAgICAgICAgYjEgPSBiWzVdOwogICAgICAgICAgICBiMiA9IGJbNl07CiAgICAgICAgICAgIGIzID0gYls3XTsKICAgICAgICAgICAgcmVzdWx0Lm0xMCA9IGIwICogYTAwICsgYjEgKiBhMTAgKyBiMiAqIGEyMCArIGIzICogYTMwOwogICAgICAgICAgICByZXN1bHQubTExID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHJlc3VsdC5tMTIgPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgcmVzdWx0Lm0xMyA9IGIwICogYTAzICsgYjEgKiBhMTMgKyBiMiAqIGEyMyArIGIzICogYTMzOwogICAgICAgICAgICBiMCA9IGJbOF07CiAgICAgICAgICAgIGIxID0gYls5XTsKICAgICAgICAgICAgYjIgPSBiWzEwXTsKICAgICAgICAgICAgYjMgPSBiWzExXTsKICAgICAgICAgICAgcmVzdWx0Lm0yMCA9IGIwICogYTAwICsgYjEgKiBhMTAgKyBiMiAqIGEyMCArIGIzICogYTMwOwogICAgICAgICAgICByZXN1bHQubTIxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHJlc3VsdC5tMjIgPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgcmVzdWx0Lm0yMyA9IGIwICogYTAzICsgYjEgKiBhMTMgKyBiMiAqIGEyMyArIGIzICogYTMzOwogICAgICAgICAgICBiMCA9IGJbMTJdOwogICAgICAgICAgICBiMSA9IGJbMTNdOwogICAgICAgICAgICBiMiA9IGJbMTRdOwogICAgICAgICAgICBiMyA9IGJbMTVdOwogICAgICAgICAgICByZXN1bHQubTMwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHJlc3VsdC5tMzEgPSBiMCAqIGEwMSArIGIxICogYTExICsgYjIgKiBhMjEgKyBiMyAqIGEzMTsKICAgICAgICAgICAgcmVzdWx0Lm0zMiA9IGIwICogYTAyICsgYjEgKiBhMTIgKyBiMiAqIGEyMiArIGIzICogYTMyOwogICAgICAgICAgICByZXN1bHQubTMzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE11bHRpcGxpZXMgdHdvIE1hdDRzIGluIHBsYWNlIGV4cGxpY2l0bHkgbm90IHVzaW5nIFNJTUQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgTWF0NCB0byBtdWx0aXBseSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IE1hdDQuCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHlJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLmFzQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgYTAwID0gYVswXTsKICAgICAgICAgICAgY29uc3QgYTAxID0gYVsxXTsKICAgICAgICAgICAgY29uc3QgYTAyID0gYVsyXTsKICAgICAgICAgICAgY29uc3QgYTAzID0gYVszXTsKICAgICAgICAgICAgY29uc3QgYTEwID0gYVs0XTsKICAgICAgICAgICAgY29uc3QgYTExID0gYVs1XTsKICAgICAgICAgICAgY29uc3QgYTEyID0gYVs2XTsKICAgICAgICAgICAgY29uc3QgYTEzID0gYVs3XTsKICAgICAgICAgICAgY29uc3QgYTIwID0gYVs4XTsKICAgICAgICAgICAgY29uc3QgYTIxID0gYVs5XTsKICAgICAgICAgICAgY29uc3QgYTIyID0gYVsxMF07CiAgICAgICAgICAgIGNvbnN0IGEyMyA9IGFbMTFdOwogICAgICAgICAgICBjb25zdCBhMzAgPSBhWzEyXTsKICAgICAgICAgICAgY29uc3QgYTMxID0gYVsxM107CiAgICAgICAgICAgIGNvbnN0IGEzMiA9IGFbMTRdOwogICAgICAgICAgICBjb25zdCBhMzMgPSBhWzE1XTsKICAgICAgICAgICAgLy8gQ2FjaGUgb25seSB0aGUgY3VycmVudCBsaW5lIG9mIHRoZSBzZWNvbmQgbWF0cml4CiAgICAgICAgICAgIGNvbnN0IGIgPSBvdGhlci5hc0FycmF5KCk7CiAgICAgICAgICAgIGxldCBiMCA9IGJbMF07CiAgICAgICAgICAgIGxldCBiMSA9IGJbMV07CiAgICAgICAgICAgIGxldCBiMiA9IGJbMl07CiAgICAgICAgICAgIGxldCBiMyA9IGJbM107CiAgICAgICAgICAgIHRoaXMubTAwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTAxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTAyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTAzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIGIwID0gYls0XTsKICAgICAgICAgICAgYjEgPSBiWzVdOwogICAgICAgICAgICBiMiA9IGJbNl07CiAgICAgICAgICAgIGIzID0gYls3XTsKICAgICAgICAgICAgdGhpcy5tMTAgPSBiMCAqIGEwMCArIGIxICogYTEwICsgYjIgKiBhMjAgKyBiMyAqIGEzMDsKICAgICAgICAgICAgdGhpcy5tMTEgPSBiMCAqIGEwMSArIGIxICogYTExICsgYjIgKiBhMjEgKyBiMyAqIGEzMTsKICAgICAgICAgICAgdGhpcy5tMTIgPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgdGhpcy5tMTMgPSBiMCAqIGEwMyArIGIxICogYTEzICsgYjIgKiBhMjMgKyBiMyAqIGEzMzsKICAgICAgICAgICAgYjAgPSBiWzhdOwogICAgICAgICAgICBiMSA9IGJbOV07CiAgICAgICAgICAgIGIyID0gYlsxMF07CiAgICAgICAgICAgIGIzID0gYlsxMV07CiAgICAgICAgICAgIHRoaXMubTIwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTIxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTIyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTIzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIGIwID0gYlsxMl07CiAgICAgICAgICAgIGIxID0gYlsxM107CiAgICAgICAgICAgIGIyID0gYlsxNF07CiAgICAgICAgICAgIGIzID0gYlsxNV07CiAgICAgICAgICAgIHRoaXMubTMwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTMxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTMyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTMzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBQb3N0IG11bHRpcGxpZXMgdHdvIE1hdDRzIGluIHBsYWNlIGV4cGxpY2l0bHkgbm90IHVzaW5nIFNJTUQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgTWF0NCB0byBtdWx0aXBseSB3aXRoLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgTWF0NC4KICAgICAgICAgKi8KICAgICAgICBwb3N0TXVsdGlwbHlJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBvdGhlci5hc0FycmF5KCk7CiAgICAgICAgICAgIGNvbnN0IGEwMCA9IGFbMF07CiAgICAgICAgICAgIGNvbnN0IGEwMSA9IGFbMV07CiAgICAgICAgICAgIGNvbnN0IGEwMiA9IGFbMl07CiAgICAgICAgICAgIGNvbnN0IGEwMyA9IGFbM107CiAgICAgICAgICAgIGNvbnN0IGExMCA9IGFbNF07CiAgICAgICAgICAgIGNvbnN0IGExMSA9IGFbNV07CiAgICAgICAgICAgIGNvbnN0IGExMiA9IGFbNl07CiAgICAgICAgICAgIGNvbnN0IGExMyA9IGFbN107CiAgICAgICAgICAgIGNvbnN0IGEyMCA9IGFbOF07CiAgICAgICAgICAgIGNvbnN0IGEyMSA9IGFbOV07CiAgICAgICAgICAgIGNvbnN0IGEyMiA9IGFbMTBdOwogICAgICAgICAgICBjb25zdCBhMjMgPSBhWzExXTsKICAgICAgICAgICAgY29uc3QgYTMwID0gYVsxMl07CiAgICAgICAgICAgIGNvbnN0IGEzMSA9IGFbMTNdOwogICAgICAgICAgICBjb25zdCBhMzIgPSBhWzE0XTsKICAgICAgICAgICAgY29uc3QgYTMzID0gYVsxNV07CiAgICAgICAgICAgIC8vIENhY2hlIG9ubHkgdGhlIGN1cnJlbnQgbGluZSBvZiB0aGUgc2Vjb25kIG1hdHJpeAogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5hc0FycmF5KCk7CiAgICAgICAgICAgIGxldCBiMCA9IGJbMF07CiAgICAgICAgICAgIGxldCBiMSA9IGJbMV07CiAgICAgICAgICAgIGxldCBiMiA9IGJbMl07CiAgICAgICAgICAgIGxldCBiMyA9IGJbM107CiAgICAgICAgICAgIHRoaXMubTAwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTAxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTAyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTAzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIGIwID0gYls0XTsKICAgICAgICAgICAgYjEgPSBiWzVdOwogICAgICAgICAgICBiMiA9IGJbNl07CiAgICAgICAgICAgIGIzID0gYls3XTsKICAgICAgICAgICAgdGhpcy5tMTAgPSBiMCAqIGEwMCArIGIxICogYTEwICsgYjIgKiBhMjAgKyBiMyAqIGEzMDsKICAgICAgICAgICAgdGhpcy5tMTEgPSBiMCAqIGEwMSArIGIxICogYTExICsgYjIgKiBhMjEgKyBiMyAqIGEzMTsKICAgICAgICAgICAgdGhpcy5tMTIgPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgdGhpcy5tMTMgPSBiMCAqIGEwMyArIGIxICogYTEzICsgYjIgKiBhMjMgKyBiMyAqIGEzMzsKICAgICAgICAgICAgYjAgPSBiWzhdOwogICAgICAgICAgICBiMSA9IGJbOV07CiAgICAgICAgICAgIGIyID0gYlsxMF07CiAgICAgICAgICAgIGIzID0gYlsxMV07CiAgICAgICAgICAgIHRoaXMubTIwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTIxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTIyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTIzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIGIwID0gYlsxMl07CiAgICAgICAgICAgIGIxID0gYlsxM107CiAgICAgICAgICAgIGIyID0gYlsxNF07CiAgICAgICAgICAgIGIzID0gYlsxNV07CiAgICAgICAgICAgIHRoaXMubTMwID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIHRoaXMubTMxID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIHRoaXMubTMyID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIHRoaXMubTMzID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsgYjMgKiBhMzM7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc2xhdGUgYSBNYXQ0IGJ5IHRoZSBnaXZlbiB2ZWN0b3Igbm90IHVzaW5nIFNJTUQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdjMgLSBUaGUgZ2l2ZW4gdmVjdG9yIHRvIHRyYW5zbGF0ZSBhbG9uZy4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0cmFuc2xhdGVJblBsYWNlKHYzKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9fZGF0YTsKICAgICAgICAgICAgY29uc3QgeCA9IHYzLng7CiAgICAgICAgICAgIGNvbnN0IHkgPSB2My55OwogICAgICAgICAgICBjb25zdCB6ID0gdjMuejsKICAgICAgICAgICAgYVsxMl0gPSBhWzBdICogeCArIGFbNF0gKiB5ICsgYVs4XSAqIHogKyBhWzEyXTsKICAgICAgICAgICAgYVsxM10gPSBhWzFdICogeCArIGFbNV0gKiB5ICsgYVs5XSAqIHogKyBhWzEzXTsKICAgICAgICAgICAgYVsxNF0gPSBhWzJdICogeCArIGFbNl0gKiB5ICsgYVsxMF0gKiB6ICsgYVsxNF07CiAgICAgICAgICAgIGFbMTVdID0gYVszXSAqIHggKyBhWzddICogeSArIGFbMTFdICogeiArIGFbMTVdOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGVzIGEgbG9vay1hdCBtYXRyaXggd2l0aCB0aGUgZ2l2ZW4gcG9zaXRpb24sIGZvY2FsIHBvaW50LCBhbmQgdXAgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBwb3MgLSBQb3NpdGlvbiBvZiB0aGUgdmlld2VyLgogICAgICAgICAqIEBwYXJhbSB0YXJnZXQgLSBQb2ludCB0aGUgdmlld2VyIGlzIGxvb2tpbmcgYXQuCiAgICAgICAgICogQHBhcmFtIHVwIC0gVmVjMyBwb2ludGluZyB1cC4KICAgICAgICAgKi8KICAgICAgICBzZXRMb29rQXQocG9zLCB0YXJnZXQsIHVwKSB7CiAgICAgICAgICAgIGNvbnN0IHpBeGlzID0gcG9zLnN1YnRyYWN0KHRhcmdldCk7CiAgICAgICAgICAgIGNvbnN0IHpMZW4gPSB6QXhpcy5sZW5ndGgoKTsKICAgICAgICAgICAgaWYgKHpMZW4gPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJZGVudGl0eSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHpBeGlzLnNjYWxlSW5QbGFjZSgxLjAgLyB6TGVuKTsKICAgICAgICAgICAgY29uc3QgeEF4aXMgPSB1cC5jcm9zcyh6QXhpcyk7CiAgICAgICAgICAgIGNvbnN0IHhMZW4gPSB4QXhpcy5sZW5ndGgoKTsKICAgICAgICAgICAgaWYgKHhMZW4gPiBOdW1iZXIuRVBTSUxPTikKICAgICAgICAgICAgICAgIHhBeGlzLnNjYWxlSW5QbGFjZSgxLjAgLyB4TGVuKTsKICAgICAgICAgICAgY29uc3QgeUF4aXMgPSB6QXhpcy5jcm9zcyh4QXhpcyk7CiAgICAgICAgICAgIGNvbnN0IHlMZW4gPSB5QXhpcy5sZW5ndGgoKTsKICAgICAgICAgICAgaWYgKHlMZW4gPiBOdW1iZXIuRVBTSUxPTikKICAgICAgICAgICAgICAgIHlBeGlzLnNjYWxlSW5QbGFjZSgxLjAgLyB5TGVuKTsKICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgcHJldHRpZXIvcHJldHRpZXIqLwogICAgICAgICAgICB0aGlzLnNldCh4QXhpcy54LCB4QXhpcy55LCB4QXhpcy56LCAwLCB5QXhpcy54LCB5QXhpcy55LCB5QXhpcy56LCAwLCB6QXhpcy54LCB6QXhpcy55LCB6QXhpcy56LCAwLCBwb3MueCwgcG9zLnksIHBvcy56LCAxKTsKICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIGdpdmVuIGFuZ2xlIGFyb3VuZCBhIGdpdmVuIGF4aXMuCiAgICAgICAgICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6CiAgICAgICAgICoKICAgICAgICAgKiAgICAgbWF0NC5pZGVudGl0eShkZXN0KTsKICAgICAgICAgKiAgICAgbWF0NC5yb3RhdGUoZGVzdCwgZGVzdCwgcmFkLCBheGlzKTsKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBheGlzIC0gVGhlIGF4aXMgdG8gcm90YXRlIGFyb3VuZC4KICAgICAgICAgKiBAcGFyYW0gcmFkIC0gVGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5LgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldFJvdGF0aW9uKGF4aXMsIHJhZCkgewogICAgICAgICAgICBjb25zdCBsZW4gPSBheGlzLmxlbmd0aCgpOwogICAgICAgICAgICBpZiAoTWF0aC5hYnMobGVuKSA8IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB4ID0gYXhpcy54IC8gbGVuOwogICAgICAgICAgICBjb25zdCB5ID0gYXhpcy55IC8gbGVuOwogICAgICAgICAgICBjb25zdCB6ID0gYXhpcy56IC8gbGVuOwogICAgICAgICAgICBjb25zdCBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgY29uc3QgYyA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIGNvbnN0IHQgPSAxIC0gYzsKICAgICAgICAgICAgLy8gUGVyZm9ybSByb3RhdGlvbi1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb24KICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX19kYXRhOwogICAgICAgICAgICBhWzBdID0geCAqIHggKiB0ICsgYzsKICAgICAgICAgICAgYVsxXSA9IHkgKiB4ICogdCArIHogKiBzOwogICAgICAgICAgICBhWzJdID0geiAqIHggKiB0IC0geSAqIHM7CiAgICAgICAgICAgIGFbM10gPSAwOwogICAgICAgICAgICBhWzRdID0geCAqIHkgKiB0IC0geiAqIHM7CiAgICAgICAgICAgIGFbNV0gPSB5ICogeSAqIHQgKyBjOwogICAgICAgICAgICBhWzZdID0geiAqIHkgKiB0ICsgeCAqIHM7CiAgICAgICAgICAgIGFbN10gPSAwOwogICAgICAgICAgICBhWzhdID0geCAqIHogKiB0ICsgeSAqIHM7CiAgICAgICAgICAgIGFbOV0gPSB5ICogeiAqIHQgLSB4ICogczsKICAgICAgICAgICAgYVsxMF0gPSB6ICogeiAqIHQgKyBjOwogICAgICAgICAgICBhWzExXSA9IDA7CiAgICAgICAgICAgIGFbMTJdID0gMDsKICAgICAgICAgICAgYVsxM10gPSAwOwogICAgICAgICAgICBhWzE0XSA9IDA7CiAgICAgICAgICAgIGFbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gYW5nbGUgYXJvdW5kIHRoZSBYIGF4aXMuCiAgICAgICAgICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6CiAgICAgICAgICoKICAgICAgICAgKiAgICAgbWF0NC5pZGVudGl0eShkZXN0KTsKICAgICAgICAgKiAgICAgbWF0NC5yb3RhdGVYKGRlc3QsIGRlc3QsIHJhZCk7CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmFkIC0gVGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5LgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldFhSb3RhdGlvbihyYWQpIHsKICAgICAgICAgICAgY29uc3QgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIGNvbnN0IGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICAvLyBQZXJmb3JtIGF4aXMtc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uCiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9fZGF0YTsKICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgcHJldHRpZXIvcHJldHRpZXIqLwogICAgICAgICAgICBhWzBdID0gMTsKICAgICAgICAgICAgYVsxXSA9IDA7CiAgICAgICAgICAgIGFbMl0gPSAwOwogICAgICAgICAgICBhWzNdID0gMDsKICAgICAgICAgICAgYVs0XSA9IDA7CiAgICAgICAgICAgIGFbNV0gPSBjOwogICAgICAgICAgICBhWzZdID0gczsKICAgICAgICAgICAgYVs3XSA9IDA7CiAgICAgICAgICAgIGFbOF0gPSAwOwogICAgICAgICAgICBhWzldID0gLXM7CiAgICAgICAgICAgIGFbMTBdID0gYzsKICAgICAgICAgICAgYVsxMV0gPSAwOwogICAgICAgICAgICBhWzEyXSA9IDA7CiAgICAgICAgICAgIGFbMTNdID0gMDsKICAgICAgICAgICAgYVsxNF0gPSAwOwogICAgICAgICAgICBhWzE1XSA9IDE7CiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgcHJldHRpZXIvcHJldHRpZXIqLwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIHRoZSBnaXZlbiBhbmdsZSBhcm91bmQgdGhlIFkgYXhpcy4KICAgICAgICAgKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKToKICAgICAgICAgKgogICAgICAgICAqICAgICBtYXQ0LmlkZW50aXR5KGRlc3QpOwogICAgICAgICAqICAgICBtYXQ0LnJvdGF0ZVkoZGVzdCwgZGVzdCwgcmFkKTsKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByYWQgLSBUaGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnkuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0WVJvdGF0aW9uKHJhZCkgewogICAgICAgICAgICBjb25zdCBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgY29uc3QgYyA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb24KICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX19kYXRhOwogICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgICAgIGFbMF0gPSBjOwogICAgICAgICAgICBhWzFdID0gMDsKICAgICAgICAgICAgYVsyXSA9IC1zOwogICAgICAgICAgICBhWzNdID0gMDsKICAgICAgICAgICAgYVs0XSA9IDA7CiAgICAgICAgICAgIGFbNV0gPSAxOwogICAgICAgICAgICBhWzZdID0gMDsKICAgICAgICAgICAgYVs3XSA9IDA7CiAgICAgICAgICAgIGFbOF0gPSBzOwogICAgICAgICAgICBhWzldID0gMDsKICAgICAgICAgICAgYVsxMF0gPSBjOwogICAgICAgICAgICBhWzExXSA9IDA7CiAgICAgICAgICAgIGFbMTJdID0gMDsKICAgICAgICAgICAgYVsxM10gPSAwOwogICAgICAgICAgICBhWzE0XSA9IDA7CiAgICAgICAgICAgIGFbMTVdID0gMTsKICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgWiBheGlzLgogICAgICAgICAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOgogICAgICAgICAqCiAgICAgICAgICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7CiAgICAgICAgICogICAgIG1hdDQucm90YXRlWihkZXN0LCBkZXN0LCByYWQpOwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJhZCAtIFRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRaUm90YXRpb24ocmFkKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihyYWQpOwogICAgICAgICAgICBjb25zdCBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgLy8gUGVyZm9ybSBheGlzLXNwZWNpZmljIG1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fX2RhdGE7CiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIHByZXR0aWVyL3ByZXR0aWVyKi8KICAgICAgICAgICAgYVswXSA9IGM7CiAgICAgICAgICAgIGFbMV0gPSBzOwogICAgICAgICAgICBhWzJdID0gMDsKICAgICAgICAgICAgYVszXSA9IDA7CiAgICAgICAgICAgIGFbNF0gPSAtczsKICAgICAgICAgICAgYVs1XSA9IGM7CiAgICAgICAgICAgIGFbNl0gPSAwOwogICAgICAgICAgICBhWzddID0gMDsKICAgICAgICAgICAgYVs4XSA9IDA7CiAgICAgICAgICAgIGFbOV0gPSAwOwogICAgICAgICAgICBhWzEwXSA9IDE7CiAgICAgICAgICAgIGFbMTFdID0gMDsKICAgICAgICAgICAgYVsxMl0gPSAwOwogICAgICAgICAgICBhWzEzXSA9IDA7CiAgICAgICAgICAgIGFbMTRdID0gMDsKICAgICAgICAgICAgYVsxNV0gPSAxOwogICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIHByZXR0aWVyL3ByZXR0aWVyKi8KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRyYW5zZm9ybXMgdGhlIFZlYzQgd2l0aCBhIE1hdDQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjIC0gVGhlIHZlYyB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJuIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjNC4KICAgICAgICAgKi8KICAgICAgICB0cmFuc2Zvcm1WZWM0KHZlYykgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fX2RhdGE7CiAgICAgICAgICAgIGNvbnN0IHggPSB2ZWMueDsKICAgICAgICAgICAgY29uc3QgeSA9IHZlYy55OwogICAgICAgICAgICBjb25zdCB6ID0gdmVjLno7CiAgICAgICAgICAgIGNvbnN0IHcgPSB2ZWMudDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWM0KGFbMF0gKiB4ICsgYVs0XSAqIHkgKyBhWzhdICogeiArIGFbMTJdICogdywgYVsxXSAqIHggKyBhWzVdICogeSArIGFbOV0gKiB6ICsgYVsxM10gKiB3LCBhWzJdICogeCArIGFbNl0gKiB5ICsgYVsxMF0gKiB6ICsgYVsxNF0gKiB3LCBhWzNdICogeCArIGFbN10gKiB5ICsgYVsxMV0gKiB6ICsgYVsxNV0gKiB3KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNmb3JtcyB0aGUgVmVjMyB3aXRoIGEgTWF0NC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB2ZWMgLSBUaGUgdmVjIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm4gdGhlIHJlc3VsdCBhcyBhIG5ldyBWZWMzLgogICAgICAgICAqLwogICAgICAgIHRyYW5zZm9ybVZlYzModmVjKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9fZGF0YTsKICAgICAgICAgICAgY29uc3QgeCA9IHZlYy54OwogICAgICAgICAgICBjb25zdCB5ID0gdmVjLnk7CiAgICAgICAgICAgIGNvbnN0IHogPSB2ZWMuejsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKGFbMF0gKiB4ICsgYVs0XSAqIHkgKyBhWzhdICogeiArIGFbMTJdLCBhWzFdICogeCArIGFbNV0gKiB5ICsgYVs5XSAqIHogKyBhWzEzXSwgYVsyXSAqIHggKyBhWzZdICogeSArIGFbMTBdICogeiArIGFbMTRdKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUm90YXRlcyBhIGdpdmVuIGBWZWMzYCBhbmQgdGhlIHJlc3VsdCBpcyByZXR1cm5lZCBhcyBhIG5ldyBgVmVjM2AsIGFwcGx5aW5nIG9ubHkgdGhlIHRvcCBsZWZ0IGNvbXBvbmVudHMgb2YgdGhlIG1hdHJpeCwgc28gbm90IGFwcGx5aW5nIGFueSB0cmFuc2xhdGlvbi4KICAgICAgICAgKiBAcGFyYW0gdmVjIC0gVGhlIHZlYyB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJuIHRoZSByZXN1bHQgYXMgYSBuZXcgVmVjMy4KICAgICAgICAgKi8KICAgICAgICByb3RhdGVWZWMzKHZlYykgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fX2RhdGE7CiAgICAgICAgICAgIGNvbnN0IHggPSB2ZWMueDsKICAgICAgICAgICAgY29uc3QgeSA9IHZlYy55OwogICAgICAgICAgICBjb25zdCB6ID0gdmVjLno7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyhhWzBdICogeCArIGFbNF0gKiB5ICsgYVs4XSAqIHosIGFbMV0gKiB4ICsgYVs1XSAqIHkgKyBhWzldICogeiwgYVsyXSAqIHggKyBhWzZdICogeSArIGFbMTBdICogeik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgcGVyc3BlY3RpdmUgZnJvbSBhIE1hdDQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZm92WSAtIFRoZSBmb3ZZIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBhc3BlY3QgLSBUaGUgYXNwZWN0IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBuZWFyIC0gVGhlIG5lYXIgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGZhciAtIFRoZSBmYXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0UGVyc3BlY3RpdmVNYXRyaXgoZm92eSwgYXNwZWN0LCBuZWFyLCBmYXIpIHsKICAgICAgICAgICAgY29uc3QgZiA9IE1hdGgudGFuKE1hdGguUEkgKiAwLjUgLSAwLjUgKiBmb3Z5KTsKICAgICAgICAgICAgY29uc3QgcmFuZ2VJbnYgPSAxLjAgLyAobmVhciAtIGZhcik7CiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIHByZXR0aWVyL3ByZXR0aWVyKi8KICAgICAgICAgICAgdGhpcy5zZXQoZiAvIGFzcGVjdCwgMCwgMCwgMCwgMCwgZiwgMCwgMCwgMCwgMCwgKG5lYXIgKyBmYXIpICogcmFuZ2VJbnYsIC0xLCAwLCAwLCBuZWFyICogZmFyICogcmFuZ2VJbnYgKiAyLCAwKTsKICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIG9ydGhvZ3JhcGhpYyBtYXRyaXggYW5kIHNldHMgdGhlIHN0YXRlIG9mIHRoZSBNYXQ0IGNsYXNzCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbGVmdCAtIFRoZSBsZWZ0IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSByaWdodCAtIFRoZSByaWdodCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gYm90dG9tIC0gVGhlIGJvdHRvbSB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gdG9wIC0gVGhlIHRvcCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gbmVhciAtIFRoZSBuZWFyIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBmYXIgLSBUaGUgZmFyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldE9ydGhvZ3JhcGhpY01hdHJpeChsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikgewogICAgICAgICAgICBjb25zdCBsciA9IDEgLyAobGVmdCAtIHJpZ2h0KTsKICAgICAgICAgICAgY29uc3QgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCk7CiAgICAgICAgICAgIGNvbnN0IG5mID0gMSAvIChuZWFyIC0gZmFyKTsKICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgcHJldHRpZXIvcHJldHRpZXIqLwogICAgICAgICAgICB0aGlzLnNldCgtMiAqIGxyLCAwLCAwLCAwLCAwLCAtMiAqIGJ0LCAwLCAwLCAwLCAwLCAyICogbmYsIDAsIChsZWZ0ICsgcmlnaHQpICogbHIsICh0b3AgKyBib3R0b20pICogYnQsIChmYXIgKyBuZWFyKSAqIG5mLCAxKTsKICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgTWF0cml4IHRvIGJlIGEgc2NhbGUgbWF0cml4LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHggLSBUaGUgeCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0geSAtIFRoZSB5IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSB6IC0gVGhlIHogdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0U2NhbGUoeCwgeSwgeikgewogICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBwcmV0dGllci9wcmV0dGllciovCiAgICAgICAgICAgIGlmICh4IGluc3RhbmNlb2YgVmVjMykgewogICAgICAgICAgICAgICAgdGhpcy5zZXQoeC54LCAwLCAwLCAwLCAwLCB4LnksIDAsIDAsIDAsIDAsIHgueiwgMCwgMCwgMCwgMCwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldCh4LCAwLCAwLCAwLCAwLCB5LCAwLCAwLCAwLCAwLCB6LCAwLCAwLCAwLCAwLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIHByZXR0aWVyL3ByZXR0aWVyKi8KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNmb3JtcyBhIDN4NCBtYXRyaXggaW50byBhIDR4NCBtYXRyaXggYW5kIHNldCB0aGUgcmVzdWx0IHRvIHRoZSBNYXRoNCBzdGF0ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtM3g0IC0gVGhlIG0zeDQgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbU1hdDN4NEFycmF5KG0zeDQpIHsKICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgcHJldHRpZXIvcHJldHRpZXIqLwogICAgICAgICAgICB0aGlzLnNldChtM3g0WzBdLCBtM3g0WzFdLCBtM3g0WzJdLCAwLCBtM3g0WzNdLCBtM3g0WzRdLCBtM3g0WzVdLCAwLCBtM3g0WzZdLCBtM3g0WzddLCBtM3g0WzhdLCAwLCBtM3g0WzldLCBtM3g0WzEwXSwgbTN4NFsxMV0sIDEpOwogICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIHByZXR0aWVyL3ByZXR0aWVyKi8KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2xvbmVzIHRoaXMgTWF0NCByZXR1cm5pbmcgYSBuZXcgaW5zdGFuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBNYXQ0LgogICAgICAgICAqLwogICAgICAgIGNsb25lKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1hdDQodGhpcy5fX2RhdGFbMF0sIHRoaXMuX19kYXRhWzFdLCB0aGlzLl9fZGF0YVsyXSwgdGhpcy5fX2RhdGFbM10sIHRoaXMuX19kYXRhWzRdLCB0aGlzLl9fZGF0YVs1XSwgdGhpcy5fX2RhdGFbNl0sIHRoaXMuX19kYXRhWzddLCB0aGlzLl9fZGF0YVs4XSwgdGhpcy5fX2RhdGFbOV0sIHRoaXMuX19kYXRhWzEwXSwgdGhpcy5fX2RhdGFbMTFdLCB0aGlzLl9fZGF0YVsxMl0sIHRoaXMuX19kYXRhWzEzXSwgdGhpcy5fX2RhdGFbMTRdLCB0aGlzLl9fZGF0YVsxNV0pOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRoaXMgVmVjMyB0byBhIHN0cmluZyBpbiBKU09OIGZvcm1hdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcAogICAgICAgICAgICByZXR1cm4gU3RyaW5nRnVuY3Rpb25zLnN0cmluZ2lmeUpTT05XaXRoRml4ZWRQcmVjaXNpb24odGhpcy50b0pTT04oKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSB0b0pTT04gbWV0aG9kIGVuY29kZXMgdGhpcyB0eXBlIGFzIGEganNvbiBvYmplY3QgZm9yIHBlcnNpc3RlbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiB7RmxvYXQzMkFycmF5fSAtIFRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICB0b0pTT04oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZGF0YTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGZyb21KU09OIG1ldGhvZCBkZWNvZGVzIGEganNvbiBvYmplY3QgZm9yIHRoaXMgdHlwZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqc29uIC0gVGhlIGpzb24gcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgZnJvbUpTT04oanNvbikgewogICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoanNvbik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIExvYWRzIHRoZSBzdGF0ZSBvZiB0aGUgdmFsdWUgZnJvbSBhIGJpbmFyeSByZWFkZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmVhZGVyIC0gVGhlIHJlYWRlciB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlcikgewogICAgICAgICAgICB0aGlzLl9fZGF0YSA9IHJlYWRlci5sb2FkRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBjdXJyZW50IE1hdGggdHlwZSBkYXRhIGFzIGFycmF5LiBPZnRlbiB1c2VkIHRvIHBhc3MgdHlwZXMgdG8gdGhlIEdQVS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSByZXN1bHQgYXMgYW4gYXJyYXkuCiAgICAgICAgICovCiAgICAgICAgYXNBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBxdWF0ZXJuaW9uLiBRdWF0ZXJuaW9ucyBhcmUgdXNlZCB0byByZXByZXNlbnQgMyBkaW1lbnNpb25hbCByb3RhdGlvbnMuCiAgICAgKgogICAgICogV2hpbGUgUXVhdGVybmlvbnMgYXJlIGRpZmZpY3VsdCB0byB1bmRlcnN0YW5kIHRoZXkgaGF2ZSBpbXBvcnRhbnQgbWF0aGVtYXRpY2FsIHByb3BlcnRpZXMgdGhhdCBtYWtlIHRoZW0gdmVyeSB1c2VmdWwgaW4gM2QgZW5naW5lcy4KICAgICAqIFRoZXkgY2FuIGJlIGRpcmVjdGx5IG11bHRpcGxpZWQgdG9nZXRoZXIgaW4gdGhlIHNhbWUgd2FzIGFzIG1hdHJpY2VzLgogICAgICogVGhleSBjYW4gYmUgaW50ZXJwb2xhdGVkIGZyb20gb25lIHZhbHVlIHRvIGFub3RoZXIgd2hpbGUgbWFpbnRhaW5pbmcgY29uc3RhbnQgYW5ndWxhciB2ZWxvY2l0eS4KICAgICAqIFRoZXkgY2FuIGJlIGNvbnZlcnRlZCB0byBvdGhlciBtb3JlIGVhc2lseSB1bmRlcnN0b29kIHJlcHJlc2VudGF0aW9ucyBzdWNoIGFzIEV1bGVyQW5nbGVzIG9yIE1hdHJpY2VzLgogICAgICoKCiAgICAgKi8KICAgIGNsYXNzIFF1YXQgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBxdWF0ZXJuaW9uLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHggLSBUaGUgYW5nbGUgb2YgdGhlIHggYXhpcy4gRGVmYXVsdCBpcyAwLgogICAgICAgICAqIEBwYXJhbSB5IC0gVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMuIERlZmF1bHQgaXMgMC4KICAgICAgICAgKiBAcGFyYW0geiAtIFRoZSBhbmdsZSBvZiB0aGUgeiBheGlzLiBEZWZhdWx0IGlzIDAuCiAgICAgICAgICogQHBhcmFtIHcgLSBUaGUgdyB2YWx1ZS4gRGVmYXVsdCBpcyAxLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxKSB7CiAgICAgICAgICAgIGlmICh4IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoeCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgbmV3IFZlYzQobmV3IEZsb2F0MzJBcnJheShidWZmZXIsIGJ5dGVPZmZzZXQsIDQpKWApOwogICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0geDsKICAgICAgICAgICAgICAgIGNvbnN0IGJ5dGVPZmZzZXQgPSB5OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgNCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHggPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSAxOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZnJvbUpTT04oeCk7CiAgICAgICAgICAgICAgICAgICAgLy8gIGZvciAoY29uc3Qga2V5IGluIHgpIHsKICAgICAgICAgICAgICAgICAgICAvLyAgaWYgKEFycmF5LmlzQXJyYXkoeFtrZXldKSkgdGhpc1trZXldLmNhbGwodGhpcywgLi4ueFtrZXldKQogICAgICAgICAgICAgICAgICAgIC8vICBlbHNlIHRoaXNba2V5XS5jYWxsKHRoaXMsIHhba2V5XSkKICAgICAgICAgICAgICAgICAgICAvL30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0geDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IHk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSB6OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB4YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHggYXhpcyByb3RhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBnZXQgeCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzBdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB4YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHgodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB5YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHkgYXhpcyByb3RhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBnZXQgeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzFdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB5YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHkodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzFdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB6YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIHogYXhpcyByb3RhdGlvbi4KICAgICAgICAgKi8KICAgICAgICBnZXQgeigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhWzJdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXR0ZXIgZm9yIGB6YCBheGlzIHJvdGF0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHZhbCAtIFRoZSB2YWwgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0IHoodmFsKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gdmFsOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIGB3YCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSB3IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldCB3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2RhdGFbM107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmb3IgYHdgLgogICAgICAgICAqIEBwYXJhbSB2YWwgLSBUaGUgdmFsIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldCB3KHZhbCkgewogICAgICAgICAgICB0aGlzLl9fZGF0YVszXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dGVyIGZyb20gc2NhbGFyIGNvbXBvbmVudHMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0geCAtIFRoZSB4IGF4aXMgcm90YXRpb24uCiAgICAgICAgICogQHBhcmFtIHkgIC0gVGhlIHkgYXhpcyByb3RhdGlvbi4KICAgICAgICAgKiBAcGFyYW0geiAgLSBUaGUgeiBheGlzIHJvdGF0aW9uLgogICAgICAgICAqIEBwYXJhbSB3ICAtIFRoZSB3IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldCh4LCB5LCB6LCB3KSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0geDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSB5OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IHo7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gdzsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgc3RhdGUgb2YgdGhlIFF1YXQgY2xhc3MgdXNpbmcgYSBGbG9hdDMyQXJyYXkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZmxvYXQzMkFycmF5IC0gVGhlIGZsb2F0MzJBcnJheSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXREYXRhQXJyYXkoZmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhID0gZmxvYXQzMkFycmF5OyAvLyBUT0RPOiBhZGRlZCBjYXN0CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHRlciBmcm9tIGFub3RoZXIgdmVjdG9yLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIHZlY3RvciB0byBzZXQgZnJvbS4KICAgICAgICAgKi8KICAgICAgICBzZXRGcm9tT3RoZXIob3RoZXIpIHsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IG90aGVyLnk7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gb3RoZXIuejsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSBvdGhlci53OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhpcyBRdWF0IGZyb20gYSBldWxlciByb3RhdGlvbi4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBldWxlckFuZ2xlcyAtIFRoZSBldWxlciBhbmdsZXMgcm90YXRpb24uCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbUV1bGVyQW5nbGVzKGV1bGVyQW5nbGVzKSB7CiAgICAgICAgICAgIGNvbnN0IG9yZGVyZWQgPSBuZXcgVmVjMygpOwogICAgICAgICAgICBzd2l0Y2ggKGV1bGVyQW5nbGVzLm9yZGVyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgLy8gJ1hZWicKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkLnNldChldWxlckFuZ2xlcy54LCAtZXVsZXJBbmdsZXMueSwgZXVsZXJBbmdsZXMueik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgLy8gJ1laWCcKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkLnNldChldWxlckFuZ2xlcy55LCAtZXVsZXJBbmdsZXMueiwgZXVsZXJBbmdsZXMueCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgLy8gJ1pYWScKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkLnNldChldWxlckFuZ2xlcy56LCAtZXVsZXJBbmdsZXMueCwgZXVsZXJBbmdsZXMueSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgLy8gJ1haWScKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkLnNldChldWxlckFuZ2xlcy54LCBldWxlckFuZ2xlcy56LCBldWxlckFuZ2xlcy55KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAvLyAnWllYJwogICAgICAgICAgICAgICAgICAgIG9yZGVyZWQuc2V0KGV1bGVyQW5nbGVzLnosIGV1bGVyQW5nbGVzLnksIGV1bGVyQW5nbGVzLngpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIC8vICdZWFonCiAgICAgICAgICAgICAgICAgICAgb3JkZXJlZC5zZXQoZXVsZXJBbmdsZXMueSwgZXVsZXJBbmdsZXMueCwgZXVsZXJBbmdsZXMueik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBFdWxlckFuZ2xlcyBvcmRlcjogJHtldWxlckFuZ2xlcy5vcmRlcn1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0aSA9IG9yZGVyZWQueCAqIDAuNTsKICAgICAgICAgICAgY29uc3QgdGogPSBvcmRlcmVkLnkgKiAwLjU7CiAgICAgICAgICAgIGNvbnN0IHRrID0gb3JkZXJlZC56ICogMC41OwogICAgICAgICAgICBjb25zdCBjaSA9IE1hdGguY29zKHRpKTsKICAgICAgICAgICAgY29uc3QgY2ogPSBNYXRoLmNvcyh0aik7CiAgICAgICAgICAgIGNvbnN0IGNrID0gTWF0aC5jb3ModGspOwogICAgICAgICAgICBjb25zdCBzaSA9IE1hdGguc2luKHRpKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBNYXRoLnNpbih0aik7CiAgICAgICAgICAgIGNvbnN0IHNrID0gTWF0aC5zaW4odGspOwogICAgICAgICAgICBjb25zdCBjYyA9IGNpICogY2s7CiAgICAgICAgICAgIGNvbnN0IGNzID0gY2kgKiBzazsKICAgICAgICAgICAgY29uc3Qgc2MgPSBzaSAqIGNrOwogICAgICAgICAgICBjb25zdCBzcyA9IHNpICogc2s7CiAgICAgICAgICAgIGNvbnN0IGFpID0gY2ogKiBzYyAtIHNqICogY3M7CiAgICAgICAgICAgIGNvbnN0IGFqID0gY2ogKiBzcyArIHNqICogY2M7CiAgICAgICAgICAgIGNvbnN0IGFrID0gY2ogKiBjcyAtIHNqICogc2M7CiAgICAgICAgICAgIHRoaXMudyA9IGNqICogY2MgKyBzaiAqIHNzOwogICAgICAgICAgICBzd2l0Y2ggKGV1bGVyQW5nbGVzLm9yZGVyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgLy8gJyBYWVonCiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gYWk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy55ID0gLWFqOwogICAgICAgICAgICAgICAgICAgIHRoaXMueiA9IGFrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIC8vICdZWlgnCiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gYWs7CiAgICAgICAgICAgICAgICAgICAgdGhpcy55ID0gYWk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy56ID0gLWFqOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIC8vICdaWFknCiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gLWFqOwogICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IGFrOwogICAgICAgICAgICAgICAgICAgIHRoaXMueiA9IGFpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIC8vICdYWlknCiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gYWk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy55ID0gYWs7CiAgICAgICAgICAgICAgICAgICAgdGhpcy56ID0gYWo7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgLy8gJ1pZWCcKICAgICAgICAgICAgICAgICAgICB0aGlzLnggPSBhazsKICAgICAgICAgICAgICAgICAgICB0aGlzLnkgPSBhajsKICAgICAgICAgICAgICAgICAgICB0aGlzLnogPSBhaTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAvLyAnWVhaJwogICAgICAgICAgICAgICAgICAgIHRoaXMueCA9IGFqOwogICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IGFpOwogICAgICAgICAgICAgICAgICAgIHRoaXMueiA9IGFrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgRXVsZXJBbmdsZXMgb3JkZXI6ICR7ZXVsZXJBbmdsZXMub3JkZXJ9YCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgUXVhdCB0byBhbiBFdWxlckFuZ2xlcwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJvdGF0aW9uT3JkZXIgLSBUaGUgb3JkZXIgaW4gd2hpY2ggdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b0V1bGVyQW5nbGVzKHJvdGF0aW9uT3JkZXIpIHsKICAgICAgICAgICAgY29uc3Qgb3JkZXJlZCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIHN3aXRjaCAocm90YXRpb25PcmRlcikgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIC8qICcgWFlaJyAqLwogICAgICAgICAgICAgICAgICAgIG9yZGVyZWQuc2V0KHRoaXMueiwgdGhpcy54LCB0aGlzLnkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIC8qICdZWlgnICovCiAgICAgICAgICAgICAgICAgICAgb3JkZXJlZC5zZXQodGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgLyogJ1pYWScgKi8KICAgICAgICAgICAgICAgICAgICBvcmRlcmVkLnNldCh0aGlzLnksIHRoaXMueiwgdGhpcy54KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAvKiAnWFpZJyAqLwogICAgICAgICAgICAgICAgICAgIG9yZGVyZWQuc2V0KHRoaXMueSwgLXRoaXMueCwgdGhpcy56KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAvKiAnWllYJyAqLwogICAgICAgICAgICAgICAgICAgIG9yZGVyZWQuc2V0KHRoaXMueCwgLXRoaXMueiwgdGhpcy55KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAvKiAnWVhaJyAqLwogICAgICAgICAgICAgICAgICAgIG9yZGVyZWQuc2V0KHRoaXMueiwgLXRoaXMueSwgdGhpcy54KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJvdGF0aW9uIG9yZGVyOicgKyByb3RhdGlvbk9yZGVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBldWxlciA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlc3QgPSBvcmRlcmVkLnggKiBvcmRlcmVkLnkgKyBvcmRlcmVkLnogKiB0aGlzLnc7CiAgICAgICAgICAgIGlmICh0ZXN0ID4gMC40OTk5OSkgewogICAgICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgbm9ydGggcG9sZQogICAgICAgICAgICAgICAgZXVsZXIueSA9IDIuMCAqIE1hdGguYXRhbjIob3JkZXJlZC54LCB0aGlzLncpOwogICAgICAgICAgICAgICAgZXVsZXIueiA9IE1hdGguUEkgKiAwLjU7CiAgICAgICAgICAgICAgICBldWxlci54ID0gMC4wOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHRlc3QgPCAtMC40OTk5OSkgewogICAgICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICAgICAgZXVsZXIueSA9IC0yLjAgKiBNYXRoLmF0YW4yKG9yZGVyZWQueCwgdGhpcy53KTsKICAgICAgICAgICAgICAgIGV1bGVyLnogPSBNYXRoLlBJICogLTAuNTsKICAgICAgICAgICAgICAgIGV1bGVyLnggPSAwLjA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBzcXggPSBvcmRlcmVkLnggKiBvcmRlcmVkLng7CiAgICAgICAgICAgICAgICBjb25zdCBzcXkgPSBvcmRlcmVkLnkgKiBvcmRlcmVkLnk7CiAgICAgICAgICAgICAgICBjb25zdCBzcXogPSBvcmRlcmVkLnogKiBvcmRlcmVkLno7CiAgICAgICAgICAgICAgICBldWxlci55ID0gTWF0aC5hdGFuMigyLjAgKiBvcmRlcmVkLnkgKiB0aGlzLncgLSAyLjAgKiBvcmRlcmVkLnggKiBvcmRlcmVkLnosIDEuMCAtIDIuMCAqIHNxeSAtIDIuMCAqIHNxeik7CiAgICAgICAgICAgICAgICBldWxlci56ID0gTWF0aC5hc2luKDIuMCAqIHRlc3QpOwogICAgICAgICAgICAgICAgZXVsZXIueCA9IE1hdGguYXRhbjIoMi4wICogb3JkZXJlZC54ICogdGhpcy53IC0gMi4wICogb3JkZXJlZC55ICogb3JkZXJlZC56LCAxLjAgLSAyLjAgKiBzcXggLSAyLjAgKiBzcXopOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAocm90YXRpb25PcmRlcikgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIC8qICcgWFlaJyAqLwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXVsZXJBbmdsZXMoZXVsZXIueSwgZXVsZXIueiwgZXVsZXIueCwgcm90YXRpb25PcmRlcik7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgLyogJ1laWCcgKi8KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV1bGVyQW5nbGVzKGV1bGVyLngsIGV1bGVyLnksIGV1bGVyLnosIHJvdGF0aW9uT3JkZXIpOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIC8qICdaWFknICovCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFdWxlckFuZ2xlcyhldWxlci56LCBldWxlci54LCBldWxlci55LCByb3RhdGlvbk9yZGVyKTsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAvKiAnWFpZJyAqLwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXVsZXJBbmdsZXMoLWV1bGVyLnksIGV1bGVyLngsIGV1bGVyLnosIHJvdGF0aW9uT3JkZXIpOwogICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIC8qICdaWVgnICovCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFdWxlckFuZ2xlcyhldWxlci54LCBldWxlci56LCAtZXVsZXIueSwgcm90YXRpb25PcmRlcik7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgLyogJ1lYWicgKi8KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV1bGVyQW5nbGVzKGV1bGVyLnosIC1ldWxlci55LCBldWxlci54LCByb3RhdGlvbk9yZGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXQgdGhpcyBRdWF0IHRvIGEgcm90YXRpb24gZGVmaW5lZCBieSBhbiBheGlzIGFuZCBhbiBhbmdsZSAoaW4gcmFkaWFucykuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gYXhpcyAtIFRoZSBheGlzIGFyb3VuZCB3aGljaCB0byByb3RhdGUuCiAgICAgICAgICogQHBhcmFtIGFuZ2xlIC0gVGhlIGFuZ2xlIHRvIHJvdGF0ZQogICAgICAgICAqLwogICAgICAgIHNldEZyb21BeGlzQW5kQW5nbGUoYXhpcywgYW5nbGUpIHsKICAgICAgICAgICAgY29uc3QgaGFsZkFuZ2xlID0gYW5nbGUgLyAyLjA7CiAgICAgICAgICAgIGNvbnN0IHZlYyA9IGF4aXMubm9ybWFsaXplKCkuc2NhbGUoTWF0aC5zaW4oaGFsZkFuZ2xlKSk7CiAgICAgICAgICAgIHRoaXMuc2V0KHZlYy54LCB2ZWMueSwgdmVjLnosIE1hdGguY29zKGhhbGZBbmdsZSkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBzdGF0ZSBvZiB0aGUgUXVhdCB0byBsb29rIGluIGEgcGFydGljdWxhciBkaXJlY3Rpb24gYWxvbmcgdGhlIHogYXhpcy4KICAgICAgICAgKiA+IFRoZSBjYW1lcmEgbG9va3MgZG93biB0aGUgbmVnYXRpdmUgeiBheGlzLCBzbyB0byBzZXQgYSByb3RhdGlvbiB2YWx1ZQogICAgICAgICAqID4gZm9yIHRoZSBjYW1lcmEsIHJlbWVtYmVyIHRvIG5lZ2F0ZSB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBkaXIgLSBUaGUgZGlyZWN0aW9uIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSB1cCAtIFRoZSB1cCB2ZWN0b3IuCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbURpcmVjdGlvbkFuZFVwdmVjdG9yKGRpciwgdXApIHsKICAgICAgICAgICAgY29uc3QgbWF0MyA9IG5ldyBNYXQzKCk7CiAgICAgICAgICAgIG1hdDMuc2V0RnJvbURpcmVjdGlvbkFuZFVwdmVjdG9yKGRpciwgdXApOwogICAgICAgICAgICB0aGlzLnNldEZyb21NYXQzKG1hdDMpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBzdGF0ZSBvZiB0aGUgYFF1YXRgIGZyb20gdHdvIGBWZWMzYC4gVGhlIHF1YXRlcm5pb24gd291bGQgdGhlbiByZXByZXNlbnQgdGhlIHJvdGF0aW9uIGZyb20gdjAgdG8gdjEgaW4gM2Qgc3BhY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdjAgLSBUaGUgdjAgdW5pdCB2ZWN0b3IuCiAgICAgICAgICogQHBhcmFtIHYxIC0gVGhlIHYxIHVuaXQgdmVjdG9yLgogICAgICAgICAqLwogICAgICAgIHNldEZyb20yVmVjdG9ycyh2MCwgdjEpIHsKICAgICAgICAgICAgY29uc3QgYyA9IHYwLmNyb3NzKHYxKTsKICAgICAgICAgICAgY29uc3QgZCA9IHYwLmRvdCh2MSk7CiAgICAgICAgICAgIGNvbnN0IHMgPSBNYXRoLnNxcnQoKDEgKyBkKSAqIDIpOwogICAgICAgICAgICAvLyB0aGlzLnNldCggcy8yLCBjLnggLyBzLCBjLnkgLyBzLCBjLnogLyBzICk7CiAgICAgICAgICAgIHRoaXMuc2V0KGMueCAvIHMsIGMueSAvIHMsIGMueiAvIHMsIHMgLyAyKTsKICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVJblBsYWNlKCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgUXVhdCBmcm9tIGEgTWF0My4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtYXQzIC0gVGhlIG1hdDMgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbU1hdDMobWF0MykgewogICAgICAgICAgICAvLyBBbGdvcml0aG0gaW4gS2VuIFNob2VtYWtlJ3MgYXJ0aWNsZSBpbiAxOTg3IFNJR0dSQVBIIGNvdXJzZSBub3RlcwogICAgICAgICAgICAvLyBhcnRpY2xlICJRdWF0ZXJuaW9uIENhbGN1bHVzIGFuZCBGYXN0IEFuaW1hdGlvbiIuCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBtYXQzLmFzQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgZlRyYWNlID0gZGF0YVswXSArIGRhdGFbNF0gKyBkYXRhWzhdOwogICAgICAgICAgICBsZXQgZlJvb3Q7CiAgICAgICAgICAgIGlmIChmVHJhY2UgPiAwLjApIHsKICAgICAgICAgICAgICAgIC8vIHx3fCA+IDEvMiwgbWF5IGFzIHdlbGwgY2hvb3NlIHcgPiAxLzIKICAgICAgICAgICAgICAgIGZSb290ID0gTWF0aC5zcXJ0KGZUcmFjZSArIDEpOyAvLyAydwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbM10gPSAwLjUgKiBmUm9vdDsKICAgICAgICAgICAgICAgIGZSb290ID0gMC41IC8gZlJvb3Q7IC8vIDEvKDR3KQogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMF0gPSAoZGF0YVs1XSAtIGRhdGFbN10pICogZlJvb3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IChkYXRhWzZdIC0gZGF0YVsyXSkgKiBmUm9vdDsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzJdID0gKGRhdGFbMV0gLSBkYXRhWzNdKSAqIGZSb290OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gfHd8IDw9IDEvMgogICAgICAgICAgICAgICAgbGV0IGkgPSAwOwogICAgICAgICAgICAgICAgaWYgKGRhdGFbNF0gPiBkYXRhWzBdKQogICAgICAgICAgICAgICAgICAgIGkgPSAxOwogICAgICAgICAgICAgICAgaWYgKGRhdGFbOF0gPiBkYXRhW2kgKiAzICsgaV0pCiAgICAgICAgICAgICAgICAgICAgaSA9IDI7CiAgICAgICAgICAgICAgICBjb25zdCBqID0gKGkgKyAxKSAlIDM7CiAgICAgICAgICAgICAgICBjb25zdCBrID0gKGkgKyAyKSAlIDM7CiAgICAgICAgICAgICAgICBmUm9vdCA9IE1hdGguc3FydChkYXRhW2kgKiAzICsgaV0gLSBkYXRhW2ogKiAzICsgal0gLSBkYXRhW2sgKiAzICsga10gKyAxLjApOwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbaV0gPSAwLjUgKiBmUm9vdDsKICAgICAgICAgICAgICAgIGZSb290ID0gMC41IC8gZlJvb3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVszXSA9IChkYXRhW2ogKiAzICsga10gLSBkYXRhW2sgKiAzICsgal0pICogZlJvb3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVtqXSA9IChkYXRhW2ogKiAzICsgaV0gKyBkYXRhW2kgKiAzICsgal0pICogZlJvb3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVtrXSA9IChkYXRhW2sgKiAzICsgaV0gKyBkYXRhW2kgKiAzICsga10pICogZlJvb3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVJblBsYWNlKCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgUXVhdCBmcm9tIGEgTWF0NC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtYXQ0IC0gVGhlIG1hdDQgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbU1hdDQobWF0NCkgewogICAgICAgICAgICAvLyBBbGdvcml0aG0gaW4gS2VuIFNob2VtYWtlJ3MgYXJ0aWNsZSBpbiAxOTg3IFNJR0dSQVBIIGNvdXJzZSBub3RlcwogICAgICAgICAgICAvLyBhcnRpY2xlICJRdWF0ZXJuaW9uIENhbGN1bHVzIGFuZCBGYXN0IEFuaW1hdGlvbiIuCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBtYXQ0LmFzQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgZlRyYWNlID0gZGF0YVswXSArIGRhdGFbNV0gKyBkYXRhWzEwXTsKICAgICAgICAgICAgbGV0IGZSb290OwogICAgICAgICAgICBpZiAoZlRyYWNlID4gMC4wKSB7CiAgICAgICAgICAgICAgICAvLyB8d3wgPiAxLzIsIG1heSBhcyB3ZWxsIGNob29zZSB3ID4gMS8yCiAgICAgICAgICAgICAgICBmUm9vdCA9IE1hdGguc3FydChmVHJhY2UgKyAxKTsgLy8gMncKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gMC41ICogZlJvb3Q7CiAgICAgICAgICAgICAgICBmUm9vdCA9IDAuNSAvIGZSb290OyAvLyAxLyg0dykKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gKGRhdGFbNl0gLSBkYXRhWzldKSAqIGZSb290OwogICAgICAgICAgICAgICAgdGhpcy5fX2RhdGFbMV0gPSAoZGF0YVs4XSAtIGRhdGFbMl0pICogZlJvb3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVsyXSA9IChkYXRhWzFdIC0gZGF0YVs0XSkgKiBmUm9vdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHx3fCA8PSAxLzIKICAgICAgICAgICAgICAgIGxldCBpID0gMDsKICAgICAgICAgICAgICAgIGlmIChkYXRhWzVdID4gZGF0YVswXSkKICAgICAgICAgICAgICAgICAgICBpID0gMTsKICAgICAgICAgICAgICAgIGlmIChkYXRhWzEwXSA+IGRhdGFbaSAqIDQgKyBpXSkKICAgICAgICAgICAgICAgICAgICBpID0gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDEpICUgMzsKICAgICAgICAgICAgICAgIGNvbnN0IGsgPSAoaSArIDIpICUgMzsKICAgICAgICAgICAgICAgIGZSb290ID0gTWF0aC5zcXJ0KGRhdGFbaSAqIDQgKyBpXSAtIGRhdGFbaiAqIDQgKyBqXSAtIGRhdGFbayAqIDQgKyBrXSArIDEuMCk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZGF0YVtpXSA9IDAuNSAqIGZSb290OwogICAgICAgICAgICAgICAgZlJvb3QgPSAwLjUgLyBmUm9vdDsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gKGRhdGFbaiAqIDQgKyBrXSAtIGRhdGFbayAqIDQgKyBqXSkgKiBmUm9vdDsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhW2pdID0gKGRhdGFbaiAqIDQgKyBpXSArIGRhdGFbaSAqIDQgKyBqXSkgKiBmUm9vdDsKICAgICAgICAgICAgICAgIHRoaXMuX19kYXRhW2tdID0gKGRhdGFbayAqIDQgKyBpXSArIGRhdGFbaSAqIDQgKyBrXSkgKiBmUm9vdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZUluUGxhY2UoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2tzIGlmIHRoZSBhbmdsZSBvZiB0aGUgUXVhdCBpcyBsZXNzIHRoYXQgYCBOdW1iZXIuRVBTSUxPTmAKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAgICAgICovCiAgICAgICAgaXNJZGVudGl0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QW5nbGUoKSA8IE51bWJlci5FUFNJTE9OOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGFuZ2xlIG9mIHRoZSBRdWF0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0QW5nbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFjb3ModGhpcy53KSAqIDIuMDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2tzIGlmIHRoaXMgUXVhdCBjb250YWlucyB0aGUgc2FtZSB2YWx1ZXMgYXMgdGhlIG90aGVyIFF1YXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgUXVhdCB0byBjb21wYXJlIHdpdGguCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYHRydWVgIGlmIGFyZSB0aGUgc2FtZSBWZWN0b3IsIG90aGVyd2lzZSwgYGZhbHNlYC4KICAgICAgICAgKi8KICAgICAgICBpc0VxdWFsKG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggPT0gb3RoZXIueCAmJiB0aGlzLnkgPT0gb3RoZXIueSAmJiB0aGlzLnogPT0gb3RoZXIueiAmJiB0aGlzLncgPT0gb3RoZXIudzsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgUXVhdCBpcyBOT1QgZXhhY3RseSB0aGUgc2FtZSBvdGhlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBRdWF0IHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0cnVlIG9yIGZhbHNlLgogICAgICAgICAqLwogICAgICAgIG5vdEVxdWFscyhvdGhlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy54ICE9IG90aGVyLnggJiYgdGhpcy55ICE9IG90aGVyLnkgJiYgdGhpcy56ICE9IG90aGVyLnogJiYgdGhpcy53ICE9IG90aGVyLnc7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIFF1YXQgaXMgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBhcyBvdGhlcgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFF1YXQgdG8gY29tcGFyZSB3aXRoLgogICAgICAgICAqIEBwYXJhbSBwcmVjaXNpb24gLSBUaGUgcHJlY2lzaW9uIHRvIHdoaWNoIHRoZSB2YWx1ZXMgbXVzdCBtYXRjaC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0cnVlIG9yIGZhbHNlLgogICAgICAgICAqLwogICAgICAgIGFwcHJveEVxdWFsKG90aGVyLCBwcmVjaXNpb24gPSBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICByZXR1cm4gKE1hdGguYWJzKHRoaXMueCAtIG90aGVyLngpIDwgcHJlY2lzaW9uICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicyh0aGlzLnkgLSBvdGhlci55KSA8IHByZWNpc2lvbiAmJgogICAgICAgICAgICAgICAgTWF0aC5hYnModGhpcy56IC0gb3RoZXIueikgPCBwcmVjaXNpb24gJiYKICAgICAgICAgICAgICAgIE1hdGguYWJzKHRoaXMudyAtIG90aGVyLncpIDwgcHJlY2lzaW9uKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkcyBvdGhlciB0byB0aGlzIFF1YXQgYW5kIHJldHVybiB0aGUgcmVzdWx0IGFzIGEgbmV3IFF1YXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgUXVhdCB0byBhZGQuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgUXVhdC4KICAgICAgICAgKi8KICAgICAgICBhZGQob3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWF0KHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnksIHRoaXMueiArIG90aGVyLnosIHRoaXMudyArIG90aGVyLncpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIG90aGVyIHRvIHRoaXMgUXVhdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBRdWF0IHRvIGFkZC4KICAgICAgICAgKi8KICAgICAgICBhZGRJblBsYWNlKG90aGVyKSB7CiAgICAgICAgICAgIHRoaXMueCArPSBvdGhlci54OwogICAgICAgICAgICB0aGlzLnkgKz0gb3RoZXIueTsKICAgICAgICAgICAgdGhpcy56ICs9IG90aGVyLno7CiAgICAgICAgICAgIHRoaXMudyArPSBvdGhlci53OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTdWJ0cmFjdHMgb3RoZXIgZnJvbSB0aGlzIFF1YXQgYW5kIHJldHVybnMgdGhlIHJlc3VsdCBhcyBhIG5ldyBRdWF0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFF1YXQgdG8gc3VidHJhY3QuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgUXVhdC4KICAgICAgICAgKi8KICAgICAgICBzdWJ0cmFjdChvdGhlcikgewogICAgICAgICAgICByZXR1cm4gbmV3IFF1YXQodGhpcy54IC0gb3RoZXIueCwgdGhpcy55IC0gb3RoZXIueSwgdGhpcy56IC0gb3RoZXIueiwgdGhpcy53IC0gb3RoZXIudyk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNjYWxlcyB0aGlzIFF1YXQgYnkgc2NhbGFyIGFuZCByZXR1cm5zIHRoZSByZXN1bHQgYXMgYSBuZXcgUXVhdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzY2FsYXIgLSBUaGUgc2NhbGFyIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgc2NhbGUoc2NhbGFyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCh0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhciwgdGhpcy56ICogc2NhbGFyLCB0aGlzLncgKiBzY2FsYXIpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTY2FsZXMgdGhpcyBRdWF0IGJ5IHNjYWxhci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzY2FsYXIgLSBUaGUgc2NhbGFyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNjYWxlSW5QbGFjZShzY2FsYXIpIHsKICAgICAgICAgICAgdGhpcy54ICo9IHNjYWxhcjsKICAgICAgICAgICAgdGhpcy55ICo9IHNjYWxhcjsKICAgICAgICAgICAgdGhpcy56ICo9IHNjYWxhcjsKICAgICAgICAgICAgdGhpcy53ICo9IHNjYWxhcjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsY3VsYXRlcyB0aGUgbGVuZ3RoIG9mIHRoaXMgUXVhdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBsZW5ndGguCiAgICAgICAgICovCiAgICAgICAgbGVuZ3RoKCkgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl9fZGF0YVsxXTsKICAgICAgICAgICAgY29uc3QgeiA9IHRoaXMuX19kYXRhWzJdOwogICAgICAgICAgICBjb25zdCB3ID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqIHcpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGlzIFF1YXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbGVuZ3RoLgogICAgICAgICAqLwogICAgICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fX2RhdGFbMl07CiAgICAgICAgICAgIGNvbnN0IHcgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgcmV0dXJuIHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBOb3JtYWxpemVzIHRoZSBRdWF0IGFuZCByZXR1cm5zIGl0IGFzIGEgbmV3IFF1YXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgUXVhdCBub3JtYWxpemVkLgogICAgICAgICAqLwogICAgICAgIG5vcm1hbGl6ZSgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX19kYXRhWzBdOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fX2RhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgdyA9IHRoaXMuX19kYXRhWzNdOwogICAgICAgICAgICBsZXQgbGVuID0geCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqIHc7CiAgICAgICAgICAgIGlmIChsZW4gPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWF0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gVE9ETzogZXZhbHVhdGUgdXNlIG9mIGdsbV9pbnZzcXJ0IGhlcmU/CiAgICAgICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWF0KHggKiBsZW4sIHkgKiBsZW4sIHogKiBsZW4sIHcgKiBsZW4pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBOb3JtYWxpemVzIHRoZSBRdWF0LCBtb2RpZnlpbmcgaXRzIHZhbHVlcyBpbiBwbGFjZS4KICAgICAgICAgKi8KICAgICAgICBub3JtYWxpemVJblBsYWNlKCkgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl9fZGF0YVsxXTsKICAgICAgICAgICAgY29uc3QgeiA9IHRoaXMuX19kYXRhWzJdOwogICAgICAgICAgICBjb25zdCB3ID0gdGhpcy5fX2RhdGFbM107CiAgICAgICAgICAgIGxldCBsZW4gPSB4ICogeCArIHkgKiB5ICsgeiAqIHogKyB3ICogdzsKICAgICAgICAgICAgaWYgKGxlbiA8IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVuID0gMSAvIE1hdGguc3FydChsZW4pOwogICAgICAgICAgICB0aGlzLnNldCh4ICogbGVuLCB5ICogbGVuLCB6ICogbGVuLCB3ICogbGVuKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhpcyBxdWF0IGFnYWluc3QgYW5vdGhlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBRdWF0IHRvIGNvbXBhcmUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgZG90IHByb2R1Y3QuCiAgICAgICAgICovCiAgICAgICAgZG90KG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnggKiBvdGhlci54ICsgdGhpcy55ICogb3RoZXIueSArIHRoaXMueiAqIG90aGVyLnogKyB0aGlzLncgKiBvdGhlci53OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHR3byBRdWF0cyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgbmV3IFF1YXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgUXVhdCB0byBjYWxjdWxhdGUgd2l0aC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgY3Jvc3MgcHJvZHVjdCBhcyBhIG5ldyBRdWF0LgogICAgICAgICAqLwogICAgICAgIGNyb3NzKG90aGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICAgICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IGF0ID0gdGhpcy53OwogICAgICAgICAgICBjb25zdCBieCA9IG90aGVyLng7CiAgICAgICAgICAgIGNvbnN0IGJ5ID0gb3RoZXIueTsKICAgICAgICAgICAgY29uc3QgYnogPSBvdGhlci56OwogICAgICAgICAgICBjb25zdCBidCA9IG90aGVyLnc7CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdChheSAqIGJ6IC0gYXogKiBieSwgYXogKiBidCAtIGF0ICogYnosIGF0ICogYnggLSBheCAqIGJ0LCBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHJvdGF0aW9uYWwgY29uanVnYXRlIG9mIHRoaXMgUXVhdC4KICAgICAgICAgKiBDb25qdWdhdGlvbiByZXByZXNlbnRzIHRoZSBzYW1lIHJvdGF0aW9uIG9mIHRoZSBRdWF0IGJ1dAogICAgICAgICAqIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24gYXJvdW5kIHRoZSByb3RhdGlvbmFsIGF4aXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gdGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBjb25qdWdhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCgtdGhpcy54LCAtdGhpcy55LCAtdGhpcy56LCB0aGlzLncpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGludmVyc2Ugb2YgdGhlIGBRdWF0YAogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgUXVhdC4KICAgICAgICAgKi8KICAgICAgICBpbnZlcnNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jb25qdWdhdGUoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWxpZ25zIHRoaXMgcXVhdGVybmlvbiB3aXRoIGFub3RoZXIgb25lIGVuc3VyaW5nIHRoYXQgdGhlIGRlbHRhIGJldHdlZW4KICAgICAgICAgKiB0aGUgUXVhdCB2YWx1ZXMgaXMgdGhlIHNob3J0ZXN0IHBhdGggb3ZlciB0aGUgaHlwZXItc3BoZXJlLgogICAgICAgICAqCiAgICAgICAgICogIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBRdWF0IHRvIGRpdmlkZSBieS4KICAgICAgICAgKi8KICAgICAgICBhbGlnbldpdGgob3RoZXIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZG90KG90aGVyKSA8IDAuMCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXQoLXRoaXMueCwgLXRoaXMueSwgLXRoaXMueiwgLXRoaXMudyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTXVsdGlwbGllcyB0d28gdGhpcyBxdWF0IGJ5IGFub3RoZXIgcmV0dXJuaW5nIHRoZSByZXN1bHQgYXMgYSBuZXcgUXVhdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBvdGhlciBRdWF0IHRvIG11bHRpcGx5LgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFF1YXQuCiAgICAgICAgICovCiAgICAgICAgbXVsdGlwbHkob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgYXggPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgYXkgPSB0aGlzLl9fZGF0YVsxXTsKICAgICAgICAgICAgY29uc3QgYXogPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYXcgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgY29uc3QgYnggPSBvdGhlci5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGJ5ID0gb3RoZXIuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBieiA9IG90aGVyLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYncgPSBvdGhlci5fX2RhdGFbM107CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdChheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5LCBheSAqIGJ3ICsgYXcgKiBieSArIGF6ICogYnggLSBheCAqIGJ6LCBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4LCBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTXVsdGlwbGllcyB0aGlzIHF1YXQgYnkgYW5vdGhlciwgbW9kaWZ5aW5nIGl0cyB2YWx1ZXMgaW4gcGxhY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgb3RoZXIgUXVhdCB0byBtdWx0aXBseS4KICAgICAgICAgKi8KICAgICAgICBtdWx0aXBseUluUGxhY2Uob3RoZXIpIHsKICAgICAgICAgICAgY29uc3QgYXggPSB0aGlzLl9fZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgYXkgPSB0aGlzLl9fZGF0YVsxXTsKICAgICAgICAgICAgY29uc3QgYXogPSB0aGlzLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYXcgPSB0aGlzLl9fZGF0YVszXTsKICAgICAgICAgICAgY29uc3QgYnggPSBvdGhlci5fX2RhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IGJ5ID0gb3RoZXIuX19kYXRhWzFdOwogICAgICAgICAgICBjb25zdCBieiA9IG90aGVyLl9fZGF0YVsyXTsKICAgICAgICAgICAgY29uc3QgYncgPSBvdGhlci5fX2RhdGFbM107CiAgICAgICAgICAgIHRoaXMuc2V0KGF4ICogYncgKyBhdyAqIGJ4ICsgYXkgKiBieiAtIGF6ICogYnksIGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYnosIGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYngsIGF3ICogYncgLSBheCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSb3RhdGVzIGEgdmVjdG9yIGJ5IHRoaXMgcXVhdGVybmlvbi4KICAgICAgICAgKiBEb24ndCBmb3JnZXQgdG8gbm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uIHVubGVzcwogICAgICAgICAqIHlvdSB3YW50IGF4aWFsIHRyYW5zbGF0aW9uIGFzIHdlbGwgYXMgcm90YXRpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVjMyAtIFRoZSB2ZWMzIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFZlYzMuCiAgICAgICAgICovCiAgICAgICAgcm90YXRlVmVjMyh2ZWMzKSB7CiAgICAgICAgICAgIGNvbnN0IHZxID0gbmV3IFF1YXQodmVjMy54LCB2ZWMzLnksIHZlYzMueiwgMC4wKTsKICAgICAgICAgICAgY29uc3QgcHEgPSB0aGlzLm11bHRpcGx5KHZxKS5tdWx0aXBseSh0aGlzLmNvbmp1Z2F0ZSgpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHBxLngsIHBxLnksIHBxLnopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiB0byBhIHJvdGF0aW9uIGJ5IHRoZSBnaXZlbiBhbmdsZSBhYm91dCB0aGUgWCBheGlzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJhZCAtIEFuZ2xlIChpbiByYWRpYW5zKSB0byByb3RhdGUuCiAgICAgICAgICovCiAgICAgICAgcm90YXRlWChyYWQpIHsKICAgICAgICAgICAgcmFkICo9IDAuNTsKICAgICAgICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgICAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICAgICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgICAgICAgIGNvbnN0IGJ4ID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgY29uc3QgYncgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICB0aGlzLnggPSBheCAqIGJ3ICsgYXcgKiBieDsKICAgICAgICAgICAgdGhpcy55ID0gYXkgKiBidyArIGF6ICogYng7CiAgICAgICAgICAgIHRoaXMueiA9IGF6ICogYncgLSBheSAqIGJ4OwogICAgICAgICAgICB0aGlzLncgPSBhdyAqIGJ3IC0gYXggKiBieDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gYSByb3RhdGlvbiBieSB0aGUgZ2l2ZW4gYW5nbGUgYWJvdXQgdGhlIFkgYXhpcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByYWQgLSBBbmdsZSAoaW4gcmFkaWFucykgdG8gcm90YXRlLgogICAgICAgICAqLwogICAgICAgIHJvdGF0ZVkocmFkKSB7CiAgICAgICAgICAgIHJhZCAqPSAwLjU7CiAgICAgICAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICAgICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICAgICAgICBjb25zdCBieSA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIGNvbnN0IGJ3ID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgdGhpcy54ID0gYXggKiBidyAtIGF6ICogYnk7CiAgICAgICAgICAgIHRoaXMueSA9IGF5ICogYncgKyBhdyAqIGJ5OwogICAgICAgICAgICB0aGlzLnogPSBheiAqIGJ3ICsgYXggKiBieTsKICAgICAgICAgICAgdGhpcy53ID0gYXcgKiBidyAtIGF5ICogYnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIGEgcm90YXRpb24gYnkgdGhlIGdpdmVuIGFuZ2xlIGFib3V0IHRoZSBaIGF4aXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmFkIC0gQW5nbGUgKGluIHJhZGlhbnMpIHRvIHJvdGF0ZS4KICAgICAgICAgKi8KICAgICAgICByb3RhdGVaKHJhZCkgewogICAgICAgICAgICByYWQgKj0gMC41OwogICAgICAgICAgICBjb25zdCBheCA9IHRoaXMueDsKICAgICAgICAgICAgY29uc3QgYXkgPSB0aGlzLnk7CiAgICAgICAgICAgIGNvbnN0IGF6ID0gdGhpcy56OwogICAgICAgICAgICBjb25zdCBhdyA9IHRoaXMudzsKICAgICAgICAgICAgY29uc3QgYnogPSBNYXRoLnNpbihyYWQpOwogICAgICAgICAgICBjb25zdCBidyA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIHRoaXMueCA9IGF4ICogYncgKyBheSAqIGJ6OwogICAgICAgICAgICB0aGlzLnkgPSBheSAqIGJ3IC0gYXggKiBiejsKICAgICAgICAgICAgdGhpcy56ID0gYXogKiBidyArIGF3ICogYno7CiAgICAgICAgICAgIHRoaXMudyA9IGF3ICogYncgLSBheiAqIGJ6OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFF1YXQgdG8gYSBNYXQzIChhIDN4MyBtYXRyaXgpLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRSZXR1cm5zIGEgbmV3IE1hdDMuCiAgICAgICAgICovCiAgICAgICAgdG9NYXQzKCkgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICAgICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICAgICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICAgICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICAgICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICAgICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgICAgICAgY29uc3QgeXggPSB5ICogeDI7CiAgICAgICAgICAgIGNvbnN0IHl5ID0geSAqIHkyOwogICAgICAgICAgICBjb25zdCB6eCA9IHogKiB4MjsKICAgICAgICAgICAgY29uc3QgenkgPSB6ICogeTI7CiAgICAgICAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICAgICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgICAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICAgICAgICBjb25zdCBtYXQzID0gbmV3IE1hdDMoKTsKICAgICAgICAgICAgbWF0My5tMDAgPSAxIC0geXkgLSB6ejsKICAgICAgICAgICAgbWF0My5tMTAgPSB5eCAtIHd6OwogICAgICAgICAgICBtYXQzLm0yMCA9IHp4ICsgd3k7CiAgICAgICAgICAgIG1hdDMubTAxID0geXggKyB3ejsKICAgICAgICAgICAgbWF0My5tMTEgPSAxIC0geHggLSB6ejsKICAgICAgICAgICAgbWF0My5tMjEgPSB6eSAtIHd4OwogICAgICAgICAgICBtYXQzLm0wMiA9IHp4IC0gd3k7CiAgICAgICAgICAgIG1hdDMubTEyID0genkgKyB3eDsKICAgICAgICAgICAgbWF0My5tMjIgPSAxIC0geHggLSB5eTsKICAgICAgICAgICAgcmV0dXJuIG1hdDM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZXMgYSBWZWMzIHZhbHVlIGFsaWduZWQgd2l0aCB0aGUgWCBheGlzIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmVzdWx0aW5nIFZlYzMgdmFsdWUKICAgICAgICAgKi8KICAgICAgICBnZXRYYXhpcygpIHsKICAgICAgICAgICAgY29uc3QgeHkgPSB0aGlzLnggKiB0aGlzLnk7CiAgICAgICAgICAgIGNvbnN0IHh6ID0gdGhpcy54ICogdGhpcy56OwogICAgICAgICAgICBjb25zdCB5eSA9IHRoaXMueSAqIHRoaXMueTsKICAgICAgICAgICAgY29uc3QgeXcgPSB0aGlzLnkgKiB0aGlzLnc7CiAgICAgICAgICAgIGNvbnN0IHp6ID0gdGhpcy56ICogdGhpcy56OwogICAgICAgICAgICBjb25zdCB6dyA9IHRoaXMueiAqIHRoaXMudzsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKDEuMCAtIDIuMCAqICh6eiArIHl5KSwgMi4wICogKHh5ICsgencpLCAyLjAgKiAoeHogLSB5dykpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIGEgVmVjMyB2YWx1ZSBhbGlnbmVkIHdpdGggdGhlIFkgYXhpcyBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJlc3VsdGluZyBWZWMzIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgZ2V0WWF4aXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHh4ID0gdGhpcy54ICogdGhpcy54OwogICAgICAgICAgICBjb25zdCB4eSA9IHRoaXMueCAqIHRoaXMueTsKICAgICAgICAgICAgY29uc3QgeHcgPSB0aGlzLnggKiB0aGlzLnc7CiAgICAgICAgICAgIGNvbnN0IHl6ID0gdGhpcy55ICogdGhpcy56OwogICAgICAgICAgICBjb25zdCB6eiA9IHRoaXMueiAqIHRoaXMuejsKICAgICAgICAgICAgY29uc3QgencgPSB0aGlzLnogKiB0aGlzLnc7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMygyLjAgKiAoeHkgLSB6dyksIDEuMCAtIDIuMCAqICh6eiArIHh4KSwgMi4wICogKHl6ICsgeHcpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsY3VsYXRlcyBhIFZlYzMgdmFsdWUgYWxpZ25lZCB3aXRoIHRoZSBaIGF4aXMgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXN1bHRpbmcgVmVjMyB2YWx1ZQogICAgICAgICAqLwogICAgICAgIGdldFpheGlzKCkgewogICAgICAgICAgICBjb25zdCB4eCA9IHRoaXMueCAqIHRoaXMueDsKICAgICAgICAgICAgY29uc3QgeHogPSB0aGlzLnggKiB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IHh3ID0gdGhpcy54ICogdGhpcy53OwogICAgICAgICAgICBjb25zdCB5eSA9IHRoaXMueSAqIHRoaXMueTsKICAgICAgICAgICAgY29uc3QgeXogPSB0aGlzLnkgKiB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IHl3ID0gdGhpcy55ICogdGhpcy53OwogICAgICAgICAgICAvLyBjb25zdCB0ZW1wID0gbmV3IFZlYzMoKQogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzMoMi4wICogKHl3ICsgeHopLCAyLjAgKiAoeXogLSB4dyksIDEuMCAtIDIuMCAqICh5eSArIHh4KSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJlZmxlY3RzIHRoaXMgcXVhdGVybmlvbiBhY2NvcmRpbmcgdG8gdGhlIGF4aXMgcHJvdmlkZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gYXhpc0luZGV4IC0gQW4gaW50ZWdlciB3aXRoIHZhbHVlIG9mIDAgZm9yIHRoZSBYIGF4aXMsIDEgZm9yIHRoZSBZIGF4aXMsIGFuZCAyIGZvciB0aGUgWiBheGlzLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFF1YXQuCiAgICAgICAgICovCiAgICAgICAgbWlycm9yKGF4aXNJbmRleCkgewogICAgICAgICAgICBzd2l0Y2ggKGF4aXNJbmRleCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCh0aGlzLnosIHRoaXMudywgdGhpcy54LCB0aGlzLnkpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCgtdGhpcy53LCB0aGlzLnosIHRoaXMueSwgLXRoaXMueCk7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWF0KHRoaXMueCwgdGhpcy55LCB0aGlzLnosIC10aGlzLncpOwogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFF1YXQodGhpcy56LCB0aGlzLncsIHRoaXMueCwgdGhpcy55KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIFF1YXQgdG8gYSBNYXQ0IChhIDR4NCBtYXRyaXgpLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgTWF0NC4KICAgICAgICAgKi8KICAgICAgICB0b01hdDQoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgICAgICAgIGNvbnN0IHcgPSB0aGlzLnc7CiAgICAgICAgICAgIGNvbnN0IHgyID0geCArIHg7CiAgICAgICAgICAgIGNvbnN0IHkyID0geSArIHk7CiAgICAgICAgICAgIGNvbnN0IHoyID0geiArIHo7CiAgICAgICAgICAgIGNvbnN0IHh4ID0geCAqIHgyOwogICAgICAgICAgICBjb25zdCB5eCA9IHkgKiB4MjsKICAgICAgICAgICAgY29uc3QgeXkgPSB5ICogeTI7CiAgICAgICAgICAgIGNvbnN0IHp4ID0geiAqIHgyOwogICAgICAgICAgICBjb25zdCB6eSA9IHogKiB5MjsKICAgICAgICAgICAgY29uc3QgenogPSB6ICogejI7CiAgICAgICAgICAgIGNvbnN0IHd4ID0gdyAqIHgyOwogICAgICAgICAgICBjb25zdCB3eSA9IHcgKiB5MjsKICAgICAgICAgICAgY29uc3Qgd3ogPSB3ICogejI7CiAgICAgICAgICAgIC8vIFNldCB0aGUgY29sdW1ucwogICAgICAgICAgICBjb25zdCBtYXQ0ID0gbmV3IE1hdDQoKTsKICAgICAgICAgICAgbWF0NC5tMDAgPSAxIC0geXkgLSB6ejsKICAgICAgICAgICAgbWF0NC5tMTAgPSB5eCAtIHd6OwogICAgICAgICAgICBtYXQ0Lm0yMCA9IHp4ICsgd3k7CiAgICAgICAgICAgIG1hdDQubTAxID0geXggKyB3ejsKICAgICAgICAgICAgbWF0NC5tMTEgPSAxIC0geHggLSB6ejsKICAgICAgICAgICAgbWF0NC5tMjEgPSB6eSAtIHd4OwogICAgICAgICAgICBtYXQ0Lm0wMiA9IHp4IC0gd3k7CiAgICAgICAgICAgIG1hdDQubTEyID0genkgKyB3eDsKICAgICAgICAgICAgbWF0NC5tMjIgPSAxIC0geHggLSB5eTsKICAgICAgICAgICAgcmV0dXJuIG1hdDQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFBlcmZvcm1zIGEgbGluZWFyIGludGVycG9sYXRpb24gb2YgdGhpcyBRdWF0IHRvd2FyZHMgYW5vdGhlciBRdWF0LCByZXR1cm5pbmcgdGhlIHJlc3VsdCBhcyBhIG5ldyBRdWF0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyICAtIFRoZSBvdGhlciBRdWF0IHRvIGludGVycG9sYXRlIHRvd2FyZHMuCiAgICAgICAgICogQHBhcmFtIHQgLSBJbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFF1YXQuCiAgICAgICAgICovCiAgICAgICAgbGVycChvdGhlciwgdCkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgUXVhdCh0aGlzLnggKyB0ICogKG90aGVyLnggLSB0aGlzLngpLCB0aGlzLnkgKyB0ICogKG90aGVyLnkgLSB0aGlzLnkpLCB0aGlzLnogKyB0ICogKG90aGVyLnogLSB0aGlzLnopLCB0aGlzLncgKyB0ICogKG90aGVyLncgLSB0aGlzLncpKTsKICAgICAgICAgICAgcmVzdWx0Lm5vcm1hbGl6ZUluUGxhY2UoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gb2YgdGhpcyBRdWF0IHRvd2FyZHMgYW5vdGhlciBRdWF0LCByZXR1cm5pbmcgdGhlIHJlc3VsdCBhcyBhIG5ldyBRdWF0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG90aGVyIC0gVGhlIG90aGVyIFF1YXQgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KICAgICAgICAgKiBAcGFyYW0gdCAtIEludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHR3byBpbnB1dHMuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgUXVhdC4KICAgICAgICAgKi8KICAgICAgICBzbGVycChvdGhlciwgbGFtYmRhKSB7CiAgICAgICAgICAgIC8vLyBodHRwczovL3d3dy5nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9GYXN0QW5kQWNjdXJhdGVTbGVycC5wZGYKICAgICAgICAgICAgY29uc3QgZG90UHJvZHVjdCA9IHRoaXMuZG90KG90aGVyKTsKICAgICAgICAgICAgaWYgKGRvdFByb2R1Y3QgPiAwLjk5OSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAvLyBhbGdvcml0aG0gYWRhcHRlZCBmcm9tIFNob2VtYWtlJ3MgcGFwZXIKICAgICAgICAgICAgLy8gbGFtYmRhIGlzIGluICgwLCDPgC8yXQogICAgICAgICAgICBjb25zdCB0aGV0YSA9IE1hdGguYWNvcyhkb3RQcm9kdWN0KTsKICAgICAgICAgICAgY29uc3Qgc3QgPSBNYXRoLnNpbih0aGV0YSk7CiAgICAgICAgICAgIGNvbnN0IHN1dCA9IE1hdGguc2luKGxhbWJkYSAqIHRoZXRhKTsKICAgICAgICAgICAgY29uc3Qgc291dCA9IE1hdGguc2luKCgxIC0gbGFtYmRhKSAqIHRoZXRhKTsKICAgICAgICAgICAgY29uc3QgY29lZmYxID0gc291dCAvIHN0OwogICAgICAgICAgICBjb25zdCBjb2VmZjIgPSBzdXQgLyBzdDsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFF1YXQoY29lZmYxICogdGhpcy54ICsgY29lZmYyICogb3RoZXIueCwgY29lZmYxICogdGhpcy55ICsgY29lZmYyICogb3RoZXIueSwgY29lZmYxICogdGhpcy56ICsgY29lZmYyICogb3RoZXIueiwgY29lZmYxICogdGhpcy53ICsgY29lZmYyICogb3RoZXIudyk7CiAgICAgICAgICAgIHJlc3VsdC5ub3JtYWxpemVJblBsYWNlKCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENsb25lcyB0aGlzIFF1YXQgYW5kIHJldHVybnMgYSBuZXcgUXVhdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IFF1YXQuCiAgICAgICAgICovCiAgICAgICAgY2xvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCh0aGlzLl9fZGF0YVswXSwgdGhpcy5fX2RhdGFbMV0sIHRoaXMuX19kYXRhWzJdLCB0aGlzLl9fZGF0YVszXSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHR5cGUgYXMgYW4gYXJyYXkuIE9mdGVuIHVzZWQgdG8gcGFzcyB0eXBlcyB0byB0aGUgR1BVLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYXMgYW4gYXJyYXkuCiAgICAgICAgICovCiAgICAgICAgYXNBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRoaXMgVmVjMyB0byBhIHN0cmluZyBpbiBKU09OIGZvcm1hdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcAogICAgICAgICAgICByZXR1cm4gU3RyaW5nRnVuY3Rpb25zLnN0cmluZ2lmeUpTT05XaXRoRml4ZWRQcmVjaXNpb24odGhpcy50b0pTT04oKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSB0b0pTT04gbWV0aG9kIGVuY29kZXMgdGhpcyB0eXBlIGFzIGEganNvbiBvYmplY3QgZm9yIHBlcnNpc3RlbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICB0b0pTT04oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB4OiB0aGlzLngsCiAgICAgICAgICAgICAgICB5OiB0aGlzLnksCiAgICAgICAgICAgICAgICB6OiB0aGlzLnosCiAgICAgICAgICAgICAgICB3OiB0aGlzLncsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBmcm9tSlNPTiBtZXRob2QgZGVjb2RlcyBhIGpzb24gb2JqZWN0IGZvciB0aGlzIHR5cGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaiAtIFRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICBmcm9tSlNPTihqKSB7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzBdID0gai54OwogICAgICAgICAgICB0aGlzLl9fZGF0YVsxXSA9IGoueTsKICAgICAgICAgICAgdGhpcy5fX2RhdGFbMl0gPSBqLno7CiAgICAgICAgICAgIHRoaXMuX19kYXRhWzNdID0gai53OwogICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZUluUGxhY2UoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTG9hZHMgdGhlIHN0YXRlIG9mIHRoZSB2YWx1ZSBmcm9tIGEgYmluYXJ5IHJlYWRlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByZWFkZXIgLSBUaGUgcmVhZGVyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHJlYWRCaW5hcnkocmVhZGVyKSB7CiAgICAgICAgICAgIHRoaXMueCA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICB0aGlzLnkgPSByZWFkZXIubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgdGhpcy56ID0gcmVhZGVyLmxvYWRGbG9hdDMyKCk7CiAgICAgICAgICAgIHRoaXMudyA9IHJlYWRlci5sb2FkRmxvYXQzMigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovCiAgICAvKioKICAgICAqIE1hdGggRnVuY3Rpb25zCiAgICAgKi8KICAgIGNsYXNzIE1hdGhGdW5jdGlvbnMgewogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIFJhZGlhbnMgdG8gRGVncmVlcwogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSByYWQgLSBSYWRpYW5zIHZhbHVlCiAgICAgICAgICogQHJldHVybiAtIERlZ3JlZXMgZXF1aXZhbGVudAogICAgICAgICAqLwogICAgICAgIHN0YXRpYyByYWRUb0RlZyhyYWQpIHsKICAgICAgICAgICAgcmV0dXJuIHJhZCAvIChNYXRoLlBJIC8gMTgwKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgRGVncmVlcyB0byBSYWRpYW50cwogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSBkZWcgLSBEZWdyZWVzIHZhbHVlCiAgICAgICAgICogQHJldHVybiAtICBSYWRpYW5zIGVxdWl2YWxlbnQKICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZGVnVG9SYWQoZGVnKSB7CiAgICAgICAgICAgIHJldHVybiBkZWcgKiAoTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFZlcmlmaWVzIGlmIHRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIGlzIG51bWVyaWMuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIG51bWJlciAtIE51bWJlciB0byB0ZXN0CiAgICAgICAgICogQHJldHVybiAtIGB0cnVlYCB3aGVuIGlzIGEgdmFsaWQgbnVtYmVyCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIGlzTnVtZXJpYyhudW1iZXIpIHsKICAgICAgICAgICAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG51bWJlcikpICYmIGlzRmluaXRlKG51bWJlcik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYXRlcyBhbmQgcmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIHdpdGhpbiB0aGUgc3BlY2lmaWVkIHJhbmdlLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSBtaW4gLSBMb3dlciB2YWx1ZSByYW5kb20gaW50IGNhbiBiZS4KICAgICAgICAgKiBAcGFyYW0gbWF4IC0gSGlnaGVzdCB2YWx1ZSByYW5kb20gaW50IGNhbiBiZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmFuZG9tIG51bWJlciBpbnNpZGUgcmFuZ2UuCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIHJhbmRvbUludChtaW4sIG1heCkgewogICAgICAgICAgICBtaW4gPSBNYXRoLmNlaWwobWluKTsKICAgICAgICAgICAgbWF4ID0gTWF0aC5mbG9vcihtYXgpOwogICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikpICsgbWluOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIGEgbGluZWFsIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gaW5wdXRzIGZvciB0aGUgc3BlY2lmaWVkIHBhcmFtZXRlcih0KS4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gdjAgLQogICAgICAgICAqIEBwYXJhbSB2MSAtCiAgICAgICAgICogQHBhcmFtIHQgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBsZXJwKHYwLCB2MSwgdCkgewogICAgICAgICAgICByZXR1cm4gdjAgKyB0ICogKHYxIC0gdjApOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXN0cmljdHMgdGhlIHNwZWNpZmllZCB2YWx1ZSBiZXR3ZWVuIHR3byBudW1iZXJzCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHZhbHVlCiAgICAgICAgICogQHBhcmFtIG1pbgogICAgICAgICAqIEBwYXJhbSBtYXgKICAgICAgICAgKiBAcmV0dXJuCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIGNsYW1wKHZhbHVlLCBtaW4sIG1heCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodmFsdWUsIG1pbiksIG1heCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG5lYXJlc3QgcG93IG9mIHR3byB2YWx1ZSBvZiB0aGUgc3BlY2lmaWVkIG51bWJlci4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBuZWFyZXN0UG93Mih2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5wb3coMiwgTWF0aC5yb3VuZChNYXRoLmxvZyh2YWx1ZSkgLyBNYXRoLmxvZygyKSkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBuZWFyZXN0IHBvdyBvZiB0ZW4gdmFsdWUgb2YgdGhlIHNwZWNpZmllZCBudW1iZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0KICAgICAgICAgKiBAcmV0dXJuIC0KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgbmVhcmVzdFBvdzEwKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdygxMCwgTWF0aC5yb3VuZChNYXRoLmxvZzEwKHZhbHVlKSAvIE1hdGgubG9nMTAoMTApKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG5leHQgcG93IG9mIHR3byB2YWx1ZSBvZiB0aGUgc3BlY2lmaWVkIG51bWJlci4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBuZXh0UG93Mih2YWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcy5mcmFjdChNYXRoLmxvZzIodmFsdWUpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGV4cCA9IDA7CiAgICAgICAgICAgIHdoaWxlICh2YWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgIGV4cCsrOwogICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA+PiAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAxIDw8IGV4cDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgZnJhY3Rpb25hbCBjb21wb25lbnQgb2YgYSBudW1iZXIKICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBmcmFjdCh2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICBpZiAodmFsdWUgPCAwKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiAtMS4wKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gLXZhbHVlICUgTWF0aC5mbG9vcigtdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWx1ZSA8IDEuMCkKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlICUgTWF0aC5mbG9vcih2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIE1vdmVzIHRoZSBzcGVjaWZpZWQgdmFsdWUgZnJvbSBvbmUgbnVtZXJpYyBkb21haW4ocmFuZ2UpIHRvIGFub3RoZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0KICAgICAgICAgKiBAcGFyYW0gc3RhcnQxIC0KICAgICAgICAgKiBAcGFyYW0gZW5kMSAtCiAgICAgICAgICogQHBhcmFtIHN0YXJ0MiAtCiAgICAgICAgICogQHBhcmFtIGVuZDIgLQogICAgICAgICAqIEByZXR1cm4gLQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyByZW1hcCh2YWx1ZSwgc3RhcnQxLCBlbmQxLCBzdGFydDIsIGVuZDIpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXJ0MiArIChlbmQyIC0gc3RhcnQyKSAqICgodmFsdWUgLSBzdGFydDEpIC8gKGVuZDEgLSBzdGFydDEpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUGVyZm9ybSBIZXJtaXRlIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmFsdWVzCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIGVkZ2UwIC0KICAgICAgICAgKiBAcGFyYW0gZWRnZTEgLQogICAgICAgICAqIEBwYXJhbSB4IC0KICAgICAgICAgKiBAcmV0dXJuIC0KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgc21vb3RoU3RlcChlZGdlMCwgZWRnZTEsIHgpIHsKICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuY2xhbXAoKHggLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuMCwgMS4wKTsKICAgICAgICAgICAgcmV0dXJuIHQgKiB0ICogKDMuMCAtIDIuMCAqIHQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBQZXJmb3JtcyAtIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmFsdWVzCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIGVkZ2UwIC0KICAgICAgICAgKiBAcGFyYW0gZWRnZTEgLQogICAgICAgICAqIEBwYXJhbSB4IC0KICAgICAgICAgKiBAcmV0dXJuIC0KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgbGluU3RlcChlZGdlMCwgZWRnZTEsIHgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xhbXAoKHggLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuMCwgMS4wKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlcyBhIEZsb2F0MTYgZnJvbSB0d28gdW5zaWduZWQgSW50OAogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSBjIC0gQXJyYXkgd2l0aCB0aGUgdHdvIFVJbnQ4CiAgICAgICAgICogQHJldHVybiAtIERlY29kZWQgRmxvYXQxNgogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBkZWNvZGUxNkJpdEZsb2F0RnJvbTJ4VUludDgoYykgewogICAgICAgICAgICBjb25zdCBpeCA9IGNbMF07IC8vIDFzdCBieXRlOiAxIGJpdCBzaWduZWQgbnVtLCA0IGJpdHMgZXhwb25lbnQsIDMgYml0cyBtYW50aXNzYSAoTVNCKQogICAgICAgICAgICBjb25zdCBpeSA9IGNbMV07IC8vIDJuZCBieXRlOiA4IGJpdCBtYW50aXNzYSAoTFNCKQogICAgICAgICAgICBjb25zdCBzID0gaXggJiAweDgwID8gMSA6IC0xOyAvLyBnZXQgYml0IDgKICAgICAgICAgICAgY29uc3QgaWV4cCA9IChpeCAmIDB4NzgpID4+IDM7IC8vIG1hc2sgYml0cyA3LTQKICAgICAgICAgICAgY29uc3QgbXNiID0gaXggJiAweDc7IC8vIG1hc2sgYml0cyAzLTEKICAgICAgICAgICAgbGV0IG5vcm0gPSBpZXhwID09IDAgPyAwIDogMjA0ODsgLy8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBub3JtYWxpemVkIGFuZCBzdWItbm9ybWFsaXplZCBudW1iZXJzCiAgICAgICAgICAgIGNvbnN0IG1hbnRpc3NhID0gbm9ybSArIChtc2IgPDwgOCkgKyBpeTsgLy8gaW1wbGljaXQgcHJlY2VkaW5nIDEgb3IgMCBhZGRlZCBoZXJlCiAgICAgICAgICAgIG5vcm0gPSBpZXhwID09IDAgPyAxIDogMDsgLy8gbm9ybWFsaXphdGlvbiB0b2dnbGUKICAgICAgICAgICAgY29uc3QgZXhwb25lbnQgPSBNYXRoLnBvdygyLCBpZXhwICsgbm9ybSAtIDE2KTsgLy8gLTUgZm9yIHRoZSB0aGUgZXhwb25lbnQgYmlhcyBmcm9tIDJeLTUgdG8gMl4xMCBwbHVzIGFub3RoZXIgLTExIGZvciB0aGUgbm9ybWFsaXplZCAxMiBiaXQgbWFudGlzc2EKICAgICAgICAgICAgY29uc3QgdiA9IHMgKiBtYW50aXNzYSAqIGV4cG9uZW50OwogICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRW5jb2RlcyBhbiBhcnJheSBvZiB0d28gdW5zaWduZWQgSW50OCB0byBhIEZsb2F0MTYKICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gdiAtIEZsb2F0MTYgbnVtYmVyCiAgICAgICAgICogQHJldHVybiAtIEVuY29kZWQgVW5zaWduZWQgSW50OCBhcnJheQogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBlbmNvZGUxNkJpdEZsb2F0SW50bzJ4VUludDgodikgewogICAgICAgICAgICBjb25zdCBjID0gbmV3IFVpbnQ4QXJyYXkoMik7CiAgICAgICAgICAgIC8vIGNvbnN0IGMgPSBbMCwgMF07CiAgICAgICAgICAgIGNvbnN0IHNpZ251bSA9IHYgPj0gMCA/IDEyOCA6IDA7CiAgICAgICAgICAgIHYgPSBNYXRoLmFicyh2KTsKICAgICAgICAgICAgbGV0IGV4cG9uZW50ID0gMTU7CiAgICAgICAgICAgIGxldCBsaW1pdCA9IDEwMjQ7IC8vIGNvbnNpZGVyaW5nIHRoZSBiaWFzIGZyb20gMl4tNSB0byAyXjEwICg9PTEwMjQpCiAgICAgICAgICAgIGZvciAobGV0IGV4cCA9IDE1OyBleHAgPiAwOyBleHAtLSkgewogICAgICAgICAgICAgICAgaWYgKHYgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgIGxpbWl0IC89IDI7CiAgICAgICAgICAgICAgICAgICAgZXhwb25lbnQtLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgcmVzdDsKICAgICAgICAgICAgaWYgKGV4cG9uZW50ID09IDApIHsKICAgICAgICAgICAgICAgIHJlc3QgPSB2IC8gbGltaXQgLyAyOyAvLyAic3ViLW5vcm1hbGl6ZSIgaW1wbGljaXQgcHJlY2VkaW5nIDAuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXN0ID0gKHYgLSBsaW1pdCkgLyBsaW1pdDsgLy8gbm9ybWFsaXplIGFjY29yZGluZ2x5IHRvIGltcGxpY2l0IHByZWNlZGluZyAxLgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG1hbnRpc3NhID0gTWF0aC5yb3VuZChyZXN0ICogMjA0OCk7IC8vIDIwNDggPSAyXjExIGZvciB0aGUgKHNwbGl0KSAxMSBiaXQgbWFudGlzc2EKICAgICAgICAgICAgY29uc3QgbXNiID0gbWFudGlzc2EgLyAyNTY7IC8vIHRoZSBtb3N0IHNpZ25pZmljYW50IDMgYml0cyBnbyBpbnRvIHRoZSBsb3dlciBwYXJ0IG9mIHRoZSBmaXJzdCBieXRlCiAgICAgICAgICAgIGNvbnN0IGxzYiA9IG1hbnRpc3NhIC0gbXNiICogMjU2OyAvLyB0aGVyZSBnbyB0aGUgb3RoZXIgOCBiaXQgb2YgdGhlIGxvd2VyIHNpZ25pZmljYW5jZQogICAgICAgICAgICBjWzBdID0gc2lnbnVtICsgZXhwb25lbnQgKiA4ICsgbXNiOyAvLyBjb2xvciBub3JtYWxpemF0aW9uIGZvciB0ZXh0dXJlMkQKICAgICAgICAgICAgY1sxXSA9IGxzYjsKICAgICAgICAgICAgaWYgKHYgPj0gMjA0OCkgewogICAgICAgICAgICAgICAgY1swXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVHJhbnNmb3JtcyBhIDE2IGJpdCBmbG9hdCB0byBhbiBlbmNvZGVkIGludGVnZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICogQHBhcmFtIHYgLSBGbG9hdDE2IG51bWJlciB0byBlbmNvZGUKICAgICAgICAgKiBAcmV0dXJuIC0gRW5jb2RlZCBudW1iZXIKICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZW5jb2RlMTZCaXRGbG9hdCh2KSB7CiAgICAgICAgICAgIGNvbnN0IGZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgICAgICAgIGZsb2F0MzJBcnJheVswXSA9IHY7CiAgICAgICAgICAgIGNvbnN0IGludDMyVmlldyA9IG5ldyBJbnQzMkFycmF5KGZsb2F0MzJBcnJheS5idWZmZXIpOwogICAgICAgICAgICBjb25zdCB0b1VJbnQxNiA9ICh4KSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgYml0cyA9ICh4ID4+IDE2KSAmIDB4ODAwMDsgLyogR2V0IHRoZSBzaWduICovCiAgICAgICAgICAgICAgICBsZXQgbSA9ICh4ID4+IDEyKSAmIDB4MDdmZjsgLyogS2VlcCBvbmUgZXh0cmEgYml0IGZvciByb3VuZGluZyAqLwogICAgICAgICAgICAgICAgY29uc3QgZSA9ICh4ID4+IDIzKSAmIDB4ZmY7IC8qIFVzaW5nIGludCBpcyBmYXN0ZXIgaGVyZSAqLwogICAgICAgICAgICAgICAgLyogSWYgemVybywgb3IgZGUtbm9ybWFsLCBvciBleHBvbmVudCB1bmRlcmZsb3dzIHRvbyBtdWNoIGZvciBhIGRlLW5vcm1hbAogICAgICAgICAgICAgICAgICogaGFsZiwgcmV0dXJuIHNpZ25lZCB6ZXJvLiAqLwogICAgICAgICAgICAgICAgaWYgKGUgPCAxMDMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYml0czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8qIElmIE5hTiwgcmV0dXJuIE5hTi4gSWYgSW5mIG9yIGV4cG9uZW50IG92ZXJmbG93LCByZXR1cm4gSW5mLiAqLwogICAgICAgICAgICAgICAgaWYgKGUgPiAxNDIpIHsKICAgICAgICAgICAgICAgICAgICBiaXRzIHw9IDB4N2MwMDsKICAgICAgICAgICAgICAgICAgICAvKiBJZiBleHBvbmVudCB3YXMgMHhmZiBhbmQgb25lIG1hbnRpc3NhIGJpdCB3YXMgc2V0LCBpdCBtZWFucyBOYU4sCiAgICAgICAgICAgICAgICAgICAgICogbm90IEluZiwgc28gbWFrZSBzdXJlIHdlIHNldCBvbmUgbWFudGlzc2EgYml0IHRvby4gKi8KICAgICAgICAgICAgICAgICAgICBiaXRzIHw9IChlID09IDI1NSA/IDAgOiAxKSAmJiB4ICYgMHgwMDdmZmZmZjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYml0czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8qIElmIGV4cG9uZW50IHVuZGVyZmxvd3MgYnV0IG5vdCB0b28gbXVjaCwgcmV0dXJuIGEgZGUtbm9ybWFsICovCiAgICAgICAgICAgICAgICBpZiAoZSA8IDExMykgewogICAgICAgICAgICAgICAgICAgIG0gfD0gMHgwODAwOwogICAgICAgICAgICAgICAgICAgIC8qIEV4dHJhIHJvdW5kaW5nIG1heSBvdmVyZmxvdyBhbmQgc2V0IG1hbnRpc3NhIHRvIDAgYW5kIGV4cG9uZW50CiAgICAgICAgICAgICAgICAgICAgICogdG8gMSwgd2hpY2ggaXMgT0suICovCiAgICAgICAgICAgICAgICAgICAgYml0cyB8PSAobSA+PiAoMTE0IC0gZSkpICsgKChtID4+ICgxMTMgLSBlKSkgJiAxKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYml0czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJpdHMgfD0gKChlIC0gMTEyKSA8PCAxMCkgfCAobSA+PiAxKTsKICAgICAgICAgICAgICAgIC8qIEV4dHJhIHJvdW5kaW5nLiBBbiBvdmVyZmxvdyB3aWxsIHNldCBtYW50aXNzYSB0byAwIGFuZCBpbmNyZW1lbnQKICAgICAgICAgICAgICAgICAqIHRoZSBleHBvbmVudCwgd2hpY2ggaXMgT0suICovCiAgICAgICAgICAgICAgICBiaXRzICs9IG0gJiAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGJpdHM7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB0b1VJbnQxNihpbnQzMlZpZXdbMF0pOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBcyBvcHBvc2l0ZSBvZiB0aGUgYGVuY29kZTE2Qml0RmxvYXRgIG1ldGhvZCwgdGhpcyB0YWtlcyBhbiBlbmNvZGVkIGludGVnZXIgdmFsdWUsCiAgICAgICAgICogYW5kIHJldHVybnMgdGhlIDE2IGJpdCBmbG9hdC4KICAgICAgICAgKgogICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgKiBAcGFyYW0gaCAtIEVuY29kZWQgaW50ZWdlcgogICAgICAgICAqIEByZXR1cm4gLSBEZWNvZGVkIDE2IGJpdCBmbG9hdC4KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZGVjb2RlMTZCaXRGbG9hdChoKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSAoaCAmIDB4ODAwMCkgPj4gMTU7CiAgICAgICAgICAgIGNvbnN0IGUgPSAoaCAmIDB4N2MwMCkgPj4gMTA7CiAgICAgICAgICAgIGNvbnN0IGYgPSBoICYgMHgwM2ZmOwogICAgICAgICAgICBpZiAoZSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHMgPyAtMSA6IDEpICogTWF0aC5wb3coMiwgLTE0KSAqIChmIC8gTWF0aC5wb3coMiwgMTApKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChlID09IDB4MWYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmID8gTmFOIDogKHMgPyAtMSA6IDEpICogSW5maW5pdHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChzID8gLTEgOiAxKSAqIE1hdGgucG93KDIsIGUgLSAxNSkgKiAoMSArIGYgLyBNYXRoLnBvdygyLCAxMCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc2Zvcm1zIGFuIGFycmF5IG9mIEZsb2F0IDMyIHRvIGFuIGFycmF5IG9mIHVuc2lnbmVkIEludDE2LgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqIEBwYXJhbSBmbG9hdDMyQXJyYXkgLQogICAgICAgICAqIEByZXR1cm4gLSBVbnNpZ25lZCBJbnQxNiBhcnJheSByZXByZXNlbnRhdGl2ZSBvZiB0aGUgRmxvYXQzMkFycmF5CiAgICAgICAgICovCiAgICAgICAgc3RhdGljIGNvbnZlcnRGbG9hdDMyQXJyYXlUb1VJbnQxNkFycmF5KGZsb2F0MzJBcnJheSkgewogICAgICAgICAgICBjb25zdCB1bml0MTZzID0gbmV3IFVpbnQxNkFycmF5KGZsb2F0MzJBcnJheS5sZW5ndGgpOwogICAgICAgICAgICBjb25zdCBpbnQzMlZpZXcgPSBuZXcgSW50MzJBcnJheShmbG9hdDMyQXJyYXkuYnVmZmVyKTsKICAgICAgICAgICAgY29uc3QgdG9VSW50MTYgPSAoeCkgPT4gewogICAgICAgICAgICAgICAgbGV0IGJpdHMgPSAoeCA+PiAxNikgJiAweDgwMDA7IC8qIEdldCB0aGUgc2lnbiAqLwogICAgICAgICAgICAgICAgbGV0IG0gPSAoeCA+PiAxMikgJiAweDA3ZmY7IC8qIEtlZXAgb25lIGV4dHJhIGJpdCBmb3Igcm91bmRpbmcgKi8KICAgICAgICAgICAgICAgIGNvbnN0IGUgPSAoeCA+PiAyMykgJiAweGZmOyAvKiBVc2luZyBpbnQgaXMgZmFzdGVyIGhlcmUgKi8KICAgICAgICAgICAgICAgIC8qIElmIHplcm8sIG9yIGRlLW5vcm1hbCwgb3IgZXhwb25lbnQgdW5kZXJmbG93cyB0b28gbXVjaCBmb3IgYSBkZS1ub3JtYWwKICAgICAgICAgICAgICAgICAqIGhhbGYsIHJldHVybiBzaWduZWQgemVyby4gKi8KICAgICAgICAgICAgICAgIGlmIChlIDwgMTAzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJpdHM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvKiBJZiBOYU4sIHJldHVybiBOYU4uIElmIEluZiBvciBleHBvbmVudCBvdmVyZmxvdywgcmV0dXJuIEluZi4gKi8KICAgICAgICAgICAgICAgIGlmIChlID4gMTQyKSB7CiAgICAgICAgICAgICAgICAgICAgYml0cyB8PSAweDdjMDA7CiAgICAgICAgICAgICAgICAgICAgLyogSWYgZXhwb25lbnQgd2FzIDB4ZmYgYW5kIG9uZSBtYW50aXNzYSBiaXQgd2FzIHNldCwgaXQgbWVhbnMgTmFOLAogICAgICAgICAgICAgICAgICAgICAqIG5vdCBJbmYsIHNvIG1ha2Ugc3VyZSB3ZSBzZXQgb25lIG1hbnRpc3NhIGJpdCB0b28uICovCiAgICAgICAgICAgICAgICAgICAgYml0cyB8PSAoZSA9PSAyNTUgPyAwIDogMSkgJiYgeCAmIDB4MDA3ZmZmZmY7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJpdHM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvKiBJZiBleHBvbmVudCB1bmRlcmZsb3dzIGJ1dCBub3QgdG9vIG11Y2gsIHJldHVybiBhIGRlLW5vcm1hbCAqLwogICAgICAgICAgICAgICAgaWYgKGUgPCAxMTMpIHsKICAgICAgICAgICAgICAgICAgICBtIHw9IDB4MDgwMDsKICAgICAgICAgICAgICAgICAgICAvKiBFeHRyYSByb3VuZGluZyBtYXkgb3ZlcmZsb3cgYW5kIHNldCBtYW50aXNzYSB0byAwIGFuZCBleHBvbmVudAogICAgICAgICAgICAgICAgICAgICAqIHRvIDEsIHdoaWNoIGlzIE9LLiAqLwogICAgICAgICAgICAgICAgICAgIGJpdHMgfD0gKG0gPj4gKDExNCAtIGUpKSArICgobSA+PiAoMTEzIC0gZSkpICYgMSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJpdHM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBiaXRzIHw9ICgoZSAtIDExMikgPDwgMTApIHwgKG0gPj4gMSk7CiAgICAgICAgICAgICAgICAvKiBFeHRyYSByb3VuZGluZy4gQW4gb3ZlcmZsb3cgd2lsbCBzZXQgbWFudGlzc2EgdG8gMCBhbmQgaW5jcmVtZW50CiAgICAgICAgICAgICAgICAgKiB0aGUgZXhwb25lbnQsIHdoaWNoIGlzIE9LLiAqLwogICAgICAgICAgICAgICAgYml0cyArPSBtICYgMTsKICAgICAgICAgICAgICAgIHJldHVybiBiaXRzOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZsb2F0MzJBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdW5pdDE2c1tpXSA9IHRvVUludDE2KGludDMyVmlld1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVuaXQxNnM7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIGJveCBpbiAyRCBzcGFjZS4gTmVlZGluZyB0d28gVmVjMiB2ZWN0b3JzIGRlc2NyaWJpbmcgdGhlIGNvcm5lcnMKICAgICAqLwogICAgY2xhc3MgQm94MiB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhIEJveDIgb2JqZWN0IHVzaW5nIFZlYzJzLgogICAgICAgICAqIEluIGNhc2UgdGhlIHBhcmFtZXRlcnMgYXJlIG5vdCBwYXNzZWQgYnksIHRoZWlyIHZhbHVlcyBhcmUgcHJlLWRlZmluZWQ6CiAgICAgICAgICoKICAgICAgICAgKiBwMCBpcyBhIFZlYzIgd2l0aCB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTnVtYmVyL1BPU0lUSVZFX0lORklOSVRZfGBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFlgfQogICAgICAgICAqCiAgICAgICAgICogcDEgaXMgYSBWZWMyIHdpdGgge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL051bWJlci9ORUdBVElWRV9JTkZJTklUWXxgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZYH0KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBwMCAtIEEgcG9pbnQgcmVwcmVzZW50aW5nIHRoZSBjb3JuZXJzIG9mIGEgMkQgYm94LgogICAgICAgICAqIEBwYXJhbSBwMSAtIEEgcG9pbnQgcmVwcmVzZW50aW5nIHRoZSBjb3JuZXJzIG9mIGEgMkQgYm94LgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKHAwLCBwMSkgewogICAgICAgICAgICBpZiAocDAgaW5zdGFuY2VvZiBWZWMyKSB7CiAgICAgICAgICAgICAgICB0aGlzLnAwID0gcDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnAwID0gbmV3IFZlYzIoTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwMSBpbnN0YW5jZW9mIFZlYzIpIHsKICAgICAgICAgICAgICAgIHRoaXMucDEgPSBwMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucDEgPSBuZXcgVmVjMihOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBib3RoIFZlYzIgcG9pbnRzCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcDAgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDJEIGJveC4KICAgICAgICAgKiBAcGFyYW0gcDEgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDJEIGJveC4KICAgICAgICAgKi8KICAgICAgICBzZXQocDAsIHAxKSB7CiAgICAgICAgICAgIHRoaXMucDAgPSBwMDsKICAgICAgICAgICAgdGhpcy5wMSA9IHAxOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXNldHMgdGhlIGJveDIgYmFjayB0byBhbiB1bmluaXRpYWxpemVkIHN0YXRlLgogICAgICAgICAqCiAgICAgICAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTnVtYmVyL1BPU0lUSVZFX0lORklOSVRZfGBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFlgfQogICAgICAgICAqIGFuZCB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTnVtYmVyL05FR0FUSVZFX0lORklOSVRZfGBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFlgfQogICAgICAgICAqLwogICAgICAgIHJlc2V0KCkgewogICAgICAgICAgICB0aGlzLnAwLnggPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7CiAgICAgICAgICAgIHRoaXMucDEueCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTsKICAgICAgICAgICAgdGhpcy5wMC55ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZOwogICAgICAgICAgICB0aGlzLnAxLnkgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBib3ggaGFzIGJlZW4gZXhwYW5kZWQgdG8gY29udGFpbiBhIHBvaW50LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaXNWYWxpZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLnAwLnggIT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZICYmCiAgICAgICAgICAgICAgICB0aGlzLnAxLnggIT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZICYmCiAgICAgICAgICAgICAgICB0aGlzLnAwLnkgIT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZICYmCiAgICAgICAgICAgICAgICB0aGlzLnAxLnkgIT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRXhwYW5kcyB0aGUgQm94MiB0byBjb250YWluIHRoZSBuZXcgcG9pbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcG9pbnQgLSBBIHBvaW50IHJlcHJlc2VudHMgdGhlIGNvcm5lcnMgb2YgYSAyRCBib3guCiAgICAgICAgICovCiAgICAgICAgYWRkUG9pbnQocG9pbnQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucDAueCA9PSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgfHwgcG9pbnQueCA8IHRoaXMucDAueCkKICAgICAgICAgICAgICAgIHRoaXMucDAueCA9IHBvaW50Lng7CiAgICAgICAgICAgIGlmICh0aGlzLnAwLnkgPT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIHx8IHBvaW50LnkgPCB0aGlzLnAwLnkpCiAgICAgICAgICAgICAgICB0aGlzLnAwLnkgPSBwb2ludC55OwogICAgICAgICAgICBpZiAodGhpcy5wMS55ID09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSB8fCBwb2ludC54ID4gdGhpcy5wMS54KQogICAgICAgICAgICAgICAgdGhpcy5wMS54ID0gcG9pbnQueDsKICAgICAgICAgICAgaWYgKHRoaXMucDEueSA9PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgfHwgcG9pbnQueSA+IHRoaXMucDEueSkKICAgICAgICAgICAgICAgIHRoaXMucDEueSA9IHBvaW50Lnk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgZGlhZ29uYWwgb2YgdGhlIGJveC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBkaXN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBzaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wMS5kaXN0YW5jZVRvKHRoaXMucDApOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBzaXplIG9mIGEgQm94MiAtIHRoZSBzYW1lIGFzIHNpemUoKS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgVmVjMi4KICAgICAgICAgKi8KICAgICAgICBkaWFnb25hbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGNlbnRlciBwb2ludCBvZiBhIEJveDIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIFZlYzIuCiAgICAgICAgICovCiAgICAgICAgY2VudGVyKCkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApOwogICAgICAgICAgICByZXN1bHQuc2NhbGVJblBsYWNlKDAuNSk7CiAgICAgICAgICAgIHJlc3VsdC5hZGRJblBsYWNlKHRoaXMucDApOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDbG9uZXMgdGhpcyBWZWMyIGFuZCByZXR1cm5zIGEgbmV3IFZlYzIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBWZWMyLgogICAgICAgICAqLwogICAgICAgIGNsb25lKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEJveDIodGhpcy5wMC5jbG9uZSgpLCB0aGlzLnAxLmNsb25lKCkpOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGVyc2lzdGVuY2UKICAgICAgICAvKioKICAgICAgICAgKiBFbmNvZGVzIGBCb3gyYCBDbGFzcyBhcyBhIEpTT04gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUganNvbiBvYmplY3QuCiAgICAgICAgICovCiAgICAgICAgdG9KU09OKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcDA6IHRoaXMucDAudG9KU09OKCksCiAgICAgICAgICAgICAgICBwMTogdGhpcy5wMS50b0pTT04oKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbHMgYHRvSlNPTmAgbWV0aG9kIGFuZCBzdHJpbmdpZmllcyBpdC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcAogICAgICAgICAgICByZXR1cm4gU3RyaW5nRnVuY3Rpb25zLnN0cmluZ2lmeUpTT05XaXRoRml4ZWRQcmVjaXNpb24odGhpcy50b0pTT04oKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICAgIC8qKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgbWF0aGVtYXRpY2FsIHNwaGVyZSwgYXMgb3Bwb3NlZCB0byB0aGUgU3BoZXJlIGNsYXNzIGRlcml2ZWQgZnJvbSBQcm9jZWR1cmFsTWVzaC4KICAgICAqCiAgICAgKi8KICAgIGNsYXNzIFNwaGVyZVR5cGUgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhIHNwaGVyZS4KICAgICAgICAgKiBAcGFyYW0gcG9zIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBzcGhlcmUuCiAgICAgICAgICogQHBhcmFtIHJhZGl1cyAtIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3Rvcihwb3MgPSBuZXcgVmVjMygpLCByYWRpdXMgPSAwKSB7CiAgICAgICAgICAgIGlmIChwb3MgaW5zdGFuY2VvZiBWZWMzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBvcyA9IHBvczsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucG9zID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1czsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2xvbmVzIHRoaXMgc3BoZXJlIGFuZCByZXR1cm5zIGEgbmV3IHNwaGVyZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgbmV3IHNwaGVyZS4KICAgICAgICAgKi8KICAgICAgICBjbG9uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmVUeXBlKHRoaXMucG9zLmNsb25lKCksIHRoaXMucmFkaXVzKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2tzIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgYSBib3guCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gYm94IC0gVGhlIGJveCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBpbnRlcnNlY3RzQm94KGJveCkgewogICAgICAgICAgICByZXR1cm4gYm94LmludGVyc2VjdHNTcGhlcmUodGhpcyk7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHRvSlNPTiBtZXRob2QgZW5jb2RlcyB0aGlzIHR5cGUgYXMgYSBqc29uIG9iamVjdCBmb3IgcGVyc2lzdGVuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBvczogdGhpcy5wb3MudG9KU09OKCksCiAgICAgICAgICAgICAgICByYWRpdXM6IHRoaXMucmFkaXVzLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxscyBgdG9KU09OYCBtZXRob2QgYW5kIHN0cmluZ2lmaWVzIGl0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJpbmdGdW5jdGlvbnMuc3RyaW5naWZ5SlNPTldpdGhGaXhlZFByZWNpc2lvbih0aGlzLnRvSlNPTigpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBib3ggaW4gM0Qgc3BhY2UuCiAgICAgKiBSZXByZXNlbnRzIGEgYm94IGluIDNEIHNwYWNlIGRlZmluZWQgYnkgdHdvIFZlYzMgdmFsdWVzIHdoaWNoIGRlZmluZSBvcHBvc2luZyBjb3JuZXJzIG9mIHRoZSBib3guCiAgICAgKi8KICAgIGNsYXNzIEJveDMgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSBCb3gzIG9iamVjdCB1c2luZyBWZWMzcy4KICAgICAgICAgKiBJbiBjYXNlIHRoZSBwYXJhbWV0ZXJzIGFyZSBub3QgcGFzc2VkIGJ5LCB0aGVpciB2YWx1ZXMgYXJlIHByZS1kZWZpbmVkOgogICAgICAgICAqCiAgICAgICAgICogcDAgaXMgYSBWZWMyIHdpdGgge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL051bWJlci9QT1NJVElWRV9JTkZJTklUWXxgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZYH0KICAgICAgICAgKgogICAgICAgICAqIHAxIGlzIGEgVmVjMiB3aXRoIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9OdW1iZXIvTkVHQVRJVkVfSU5GSU5JVFl8YE51bWJlci5ORUdBVElWRV9JTkZJTklUWWB9CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcDAgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDNEIGJveC4KICAgICAgICAgKiBAcGFyYW0gcDEgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDNEIGJveC4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3RvcihwMCwgcDEpIHsKICAgICAgICAgICAgaWYgKHAwIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICB0aGlzLnAwID0gbmV3IFZlYzMobmV3IEZsb2F0MzJBcnJheShwMC5idWZmZXIsIHAwLmJ5dGVPZmZzZXQsIDMpKTsKICAgICAgICAgICAgICAgIHRoaXMucDEgPSBuZXcgVmVjMyhuZXcgRmxvYXQzMkFycmF5KHAwLmJ1ZmZlciwgcDAuYnl0ZU9mZnNldCArIDEyLCAzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAocDAgaW5zdGFuY2VvZiBWZWMzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wMCA9IHAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wMCA9IG5ldyBWZWMzKE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHAxIGluc3RhbmNlb2YgVmVjMykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucDEgPSBwMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMucDEgPSBuZXcgVmVjMyhOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBHZXR0ZXIgZm9yIHRoZSBsb3dlciAoeCwgeSwgeikgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBtaW5pbXVtIFZlYzMuCiAgICAgICAgICovCiAgICAgICAgZ2V0IG1pbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucDA7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHRlciBmb3IgdGhlIHVwcGVyICh4LCB5LCB6KSBib3VuZGFyeSBvZiB0aGUgYm94LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG1heGltdW0gVmVjMy4KICAgICAgICAgKi8KICAgICAgICBnZXQgbWF4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wMTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBib3RoIFZlYzMgcG9pbnRzCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcDAgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDNEIGJveC4KICAgICAgICAgKiBAcGFyYW0gcDEgLSBBIHBvaW50IHJlcHJlc2VudGluZyB0aGUgY29ybmVycyBvZiBhIDNEIGJveC4KICAgICAgICAgKi8KICAgICAgICBzZXQocDAsIHAxKSB7CiAgICAgICAgICAgIHRoaXMucDAgPSBwMDsKICAgICAgICAgICAgdGhpcy5wMSA9IHAxOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXNldHMgdGhlIGJveDMgYmFjayB0byBhbiB1bmluaXRpYWxpemVkIHN0YXRlLgogICAgICAgICAqLwogICAgICAgIHJlc2V0KCkgewogICAgICAgICAgICB0aGlzLnAwLnggPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7CiAgICAgICAgICAgIHRoaXMucDAueSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsKICAgICAgICAgICAgdGhpcy5wMC56ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZOwogICAgICAgICAgICB0aGlzLnAxLnggPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7CiAgICAgICAgICAgIHRoaXMucDEueSA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTsKICAgICAgICAgICAgdGhpcy5wMS56ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYm94IGhhcyBiZWVuIGV4cGFuZGVkIHRvIGNvbnRhaW4gYSBwb2ludC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGlzVmFsaWQoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5wMC54ICE9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSAmJgogICAgICAgICAgICAgICAgdGhpcy5wMS54ICE9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSAmJgogICAgICAgICAgICAgICAgdGhpcy5wMC55ICE9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSAmJgogICAgICAgICAgICAgICAgdGhpcy5wMS55ICE9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSAmJgogICAgICAgICAgICAgICAgdGhpcy5wMC56ICE9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSAmJgogICAgICAgICAgICAgICAgdGhpcy5wMS56ICE9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEV4cGFuZHMgdGhlIEJveDMgdG8gY29udGFpbiB0aGUgbmV3IHBvaW50LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHBvaW50IC0gQSBwb2ludCByZXByZXNlbnRzIHRoZSBjb3JuZXJzIG9mIGEgM0QgYm94LgogICAgICAgICAqLwogICAgICAgIGFkZFBvaW50KHBvaW50KSB7CiAgICAgICAgICAgIGlmIChwb2ludC54ICE9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSAmJiBwb2ludC54ICE9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkgewogICAgICAgICAgICAgICAgaWYgKHBvaW50LnggPCB0aGlzLnAwLngpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wMC54ID0gcG9pbnQueDsKICAgICAgICAgICAgICAgIGlmIChwb2ludC54ID4gdGhpcy5wMS54KQogICAgICAgICAgICAgICAgICAgIHRoaXMucDEueCA9IHBvaW50Lng7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBvaW50LnkgIT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZICYmIHBvaW50LnkgIT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZKSB7CiAgICAgICAgICAgICAgICBpZiAocG9pbnQueSA8IHRoaXMucDAueSkKICAgICAgICAgICAgICAgICAgICB0aGlzLnAwLnkgPSBwb2ludC55OwogICAgICAgICAgICAgICAgaWYgKHBvaW50LnkgPiB0aGlzLnAxLnkpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wMS55ID0gcG9pbnQueTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocG9pbnQueiAhPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgJiYgcG9pbnQueiAhPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpIHsKICAgICAgICAgICAgICAgIGlmIChwb2ludC56IDwgdGhpcy5wMC56KQogICAgICAgICAgICAgICAgICAgIHRoaXMucDAueiA9IHBvaW50Lno7CiAgICAgICAgICAgICAgICBpZiAocG9pbnQueiA+IHRoaXMucDEueikKICAgICAgICAgICAgICAgICAgICB0aGlzLnAxLnogPSBwb2ludC56OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYEJveDNgIHRvIHRoaXMgYEJveDNgLCBvZiB0aGUgWGZvIGluc3RhbmNlIGlzIHBhc3NlZCBpbiB0aGUgcGFyYW1ldGVycwogICAgICAgICAqIGl0IHByb2NlZWRzIHRvIGFwcGx5IHRoZSB0cmFuc2Zvcm0gZm9yIHRoZSBWZWMzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGJveDMgLSBBIDNEIGJveC4KICAgICAgICAgKiBAcGFyYW0geGZvIC0gQSAzRCB0cmFuc2Zvcm0uCiAgICAgICAgICovCiAgICAgICAgYWRkQm94Myhib3gzLCB0cmFuc2Zvcm0pIHsKICAgICAgICAgICAgaWYgKHRyYW5zZm9ybSkgewogICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIGVhY2ggY29ybmVyIG9mIHRoZSBCb3gzIGludG8gdGhlIG5ldyBjb29yZGluYXRlIHN5c3RlbS4KICAgICAgICAgICAgICAgIHRoaXMuYWRkUG9pbnQodHJhbnNmb3JtLnRyYW5zZm9ybVZlYzMoYm94My5wMCkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAwLngsIGJveDMucDAueSwgYm94My5wMS56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAwLngsIGJveDMucDEueSwgYm94My5wMC56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAxLngsIGJveDMucDAueSwgYm94My5wMC56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAwLngsIGJveDMucDEueSwgYm94My5wMS56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAxLngsIGJveDMucDAueSwgYm94My5wMS56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhuZXcgVmVjMyhib3gzLnAxLngsIGJveDMucDEueSwgYm94My5wMC56KSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludCh0cmFuc2Zvcm0udHJhbnNmb3JtVmVjMyhib3gzLnAxKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZFBvaW50KGJveDMucDApOwogICAgICAgICAgICAgICAgdGhpcy5hZGRQb2ludChib3gzLnAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIGRpYWdvbmFsIG9mIHRoZSBib3guCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgZGlzdGFuY2UuCiAgICAgICAgICovCiAgICAgICAgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucDEuZGlzdGFuY2VUbyh0aGlzLnAwKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgZGlhZ29uYWwgdmVjdG9yIG9mIHRoZSBCPWJveCBmcm9tIHAwIHRvIHAxLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBCb3gzLgogICAgICAgICAqLwogICAgICAgIGRpYWdvbmFsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wMS5zdWJ0cmFjdCh0aGlzLnAwKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgY2VudGVyIHBvaW50IG9mIGEgQm94My4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgVmVjMy4KICAgICAgICAgKi8KICAgICAgICBjZW50ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCk7CiAgICAgICAgICAgIHJlc3VsdC5zY2FsZUluUGxhY2UoMC41KTsKICAgICAgICAgICAgcmVzdWx0LmFkZEluUGxhY2UodGhpcy5wMCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENvbnZlcnRzIHRoaXMgQm94MyB0byBhIE1hdDQgKGEgNHg0IG1hdHJpeCkuIFRoZSByZXR1cm5lZCBtYXQ0IHdvdWxkIHRyYW5zZm9ybSBhIHVuaXQgY3ViZSBpbnRvIHRoZSBzaGFwZSBvZiB0aGUgQm91bmRpbmcgYm94LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBuZXcgTWF0NC4KICAgICAgICAgKi8KICAgICAgICB0b01hdDQoKSB7CiAgICAgICAgICAgIGNvbnN0IHNjeCA9IHRoaXMucDEueCAtIHRoaXMucDAueDsKICAgICAgICAgICAgY29uc3Qgc2N5ID0gdGhpcy5wMS55IC0gdGhpcy5wMC55OwogICAgICAgICAgICBjb25zdCBzY3ogPSB0aGlzLnAxLnogLSB0aGlzLnAwLno7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWF0NChzY3gsIDAsIDAsIDAsIDAsIHNjeSwgMCwgMCwgMCwgMCwgc2N6LCAwLCB0aGlzLnAwLngsIHRoaXMucDAueSwgdGhpcy5wMC56LCAxLjApOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIGFuZCByZXR1cm5zIHRoZSBib3VuZGluZyBTcGhlcmUgb2YgdGhlIEJveDMKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldEJvdW5kaW5nU3BoZXJlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFNwaGVyZVR5cGUodGhpcy5jZW50ZXIoKSwgdGhpcy5kaWFnb25hbCgpLmxlbmd0aCgpICogMC41KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRGV0ZXJtaW5lcyBpZiB0aGlzIEJveDMgaW50ZXJzZWN0cyBhIGdpdmVuIGJveCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBib3ggLSBUaGUgYm94IHRvIGNoZWNrIGZvciBpbnRlcnNlY3Rpb24gYWdhaW5zdC4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0cnVlIGlmIHRoZSBzaGFwZXMgaW50ZXJzZWN0LgogICAgICAgICAqLwogICAgICAgIGludGVyc2VjdHNCb3goYm94KSB7CiAgICAgICAgICAgIC8vIFVzaW5nIDYgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zLgogICAgICAgICAgICByZXR1cm4gYm94Lm1heC54IDwgdGhpcy5taW4ueCB8fAogICAgICAgICAgICAgICAgYm94Lm1pbi54ID4gdGhpcy5tYXgueCB8fAogICAgICAgICAgICAgICAgYm94Lm1heC55IDwgdGhpcy5taW4ueSB8fAogICAgICAgICAgICAgICAgYm94Lm1pbi55ID4gdGhpcy5tYXgueSB8fAogICAgICAgICAgICAgICAgYm94Lm1heC56IDwgdGhpcy5taW4ueiB8fAogICAgICAgICAgICAgICAgYm94Lm1pbi56ID4gdGhpcy5tYXguegogICAgICAgICAgICAgICAgPyBmYWxzZQogICAgICAgICAgICAgICAgOiB0cnVlOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEZXRlcm1pbmVzIGlmIHRoaXMgQm94MyBpbnRlcnNlY3RzIGEgc3BoZXJlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gY2hlY2sgZm9yIGludGVyc2VjdGlvbiBhZ2FpbnN0LgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRydWUgaWYgdGhlIHNoYXBlcyBpbnRlcnNlY3QuCiAgICAgICAgICovCiAgICAgICAgaW50ZXJzZWN0c1NwaGVyZShzcGhlcmUpIHsKICAgICAgICAgICAgbGV0IGNsb3Nlc3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHBvaW50IG9uIHRoZSBBQUJCIGNsb3Nlc3QgdG8gdGhlIHNwaGVyZSBjZW50ZXIuCiAgICAgICAgICAgIC8vIHRoaXMuY2xhbXBQb2ludCggc3BoZXJlLmNlbnRlciwgY2xvc2VzdFBvaW50ICk7CiAgICAgICAgICAgIC8vIElmIHRoYXQgcG9pbnQgaXMgaW5zaWRlIHRoZSBzcGhlcmUsIHRoZSBBQUJCIGFuZCBzcGhlcmUgaW50ZXJzZWN0LgogICAgICAgICAgICByZXR1cm4gY2xvc2VzdFBvaW50LmRpc3RhbmNlVG8oc3BoZXJlLnBvcykgPD0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIERldGVybWluZXMgaWYgdGhpcyBCb3gzIGludGVyc2VjdHMgYSBwbGFuZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBwbGFuZSAtIFRoZSBwbGFuZSB0byBjaGVjayBmb3IgaW50ZXJzZWN0aW9uIGFnYWluc3QuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaW50ZXJzZWN0c1BsYW5lKHBsYW5lKSB7CiAgICAgICAgICAgIC8vIFdlIGNvbXB1dGUgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gZG90IHByb2R1Y3QgdmFsdWVzLiBJZiB0aG9zZSB2YWx1ZXMKICAgICAgICAgICAgLy8gYXJlIG9uIHRoZSBzYW1lIHNpZGUgKGJhY2sgb3IgZnJvbnQpIG9mIHRoZSBwbGFuZSwgdGhlbiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24uCiAgICAgICAgICAgIGxldCBtaW47CiAgICAgICAgICAgIGxldCBtYXg7CiAgICAgICAgICAgIGlmIChwbGFuZS5ub3JtYWwueCA+IDApIHsKICAgICAgICAgICAgICAgIG1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5taW4ueDsKICAgICAgICAgICAgICAgIG1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKICAgICAgICAgICAgICAgIG1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5taW4ueDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGxhbmUubm9ybWFsLnkgPiAwKSB7CiAgICAgICAgICAgICAgICBtaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwogICAgICAgICAgICAgICAgbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1pbiArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWF4Lnk7CiAgICAgICAgICAgICAgICBtYXggKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwbGFuZS5ub3JtYWwueiA+IDApIHsKICAgICAgICAgICAgICAgIG1pbiArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CiAgICAgICAgICAgICAgICBtYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1heC56OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKICAgICAgICAgICAgICAgIG1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG1pbiA8PSAtcGxhbmUudyAmJiBtYXggPj0gLXBsYW5lLnc7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENsb25lcyB0aGlzIEJveDMgYW5kIHJldHVybnMgYSBuZXcgQm94My4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIG5ldyBCb3gzLgogICAgICAgICAqLwogICAgICAgIGNsb25lKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEJveDModGhpcy5wMC5jbG9uZSgpLCB0aGlzLnAxLmNsb25lKCkpOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGVyc2lzdGVuY2UKICAgICAgICAvKioKICAgICAgICAgKiBFbmNvZGVzIGBCb3gzYCBDbGFzcyBhcyBhIEpTT04gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUganNvbiBvYmplY3QuCiAgICAgICAgICovCiAgICAgICAgdG9KU09OKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcDA6IHRoaXMucDAudG9KU09OKCksCiAgICAgICAgICAgICAgICBwMTogdGhpcy5wMS50b0pTT04oKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlcyBhIEpTT04gb2JqZWN0IHRvIHNldCB0aGUgc3RhdGUgb2YgdGhpcyBjbGFzcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqIC0gVGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGopIHsKICAgICAgICAgICAgLy8gV2UgbmVlZCB0byB2ZXJpZnkgdGhhdCBwMCBhbmQgcDEgYXhlcyBhcmUgbnVtZXJpYywgc28gaW4gY2FzZSB0aGV5IGFyZSBub3QsIHdlIHJlc3RvcmUgdGhlbSB0byB0aGVpciBkZWZhdWx0IHZhbHVlcy4KICAgICAgICAgICAgLy8gVGhpcywgYmVjYXVzZSAnSW5maW5pdHknIGFuZCAnLUluZmluaXR5JyBhcmUgc3RyaW5naWZpZWQgYXMgJ251bGwnLgogICAgICAgICAgICBjb25zdCBwMCA9IHsKICAgICAgICAgICAgICAgIHg6IE1hdGhGdW5jdGlvbnMuaXNOdW1lcmljKGoucDAueCkgPyBqLnAwLnggOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksCiAgICAgICAgICAgICAgICB5OiBNYXRoRnVuY3Rpb25zLmlzTnVtZXJpYyhqLnAwLnkpID8gai5wMC55IDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLAogICAgICAgICAgICAgICAgejogTWF0aEZ1bmN0aW9ucy5pc051bWVyaWMoai5wMC56KSA/IGoucDAueiA6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgcDEgPSB7CiAgICAgICAgICAgICAgICB4OiBNYXRoRnVuY3Rpb25zLmlzTnVtZXJpYyhqLnAxLngpID8gai5wMS54IDogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLAogICAgICAgICAgICAgICAgeTogTWF0aEZ1bmN0aW9ucy5pc051bWVyaWMoai5wMS55KSA/IGoucDEueSA6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwKICAgICAgICAgICAgICAgIHo6IE1hdGhGdW5jdGlvbnMuaXNOdW1lcmljKGoucDEueikgPyBqLnAxLnogOiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMucDAuZnJvbUpTT04ocDApOwogICAgICAgICAgICB0aGlzLnAxLmZyb21KU09OKHAxKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHNldEZyb21GbG9hdDMyQXJyYXkgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSBmbG9hdDMyYXJyYXkgLSBUaGUgZmxvYXQzMmFycmF5IHZhbHVlLgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc2V0RnJvbUZsb2F0MzJBcnJheShmbG9hdDMyYXJyYXkpIHsKICAgICAgICAgICAgdGhpcy5wMCA9IG5ldyBWZWMzKGZsb2F0MzJhcnJheS5idWZmZXIsIGZsb2F0MzJhcnJheS5ieXRlT2Zmc2V0KTsKICAgICAgICAgICAgdGhpcy5wMSA9IG5ldyBWZWMzKGZsb2F0MzJhcnJheS5idWZmZXIsIGZsb2F0MzJhcnJheS5ieXRlT2Zmc2V0ICsgMTIpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxscyBgdG9KU09OYCBtZXRob2QgYW5kIHN0cmluZ2lmaWVzIGl0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuZXctY2FwCiAgICAgICAgICAgIHJldHVybiBTdHJpbmdGdW5jdGlvbnMuc3RyaW5naWZ5SlNPTldpdGhGaXhlZFByZWNpc2lvbih0aGlzLnRvSlNPTigpKTsKICAgICAgICB9CiAgICB9CgogICAgbGV0IHJlZ2lzdGVyZWRDbGFzc2VzID0ge307CiAgICBsZXQgY2xhc3NOYW1lcyA9IHt9OwogICAgbGV0IGNsYXNzRGVmaW5pdGlvbnMgPSBbXTsKICAgIC8qKgogICAgICogUmVnaXN0cnkgaXMgYSBzdGF0aWMgZmFjdG9yeSB0aGF0IGhhbmRsZXMgcmVnaXN0cmF0aW9uL3JlY29uc3RydWN0aW9uIG9mCiAgICAgKiBjbGFzc2VzIGJhc2VzIG9uIEJhc2VDbGFzcy4gUmVnaXN0ZXJlZCBjbGFzc2VzIGNhbiB0aGVuIGJlIGNvbnN0cnVjdGVkIGJ5IHRoZSBSZWdpc3RyeSBieSBuYW1lLgogICAgICoKICAgICAqIE5vdGU6IGNsYXNzTmFtZSBpcyByZXF1aXJlZCBiZWNhdXNlIG9uIG1pbmlmaWNhdGlvbiBwcm9jZXNzCiAgICAgKiB0aGUgbmFtZSBvZiBjbGFzc2VzIGNoYW5nZSBhbmQgd2UgY2FuJ3Qgc2ltcGx5IHVzZSAnLi4uLmNvbnN0cnVjdG9yLm5hbWUnLgogICAgICogU28sIHdlIG5lZWQgYSB3YXkgb2YgcmVsYXRpbmcgbWluaWZpZWQgY2xhc3MgbmFtZXMgdG8gdGhlIG9uZSBzdG9yZWQgZm9yIHBlcnNpc3RlbmN5LgogICAgICoKICAgICAqIGkuZS4KICAgICAqIGBgYGphdmFzY3JpcHQKICAgICAqIC8vIEltcG9ydCByZWdpc3RyeSBjbGFzcwogICAgICogY2xhc3MgRm9vKCkgZXh0ZW5kcyBCYXNlQ2xhc3Mge30KICAgICAqCiAgICAgKiBSZWdpc3RyeS5yZWdpc3RlcignRm9vJywgRm9vKQogICAgICogLy8gSW4gY2FzZSAnRm9vJyBjbGFzcyBnZXRzIGl0cyBuYW1lIGNoYW5nZWQgdG8gJ2MnIG9uIG1pbmlmaWNhdGlvbiwKICAgICAqIC8vIGFuZCB0aGUgcGVyc2lzdGVkIGRhdGEgdHlwZSBpcyAnRm9vJywgd2Ugd291bGQga25vdyBob3cgdG8gcmVsYXRlIHRoZW0uCiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAY2xhc3MgUmVnaXN0cnkKICAgICAqLwogICAgY2xhc3MgUmVnaXN0cnkgewogICAgICAgIC8qKgogICAgICAgICAqIFJlZ2lzdGVycyBhIG5ldyBjbGFzcyB0byB0aGUgZmFjdG9yeS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBjbGFzc05hbWUgLSBOYW1lIG9mIHRoZSByZWdpc3RlcmVkIGNsYXNzCiAgICAgICAgICogQHBhcmFtIGNsYXNzRGVmIC0gQ2xhc3MgcmVwcmVzZW50YXRpb24oQ2xhc3MgZnVuY3Rpb24sIHR5cGUpCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIHJlZ2lzdGVyKGNsYXNzTmFtZSwgY2xhc3NEZWYpIHsKICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSBpbiByZWdpc3RlcmVkQ2xhc3NlcykgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGVyZSdzIGEgY2xhc3MgcmVnaXN0ZXJlZCB3aXRoICcke2NsYXNzTmFtZX0nIG5hbWUuIFNlY29uZCByZWdpc3RyYXRpb24gZmFpbGVkLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE5vdGU6IFRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHksIHNhbWUgY2xhc3NEZWYgY2FuIGJlIHN0b3JlZCB1bmRlciBtdWx0aXBsZSBuYW1lcy4KICAgICAgICAgICAgLy8gVGhhdHMgdGhlIHJlYXNvbiBiZWhpbmQgdXNpbmcgaW5kZXhlcyBpbnN0ZWFkIG9mIHRoZSBjbGFzc0RlZi4KICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjbGFzc0RlZmluaXRpb25zLmxlbmd0aDsKICAgICAgICAgICAgY2xhc3NEZWZpbml0aW9ucy5wdXNoKGNsYXNzRGVmKTsKICAgICAgICAgICAgY2xhc3NOYW1lc1tpbmRleF0gPSBjbGFzc05hbWU7CiAgICAgICAgICAgIHJlZ2lzdGVyZWRDbGFzc2VzW2NsYXNzTmFtZV0gPSBpbmRleDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBjbGFzcyBkZWZpbml0aW9uIHVzaW5nIHRoZSBuYW1lIGl0IHdhcyByZWdpc3RlcmVkIHdpdGguCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gY2xhc3NOYW1lIC0gTmFtZSBvZiB0aGUgcmVnaXN0ZXJlZCBjbGFzcwogICAgICAgICAqIEByZXR1cm4gLSBDbGFzcyByZXByZXNlbnRhdGlvbihDbGFzcyBmdW5jdGlvbiwgdHlwZSkKICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZ2V0Q2xhc3NEZWZpbml0aW9uKGNsYXNzTmFtZSkgewogICAgICAgICAgICBpZiAoIShjbGFzc05hbWUgaW4gcmVnaXN0ZXJlZENsYXNzZXMpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2NsYXNzTmFtZX0gY2xhc3MgaXMgbm90IHJlZ2lzdGVyZWRgKTsKICAgICAgICAgICAgcmV0dXJuIGNsYXNzRGVmaW5pdGlvbnNbcmVnaXN0ZXJlZENsYXNzZXNbY2xhc3NOYW1lXV07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgY2xhc3MgbmFtZSByZWdpc3RlcmVkIGZvciB0aGUgaW5zdGFudGlhdGVkIG9iamVjdC4KICAgICAgICAgKiBAcGFyYW0gY2xhc3NEZWZpbml0aW9uIC0gQ2xhc3MgdHlwZSBkZWZpbml0aW9uLgogICAgICAgICAqIEByZXR1cm4gLSBOYW1lIG9mIHRoZSByZWdpc3RlcmVkIGNsYXNzCiAgICAgICAgICovCiAgICAgICAgc3RhdGljIGdldENsYXNzTmFtZShjbGFzc0RlZmluaXRpb24pIHsKICAgICAgICAgICAgY29uc3QgY2xhc3NJZCA9IGNsYXNzRGVmaW5pdGlvbnMuaW5kZXhPZihjbGFzc0RlZmluaXRpb24pOwogICAgICAgICAgICBpZiAoY2xhc3NJZCA+PSAwICYmIGNsYXNzTmFtZXNbY2xhc3NJZF0pCiAgICAgICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lc1tjbGFzc0lkXTsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjbGFzcyBpcyBub3QgcmVnaXN0ZXJlZGApOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZmFjdG9yeSBmdW5jdGlvbiB0aGF0IGNvbnN0cnVjdCB0aGUgY2xhc3MgcmVnaXN0ZXJlZCB1bmRlciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBjbGFzc05hbWUgLSBOYW1lIG9mIHRoZSByZWdpc3RlcmVkIGNsYXNzCiAgICAgICAgICogQHJldHVybiAtIEluc3RhbnRpYXRlZCBvYmplY3Qgb2YgdGhlIHNwZWNpZmllZCBjbGFzcwogICAgICAgICAqLwogICAgICAgIHN0YXRpYyBjb25zdHJ1Y3RDbGFzcyhjbGFzc05hbWUpIHsKICAgICAgICAgICAgY29uc3QgY2xhc3NEZWZpbml0aW9uID0gY2xhc3NEZWZpbml0aW9uc1tyZWdpc3RlcmVkQ2xhc3Nlc1tjbGFzc05hbWVdXTsKICAgICAgICAgICAgaWYgKCFjbGFzc0RlZmluaXRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7Y2xhc3NOYW1lfSBjbGFzcyBpcyBub3QgcmVnaXN0ZXJlZGApOwogICAgICAgICAgICByZXR1cm4gbmV3IGNsYXNzRGVmaW5pdGlvbigpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBGb3IgdGVzdGluZyBwdXJwb3NlIG9ubHksIG5ldmVyIGNhbGwgdGhpcyBvdXRzaWRlIG9mIHRoZSB0ZXN0IHNjb3BlLgogICAgICAgICAqCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZmx1c2goKSB7CiAgICAgICAgICAgIHJlZ2lzdGVyZWRDbGFzc2VzID0ge307CiAgICAgICAgICAgIGNsYXNzTmFtZXMgPSB7fTsKICAgICAgICAgICAgY2xhc3NEZWZpbml0aW9ucyA9IFtdOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovCiAgICBsZXQgY291bnRlciA9IDA7CiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyBhIEJhc2VDbGFzcy4KICAgICAqIFRoZSBCYXNlQ2xhc3MgaXMgdGhlIGZvdW5kYXRpb24gY2xhc3Mgb2YgdGhlIFNjZW5lVHJlZSwgYXMgYWxtb3N0IGFsbCBjbGFzc2VzIGRlcml2ZSBmcm9tIGl0LgogICAgICovCiAgICBjbGFzcyBCYXNlQ2xhc3MgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhbiBCYXNlQ2xhc3MuCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuX19pZCA9ICsrY291bnRlcjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogRXZlcnkgaW5zdGFuY2Ugb2YgZWFjaCBjbGFzcyBiYXNlZCBvbiBCYXNlQ2xhc3MgaXMgYXNzaWduZWQgYSB1bmlxdWUgbnVtYmVyLgogICAgICAgICAqIFRoaXMgbnVtYmVyIGlzIG5vdCBwZXJzaXN0ZW50IGluIGJldHdlZW4gZGlmZmVyZW50IGxvYWRzIG9mIGEgc2NlbmUuCiAgICAgICAgICogUmV0dXJucyB0aGUgdW5pcXVlIGlkIG9mIHRoZSBvYmplY3QuCiAgICAgICAgICogQHJldHVybiAtIFRoZSBJZCBvZiB0aGUgb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIGdldElkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2lkOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSB1bm1hbmdsZWQgbmFtZSBvZiB0aGUgY2xhc3MuCiAgICAgICAgICogQHJldHVybiAtIFRoZSBuYW1lIG9mIHRoZSBjbGFzcyBkZWZpbml0aW9uLgogICAgICAgICAqLwogICAgICAgIGdldENsYXNzTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFJlZ2lzdHJ5LmdldENsYXNzTmFtZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiogQ2xhc3MgcmVwcmVzZW50aW5nIGEgQmFzZUV2ZW50LiAqLwogICAgY2xhc3MgQmFzZUV2ZW50IHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYW4gQmFzZUV2ZW50LgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKCkgeyB9CiAgICB9CgogICAgLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSAqLwogICAgLyoqCiAgICAgKiBQcm92aWRlcyBhbiBpbnRlcmZhY2UgZm9yIGVtaXR0aW5nIGV2ZW50cyB1bmRlciBnaXZlbiBuYW1lcywgYW5kIHJlZ2lzdGVyaW5nIGxpc3RlbmVycyB0byB0aG9zZSBldmVudHMuCiAgICAgKiBUaGlzIGlzIGEgYmFzZSBjbGFzcyBmb3IgbW9zdCBjbGFzc2VzIGluIHRoZSBTY2VuZSBUcmVlIGFuZCBSZW5kZXJlciwgZW5hYmxpbmcgb2JzZXJ2ZXJzIHRvIGxpc3RlbiB0byBjaGFuZ2VzIHRocm91Z2hvdXQgdGhlIHN5c3RlbS4KICAgICAqIFRoZSBpbnRlcmZhY2UgZXhwb3NlZCBpcyBzaW1pbGFyIHRvIFtFdmVudEVtaXR0ZXJdKGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvZXZlbnRzLmh0bWwjZXZlbnRzX2NsYXNzX2V2ZW50ZW1pdHRlcikgaW4gTm9kZS4KICAgICAqCiAgICAgKiBTaW1pbGFyIHRvIGhvdyB0aGUgRE9NIGV2ZW50IHN5c3RlbSBpbiB0aGUgYnJvd3NlciB3b3JrcywgZXZlbnRzIGFyZSByZWdpc3RlcmVkIGJ5IG5hbWUuCiAgICAgKiBFeGFtcGxlOiBSZWdpc3RlcmluZyBhIGxpc3RlbmVyIGZvciBhIGN1c3RvbSBldmVudCwgYW5kIHRoZW4gZW1pdHRpbmcgdGhhdCBldmVudC4KICAgICAqIGBgYGphdmFzY3JpcHQKICAgICAqICBjb25zdCBlZSA9IG5ldyBFdmVudEVtaXR0ZXIoKQogICAgICoKICAgICAqICBjb25zdCBldmVudElEID0gZWUub24oJ215RXZlbnQnLCAoZXZlbnQpID0+IHsKICAgICAqICAgIGNvbnNvbGUubG9nKCdNeSBFdmVudCB3YXMgZW1pdHRlZDonLCBldmVudCkKICAgICAqICB9KQogICAgICoKICAgICAqICBlZS5lbWl0KCdteUV2ZW50JywgeyBkYXRhOiA0MiB9KQogICAgICogIC8vIFdlIG5vIGxvbmdlciB3YW50IHRvIGxpc3RlbiB0byB0aGlzIGV2ZW50LCBzbyBsZXQncyByZW1vdmUgdGhlIGxpc3RlbmVyLgogICAgICogIGVlLnJlbW92ZUxpc3RlbmVyQnlJZCgnbXlFdmVudCcsIGV2ZW50SUQpCiAgICAgKiBgYGAKICAgICAqCiAgICAgKgogICAgICovCiAgICBjbGFzcyBFdmVudEVtaXR0ZXIgZXh0ZW5kcyBCYXNlQ2xhc3MgewogICAgICAgIC8qKgogICAgICAgICAqIEluaXRpYWxpemVzIGFuIGVtcHR5IGBsaXN0ZW5lcnNgIG1hcCB0aGF0IHdpbGwgaG9zdCBhbGwgdGhlIGV2ZW50cywKICAgICAgICAgKiB3aGljaCBpbXBsaWVzIHRoYXQgaXQgZG9lc24ndCBhbGxvdyBtdWx0aXBsZSBldmVudHMgd2l0aCB0aGUgc2FtZSBuYW1lLgogICAgICAgICAqCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYSBsaXN0ZW5lciBmdW5jdGlvbiBmb3IgYSBnaXZlbiBldmVudCBuYW1lLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGV2ZW50TmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBldmVudC4KICAgICAgICAgKiBAcGFyYW0gbGlzdGVuZXIgLSBUaGUgbGlzdGVuZXIgZnVuY3Rpb24oY2FsbGJhY2spLgogICAgICAgICAqIEByZXR1cm4gLSB0aGUgaWQgdGhhdCBjYW4gYmUgdXNlZCB0byByZW1vdmUgdGhlIGxpc3RlbmVyLgogICAgICAgICAqLwogICAgICAgIG9uKGV2ZW50TmFtZSwgbGlzdGVuZXIpIHsKICAgICAgICAgICAgaWYgKCFsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIGxpc3RlbmVyLicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5saXN0ZW5lcnNbZXZlbnROYW1lXSkgewogICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNbZXZlbnROYW1lXSA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzW2V2ZW50TmFtZV07CiAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMuaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExpc3RlbmVyICIke2xpc3RlbmVyLm5hbWV9IiBhbHJlYWR5IGNvbm5lY3RlZCB0byBldmVudCAiJHtldmVudE5hbWV9Ii5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUT0RPOiBEZXByZWNhdGUgYWxvbmdzaWRlICNhZGRMaXN0ZW5lci4KICAgICAgICAgICAgY29uc3QgaWQgPSBsaXN0ZW5lcnMubGVuZ3RoOwogICAgICAgICAgICBsaXN0ZW5lcnNbaWRdID0gbGlzdGVuZXI7CiAgICAgICAgICAgIHJldHVybiBpZDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2ltaWxhciB0byB0aGUgYG9uYCBtZXRob2Qgd2l0aCB0aGUgZGlmZmVyZW5jZSB0aGF0IHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZCwKICAgICAgICAgKiBpdCBpcyBhdXRvbWF0aWNhbGx5IHVucmVnaXN0ZXJlZCBtZWFuaW5nIHRoYXQgdGhlIGV2ZW50IGxpc3RlbmVyIHdpbGwgYmUgdHJpZ2dlcmVkIGF0IG1vc3Qgb25lIHRpbWUuCiAgICAgICAgICoKICAgICAgICAgKiBVc2VmdWwgZm9yIGV2ZW50cyB0aGF0IHdlIGV4cGVjdCB0byB0cmlnZ2VyIG9uZSB0aW1lLCBzdWNoIGFzIHdoZW4gYXNzZXRzIGxvYWQuCiAgICAgICAgICogYGBgamF2YXNjcmlwdAogICAgICAgICAqIGNvbnN0IGFzc2V0ID0gbmV3IEFzc2V0KCk7CiAgICAgICAgICogYXNzZXQub25jZSgnbG9hZGVkJywgKCkgPT4gewogICAgICAgICAqICAgY29uc29sZS5sb2coIllheSEgdGhlIGFzc2V0IGlzIGxvYWRlZCIpCiAgICAgICAgICogfSkKICAgICAgICAgKiBgYGAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBldmVudE5hbWUgLSBUaGUgZXZlbnROYW1lIHZhbHVlCiAgICAgICAgICogQHBhcmFtIGxpc3RlbmVyIC0gVGhlIGxpc3RlbmVyIHZhbHVlCiAgICAgICAgICogQHJldHVybiAtIHRoZSBpZCB0aGF0IGNhbiBiZSB1c2VkIHRvIHJlbW92ZSB0aGUgbGlzdGVuZXIuCiAgICAgICAgICovCiAgICAgICAgb25jZShldmVudE5hbWUsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIGNvbnN0IGNiID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcihldmVudCk7CiAgICAgICAgICAgICAgICB0aGlzLm9mZihldmVudE5hbWUsIGNiKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub24oZXZlbnROYW1lLCBjYik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJlbW92ZXMgYSBsaXN0ZW5lciBmdW5jdGlvbiBmcm9tIHRoZSBzcGVjaWZpZWQgZXZlbnQsIHVzaW5nIGVpdGhlciB0aGUgZnVuY3Rpb24gb3IgdGhlIGluZGV4IGlkLiBEZXBlbmRzIG9uIHdoYXQgaXMgcGFzc2VkIGluLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGV2ZW50TmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBldmVudC4KICAgICAgICAgKiBAcGFyYW0gbGlzdGVuZXIgLSBUaGUgbGlzdGVuZXIgZnVuY3Rpb24gb3IgdGhlIGlkIG51bWJlci4KICAgICAgICAgKi8KICAgICAgICBvZmYoZXZlbnROYW1lLCBsaXN0ZW5lcikgewogICAgICAgICAgICBpZiAoIWxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgY2FsbGJhY2sgZnVuY3Rpb24gKGxpc3RlbmVyKS4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIGxpc3RlbmVyID09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0RlcHJlY2F0ZWQuIFVuLXJlZ2lzdGVyIHVzaW5nIHRoZSBvcmlnaW5hbCBsaXN0ZW5lciBpbnN0ZWFkLicpOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lckJ5SWQoZXZlbnROYW1lLCBsaXN0ZW5lcik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNbZXZlbnROYW1lXSB8fCBbXTsKICAgICAgICAgICAgY29uc3QgaWRzID0gW107CiAgICAgICAgICAgIGxpc3RlbmVycy5mb3JFYWNoKChlLCBpKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZSA9PT0gbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZHMucHVzaChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChpZHMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGlzdGVuZXIgIiR7bGlzdGVuZXIubmFtZX0iIGlzIG5vdCBjb25uZWN0ZWQgdG8gIiR7ZXZlbnROYW1lfSIgZXZlbnRgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE5vdGU6IGRvIG5vdCBzcGxpY2UgdGhlIGFycmF5IGFzIHRoYXQgd291bGQgY2hhbmdlIHRoZSBpbmRleGVzIG9mIGV4aXN0aW5nIGxpc3RlbmVycy4KICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaWQgb2YgaWRzKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzW2lkXSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogcmVtb3ZlIGxpc3RlbmVyIGJ5IElEIHJldHVybmVkIGZyb20gI29uCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZXZlbnROYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50LgogICAgICAgICAqIEBwYXJhbSBpZCAtIFRoZSBpZCByZXR1cm5lZCBieSBhZGRMaXN0ZW5lcgogICAgICAgICAqLwogICAgICAgIHJlbW92ZUxpc3RlbmVyQnlJZChldmVudE5hbWUsIGlkKSB7CiAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzW2V2ZW50TmFtZV07CiAgICAgICAgICAgIGlmICghbGlzdGVuZXJzKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ2NhbGxiYWNrIDonICsgaWQgKyAnIHdhcyBub3QgY29ubmVjdGVkIHRvIHRoaXMgZXZlbnQ6JyArIGV2ZW50TmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFsaXN0ZW5lcnNbaWRdKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIElEJyk7CiAgICAgICAgICAgIC8vIE5vdGU6IGRvIG5vdCBzcGxpY2UgdGhlIGFycmF5IGFzIHRoYXQgd291bGQgY2hhbmdlIHRoZSBpbmRleGVzIG9mIGV4aXN0aW5nIGxpc3RlbmVycy4KICAgICAgICAgICAgbGlzdGVuZXJzW2lkXSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRyaWdnZXJzIGFsbCBsaXN0ZW5lciBmdW5jdGlvbnMgaW4gYW4gZXZlbnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZXZlbnROYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50LgogICAgICAgICAqIEBwYXJhbSBldmVudCAtIFRoZSBkYXRhIHlvdSB3YW50IHRvIHBhc3MgZG93biB0byBhbGwgbGlzdGVuZXIgZnVuY3Rpb25zIGFzIHBhcmFtZXRlci4KICAgICAgICAgKgogICAgICAgICAqLwogICAgICAgIGVtaXQoZXZlbnROYW1lLCBldmVudCA9IG5ldyBCYXNlRXZlbnQoKSkgewogICAgICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1tldmVudE5hbWVdIHx8IFtdOwogICAgICAgICAgICBsaXN0ZW5lcnMuZm9yRWFjaCgoZm4pID0+IHsKICAgICAgICAgICAgICAgIC8vIFNraXAgZGlzY29ubmVjdGVkIGxpc3RlbmVycy4KICAgICAgICAgICAgICAgIGlmIChmbikgewogICAgICAgICAgICAgICAgICAgIGZuKGV2ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGNsYXNzIFBhcmFtZXRlckFkZGVkRXZlbnQgZXh0ZW5kcyBCYXNlRXZlbnQgewogICAgICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgUGFyYW1ldGVyUmVtb3ZlZEV2ZW50IGV4dGVuZHMgQmFzZUV2ZW50IHsKICAgICAgICBjb25zdHJ1Y3RvcihuYW1lKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycyAqLwogICAgLyoqCiAgICAgKiBDbGFzcyB0aGF0IGFsbG93cyBvdGhlciBjbGFzc2VzIHRvIGJlIHBhcmFtZXRlcml6ZWQgYnkgYFBhcmFtZXRlcmAgdHlwZSBvZiBvYmplY3RzLgogICAgICogTm90IG9ubHkgaG9zdGluZyBwYXJhbWV0ZXJzLCBidXQgdGhlaXIgZXZlbnRzLgogICAgICoKICAgICAqIEBleHRlbmRzIHtFdmVudEVtaXR0ZXJ9CiAgICAgKi8KICAgIGNsYXNzIFBhcmFtZXRlck93bmVyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFBhcmFtZXRlck93bmVyIGJ5IGluaXRpYWxpemluZyBwYXJhbWV0ZXIgaG9zdGluZyBtYXBwaW5ncyBhbmQgZXZlbnRzLgogICAgICAgICAqCiAgICAgICAgICogRXZlcnkgT2JqZWN0IGhhcyBhIHVuaXF1ZSBpZGVudGlmaWVyIHdoaWNoIGlzIGJhc2VkIG9uIGEgY291bnRlciB0aGF0IGlzIGluY3JlbWVudGVkLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLnBhcmFtRXZlbnRMaXN0ZW5lcklEcyA9IHt9OwogICAgICAgICAgICB0aGlzLnBhcmFtTWFwcGluZyA9IHt9OwogICAgICAgICAgICB0aGlzLnBhcmFtcyA9IFtdOwogICAgICAgICAgICB0aGlzLmRlcHJlY2F0ZWRQYXJhbU1hcHBpbmcgPSB7fTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMgY3VycmVudCBvYmplY3QgaGFzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIEFtb3VudCBvZiBwYXJhbWV0ZXJzIGluIGN1cnJlbnQgb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIGdldE51bVBhcmFtZXRlcnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmFtcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYWxsIHRoZSBwYXJhbWV0ZXJzIG9mIHRoZSBvYmplY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUGFyYW1ldGVyIExpc3QKICAgICAgICAgKi8KICAgICAgICBnZXRQYXJhbWV0ZXJzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJhbXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGluZGV4IG9mIGEgcGFyYW1ldGVyIGluIHBhcmFtZXRlciBsaXN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHBhcmFtTmFtZSAtIE5hbWUgb2YgdGhlIHBhcmFtZXRlci4KICAgICAgICAgKiBAcmV0dXJuIC0gUG9zaXRpb24gaW4gdGhlIGFycmF5CiAgICAgICAgICovCiAgICAgICAgZ2V0UGFyYW1ldGVySW5kZXgocGFyYW1OYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmFtTWFwcGluZ1twYXJhbU5hbWVdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGBQYXJhbWV0ZXJgIG9iamVjdCBpbiBhIGdpdmVuIGluZGV4CiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW5kZXggLSBQb3NpdGlvbiBvZiB0aGUgcGFyYW1ldGVyIGluIHRoZSBhcnJheQogICAgICAgICAqIEByZXR1cm4gLSBQYXJhbWV0ZXIgb2JqZWN0IHZhbHVlCiAgICAgICAgICovCiAgICAgICAgZ2V0UGFyYW1ldGVyQnlJbmRleChpbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJhbXNbaW5kZXhdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBWYWxpZGF0ZXMgaWYgdGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgZXhpc3RzIGluIHRoZSBvYmplY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcGFyYW1OYW1lIC0gVGhlIHBhcmFtZXRlciBuYW1lLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGhhc1BhcmFtZXRlcihwYXJhbU5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHBhcmFtTmFtZSBpbiB0aGlzLnBhcmFtTWFwcGluZzsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIGEgbWFwcGluZyBmcm9tIG9uZSBuYW1lIHRvIGEgbmV3IHBhcmFtZXRlci4KICAgICAgICAgKiBUaGlzIGlzIHVzZWQgdG8gaGFuZGxlIG1pZ3JhdGluZyBwYXJhbWV0ZXJzIHRvIG5ldyBuYW1lcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBrZXkgLSBUaGUgcGFyYW1ldGVyIG5hbWUuCiAgICAgICAgICogQHBhcmFtIHBhcmFtTmFtZSAtIFRoZSBwYXJhbWV0ZXIgbmFtZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBhZGRQYXJhbWV0ZXJEZXByZWNhdGlvbk1hcHBpbmcoa2V5LCBwYXJhbU5hbWUpIHsKICAgICAgICAgICAgdGhpcy5kZXByZWNhdGVkUGFyYW1NYXBwaW5nW2tleV0gPSBwYXJhbU5hbWU7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYFBhcmFtZXRlcmAgb2JqZWN0IHVzaW5nIHRoZSBnaXZlbiBuYW1lCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcGFyYW1OYW1lIC0gVGhlIHBhcmFtZXRlciBuYW1lLgogICAgICAgICAqIEByZXR1cm4gLSBQYXJhbWV0ZXIgb2JqZWN0IHZhbHVlCiAgICAgICAgICovCiAgICAgICAgZ2V0UGFyYW1ldGVyKHBhcmFtTmFtZSkgewogICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnBhcmFtTWFwcGluZ1twYXJhbU5hbWVdOwogICAgICAgICAgICBpZiAoaW5kZXggPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdQYXJhbU5hbWUgPSB0aGlzLmRlcHJlY2F0ZWRQYXJhbU1hcHBpbmdbcGFyYW1OYW1lXTsKICAgICAgICAgICAgICAgIGlmICghbmV3UGFyYW1OYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogU2hvdWxkIHRoaXMgbWV0aG9kIG5vdCByZXR1cm4gbnVsbD8KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAvLyB0aHJvdyBFcnJvcihgTm8gUGFyYW1ldGVyIHdpdGggdGhhdCBuYW1lIGV4aXN0czogJHtwYXJhbU5hbWV9IGApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFBhcmFtZXRlciBuYW1lICR7cGFyYW1OYW1lfSBpcyBub3cgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSAke25ld1BhcmFtTmFtZX0gaW5zdGVhZC5gKTsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMucGFyYW1NYXBwaW5nW25ld1BhcmFtTmFtZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyYW1zW2luZGV4XTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhpcyBtZXRob2QgY2FuIGJlIG92ZXJyaWRkZW4gaW4gZGVyaXZlZCBjbGFzc2VzCiAgICAgICAgICogdG8gcGVyZm9ybSBnZW5lcmFsIHVwZGF0ZXMgKHNlZSBHTFBhc3Mgb3IgQmFzZUl0ZW0pLgogICAgICAgICAqIEBwYXJhbSBldmVudCAtIFRoZSBldmVudCBvYmplY3QgZW1pdHRlZCBieSB0aGUgcGFyYW1ldGVyLgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgcGFyYW1ldGVyVmFsdWVDaGFuZ2VkKGV2ZW50KSB7CiAgICAgICAgICAgIHRoaXMuZW1pdCgncGFyYW1ldGVyVmFsdWVDaGFuZ2VkJywgZXZlbnQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIGBQYXJhbWV0ZXJgIG9iamVjdCB0byB0aGUgb3duZXIncyBwYXJhbWV0ZXIgbGlzdC4KICAgICAgICAgKgogICAgICAgICAqIEBlbWl0cyBgcGFyYW1ldGVyQWRkZWRgIHdpdGggdGhlIG5hbWUgb2YgdGhlIHBhcmFtLgogICAgICAgICAqIEBwYXJhbSBwYXJhbSAtIFRoZSBwYXJhbWV0ZXIgdG8gYWRkLgogICAgICAgICAqIEByZXR1cm4gLSBXaXRoIGBvd25lcmAgYW5kIGB2YWx1ZUNoYW5nZWRgIGV2ZW50IHNldC4KICAgICAgICAgKi8KICAgICAgICBhZGRQYXJhbWV0ZXIocGFyYW0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0UGFyYW1ldGVyKHBhcmFtLCB0aGlzLnBhcmFtcy5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIGBQYXJhbWV0ZXJgIG9iamVjdCB0byB0aGUgb3duZXIncyBwYXJhbWV0ZXIgbGlzdCB1c2luZyB0aGUgaW5kZXguCiAgICAgICAgICogSXQgcmVwbGFjZXMgdGhlIGV2ZW50IGluIHRoZSBzcGVjaWZpZWQgaW5kZXguCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIEBlbWl0cyBgcGFyYW1ldGVyQWRkZWRgIHdpdGggdGhlIG5hbWUgb2YgdGhlIHBhcmFtLgogICAgICAgICAqIEBwYXJhbSBwYXJhbSAtIFRoZSBwYXJhbWV0ZXIgdG8gaW5zZXJ0LgogICAgICAgICAqIEBwYXJhbSBpbmRleCAtIFRoZSBpbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gV2l0aCBgb3duZXJgIGFuZCBgdmFsdWVDaGFuZ2VkYCBldmVudCBzZXQuCiAgICAgICAgICovCiAgICAgICAgaW5zZXJ0UGFyYW1ldGVyKHBhcmFtLCBpbmRleCkgewogICAgICAgICAgICBjb25zdCBuYW1lID0gcGFyYW0uZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAodGhpcy5wYXJhbU1hcHBpbmdbbmFtZV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1JlcGxhY2luZyBQYXJhbWV0ZXI6JyArIG5hbWUpOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQYXJhbWV0ZXIobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFyYW0uc2V0T3duZXIodGhpcyk7CiAgICAgICAgICAgIHRoaXMucGFyYW1FdmVudExpc3RlbmVySURzW25hbWVdID0gcGFyYW0ub24oJ3ZhbHVlQ2hhbmdlZCcsIChldmVudCkgPT4gewogICAgICAgICAgICAgICAgLy8gTm90ZTogc3ByZWFkIG9wZXJhdG9ycyBjYXVzZSBlcnJvcnMgb24gaU9TIDExLgogICAgICAgICAgICAgICAgY29uc3QgbmV3RXZlbnQgPSB7IHBhcmFtIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBldmVudCkKICAgICAgICAgICAgICAgICAgICBuZXdFdmVudFtrZXldID0gZXZlbnRba2V5XTsKICAgICAgICAgICAgICAgIHRoaXMucGFyYW1ldGVyVmFsdWVDaGFuZ2VkKG5ld0V2ZW50KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGFyYW1zLnNwbGljZShpbmRleCwgMCwgcGFyYW0pOwogICAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCB0aGlzLnBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGhpcy5wYXJhbU1hcHBpbmdbdGhpcy5wYXJhbXNbaV0uZ2V0TmFtZSgpXSA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgUGFyYW1ldGVyQWRkZWRFdmVudChuYW1lKTsKICAgICAgICAgICAgdGhpcy5lbWl0KCdwYXJhbWV0ZXJBZGRlZCcsIGV2ZW50KTsKICAgICAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmVzIGBQYXJhbWV0ZXJgIGZyb20gb3duZXIsIGJ5IHVzaW5nIHBhcmFtZXRlcidzIG5hbWUuCiAgICAgICAgICogQGVtaXRzIGBwYXJhbWV0ZXJSZW1vdmVkYCB3aXRoIHRoZSBuYW1lIG9mIHRoZSBwYXJhbS4KICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBwYXJhbWV0ZXIgbmFtZS4KICAgICAgICAgKi8KICAgICAgICByZW1vdmVQYXJhbWV0ZXIobmFtZSkgewogICAgICAgICAgICBpZiAodGhpcy5wYXJhbU1hcHBpbmdbbmFtZV0gPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byByZW1vdmUgUGFyYW1ldGVyOicgKyBuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucGFyYW1NYXBwaW5nW25hbWVdOwogICAgICAgICAgICBjb25zdCBwYXJhbSA9IHRoaXMucGFyYW1zW3RoaXMucGFyYW1NYXBwaW5nW25hbWVdXTsKICAgICAgICAgICAgcGFyYW0ucmVtb3ZlTGlzdGVuZXJCeUlkKCd2YWx1ZUNoYW5nZWQnLCB0aGlzLnBhcmFtRXZlbnRMaXN0ZW5lcklEc1tuYW1lXSk7CiAgICAgICAgICAgIHRoaXMucGFyYW1zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBhcmFtTWFwcGluZ1tuYW1lXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IGluZGV4OyBpIDwgdGhpcy5wYXJhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRoaXMucGFyYW1NYXBwaW5nW3RoaXMucGFyYW1zW2ldLmdldE5hbWUoKV0gPSBpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IFBhcmFtZXRlclJlbW92ZWRFdmVudChuYW1lKTsKICAgICAgICAgICAgdGhpcy5lbWl0KCdwYXJhbWV0ZXJSZW1vdmVkJywgZXZlbnQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXBsYWNlcyBvbGQgYFBhcmFtZXRlcmAgYnkgcGFzc2luZyBhIG5ldyBvbmUgd2l0aCB0aGUgc2FtZSBuYW1lLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHBhcmFtIC0gVGhlIHBhcmFtZXRlciB0byByZXBsYWNlLgogICAgICAgICAqIEByZXR1cm4gLSBgUGFyYW1ldGVyYCB3aXRoIGB2YWx1ZUNoYW5nZWRgIGV2ZW50IHNldC4KICAgICAgICAgKi8KICAgICAgICByZXBsYWNlUGFyYW1ldGVyKHBhcmFtKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwYXJhbS5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnBhcmFtTWFwcGluZ1tuYW1lXSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIHJlcGxhY2UgUGFyYW1ldGVyOicgKyBuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucGFyYW1NYXBwaW5nW25hbWVdOwogICAgICAgICAgICB0aGlzLnJlbW92ZVBhcmFtZXRlcihuYW1lKTsKICAgICAgICAgICAgdGhpcy5pbnNlcnRQYXJhbWV0ZXIocGFyYW0sIGluZGV4KTsKICAgICAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gUGVyc2lzdGVuY2UKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgdG9KU09OIG1ldGhvZCBlbmNvZGVzIHRoaXMgdHlwZSBhcyBhIGpzb24gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIGNvbnRleHQgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTihjb250ZXh0KSB7CiAgICAgICAgICAgIGNvbnN0IGpzb24gPSB7CiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmdldENsYXNzTmFtZSgpLAogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBwYXJhbXNKU09OID0ge307CiAgICAgICAgICAgIGxldCBzYXZlZFBhcmFtcyA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgcGFyYW0gb2YgdGhpcy5wYXJhbXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtSlNPTiA9IHBhcmFtLnRvSlNPTihjb250ZXh0KTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbUpTT04pIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXNKU09OW3BhcmFtLmdldE5hbWUoKV0gPSBwYXJhbUpTT047CiAgICAgICAgICAgICAgICAgICAgc2F2ZWRQYXJhbXMrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2F2ZWRQYXJhbXMgPiAwKQogICAgICAgICAgICAgICAganNvbi5wYXJhbXMgPSBwYXJhbXNKU09OOwogICAgICAgICAgICByZXR1cm4ganNvbjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGZyb21KU09OIG1ldGhvZCBkZWNvZGVzIGEganNvbiBvYmplY3QgZm9yIHRoaXMgdHlwZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqc29uIC0gVGhlIGpzb24gb2JqZWN0IHRoaXMgaXRlbSBtdXN0IGRlY29kZS4KICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGpzb24sIGNvbnRleHQpIHsKICAgICAgICAgICAgaWYgKGpzb24ucGFyYW1zKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBqc29uLnBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBqID0ganNvbi5wYXJhbXNba2V5XTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IHRoaXMuZ2V0UGFyYW1ldGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJhbSkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdQYXJhbSBub3QgZm91bmQ6JyArIGtleSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwai5wYXJhbVBhdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPT09IG51bGwgfHwgY29udGV4dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGV4dC5yZXNvbHZlUGF0aChwai5wYXJhbVBhdGgsIChwYXJhbSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVBhcmFtZXRlcihwYXJhbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdVbmFibGUgdG8gcmVzb2x2ZSBzaGFyZWQgcGFyYW1ldGVyOicgKyBwai5wYXJhbVBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbS5mcm9tSlNPTihwaiwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVXNlcyBwYXNzZWQgaW4gQmluUmVhZGVyIG9iamVjdChjb250YWluaW5nIGFuIEludDMyIGFycmF5IHdpdGggYWxsIHRoZSBwYXJhbWV0ZXJzKSB0byByZWNvbnN0cnVjdCBhbGwgcGFyYW1ldGVycyBzdGF0ZS4KICAgICAgICAgKgogICAgICAgICAqIEluIGVhY2ggaXRlcmF0aW9uIG9mIHRoZSBhcnJheSwgcHJvcFR5cGUgYW5kIHByb3BOYW1lIGFyZSBleHRyYWN0ZWQgYW5kCiAgICAgICAgICogdXNlZCB0byBidWlsZCB0aGUgcmlnaHQgYFBhcmFtZXRlcmAgY2xhc3MuIFRoZW4gYWxsIG9mIHRoZW0gYXJlIGFkZGVkIHRvIHRoZSBvYmplY3QuCiAgICAgICAgICoKICAgICAgICAgKiBAZW1pdHMgYHBhcmFtZXRlckFkZGVkYCB3aXRoIHRoZSBuYW1lIG9mIHRoZSBwYXJhbS4KICAgICAgICAgKiBAcGFyYW0gcmVhZGVyIC0gVGhlIHJlYWRlciB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHJlYWRCaW5hcnkocmVhZGVyLCBjb250ZXh0KSB7CiAgICAgICAgICAgIC8vIFRPRE86IG1ha2UgdGhpcyB3b3JrCiAgICAgICAgICAgIGlmICgoY29udGV4dCA9PT0gbnVsbCB8fCBjb250ZXh0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb250ZXh0LnZlcnNpb25zWyd6ZWEtZW5naW5lJ10uY29tcGFyZShbMCwgMCwgM10pKSA+PSAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBudW1Qcm9wcyA9IHJlYWRlci5sb2FkVUludDMyKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVByb3BzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wVHlwZSA9IHJlYWRlci5sb2FkU3RyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcE5hbWUgPSByZWFkZXIubG9hZFN0cigpOwogICAgICAgICAgICAgICAgICAgIGxldCBwYXJhbSA9IHRoaXMuZ2V0UGFyYW1ldGVyKHByb3BOYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmFtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtID0gUmVnaXN0cnkuY29uc3RydWN0Q2xhc3MocHJvcFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmFtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmFibGUgdG8gY29uc3RydWN0IHByb3A6JyArIHByb3BOYW1lICsgJyBvZiB0eXBlOicgKyBwcm9wVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbS5zZXROYW1lKHByb3BOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRQYXJhbWV0ZXIocGFyYW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYXJhbS5yZWFkQmluYXJ5KHJlYWRlciwgY29udGV4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgb2JqZWN0J3MgSlNPTiB2YWx1ZSBhbmQgY29udmVydHMgaXQgdG8gYSBzdHJpbmcuCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQKICAgICAgICAgKiBAcmV0dXJuIC0gU3RyaW5nIG9mIG9iamVjdCdzIHBhcmFtZXRlciBsaXN0IHN0YXRlLgogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nKGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksIG51bGwsIDIpOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gQ2xvbmUgYW5kIERlc3Ryb3kKICAgICAgICAvKioKICAgICAgICAgKiBDb3BpZXMgUGFyYW1ldGVycyBmcm9tIGFub3RoZXIgYFBhcmFtZXRlck93bmVyYCB0byBjdXJyZW50IG9iamVjdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzcmMgLSBUaGUgUGFyYW1ldGVyT3duZXIgY29weSBmcm9tLgogICAgICAgICAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIGNvbnRleHQgdmFsdWUKICAgICAgICAgKi8KICAgICAgICBjb3B5RnJvbShzcmMsIGNvbnRleHQpIHsKICAgICAgICAgICAgLy8gTm90ZTogTG9vcCBvdmVyIHRoZSBwYXJhbWV0ZXJzIGluIHJldmVyc2Ugb3JkZXIsCiAgICAgICAgICAgIC8vIHRoaXMgaXMgYmVjYXVzZSBvZnRlbiwgcGFyYW1ldGVyIGRlcGVuZGVuY2llcwogICAgICAgICAgICAvLyBhcmUgYm90dG9tIHRvIHRvcCAoYm90dG9tIHBhcmFtcyBkZXBlbmRlbnQgb24gaGlnaGVyIHBhcmFtcykuCiAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCBhcyBhIHBhcmFtZXRlciBpcyBzZXQgd2l0aCBhIG5ldyB2YWx1ZQogICAgICAgICAgICAvLyBpdCB3aWxsIGRpcnR5IHRoZSBwYXJhbXMgYmVsb3cgaXQuCiAgICAgICAgICAgIGxldCBpID0gc3JjLmdldE51bVBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgY29uc3Qgc3JjUGFyYW0gPSBzcmMuZ2V0UGFyYW1ldGVyQnlJbmRleChpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gdGhpcy5nZXRQYXJhbWV0ZXIoc3JjUGFyYW0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbSkgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IHdlIGFyZSBub3QgY2xvbmluZyB0aGUgdmFsdWVzLgogICAgICAgICAgICAgICAgICAgIHBhcmFtLmNvcHlGcm9tKHNyY1BhcmFtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyKHNyY1BhcmFtLmNsb25lKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi8KICAgIGZ1bmN0aW9uIGFwcHJveEVxdWFsKGEsIGIpIHsKICAgICAgICByZXR1cm4gIWEuc29tZSgodmFsdWUsIGluZGV4KSA9PiBNYXRoLmFicyhiW2luZGV4XSAtIHZhbHVlKSA+IDAuMDAxKTsKICAgIH0KICAgIGZ1bmN0aW9uIGlzSW5pdGlhbGl6ZWQoYSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIU51bWJlci5pc05hTihhW2ldKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjbGFzcyBBdHRyaWJ1dGUgZXh0ZW5kcyBCYXNlQ2xhc3MgewogICAgICAgIGNvbnN0cnVjdG9yKGRhdGFUeXBlTmFtZSwgc3RyaWRlKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMCk7CiAgICAgICAgICAgIHRoaXMuZGF0YVR5cGVOYW1lID0gZGF0YVR5cGVOYW1lOwogICAgICAgICAgICB0aGlzLnN0cmlkZSA9IHN0cmlkZTsKICAgICAgICAgICAgdGhpcy5pbml0UmFuZ2UoMCk7CiAgICAgICAgICAgIHRoaXMuc3BsaXRzID0ge307CiAgICAgICAgICAgIHRoaXMuc3BsaXRWYWx1ZXMgPSBbXTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgTWVzaCByZWZlcmVuY2UgdG8gdGhlIFZlcnRleEF0dHJpYnV0ZS4gVGhpcyBpcyBuZWVkZWQgZm9yIGF0dHJpYnV0ZXMKICAgICAgICAgKiBhc3NpZ25lZCB0byBtZXNoZXMsIGFuZCBpcyB1c2VkIHRvIGNhbGN1bGF0ZSBmYWNlIHZlcnRleCBpbmRpY2VzLgogICAgICAgICAqID4gTm90ZTogdGhlIG1lc2ggYXV0b21hdGljYWxseSBjYWxscyB0aGlzIG1ldGhvZCB3aGVuIGEgdmVydGV4IGF0dHJpYnV0ZSBpcyBhc3NpZ25lZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBtZXNoIC0gVGhlIG1lc2ggb2JqZWN0CiAgICAgICAgICovCiAgICAgICAgc2V0TWVzaChtZXNoKSB7CiAgICAgICAgICAgIHRoaXMubWVzaCA9IG1lc2g7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGJhY2tpbmcgYXJyYXkgZm9yIHRoaXMgYXR0cmlidXRlCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBhc0FycmF5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBuYW1lIG9mIHRoZSBtYXRoIHR5cGUgdGhpcyBhdHRyaWJ1dGUgc3RvcmVzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0RGF0YVR5cGVOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhVHlwZU5hbWU7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGNvdW50IG9mIGF0dHJpYnV0ZSB2YWx1ZXMgaW4gdGhlIGRhdGEuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5sZW5ndGggLyB0aGlzLnN0cmlkZTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgY291bnQgb2YgYXR0cmlidXRlIHZhbHVlcyBpbiB0aGUgZGF0YS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzaXplIC0gVGhlIHNpemUgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0Q291bnQoY291bnQpIHsKICAgICAgICAgICAgY29uc3QgcHJldkxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IG5ld0xlbmd0aCA9IGNvdW50ICogdGhpcy5zdHJpZGU7CiAgICAgICAgICAgIGlmIChuZXdMZW5ndGggPiBwcmV2TGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IEZsb2F0MzJBcnJheShuZXdMZW5ndGgpOwogICAgICAgICAgICAgICAgZGF0YS5zZXQodGhpcy5kYXRhLCAwKTsKICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRSYW5nZShwcmV2TGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChuZXdMZW5ndGggPCBwcmV2TGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmRhdGEuc2xpY2UoMCwgbmV3TGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIDsKICAgICAgICAgICAgdGhpcy5zcGxpdHMgPSB7fTsKICAgICAgICAgICAgdGhpcy5zcGxpdFZhbHVlcyA9IFtdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBGaWxscyB1cCBkYXRhIHZhbHVlcyB3aXRoIGRlZmF1bHQgb25lcyBzdGFydGluZyBmcm9tIHRoZSBzcGVjaWZpZWQgaW5kZXguCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc3RhcnQgLSBUaGUgc3RhcnQgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaW5pdFJhbmdlKHN0YXJ0KSB7CiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIHZhbHVlcyB0byBpbnZhbGlkIHZhbHVlcy4KICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgdGhpcy5kYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhdGFbaV0gPSBOdW1iZXIuTmFOOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBzdG9yZWQgaW4gZWFjaCBgVGAuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgbnVtRWxlbWVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmlkZTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBkYXRhIHZhbHVlIG9mIHRoZSBzcGVjaWZpZWQgaW5kZXguCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW5kZXggLSBUaGUgaW5kZXggdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0RmxvYXQzMlZhbHVlKGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFbaW5kZXhdOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIGRhdGEgdmFsdWUgaW4gdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBpbmRleCAtIFRoZSBpbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0RmxvYXQzMlZhbHVlKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gRmFjZSBWZXJ0ZXggVmFsdWVzCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGdldFNwbGl0cyBtZXRob2QuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0U3BsaXRzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zcGxpdHM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIHZhbHVlIG9mIGEgY29ybmVyIHZlcnRleCBvZiBhIGZhY2UuCiAgICAgICAgICogQHBhcmFtIGZhY2UgLSBUaGUgZmFjZSBpbmRleC4KICAgICAgICAgKiBAcGFyYW0gZmFjZVZlcnRleCAtIFRoZSBpbmRleCBvZiB2ZXJ0ZXggd2l0aGluIHRoZSBmYWNlLiBbMC4uLiBudW0gZmFjZSB2ZXJ0aWNlc10KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRGYWNlVmVydGV4VmFsdWVSZWZfYXJyYXkoZmFjZSwgZmFjZVZlcnRleCkgewogICAgICAgICAgICBjb25zdCB2ZXJ0ZXggPSB0aGlzLm1lc2guZ2V0RmFjZVZlcnRleEluZGV4KGZhY2UsIGZhY2VWZXJ0ZXgpOwogICAgICAgICAgICBpZiAodmVydGV4IGluIHRoaXMuc3BsaXRzICYmIGZhY2UgaW4gdGhpcy5zcGxpdHNbdmVydGV4XSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BsaXRWYWx1ZXNbdGhpcy5zcGxpdHNbdmVydGV4XVtmYWNlXV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5zdWJhcnJheSh2ZXJ0ZXggKiB0aGlzLnN0cmlkZSwgKHZlcnRleCArIDEpICogdGhpcy5zdHJpZGUpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiBhIGNvcm5lciB2ZXJ0ZXggb2YgYSBmYWNlLgogICAgICAgICAqIEBwYXJhbSBmYWNlIC0gVGhlIGZhY2UgaW5kZXguCiAgICAgICAgICogQHBhcmFtIGZhY2VWZXJ0ZXggLSBUaGUgaW5kZXggb2YgdmVydGV4IHdpdGhpbiB0aGUgZmFjZS4gWzAuLi4gbnVtIGZhY2UgdmVydGljZXNdCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldEZhY2VWZXJ0ZXhWYWx1ZV9hcnJheShmYWNlLCBmYWNlVmVydGV4LCB2YWx1ZSkgewogICAgICAgICAgICBjb25zdCB2ZXJ0ZXggPSB0aGlzLm1lc2guZ2V0RmFjZVZlcnRleEluZGV4KGZhY2UsIGZhY2VWZXJ0ZXgpOwogICAgICAgICAgICB0aGlzLnNldEZhY2VWZXJ0ZXhWYWx1ZV9CeVZlcnRleEluZGV4KGZhY2UsIHZlcnRleCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXggbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSBmYWNlIC0gVGhlIGZhY2UgaW5kZXguCiAgICAgICAgICogQHBhcmFtIHZlcnRleCAtIFRoZSB2ZXJ0ZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldEZhY2VWZXJ0ZXhWYWx1ZV9CeVZlcnRleEluZGV4KGZhY2UsIHZlcnRleCwgdmFsdWUpIHsKICAgICAgICAgICAgY29uc3QgY3VyclZhbHVlID0gdGhpcy5kYXRhLnN1YmFycmF5KHZlcnRleCAqIHRoaXMuc3RyaWRlLCAodmVydGV4ICsgMSkgKiB0aGlzLnN0cmlkZSk7CiAgICAgICAgICAgIGlmICghaXNJbml0aWFsaXplZChjdXJyVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAvLyB0aGUgdmFsdWUgaXMgdW5pbml0aWFsaXplZC4gSW5pdGlhbGl6ZSBpdC4KICAgICAgICAgICAgICAgIGN1cnJWYWx1ZS5zZXQodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGFwcHJveEVxdWFsKGN1cnJWYWx1ZSwgdmFsdWUpKSA7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gVGhlIG5ldyB2YWx1ZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgZXhpc3RpbmcgdmFsdWUKICAgICAgICAgICAgICAgIGlmICh2ZXJ0ZXggaW4gdGhpcy5zcGxpdHMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgY2hlY2sgaWYgYW55IGV4aXN0aW5nIHNwbGl0cyBmb3IgdGhpcyB2ZXJ0ZXggbWF0Y2ggdGhlIHZhbHVlIGJlaW5nIHNldC4KICAgICAgICAgICAgICAgICAgICAvLyBpLmUuIGZvciBmYWNlcyBhcm91bmQgYSB2ZXJ0ZXgsIHRoZXJlIHdpbGwgb2Z0ZW4gYmUgYSBzZWFtIGFsb25nIDIgZWRnZXMKICAgICAgICAgICAgICAgICAgICAvLyB3aGVyZSB0aGUgdmFsdWVzIGRpZmZlci4gT24gZWFjaCBzaWRlIG9mIHRoZSBzZWFtLCBhbGwgZmFjZXMgY2FuIHVzZSB0aGUgc2FtZQogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlLiBXZSBzaG91bGQgc2VlIHRoZW4gb25seSBvbmUgc3BsaXQgdmFsdWUgZm9yIHRoZSB2ZXJ0ZXguCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVydGV4U3BsaXRJZHMgPSB0aGlzLnNwbGl0c1t2ZXJ0ZXhdOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlkIGluIHZlcnRleFNwbGl0SWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0SWQgPSB2ZXJ0ZXhTcGxpdElkc1tmaWRdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwcm94RXF1YWwodGhpcy5zcGxpdFZhbHVlc1tzcGxpdElkXSwgdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZS11c2UgdGhpcyBzcGxpdCB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4U3BsaXRJZHNbZmFjZV0gPSBzcGxpdElkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIElmIGEgc3BsaXQgYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgZmFjZSwgcmUtdXNlIGl0LgogICAgICAgICAgICAgICAgICAgIGlmIChmYWNlIGluIHRoaXMuc3BsaXRzW3ZlcnRleF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGxpdFZhbHVlc1t0aGlzLnNwbGl0c1t2ZXJ0ZXhdW2ZhY2VdXSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGxpdHNbdmVydGV4XSA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zcGxpdHNbdmVydGV4XVtmYWNlXSA9IHRoaXMuc3BsaXRWYWx1ZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgdGhpcy5zcGxpdFZhbHVlcy5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc2V0U3BsaXRWZXJ0ZXhWYWx1ZSBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIHZlcnRleCAtIFRoZSB2ZXJ0ZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGZhY2UgLSBUaGUgZmFjZSBpbmRleC4KICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0U3BsaXRWZXJ0ZXhWYWx1ZV9hcnJheSh2ZXJ0ZXgsIGZhY2UsIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghKHZlcnRleCBpbiB0aGlzLnNwbGl0cykpCiAgICAgICAgICAgICAgICB0aGlzLnNwbGl0c1t2ZXJ0ZXhdID0ge307CiAgICAgICAgICAgIGlmIChmYWNlIGluIHRoaXMuc3BsaXRzW3ZlcnRleF0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJWYWx1ZSA9IHRoaXMuc3BsaXRWYWx1ZXNbdGhpcy5zcGxpdHNbdmVydGV4XVtmYWNlXV07CiAgICAgICAgICAgICAgICBpZiAoYXBwcm94RXF1YWwoY3VyclZhbHVlLCB2YWx1ZSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWNlIFZlcnRleCBBbHJlYWR5IFNwbGl0IHdpdGggZGlmZmVyZW50IHZhbHVlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zcGxpdHNbdmVydGV4XVtmYWNlXSA9IHRoaXMuc3BsaXRWYWx1ZXMubGVuZ3RoOwogICAgICAgICAgICB0aGlzLnNwbGl0VmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc2V0U3BsaXRWZXJ0ZXhWYWx1ZXMgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSB2ZXJ0ZXggLSBUaGUgdmVydGV4IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBmYWNlR3JvdXAgLSBUaGUgZmFjZUdyb3VwIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRTcGxpdFZlcnRleFZhbHVlcyh2ZXJ0ZXgsIGZhY2VHcm91cCwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCEodmVydGV4IGluIHRoaXMuc3BsaXRzKSkKICAgICAgICAgICAgICAgIHRoaXMuc3BsaXRzW3ZlcnRleF0gPSB7fTsKICAgICAgICAgICAgY29uc3Qgc3BsaXRJbmRleCA9IHRoaXMuc3BsaXRWYWx1ZXMubGVuZ3RoOwogICAgICAgICAgICB0aGlzLnNwbGl0VmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGZhY2Ugb2YgZmFjZUdyb3VwKSB7CiAgICAgICAgICAgICAgICAvLyBpZiAoZmFjZSBpbiB0aGlzLnNwbGl0c1t2ZXJ0ZXhdKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgbGV0IGN1cnJWYWx1ZSA9IHRoaXMuc3BsaXRWYWx1ZXNbdGhpcy5zcGxpdHNbdmVydGV4XVtmYWNlXV07CiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKGN1cnJWYWx1ZS5hcHByb3hFcXVhbCh2YWx1ZSkpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIC8vICAgICBjb25zb2xlLndhcm4oIkZhY2UgVmVydGV4IEFscmVhZHkgU3BsaXQgd2l0aCBkaWZmZXJlbnQgdmFsdWUiKTsKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIHRoaXMuc3BsaXRzW3ZlcnRleF1bZmFjZV0gPSBzcGxpdEluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBnZW5lcmF0ZVNwbGl0VmFsdWVzIG1ldGhvZC4KICAgICAgICAgKiBAcGFyYW0gc3BsaXRJbmRpY2VzIC0gVGhlIHNwbGl0SW5kaWNlcyB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gc3BsaXRDb3VudCAtIFRoZSBzcGxpdENvdW50IHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdlbmVyYXRlU3BsaXRWYWx1ZXMoc3BsaXRJbmRpY2VzLCBzcGxpdENvdW50KSB7CiAgICAgICAgICAgIGlmIChzcGxpdENvdW50ID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhOwogICAgICAgICAgICBjb25zdCBudW1VblNwbGl0VmFsdWVzID0gdGhpcy5nZXRDb3VudCgpOwogICAgICAgICAgICBjb25zdCBkYXRhID0gbmV3IEZsb2F0MzJBcnJheSgobnVtVW5TcGxpdFZhbHVlcyArIHNwbGl0Q291bnQpICogdGhpcy5zdHJpZGUpOwogICAgICAgICAgICBkYXRhLnNldCh0aGlzLmRhdGEpOwogICAgICAgICAgICAvLyBOb3cgZHVwbGljYXRlIHRoZSBzcGxpdCB2YWx1ZXMgdG8gZ2VuZXJhdGUgYW4gYXR0cmlidXRlcyBhcnJheQogICAgICAgICAgICAvLyB1c2luZyB0aGUgc2hhcmVkIHNwbGl0cyBhY3Jvc3MgYWxsIGF0dHJpYnV0ZXMuCiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBndWFyZC1mb3ItaW4KICAgICAgICAgICAgZm9yIChjb25zdCB2ZXJ0ZXggaW4gc3BsaXRJbmRpY2VzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmYWNlcyA9IHNwbGl0SW5kaWNlc1t2ZXJ0ZXhdOwogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGd1YXJkLWZvci1pbgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYWNlIGluIGZhY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGd0ID0gbnVtVW5TcGxpdFZhbHVlcyArIGZhY2VzW2ZhY2VdOwogICAgICAgICAgICAgICAgICAgIGlmICh2ZXJ0ZXggaW4gdGhpcy5zcGxpdHMgJiYgZmFjZSBpbiB0aGlzLnNwbGl0c1t2ZXJ0ZXhdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgYXR0cmlidXRlIGhhcyBhIHNwbGl0IHZhbHVlIGluIGl0cyBhcnJheS4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbXVzdCB1c2UgdGhhdCB2YWx1ZS4uLgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcmMgPSB0aGlzLnNwbGl0c1t2ZXJ0ZXhdW2ZhY2VdOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNwbGl0VmFsdWVzW3NyY10uZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW3RndCAqIHRoaXMuc3RyaWRlICsgaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29weSBlYWNoIHNjYWxhciB2YWx1ZSB0byB0aGUgbmV3IHBsYWNlIGluIHRoZSBhcnJheS4KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3JjID0gcGFyc2VJbnQodmVydGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLnN0cmlkZTsgZSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW3RndCAqIHRoaXMuc3RyaWRlICsgZV0gPSB0aGlzLmRhdGFbc3JjICogdGhpcy5zdHJpZGUgKyBlXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHRvSlNPTiBtZXRob2QgZW5jb2RlcyB0aGlzIHR5cGUgYXMgYSBqc29uIG9iamVjdCBmb3IgcGVyc2lzdGVuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICB0b0pTT04oY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6IHRoaXMuZGF0YVR5cGVOYW1lLAogICAgICAgICAgICAgICAgbGVuZ3RoOiB0aGlzLmRhdGEubGVuZ3RoIC8gdGhpcy5zdHJpZGUsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBmcm9tSlNPTiBtZXRob2QgZGVjb2RlcyBhIGpzb24gb2JqZWN0IGZvciB0aGlzIHR5cGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaiAtIFRoZSBqc29uIG9iamVjdCB0aGlzIGl0ZW0gbXVzdCBkZWNvZGUuCiAgICAgICAgICovCiAgICAgICAgZnJvbUpTT04oaikgewogICAgICAgICAgICBjb25zdCBkYXRhID0gai5kYXRhLm1hcCgoZGF0YUVsZW1lbnQpID0+IE1hdGhGdW5jdGlvbnMuaXNOdW1lcmljKGRhdGFFbGVtZW50KSA/IGRhdGFFbGVtZW50IDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTsKICAgICAgICAgICAgdGhpcy5kYXRhID0gRmxvYXQzMkFycmF5LmZyb20oZGF0YSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBsb2FkU3BsaXRWYWx1ZXMgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSByZWFkZXIgLSBUaGUgcmVhZGVyIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRTcGxpdFZhbHVlcyhyZWFkZXIpIHsKICAgICAgICAgICAgY29uc3Qgc3BsaXRJbmRpY2VzID0gcmVhZGVyLmxvYWRVSW50MzJBcnJheSgpOwogICAgICAgICAgICBpZiAoc3BsaXRJbmRpY2VzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgbGV0IG51bVNwbGl0VmFsdWVzID0gMDsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZlcnRleElkID0gc3BsaXRJbmRpY2VzW29mZnNldCsrXTsKICAgICAgICAgICAgICAgIGNvbnN0IG51bVNwbGl0cyA9IHNwbGl0SW5kaWNlc1tvZmZzZXQrK107CiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdHMgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU3BsaXRzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWNlSWQgPSBzcGxpdEluZGljZXNbb2Zmc2V0KytdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0SWQgPSBzcGxpdEluZGljZXNbb2Zmc2V0KytdOwogICAgICAgICAgICAgICAgICAgIHNwbGl0c1tmYWNlSWRdID0gc3BsaXRJZDsKICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRJZCA+PSBudW1TcGxpdFZhbHVlcykKICAgICAgICAgICAgICAgICAgICAgICAgbnVtU3BsaXRWYWx1ZXMgPSBzcGxpdElkICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc3BsaXRzW3ZlcnRleElkXSA9IHNwbGl0czsKICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPj0gc3BsaXRJbmRpY2VzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkaW0gPSB0aGlzLnN0cmlkZTsKICAgICAgICAgICAgY29uc3Qgc3BsaXRWYWx1ZXMgPSByZWFkZXIubG9hZEZsb2F0MzJBcnJheShudW1TcGxpdFZhbHVlcyAqIGRpbSk7CiAgICAgICAgICAgIHRoaXMuc3BsaXRWYWx1ZXMgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TcGxpdFZhbHVlczsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBzcGxpdFZhbHVlcy5zbGljZShpICogZGltLCBpICogZGltICsgZGltKTsKICAgICAgICAgICAgICAgIHRoaXMuc3BsaXRWYWx1ZXMucHVzaCh2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0J3Mgc3RhdGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksIG51bGwsIDIpOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gTWVtb3J5CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB2ZXJ0ZXggYXR0cmlidXRlcyBidWZmZXJzIGFuZCBpdHMgY291bnQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZW5CdWZmZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB2YWx1ZXM6IHRoaXMuZGF0YSwKICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLmdldENvdW50KCksCiAgICAgICAgICAgICAgICBkYXRhVHlwZTogdGhpcy5kYXRhVHlwZU5hbWUsCiAgICAgICAgICAgICAgICBub3JtYWxpemVkOiB0aGlzLm5vcm1hbGl6ZWQsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGFuIGF0dHJpYnV0ZS4KICAgICAqLwogICAgY2xhc3MgVmVjM0F0dHJpYnV0ZSBleHRlbmRzIEF0dHJpYnV0ZSB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlIGEgVmVjMkF0dHJpYnV0ZS4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoJ1ZlYzMnLCAzKTsKICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIFZlYzMgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqID4gTm90ZTogJ1JlZicgbWVhbnMgdGhhdCB0aGUgdmFsdWUgY29udGFpbnMgYSByZWZlcmVuY2UgdG8gdGhlIGRhdGEgaW4gdGhlIGF0dHJpYnV0ZS4KICAgICAgICAgKiA+IFRoZSBjb21wb25lbnRzIG9mIHRoZSB2YWx1ZSBjYW4gYmUgY2hhbmdlZCBjYXVzaW5nIHRoZSBhdHRyaWJ1dGVzIGRhdGEgaXMgY2hhbmdlZC4KICAgICAgICAgKiA+IE5vIG5lZWQgdG8gY2FsbCAnc2V0VmFsdWUnLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGluZGV4IC0gVGhlIGluZGV4IHZhbHVlLgogICAgICAgICAqIEByZXR1cm5zIFZlYzMgLSBUaGUgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBnZXRWYWx1ZVJlZihpbmRleCkgewogICAgICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5kYXRhLmxlbmd0aCAvIHRoaXMuc3RyaWRlKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHZlcnRleCBpbmRleDonICsgaW5kZXggKyAnLiBOdW0gVmVydGljZXM6JyArIHRoaXMuZGF0YS5sZW5ndGggLyAzKTsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiB0aGlzLnN0cmlkZTsKICAgICAgICAgICAgY29uc3QgdmFsdWVEYXRhID0gdGhpcy5kYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgdGhpcy5zdHJpZGUpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModmFsdWVEYXRhKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIFZlYzMgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBpbmRleCAtIFRoZSBpbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIFZlYzMgLSBUaGUgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBnZXRWYWx1ZShpbmRleCkgewogICAgICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5kYXRhLmxlbmd0aCAvIHRoaXMuc3RyaWRlKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHZlcnRleCBpbmRleDonICsgaW5kZXggKyAnLiBOdW0gVmVydGljZXM6JyArIHRoaXMuZGF0YS5sZW5ndGggLyAzKTsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiB0aGlzLnN0cmlkZTsKICAgICAgICAgICAgY29uc3QgdmFsdWVEYXRhID0gdGhpcy5kYXRhLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgdGhpcy5zdHJpZGUpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzModmFsdWVEYXRhKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBWZWMzIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW5kZXggLSBUaGUgaW5kZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHNldFZhbHVlKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5kYXRhLmxlbmd0aCAvIHRoaXMuc3RyaWRlKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHZlcnRleCBpbmRleDonICsgaW5kZXggKyAnLiBOdW0gVmVydGljZXM6JyArIHRoaXMuZGF0YS5sZW5ndGggLyAzKTsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaW5kZXggKiB0aGlzLnN0cmlkZTsKICAgICAgICAgICAgdGhpcy5kYXRhLnNldCh2YWx1ZS5hc0FycmF5KCksIG9mZnNldCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEdldHMgdGhlIHZhbHVlIG9mIGEgY29ybmVyIHZlcnRleCBvZiBhIGZhY2UuCiAgICAgICAgICogPiBOb3RlOiAnUmVmJyBtZWFucyB0aGF0IHRoZSB2YWx1ZSBjb250YWlucyBhIHJlZmVyZW5jZSB0byB0aGUgZGF0YSBpbiB0aGUgYXR0cmlidXRlLgogICAgICAgICAqID4gVGhlIGNvbXBvbmVudHMgb2YgdGhlIHZhbHVlIGNhbiBiZSBjaGFuZ2VkIGNhdXNpbmcgdGhlIGF0dHJpYnV0ZXMgZGF0YSBpcyBjaGFuZ2VkLgogICAgICAgICAqID4gTm8gbmVlZCB0byBjYWxsICdzZXRGYWNlVmVydGV4VmFsdWUnLgogICAgICAgICAqIEBwYXJhbSBmYWNlIC0gVGhlIGZhY2UgaW5kZXguCiAgICAgICAgICogQHBhcmFtIGZhY2VWZXJ0ZXggLSBUaGUgaW5kZXggb2YgdmVydGV4IHdpdGhpbiB0aGUgZmFjZS4gWzAuLi4gbnVtIGZhY2UgdmVydGljZXNdCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0RmFjZVZlcnRleFZhbHVlUmVmKGZhY2UsIGZhY2VWZXJ0ZXgpIHsKICAgICAgICAgICAgY29uc3QgYXJyYXkgPSB0aGlzLmdldEZhY2VWZXJ0ZXhWYWx1ZVJlZl9hcnJheShmYWNlLCBmYWNlVmVydGV4KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKGFycmF5KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgdmFsdWUgb2YgYSBjb3JuZXIgdmVydGV4IG9mIGEgZmFjZS4KICAgICAgICAgKiBAcGFyYW0gZmFjZSAtIFRoZSBmYWNlIGluZGV4LgogICAgICAgICAqIEBwYXJhbSBmYWNlVmVydGV4IC0gVGhlIGluZGV4IG9mIHZlcnRleCB3aXRoaW4gdGhlIGZhY2UuIFswLi4uIG51bSBmYWNlIHZlcnRpY2VzXQogICAgICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGYWNlVmVydGV4VmFsdWUoZmFjZSwgZmFjZVZlcnRleCwgdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5zZXRGYWNlVmVydGV4VmFsdWVfYXJyYXkoZmFjZSwgZmFjZVZlcnRleCwgdmFsdWUuYXNBcnJheSgpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHNldFNwbGl0VmVydGV4VmFsdWUgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSB2ZXJ0ZXggLSBUaGUgdmVydGV4IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBmYWNlIC0gVGhlIGZhY2UgaW5kZXguCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldFNwbGl0VmVydGV4VmFsdWUodmVydGV4LCBmYWNlLCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnNldFNwbGl0VmVydGV4VmFsdWVfYXJyYXkodmVydGV4LCBmYWNlLCB2YWx1ZS5hc0FycmF5KCkpOwogICAgICAgIH0KICAgIH0KICAgIFJlZ2lzdHJ5LnJlZ2lzdGVyKCdWZWMzQXR0cmlidXRlJywgVmVjM0F0dHJpYnV0ZSk7CgogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgYW4gYXR0cmlidXRlLgogICAgICovCiAgICBjbGFzcyBWZWMyQXR0cmlidXRlIGV4dGVuZHMgQXR0cmlidXRlIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYSBWZWMyQXR0cmlidXRlLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcignVmVjMicsIDIpOwogICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgVmVjMiB2YWx1ZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LgogICAgICAgICAqCiAgICAgICAgICogPiBOb3RlOiAnUmVmJyBtZWFucyB0aGF0IHRoZSB2YWx1ZSBjb250YWlucyBhIHJlZmVyZW5jZSB0byB0aGUgZGF0YSBpbiB0aGUgYXR0cmlidXRlLgogICAgICAgICAqID4gVGhlIGNvbXBvbmVudHMgb2YgdGhlIHZhbHVlIGNhbiBiZSBjaGFuZ2VkIGNhdXNpbmcgdGhlIGF0dHJpYnV0ZXMgZGF0YSBpcyBjaGFuZ2VkLgogICAgICAgICAqID4gTm8gbmVlZCB0byBjYWxsICdzZXRWYWx1ZScuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW5kZXggLSBUaGUgaW5kZXggdmFsdWUuCiAgICAgICAgICogQHJldHVybnMgVmVjMiAtIFRoZSB2YWx1ZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LgogICAgICAgICAqLwogICAgICAgIGdldFZhbHVlUmVmKGluZGV4KSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+PSB0aGlzLmRhdGEubGVuZ3RoIC8gdGhpcy5zdHJpZGUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdmVydGV4IGluZGV4OicgKyBpbmRleCArICcuIE51bSBWZXJ0aWNlczonICsgdGhpcy5kYXRhLmxlbmd0aCAvIDMpOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIHRoaXMuc3RyaWRlOwogICAgICAgICAgICBjb25zdCB2YWx1ZURhdGEgPSB0aGlzLmRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyB0aGlzLnN0cmlkZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih2YWx1ZURhdGEpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBWZWMyIGZyb20gdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBpbmRleCAtIFRoZSBpbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIFZlYzIgLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldFZhbHVlKGluZGV4KSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+PSB0aGlzLmRhdGEubGVuZ3RoIC8gdGhpcy5zdHJpZGUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdmVydGV4IGluZGV4OicgKyBpbmRleCArICcuIE51bSBWZXJ0aWNlczonICsgdGhpcy5kYXRhLmxlbmd0aCAvIDMpOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIHRoaXMuc3RyaWRlOwogICAgICAgICAgICBjb25zdCB2YWx1ZURhdGEgPSB0aGlzLmRhdGEuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyB0aGlzLnN0cmlkZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih2YWx1ZURhdGEpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIFZlYzIgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBpbmRleCAtIFRoZSBpbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgcGFyYW0uCiAgICAgICAgICovCiAgICAgICAgc2V0VmFsdWUoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+PSB0aGlzLmRhdGEubGVuZ3RoIC8gdGhpcy5zdHJpZGUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdmVydGV4IGluZGV4OicgKyBpbmRleCArICcuIE51bSBWZXJ0aWNlczonICsgdGhpcy5kYXRhLmxlbmd0aCAvIDMpOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpbmRleCAqIHRoaXMuc3RyaWRlOwogICAgICAgICAgICB0aGlzLmRhdGEuc2V0KHZhbHVlLmFzQXJyYXkoKSwgb2Zmc2V0KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2V0cyB0aGUgdmFsdWUgb2YgYSBjb3JuZXIgdmVydGV4IG9mIGEgZmFjZS4KICAgICAgICAgKiA+IE5vdGU6ICdSZWYnIG1lYW5zIHRoYXQgdGhlIHZhbHVlIGNvbnRhaW5zIGEgcmVmZXJlbmNlIHRvIHRoZSBkYXRhIGluIHRoZSBhdHRyaWJ1dGUuCiAgICAgICAgICogPiBUaGUgY29tcG9uZW50cyBvZiB0aGUgdmFsdWUgY2FuIGJlIGNoYW5nZWQgY2F1c2luZyB0aGUgYXR0cmlidXRlcyBkYXRhIGlzIGNoYW5nZWQuCiAgICAgICAgICogPiBObyBuZWVkIHRvIGNhbGwgJ3NldEZhY2VWZXJ0ZXhWYWx1ZScuCiAgICAgICAgICogQHBhcmFtIGZhY2UgLSBUaGUgZmFjZSBpbmRleC4KICAgICAgICAgKiBAcGFyYW0gZmFjZVZlcnRleCAtIFRoZSBpbmRleCBvZiB2ZXJ0ZXggd2l0aGluIHRoZSBmYWNlLiBbMC4uLiBudW0gZmFjZSB2ZXJ0aWNlc10KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRGYWNlVmVydGV4VmFsdWVSZWYoZmFjZSwgZmFjZVZlcnRleCkgewogICAgICAgICAgICBjb25zdCBhcnJheSA9IHRoaXMuZ2V0RmFjZVZlcnRleFZhbHVlUmVmX2FycmF5KGZhY2UsIGZhY2VWZXJ0ZXgpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIoYXJyYXkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiBhIGNvcm5lciB2ZXJ0ZXggb2YgYSBmYWNlLgogICAgICAgICAqIEBwYXJhbSBmYWNlIC0gVGhlIGZhY2UgaW5kZXguCiAgICAgICAgICogQHBhcmFtIGZhY2VWZXJ0ZXggLSBUaGUgaW5kZXggb2YgdmVydGV4IHdpdGhpbiB0aGUgZmFjZS4gWzAuLi4gbnVtIGZhY2UgdmVydGljZXNdCiAgICAgICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldEZhY2VWZXJ0ZXhWYWx1ZShmYWNlLCBmYWNlVmVydGV4LCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnNldEZhY2VWZXJ0ZXhWYWx1ZV9hcnJheShmYWNlLCBmYWNlVmVydGV4LCB2YWx1ZS5hc0FycmF5KCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc2V0U3BsaXRWZXJ0ZXhWYWx1ZSBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIHZlcnRleCAtIFRoZSB2ZXJ0ZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGZhY2UgLSBUaGUgZmFjZSBpbmRleC4KICAgICAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0U3BsaXRWZXJ0ZXhWYWx1ZSh2ZXJ0ZXgsIGZhY2UsIHZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3BsaXRWZXJ0ZXhWYWx1ZV9hcnJheSh2ZXJ0ZXgsIGZhY2UsIHZhbHVlLmFzQXJyYXkoKSk7CiAgICAgICAgfQogICAgfQogICAgUmVnaXN0cnkucmVnaXN0ZXIoJ1ZlYzJBdHRyaWJ1dGUnLCBWZWMyQXR0cmlidXRlKTsKCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovCiAgICBjb25zdCBwYXJzZThCaXRQb3NpdGlvbnNBcnJheSA9IChyYW5nZSwgb2Zmc2V0LCBzY2xWZWMsIHBvc2l0aW9uc19xdWFudGl6ZWQsIHBvc2l0aW9uc0F0dHIpID0+IHsKICAgICAgICBmb3IgKGxldCBpID0gcmFuZ2VbMF07IGkgPCByYW5nZVsxXTsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHBvcyA9IG5ldyBWZWMzKHBvc2l0aW9uc19xdWFudGl6ZWRbaSAqIDMgKyAwXSAvIDI1NS4wLCBwb3NpdGlvbnNfcXVhbnRpemVkW2kgKiAzICsgMV0gLyAyNTUuMCwgcG9zaXRpb25zX3F1YW50aXplZFtpICogMyArIDJdIC8gMjU1LjApOwogICAgICAgICAgICBwb3MubXVsdGlwbHlJblBsYWNlKHNjbFZlYyk7CiAgICAgICAgICAgIHBvcy5hZGRJblBsYWNlKG9mZnNldCk7CiAgICAgICAgICAgIHBvc2l0aW9uc0F0dHIuc2V0VmFsdWUoaSwgcG9zKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgcGFyc2UxNkJpdFBvc2l0aW9uc0FycmF5ID0gKHJhbmdlLCBvZmZzZXQsIHNjbFZlYywgcG9zaXRpb25zX3F1YW50aXplZCwgcG9zaXRpb25zQXR0cikgPT4gewogICAgICAgIGZvciAobGV0IGkgPSByYW5nZVswXTsgaSA8IHJhbmdlWzFdOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgcG9zID0gbmV3IFZlYzMocG9zaXRpb25zX3F1YW50aXplZFtpICogMyArIDBdIC8gNjU1MzUuMCwgcG9zaXRpb25zX3F1YW50aXplZFtpICogMyArIDFdIC8gNjU1MzUuMCwgcG9zaXRpb25zX3F1YW50aXplZFtpICogMyArIDJdIC8gNjU1MzUuMCk7CiAgICAgICAgICAgIHBvcy5tdWx0aXBseUluUGxhY2Uoc2NsVmVjKTsKICAgICAgICAgICAgcG9zLmFkZEluUGxhY2Uob2Zmc2V0KTsKICAgICAgICAgICAgcG9zaXRpb25zQXR0ci5zZXRWYWx1ZShpLCBwb3MpOwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBwYXJzZThCaXROb3JtYWxzQXJyYXkgPSAocmFuZ2UsIG9mZnNldCwgc2NsVmVjLCBub3JtYWxzX3F1YW50aXplZCwgbm9ybWFsc0F0dHIpID0+IHsKICAgICAgICBpZiAoc2NsVmVjLmlzTnVsbCgpKQogICAgICAgICAgICBzY2xWZWMuc2V0KDEsIDEsIDEpOwogICAgICAgIGZvciAobGV0IGkgPSByYW5nZVswXTsgaSA8IHJhbmdlWzFdOyBpKyspIHsKICAgICAgICAgICAgY29uc3Qgbm9ybWFsID0gbmV3IFZlYzMobm9ybWFsc19xdWFudGl6ZWRbaSAqIDMgKyAwXSAvIDI1NS4wLCBub3JtYWxzX3F1YW50aXplZFtpICogMyArIDFdIC8gMjU1LjAsIG5vcm1hbHNfcXVhbnRpemVkW2kgKiAzICsgMl0gLyAyNTUuMCk7CiAgICAgICAgICAgIG5vcm1hbC5tdWx0aXBseUluUGxhY2Uoc2NsVmVjKTsKICAgICAgICAgICAgbm9ybWFsLmFkZEluUGxhY2Uob2Zmc2V0KTsKICAgICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZUluUGxhY2UoKTsKICAgICAgICAgICAgbm9ybWFsc0F0dHIuc2V0VmFsdWUoaSwgbm9ybWFsKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgcGFyc2U4Qml0VGV4dHVyZUNvb3Jkc0FycmF5ID0gKHJhbmdlLCBvZmZzZXQsIHNjbFZlYywgdGV4Q29vcmRzX3F1YW50aXplZCwgdGV4Q29vcmRzQXR0cikgPT4gewogICAgICAgIC8vIGlmIChzY2xWZWMuaXNOdWxsKCkpCiAgICAgICAgLy8gICAgIHNjbFZlYy5zZXQoMSwgMSwgMSk7CiAgICAgICAgZm9yIChsZXQgaSA9IHJhbmdlWzBdOyBpIDwgcmFuZ2VbMV07IGkrKykgewogICAgICAgICAgICBjb25zdCB0ZXh0dXJlQ29vcmQgPSBuZXcgVmVjMih0ZXhDb29yZHNfcXVhbnRpemVkW2kgKiAyICsgMF0gLyAyNTUuMCwgdGV4Q29vcmRzX3F1YW50aXplZFtpICogMiArIDFdIC8gMjU1LjApOwogICAgICAgICAgICB0ZXh0dXJlQ29vcmQubXVsdGlwbHlJblBsYWNlKHNjbFZlYyk7CiAgICAgICAgICAgIHRleHR1cmVDb29yZC5hZGRJblBsYWNlKG9mZnNldCk7CiAgICAgICAgICAgIHRleENvb3Jkc0F0dHIuc2V0VmFsdWUoaSwgdGV4dHVyZUNvb3JkKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgcGFyc2UxNkJpdFRleHR1cmVDb29yZHNBcnJheSA9IChyYW5nZSwgb2Zmc2V0LCBzY2xWZWMsIHRleENvb3Jkc19xdWFudGl6ZWQsIHRleENvb3Jkc0F0dHIpID0+IHsKICAgICAgICAvLyBpZiAoc2NsVmVjLmlzTnVsbCgpKQogICAgICAgIC8vICAgICBzY2xWZWMuc2V0KDEsIDEsIDEpOwogICAgICAgIGZvciAobGV0IGkgPSByYW5nZVswXTsgaSA8IHJhbmdlWzFdOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgdGV4dHVyZUNvb3JkID0gbmV3IFZlYzIodGV4Q29vcmRzX3F1YW50aXplZFtpICogMiArIDBdIC8gNjU1MzUuMCwgdGV4Q29vcmRzX3F1YW50aXplZFtpICogMiArIDFdIC8gNjU1MzUuMCk7CiAgICAgICAgICAgIHRleHR1cmVDb29yZC5tdWx0aXBseUluUGxhY2Uoc2NsVmVjKTsKICAgICAgICAgICAgdGV4dHVyZUNvb3JkLmFkZEluUGxhY2Uob2Zmc2V0KTsKICAgICAgICAgICAgdGV4Q29vcmRzQXR0ci5zZXRWYWx1ZShpLCB0ZXh0dXJlQ29vcmQpOwogICAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBiYXNlIGNsYXNzIGZvciAzRCBnZW9tZXRyeSBpdGVtcy4KICAgICAqCiAgICAgKiAqKkV2ZW50cyoqCiAgICAgKiAqICoqYm91bmRpbmdCb3hDaGFuZ2VkOioqIFRyaWdnZXJlZCB3aGVuIHRoZSBib3VuZGluZyBib3ggY2hhbmdlcy4KICAgICAqICogKipnZW9tRGF0YUNoYW5nZWQ6KiogRW1pdHRlZCB3aGVuIHRoZSBnZW9tZXRyeSBhdHRyaWJ1dGVzIGhhdmUgY2hhbmdlZC4gVGhlIHRvcG9sb2d5IGRpZCBub3QgY2hhbmdlLiBUaGUgUmVuZGVyZXIgd2lsbCB1cGxvYWQgdGhlIG5ldyBhdHRyaWJ1dGVzIHRvIHRoZSBHUFUuCiAgICAgKiAqICoqZ2VvbURhdGFUb3BvbG9neUNoYW5nZWQ6KiogRW1pdHRlZCB3aGVuIHRoZSBnZW9tZXRyeSBhdHRyaWJ1dGVzIGFuZCB0b3BvbG9neSBoYXZlIGNoYW5nZWQuICBUaGUgUmVuZGVyZXIgd2lsbCB1cGxvYWQgdGhlIG5ldyBhdHRyaWJ1dGVzIGFuZCB0b3BvbG9neSB0byB0aGUgR1BVLgogICAgICoKICAgICAqIEBleHRlbmRzIFBhcmFtZXRlck93bmVyCiAgICAgKi8KICAgIGNsYXNzIEJhc2VHZW9tIGV4dGVuZHMgUGFyYW1ldGVyT3duZXIgewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBhIGJhc2UgZ2VvbS4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fX2JvdW5kaW5nQm94ID0gbmV3IEJveDMoKTsKICAgICAgICAgICAgdGhpcy5fX2JvdW5kaW5nQm94RGlydHkgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9fbWV0YURhdGEgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIHRoaXMuX19uYW1lID0gJyc7CiAgICAgICAgICAgIHRoaXMuX19udW1WZXJ0aWNlcyA9IDA7CiAgICAgICAgICAgIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzID0gbmV3IE1hcCgpOwogICAgICAgICAgICB0aGlzLmRlYnVnQ29sb3IgPSBuZXcgQ29sb3IoMSwgMCwgMCwgMSk7CiAgICAgICAgICAgIHRoaXMubmFtZSA9ICcnOwogICAgICAgICAgICB0aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgncG9zaXRpb25zJywgbmV3IFZlYzNBdHRyaWJ1dGUoKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBjbGVhciBtZXRob2QuCiAgICAgICAgICovCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0TnVtVmVydGljZXMoMCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEVzdGFibGlzaGVzIGEgbmFtZSBmb3IgdGhlIGdlb21ldHJ5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG5hbWUgLSBUaGUgZGVidWcgbmFtZSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXREZWJ1Z05hbWUobmFtZSkgewogICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIGEgbmV3IHZlcnRleCBhdHRyaWJ1dGUgdG8gdGhlIGdlb21ldHJ5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgdmVydGV4IGF0dHJpYnV0ZS4KICAgICAgICAgKiBAcGFyYW0gZGF0YVR5cGUgLSBUaGUgZGF0YVR5cGUgdmFsdWUuIC8vIFRPRE86IGlzIGFueSBvayB2cy4gQXR0clZhbHVlIHwgbnVtYmVyLiBVbnN1cmUgYWJvdXQgaG93IGRhdGFUeXBlIGlzIHVzZWQKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhbiBhdHRyaWJ1dGUuCiAgICAgICAgICovCiAgICAgICAgYWRkVmVydGV4QXR0cmlidXRlKG5hbWUsIGF0dHIpIHsKICAgICAgICAgICAgYXR0ci5zZXRDb3VudCh0aGlzLl9fbnVtVmVydGljZXMpOwogICAgICAgICAgICB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQobmFtZSwgYXR0cik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENoZWNrcyBpZiB0aGUgdGhlIGdlb21ldHJ5IGhhcyBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB2ZXJ0ZXggYXR0cmlidXRlLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGhhc1ZlcnRleEF0dHJpYnV0ZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5oYXMobmFtZSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdmVydGV4IGF0dHJpYnV0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHZlcnRleCBhdHRyaWJ1dGUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0VmVydGV4QXR0cmlidXRlKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmdldChuYW1lKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBhbGwgdmVydGV4IGF0dHJpYnV0ZXMgaW4gYW4gb2JqZWN0IHdpdGggdGhlaXIgbmFtZXMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRWZXJ0ZXhBdHRyaWJ1dGVzKCkgewogICAgICAgICAgICBjb25zdCB2ZXJ0ZXhBdHRyaWJ1dGVzID0ge307CiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgYXR0cl0gb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZW50cmllcygpKQogICAgICAgICAgICAgICAgdmVydGV4QXR0cmlidXRlc1trZXldID0gYXR0cjsKICAgICAgICAgICAgcmV0dXJuIHZlcnRleEF0dHJpYnV0ZXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgJ3Bvc2l0aW9ucycgdmVydGV4IGF0dHJpYnV0ZS4KICAgICAgICAgKi8KICAgICAgICBnZXQgcG9zaXRpb25zKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KCdwb3NpdGlvbnMnKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHZlcnRleCBhdHRyaWJ1dGVzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbnVtVmVydGljZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbnVtVmVydGljZXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiB2ZXJ0ZXggYXR0cmlidXRlcy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldE51bVZlcnRpY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX251bVZlcnRpY2VzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBudW1iZXIgb2YgdmVydGljZXMgdGhlIGdlb21ldHJ5IGhhcy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBjb3VudCAtIFRoZSBjb3VudCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXROdW1WZXJ0aWNlcyhjb3VudCkgewogICAgICAgICAgICB0aGlzLl9fbnVtVmVydGljZXMgPSBjb3VudDsKICAgICAgICAgICAgLy8gUmVzaXplcyBlYWNoIG9mIHRoZSB2ZXJ0ZXggYXR0cmlidXRlcyB0byBtYXRjaCB0aGUgbmV3IGNvdW50LgogICAgICAgICAgICB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5mb3JFYWNoKChhdHRyKSA9PiBhdHRyLnNldENvdW50KHRoaXMuX19udW1WZXJ0aWNlcykpOwogICAgICAgICAgICB0aGlzLnNldEJvdW5kaW5nQm94RGlydHkoKTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIEJvdW5kaW5nQm94CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgYm91bmRpbmcgYm94IGZvciBnZW9tZXRyeS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRCb3VuZGluZ0JveCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX19ib3VuZGluZ0JveERpcnR5KQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ0JveCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2JvdW5kaW5nQm94OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgc2V0Qm91bmRpbmdCb3hEaXJ0eSBtZXRob2QuCiAgICAgICAgICovCiAgICAgICAgc2V0Qm91bmRpbmdCb3hEaXJ0eSgpIHsKICAgICAgICAgICAgdGhpcy5fX2JvdW5kaW5nQm94RGlydHkgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmVtaXQoJ2JvdW5kaW5nQm94Q2hhbmdlZCcpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgdXBkYXRlQm91bmRpbmdCb3ggbWV0aG9kLgogICAgICAgICAqLwogICAgICAgIHVwZGF0ZUJvdW5kaW5nQm94KCkgewogICAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSB0aGlzLnBvc2l0aW9uczsKICAgICAgICAgICAgY29uc3QgYmJveCA9IG5ldyBCb3gzKCk7CiAgICAgICAgICAgIGlmIChwb3NpdGlvbnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG51bVZlcnRzID0gcG9zaXRpb25zLmdldENvdW50KCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZlcnRzOyBpKyspCiAgICAgICAgICAgICAgICAgICAgYmJveC5hZGRQb2ludChwb3NpdGlvbnMuZ2V0VmFsdWVSZWYoaSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX19ib3VuZGluZ0JveCA9IGJib3g7CiAgICAgICAgICAgIHRoaXMuX19ib3VuZGluZ0JveERpcnR5ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBNZXRhZGF0YQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgbWV0YWRhdGEgdmFsdWUgb2YgdGhlIHNwZWNpZmllZCBuYW1lLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0TWV0YWRhdGEoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbWV0YURhdGEuZ2V0KGtleSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFZlcmlmaWVzIGlmIGdlb21ldHJ5J3MgbWV0YWRhdGEgY29udGFpbnMgYSB2YWx1ZSB3aXRoIHRoZSBzcGVjaWZpZWQga2V5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaGFzTWV0YWRhdGEoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbWV0YURhdGEuaGFzKGtleSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgbWV0YWRhdGEgdmFsdWUgdG8gdGhlIGdlb21ldHJ5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIG1ldGFEYXRhIC0gVGhlIG1ldGFEYXRhIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIHNldE1ldGFkYXRhKGtleSwgbWV0YURhdGEpIHsKICAgICAgICAgICAgdGhpcy5fX21ldGFEYXRhLnNldChrZXksIG1ldGFEYXRhKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlcyBtZXRhZGF0YSB2YWx1ZSBmcm9tIHRoZSBnZW9tZXRyeSB3aXRoIHRoZSBzcGVjaWZpZWQga2V5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZGVsZXRlTWV0YWRhdGEoa2V5KSB7CiAgICAgICAgICAgIHRoaXMuX19tZXRhRGF0YS5kZWxldGUoa2V5KTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIE1lbW9yeQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdmVydGV4IGF0dHJpYnV0ZXMgYnVmZmVycyBhbmQgaXRzIGNvdW50LgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdlbkJ1ZmZlcnMob3B0cykgewogICAgICAgICAgICBjb25zdCBhdHRyQnVmZmVycyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IFthdHRyTmFtZSwgYXR0cl0gb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgIGF0dHJCdWZmZXJzW2F0dHJOYW1lXSA9IGF0dHIuZ2VuQnVmZmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIG51bVZlcnRpY2VzOiB0aGlzLm51bVZlcnRpY2VzKCksCiAgICAgICAgICAgICAgICBhdHRyQnVmZmVycywKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogT25jZSB0aGUgYnVmZmVycyBoYXZlIGJlZW4gdXBsb2FkZWQgdG8gdGhlIEdQVSwgd2UgYXJlIGZyZWUgdG8gcmVsZWFzZSB0aGVtLgogICAgICAgICAqIFRoZSBHTEdlb21MaWJyYXJ5IG1heSBjYWxsIHRoaXMgZnVuY3Rpb24gdG8gbGV0IHRoZSBnZW9tZXRyeSBrbm93IGl0IGNhbiByZWxlYXNlIGFueSBoYW5kbGVzLgogICAgICAgICAqLwogICAgICAgIGZyZWVCdWZmZXJzKCkgeyB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBzdGF0ZSBvZiBjdXJyZW50IEdlb21ldHJ5KEluY2x1ZGluZyBWZXJ0aWNlcyBhbmQgQm91bmRpbmcgQm94KSB1c2luZyBhIGJpbmFyeSByZWFkZXIgb2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbG9hZEJhc2VHZW9tQmluYXJ5KHJlYWRlciwgY29udGV4dCkgewogICAgICAgICAgICB0aGlzLm5hbWUgPSByZWFkZXIubG9hZFN0cigpOwogICAgICAgICAgICBjb25zdCBmbGFncyA9IHJlYWRlci5sb2FkVUludDgoKTsKICAgICAgICAgICAgdGhpcy5kZWJ1Z0NvbG9yID0gcmVhZGVyLmxvYWRSR0JGbG9hdDMyQ29sb3IoKTsKICAgICAgICAgICAgY29uc3QgbnVtVmVydHMgPSByZWFkZXIubG9hZFVJbnQzMigpOwogICAgICAgICAgICB0aGlzLl9fYm91bmRpbmdCb3guc2V0KHJlYWRlci5sb2FkRmxvYXQzMlZlYzMoKSwgcmVhZGVyLmxvYWRGbG9hdDMyVmVjMygpKTsKICAgICAgICAgICAgdGhpcy5zZXROdW1WZXJ0aWNlcyhudW1WZXJ0cyk7CiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uc0F0dHIgPSB0aGlzLnBvc2l0aW9uczsKICAgICAgICAgICAgbGV0IG5vcm1hbHNBdHRyOwogICAgICAgICAgICBsZXQgdGV4Q29vcmRzQXR0cjsKICAgICAgICAgICAgaWYgKGZsYWdzICYgKDEgPDwgMSkpIHsKICAgICAgICAgICAgICAgIG5vcm1hbHNBdHRyID0gdGhpcy5nZXRWZXJ0ZXhBdHRyaWJ1dGUoJ25vcm1hbHMnKTsKICAgICAgICAgICAgICAgIGlmICghbm9ybWFsc0F0dHIpIHsKICAgICAgICAgICAgICAgICAgICBub3JtYWxzQXR0ciA9IG5ldyBWZWMzQXR0cmlidXRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoJ25vcm1hbHMnLCBub3JtYWxzQXR0cik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZsYWdzICYgKDEgPDwgMikpIHsKICAgICAgICAgICAgICAgIHRleENvb3Jkc0F0dHIgPSB0aGlzLmdldFZlcnRleEF0dHJpYnV0ZSgndGV4Q29vcmRzJyk7CiAgICAgICAgICAgICAgICBpZiAoIXRleENvb3Jkc0F0dHIpIHsKICAgICAgICAgICAgICAgICAgICB0ZXhDb29yZHNBdHRyID0gbmV3IFZlYzJBdHRyaWJ1dGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgndGV4Q29vcmRzJywgdGV4Q29vcmRzQXR0cik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbnVtQ2x1c3RlcnMgPSByZWFkZXIubG9hZFVJbnQzMigpOwogICAgICAgICAgICBpZiAobnVtQ2x1c3RlcnMgPT0gMSkgewogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJveDMgPSB0aGlzLl9fYm91bmRpbmdCb3g7CiAgICAgICAgICAgICAgICAgICAgLy8gRnJvbSAzLjkuMSwgdmVydGV4IGRhdGEgaXMgYSBtaXggb2YgMTZiaXQgYW5kIDggYml0IHF1YW5pdGl6YXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC52ZXJzaW9uc1snemVhLWVuZ2luZSddLmNvbXBhcmUoWzMsIDksIDFdKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uc19xdWFudGl6ZWQgPSByZWFkZXIubG9hZFVJbnQxNkFycmF5KG51bVZlcnRzICogMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlMTZCaXRQb3NpdGlvbnNBcnJheShbMCwgbnVtVmVydHNdLCBib3gzLnAwLCBib3gzLmRpYWdvbmFsKCksIHBvc2l0aW9uc19xdWFudGl6ZWQsIHBvc2l0aW9uc0F0dHIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb25zX3F1YW50aXplZCA9IHJlYWRlci5sb2FkVUludDhBcnJheShudW1WZXJ0cyAqIDMpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZThCaXRQb3NpdGlvbnNBcnJheShbMCwgbnVtVmVydHNdLCBib3gzLnAwLCBib3gzLmRpYWdvbmFsKCksIHBvc2l0aW9uc19xdWFudGl6ZWQsIHBvc2l0aW9uc0F0dHIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChub3JtYWxzQXR0cikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJveDMgPSBuZXcgQm94MyhyZWFkZXIubG9hZEZsb2F0MzJWZWMzKCksIHJlYWRlci5sb2FkRmxvYXQzMlZlYzMoKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9ybWFsc19xdWFudGl6ZWQgPSByZWFkZXIubG9hZFVJbnQ4QXJyYXkobnVtVmVydHMgKiAzKTsKICAgICAgICAgICAgICAgICAgICBwYXJzZThCaXROb3JtYWxzQXJyYXkoWzAsIG51bVZlcnRzXSwgYm94My5wMCwgYm94My5kaWFnb25hbCgpLCBub3JtYWxzX3F1YW50aXplZCwgbm9ybWFsc0F0dHIpOwogICAgICAgICAgICAgICAgICAgIG5vcm1hbHNBdHRyLmxvYWRTcGxpdFZhbHVlcyhyZWFkZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRleENvb3Jkc0F0dHIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib3gyID0gbmV3IEJveDIocmVhZGVyLmxvYWRGbG9hdDMyVmVjMigpLCByZWFkZXIubG9hZEZsb2F0MzJWZWMyKCkpOwogICAgICAgICAgICAgICAgICAgIC8vIEZyb20gMy45LjEsIHZlcnRleCBkYXRhIGlzIGEgbWl4IG9mIDE2Yml0IGFuZCA4IGJpdCBxdWFuaXRpemF0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQudmVyc2lvbnNbJ3plYS1lbmdpbmUnXS5jb21wYXJlKFszLCA5LCAxXSkgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXhDb29yZHNfcXVhbnRpemVkID0gcmVhZGVyLmxvYWRVSW50MTZBcnJheShudW1WZXJ0cyAqIDIpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZTE2Qml0VGV4dHVyZUNvb3Jkc0FycmF5KFswLCBudW1WZXJ0c10sIGJveDIucDAsIGJveDIuZGlhZ29uYWwoKSwgdGV4Q29vcmRzX3F1YW50aXplZCwgdGV4Q29vcmRzQXR0cik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXhDb29yZHNfcXVhbnRpemVkID0gcmVhZGVyLmxvYWRVSW50OEFycmF5KG51bVZlcnRzICogMik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlOEJpdFRleHR1cmVDb29yZHNBcnJheShbMCwgbnVtVmVydHNdLCBib3gyLnAwLCBib3gyLmRpYWdvbmFsKCksIHRleENvb3Jkc19xdWFudGl6ZWQsIHRleENvb3Jkc0F0dHIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0ZXhDb29yZHNBdHRyLmxvYWRTcGxpdFZhbHVlcyhyZWFkZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgY2x1c3RlcnMgPSBbXTsKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1DbHVzdGVyczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSByZWFkZXIubG9hZFVJbnQzMigpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsdXN0ZXJEYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICByYW5nZTogW29mZnNldCwgb2Zmc2V0ICsgY291bnRdLAogICAgICAgICAgICAgICAgICAgICAgICBiYm94OiBuZXcgQm94MyhyZWFkZXIubG9hZEZsb2F0MzJWZWMzKCksIHJlYWRlci5sb2FkRmxvYXQzMlZlYzMoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbHNSYW5nZTogbmV3IEJveDMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4Q29vcmRzUmFuZ2U6IG5ldyBCb3gyKCksCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBpZiAobm9ybWFsc0F0dHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2x1c3RlckRhdGEubm9ybWFsc1JhbmdlLnNldChyZWFkZXIubG9hZEZsb2F0MzJWZWMzKCksIHJlYWRlci5sb2FkRmxvYXQzMlZlYzMoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0ZXhDb29yZHNBdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsdXN0ZXJEYXRhLnRleENvb3Jkc1JhbmdlLnNldChyZWFkZXIubG9hZEZsb2F0MzJWZWMyKCksIHJlYWRlci5sb2FkRmxvYXQzMlZlYzIoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNsdXN0ZXJzLnB1c2goY2x1c3RlckRhdGEpOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBjb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIEZyb20gMy45LjEsIHZlcnRleCBkYXRhIGlzIGEgbWl4IG9mIDE2Yml0IGFuZCA4IGJpdCBxdWFuaXRpemF0aW9uCiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb25zX3F1YW50aXplZDsKICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnZlcnNpb25zWyd6ZWEtZW5naW5lJ10uY29tcGFyZShbMywgOSwgMV0pID49IDApIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnNfcXVhbnRpemVkID0gcmVhZGVyLmxvYWRVSW50MTZBcnJheShudW1WZXJ0cyAqIDMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25zX3F1YW50aXplZCA9IHJlYWRlci5sb2FkVUludDhBcnJheShudW1WZXJ0cyAqIDMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IG5vcm1hbHNfcXVhbnRpemVkID0gbnVsbDsKICAgICAgICAgICAgICAgIGxldCB0ZXhDb29yZHNfcXVhbnRpemVkID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChub3JtYWxzQXR0cikgewogICAgICAgICAgICAgICAgICAgIG5vcm1hbHNfcXVhbnRpemVkID0gcmVhZGVyLmxvYWRVSW50OEFycmF5KG51bVZlcnRzICogMyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGV4Q29vcmRzQXR0cikgewogICAgICAgICAgICAgICAgICAgIHRleENvb3Jkc19xdWFudGl6ZWQgPSByZWFkZXIubG9hZFVJbnQ4QXJyYXkobnVtVmVydHMgKiAyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQ2x1c3RlcnM7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm94MyA9IGNsdXN0ZXJzW2ldLmJib3g7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZyb20gMy45LjEsIHZlcnRleCBkYXRhIGlzIGEgbWl4IG9mIDE2Yml0IGFuZCA4IGJpdCBxdWFuaXRpemF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnZlcnNpb25zWyd6ZWEtZW5naW5lJ10uY29tcGFyZShbMywgOSwgMV0pID49IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlMTZCaXRQb3NpdGlvbnNBcnJheShjbHVzdGVyc1tpXS5yYW5nZSwgYm94My5wMCwgYm94My5kaWFnb25hbCgpLCBwb3NpdGlvbnNfcXVhbnRpemVkLCBwb3NpdGlvbnNBdHRyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlOEJpdFBvc2l0aW9uc0FycmF5KGNsdXN0ZXJzW2ldLnJhbmdlLCBib3gzLnAwLCBib3gzLmRpYWdvbmFsKCksIHBvc2l0aW9uc19xdWFudGl6ZWQsIHBvc2l0aW9uc0F0dHIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChub3JtYWxzX3F1YW50aXplZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBib3gzID0gY2x1c3RlcnNbaV0ubm9ybWFsc1JhbmdlOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZThCaXROb3JtYWxzQXJyYXkoY2x1c3RlcnNbaV0ucmFuZ2UsIGJveDMucDAsIGJveDMuZGlhZ29uYWwoKSwgbm9ybWFsc19xdWFudGl6ZWQsIG5vcm1hbHNBdHRyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHRleENvb3Jkc19xdWFudGl6ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm94MiA9IGNsdXN0ZXJzW2ldLnRleENvb3Jkc1JhbmdlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC52ZXJzaW9uc1snemVhLWVuZ2luZSddLmNvbXBhcmUoWzMsIDksIDFdKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZTE2Qml0VGV4dHVyZUNvb3Jkc0FycmF5KFswLCBudW1WZXJ0c10sIGJveDIucDAsIGJveDIuZGlhZ29uYWwoKSwgdGV4Q29vcmRzX3F1YW50aXplZCwgdGV4Q29vcmRzQXR0cik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZThCaXRUZXh0dXJlQ29vcmRzQXJyYXkoY2x1c3RlcnNbaV0ucmFuZ2UsIGJveDIucDAsIGJveDIuZGlhZ29uYWwoKSwgdGV4Q29vcmRzX3F1YW50aXplZCwgdGV4Q29vcmRzQXR0cik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobm9ybWFsc0F0dHIpIHsKICAgICAgICAgICAgICAgICAgICBub3JtYWxzQXR0ci5sb2FkU3BsaXRWYWx1ZXMocmVhZGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0ZXhDb29yZHNBdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4Q29vcmRzQXR0ci5sb2FkU3BsaXRWYWx1ZXMocmVhZGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgdG9KU09OIG1ldGhvZCBlbmNvZGVzIHRoaXMgdHlwZSBhcyBhIGpzb24gb2JqZWN0IGZvciBwZXJzaXN0ZW5jZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIGNvbnRleHQgdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIGpzb24gb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHRvSlNPTihjb250ZXh0KSB7CiAgICAgICAgICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pTT04oY29udGV4dCk7CiAgICAgICAgICAgIGlmICghY29udGV4dCB8fCAhY29udGV4dC5za2lwVG9wb2xvZ3kpIHsKICAgICAgICAgICAgICAgIGpzb24ubnVtVmVydGljZXMgPSB0aGlzLl9fbnVtVmVydGljZXMgfHwgMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB2ZXJ0ZXhBdHRyaWJ1dGVzID0ge307CiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgYXR0cl0gb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZW50cmllcygpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNvbnRleHQgfHwgISgnc2tpcEF0dHJpYnV0ZXMnIGluIGNvbnRleHQpIHx8ICFjb250ZXh0LnNraXBBdHRyaWJ1dGVzLmluY2x1ZGVzKGtleSkpCiAgICAgICAgICAgICAgICAgICAgdmVydGV4QXR0cmlidXRlc1trZXldID0gYXR0ci50b0pTT04oY29udGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAganNvbi52ZXJ0ZXhBdHRyaWJ1dGVzID0gdmVydGV4QXR0cmlidXRlczsKICAgICAgICAgICAgcmV0dXJuIGpzb247CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBmcm9tSlNPTiBtZXRob2QgZGVjb2RlcyBhIGpzb24gb2JqZWN0IGZvciB0aGlzIHR5cGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ganNvbiAtIFRoZSBqc29uIG9iamVjdCB0aGlzIGl0ZW0gbXVzdCBkZWNvZGUuCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBmcm9tSlNPTihqc29uLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgc3VwZXIuZnJvbUpTT04oanNvbiwgY29udGV4dCk7CiAgICAgICAgICAgIHRoaXMuc2V0TnVtVmVydGljZXMoanNvbi5udW1WZXJ0aWNlcyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBqc29uLnZlcnRleEF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgIGxldCBhdHRyID0gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KG5hbWUpOwogICAgICAgICAgICAgICAgY29uc3QgYXR0ckpTT04gPSBqc29uLnZlcnRleEF0dHJpYnV0ZXNbbmFtZV07CiAgICAgICAgICAgICAgICBpZiAoYXR0cikgewogICAgICAgICAgICAgICAgICAgIGF0dHIuZnJvbUpTT04oYXR0ckpTT04pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdhdHRyIHVuZGVmaW5lZCwgY2Fubm90IGV4ZWN1dGUgZnJvbUpTT04oKScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZW1pdCgnZ2VvbURhdGFUb3BvbG9neUNoYW5nZWQnKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBnZW9tZXRyeSBkYXRhIHZhbHVlIGluIGpzb24gZm9ybWF0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpLCBudWxsLCAyKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgYSBwb2ludCBwcmltaXRpdmUgZHJhd2luZyB0eXBlLCBldmVyeSB2ZXJ0ZXggc3BlY2lmaWVkIGlzIGEgcG9pbnQuCiAgICAgKgogICAgICogYGBgCiAgICAgKiBjb25zdCBwb2ludHMgPSBuZXcgUG9pbnRzKCkKICAgICAqIGBgYAogICAgICoKICAgICAqICogKipFdmVudHMqKgogICAgICogKiAqKmJvdW5kaW5nQm94Q2hhbmdlZDoqKiBUcmlnZ2VyZWQgd2hlbiB0aGUgYm91bmRpbmcgYm94IGNoYW5nZXMuCiAgICAgKgogICAgICogQGV4dGVuZHMgQmFzZUdlb20KICAgICAqLwogICAgY2xhc3MgUG9pbnRzIGV4dGVuZHMgQmFzZUdlb20gewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBwb2ludHMuCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBjbGVhciBtZXRob2QuCiAgICAgICAgICovCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0TnVtVmVydGljZXMoMCk7CiAgICAgICAgICAgIHRoaXMuZW1pdCgnZ2VvbURhdGFUb3BvbG9neUNoYW5nZWQnKTsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBzdGF0ZSBvZiBjdXJyZW50IGdlb21ldHJ5KEluY2x1ZGluZyBsaW5lIHNlZ21lbnRzKSB1c2luZyBhIGJpbmFyeSByZWFkZXIgb2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlciwgY29udGV4dCkgewogICAgICAgICAgICBzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkocmVhZGVyLCBjb250ZXh0KTsKICAgICAgICAgICAgLy8gdGhpcy5jb21wdXRlVmVydGV4Tm9ybWFscygpOwogICAgICAgICAgICB0aGlzLmVtaXQoJ2dlb21EYXRhQ2hhbmdlZCcpOwogICAgICAgIH0KICAgIH0KICAgIFJlZ2lzdHJ5LnJlZ2lzdGVyKCdQb2ludHMnLCBQb2ludHMpOwoKICAgIC8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycyAqLwogICAgLyoqCiAgICAgKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGxpbmVzIHByaW1pdGl2ZSBkcmF3aW5nIHR5cGUsIGNvbm5lY3RpbmcgdmVydGljZXMgdXNpbmcgdGhlIHNwZWNpZmllZCBpbmRpY2VzLgogICAgICogaS5lLiBXZSBoYXZlIDQgcG9pbnRzKHZlcnRpY2VzKSBidXQgd2UgZG9uJ3Qga25vdyBob3cgdGhleSBjb25uZWN0IHRvIGVhY2ggb3RoZXIsCiAgICAgKiBhbmQgdGhhdCdzIHdoeSB3ZSBuZWVkIGluZGljZXMoTnVtYmVycyBpbmRpY2F0aW5nIHdoaWNoIHZlcnRleCBjb25uZWN0cyB0byB3aGljaCkuCiAgICAgKiBJbiB0aGlzIGNhc2UgaWYgd2Ugc2F5IHRoYXQgYGluZGljZXNgIGlzIGBbMCwxLDIsM11gLCBpdCB3b3VsZCBjb25uZWN0IHRoZSBmaXJzdCB2ZXJ0ZXggdG8gdGhlIHNlY29uZCwKICAgICAqIGFuZCB0aGUgdGhpcmQgdG8gdGhlIGZvdXJ0aC4KICAgICAqCiAgICAgKiBgYGAKICAgICAqIGNvbnN0IGxpbmVzID0gbmV3IExpbmVzKCkKICAgICAqIGBgYAogICAgICoKICAgICAqICoqRXZlbnRzKioKICAgICAqICogKipnZW9tRGF0YUNoYW5nZWQ6KiogVHJpZ2dlcmVkIHdoZW4gdGhlIGRhdGEgdmFsdWUgb2YgdGhlIGdlb21ldHJ5IGlzIHNldChUaGlzIGluY2x1ZGVzIHJlYWRpbmcgYmluYXJ5KQogICAgICoKICAgICAqIEBleHRlbmRzIEJhc2VHZW9tCiAgICAgKi8KICAgIGNsYXNzIExpbmVzIGV4dGVuZHMgQmFzZUdlb20gewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZSBsaW5lcy4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fX2luZGljZXMgPSBuZXcgVWludDMyQXJyYXkoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGNsZWFyIG1ldGhvZC4KICAgICAgICAgKi8KICAgICAgICBjbGVhcigpIHsKICAgICAgICAgICAgdGhpcy5zZXROdW1TZWdtZW50cygwKTsKICAgICAgICAgICAgdGhpcy5zZXROdW1WZXJ0aWNlcygwKTsKICAgICAgICAgICAgdGhpcy5lbWl0KCdnZW9tRGF0YVRvcG9sb2d5Q2hhbmdlZCcpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgaW5kaWNlcyhWZXJ0ZXggY29ubmVjdG9ycykKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgaW5kaWNlcyBpbmRleCBhcnJheS4KICAgICAgICAgKi8KICAgICAgICBnZXRJbmRpY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2luZGljZXM7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBsaW5lIHNlZ21lbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG51bWJlciBvZiBzZWdtZW50cy4KICAgICAgICAgKi8KICAgICAgICBnZXROdW1TZWdtZW50cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19pbmRpY2VzLmxlbmd0aCAvIDI7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBsaW5lIHNlZ21lbnRzLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgdGhlIG51bWJlciBvZiBzZWdtZW50cy4KICAgICAgICAgKi8KICAgICAgICBnZXROdW1MaW5lU2VnbWVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9faW5kaWNlcy5sZW5ndGggLyAyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBudW1iZXIgb2YgbGluZSBzZWdtZW50cyBpbiB0aGUgbGluZXMgZ2VvbWV0cnkuCiAgICAgICAgICogKipJbXBvcnRhbnQ6KiogSXQgcmVzZXRzIGluZGljZXMgdmFsdWVzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIG51bU9mU2VnbWVudHMgLSBUaGUgY291bnQgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgc2V0TnVtU2VnbWVudHMobnVtT2ZTZWdtZW50cykgewogICAgICAgICAgICBpZiAobnVtT2ZTZWdtZW50cyA+IHRoaXMuZ2V0TnVtU2VnbWVudHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheShudW1PZlNlZ21lbnRzICogMik7CiAgICAgICAgICAgICAgICBpbmRpY2VzLnNldCh0aGlzLl9faW5kaWNlcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9faW5kaWNlcyA9IGluZGljZXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9faW5kaWNlcyA9IHRoaXMuX19pbmRpY2VzLnNsaWNlKDAsIG51bU9mU2VnbWVudHMgKiAyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHNlZ21lbnQgdmFsdWVzIGluIHRoZSBzcGVjaWZpZWQgaW5kZXguCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW5kZXggLSBUaGUgaW5kZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIHAwIC0gVGhlIHAwIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBwMSAtIFRoZSBwMSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRTZWdtZW50VmVydGV4SW5kaWNlcyhpbmRleCwgcDAsIHAxKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+PSB0aGlzLl9faW5kaWNlcy5sZW5ndGggLyAyKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGxpbmUgaW5kZXg6JyArIGluZGV4ICsgJy4gTnVtIFNlZ21lbnRzOicgKyB0aGlzLl9faW5kaWNlcy5sZW5ndGggLyAyKTsKICAgICAgICAgICAgdGhpcy5fX2luZGljZXNbaW5kZXggKiAyICsgMF0gPSBwMDsKICAgICAgICAgICAgdGhpcy5fX2luZGljZXNbaW5kZXggKiAyICsgMV0gPSBwMTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGdldFNlZ21lbnRWZXJ0ZXhJbmRleCBtZXRob2QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbGluZSAtIFRoZSBsaW5lIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBsaW5lVmVydGV4IC0gVGhlIGxpbmVWZXJ0ZXggdmFsdWUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBnZXRTZWdtZW50VmVydGV4SW5kZXgobGluZSwgbGluZVZlcnRleCkgewogICAgICAgICAgICBjb25zdCBudW1TZWdtZW50cyA9IHRoaXMuZ2V0TnVtU2VnbWVudHMoKTsKICAgICAgICAgICAgaWYgKGxpbmUgPCBudW1TZWdtZW50cykKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9faW5kaWNlc1tsaW5lICogMiArIGxpbmVWZXJ0ZXhdOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBNZW1vcnkKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHZlcnRleCBhdHRyaWJ1dGVzIGJ1ZmZlcnMgYW5kIGl0cyBjb3VudC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdlbkJ1ZmZlcnMob3B0cykgewogICAgICAgICAgICBjb25zdCBidWZmZXJzID0gc3VwZXIuZ2VuQnVmZmVycygpOwogICAgICAgICAgICBsZXQgaW5kaWNlczsKICAgICAgICAgICAgaWYgKGJ1ZmZlcnMubnVtVmVydGljZXMgPCBNYXRoLnBvdygyLCA4KSkgewogICAgICAgICAgICAgICAgaW5kaWNlcyA9IG5ldyBVaW50OEFycmF5KHRoaXMuX19pbmRpY2VzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChidWZmZXJzLm51bVZlcnRpY2VzIDwgTWF0aC5wb3coMiwgMTYpKSB7CiAgICAgICAgICAgICAgICBpbmRpY2VzID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX19pbmRpY2VzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGluZGljZXMgPSB0aGlzLl9faW5kaWNlczsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWZmZXJzLmluZGljZXMgPSBpbmRpY2VzOwogICAgICAgICAgICByZXR1cm4gYnVmZmVyczsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBzdGF0ZSBvZiBjdXJyZW50IGdlb21ldHJ5KEluY2x1ZGluZyBsaW5lIHNlZ21lbnRzKSB1c2luZyBhIGJpbmFyeSByZWFkZXIgb2JqZWN0LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlciwgY29udGV4dCkgewogICAgICAgICAgICBzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkocmVhZGVyLCBjb250ZXh0KTsKICAgICAgICAgICAgdGhpcy5zZXROdW1TZWdtZW50cyhyZWFkZXIubG9hZFVJbnQzMigpKTsKICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSByZWFkZXIubG9hZFVJbnQ4KCk7CiAgICAgICAgICAgIGlmIChieXRlcyA9PSAxKQogICAgICAgICAgICAgICAgdGhpcy5fX2luZGljZXMgPSByZWFkZXIubG9hZFVJbnQ4QXJyYXkoKTsKICAgICAgICAgICAgZWxzZSBpZiAoYnl0ZXMgPT0gMikKICAgICAgICAgICAgICAgIHRoaXMuX19pbmRpY2VzID0gcmVhZGVyLmxvYWRVSW50MTZBcnJheSgpOwogICAgICAgICAgICBlbHNlIGlmIChieXRlcyA9PSA0KQogICAgICAgICAgICAgICAgdGhpcy5fX2luZGljZXMgPSByZWFkZXIubG9hZFVJbnQzMkFycmF5KCk7CiAgICAgICAgICAgIHRoaXMuZW1pdCgnZ2VvbURhdGFDaGFuZ2VkJyk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSB0b0pTT04gbWV0aG9kIGVuY29kZXMgdGhpcyB0eXBlIGFzIGEganNvbiBvYmplY3QgZm9yIHBlcnNpc3RlbmNlLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUganNvbiBvYmplY3QuCiAgICAgICAgICovCiAgICAgICAgdG9KU09OKGNvbnRleHQpIHsKICAgICAgICAgICAgY29uc3QgaiA9IHN1cGVyLnRvSlNPTihjb250ZXh0KTsKICAgICAgICAgICAgaWYgKCFjb250ZXh0IHx8ICFjb250ZXh0LnNraXBUb3BvbG9neSkKICAgICAgICAgICAgICAgIGouaW5kaWNlcyA9IEFycmF5LmZyb20odGhpcy5fX2luZGljZXMpOwogICAgICAgICAgICByZXR1cm4gajsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGZyb21KU09OIG1ldGhvZCBkZWNvZGVzIGEganNvbiBvYmplY3QgZm9yIHRoaXMgdHlwZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqIC0gVGhlIGpzb24gb2JqZWN0IHRoaXMgaXRlbSBtdXN0IGRlY29kZS4KICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGosIGNvbnRleHQpIHsKICAgICAgICAgICAgc3VwZXIuZnJvbUpTT04oaiwgY29udGV4dCk7CiAgICAgICAgICAgIGlmIChqLmluZGljZXMpCiAgICAgICAgICAgICAgICB0aGlzLl9faW5kaWNlcyA9IFVpbnQzMkFycmF5LmZyb20oai5pbmRpY2VzKTsKICAgICAgICB9CiAgICB9CiAgICBSZWdpc3RyeS5yZWdpc3RlcignTGluZXMnLCBMaW5lcyk7CgogICAgLyogZXNsaW50LWRpc2FibGUgcHJlZmVyLXJlc3QtcGFyYW1zICovCiAgICAvKioKICAgICAqIFRoZSBNZXNoIGNsYXNzIHByb3ZpZGVzIGEgZmxleGlibGUgYW5kIGZhc3QgcG9seWdvbiBtZXNoIHJlcHJlc2VudGF0aW9uLiBJdCBzdXBwb3J0cyBwb2x5Z29ucyBvZiBhcmJpdHJhcnkgY29tcGxleGl0eSwKICAgICAqIGZyb20gYmFzaWMgdHJpYW5nbGVzIGFuZCBxdWFkcyB0byBwZW50YWdvbnMgbW9yZS4KICAgICAqIEl0IHN1cHBvcnRzIHN0b3JpbmcgcGVyIGZhY2UgYXR0cmlidXRlcywgYW5kIHBlciBlZGdlIGF0dHJpYnV0ZXMuCiAgICAgKiBUaGUgTWVzaCBjbGFzcyBoYW5kbGVzIGNvbnZlcnRpbmcgaXRzIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIHBvbHlnb25zIGludG8gYSBzaW1wbGVyIHRyaWFuZ2xlcyByZXByZXNlbnRhdGlvbiBmb3IgcmVuZGVyaW5nLgogICAgICoKICAgICAqIGBgYAogICAgICogY29uc3QgbWVzaCA9IG5ldyBNZXNoKCkKICAgICAqIGBgYAogICAgICoKICAgICAqICoqRXZlbnRzKioKICAgICAqICogKipnZW9tRGF0YVRvcG9sb2d5Q2hhbmdlZDoqKiBUcmlnZ2VyZWQgd2hlbiB0aGUgdG9wb2xvZ3kgb2YgdGhlIG1lc2ggaGFzIGJlZW4gY2hhbmdlZC4KICAgICAqICogKipnZW9tRGF0YUNoYW5nZWQ6KiogVHJpZ2dlcmVkIHdoZW4gdGhlIHZlcnRpY2VzIG9mIHRoZSBtZXNoIGhhdmUgY2hhbmdlZCwgYnV0IG5vdCBuZWNlc3NhcmlseSB0aGUgdG9wb2xvZ3kuCiAgICAgKgogICAgICogQGV4dGVuZHMgQmFzZUdlb20KICAgICAqLwogICAgY2xhc3MgTWVzaCBleHRlbmRzIEJhc2VHZW9tIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIE1lc2guCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuZWRnZUZhY2VzID0gW107CiAgICAgICAgICAgIHRoaXMuZmFjZUVkZ2VzID0gW1tdXTsKICAgICAgICAgICAgdGhpcy5mYWNlQ291bnRzID0gW107CiAgICAgICAgICAgIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheSgpOwogICAgICAgICAgICB0aGlzLl9fbG9nVG9wb2xvZ3lXYXJuaW5ncyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9fZWRnZUF0dHJpYnV0ZXMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgIHRoaXMuX19mYWNlQXR0cmlidXRlcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgdGhpcy5udW1FZGdlcyA9IDA7CiAgICAgICAgICAgIHRoaXMuZWRnZVZlcnRzID0gW107CiAgICAgICAgICAgIHRoaXMudmVydGV4RWRnZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5lZGdlQW5nbGVzID0gbmV3IEZsb2F0MzJBcnJheSgpOwogICAgICAgICAgICB0aGlzLmVkZ2VWZWNzID0gW107CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBjbGVhciBtZXRob2QuCiAgICAgICAgICovCiAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgICAgIC8vdGhpcy5pbml0KCkKICAgICAgICAgICAgLy90aGlzLnNldE51bVZlcnRpY2VzKDApCiAgICAgICAgICAgIC8vIGNsZWFyIGVkZ2UgYW5kIGZhY2Ugbm9ybWFscy4KICAgICAgICAgICAgdGhpcy5lZGdlVmVydHMgPSBbXTsKICAgICAgICAgICAgdGhpcy52ZXJ0ZXhFZGdlcyA9IFtdOwogICAgICAgICAgICB0aGlzLm51bUVkZ2VzID0gMDsKICAgICAgICAgICAgdGhpcy5lZGdlQW5nbGVzID0gbmV3IEZsb2F0MzJBcnJheSgpOwogICAgICAgICAgICB0aGlzLmVtaXQoJ2dlb21EYXRhVG9wb2xvZ3lDaGFuZ2VkJyk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYSBuZXcgdmVydGV4IGF0dHJpYnV0ZSB0byB0aGUgZ2VvbWV0cnkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB2ZXJ0ZXggYXR0cmlidXRlLgogICAgICAgICAqIEBwYXJhbSBhdHRyIC0gVGhlIGF0dHJpYnV0ZSB0byBhZGQgdG8gdGhlIGdlb21ldHJ5CiAgICAgICAgICovCiAgICAgICAgYWRkVmVydGV4QXR0cmlidXRlKG5hbWUsIGF0dHIpIHsKICAgICAgICAgICAgc3VwZXIuYWRkVmVydGV4QXR0cmlidXRlKG5hbWUsIGF0dHIpOwogICAgICAgICAgICBhdHRyLnNldE1lc2godGhpcyk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBnZXRGYWNlQ291bnRzIG1ldGhvZC4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRGYWNlQ291bnRzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mYWNlQ291bnRzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZ2V0TnVtRmFjZXMgbWV0aG9kLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldE51bUZhY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mYWNlQ291bnRzLmxlbmd0aCA9PSAwID8gMCA6IHRoaXMuZmFjZUNvdW50cy5yZWR1Y2UoKG51bUZhY2VzLCBmYykgPT4gKG51bUZhY2VzICs9IGZjKSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBnZXROdW1UcmlhbmdsZXMgbWV0aG9kLgogICAgICAgICAqIEByZXR1cm4ge251bWJlcn0gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldE51bVRyaWFuZ2xlcygpIHsKICAgICAgICAgICAgbGV0IG51bVRyaWFuZ2xlcyA9IDA7CiAgICAgICAgICAgIGxldCBudW1UcmlzUGVyRmFjZSA9IDE7CiAgICAgICAgICAgIGZvciAoY29uc3QgZmMgb2YgdGhpcy5mYWNlQ291bnRzKSB7CiAgICAgICAgICAgICAgICBudW1UcmlhbmdsZXMgKz0gZmMgKiBudW1UcmlzUGVyRmFjZTsKICAgICAgICAgICAgICAgIG51bVRyaXNQZXJGYWNlKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bVRyaWFuZ2xlczsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgbnVtYmVyIG9mIGZhY2VzIG9uIHRoZSBtZXNoIHVzaW5nIGFuIGFycmF5IHNwZWNpZnlpbmcgdGhlIGNvdW50cyBwZXIgcG9seWdvbiBzaXplLgogICAgICAgICAqIFRoZSBmaXJzdCBpdGVtIGluIHRoZSBhcnJheSBzcGVjaWZpZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMsIHRoZSBzZWNvbmQsIHRoZSBudW1iZXIgb2YgcXVhZHMsIHRoZSAzcmQsIHRoZSBudW1iZXIgb2YgNSBzaWRlZCBwb2x5Z29ucyBldGMuLgogICAgICAgICAqIGUuZy4gdG8gc3BlY2lmeSAyIHRyaWFuZ2xlcywgYW5kIDcgcXVhZHMsIHdlIHdvdWxkIHBhc3MgWzIsIDddCiAgICAgICAgICogQHBhcmFtIGZhY2VDb3VudHMgLSBUaGUgZmFjZUNvdW50cyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGYWNlQ291bnRzKGZhY2VDb3VudHMpIHsKICAgICAgICAgICAgLy8gbGV0IG51bUZhY2VzID0gMAogICAgICAgICAgICBsZXQgbnVtRmFjZXNWZXJ0aWNlcyA9IDA7CiAgICAgICAgICAgIGxldCBudW1WZXJ0c1BlckZhY2UgPSAzOwogICAgICAgICAgICBmb3IgKGNvbnN0IGZjIG9mIGZhY2VDb3VudHMpIHsKICAgICAgICAgICAgICAgIC8vIG51bUZhY2VzICs9IGZjCiAgICAgICAgICAgICAgICBudW1GYWNlc1ZlcnRpY2VzICs9IGZjICogbnVtVmVydHNQZXJGYWNlOwogICAgICAgICAgICAgICAgbnVtVmVydHNQZXJGYWNlKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcHJldk51bUZhY2VzID0gdGhpcy5nZXROdW1GYWNlcygpOwogICAgICAgICAgICBpZiAocHJldk51bUZhY2VzID09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheShudW1GYWNlc1ZlcnRpY2VzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0ZXhJbmRpY2VzID0gbmV3IFVpbnQzMkFycmF5KG51bUZhY2VzVmVydGljZXMpOwogICAgICAgICAgICAgICAgLy8gTm93IHdlIHByZXNlcnZlIHRoZSBleGlzdGluZyBpbmRpY2VzIGlmIHRoZXkgZml0IHdpdGhpbiB0aGUgbmV3IGZhY2VWZXJ0ZXhJbmRpY2VzIGFycmF5LgogICAgICAgICAgICAgICAgbGV0IHN0YXJ0U3JjID0gMDsKICAgICAgICAgICAgICAgIGxldCBzdGFydFRndCA9IDA7CiAgICAgICAgICAgICAgICBudW1GYWNlc1ZlcnRpY2VzID0gMDsKICAgICAgICAgICAgICAgIG51bVZlcnRzUGVyRmFjZSA9IDM7CiAgICAgICAgICAgICAgICBmYWNlQ291bnRzLmZvckVhY2goKGZjLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZFNyYyA9IHN0YXJ0U3JjICsgTWF0aC5taW4oZmMsIHRoaXMuZmFjZUNvdW50c1tpbmRleF0pICogbnVtVmVydHNQZXJGYWNlOwogICAgICAgICAgICAgICAgICAgIGZhY2VWZXJ0ZXhJbmRpY2VzLnNldCh0aGlzLl9fZmFjZVZlcnRleEluZGljZXMuc2xpY2Uoc3RhcnRTcmMsIGVuZFNyYyksIHN0YXJ0VGd0KTsKICAgICAgICAgICAgICAgICAgICBzdGFydFNyYyArPSB0aGlzLmZhY2VDb3VudHNbaW5kZXhdICogbnVtVmVydHNQZXJGYWNlOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGd0ICs9IGZjICogbnVtVmVydHNQZXJGYWNlOwogICAgICAgICAgICAgICAgICAgIG51bVZlcnRzUGVyRmFjZSsrOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9fZmFjZVZlcnRleEluZGljZXMgPSBmYWNlVmVydGV4SW5kaWNlczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmZhY2VDb3VudHMgPSBmYWNlQ291bnRzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdmVydGljZXMgaW5kZXhlZCBieSB0aGlzIGZhY2UKICAgICAgICAgKiBAcGFyYW0gZmFjZUluZGV4IC0gVGhlIGZhY2VJbmRleCB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRGYWNlVmVydGV4Q291bnQoZmFjZUluZGV4KSB7CiAgICAgICAgICAgIGxldCBpZHggPSAwOwogICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICB0aGlzLmZhY2VDb3VudHMuc29tZSgoZmMsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpZHggKz0gZmM7CiAgICAgICAgICAgICAgICBpZiAoaWR4ID4gZmFjZUluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBpbmRleCArIDM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gY291bnQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIG9mZnNldCBvZiB0aGUgZmFjZSBpbmRpY2VzIHdpdGhpbiB0aGUgZW50aXJlIGluZGV4IGFycmF5LgogICAgICAgICAqIEBwYXJhbSBmYWNlSW5kZXggLSBUaGUgZmFjZUluZGV4IHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGdldEZhY2VWZXJ0ZXhPZmZzZXQoZmFjZUluZGV4KSB7CiAgICAgICAgICAgIGxldCBpZHggPSAwOwogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgdGhpcy5mYWNlQ291bnRzLnNvbWUoKGZjLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGlkeCArIGZjID4gZmFjZUluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChmYWNlSW5kZXggLSBpZHgpICogKGluZGV4ICsgMyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZHggKz0gZmM7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZmMgKiAoaW5kZXggKyAzKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBzZXRGYWNlVmVydGV4SW5kaWNlcyBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIGZhY2VJbmRleCAtIFRoZSBmYWNlSW5kZXggdmFsdWUuCiAgICAgICAgICogQHBhcmFtIHZlcnRleEluZGljZXMgLSBUaGUgYXJyYXkgb2YgdmVydGV4IGluZGljZXMgZm9yIHRoaXMgZmFjZSB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBzZXRGYWNlVmVydGV4SW5kaWNlcyhmYWNlSW5kZXgsIHZlcnRleEluZGljZXMpIHsKICAgICAgICAgICAgY29uc3QgZmFjZVZlcnRleENvdW50ID0gdGhpcy5nZXRGYWNlVmVydGV4Q291bnQoZmFjZUluZGV4KTsKICAgICAgICAgICAgaWYgKHZlcnRleEluZGljZXMubGVuZ3RoICE9IGZhY2VWZXJ0ZXhDb3VudCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGluZGljZXMgZm9yIGZhY2U6JHtmYWNlSW5kZXh9IHZlcnRleEluZGljZXM6JHt2ZXJ0ZXhJbmRpY2VzfS4gRXhwZWN0ZWQgJHtmYWNlVmVydGV4Q291bnR9IGluZGljZXNgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLmdldEZhY2VWZXJ0ZXhPZmZzZXQoZmFjZUluZGV4KTsKICAgICAgICAgICAgdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzLnNldCh2ZXJ0ZXhJbmRpY2VzLCBvZmZzZXQpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIGEgbmV3IGZhY2UgdG8gdGhlIG1lc2gKICAgICAgICAgKiBAcGFyYW0gdmVydGV4SW5kaWNlcyAtIFRoZSB2ZXJ0ZXggaW5kaWNlcyBvZiB0aGUgZmFjZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIGluZGV4IG9mIHRoZSBmYWNlIGluIHRoZSBtZXNoLgogICAgICAgICAqLwogICAgICAgIGFkZEZhY2UodmVydGV4SW5kaWNlcykgewogICAgICAgICAgICBjb25zdCBmYWNlQ291bnRzID0gWy4uLnRoaXMuZmFjZUNvdW50c107CiAgICAgICAgICAgIGlmIChmYWNlQ291bnRzLmxlbmd0aCA8PSB2ZXJ0ZXhJbmRpY2VzLmxlbmd0aCAtIDMpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBmYWNlQ291bnRzLmxlbmd0aDsgaSA8IHZlcnRleEluZGljZXMubGVuZ3RoIC0gMzsgaSsrKQogICAgICAgICAgICAgICAgICAgIGZhY2VDb3VudHNbaV0gPSAwOwogICAgICAgICAgICAgICAgZmFjZUNvdW50c1t2ZXJ0ZXhJbmRpY2VzLmxlbmd0aCAtIDNdID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZhY2VDb3VudHNbdmVydGV4SW5kaWNlcy5sZW5ndGggLSAzXSsrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2V0RmFjZUNvdW50cyhmYWNlQ291bnRzKTsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBvZmZzZXQgaW4gdGhlIGZhY2VWZXJ0ZXhJbmRpY2VzIG9mIHRoaXMgbmV3IGZhY2UuCiAgICAgICAgICAgIGxldCBmYWNlSW5kZXggPSAwOwogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgdGhpcy5mYWNlQ291bnRzLnNvbWUoKGZjLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGluZGV4ICsgMyA9PSB2ZXJ0ZXhJbmRpY2VzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGZhY2VJbmRleCArPSBmYyAtIDE7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChmYyAtIDEpICogKGluZGV4ICsgMyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmYWNlSW5kZXggKz0gZmM7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZmMgKiAoaW5kZXggKyAzKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcy5zZXQodmVydGV4SW5kaWNlcywgb2Zmc2V0KTsKICAgICAgICAgICAgcmV0dXJuIGZhY2VJbmRleDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgdmVydGV4IGluZGljZXMgb2YgdGhlIHNwZWNpZmllZCBmYWNlLgogICAgICAgICAqIEBwYXJhbSBmYWNlSW5kZXggLSBUaGUgaW5kZXggb2YgdGhlIHNwZWNpZmllZCBmYWNlCiAgICAgICAgICogQHJldHVybiAtIEFuIGFycmF5IG9mIGluZGljZXMgaW50byB0aGUgdmVydGV4IGF0dHJpYnV0ZXMKICAgICAgICAgKi8KICAgICAgICBnZXRGYWNlVmVydGV4SW5kaWNlcyhmYWNlSW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgdmVydGV4SW5kaWNlcyA9IFtdOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLmdldEZhY2VWZXJ0ZXhPZmZzZXQoZmFjZUluZGV4KTsKICAgICAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmdldEZhY2VWZXJ0ZXhDb3VudChmYWNlSW5kZXgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHZlcnRleEluZGljZXMucHVzaCh0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbb2Zmc2V0ICsgaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2ZXJ0ZXhJbmRpY2VzOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgc2luZ2xlIHZlcnRleCBpbmRleCBmb3IgYSBnaXZlbiBmYWNlIGFuZCBmYWNlVmVydGV4LgogICAgICAgICAqIEBwYXJhbSBmYWNlSW5kZXggLSBUaGUgZmFjZUluZGV4IHZhbHVlLgogICAgICAgICAqIEBwYXJhbSBmYWNlVmVydGV4IC0gVGhlIGZhY2UgdmVydGV4IGlzIHRoZSBpbmRleCB3aXRoaW4gdGhlIGZhY2UuIFNvIHRoZSBmaXJzdCB2ZXJ0ZXggaW5kZXggaXMgMC4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHZlcnRleCBpbmRleAogICAgICAgICAqLwogICAgICAgIGdldEZhY2VWZXJ0ZXhJbmRleChmYWNlSW5kZXgsIGZhY2VWZXJ0ZXgpIHsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5nZXRGYWNlVmVydGV4T2Zmc2V0KGZhY2VJbmRleCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbb2Zmc2V0ICsgZmFjZVZlcnRleF07CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIEZhY2UgQXR0cmlidXRlcwogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBhZGRGYWNlQXR0cmlidXRlIG1ldGhvZC4KICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBmYWNlIGF0dHJpYnV0ZSB0byBhZGQuCiAgICAgICAgICogQHBhcmFtIGF0dHIgLSBUaGUgYXR0ciB2YWx1ZQogICAgICAgICAqLwogICAgICAgIGFkZEZhY2VBdHRyaWJ1dGUobmFtZSwgYXR0cikgewogICAgICAgICAgICBhdHRyLnNldENvdW50KHRoaXMuZ2V0TnVtRmFjZXMoKSk7CiAgICAgICAgICAgIHRoaXMuX19mYWNlQXR0cmlidXRlcy5zZXQobmFtZSwgYXR0cik7CiAgICAgICAgICAgIHJldHVybiBhdHRyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgaGFzRmFjZUF0dHJpYnV0ZSBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZmFjZSBhdHRyaWJ1dGUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgaGFzRmFjZUF0dHJpYnV0ZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZmFjZUF0dHJpYnV0ZXMuaGFzKG5hbWUpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZ2V0RmFjZUF0dHJpYnV0ZSBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZmFjZSBhdHRyaWJ1dGUuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgZ2V0RmFjZUF0dHJpYnV0ZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZmFjZUF0dHJpYnV0ZXMuZ2V0KG5hbWUpOwogICAgICAgIH0KICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gRWRnZSBBdHRyaWJ1dGVzCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGFkZEVkZ2VBdHRyaWJ1dGUgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGVkZ2UgYXR0cmlidXRlIHRvIGFkZC4KICAgICAgICAgKiBAcGFyYW0gYXR0ciAtIFRoZSBhdHRyIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgYWRkRWRnZUF0dHJpYnV0ZShuYW1lLCBhdHRyKSB7CiAgICAgICAgICAgIGF0dHIuc2V0Q291bnQodGhpcy5udW1FZGdlcyk7CiAgICAgICAgICAgIHRoaXMuX19lZGdlQXR0cmlidXRlcy5zZXQobmFtZSwgYXR0cik7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBoYXNFZGdlQXR0cmlidXRlIG1ldGhvZC4KICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBlZGdlIGF0dHJpYnV0ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBoYXNFZGdlQXR0cmlidXRlKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19lZGdlQXR0cmlidXRlcy5oYXMobmFtZSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBnZXRFZGdlQXR0cmlidXRlIG1ldGhvZC4KICAgICAgICAgKiBAcGFyYW0gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBlZGdlIGF0dHJpYnV0ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZXRFZGdlQXR0cmlidXRlKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19lZGdlQXR0cmlidXRlcy5nZXQobmFtZSk7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBnZW5Ub3BvbG9neUluZm8gbWV0aG9kLgogICAgICAgICAqLwogICAgICAgIGdlblRvcG9sb2d5SW5mbygpIHsKICAgICAgICAgICAgbGV0IGNvbm5lY3RlZFZlcnRpY2VzID0ge307IC8vIGFjY2VsZXJhdGlvbiBzdHJ1Y3R1cmUuCiAgICAgICAgICAgIHRoaXMudmVydGV4RWRnZXMgPSBbXTsgLy8gMmQgYXJyYXkgb2YgdmVydGV4IHRvIGVkZ2VzLgogICAgICAgICAgICAvLyB0aGlzLnZlcnRleEZhY2VzID0gW107IC8vIDJkIGFycmF5IG9mIHZlcnRleCB0byBmYWNlcy4KICAgICAgICAgICAgdGhpcy5lZGdlRmFjZXMgPSBbXTsgLy8gZmxhdCBhcnJheSBvZiAyIGZhY2UgaW5kaWNlcyBwZXIgZWRnZQogICAgICAgICAgICB0aGlzLmVkZ2VWZXJ0cyA9IFtdOyAvLyBmbGF0IGFycmF5IG9mIDIgdmVydCBpbmRpY2VzIHBlciBlZGdlCiAgICAgICAgICAgIHRoaXMuZmFjZUVkZ2VzID0gW107IC8vIHRoZSBlZGdlcyBib3JkZXJpbmcgZWFjaCBmYWNlLgogICAgICAgICAgICB0aGlzLm51bUVkZ2VzID0gMDsKICAgICAgICAgICAgY29uc3QgcG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnM7CiAgICAgICAgICAgIGNvbnN0IGdldEVkZ2VJbmRleCA9ICh2MCwgdjEpID0+IHsKICAgICAgICAgICAgICAgIGxldCB0bXAwID0gdjA7CiAgICAgICAgICAgICAgICBsZXQgdG1wMSA9IHYxOwogICAgICAgICAgICAgICAgaWYgKHRtcDEgPCB0bXAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG1wID0gdG1wMDsKICAgICAgICAgICAgICAgICAgICB0bXAwID0gdG1wMTsKICAgICAgICAgICAgICAgICAgICB0bXAxID0gdG1wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gdG1wMCArICc+JyArIHRtcDE7CiAgICAgICAgICAgICAgICBpZiAoa2V5IGluIGNvbm5lY3RlZFZlcnRpY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coa2V5ICsgJzonICsgY29ubmVjdGVkVmVydGljZXNba2V5XSArICIgZmFjZToiICsgKCB2MCA8IHYxID8gMCA6IDEpICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3RlZFZlcnRpY2VzW2tleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBwMCA9IHBvc2l0aW9ucy5nZXRWYWx1ZVJlZih0bXAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHAxID0gcG9zaXRpb25zLmdldFZhbHVlUmVmKHRtcDEpOwogICAgICAgICAgICAgICAgY29uc3QgZWRnZVZlYyA9IHAxLnN1YnRyYWN0KHAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2VJbmRleCA9IHRoaXMuZWRnZUZhY2VzLmxlbmd0aCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBlZGdlRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBlZGdlSW5kZXg6IGVkZ2VJbmRleCwKICAgICAgICAgICAgICAgICAgICBlZGdlVmVjOiBlZGdlVmVjLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbm5lY3RlZFZlcnRpY2VzW2tleV0gPSBlZGdlRGF0YTsKICAgICAgICAgICAgICAgIHRoaXMuZWRnZUZhY2VzLnB1c2goLTEpOwogICAgICAgICAgICAgICAgdGhpcy5lZGdlRmFjZXMucHVzaCgtMSk7CiAgICAgICAgICAgICAgICB0aGlzLmVkZ2VWZXJ0cy5wdXNoKHRtcDApOwogICAgICAgICAgICAgICAgdGhpcy5lZGdlVmVydHMucHVzaCh0bXAxKTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGtleSArICc6JyArIGNvbm5lY3RlZFZlcnRpY2VzW2tleV0gKyAiIGZhY2U6IiArICggdjAgPCB2MSA/IDAgOiAxKSk7CiAgICAgICAgICAgICAgICB0aGlzLm51bUVkZ2VzKys7CiAgICAgICAgICAgICAgICByZXR1cm4gZWRnZURhdGE7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGFkZEVkZ2UgPSAodjAsIHYxLCBmYWNlSW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdhZGRFZGdlOicgKyB2MCArICIgOiIgKyB2MSArICIgZmFjZUluZGV4OiIgKyBmYWNlSW5kZXggKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2VEYXRhID0gZ2V0RWRnZUluZGV4KHYwLCB2MSk7CiAgICAgICAgICAgICAgICBjb25zdCBlZGdlSW5kZXggPSBlZGdlRGF0YS5lZGdlSW5kZXg7CiAgICAgICAgICAgICAgICBpZiAodjEgPCB2MCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2VGYWNlSW5kZXggPSBlZGdlSW5kZXggKiAyICsgMDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fX2xvZ1RvcG9sb2d5V2FybmluZ3MgJiYgdGhpcy5lZGdlRmFjZXNbZWRnZUZhY2VJbmRleF0gIT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignRWRnZSBwb2x5IDAgYWxyZWFkeSBzZXQuIE1lc2ggaXMgbm9uLW1hbmlmb2xkLicpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWRnZUZhY2VzW2VkZ2VGYWNlSW5kZXhdID0gZmFjZUluZGV4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWRnZUZhY2VJbmRleCA9IGVkZ2VJbmRleCAqIDIgKyAxOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fbG9nVG9wb2xvZ3lXYXJuaW5ncyAmJiB0aGlzLmVkZ2VGYWNlc1tlZGdlRmFjZUluZGV4XSAhPSAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdFZGdlIHBvbHkgMSBhbHJlYWR5IHNldC4gTWVzaCBpcyBub24tbWFuaWZvbGQuJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGdlRmFjZXNbZWRnZUZhY2VJbmRleF0gPSBmYWNlSW5kZXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIShmYWNlSW5kZXggaW4gdGhpcy5mYWNlRWRnZXMpKQogICAgICAgICAgICAgICAgICAgIHRoaXMuZmFjZUVkZ2VzW2ZhY2VJbmRleF0gPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuZmFjZUVkZ2VzW2ZhY2VJbmRleF0ucHVzaChlZGdlSW5kZXgpOwogICAgICAgICAgICAgICAgLy8gUHVzaCB0aGUgZWRnZSBpbmRleCBvbnRvIGJvdGggdmVydGV4IGVkZ2UgbGlzdHMuCiAgICAgICAgICAgICAgICAvLyBXZSB1c2UgU2V0cyB0byBhdm9pZCBhZGRpbmcgdGhlIHNhbWUgZWRnZSAyeCB0byB0aGUgc2FtZSB2ZXJ0ZXguCiAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJ0ZXhFZGdlc1t2MF0gPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52ZXJ0ZXhFZGdlc1t2MF0gPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJ0ZXhFZGdlc1t2MV0gPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52ZXJ0ZXhFZGdlc1t2MV0gPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnZlcnRleEVkZ2VzW3YwXS5hZGQoZWRnZUluZGV4KTsKICAgICAgICAgICAgICAgIHRoaXMudmVydGV4RWRnZXNbdjFdLmFkZChlZGdlSW5kZXgpOwogICAgICAgICAgICAgICAgLy8gaWYgKHRoaXMudmVydGV4RmFjZXNbdjBdID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMudmVydGV4RmFjZXNbdjBdID0gW107CiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAvLyB0aGlzLnZlcnRleEZhY2VzW3YwXS5wdXNoKGZhY2VJbmRleCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IG51bUZhY2VzID0gdGhpcy5nZXROdW1GYWNlcygpOwogICAgICAgICAgICBmb3IgKGxldCBmYWNlSW5kZXggPSAwOyBmYWNlSW5kZXggPCBudW1GYWNlczsgZmFjZUluZGV4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0cyA9IHRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXMoZmFjZUluZGV4KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZmFjZVZlcnRzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjAgPSBmYWNlVmVydHNbal07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjEgPSBmYWNlVmVydHNbKGogKyAxKSAlIGZhY2VWZXJ0cy5sZW5ndGhdOwogICAgICAgICAgICAgICAgICAgIGFkZEVkZ2UodjAsIHYxLCBmYWNlSW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENvbXB1dGVzIGEgbm9ybWFsIHZhbHVlIHBlciBmYWNlIGJ5IGF2ZXJhZ2luZyB0aGUgdHJpYW5nbGUgbm9ybWFscyBvZiB0aGUgZmFjZS4KICAgICAgICAgKi8KICAgICAgICBjb21wdXRlRmFjZU5vcm1hbHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IHRoaXMucG9zaXRpb25zOwogICAgICAgICAgICBjb25zdCBmYWNlTm9ybWFscyA9IG5ldyBWZWMzQXR0cmlidXRlKCk7CiAgICAgICAgICAgIHRoaXMuYWRkRmFjZUF0dHJpYnV0ZSgnbm9ybWFscycsIGZhY2VOb3JtYWxzKTsKICAgICAgICAgICAgY29uc3QgbnVtRmFjZXMgPSB0aGlzLmdldE51bUZhY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGZhY2VJbmRleCA9IDA7IGZhY2VJbmRleCA8IG51bUZhY2VzOyBmYWNlSW5kZXgrKykgewogICAgICAgICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gdGhpcy5nZXRGYWNlVmVydGV4SW5kaWNlcyhmYWNlSW5kZXgpOwogICAgICAgICAgICAgICAgY29uc3QgcDAgPSBwb3NpdGlvbnMuZ2V0VmFsdWVSZWYoZmFjZVZlcnRzWzBdKTsKICAgICAgICAgICAgICAgIGNvbnN0IHAxID0gcG9zaXRpb25zLmdldFZhbHVlUmVmKGZhY2VWZXJ0c1sxXSk7CiAgICAgICAgICAgICAgICBsZXQgcHJldiA9IHAxOwogICAgICAgICAgICAgICAgY29uc3QgZmFjZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMjsgaiA8IGZhY2VWZXJ0cy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBuID0gcG9zaXRpb25zLmdldFZhbHVlUmVmKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdjAgPSBwcmV2LnN1YnRyYWN0KHAwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2MSA9IHBuLnN1YnRyYWN0KHAwKTsKICAgICAgICAgICAgICAgICAgICBmYWNlTm9ybWFsLmFkZEluUGxhY2UodjAuY3Jvc3ModjEpLm5vcm1hbGl6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBwcmV2ID0gcG47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZmFjZU5vcm1hbC5sZW5ndGhTcXVhcmVkKCkgPCBOdW1iZXIuRVBTSUxPTikgOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZmFjZU5vcm1hbHMuc2V0VmFsdWUoZmFjZUluZGV4LCBmYWNlTm9ybWFsLm5vcm1hbGl6ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBhbmdsZXMgYXQgZWFjaCBlZGdlIGJldHdlZW4gdGhlIGFkam9pbmluZyBmYWNlcwogICAgICAgICAqLwogICAgICAgIGNhbGN1bGF0ZUVkZ2VBbmdsZXMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgdGhpcy5nZW5Ub3BvbG9neUluZm8oKTsKICAgICAgICAgICAgdGhpcy5jb21wdXRlRmFjZU5vcm1hbHMoKTsKICAgICAgICAgICAgY29uc3QgcG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnM7CiAgICAgICAgICAgIGNvbnN0IGZhY2VOb3JtYWxzID0gdGhpcy5nZXRGYWNlQXR0cmlidXRlKCdub3JtYWxzJyk7CiAgICAgICAgICAgIHRoaXMuZWRnZVZlY3MgPSBbXTsKICAgICAgICAgICAgdGhpcy5lZGdlQW5nbGVzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLm51bUVkZ2VzKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVkZ2VGYWNlcy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3QgdjAgPSB0aGlzLmVkZ2VWZXJ0c1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHYxID0gdGhpcy5lZGdlVmVydHNbaSArIDFdOwogICAgICAgICAgICAgICAgY29uc3QgZWRnZVZlYyA9IHBvc2l0aW9ucy5nZXRWYWx1ZVJlZih2MSkuc3VidHJhY3QocG9zaXRpb25zLmdldFZhbHVlUmVmKHYwKSk7CiAgICAgICAgICAgICAgICBlZGdlVmVjLm5vcm1hbGl6ZUluUGxhY2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuZWRnZVZlY3MucHVzaChlZGdlVmVjKTsKICAgICAgICAgICAgICAgIGNvbnN0IHAwID0gdGhpcy5lZGdlRmFjZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBwMSA9IHRoaXMuZWRnZUZhY2VzW2kgKyAxXTsKICAgICAgICAgICAgICAgIGlmIChwMCA9PSAtMSB8fCBwMSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIC8vIEZsYWcgdGhlIGVkZ2UgYXMgYSBib3JkZXIgZWRnZS4uLi4KICAgICAgICAgICAgICAgICAgICB0aGlzLmVkZ2VBbmdsZXNbaSAvIDJdID0gTWF0aC5QSSAqIDIuMDsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IG4wID0gZmFjZU5vcm1hbHMuZ2V0VmFsdWVSZWYocDApOwogICAgICAgICAgICAgICAgY29uc3QgbjEgPSBmYWNlTm9ybWFscy5nZXRWYWx1ZVJlZihwMSk7CiAgICAgICAgICAgICAgICB0aGlzLmVkZ2VBbmdsZXNbaSAvIDJdID0gbjAuYW5nbGVUbyhuMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcHV0ZSB2ZXJ0ZXggbm9ybWFscy4KICAgICAgICAgKiBAcGFyYW0gaGFyZEFuZ2xlIC0gVGhlIGhhcmRBbmdsZSB2YWx1ZSBpbiByYWRpYW5zLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGNvbXB1dGVWZXJ0ZXhOb3JtYWxzKGhhcmRBbmdsZSA9IDEuMCAvKiByYWRpYW5zICovKSB7CiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlRWRnZUFuZ2xlcygpOwogICAgICAgICAgICBjb25zdCBmYWNlTm9ybWFscyA9IHRoaXMuZ2V0RmFjZUF0dHJpYnV0ZSgnbm9ybWFscycpOwogICAgICAgICAgICBjb25zdCBub3JtYWxzQXR0ciA9IG5ldyBWZWMzQXR0cmlidXRlKCk7CiAgICAgICAgICAgIHRoaXMuYWRkVmVydGV4QXR0cmlidXRlKCdub3JtYWxzJywgbm9ybWFsc0F0dHIpOwogICAgICAgICAgICAvLyB0aGVzZSBtZXRob2RzIGFyZSBmYXN0ZXIgdmVyc2lvbnMgdGhhbiB1c2luZyB0aGUgbWV0aG9kcwogICAgICAgICAgICAvLyBwcm92aWRlZCBvbiB0aGUgYXR0cmlidXRlcy4gV2UgY2FjaGUgdmFsdWVzIGFuZCB1c2UgaGFyZCBjb2RlZCBjb25zdGFudHMuCiAgICAgICAgICAgIC8vIGNvbnN0IGZhY2VOb3JtYWxzQnVmZmVyID0gZmFjZU5vcm1hbHMuZGF0YS5idWZmZXIKICAgICAgICAgICAgY29uc3QgZ2V0RmFjZU5vcm1hbCA9IChpbmRleCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGZhY2VOb3JtYWxzLmdldFZhbHVlUmVmKGluZGV4KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3Qgc2V0VmVydGV4Tm9ybWFsID0gKGluZGV4LCB2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgbm9ybWFsc0F0dHIuc2V0VmFsdWUoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgZ2V0Q29ubmVjdGVkRWRnZVZlY3MgPSAoZmFjZUluZGV4LCB2ZXJ0ZXhJbmRleCkgPT4gewogICAgICAgICAgICAgICAgbGV0IGUwOwogICAgICAgICAgICAgICAgbGV0IGUxOwogICAgICAgICAgICAgICAgY29uc3QgZmFjZUVkZ2VzID0gdGhpcy5mYWNlRWRnZXNbZmFjZUluZGV4XTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBmYWNlRWRnZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lZGdlVmVydHNbZSAqIDJdID09IHZlcnRleEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlMCA9IHRoaXMuZWRnZVZlY3NbZV07CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUxID0gdGhpcy5lZGdlVmVjc1tlXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5lZGdlVmVydHNbZSAqIDIgKyAxXSA9PSB2ZXJ0ZXhJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWUwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZTAgPSB0aGlzLmVkZ2VWZWNzW2VdOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlMSA9IHRoaXMuZWRnZVZlY3NbZV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFtlMCwgZTFdOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGV4RWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgZmFjZSBpbmRleGluZyBkb2Vzbid0IHN0YXJ0IGF0IDAsIHRoZW4gdGhlIHZlcnRleEVkZ2VzIGRvbid0IGVpdGhlci4KICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlcnRleEVkZ2VzW2ldID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy52ZXJ0ZXhFZGdlc1tpXTsKICAgICAgICAgICAgICAgIC8vIEdyb3VwcyBvZiBmYWNlcyBoYXZpbmcgYSBzbW9vdGggbm9ybWFsIGF0IHRoZSBjdXJyZW50IHZlcnRleC4KICAgICAgICAgICAgICAgIGNvbnN0IGZhY2VHcm91cHMgPSBbXTsKICAgICAgICAgICAgICAgIGNvbnN0IGFkZEZhY2VUb0dyb3VwID0gKGZhY2UpID0+IHsKICAgICAgICAgICAgICAgICAgICBsZXQgaW5Hcm91cCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmFjZUdyb3VwIG9mIGZhY2VHcm91cHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5Hcm91cCA9IGZhY2VHcm91cC5pbmNsdWRlcyhmYWNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluR3JvdXApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbkdyb3VwKQogICAgICAgICAgICAgICAgICAgICAgICBmYWNlR3JvdXBzLnB1c2goW2ZhY2VdKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgZWRnZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmMCA9IHRoaXMuZWRnZUZhY2VzW2UgKiAyXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmMSA9IHRoaXMuZWRnZUZhY2VzW2UgKiAyICsgMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGYwICE9IC0xICYmIGYxICE9IC0xICYmIHRoaXMuZWRnZUFuZ2xlc1tlXSA8IGhhcmRBbmdsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAoZjAgIT0gLTEgJiYgZjEgPT0gLTEgJiYgdGhpcy5lZGdlQW5nbGVzW2VdIDwgaGFyZEFuZ2xlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmMGdyb3VwSW5kZXggPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGYxZ3JvdXBJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBncm91cEluZGV4ID0gMDsgZ3JvdXBJbmRleCA8IGZhY2VHcm91cHMubGVuZ3RoOyBncm91cEluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmMGdyb3VwSW5kZXggPT0gLTEgJiYgZmFjZUdyb3Vwc1tncm91cEluZGV4XS5pbmNsdWRlcyhmMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjBncm91cEluZGV4ID0gZ3JvdXBJbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmMWdyb3VwSW5kZXggPT0gLTEgJiYgZmFjZUdyb3Vwc1tncm91cEluZGV4XS5pbmNsdWRlcyhmMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjFncm91cEluZGV4ID0gZ3JvdXBJbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZjBncm91cEluZGV4ID09IC0xICYmIGYxZ3JvdXBJbmRleCA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUdyb3Vwcy5wdXNoKFtmMCwgZjFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmMGdyb3VwSW5kZXggIT0gLTEgJiYgZjFncm91cEluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZjBncm91cEluZGV4ICE9IGYxZ3JvdXBJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1lcmdlIHRoZSAyIGdyb3VwcyB0aGF0IHRoZSBzbW9vdGggZWRnZSBqb2lucy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNlR3JvdXBzW2YwZ3JvdXBJbmRleF0gPSBmYWNlR3JvdXBzW2YwZ3JvdXBJbmRleF0uY29uY2F0KGZhY2VHcm91cHNbZjFncm91cEluZGV4XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUdyb3Vwcy5zcGxpY2UoZjFncm91cEluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmMGdyb3VwSW5kZXggPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWNlR3JvdXBzW2YxZ3JvdXBJbmRleF0ucHVzaChmMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZjFncm91cEluZGV4ID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUdyb3Vwc1tmMGdyb3VwSW5kZXhdLnB1c2goZjEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgaGFyZCBlZGdlIG9yIGEgYm9yZGVyIGVkZ2UuLi4gQWRkIGZhY2VzIHNlcGFyYXRlbHkgZ3JvdXAuCiAgICAgICAgICAgICAgICAgICAgaWYgKGYwICE9IC0xKQogICAgICAgICAgICAgICAgICAgICAgICBhZGRGYWNlVG9Hcm91cChmMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYxICE9IC0xKQogICAgICAgICAgICAgICAgICAgICAgICBhZGRGYWNlVG9Hcm91cChmMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBTb3J0IHRoZSBncm91cHMgdG8gaGF2ZSB0aGUgYmlnZ2VzdCBncm91cCBmaXJzdC4KICAgICAgICAgICAgICAgIGZhY2VHcm91cHMuc29ydCgoYSwgYikgPT4gKGEubGVuZ3RoIDwgYi5sZW5ndGggPyAxIDogYS5sZW5ndGggPiBiLmxlbmd0aCA/IC0xIDogMCkpOwogICAgICAgICAgICAgICAgbGV0IGZpcnN0VmVydGV4ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmFjZUdyb3VwIG9mIGZhY2VHcm91cHMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBub3JtYWwgPSBuZXcgVmVjMygpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmFjZUluZGV4IG9mIGZhY2VHcm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmYWNlRWRnZXMgPSBnZXRDb25uZWN0ZWRFZGdlVmVjcyhmYWNlSW5kZXgsIGkpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgd2VpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFjZUVkZ2VzWzBdICYmIGZhY2VFZGdlc1sxXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0ID0gZmFjZUVkZ2VzWzBdLmFuZ2xlVG8oZmFjZUVkZ2VzWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vcm1hbC5hZGRJblBsYWNlKGdldEZhY2VOb3JtYWwoZmFjZUluZGV4KS5zY2FsZSh3ZWlnaHQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigndmFyaWFibGUgd2VpZ2h0IGlzIHVuZGVmaW5lZCBiZWNhdXNlIGZhY2VFZGdlc1swXSBvciBmYWNlRWRnZXNbMV0gaXMgdW5kZWZpbmVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGkgPT0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCJGYWNlTm9ybWFsOiIgKyBmYWNlSW5kZXggKyAiOiIgKyBnZXRGYWNlTm9ybWFsKGZhY2VJbmRleCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemVJblBsYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0VmVydGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFZlcnRleE5vcm1hbChpLCBub3JtYWwpOwogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdFZlcnRleCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsc0F0dHIuc2V0U3BsaXRWZXJ0ZXhWYWx1ZXMoaSwgZmFjZUdyb3VwLCBub3JtYWwuYXNBcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5vcm1hbHNBdHRyOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgY29tcHV0ZUhhcmRFZGdlc0luZGljZXMgbWV0aG9kLgogICAgICAgICAqIEBwYXJhbSBoYXJkQW5nbGUgLSBUaGUgaGFyZEFuZ2xlIHZhbHVlIGluIHJhZGlhbnMuCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgY29tcHV0ZUhhcmRFZGdlc0luZGljZXMoaGFyZEFuZ2xlID0gMS4wKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVkZ2VWZXJ0cy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlRWRnZUFuZ2xlcygpOwogICAgICAgICAgICBjb25zdCBoYXJkRWRnZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgYWRkRWRnZSA9IChpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaGFyZEVkZ2VzLnB1c2godGhpcy5lZGdlVmVydHNbaW5kZXhdKTsKICAgICAgICAgICAgICAgIGhhcmRFZGdlcy5wdXNoKHRoaXMuZWRnZVZlcnRzW2luZGV4ICsgMV0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZWRnZUFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuZWRnZUFuZ2xlc1tpXSA+IGhhcmRBbmdsZSkgewogICAgICAgICAgICAgICAgICAgIGFkZEVkZ2UoaSAqIDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBVaW50MzJBcnJheS5mcm9tKGhhcmRFZGdlcyk7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBSZW5kZXJpbmcKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZ2VuQnVmZmVycyBtZXRob2QuCiAgICAgICAgICogQHBhcmFtIG9wdHMgLSBUaGUgb3B0cyB2YWx1ZS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBnZW5CdWZmZXJzKG9wdHMpIHsKICAgICAgICAgICAgLy8gQ29tcHV0ZSB0aGUgbm9ybWFscyBvbiBkZW1hbmQuCiAgICAgICAgICAgIC8vIGlmICghKCdub3JtYWxzJyBpbiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcykpIHsKICAgICAgICAgICAgLy8gICAgIC8vIHRoaXMuX19nZW9tLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7CiAgICAgICAgICAgIC8vICAgICB0aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIsIFZlYzMsIDAuMCk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgY29uc3Qgc3BsaXRJbmRpY2VzID0ge307CiAgICAgICAgICAgIGxldCBzcGxpdENvdW50ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBbLCBhdHRyXSBvZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgY29uc3QgYXR0clNwbGl0cyA9IGF0dHIuZ2V0U3BsaXRzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBvbHlnb24gaW4gYXR0clNwbGl0cykgewogICAgICAgICAgICAgICAgICAgIGlmICghKHBvbHlnb24gaW4gc3BsaXRJbmRpY2VzKSkKICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRJbmRpY2VzW3BvbHlnb25dID0ge307CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVydGljZXMgPSBhdHRyU3BsaXRzW3BvbHlnb25dOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdiBpbiB2ZXJ0aWNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXggPSBwYXJzZUludCh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodmVydGV4IGluIHNwbGl0SW5kaWNlc1twb2x5Z29uXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0SW5kaWNlc1twb2x5Z29uXVt2ZXJ0ZXhdID0gc3BsaXRDb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSB0aGlzLnBvc2l0aW9uczsKICAgICAgICAgICAgY29uc3QgbnVtVW5TcGxpdFZlcnRpY2VzID0gcG9zaXRpb25zLmdldENvdW50KCk7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsTnVtVmVydGljZXMgPSBudW1VblNwbGl0VmVydGljZXMgKyBzcGxpdENvdW50OwogICAgICAgICAgICBsZXQgaW5kaWNlczsKICAgICAgICAgICAgaWYgKCFvcHRzIHx8IG9wdHMuaW5jbHVkZUluZGljZXMgIT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGluZGljZXMgPSB0aGlzLmdlbmVyYXRlVHJpYW5ndWxhdGVkSW5kaWNlcyh0b3RhbE51bVZlcnRpY2VzLCBudW1VblNwbGl0VmVydGljZXMsIHNwbGl0SW5kaWNlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbGV0IG1heEluZGV4OwogICAgICAgICAgICAvLyBpZiAoZGVidWdBdHRyVmFsdWVzKQogICAgICAgICAgICAvLyAgICAgbWF4SW5kZXggPSBNYXRoLm1heCguLi5pbmRpY2VzKTsKICAgICAgICAgICAgY29uc3QgYXR0ckJ1ZmZlcnMgPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBbYXR0ck5hbWUsIGF0dHJdIG9mIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzOwogICAgICAgICAgICAgICAgaWYgKHNwbGl0Q291bnQgPT0gMCkKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBhdHRyLmFzQXJyYXkoKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBhdHRyLmdlbmVyYXRlU3BsaXRWYWx1ZXMoc3BsaXRJbmRpY2VzLCBzcGxpdENvdW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGF0dHIuc3RyaWRlOwogICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSB2YWx1ZXMubGVuZ3RoIC8gZGltZW5zaW9uOwogICAgICAgICAgICAgICAgLy8gaWYgKGRlYnVnQXR0clZhbHVlcykgewogICAgICAgICAgICAgICAgLy8gICAgIGlmIChjb3VudCA8PSBtYXhJbmRleCkKICAgICAgICAgICAgICAgIC8vICAgICAgICAgY29uc29sZS53YXJuKCJJbnZhbGlkIGluZGV4aW5nLiBBdHRyIHZhbHVlIGlzIGluc3VmZmljaWVudCBmb3IgaW5kZXhpbmc6IiArIGF0dHJOYW1lICsgIi4gTWF4IEluZGV4OiIgKyBtYXhJbmRleCArICIgQXR0ciBTaXplOiIgKyBjb3VudCk7CiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICBhdHRyQnVmZmVyc1thdHRyTmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgY291bnQ6IGNvdW50LAogICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogZGltZW5zaW9uLAogICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWQ6IGF0dHJOYW1lID09ICdub3JtYWxzJywKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogYXR0ci5nZXREYXRhVHlwZU5hbWUoKSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgbnVtVmVydGljZXM6IHRoaXMubnVtVmVydGljZXMoKSwKICAgICAgICAgICAgICAgIG51bVJlbmRlclZlcnRzOiB0b3RhbE51bVZlcnRpY2VzLAogICAgICAgICAgICAgICAgaW5kaWNlcywKICAgICAgICAgICAgICAgIGF0dHJCdWZmZXJzLAogICAgICAgICAgICB9OwogICAgICAgICAgICAvKiBEaXNhYmxlZCBkdXJpbmcgVFMgbWlncmF0aW9uLgogICAgICAgICAgICBpZiAob3B0cyAmJiBvcHRzLmluY2x1ZGVWZXJ0ZXhOZWlnaGJvcnMpIHsKICAgICAgICAgICAgICBpZiAodGhpcy52ZXJ0ZXhFZGdlcyA9PSB1bmRlZmluZWQpIHRoaXMuZ2VuVG9wb2xvZ3lJbmZvKCkKICAgICAgICAKICAgICAgICAgICAgICBsZXQgY291bnQgPSAwCiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGZhY2UgaW5kZXhpbmcgZG9lc24ndCBzdGFydCBhdCAwLCB0aGVuIHRoZSB2ZXJ0ZXhFZGdlcyBkb24ndCBlaXRoZXIuCiAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJ0ZXhFZGdlc1tpXSkgY291bnQgKz0gdGhpcy52ZXJ0ZXhFZGdlc1tpXS5zaXplCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIFRoZSBhcnJheSB3aWxsIGJlIHN0cnVjdHVyZWQgYXMgYSBzdGFydCtvZmZzZXQgZm9yIGVhY2ggdmVydGV4LCBmb2xsb3dlZAogICAgICAgICAgICAgIC8vIGJ5IGEgMmQgYXJyYXkgb2YgbmVpZ2hib3IgaW5kaWNlcy4KICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXhOZWlnaGJvcnMgPSBuZXcgVWludDMyQXJyYXkodGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGggKiAyICsgY291bnQpCiAgICAgICAgICAgICAgY29uc3Qgc29ydEZhbkVkZ2VzID0gKGZhbkVkZ2VzOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFuRWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZmVBID0gZmFuRWRnZXNbaV0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmZUIgPSBmYW5FZGdlc1tqXQogICAgICAgICAgICAgICAgICAgIGlmIChmZUFbMF0gIT0gLTEgJiYgZmVBWzBdID09IGZlQlsxXSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gIG1vdmUgZmVBIGFmdGVyIGZlQjsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpICE9IGogKyAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkVkZ2VzLnNwbGljZShpLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmYW5FZGdlcy5zcGxpY2UoaiArIDEsIDAsIGZlQSkKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChmZUFbMV0gIT0gLTEgJiYgZmVBWzFdID09IGZlQlswXSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gIG1vdmUgZmVBIGJlZm9yZSBmZUI7CiAgICAgICAgICAgICAgICAgICAgICBmYW5FZGdlcy5zcGxpY2UoaSwgMSkKICAgICAgICAgICAgICAgICAgICAgIGZhbkVkZ2VzLnNwbGljZShqLCAwLCBmZUEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBjaGVja0ZhbkVkZ2VzID0gKGZhbkVkZ2VzOiBhbnkpID0+IHsKICAgICAgICAgICAgICAgIC8vIG5vdyBjaGVjayB0aGF0IHRoZSBmYWNlcyBhbGwgYnVpbGQgYSBmYW4uIE1heWJlIHN0YXJ0aW5nIGFuZCBlbmRpbmcgd2l0aCAtMQogICAgICAgICAgICAgICAgaWYgKGZhbkVkZ2VzWzBdWzBdID09IC0xIHx8IGZhbkVkZ2VzW2ZhbkVkZ2VzLmxlbmd0aCAtIDFdWzFdID09IC0xKSB7CiAgICAgICAgICAgICAgICAgIGlmIChmYW5FZGdlc1swXVswXSAhPSAtMSB8fCBmYW5FZGdlc1tmYW5FZGdlcy5sZW5ndGggLSAxXVsxXSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSWYgZmFuIHN0YXJ0cyB3aXRoIC0xLCBpdCBtdXN0IGFsc28gZW5kIHdpdGggLTEnKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZhbkVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGZlID0gZmFuRWRnZXNbaV0KICAgICAgICAgICAgICAgICAgaWYgKGZlWzBdID09IC0xIHx8IGZlWzFdID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgIT0gMCAmJiBpICE9IGZhbkVkZ2VzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignLTEgb25seSBhbGxvd2VkIGF0IHRoZSBiZWdpbm5pbmcgYW5kIGVuZCBvZiBhIGZhbi4nKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZmVbMF0gIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcHJldiA9IGkgLSAxCiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXYgPCAwKSBwcmV2ICs9IGZhbkVkZ2VzLmxlbmd0aAogICAgICAgICAgICAgICAgICAgIGlmIChmZVswXSAhPSBmYW5FZGdlc1twcmV2XVsxXSkgewogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWNlcyBhcmUgbm90IHNlcXVlbnRpYWwnKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZmVbMV0gIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gKGkgKyAxKSAlIGZhbkVkZ2VzLmxlbmd0aAogICAgICAgICAgICAgICAgICAgIGlmIChmZVsxXSAhPSBmYW5FZGdlc1tuZXh0XVswXSkgewogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWNlcyBhcmUgbm90IHNlcXVlbnRpYWwnKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgICAvLyBQb3B1bGF0ZSB0aGUgc3RhcnQgYW5kIG9mZnNldCB2YWx1ZXMuCiAgICAgICAgICAgICAgbGV0IG9mZnNldCA9IHRoaXMudmVydGV4RWRnZXMubGVuZ3RoICogMgogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudmVydGV4RWRnZXNbaV0gPT0gdW5kZWZpbmVkKSBjb250aW51ZQogICAgICAgICAgICAgICAgY29uc3QgZWRnZXMgPSB0aGlzLnZlcnRleEVkZ2VzW2ldCiAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBCdWlsZCBhIHNvcnRlZCBsaXN0IG9mIGZhY2VzIGJhc2VkIG9uIGEgZmFuIGFyb3VuZAogICAgICAgICAgICAgICAgLy8gdGhlIHZlcnRleC4KICAgICAgICAgICAgICAgIGNvbnN0IGZhbkVkZ2VzID0gW10KICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBlZGdlcykgewogICAgICAgICAgICAgICAgICBjb25zdCB2MCA9IHRoaXMuZWRnZVZlcnRzW2UgKiAyXQogICAgICAgICAgICAgICAgICBjb25zdCB2MSA9IHRoaXMuZWRnZVZlcnRzW2UgKiAyICsgMV0KICAgICAgICAgICAgICAgICAgbGV0IGYwID0gdGhpcy5lZGdlRmFjZXNbZSAqIDJdCiAgICAgICAgICAgICAgICAgIGxldCBmMSA9IHRoaXMuZWRnZUZhY2VzW2UgKiAyICsgMV0KICAgICAgICAgICAgICAgICAgbGV0IG5laWdWZXJ0CiAgICAgICAgICAgICAgICAgIGlmICh2MCA9PSBpKSB7CiAgICAgICAgICAgICAgICAgICAgbmVpZ1ZlcnQgPSB2MQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHYxID09IGkpIHsKICAgICAgICAgICAgICAgICAgICBuZWlnVmVydCA9IHYwCiAgICAgICAgICAgICAgICAgICAgLy8gc3dhcCB0aGUgZmFjZXMKICAgICAgICAgICAgICAgICAgICBjb25zdCB0bXAgPSBmMAogICAgICAgICAgICAgICAgICAgIGYwID0gZjEKICAgICAgICAgICAgICAgICAgICBmMSA9IHRtcAogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b3BvbG9neScpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZmFuRWRnZXMucHVzaChbZjAsIGYxLCBuZWlnVmVydF0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzb3J0RmFuRWRnZXMoZmFuRWRnZXMpCiAgICAgICAgICAgICAgICBjaGVja0ZhbkVkZ2VzKGZhbkVkZ2VzKQogICAgICAgICAgICAgICAgY29uc3QgY2xvc2VkID0gZmFuRWRnZXNbMF1bMF0gIT0gLTEgfHwgZmFuRWRnZXNbZmFuRWRnZXMubGVuZ3RoIC0gMV1bMV0gIT0gLTEKICAgICAgICAgICAgICAgIGxldCBmbGFncyA9IDAKICAgICAgICAgICAgICAgIGlmIChjbG9zZWQpIGZsYWdzICs9IDEKICAgICAgICAgICAgICAgIHZlcnRleE5laWdoYm9yc1tpICogMl0gPSBvZmZzZXQKICAgICAgICAgICAgICAgIHZlcnRleE5laWdoYm9yc1tpICogMiArIDFdID0gZWRnZXMuc2l6ZSArIChmbGFncyA8PCA4KQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmZSBvZiBmYW5FZGdlcykgewogICAgICAgICAgICAgICAgICB2ZXJ0ZXhOZWlnaGJvcnNbb2Zmc2V0XSA9IGZlWzJdCiAgICAgICAgICAgICAgICAgIG9mZnNldCsrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDsocmVzdWx0IGFzIGFueSkudmVydGV4TmVpZ2hib3JzID0gdmVydGV4TmVpZ2hib3JzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgKi8KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcHV0ZSB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcy4gRm9yIGhpZ2hlciBkZWdyZWUgcG9seWdvbnMsIHRoZXkgYXJlIGRpdmlkZWQgaW50byBtdWx0aXBsZSB0cmlhbmdsZXMgZm9yIHJlbmRlcmluZy4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcy4KICAgICAgICAgKi8KICAgICAgICBjb21wdXRlTnVtVHJpYW5nbGVzKCkgewogICAgICAgICAgICBsZXQgbnVtVmVydHNQZXJGYWNlID0gMzsKICAgICAgICAgICAgbGV0IHRyaXNDb3VudCA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZmMgb2YgdGhpcy5mYWNlQ291bnRzKSB7CiAgICAgICAgICAgICAgICB0cmlzQ291bnQgKz0gZmMgKiAobnVtVmVydHNQZXJGYWNlIC0gMik7CiAgICAgICAgICAgICAgICBudW1WZXJ0c1BlckZhY2UrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJpc0NvdW50OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUbyBwcmVwYXJlIGRhdGEgZm9yIHJlbmRlcmluZywgdGhlIGluZGljZXMgZm9yIHRoZSBwb2x5Z29ucyBpcyB1c2VkIHRvIGNvbXB1dGUgYSBuZXcgaW5kZXggYnVmZmVyIGJhc2VkIG9uCiAgICAgICAgICogb25seSB0cmlhbmdsZXMuIFRoaXMgaXMgdXNlZCBkdXJpbmcgcmVuZGVyaW5nIGFuZCB0aGUgcmVzdWx0aW5nIGluZGljZXMgdXBsb2FkZWQgb3QgdGhlIEdQVSAgYnkgR0xNZXNoIGNsYXNzLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHRvdGFsTnVtVmVydGljZXMgLSBUaGUgdG90YWwgbnVtYmVyIG9mIHZlcnRpY2VzLgogICAgICAgICAqIEBwYXJhbSBudW1VblNwbGl0VmVydGljZXMgLSBUaGUgdG90YWwgbnVtYmVyIG9mIHVuLXNwbGl0IHZlcnRpY2VzLgogICAgICAgICAqIEBwYXJhbSBzcGxpdEluZGljZXMgLSBUaGUgc3BsaXRJbmRpY2VzIHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgdHlwZWQgYXJyYXkgY29udGFpbmluZyB0aGUgdHJpYW5ndWxhdGVkIGluZGljZXMuCiAgICAgICAgICovCiAgICAgICAgZ2VuZXJhdGVUcmlhbmd1bGF0ZWRJbmRpY2VzKHRvdGFsTnVtVmVydGljZXMsIG51bVVuU3BsaXRWZXJ0aWNlcywgc3BsaXRJbmRpY2VzKSB7CiAgICAgICAgICAgIGNvbnN0IHRyaXNDb3VudCA9IHRoaXMuY29tcHV0ZU51bVRyaWFuZ2xlcygpOwogICAgICAgICAgICBsZXQgdHJpYW5ndWxhdGVkSW5kaWNlczsKICAgICAgICAgICAgaWYgKHRvdGFsTnVtVmVydGljZXMgPCBNYXRoLnBvdygyLCA4KSkKICAgICAgICAgICAgICAgIHRyaWFuZ3VsYXRlZEluZGljZXMgPSBuZXcgVWludDhBcnJheSh0cmlzQ291bnQgKiAzKTsKICAgICAgICAgICAgZWxzZSBpZiAodG90YWxOdW1WZXJ0aWNlcyA8IE1hdGgucG93KDIsIDE2KSkKICAgICAgICAgICAgICAgIHRyaWFuZ3VsYXRlZEluZGljZXMgPSBuZXcgVWludDE2QXJyYXkodHJpc0NvdW50ICogMyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRyaWFuZ3VsYXRlZEluZGljZXMgPSBuZXcgVWludDMyQXJyYXkodHJpc0NvdW50ICogMyk7CiAgICAgICAgICAgIGxldCB0cmlhbmdsZVZlcnRleCA9IDA7CiAgICAgICAgICAgIGNvbnN0IGFkZFRyaWFuZ2xlVmVydGV4SW5kZXggPSBmdW5jdGlvbiAodmVydGV4LCBmYWNlSW5kZXgpIHsKICAgICAgICAgICAgICAgIGlmICh2ZXJ0ZXggaW4gc3BsaXRJbmRpY2VzICYmIGZhY2VJbmRleCBpbiBzcGxpdEluZGljZXNbdmVydGV4XSkKICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXggPSBudW1VblNwbGl0VmVydGljZXMgKyBzcGxpdEluZGljZXNbdmVydGV4XVtmYWNlSW5kZXhdOwogICAgICAgICAgICAgICAgdHJpYW5ndWxhdGVkSW5kaWNlc1t0cmlhbmdsZVZlcnRleF0gPSB2ZXJ0ZXg7CiAgICAgICAgICAgICAgICB0cmlhbmdsZVZlcnRleCsrOwogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBudW1GYWNlcyA9IHRoaXMuZ2V0TnVtRmFjZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgZmFjZUluZGV4ID0gMDsgZmFjZUluZGV4IDwgbnVtRmFjZXM7IGZhY2VJbmRleCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSB0aGlzLmdldEZhY2VWZXJ0ZXhJbmRpY2VzKGZhY2VJbmRleCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGZhY2VWZXJ0cy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmIChqID49IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggYWRkaXRpb25hbCB0cmlhbmdsZSwgd2UgaGF2ZSB0byBhZGQgMiBpbmRpY2VzLgogICAgICAgICAgICAgICAgICAgICAgICBhZGRUcmlhbmdsZVZlcnRleEluZGV4KGZhY2VWZXJ0c1swXSwgZmFjZUluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVHJpYW5nbGVWZXJ0ZXhJbmRleChmYWNlVmVydHNbaiAtIDFdLCBmYWNlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhZGRUcmlhbmdsZVZlcnRleEluZGV4KGZhY2VWZXJ0c1tqXSwgZmFjZUluZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJpYW5ndWxhdGVkSW5kaWNlczsKICAgICAgICB9CiAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgIC8vIFBlcnNpc3RlbmNlCiAgICAgICAgLyoqCiAgICAgICAgICogUmVzdG9yZXMgbWVzaCBwcm9wZXJ0aWVzIGZyb20gYSBiaW5hcnkgcmVhZGVyLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJlYWRlciAtIFRoZSByZWFkZXIgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlciwgY29udGV4dCkgewogICAgICAgICAgICBzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkocmVhZGVyLCBjb250ZXh0KTsKICAgICAgICAgICAgdGhpcy5zZXRGYWNlQ291bnRzKEFycmF5LmZyb20ocmVhZGVyLmxvYWRVSW50MzJBcnJheSgpKSk7CiAgICAgICAgICAgIGNvbnN0IG51bUZhY2VzID0gdGhpcy5nZXROdW1GYWNlcygpOwogICAgICAgICAgICAvLyBOb3RlOiB3ZSBjYW4gcmVtb3ZlIHRoaXMuIFdlIGNhbiBpbmZlciB0aGlzIGZyb20gdGhlIGFib3ZlIGZhY2VDb3VudHMgYXJyYXkuCiAgICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0ZXhDb3VudHMgPSByZWFkZXIubG9hZFVJbnQ4QXJyYXkobnVtRmFjZXMpOwogICAgICAgICAgICBjb25zdCBvZmZzZXRSYW5nZSA9IHJlYWRlci5sb2FkU0ludDMyVmVjMigpOwogICAgICAgICAgICBjb25zdCBieXRlcyA9IHJlYWRlci5sb2FkVUludDgoKTsKICAgICAgICAgICAgbGV0IGZhY2VWZXJ0ZXhJbmRleERlbHRhczsKICAgICAgICAgICAgaWYgKGJ5dGVzID09IDEpCiAgICAgICAgICAgICAgICBmYWNlVmVydGV4SW5kZXhEZWx0YXMgPSByZWFkZXIubG9hZFVJbnQ4QXJyYXkoKTsKICAgICAgICAgICAgZWxzZSBpZiAoYnl0ZXMgPT0gMikKICAgICAgICAgICAgICAgIGZhY2VWZXJ0ZXhJbmRleERlbHRhcyA9IHJlYWRlci5sb2FkVUludDE2QXJyYXkoKTsKICAgICAgICAgICAgZWxzZSBpZiAoYnl0ZXMgPT0gNCkKICAgICAgICAgICAgICAgIGZhY2VWZXJ0ZXhJbmRleERlbHRhcyA9IHJlYWRlci5sb2FkVUludDMyQXJyYXkoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignZmFjZVZlcnRleEluZGV4RGVsdGFzIHVuZGVmaW5lZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgICAvLyBOb3RlOiBUaGUgTWVzaCBjb21wcmVzc2lvbiBzeXN0ZW0gbmVlZHMgYSB0aG9yb3VnaCByZXZpZXcuCiAgICAgICAgICAgIC8vIFRoZSBDKysgY2xhc3NlcyBhcmUgbm90IHN0b3JpbmcgZmFjZSBpbmRpY2VzIGluIGEgc29ydGVkIG1hbm5lci4KICAgICAgICAgICAgLy8gU28gcXVhZHMgcHJlY2VkZSB0cmlhbmdsZXMgaW4gdGhlIGluZGV4aW5nLCB3aGljaCBpc24ndCBzdXBwb3NlZCB0byBoYXBwZW4uCiAgICAgICAgICAgIC8vIFdlIHNob3VsZCBmb3JjZSB0aGUgQysrIGNvZGUgdG8gc3RvcmUgcXVhZHMgYW5kIHRyaWFuZ2xlcyBpbiBvcmRlci4KICAgICAgICAgICAgLy8gZS5nLiBpbXBsZW1lbnQgdGhlICdhZGRGYWNlJyBtZXRob2QgaW4gQysrIHNvIGl0IGF1dG9tYXRpY2FsbHkgZG9lcyB0aGlzLgogICAgICAgICAgICBsZXQgbnVtRmFjZVZlcnRzID0gMzsKICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgICAgIGNvbnN0IGZhY2VPZmZzZXRzQnlDb3VudCA9IHRoaXMuZmFjZUNvdW50cy5tYXAoKGZjLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gb2Zmc2V0OwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IGZjICogbnVtRmFjZVZlcnRzOwogICAgICAgICAgICAgICAgbnVtRmFjZVZlcnRzKys7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHNyY09mZnNldCA9IDA7CiAgICAgICAgICAgIGxldCBwcmV2Q291bnQgPSAwOwogICAgICAgICAgICBjb25zdCBmYWNlT2Zmc2V0cyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBmYWNlSW5kZXggPSAwOyBmYWNlSW5kZXggPCBudW1GYWNlczsgZmFjZUluZGV4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZjID0gZmFjZVZlcnRleENvdW50c1tmYWNlSW5kZXhdOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZmFjZU9mZnNldHNCeUNvdW50W2ZjXTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gZmMgKyAzOwogICAgICAgICAgICAgICAgZmFjZU9mZnNldHNbZmFjZUluZGV4XSA9IG9mZnNldDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY291bnQ7IGorKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY0ZhY2VWZXJ0ZXggPSBzcmNPZmZzZXQgKyBqOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0ZXggPSBvZmZzZXQgKyBqOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZmFjZVZlcnRleEluZGV4RGVsdGFzW3NyY0ZhY2VWZXJ0ZXhdICsgb2Zmc2V0UmFuZ2UueDsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFjZUluZGV4ID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tmYWNlVmVydGV4XSA9IGRlbHRhOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJldkZhY2VWZXJ0ZXggPSBmYWNlT2Zmc2V0c1tmYWNlSW5kZXggLSAxXTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldkZhY2VWZXJ0ZXggKz0gaiA8IHByZXZDb3VudCA/IGogOiBwcmV2Q291bnQgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbZmFjZVZlcnRleF0gPSB0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbcHJldkZhY2VWZXJ0ZXhdICsgZGVsdGE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3JjT2Zmc2V0ICs9IGNvdW50OwogICAgICAgICAgICAgICAgZmFjZU9mZnNldHNCeUNvdW50W2ZjXSArPSBjb3VudDsKICAgICAgICAgICAgICAgIHByZXZDb3VudCA9IGNvdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNWZXJ0ZXhBdHRyaWJ1dGUoJ25vcm1hbHMnKSkgewogICAgICAgICAgICAgICAgdGhpcy5jb21wdXRlVmVydGV4Tm9ybWFscygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKICAgICAgICAgICAgdGhpcy5lbWl0KCdnZW9tRGF0YUNoYW5nZWQnKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIHRvSlNPTiBtZXRob2QgZW5jb2RlcyB0aGlzIHR5cGUgYXMgYSBqc29uIG9iamVjdCBmb3IgcGVyc2lzdGVuY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIHRoZSBqc29uIG9iamVjdC4KICAgICAgICAgKi8KICAgICAgICB0b0pTT04oY29udGV4dCkgewogICAgICAgICAgICBjb25zdCBqID0gc3VwZXIudG9KU09OKGNvbnRleHQpOwogICAgICAgICAgICBpZiAoIWNvbnRleHQgfHwgIWNvbnRleHQuc2tpcFRvcG9sb2d5KSB7CiAgICAgICAgICAgICAgICBqLmZhY2VDb3VudHMgPSBBcnJheS5mcm9tKHRoaXMuZmFjZUNvdW50cyk7CiAgICAgICAgICAgICAgICBqLmZhY2VWZXJ0ZXhJbmRpY2VzID0gQXJyYXkuZnJvbSh0aGlzLl9fZmFjZVZlcnRleEluZGljZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBqOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBUaGUgZnJvbUpTT04gbWV0aG9kIGRlY29kZXMgYSBqc29uIG9iamVjdCBmb3IgdGhpcyB0eXBlLgogICAgICAgICAqCiAgICAgICAgICogZS5nLiB0byBsb2FkIGRhdGEgaW50byB0aGUgbWVzaCBjbGFzcywgcHJvdmlkZSBhIGpzb24gc3RydWN0dXJlIHNpbWlsYXIgdG8gdGhlIGZvbGxvd2luZy4KICAgICAgICAgKiBOb3RlOiBmYWNlQ291bnRzIGlzIGFuIGFycmF5IG9mIGNvdW50IHZhbHVlcywgc3RhcnRpbmcgd2l0aCB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcywgdGhlbiB0aGUgbnVtYmVyIG9mIHF1YWRzLiBTZWUgI3NldEZhY2VDb3VudHMKICAgICAgICAgKiBUaGUgZmFjZVZlcnRleEluZGljZXMgYXJyYXkgc2hvdWxkIGFsc28gYmUgc29ydGVkIHRvIGNvbnRhaW4gYWxsIHRoZSB0cmlhbmdsZXMgZmlyc3QsIGZvbGxvd2VkIGJ5IHRoZSBxdWFkcywgYW5kIHRoZW4gdGhlIHBlbnRhZ29ucyBldGMuLgogICAgICAgICAqIGBgYGpzb24KICAgICAgICAgKiAvLyBUaGlzIGNvZGUgd2lsbCBkZWZpbmUgYSBtZXNoIG1hZGUgdXAgb2YgMiB0cmlhbmdsZXMgYW5kIHRoZW4gYSBxdWFkLgogICAgICAgICAqIGNvbnN0IG1lc2ggPSBuZXcgTWVzaCgpCiAgICAgICAgICogbWVzaC5mcm9tSlNPTih7CiAgICAgICAgICogICBmYWNlQ291bnRzOlsyLCAxXSwKICAgICAgICAgKiAgIGZhY2VWZXJ0ZXhJbmRpY2VzOiBbMCwgMSwgMiwgMCwgMiwgMywgMywgMiwgNCwgNV0sCiAgICAgICAgICogICBudW1WZXJ0aWNlczogNiwKICAgICAgICAgKiAgIHZlcnRleEF0dHJpYnV0ZXM6IHsKICAgICAgICAgKiAgICAgcG9zaXRpb25zOiB7CiAgICAgICAgICogICAgICAgZGF0YVR5cGU6ICdWZWMzJwogICAgICAgICAqICAgICAgIGRlZmF1bHRTY2FsYXJWYWx1ZTogMC4wLAogICAgICAgICAqICAgICAgIGRhdGE6IFswLDAsMCwgMCwgMSwgMCwgMSwgMSwgMCwgMSwgMCwgMCwgMiwgMSwgMCwgMiwgMCwgMF0KICAgICAgICAgKiAgICAgfQogICAgICAgICAqICAgfQogICAgICAgICAqIH0KICAgICAgICAgKiBgYGAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqIC0gVGhlIGpzb24gb2JqZWN0IHRoaXMgaXRlbSBtdXN0IGRlY29kZS4KICAgICAgICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0IHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGZyb21KU09OKGosIGNvbnRleHQpIHsKICAgICAgICAgICAgc3VwZXIuZnJvbUpTT04oaiwgY29udGV4dCk7CiAgICAgICAgICAgIGlmIChqLmZhY2VDb3VudHMpCiAgICAgICAgICAgICAgICB0aGlzLmZhY2VDb3VudHMgPSBqLmZhY2VDb3VudHM7CiAgICAgICAgICAgIGlmIChqLmZhY2VWZXJ0ZXhJbmRpY2VzKQogICAgICAgICAgICAgICAgdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzID0gVWludDMyQXJyYXkuZnJvbShqLmZhY2VWZXJ0ZXhJbmRpY2VzKTsKICAgICAgICB9CiAgICB9CiAgICBSZWdpc3RyeS5yZWdpc3RlcignTWVzaCcsIE1lc2gpOwoKICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovCiAgICAvKioKICAgICAqIFJlYWRzIGJpbmFyeSBkYXRhIGluIGEgc3BlY2lmaWMgZW5jb2RpbmcuIFVzZWQgaW4gbG9hZGluZyBiaW5hcnkgZGF0YSBzdWNoIGFzIHpjYWQgZmlsZXMuCiAgICAgKi8KICAgIGNsYXNzIEJpblJlYWRlciB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlIGEgYmluIHJlYWRlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBkYXRhIC0gVGhlIGRhdGEgYnVmZmVyLgogICAgICAgICAqIEBwYXJhbSBieXRlT2Zmc2V0IC0gVGhlIGJ5dGUgb2Zmc2V0IHZhbHVlIHRvIHN0YXJ0IHJlYWRpbmcgdGhlIGJ1ZmZlci4KICAgICAgICAgKiBAcGFyYW0gaXNNb2JpbGVEZXZpY2UgLSBUaGUgaXNNb2JpbGVEZXZpY2UgdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgY29uc3RydWN0b3IoZGF0YSwgYnl0ZU9mZnNldCA9IDAsIGlzTW9iaWxlRGV2aWNlID0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLl9fZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIHRoaXMuX19ieXRlT2Zmc2V0ID0gYnl0ZU9mZnNldDsKICAgICAgICAgICAgdGhpcy5fX2RhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuX19kYXRhKTsKICAgICAgICAgICAgdGhpcy5fX2lzTW9iaWxlRGV2aWNlID0gaXNNb2JpbGVEZXZpY2U7CiAgICAgICAgICAgIHRoaXMudXRmOGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBzdGF0ZSBvZiB3aGV0aGVyIG9yIG5vdCB0aGUgYEJpblJlYWRlcmAgb2JqZWN0IHdhcyBpbnN0YW50aWF0ZWQgZnJvbSBhIG1vYmlsZSBkZXZpY2UuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyB0cnVlIGlzIGEgbW9iaWxlIGRldmljZSBpcyBkZXRlY3RlZC4KICAgICAgICAgKi8KICAgICAgICBnZXQgaXNNb2JpbGVEZXZpY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9faXNNb2JpbGVEZXZpY2U7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIGRhdGEgYnVmZmVyIHdlJ3JlIHJlYWRpbmcgZnJvbS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgZGF0YSBidWZmZXIgd2UgYXJlIHJlYWRpbmcgZnJvbSwKICAgICAgICAgKi8KICAgICAgICBnZXQgZGF0YSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIGJ1ZmZlci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgdG90YWwgbGVuZ3RoIG9mIHRoZSBidWZmZXIKICAgICAgICAgKi8KICAgICAgICBnZXQgYnl0ZUxlbmd0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhVmlldy5ieXRlTGVuZ3RoOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHJlbWFpbmluZyBsZW5ndGggb2YgdGhlIGJ1ZmZlciB0byByZWFkLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZW1haW5pbmcgbGVuZ3RoIG9mIHRoZSBidWZmZXIgdG8gcmVhZC4KICAgICAgICAgKi8KICAgICAgICBnZXQgcmVtYWluaW5nQnl0ZUxlbmd0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19kYXRhVmlldy5ieXRlTGVuZ3RoIC0gdGhpcy5fX2J5dGVPZmZzZXQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgY3VycmVudCBieXRlIG9mZnNldCBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgY3VycmVudCBvZmZzZXQgaW4gdGhlIGJpbmFyeSBidWZmZXIKICAgICAgICAgKi8KICAgICAgICBwb3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fYnl0ZU9mZnNldDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgYnl0ZSBvZmZzZXQgdmFsdWUuCiAgICAgICAgICogQHBhcmFtIGJ5dGVPZmZzZXQgLSBUaGUgYnl0ZU9mZnNldCBwYXJhbS4KICAgICAgICAgKi8KICAgICAgICBzZWVrKGJ5dGVPZmZzZXQpIHsKICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBBZGRzIG9mZnNldCBieXRlcyB0byBjdXJyZW50IG9mZnNldCB2YWx1ZS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBieXRlT2Zmc2V0IC0gVGhlIGJ5dGUgT2Zmc2V0IGFtb3VudC4KICAgICAgICAgKi8KICAgICAgICBhZHZhbmNlKGJ5dGVPZmZzZXQpIHsKICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gYnl0ZU9mZnNldDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgdW5zaWduZWQgVWludDggdmFsdWUgYXQgY3VycmVudCBieXRlIG9mZnNldCBwb3NpdGlvbiwKICAgICAgICAgKiBhbmQgYWRkcyBvbmUgYnl0ZSB0byB0aGUgb2Zmc2V0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbG9hZFVJbnQ4KCkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9fZGF0YVZpZXcuZ2V0VWludDgodGhpcy5fX2J5dGVPZmZzZXQpOwogICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSAxOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSB1bnNpZ25lZCBVaW50MTYgdmFsdWUgYXQgY3VycmVudCBieXRlIG9mZnNldCBwb3NpdGlvbiwKICAgICAgICAgKiBhbmQgYWRkcyB0d28gYnl0ZXMgdG8gdGhlIG9mZnNldC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRVSW50MTYoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX19kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fX2J5dGVPZmZzZXQsIHRydWUpOwogICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSAyOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSB1bnNpZ25lZCBVaW50MzIgdmFsdWUgYXQgY3VycmVudCBieXRlIG9mZnNldCBwb3NpdGlvbiwKICAgICAgICAgKiBhbmQgYWRkcyBmb3VyIGJ5dGVzIHRvIHRoZSBvZmZzZXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkVUludDMyKCkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9fZGF0YVZpZXcuZ2V0VWludDMyKHRoaXMuX19ieXRlT2Zmc2V0LCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgc2lnbmVkIEludDMyIHZhbHVlIGF0IGN1cnJlbnQgYnl0ZSBvZmZzZXQgcG9zaXRpb24sCiAgICAgICAgICogYW5kIGFkZHMgZm91ciBieXRlcyB0byB0aGUgb2Zmc2V0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbG9hZFNJbnQzMigpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fX2RhdGFWaWV3LmdldEludDMyKHRoaXMuX19ieXRlT2Zmc2V0LCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0aGUgRmxvYXQxNiB2YWx1ZSBhdCBjdXJyZW50IGJ5dGUgb2Zmc2V0IHBvc2l0aW9uLAogICAgICAgICAqIGFuZCBhZGRzIGZvdXIgYnl0ZXMgdG8gdGhlIG9mZnNldC4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRGbG9hdDE2KCkgewogICAgICAgICAgICBjb25zdCB1aW50MTYgPSB0aGlzLmxvYWRVSW50MTYoKTsKICAgICAgICAgICAgcmV0dXJuIE1hdGhGdW5jdGlvbnMuZGVjb2RlMTZCaXRGbG9hdCh1aW50MTYpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIHRoZSBGbG9hdDE2IHZhbHVlIGF0IGN1cnJlbnQgYnl0ZSBvZmZzZXQgcG9zaXRpb24sCiAgICAgICAgICogYW5kIGFkZHMgdHdvIGJ5dGVzIHRvIHRoZSBvZmZzZXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkVUZsb2F0MTYoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMubG9hZEZsb2F0MTYoKTsKICAgICAgICAgICAgaWYgKHJlc3VsdCA8IDAuMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDIwNDguMCAtIHJlc3VsdDsgLy8gTm90ZTogc3VidHJhY3QgYSBuZWdhdGl2ZSBudW1iZXIgdG8gYWRkIGl0LgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm5zIGEgc2luZ2xlIHNpZ25lZCBGbG9hdDE2IHZhbHVlIGF0IGN1cnJlbnQgYnl0ZSBvZmZzZXQgcG9zaXRpb24gZnJvbSAyIHVuc2lnbmVkIEludDggdmFsdWVzLAogICAgICAgICAqIGFuZCBhZGRzIHR3byBieXRlcyB0byB0aGUgb2Zmc2V0LgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbG9hZEZsb2F0MTZGcm9tMnhVSW50OCgpIHsKICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ2xvYWRGbG9hdDE2RnJvbTJ4VUludDggbm90IGltcGxlbWVudGVkIScpOwogICAgICAgICAgICAvLyBjb25zdCByZXN1bHQgPSB0aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQxNih0aGlzLl9fYnl0ZU9mZnNldCwgdHJ1ZSkKICAgICAgICAgICAgLy8gY29uc3QgdWludDhzID0gdGhpcy5sb2FkVUludDhBcnJheSgyKTsKICAgICAgICAgICAgLy8gcmV0dXJuIE1hdGguZGVjb2RlMTZCaXRGbG9hdCh1aW50OHMpOwogICAgICAgICAgICAvLyB0aGlzLl9fYnl0ZU9mZnNldCArPSAyCiAgICAgICAgICAgIC8vIHJldHVybiByZXN1bHQKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTG9hZHMgYW5kIHJldHVybnMgYSBzaW5nbGUgU2lnbmVkIGludGVnZXIgdmFsdWUgZnJvbSAyIFVuc2lnbmVkIEZsb2F0MTYgdmFsdWVzLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRVSW50MzJGcm9tMnhVRmxvYXQxNigpIHsKICAgICAgICAgICAgY29uc3QgcGFydEEgPSB0aGlzLmxvYWRVRmxvYXQxNigpOwogICAgICAgICAgICBjb25zdCBwYXJ0QiA9IHRoaXMubG9hZFVGbG9hdDE2KCk7CiAgICAgICAgICAgIHJldHVybiBwYXJ0QSArIHBhcnRCICogNDA5NjsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogTG9hZHMgYW5kIHJldHVybnMgYSBzaW5nbGUgU2lnbmVkIGludGVnZXIgdmFsdWUgZnJvbSAyIHNpZ25lZCBGbG9hdDE2IHZhbHVlcy4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkU0ludDMyRnJvbTJ4RmxvYXQxNigpIHsKICAgICAgICAgICAgY29uc3QgcGFydEEgPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHBhcnRCID0gdGhpcy5sb2FkRmxvYXQxNigpOwogICAgICAgICAgICByZXR1cm4gcGFydEEgKyBwYXJ0QiAqIDIwNDg7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdGhlIEZsb2F0MzIgdmFsdWUgYXQgY3VycmVudCBieXRlIG9mZnNldCBwb3NpdGlvbiwKICAgICAgICAgKiBhbmQgYWRkcyBmb3VyIGJ5dGVzIHRvIHRoZSBvZmZzZXQuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkRmxvYXQzMigpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fX2RhdGFWaWV3LmdldEZsb2F0MzIodGhpcy5fX2J5dGVPZmZzZXQsIHRydWUpOwogICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSA0OwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZWFkcyBidWZmZXIgYW5kIHJldHVybiBhbiB1bnNpZ25lZCBJbnQ4IGFycmF5IHdpdGggdGhlIHNwZWNpZmllZCBzaXplLAogICAgICAgICAqIHN0YXJ0aW5nIGZyb20gY3VycmVudCBieXRlIG9mZnNldC4KICAgICAgICAgKiBCeXRlIG9mZnNldCBpcyBpbmNyZWFzZWQgYnkgdGhlIHNwZWNpZmllZCBieXRlIHNpemUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2l6ZSAtIFRoZSBzaXplIHBhcmFtLgogICAgICAgICAqIEBwYXJhbSBjbG9uZSAtIFRoZSBjbG9uZSBwYXJhbS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkVUludDhBcnJheShzaXplLCBjbG9uZSA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmIChzaXplID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgIHNpemUgPSB0aGlzLmxvYWRVSW50MzIoKTsKICAgICAgICAgICAgbGV0IHJlc3VsdDsKICAgICAgICAgICAgaWYgKGNsb25lKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgVWludDhBcnJheSh0aGlzLl9fZGF0YS5zbGljZSh0aGlzLl9fYnl0ZU9mZnNldCwgdGhpcy5fX2J5dGVPZmZzZXQgKyBzaXplKSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPSBzaXplKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdicm9rZW4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KHRoaXMuX19kYXRhLCB0aGlzLl9fYnl0ZU9mZnNldCwgc2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmVhZHMgYnVmZmVyIGFuZCByZXR1cm4gYW4gdW5zaWduZWQgSW50MTYgYXJyYXkgd2l0aCB0aGUgc3BlY2lmaWVkIHNpemUsCiAgICAgICAgICogc3RhcnRpbmcgZnJvbSBjdXJyZW50IGJ5dGUgb2Zmc2V0LgogICAgICAgICAqIEJ5dGUgb2Zmc2V0IGlzIGluY3JlYXNlZCBieSB0aGUgc3BlY2lmaWVkIGJ5dGUgc2l6ZSB4IDIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2l6ZSAtIFRoZSBzaXplIHBhcmFtLgogICAgICAgICAqIEBwYXJhbSBjbG9uZSAtIFRoZSBjbG9uZSBwYXJhbS4KICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkVUludDE2QXJyYXkoc2l6ZSwgY2xvbmUgPSBmYWxzZSkgewogICAgICAgICAgICBpZiAoc2l6ZSA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICBzaXplID0gdGhpcy5sb2FkVUludDMyKCk7CiAgICAgICAgICAgIGlmIChzaXplID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQxNkFycmF5KCk7CiAgICAgICAgICAgIHRoaXMucmVhZFBhZCgyKTsKICAgICAgICAgICAgbGV0IHJlc3VsdDsKICAgICAgICAgICAgaWYgKHRoaXMuX19pc01vYmlsZURldmljZSkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFVpbnQxNkFycmF5KHNpemUpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbaV0gPSB0aGlzLl9fZGF0YVZpZXcuZ2V0VWludDE2KHRoaXMuX19ieXRlT2Zmc2V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGNsb25lKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX19kYXRhLnNsaWNlKHRoaXMuX19ieXRlT2Zmc2V0LCB0aGlzLl9fYnl0ZU9mZnNldCArIHNpemUgKiAyKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggIT0gc2l6ZSkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Jyb2tlbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX19kYXRhLCB0aGlzLl9fYnl0ZU9mZnNldCwgc2l6ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSBzaXplICogMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBSZWFkcyBidWZmZXIgYW5kIHJldHVybiBhbiB1bnNpZ25lZCBJbnQzMiBhcnJheSB3aXRoIHRoZSBzcGVjaWZpZWQgc2l6ZSwKICAgICAgICAgKiBzdGFydGluZyBmcm9tIGN1cnJlbnQgYnl0ZSBvZmZzZXQuCiAgICAgICAgICogQnl0ZSBvZmZzZXQgaXMgaW5jcmVhc2VkIGJ5IHRoZSBzcGVjaWZpZWQgYnl0ZSBzaXplIHggNC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzaXplIC0gVGhlIHNpemUgcGFyYW0uCiAgICAgICAgICogQHBhcmFtIGNsb25lIC0gVGhlIGNsb25lIHBhcmFtLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRVSW50MzJBcnJheShzaXplLCBjbG9uZSA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmIChzaXplID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgIHNpemUgPSB0aGlzLmxvYWRVSW50MzIoKTsKICAgICAgICAgICAgaWYgKHNpemUgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDMyQXJyYXkoKTsKICAgICAgICAgICAgdGhpcy5yZWFkUGFkKDQpOwogICAgICAgICAgICBsZXQgcmVzdWx0OwogICAgICAgICAgICBpZiAodGhpcy5fX2lzTW9iaWxlRGV2aWNlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgVWludDMyQXJyYXkoc2l6ZSk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IHRoaXMuX19kYXRhVmlldy5nZXRVaW50MzIodGhpcy5fX2J5dGVPZmZzZXQsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX19ieXRlT2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoY2xvbmUpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgVWludDMyQXJyYXkodGhpcy5fX2RhdGEuc2xpY2UodGhpcy5fX2J5dGVPZmZzZXQsIHRoaXMuX19ieXRlT2Zmc2V0ICsgc2l6ZSAqIDQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPSBzaXplKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYnJva2VuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgVWludDMyQXJyYXkodGhpcy5fX2RhdGEsIHRoaXMuX19ieXRlT2Zmc2V0LCBzaXplKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX19ieXRlT2Zmc2V0ICs9IHNpemUgKiA0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJlYWRzIGJ1ZmZlciBhbmQgcmV0dXJuIGEgRmxvYXQzMiBhcnJheSB3aXRoIHRoZSBzcGVjaWZpZWQgc2l6ZSwKICAgICAgICAgKiBzdGFydGluZyBmcm9tIGN1cnJlbnQgYnl0ZSBvZmZzZXQuCiAgICAgICAgICogQnl0ZSBvZmZzZXQgaXMgaW5jcmVhc2VkIGJ5IHRoZSBzcGVjaWZpZWQgYnl0ZSBzaXplIHggNC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzaXplIC0gVGhlIHNpemUgcGFyYW0uCiAgICAgICAgICogQHBhcmFtIGNsb25lIC0gVGhlIGNsb25lIHBhcmFtLgogICAgICAgICAqIEByZXR1cm4gLSBUaGUgcmV0dXJuIHZhbHVlLgogICAgICAgICAqLwogICAgICAgIGxvYWRGbG9hdDMyQXJyYXkoc2l6ZSwgY2xvbmUgPSBmYWxzZSkgewogICAgICAgICAgICBpZiAoc2l6ZSA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICBzaXplID0gdGhpcy5sb2FkVUludDMyKCk7CiAgICAgICAgICAgIGlmIChzaXplID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgpOwogICAgICAgICAgICB0aGlzLnJlYWRQYWQoNCk7CiAgICAgICAgICAgIGxldCByZXN1bHQ7CiAgICAgICAgICAgIGlmICh0aGlzLl9faXNNb2JpbGVEZXZpY2UpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoc2l6ZSk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IHRoaXMuX19kYXRhVmlldy5nZXRGbG9hdDMyKHRoaXMuX19ieXRlT2Zmc2V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGNsb25lKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YS5zbGljZSh0aGlzLl9fYnl0ZU9mZnNldCwgdGhpcy5fX2J5dGVPZmZzZXQgKyBzaXplICogNCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YSwgdGhpcy5fX2J5dGVPZmZzZXQsIHNpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gc2l6ZSAqIDQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyBuZXh0IHN0cmluZy4KICAgICAgICAgKiBGaXJzdCBsb29rcyBmb3IgdGhlIHN0cmluZyBsZW5ndGggZGVzY3JpcHRpb24gaW4gdGhlIG5leHQgZm91ciBieXRlcyBpbiB0aGUgYnVmZmVyKFN0YXJ0aW5nIGZyb20gYnl0ZSBvZmZzZXQpLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFRoZSByZXR1cm4gdmFsdWUuCiAgICAgICAgICovCiAgICAgICAgbG9hZFN0cigpIHsKICAgICAgICAgICAgY29uc3QgbnVtQ2hhcnMgPSB0aGlzLmxvYWRVSW50MzIoKTsKICAgICAgICAgICAgY29uc3QgY2hhcnMgPSBuZXcgVWludDhBcnJheSh0aGlzLl9fZGF0YSwgdGhpcy5fX2J5dGVPZmZzZXQsIG51bUNoYXJzKTsKICAgICAgICAgICAgdGhpcy5fX2J5dGVPZmZzZXQgKz0gbnVtQ2hhcnM7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnV0ZjhkZWNvZGVyLmRlY29kZShjaGFycyk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2Ygc3RyaW5ncy4KICAgICAgICAgKiBGaXJzdCByZWFkaW5nIHRoZSBzaXplIG9mIHRoZSBhcnJheSB0aGVuIHJlYWRpbmcgZWFjaCBzdHJpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gVGhlIHJldHVybiB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBsb2FkU3RyQXJyYXkoKSB7CiAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmxvYWRVSW50MzIoKTsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbaV0gPSB0aGlzLmxvYWRTdHIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgYFZlYzJgIG9iamVjdCB3aXRoIHRoZSBuZXh0IHR3byBzaWduZWQgSW50MzIgdmFsdWVzIGluIHRoZSBidWZmZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIFZlYzIuCiAgICAgICAgICovCiAgICAgICAgbG9hZFNJbnQzMlZlYzIoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLmxvYWRTSW50MzIoKTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMubG9hZFNJbnQzMigpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIoeCwgeSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBgVmVjMmAgb2JqZWN0IHdpdGggdGhlIG5leHQgdHdvIHVuc2lnbmVkIEludDMyIHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgVmVjMi4KICAgICAgICAgKi8KICAgICAgICBsb2FkVUludDMyVmVjMigpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMubG9hZFVJbnQzMigpOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5sb2FkVUludDMyKCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih4LCB5KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIGBWZWMyYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCB0d28gRmxvYXQxNiB2YWx1ZXMgaW4gdGhlIGJ1ZmZlci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgVmVjMi4KICAgICAgICAgKi8KICAgICAgICBsb2FkRmxvYXQxNlZlYzIoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMih4LCB5KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIGBWZWMyYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCB0d28gRmxvYXQzMiB2YWx1ZXMgaW4gdGhlIGJ1ZmZlci4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIFZlYzIuCiAgICAgICAgICovCiAgICAgICAgbG9hZEZsb2F0MzJWZWMyKCkgewogICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlYzIoeCwgeSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBgVmVjM2Agb2JqZWN0IHdpdGggdGhlIG5leHQgdGhyZWUgRmxvYXQxNiB2YWx1ZXMgaW4gdGhlIGJ1ZmZlci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgVmVjMy4KICAgICAgICAgKi8KICAgICAgICBsb2FkRmxvYXQxNlZlYzMoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIGBWZWMzYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCB0aHJlZSBGbG9hdDMyIHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBWZWMzLgogICAgICAgICAqLwogICAgICAgIGxvYWRGbG9hdDMyVmVjMygpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgY29uc3QgeiA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHgsIHksIHopOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgYFF1YXRgIG9iamVjdCB3aXRoIHRoZSBuZXh0IGZvdXIgRmxvYXQxNiB2YWx1ZXMgaW4gdGhlIGJ1ZmZlci4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgUXVhdC4KICAgICAgICAgKi8KICAgICAgICBsb2FkRmxvYXQxNlF1YXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIGNvbnN0IHcgPSB0aGlzLmxvYWRGbG9hdDE2KCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUXVhdCh4LCB5LCB6LCB3KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIGBRdWF0YCBvYmplY3Qgd2l0aCB0aGUgbmV4dCBmb3VyIEZsb2F0MzIgdmFsdWVzIGluIHRoZSBidWZmZXIuCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBRdWF0LgogICAgICAgICAqLwogICAgICAgIGxvYWRGbG9hdDMyUXVhdCgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgY29uc3QgeiA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgY29uc3QgdyA9IHRoaXMubG9hZEZsb2F0MzIoKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBRdWF0KHgsIHksIHosIHcpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgYENvbG9yYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCB0aHJlZSBGbG9hdDMyIHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiAtIFJldHVybnMgYSBDb2xvci4KICAgICAgICAgKi8KICAgICAgICBsb2FkUkdCRmxvYXQzMkNvbG9yKCkgewogICAgICAgICAgICBjb25zdCByID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKHIsIGcsIGIpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgUkdCQSBgQ29sb3JgIG9iamVjdCB3aXRoIHRoZSBuZXh0IGZvdXIgRmxvYXQzMiB2YWx1ZXMgaW4gdGhlIGJ1ZmZlci4KICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIENvbG9yLgogICAgICAgICAqLwogICAgICAgIGxvYWRSR0JBRmxvYXQzMkNvbG9yKCkgewogICAgICAgICAgICBjb25zdCByID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5sb2FkRmxvYXQzMigpOwogICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKHIsIGcsIGIsIGEpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgYENvbG9yYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCB0aHJlZSB1bnNpZ25lZCBJbnQ4IHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgQ29sb3IuCiAgICAgICAgICovCiAgICAgICAgbG9hZFJHQlVJbnQ4Q29sb3IoKSB7CiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmxvYWRVSW50OCgpOwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5sb2FkVUludDgoKTsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMubG9hZFVJbnQ4KCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IociAvIDI1NSwgZyAvIDI1NSwgYiAvIDI1NSk7CiAgICAgICAgfQogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBSR0JBIGBDb2xvcmAgb2JqZWN0IHdpdGggdGhlIG5leHQgZm91ciB1bnNpZ25lZCBJbnQ4IHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgQ29sb3IuCiAgICAgICAgICovCiAgICAgICAgbG9hZFJHQkFVSW50OENvbG9yKCkgewogICAgICAgICAgICBjb25zdCByID0gdGhpcy5sb2FkVUludDgoKTsKICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMubG9hZFVJbnQ4KCk7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmxvYWRVSW50OCgpOwogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5sb2FkVUludDgoKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihyIC8gMjU1LCBnIC8gMjU1LCBiIC8gMjU1LCBhIC8gMjU1KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIGBCb3gyYCBvYmplY3Qgd2l0aCB0aGUgbmV4dCBmb3VyIEZsb2F0MzIgdmFsdWVzIGluIHRoZSBidWZmZXIuCiAgICAgICAgICogTmV4dCBmb3VyIGJlY2F1c2UgaXQgY3JlYXRlcyB0d28gVmVjMi4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gLSBSZXR1cm5zIGEgQm94Mi4KICAgICAgICAgKi8KICAgICAgICBsb2FkQm94MigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCb3gyKHRoaXMubG9hZEZsb2F0MzJWZWMyKCksIHRoaXMubG9hZEZsb2F0MzJWZWMyKCkpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgYEJveDJgIG9iamVjdCB3aXRoIHRoZSBuZXh0IHNpeCBGbG9hdDMyIHZhbHVlcyBpbiB0aGUgYnVmZmVyLgogICAgICAgICAqIE5leHQgZm91ciBiZWNhdXNlIGl0IGNyZWF0ZXMgdHdvIFZlYzMuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIC0gUmV0dXJucyBhIEJveDMuCiAgICAgICAgICovCiAgICAgICAgbG9hZEJveDMoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQm94Myh0aGlzLmxvYWRGbG9hdDMyVmVjMygpLCB0aGlzLmxvYWRGbG9hdDMyVmVjMygpKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogR2l2ZW4gYSBzdHJpZGVlIHZhbHVlLCBhZHZhbmNlIHRoZSBwb2ludGVyIHRvIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgc3RyaWRlLgogICAgICAgICAqIEBwYXJhbSBzdHJpZGUgLSBUaGUgc3RyaWRlIHBhcmFtLgogICAgICAgICAqLwogICAgICAgIHJlYWRQYWQoc3RyaWRlKSB7CiAgICAgICAgICAgIGNvbnN0IHBhZCA9IHRoaXMuX19ieXRlT2Zmc2V0ICUgc3RyaWRlOwogICAgICAgICAgICBpZiAocGFkICE9IDApCiAgICAgICAgICAgICAgICB0aGlzLl9fYnl0ZU9mZnNldCArPSBzdHJpZGUgLSBwYWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xhc3MgZGVzaWduZWQgdG8gc3RvcmUgdmVyc2lvbiBkYXRhLiBXaWRlbHkgdXNlZCBpbiB0aGUgemVhIGVuZ2luZSBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgICAgKi8KICAgIGNsYXNzIFZlcnNpb24gewogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYSB2ZXJzaW9uLgogICAgICAgICAqIFRoZSB2ZXJzaW9uIHN0cmluZyBzaG91bGQgaGF2ZSB0aGUgZm9sbG93aW5nIHN0cnVjdHVyZToKICAgICAgICAgKiBtYWpvciwgbWlub3IgYW5kIHBhdGNoIHNlcGFyYXRlZCBieSBhIGRvdChgLmApIGFuZCBwYXJ0cyBzZXBhcmF0ZWQgYnkgYSBkYXNoKGAtYCkuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdmVyc2lvblN0ciAtIFRoZSB2ZXJzaW9uIHN0cmluZyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBjb25zdHJ1Y3Rvcih2ZXJzaW9uU3RyID0gJycpIHsKICAgICAgICAgICAgdGhpcy5icmFuY2ggPSAnJzsKICAgICAgICAgICAgaWYgKHZlcnNpb25TdHIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdmVyc2lvblN0ci5zcGxpdCgnLScpOwogICAgICAgICAgICAgICAgY29uc3QgbnVtYmVycyA9IHBhcnRzWzBdLnNwbGl0KCcuJyk7CiAgICAgICAgICAgICAgICB0aGlzLm1ham9yID0gcGFyc2VJbnQobnVtYmVyc1swXSk7CiAgICAgICAgICAgICAgICB0aGlzLm1pbm9yID0gcGFyc2VJbnQobnVtYmVyc1sxXSk7CiAgICAgICAgICAgICAgICB0aGlzLnBhdGNoID0gcGFyc2VJbnQobnVtYmVyc1syXSk7CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDIpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5icmFuY2ggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMubWFqb3IgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5taW5vciA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnBhdGNoID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIGEgdmVyc2lvbiBvYmplY3QgYWdhaW5zdCBhIHZlcnNpb24gbnVtYmVycyBhcnJheS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBudW1iZXJzIC0gQW4gYXJyYXkgY29udGFpbmluZyAzIHZlcnNpb24gbnVtYmVycy4gW01ham9yLCBNaW5vciwgUGF0Y2hdCiAgICAgICAgICogQHJldHVybiAtIHJldHVybiBwb3NpdGl2ZTogdjEgPiB2MiwgemVybzp2MSA9PSB2MiwgbmVnYXRpdmU6IHYxIDwgdjIKICAgICAgICAgKi8KICAgICAgICBjb21wYXJlKG51bWJlcnMpIHsKICAgICAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjgzMjU5Ni9ob3ctdG8tY29tcGFyZS1zb2Z0d2FyZS12ZXJzaW9uLW51bWJlci11c2luZy1qcy1vbmx5LW51bWJlcgogICAgICAgICAgICAvLyAybmQgYW5zd2VyLgogICAgICAgICAgICBjb25zdCB2MSA9IFt0aGlzLm1ham9yLCB0aGlzLm1pbm9yLCB0aGlzLnBhdGNoXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICh2MVtpXSAhPT0gbnVtYmVyc1tpXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjFbaV0gLSBudW1iZXJzW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIGB2JHt0aGlzLm1ham9yfS4ke3RoaXMubWlub3J9LiR7dGhpcy5wYXRjaH1gICsgKHRoaXMuYnJhbmNoICE9ICcnID8gYC0ke3RoaXMuYnJhbmNofWAgOiAnJyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBleHRlbmRzIEJhc2VHZW9tCiAgICAgKi8KICAgIGNsYXNzIENvbXBvdW5kR2VvbUxvYWRlciBleHRlbmRzIEJhc2VHZW9tIHsKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgcG9pbnRzLgogICAgICAgICAqLwogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLm51bVN1Ykdlb21zID0gMDsKICAgICAgICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0cyA9IHt9OwogICAgICAgICAgICB0aGlzLmNvdW50cyA9IHt9OwogICAgICAgICAgICAvLyBGb3IgZWFjaCB0eXBlIG9mIGdlb20gKFRSSUFOR0xFUywgTElORVMpCiAgICAgICAgICAgIC8vIEEgbWF0ZXJpYWwgaWQsIGFuZCBlYWNoIHN0YXJ0IGFuZCBlbmQgb2YgdGhlIGJsb2NrCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxTdWJHZW9tcyA9IHt9OwogICAgICAgICAgICB0aGlzLnN1Ykdlb21PZmZzZXRzID0ge307CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbUNvdW50cyA9IHt9OwogICAgICAgICAgICB0aGlzLm1hdGVyaWFsTGlicmFyeUluZGljZXMgPSBuZXcgVWludDMyQXJyYXkoMCk7CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbU1hdGVyaWFsSW5kaWNlcyA9IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgIH0KICAgICAgICBnZW5CdWZmZXJzKCkgewogICAgICAgICAgICBjb25zdCBhdHRyQnVmZmVycyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IFthdHRyTmFtZSwgYXR0cl0gb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgIGF0dHJCdWZmZXJzW2F0dHJOYW1lXSA9IGF0dHIuZ2VuQnVmZmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSB0aGlzLm51bVZlcnRpY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgIG51bVZlcnRpY2VzLAogICAgICAgICAgICAgICAgbnVtUmVuZGVyVmVydHM6IG51bVZlcnRpY2VzLAogICAgICAgICAgICAgICAgaW5kaWNlczogdGhpcy5pbmRpY2VzLAogICAgICAgICAgICAgICAgYXR0ckJ1ZmZlcnMsCiAgICAgICAgICAgICAgICBvZmZzZXRzOiB0aGlzLm9mZnNldHMsCiAgICAgICAgICAgICAgICBjb3VudHM6IHRoaXMuY291bnRzLAogICAgICAgICAgICAgICAgc3ViR2VvbU9mZnNldHM6IHRoaXMuc3ViR2VvbU9mZnNldHMsCiAgICAgICAgICAgICAgICBzdWJHZW9tQ291bnRzOiB0aGlzLnN1Ykdlb21Db3VudHMsCiAgICAgICAgICAgICAgICBtYXRlcmlhbExpYnJhcnlJbmRpY2VzOiB0aGlzLm1hdGVyaWFsTGlicmFyeUluZGljZXMsCiAgICAgICAgICAgICAgICBzdWJHZW9tTWF0ZXJpYWxJbmRpY2VzOiB0aGlzLnN1Ykdlb21NYXRlcmlhbEluZGljZXMsCiAgICAgICAgICAgICAgICBtYXRlcmlhbFN1Ykdlb21zOiB0aGlzLm1hdGVyaWFsU3ViR2VvbXMsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAvLyBQZXJzaXN0ZW5jZQogICAgICAgIC8qKgogICAgICAgICAqIFNldHMgc3RhdGUgb2YgY3VycmVudCBnZW9tZXRyeShJbmNsdWRpbmcgbGluZSBzZWdtZW50cykgdXNpbmcgYSBiaW5hcnkgcmVhZGVyIG9iamVjdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7QmluUmVhZGVyfSByZWFkZXIgLSBUaGUgcmVhZGVyIHZhbHVlLgogICAgICAgICAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgdW5rbm93bj59IGNvbnRleHQgLSBUaGUgY29udGV4dCB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICByZWFkQmluYXJ5KHJlYWRlciwgY29udGV4dCkgewogICAgICAgICAgICBzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkocmVhZGVyLCBjb250ZXh0KTsKICAgICAgICAgICAgY29uc3QgZ2VvbUNvdW50c0J5VHlwZSA9IHJlYWRlci5sb2FkVUludDMyQXJyYXkoMyk7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0c1snVFJJQU5HTEVTJ10gPSAwOwogICAgICAgICAgICB0aGlzLmNvdW50c1snVFJJQU5HTEVTJ10gPSBnZW9tQ291bnRzQnlUeXBlWzBdOwogICAgICAgICAgICB0aGlzLm9mZnNldHNbJ0xJTkVTJ10gPSBnZW9tQ291bnRzQnlUeXBlWzBdOwogICAgICAgICAgICB0aGlzLmNvdW50c1snTElORVMnXSA9IGdlb21Db3VudHNCeVR5cGVbMV07CiAgICAgICAgICAgIHRoaXMub2Zmc2V0c1snUE9JTlRTJ10gPSBnZW9tQ291bnRzQnlUeXBlWzBdICsgZ2VvbUNvdW50c0J5VHlwZVsxXTsKICAgICAgICAgICAgdGhpcy5jb3VudHNbJ1BPSU5UUyddID0gZ2VvbUNvdW50c0J5VHlwZVsyXTsKICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSByZWFkZXIubG9hZFVJbnQ4KCk7CiAgICAgICAgICAgIGlmIChieXRlcyA9PSAxKQogICAgICAgICAgICAgICAgdGhpcy5pbmRpY2VzID0gcmVhZGVyLmxvYWRVSW50OEFycmF5KHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGJ5dGVzID09IDIpCiAgICAgICAgICAgICAgICB0aGlzLmluZGljZXMgPSByZWFkZXIubG9hZFVJbnQxNkFycmF5KHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGJ5dGVzID09IDQpCiAgICAgICAgICAgICAgICB0aGlzLmluZGljZXMgPSByZWFkZXIubG9hZFVJbnQzMkFycmF5KHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgICAvLyBUUklBTkdMRVMgc3ViZ2VvbXMKICAgICAgICAgICAgY29uc3QgYnl0ZXNNZXNoU3ViR2VvbXMgPSByZWFkZXIubG9hZFVJbnQ4KCk7CiAgICAgICAgICAgIGxldCBzdWJHZW9tQ291bnRzTWVzaDsKICAgICAgICAgICAgaWYgKGJ5dGVzTWVzaFN1Ykdlb21zID09IDEpCiAgICAgICAgICAgICAgICBzdWJHZW9tQ291bnRzTWVzaCA9IHJlYWRlci5sb2FkVUludDhBcnJheSgpOwogICAgICAgICAgICBlbHNlIGlmIChieXRlc01lc2hTdWJHZW9tcyA9PSAyKQogICAgICAgICAgICAgICAgc3ViR2VvbUNvdW50c01lc2ggPSByZWFkZXIubG9hZFVJbnQxNkFycmF5KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGJ5dGVzTWVzaFN1Ykdlb21zID09IDQpCiAgICAgICAgICAgICAgICBzdWJHZW9tQ291bnRzTWVzaCA9IHJlYWRlci5sb2FkVUludDMyQXJyYXkoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignc3ViR2VvbU9mZnNldHMgdW5kZWZpbmVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc3ViR2VvbU9mZnNldHNNZXNoID0gbmV3IFVpbnQzMkFycmF5KHN1Ykdlb21Db3VudHNNZXNoLmxlbmd0aCk7CiAgICAgICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Ykdlb21Db3VudHNNZXNoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdWJHZW9tT2Zmc2V0c01lc2hbaV0gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gc3ViR2VvbUNvdW50c01lc2hbaV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdWJHZW9tT2Zmc2V0c1snVFJJQU5HTEVTJ10gPSBzdWJHZW9tT2Zmc2V0c01lc2g7CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbUNvdW50c1snVFJJQU5HTEVTJ10gPSBzdWJHZW9tQ291bnRzTWVzaDsKICAgICAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAgIC8vIExJTkVTIHN1Ymdlb21zCiAgICAgICAgICAgIGNvbnN0IGJ5dGVzTGluZXNTdWJHZW9tcyA9IHJlYWRlci5sb2FkVUludDgoKTsKICAgICAgICAgICAgbGV0IHN1Ykdlb21Db3VudHNMaW5lczsKICAgICAgICAgICAgaWYgKGJ5dGVzTGluZXNTdWJHZW9tcyA9PSAxKQogICAgICAgICAgICAgICAgc3ViR2VvbUNvdW50c0xpbmVzID0gcmVhZGVyLmxvYWRVSW50OEFycmF5KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGJ5dGVzTGluZXNTdWJHZW9tcyA9PSAyKQogICAgICAgICAgICAgICAgc3ViR2VvbUNvdW50c0xpbmVzID0gcmVhZGVyLmxvYWRVSW50MTZBcnJheSgpOwogICAgICAgICAgICBlbHNlIGlmIChieXRlc0xpbmVzU3ViR2VvbXMgPT0gNCkKICAgICAgICAgICAgICAgIHN1Ykdlb21Db3VudHNMaW5lcyA9IHJlYWRlci5sb2FkVUludDMyQXJyYXkoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignc3ViR2VvbU9mZnNldHMgdW5kZWZpbmVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc3ViR2VvbU9mZnNldHNMaW5lcyA9IG5ldyBVaW50MzJBcnJheShzdWJHZW9tQ291bnRzTGluZXMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJHZW9tQ291bnRzTGluZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1Ykdlb21PZmZzZXRzTGluZXNbaV0gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gc3ViR2VvbUNvdW50c0xpbmVzW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbU9mZnNldHNbJ0xJTkVTJ10gPSBzdWJHZW9tT2Zmc2V0c0xpbmVzOwogICAgICAgICAgICB0aGlzLnN1Ykdlb21Db3VudHNbJ0xJTkVTJ10gPSBzdWJHZW9tQ291bnRzTGluZXM7CiAgICAgICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgICAvLyBQT0lOVFMgc3ViZ2VvbXMKICAgICAgICAgICAgY29uc3QgbnVtUG9pbnRzU3ViR2VvbXMgPSByZWFkZXIubG9hZFVJbnQzMigpOwogICAgICAgICAgICBjb25zdCBzdWJHZW9tT2Zmc2V0c1BvaW50cyA9IG5ldyBVaW50MzJBcnJheShudW1Qb2ludHNTdWJHZW9tcyk7CiAgICAgICAgICAgIGNvbnN0IHN1Ykdlb21Db3VudHNQb2ludHMgPSBuZXcgVWludDhBcnJheShudW1Qb2ludHNTdWJHZW9tcyk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUG9pbnRzU3ViR2VvbXM7IGkrKykgewogICAgICAgICAgICAgICAgc3ViR2VvbU9mZnNldHNQb2ludHNbaV0gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICBzdWJHZW9tQ291bnRzUG9pbnRzW2ldID0gMTsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbU9mZnNldHNbJ1BPSU5UUyddID0gc3ViR2VvbU9mZnNldHNQb2ludHM7CiAgICAgICAgICAgIHRoaXMuc3ViR2VvbUNvdW50c1snUE9JTlRTJ10gPSBzdWJHZW9tQ291bnRzUG9pbnRzOwogICAgICAgICAgICBpZiAoY29udGV4dC52ZXJzaW9uc1snemVhLWVuZ2luZSddLmNvbXBhcmUoWzMsIDExLCAwXSkgPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBQb2ludHMgc3ViLWdlb21zIHdlcmUgbm90IGJlaW5nIGV4cG9ydGVkIGJlZm9yZSB0aGlzIHJlbGVhc2UuCiAgICAgICAgICAgICAgICB0aGlzLm51bVN1Ykdlb21zID0gc3ViR2VvbUNvdW50c01lc2gubGVuZ3RoICsgc3ViR2VvbUNvdW50c0xpbmVzLmxlbmd0aCArIG51bVBvaW50c1N1Ykdlb21zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5udW1TdWJHZW9tcyA9IHN1Ykdlb21Db3VudHNNZXNoLmxlbmd0aCArIHN1Ykdlb21Db3VudHNMaW5lcy5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAgIC8vIE1hdGVyaWFscwogICAgICAgICAgICBjb25zdCBudW1NYXRlcmlhbHMgPSByZWFkZXIubG9hZFVJbnQzMigpOwogICAgICAgICAgICBpZiAobnVtTWF0ZXJpYWxzID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5tYXRlcmlhbExpYnJhcnlJbmRpY2VzID0gcmVhZGVyLmxvYWRVSW50MzJBcnJheShudW1NYXRlcmlhbHMpOwogICAgICAgICAgICAgICAgdGhpcy5zdWJHZW9tTWF0ZXJpYWxJbmRpY2VzID0gcmVhZGVyLmxvYWRVSW50OEFycmF5KHRoaXMubnVtU3ViR2VvbXMpOwogICAgICAgICAgICAgICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAgICAgICAvLyBNYXRlcmlhbCBHcm91cHMKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgICAgICAgICAgbGV0IGN1cnJNYXRlcmlhbCA9IC05OTsKICAgICAgICAgICAgICAgIGxldCBjdXJyTWF0ZXJpYWxTdWJHZW9tID0gbnVsbDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1TdWJHZW9tczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGtleTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3ViR2VvbU9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCB0aGlzLnN1Ykdlb21Db3VudHMuVFJJQU5HTEVTLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubWF0ZXJpYWxTdWJHZW9tcy5UUklBTkdMRVMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsU3ViR2VvbXMuVFJJQU5HTEVTID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9ICdUUklBTkdMRVMnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpIDwgdGhpcy5zdWJHZW9tQ291bnRzLlRSSUFOR0xFUy5sZW5ndGggKyB0aGlzLnN1Ykdlb21Db3VudHMuTElORVMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ykdlb21PZmZzZXQgPSB0aGlzLnN1Ykdlb21Db3VudHMuVFJJQU5HTEVTLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gJ0xJTkVTJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGVyaWFsU3ViR2VvbXMuTElORVMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsU3ViR2VvbXMuTElORVMgPSBbXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ykdlb21PZmZzZXQgPSB0aGlzLnN1Ykdlb21Db3VudHMuVFJJQU5HTEVTLmxlbmd0aCArIHRoaXMuc3ViR2VvbUNvdW50cy5MSU5FUy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9ICdQT0lOVFMnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubWF0ZXJpYWxTdWJHZW9tcy5QT0lOVFMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsU3ViR2VvbXMuUE9JTlRTID0gW107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsSWQgPSB0aGlzLnN1Ykdlb21NYXRlcmlhbEluZGljZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJNYXRlcmlhbCAhPSBtYXRlcmlhbElkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJNYXRlcmlhbCA9IG1hdGVyaWFsSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IHN1Ykdlb21NYXRlcmlhbEluZGljZXMgaXMgVWludDhBcnJheSwgYW5kIDAgbWVhbnMgbm8gY3VzdG9tCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGVyaWFsIGlzIGFzc2lnbmVkIHRvIHRoZSBzdWJHZW9tLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWJ0cmFjdCAxIHRvIGdldCB0aGUgYWN0dWFsIG1hdGVyaWFsIGlkLgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyTWF0ZXJpYWxTdWJHZW9tID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWxJZDogbWF0ZXJpYWxJZCAtIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7IGkgPCB0aGlzLm51bVN1Ykdlb21zOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyTWF0ZXJpYWwgIT0gdGhpcy5zdWJHZW9tTWF0ZXJpYWxJbmRpY2VzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHdlIGdldCB0byB0aGUgZW5kIG9nIHRoaXMgZ2VvbSB0eXBlIChlLmcgLlRSSUFOR0xFUykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IGEgbmV3IHN1Ymdlb20uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAtIHN1Ykdlb21PZmZzZXQgPT0gdGhpcy5zdWJHZW9tQ291bnRzW2tleV0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yY2UgdGhlIG1hdGVyaWFsIGluZGV4IHRvIGJlIHJlc2V0IG9uIGxpbmUgMTYyIGFib3ZlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJNYXRlcmlhbCA9IC05OTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJNYXRlcmlhbFN1Ykdlb20uY291bnQgKz0gdGhpcy5zdWJHZW9tQ291bnRzW2tleV1baSAtIHN1Ykdlb21PZmZzZXRdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBjdXJyTWF0ZXJpYWxTdWJHZW9tLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsU3ViR2VvbXNba2V5XS5wdXNoKGN1cnJNYXRlcmlhbFN1Ykdlb20pOwogICAgICAgICAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5tYXRlcmlhbFN1Ykdlb21zWydUUklBTkdMRVMnXSA9IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGVyaWFsSWQ6IC0xLAogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBnZW9tQ291bnRzQnlUeXBlWzBdLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgaWYgKGdlb21Db3VudHNCeVR5cGVbMV0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXRlcmlhbFN1Ykdlb21zWydMSU5FUyddID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbElkOiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogZ2VvbUNvdW50c0J5VHlwZVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBnZW9tQ291bnRzQnlUeXBlWzFdLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZ2VvbUNvdW50c0J5VHlwZVsyXSA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsU3ViR2VvbXNbJ1BPSU5UUyddID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbElkOiAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogZ2VvbUNvdW50c0J5VHlwZVswXSArIGdlb21Db3VudHNCeVR5cGVbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogZ2VvbUNvdW50c0J5VHlwZVsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZW1pdCgnZ2VvbURhdGFDaGFuZ2VkJywge30pOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBndWFyZC1mb3ItaW4gKi8KICAgIC8vIGtleSwgdG9jLCBnZW9tSW5kZXhPZmZzZXQsIGdlb21zUmFuZ2UsIGlzTW9iaWxlRGV2aWNlLCBidWZmZXJTbGljZSwgZ2VuQnVmZmVyc09wdHMsIGNvbnRleHQKICAgIGNvbnN0IHBhcnNlR2VvbXNCaW5hcnkgPSAoZGF0YSwgY2FsbGJhY2spID0+IHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ3VhcmQtZm9yLWluCiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YS5jb250ZXh0LnZlcnNpb25zKSB7CiAgICAgICAgICAgIGNvbnN0IHYgPSBkYXRhLmNvbnRleHQudmVyc2lvbnNba2V5XTsKICAgICAgICAgICAgY29uc3QgdmVyc2lvbiA9IG5ldyBWZXJzaW9uKCcnKTsKICAgICAgICAgICAgdmVyc2lvbi5tYWpvciA9IHYubWFqb3I7CiAgICAgICAgICAgIHZlcnNpb24ubWlub3IgPSB2Lm1pbm9yOwogICAgICAgICAgICB2ZXJzaW9uLnBhdGNoID0gdi5wYXRjaDsKICAgICAgICAgICAgdmVyc2lvbi5icmFuY2ggPSB2LmJyYW5jaDsKICAgICAgICAgICAgZGF0YS5jb250ZXh0LnZlcnNpb25zW2tleV0gPSB2ZXJzaW9uOwogICAgICAgIH0KICAgICAgICBjb25zdCBnZW9tRGF0YXMgPSBbXTsKICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gZGF0YS5ieXRlT2Zmc2V0OwogICAgICAgIC8vIGNvbnNvbGUubG9nKCdieXRlT2Zmc2V0OicgKyBieXRlT2Zmc2V0KQogICAgICAgIGNvbnN0IHRyYW5zZmVyYWJsZXMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gZGF0YS5nZW9tc1JhbmdlWzBdOyBpIDwgZGF0YS5nZW9tc1JhbmdlWzFdOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEJpblJlYWRlcihkYXRhLmJ1ZmZlclNsaWNlLCBkYXRhLnRvY1tpXSAtIGJ5dGVPZmZzZXQsIGRhdGEuaXNNb2JpbGVEZXZpY2UpOwogICAgICAgICAgICBjb25zdCBjbGFzc05hbWUgPSByZWFkZXIubG9hZFN0cigpOwogICAgICAgICAgICBjb25zdCBwb3MgPSByZWFkZXIucG9zKCk7CiAgICAgICAgICAgIC8vIGNvbnN0IG5hbWUgPSByZWFkZXIubG9hZFN0cigpCiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAvLyAgIGkgKwogICAgICAgICAgICAvLyAgICAgJzonICsKICAgICAgICAgICAgLy8gICAgIGJ5dGVPZmZzZXQgKwogICAgICAgICAgICAvLyAgICAgJyBjbGFzc05hbWU6JyArCiAgICAgICAgICAgIC8vICAgICBjbGFzc05hbWUgKwogICAgICAgICAgICAvLyAgICAgJyBuYW1lOicgKwogICAgICAgICAgICAvLyAgICAgbmFtZSAvKiArICIgcG9zOiIgKyAoZGF0YS50b2NbaV0gLSBieXRlT2Zmc2V0KSArICIgYnVmZmVyU2xpY2UuYnl0ZUxlbmd0aDoiICsgIGJ1ZmZlclNsaWNlLmJ5dGVMZW5ndGgqLwogICAgICAgICAgICAvLyApCiAgICAgICAgICAgIGxldCBnZW9tOwogICAgICAgICAgICBzd2l0Y2ggKGNsYXNzTmFtZSkgewogICAgICAgICAgICAgICAgY2FzZSAnUG9pbnRzJzoKICAgICAgICAgICAgICAgICAgICBnZW9tID0gbmV3IFBvaW50cygpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnTGluZXMnOgogICAgICAgICAgICAgICAgICAgIGdlb20gPSBuZXcgTGluZXMoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ01lc2gnOgogICAgICAgICAgICAgICAgICAgIGdlb20gPSBuZXcgTWVzaCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQ29tcG91bmRHZW9tJzoKICAgICAgICAgICAgICAgICAgICBnZW9tID0gbmV3IENvbXBvdW5kR2VvbUxvYWRlcigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIEdlb20gdHlwZTonICsgY2xhc3NOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVhZGVyLnNlZWsocG9zKTsgLy8gUmVzZXQgdGhlIHBvaW50ZXIgdG8gdGhlIHN0YXJ0IG9mIHRoZSBpdGVtIGRhdGEuCiAgICAgICAgICAgICAgICBnZW9tLnJlYWRCaW5hcnkocmVhZGVyLCBkYXRhLmNvbnRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGxvYWRpbmc6JyArIGdlb20ubmFtZSArICdcbjonICsgZSk7CiAgICAgICAgICAgICAgICBnZW9tRGF0YXMucHVzaCh7fSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBnZW9tQnVmZmVycyA9IGdlb20uZ2VuQnVmZmVycyhkYXRhLmdlbkJ1ZmZlcnNPcHRzKTsKICAgICAgICAgICAgaWYgKGdlb21CdWZmZXJzLmluZGljZXMpCiAgICAgICAgICAgICAgICB0cmFuc2ZlcmFibGVzLnB1c2goZ2VvbUJ1ZmZlcnMuaW5kaWNlcy5idWZmZXIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGF0dHJOYW1lIGluIGdlb21CdWZmZXJzLmF0dHJCdWZmZXJzKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGUgdHlwZSB2YWx1ZSBhc3NpZ25lZCB0byB0aGUgYXR0cmlidXRlIGNhbgogICAgICAgICAgICAgICAgLy8gbm90IGJlIHRyYW5zZmVycmVkIGJhY2sgdG8gdGhlIG1haW4gdGhyZWFkLiBDb252ZXJ0IHRvCiAgICAgICAgICAgICAgICAvLyB0aGUgdHlwZSBuYW1lIGhlcmUgYW5kIHNlbmQgYmFjayBhcyBhIHN0cmluZy4KICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJEYXRhID0gZ2VvbUJ1ZmZlcnMuYXR0ckJ1ZmZlcnNbYXR0ck5hbWVdOwogICAgICAgICAgICAgICAgdHJhbnNmZXJhYmxlcy5wdXNoKGF0dHJEYXRhLnZhbHVlcy5idWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChnZW9tQnVmZmVycy52ZXJ0ZXhOZWlnaGJvcnMpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyYWJsZXMucHVzaChnZW9tQnVmZmVycy52ZXJ0ZXhOZWlnaGJvcnMuYnVmZmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUcmFuc2ZlciB0aGUgYmJveCBwb2ludCBidWZmZXJzLgogICAgICAgICAgICBjb25zdCBiYm94ID0gZ2VvbS5nZXRCb3VuZGluZ0JveCgpOwogICAgICAgICAgICB0cmFuc2ZlcmFibGVzLnB1c2goYmJveC5wMC5fX2RhdGEuYnVmZmVyKTsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlcy5wdXNoKGJib3gucDEuX19kYXRhLmJ1ZmZlcik7CiAgICAgICAgICAgIGdlb21EYXRhcy5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6IGdlb20ubmFtZSwKICAgICAgICAgICAgICAgIHR5cGU6IGNsYXNzTmFtZSwKICAgICAgICAgICAgICAgIGdlb21CdWZmZXJzLAogICAgICAgICAgICAgICAgYmJveCwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgdGFza0lkOiBkYXRhLnRhc2tJZCwKICAgICAgICAgICAgZ2VvbUxpYnJhcnlJZDogZGF0YS5nZW9tTGlicmFyeUlkLAogICAgICAgICAgICBnZW9tRmlsZUlEOiBkYXRhLmdlb21GaWxlSUQsCiAgICAgICAgICAgIGdlb21JbmRleE9mZnNldDogZGF0YS5nZW9tSW5kZXhPZmZzZXQsCiAgICAgICAgICAgIGdlb21zUmFuZ2U6IGRhdGEuZ2VvbXNSYW5nZSwKICAgICAgICAgICAgZ2VvbURhdGFzLAogICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpOwogICAgfTsKCiAgICBjb25zdCBoYW5kbGVNZXNzYWdlID0gZnVuY3Rpb24gKHNyY0RhdGEsIHBvc3RNZXNzYWdlKSB7CiAgICAgIHBhcnNlR2VvbXNCaW5hcnkoc3JjRGF0YSwgKHJlc3VsdERhdGEsIHRyYW5zZmVyYWJsZXMpID0+IHsKICAgICAgICBwb3N0TWVzc2FnZShyZXN1bHREYXRhLCB0cmFuc2ZlcmFibGVzKTsKICAgICAgfSk7CiAgICB9OwoKICAgIC8qIE5PREVfU1RBUlQKICAgIGV4cG9ydCB7IGhhbmRsZU1lc3NhZ2UgfQogICAgLy8gTk9ERV9FTFNFICovCiAgICBzZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoIWV2ZW50LmRhdGEpIHsKICAgICAgICAvLyBOb3RlOiB3ZSBzZWUgdGhpcyBvY2N1ciB3aGVuIGxvYWRpbmcgb25lIGxhcmdlIGFzc2V0IG1hbnkgdGltZXMuCiAgICAgICAgLy8gTGlrZSB3aGVuIGxvYWRpbmcgdGhlIHBvcnRhZmlsLgogICAgICAgIC8vIEl0IG1heSBiZSBkdWUgdG8gbWVtb3J5IGlzc3VlcywgYnV0IGl0cyBub3QgY2xlYXIuCiAgICAgICAgY29uc29sZS53YXJuKCdHZW9tTGlicmFyeSB3b3JrZXIucG9zdE1lc3NhZ2UgZmFpbGVkLiBkYXRhIHdhcyBsb3N0IG9uIHRoZSB3YXkgdG8gdGhlIHdlYiB3b3JrZXIuJyk7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgaGFuZGxlTWVzc2FnZShldmVudC5kYXRhLCBzZWxmLnBvc3RNZXNzYWdlKTsKICAgIH07CiAgICAvLyBOT0RFX0VORAoKfSkoKTsKCg==",null,!1);const _I=new class extends EA{constructor(){super(!0)}constructWorker(){const A=new TI;return Promise.resolve(A)}};let PI=0;class OI extends V{constructor(A){super(),this.listenerIDs={},this.streamInfos={},this.genBuffersOpts={},this.numGeoms=-1,this.geoms=[],this.basePath="",this.loadedCount=0,this.assetItem=A,PI++}isLoaded(){return-1==this.numGeoms||this.loadedCount==this.numGeoms}loadGeomFile(A,g=!1){return g&&FA.incrementWorkload(1),new Promise((I=>{const C=this.basePath+A+".zgeoms";FA.loadFile("archive",C,!1).then((A=>{const i=A[Object.keys(A)[0]],e=this.on("streamFileParsed",(A=>{A.geomFileID==C&&(g&&FA.incrementWorkDone(1),this.removeListenerById("streamFileParsed",e),I())}));this.readBinaryBuffer(C,i.buffer,this.loadContext)}))}))}loadGeomFilesStream(A,g,I){const C=A.numGeomsPerFile.length;FA.incrementWorkload(C),this.numGeoms=A.numGeoms,this.basePath=g,this.loadContext=I;for(let A=0;A<C;A++)this.loadGeomFile(A,!1)}setGenBufferOption(A,g){this.genBuffersOpts[A]=g}setNumGeoms(A){this.numGeoms=A}getNumGeoms(){return this.numGeoms}getGeom(A){return A>=this.geoms.length?null:this.geoms[A]}readBinaryBuffer(A,I,C){const i=new YA(I,0,g.isMobileDevice),e=i.loadUInt32(),t=i.loadUInt32();if(this.streamInfos[A]={total:e,done:0},0==e){const g=new z(A,0);return void this.emit("streamFileParsed",g)}-1==this.numGeoms&&(this.numGeoms=e);const B=i.loadUInt32Array(e),o=I.byteLength>2e7;if(PI>1&&!o){const g=[0,e],o=0;_I.addTask({geomFileID:A,toc:B,byteOffset:o,geomIndexOffset:t,geomsRange:g,isMobileDevice:i.isMobileDevice,bufferSlice:I,genBuffersOpts:this.genBuffersOpts,context:{versions:C.versions}},[I]).then((A=>{this.__receiveGeomDatas(A)}))}else{const g=2e6;let o=0;for(;o<e;){const s=B[o];let a,l,n=0,d=o;for(;d<e&&n<g;)d++,n=B[d]-s;d>=e?(a=[o,e],l=I.byteLength):(a=[o,d],l=B[a[1]]);const h=0==o&&d==e,c=h?0:B[a[0]],r=h?I:I.slice(s,l);o=d,_I.addTask({geomFileID:A,toc:B,byteOffset:c,geomIndexOffset:t,geomsRange:a,isMobileDevice:i.isMobileDevice,bufferSlice:r,genBuffersOpts:this.genBuffersOpts,context:{versions:C.versions}},[r]).then((A=>{this.__receiveGeomDatas(A)}))}}}__receiveGeomDatas(A){const{geomFileID:g,geomDatas:I,geomIndexOffset:C,geomsRange:i}=A,e=C+i[0],t=[e,C+i[1]];for(let A=0;A<I.length;A++){const g=I[A];if(!g.type)continue;let C;switch(g.type){case"Points":C=new Ng(g);break;case"Lines":C=new Jg(g);break;case"Mesh":case"Plane":case"Sphere":case"Cone":C=new Dg(g);break;case"CompoundGeom":C=new Mg(g,this.assetItem.getMaterialLibrary());break;default:throw new Error("Unsupported Geom type:")}this.geoms[e+A]=C}const B=new M(t);this.emit("rangeLoaded",B);const o=t[1]-t[0],s=this.streamInfos[g];if(s.done+=o,s.done==s.total){const A=new z(g,s.done);this.emit("streamFileParsed",A)}return this.loadedCount+=o,this.loadedCount==this.numGeoms&&this.emit("loaded"),this.loadedCount==this.numGeoms}toJSON(){return{numGeoms:this.geoms.length}}toString(){return JSON.stringify(this.toJSON(),null,2)}loadMetadata(A,I){const C=new YA(A.buffer,0,g.isMobileDevice),i=C.loadUInt32Array();for(let A=0;A<i.length;A++)try{const g=this.geoms[A];g||console.warn("Error loading metadata for geom that was not yet loaded: ",A),g instanceof Mg&&(C.seek(i[A]),g.loadMetadata(C,I))}catch(g){console.warn("Error loading geom metadata: ",A)}}}class jI extends V{constructor(A="MaterialLibrary"){super(),this.__images={},this.materials=[],this.__materialsMap={},this.name="",this.__name=A}clear(){this.__images={},this.materials=[],this.__materialsMap={}}getPath(){return[this.__name]}resolvePath(A,g=0){return null}getNumMaterials(){return this.materials.length}getMaterials(){return this.materials}getMaterialNames(){const A=[];return this.materials.forEach((g=>{A.push(g.getName())})),A}hasMaterial(A){return A in this.__materialsMap}addMaterial(A){A.setOwner(this),this.__materialsMap[A.getName()]=this.materials.length,this.materials.push(A)}getMaterial(A,g=!0){const I=this.__materialsMap[A];if(null==I&&g)throw new Error("Material:"+A+" not found in library:"+this.getMaterialNames());return this.materials[I]}hasImage(A){return A in this.__images}addImage(A){A.setOwner(this),this.__images[A.getName()]=A}getImage(A,g=!0){const I=this.__images[A];if(!I&&g)throw new Error("Image:"+A+" not found in library:"+this.getImageNames());return I}getImageNames(){const A=[];for(const g in this.__images)A.push(g);return A}load(A){const g=new XMLHttpRequest;g.open("GET",A,!0),g.ontimeout=()=>{throw new Error("The request for "+A+" timed out.")},g.onload=()=>{4===g.readyState&&(200===g.status?this.fromJSON(JSON.parse(g.responseText)):console.warn(g.statusText))},g.send(null)}toJSON(A={}){return{numMaterials:this.getNumMaterials()}}fromJSON(A,g={}){for(const g in A.textures){const I=new eI(g);I.fromJSON(A.textures[g]),this.__images[g]=I}for(const g in A.materials){const I=new XI(g);I.fromJSON(A.materials[g]),this.addMaterial(I)}}readBinary(A,g){this.name=A.loadStr();const I=A.loadUInt32();for(let C=0;C<I;C++){const I=A.loadStr(),C=e.constructClass(I);C.readBinary(A,g),this.__images[C.getName()]=C}const C=A.loadUInt32();if(C>0){const I=A.loadUInt32Array(C);for(let i=0;i<C;i++){let C;switch(A.loadStr()){case"StandardMaterial":case"TransparentMaterial":case"StandardSurfaceShader":C=e.constructClass("StandardSurfaceMaterial");break;case"SimpleSurfaceShader":case"SimpleSurfaceMaterial":C=e.constructClass("SimpleSurfaceMaterial");break;case"PointsShader":case"PointsMaterial":C=e.constructClass("PointsMaterial");break;case"FatPointsShader":case"FatPointsMaterial":C=e.constructClass("FatPointsMaterial");break;case"LinesShader":case"LinesMaterial":C=e.constructClass("LinesMaterial");break;default:C=new XI("")}A.seek(I[i]),C.readBinary(A,g),this.materials[i]=C,this.__materialsMap[C.getName()]=i}}this.emit("loaded")}toString(){return JSON.stringify(this.toJSON(),null,2)}}const qI=A=>{switch(A.toLowerCase()){case"millimeters":return.001;case"centimeters":return.01;case"decimeters":return.1;case"meters":return 1;case"kilometers":return 1e3;case"inches":return.0254;case"feet":return.3048;case"miles":return 1609.34}return 1};class $I extends ag{constructor(A=""){super(A),this.geomLibrary=new OI(this),this.materialLibrary=new jI,this.loaded=!1,this.unitsScale=1,this.units="meters"}load(A){return Promise.reject(`This method is not implemented for this Asset Item: ${A}`)}isLoaded(){return this.loaded}getEngineDataVersion(){return this.engineDataVersion}getGeometryLibrary(){return this.geomLibrary}getMaterialLibrary(){return this.materialLibrary}getUnitsConversion(){return this.unitsScale}readBinary(A,g){g.assetItem=this,g.units||(g.units="meters"),g.versions["zea-engine"]||(g.versions["zea-engine"]=new WA(A.loadStr())),this.engineDataVersion=g.versions["zea-engine"];const I=()=>{this.units=A.loadStr(),this.addParameter(new jA("FileUnits",this.units));const I=qI(this.units),C=qI(g.units);this.unitsScale=I/C,g.units=this.units;const i=this.localXfoParam,e=i.value;e.sc.scaleInPlace(this.unitsScale),i.value=e};let C;g.versions["zea-engine"].compare([0,0,6])>0&&I();const i={};g.addGeomToLayer=(A,g)=>{if(!i[g]){C||(C=new ag("Layers"),this.addChild(C,!1));const A=new zI(g);C.addChild(A,!1),i[g]=A}i[g].addItem(A)};const e=[];g.resolvePath=(A,g,I)=>{if(!A)throw new Error("Path not specified");try{const I=this.resolvePath(A);g(I)}catch(C){e.push((()=>{try{const I=this.resolvePath(A);g(I)}catch(A){if(!I)throw A;I(A)}}))}},g.addPLCB=A=>e.push(A),this.materialLibrary.readBinary(A,g),super.readBinary(A,g),g.versions["zea-engine"].compare([0,0,5])>=0&&g.versions["zea-engine"].compare([0,0,7])<0&&I();for(const A of e)A();this.loaded=!0}toJSON(A={}){A.makeRelative=A=>{const g=this.getPath(),I=A.slice(0,g.length);for(let C=0;C<I.length-1;C++)if(I[C]!=g[C])return console.warn("Param Path is not relative to the asset. May not be able to be resolved at load time:"+A),A;const C=A.slice(g.length-1);return C[0]=".",C},A.assetItem=this;return super.toJSON(A)}fromJSON(A,g={}){g||(g={}),g.assetItem=this,null==g.version&&(g.version=0),g.assetItem=this;const I=[];g.resolvePath=(A,g)=>{if(!A)throw new Error("Path not specified");const C=this.resolvePath(A);C?g(C):I.push((()=>{const I=this.resolvePath(A);I?g(I):console.warn("Path unable to be resolved:"+A)}))},g.addPLCB=A=>I.push(A),super.fromJSON(A,g);for(const A of I)A()}clone(A){const g=new $I;return g.copyFrom(this,A),g}copyFrom(A,g){this.geomLibrary=A.geomLibrary,this.materialLibrary=A.materialLibrary,this.loaded=A.loaded,A.loaded||A.once("loaded",(I=>{const C=A.localXfoParam.value,i=this.localXfoParam.value;i.sc=C.sc.clone(),this.localXfoParam.value=i,A.getChildren().forEach((A=>{A&&A!=$I&&this.addChild(A.clone(g),!1,!1)})),this.loaded=!0,this.emit("loaded",I)})),super.copyFrom(A,g)}}e.register("AssetItem",$I);class AC extends V{constructor(A){super(),this.units="meters",this.versions={},this.sdk="",this.url="",this.folder="",this.camera=null,this.assetItem=null,this.resources=null,this.xrefs={},this.xrefLoadCallback=null,this.postLoadCallbacks=[],this.asyncCount=0,A&&(this.units=A.units,this.sdk=A.sdk,this.camera=A.camera,this.resources=A.resources,this.xrefs=A.xrefs,this.xrefLoadCallback=A.xrefLoadCallback)}incrementAsync(){this.asyncCount++}decrementAsync(){this.asyncCount--,0==this.asyncCount&&this.emit("done")}resolvePath(A,g,I){try{const I=this.assetItem.resolvePath(A);g(I)}catch(C){this.postLoadCallbacks.push((()=>{try{const I=this.assetItem.resolvePath(A);g(I)}catch(A){if(!I)throw new Error(A.message);I(A)}}))}}addPLCB(A){this.postLoadCallbacks.push(A)}clone(){return new AC(this)}}class gC extends ag{constructor(A,g){super(A),this.imageParam=new OA("Image"),this.pixelsPerMeterParam=new JA("PixelsPerMeter",1e3),this.alphaParam=new JA("Alpha",1),this.colorParam=new xA("Color",new l(1,1,1)),this.alignedToCameraParam=new fA("AlignedToCamera",!1),this.drawOnTopParam=new fA("DrawOnTop",!1),this.fixedSizeOnscreenParam=new fA("FixedSizeOnscreen",!1),this.pivotParam=new MA("Pivot",new B(.5,0));const I=this.addParameter(this.imageParam);g&&(I.value=g),this.addParameter(this.pixelsPerMeterParam),this.addParameter(this.alphaParam),this.addParameter(this.colorParam),this.addParameter(this.alignedToCameraParam),this.addParameter(this.drawOnTopParam),this.addParameter(this.fixedSizeOnscreenParam),this.addParameter(this.pivotParam)}}e.register("BillboardItem",gC);class IC extends ag{constructor(A="Camera"){super(A),this.isOrthographicParam=new JA("isOrthographic",0),this.fovParam=new JA("fov",1),this.nearParam=new JA("near",.1),this.farParam=new JA("far",1e3),this.focalDistanceParam=new JA("focalDistance",5),this.viewHeight=0,this.__orthoIntervalId=-1,this.__focusIntervalId=-1,this.addParameter(this.isOrthographicParam),this.addParameter(this.fovParam),this.addParameter(this.nearParam),this.addParameter(this.farParam),this.addParameter(this.focalDistanceParam);const g=A=>{this.emit("projectionParamChanged",A)};this.isOrthographicParam.on("valueChanged",g),this.fovParam.on("valueChanged",g),this.nearParam.on("valueChanged",g),this.farParam.on("valueChanged",g),this.setPositionAndTarget(new o(3,3,1.75),new o(0,0,1)),this.setLensFocalLength("28mm"),this.adjustNearAndFarPlanesToFocalDist=!0,this.nearDistFactor=.01,this.farDistFactor=100,this.frameOnBoundingSphere=!1}getNear(){return this.nearParam.value}setNear(A){this.nearParam.value=A}getFar(){return this.farParam.value}setFar(A){this.farParam.value=A}getFov(){return this.fovParam.value}setFov(A){this.fovParam.value=A}getFrustumHeight(){return this.viewHeight}setFrustumHeight(A){this.viewHeight=A,this.emit("projectionParamChanged")}setLensFocalLength(A){const g={"10mm":100.4,"11mm":95,"12mm":90,"14mm":81.2,"15mm":77.3,"17mm":70.4,"18mm":67.4,"19mm":64.6,"20mm":61.9,"24mm":53.1,"28mm":46.4,"30mm":43.6,"35mm":37.8,"45mm":29.9,"50mm":27,"55mm":24.6,"60mm":22.6,"70mm":19.5,"75mm":18.2,"80mm":17.1,"85mm":16.1,"90mm":15.2,"100mm":13.7,"105mm":13,"120mm":11.4,"125mm":11,"135mm":10.2,"150mm":9.1,"170mm":8.1,"180mm":7.6,"210mm":6.5,"300mm":4.6,"400mm":3.4,"500mm":2.7,"600mm":2.3,"800mm":1.7};A in g?this.fovParam.value=r.degToRad(g[A]):console.warn("Camera lense focal length not supported:"+A)}getFocalDistance(){return this.focalDistanceParam.value}setFocalDistance(A){A<1e-4&&console.error("Never set focal distance to zero"),this.focalDistanceParam.value=A,this.adjustNearAndFarPlanesToFocalDist&&(this.nearParam.value=A*this.nearDistFactor,this.farParam.value=A*this.farDistFactor)}isOrthographic(){return 1==this.isOrthographicParam.value}setIsOrthographic(A,g=0){if(this.__orthoIntervalId&&clearInterval(this.__orthoIntervalId),A>.5){const A=this.fovParam.value,g=this.focalDistanceParam.value;this.viewHeight=Math.sin(.5*A)*g*2}if(0==g)this.isOrthographicParam.value=A;else{const I=Math.round(g/20);let C=0;const i=this.isOrthographicParam.value,e=()=>{const g=r.lerp(i,A,C/I);this.isOrthographicParam.value=g,C++,C<=I?this.__orthoIntervalId=window.setTimeout(e,20):(this.__orthoIntervalId=-1,this.emit("movementFinished"))};e()}}setPositionAndTarget(A,g){this.setFocalDistance(A.distanceTo(g));const I=new m;I.setLookAt(A,g,new o(0,0,1)),this.globalXfoParam.value=I,this.emit("movementFinished")}getTargetPosition(){const A=this.focalDistanceParam.value,g=this.globalXfoParam.value,I=g.ori.getZaxis();return I.scaleInPlace(-A),I.addInPlace(g.tr),I}frameView(A,g){const I=this.focalDistanceParam.value,C=this.fovParam.value,i=this.globalXfoParam.value.clone(),e=A.getWidth()/A.getHeight(),t=2*Math.atan(Math.tan(.5*C)*e);let s=I;if(this.frameOnBoundingSphere){const A=new b;for(const I of g)A.addBox3(I.boundingBoxParam.value);if(!A.isValid())return void console.warn("Bounding box not valid.");const e=i.ori.getZaxis().scale(-I),t=i.tr.add(e),B=A.center().subtract(t);i.tr.addInPlace(B),s=A.size()/Math.tan(C)}else{const A=[];if(g.forEach((g=>{g.traverse((g=>{if(!(g instanceof ag))return!1;if(g.disableBoundingBox)return!1;if(g instanceof kI){const I=g.geomParam.value;if(I){const C=I.getBoundingBox();if(C.isValid()){const I=g.geomMatParam.value;return A.push(I.transformVec3(C.p0)),A.push(I.transformVec3(new o(C.p0.x,C.p0.y,C.p1.z))),A.push(I.transformVec3(new o(C.p0.x,C.p1.y,C.p0.z))),A.push(I.transformVec3(new o(C.p1.x,C.p0.y,C.p0.z))),A.push(I.transformVec3(new o(C.p0.x,C.p1.y,C.p1.z))),A.push(I.transformVec3(new o(C.p1.x,C.p0.y,C.p1.z))),A.push(I.transformVec3(new o(C.p1.x,C.p1.y,C.p0.z))),void A.push(I.transformVec3(C.p1))}}}if(0==g.getNumChildren()){const I=g.boundingBoxParam.value;if(I.isValid())return A.push(new o(I.p0.x,I.p0.y,I.p0.z)),A.push(new o(I.p0.x,I.p0.y,I.p1.z)),A.push(new o(I.p0.x,I.p1.y,I.p0.z)),A.push(new o(I.p1.x,I.p0.y,I.p0.z)),A.push(new o(I.p0.x,I.p1.y,I.p1.z)),A.push(new o(I.p1.x,I.p0.y,I.p1.z)),A.push(new o(I.p1.x,I.p1.y,I.p0.z)),void A.push(new o(I.p1.x,I.p1.y,I.p1.z))}}))})),0==A.length)return;const I=this.isOrthographic()?0:t/2,a=this.isOrthographic()?0:C/2,l={};l.XPos=new o(Math.cos(I),0,Math.sin(I)),l.XNeg=new o(-Math.cos(I),0,Math.sin(I)),l.YPos=new o(0,Math.cos(a),Math.sin(a)),l.YNeg=new o(0,-Math.cos(a),Math.sin(a)),l.ZPos=new o(0,0,1),l.ZNeg=new o(0,0,-1);const n={},d={};for(const A in l)n[A]=i.ori.rotateVec3(l[A]),d[A]=Number.NEGATIVE_INFINITY;const h=new o;A.forEach(((A,g)=>{if(!Number.isFinite(A.x)||!Number.isFinite(A.y)||!Number.isFinite(A.z))return;const I=A.subtract(i.tr);for(const A in l){const g=I.dot(n[A]);g>d[A]&&g!=Number.POSITIVE_INFINITY&&(d[A]=g)}h.addInPlace(A)}));for(const A in d)if(d[A]==Number.POSITIVE_INFINITY)return;h.scaleInPlace(1/A.length);let c=0;if(this.isOrthographic()){const A=new o(.5*(-d.XNeg+d.XPos),.5*(-d.YNeg+d.YPos),.5*(-d.ZNeg+d.ZPos)),g=d.ZNeg+d.ZPos;c=2*g,A.z=-d.ZNeg+c,i.tr.addInPlace(i.ori.rotateVec3(A)),s=2*g;const I=d.XPos+d.XNeg,C=d.YPos+d.YNeg;this.viewHeight=Math.max(C,I/e);const t=.1;this.viewHeight+=this.viewHeight*t}else{const A=t/2,g=C/2,I=new B(Math.cos(A)*d.XPos,Math.sin(A)*d.XPos),e=I.add(new B(Math.sin(A),-Math.cos(A))),a=new B(-Math.cos(A)*d.XNeg,Math.sin(A)*d.XNeg),l=a.add(new B(-Math.sin(A),-Math.cos(A))),n=B.intersectionOfLines(I,e,a,l),r=new B(Math.cos(g)*d.YPos,Math.sin(g)*d.YPos),G=r.add(new B(Math.sin(g),-Math.cos(g))),m=new B(-Math.cos(g)*d.YNeg,Math.sin(g)*d.YNeg),Q=m.add(new B(-Math.sin(g),-Math.cos(g))),E=B.intersectionOfLines(r,G,m,Q);if(null===n||null===E)return void console.warn("xP or yP === null");c=Math.max(n.y,E.y);const b=new o(n.x,E.x,c);i.tr.addInPlace(i.ori.rotateVec3(b)),s=h.distanceTo(i.tr);const Z=s*.1;i.tr.addInPlace(i.ori.rotateVec3(new o(0,0,Z))),c+=Z}if(this.adjustNearAndFarPlanesToFocalDist){d.ZPos-=c,d.ZNeg+=c;const A=d.ZNeg*this.nearDistFactor,g=-d.ZPos*this.farDistFactor;this.nearParam.value=A,this.farParam.value=g}}this.setFocalDistance(s),this.globalXfoParam.value=i,this.emit("movementFinished")}updateProjectionMatrix(A,g){const I=this.isOrthographicParam.value,C=this.fovParam.value,i=this.nearParam.value,e=this.farParam.value,t=new h;if(I>0){const A=.5*this.viewHeight,I=-A,C=A,B=A*-g,o=A*g;t.setOrthographicMatrix(B,o,I,C,i,e)}I<1&&A.setPerspectiveMatrix(C,g,i,e),1==I?A.setFromMat4(t):I>0&&A.set(r.lerp(A.m00,t.m00,I),r.lerp(A.m01,t.m01,I),r.lerp(A.m02,t.m02,I),r.lerp(A.m03,t.m03,I),r.lerp(A.m10,t.m10,I),r.lerp(A.m11,t.m11,I),r.lerp(A.m12,t.m12,I),r.lerp(A.m13,t.m13,I),r.lerp(A.m20,t.m20,I),r.lerp(A.m21,t.m21,I),r.lerp(A.m22,t.m22,I),r.lerp(A.m23,t.m23,I),r.lerp(A.m30,t.m30,I),r.lerp(A.m31,t.m31,I),r.lerp(A.m32,t.m32,I),r.lerp(A.m33,t.m33,I))}}e.register("Camera",IC);class CC extends eg{constructor(A,g){super(),this.bindXfo=new m,this.invBindXfo=new m,this.groupGlobalXfo=new Bg("GroupGlobalXfo"),this.groupTransformXfo=new Cg("GroupTransformXfo"),this.groupGlobalXfo.setParam(A),this.groupTransformXfo.setParam(g),this.addInput(this.groupGlobalXfo),this.addOutput(this.groupTransformXfo)}setBindXfo(A){this.bindXfo=A,this.invBindXfo=A.inverse(),this.setDirty()}evaluate(){if(this.invBindXfo){const A=this.groupGlobalXfo.getValue();this.groupTransformXfo.setClean(A.multiply(this.invBindXfo))}else this.groupTransformXfo.setClean(new m)}}class iC extends eg{constructor(A,g){super(),this.groupTransformXfo=new Bg("GroupTransformXfo"),this.memberGlobalXfo=new Cg("MemberGlobalXfo",KA.OP_READ_WRITE),this.groupTransformXfo.setParam(A),this.memberGlobalXfo.setParam(g),this.addInput(this.groupTransformXfo),this.addOutput(this.memberGlobalXfo),this._enabled=!0}disable(){this._enabled=!1,this.setDirty()}enable(){this._enabled=!0,this.setDirty()}evaluate(){const A=this.memberGlobalXfo.getValue();if(this._enabled){const g=this.groupTransformXfo.getValue();this.memberGlobalXfo.setClean(g.multiply(A))}else this.memberGlobalXfo.setClean(A)}}const eC={disabled:0,manual:1,first:2,average:3,globalOri:4};class tC extends xI{constructor(A=""){super(A),this.initialXfoModeParam=new DA("InitialXfoMode",eC.average,["manual","first","average","global"]),this.groupTransformParam=new PA("GroupTransform",new m),this.calculatingGroupXfo=!1,this.memberXfoOps=[],this.addParameter(this.initialXfoModeParam),this.initialXfoModeParam.on("valueChanged",(()=>{this.calcGroupXfo()})),this.addParameter(this.groupTransformParam),this.groupTransformOp=new CC(this.globalXfoParam,this.groupTransformParam)}static get INITIAL_XFO_MODES(){return eC}updateHighlight(){setTimeout((()=>{let A,g=!1;this.isSelected()&&(g=!0,A=this.getHighlight(),A.a=.2);const I="kinematicGroupItemHighlight"+this.getId();Array.from(this.itemsParam.value).forEach((C=>{C instanceof ag&&(g?C.addHighlight(I,A,!0):C.removeHighlight(I,!0))}))}),1)}setSelected(A){super.setSelected(A),this.updateHighlight()}calcGroupXfo(){const A=Array.from(this.itemsParam.value);if(0==A.length)return;this.calculatingGroupXfo=!0,this.memberXfoOps.forEach((A=>A.disable()));const g=this.initialXfoModeParam.value;let I;if(g==eC.manual)I=this.globalXfoParam.value;else if(g==eC.first&&A[0]instanceof ag)I=A[0].globalXfoParam.value;else if(g==eC.average){I=new m,I.ori.set(0,0,0,0);let g=0;A.forEach(((A,C)=>{if(A instanceof ag){const C=A.globalXfoParam.value;I.tr.addInPlace(C.tr),I.ori.addInPlace(C.ori),g++}})),I.tr.scaleInPlace(1/g),I.ori.normalizeInPlace()}else{if(g!=eC.globalOri)throw new Error("Invalid GROUP_XFO_MODES.");{I=new m;let g=0;A.forEach(((A,C)=>{if(A instanceof ag){const C=A.globalXfoParam.value;I.tr.addInPlace(C.tr),g++}})),I.tr.scaleInPlace(1/g)}}this.globalXfoParam.value=I,this.groupTransformOp.setBindXfo(I),this.memberXfoOps.forEach((A=>A.enable())),this.calculatingGroupXfo=!1}bindItem(A,g){if(super.bindItem(A,g),A instanceof ag){if(this.isSelected()){const g=this.getHighlight();g.a=.2;const I="kinematicGroupItemHighlight"+this.getId();A.addHighlight(I,g,!0)}{const I=A.globalXfoParam,C=new iC(this.groupTransformParam,I);this.memberXfoOps.splice(g,0,C),this.__itemsEventHandlers[g]||(this.__itemsEventHandlers[g]={});this.__itemsEventHandlers[g]["BoundingBox.valueChanged"]=A.boundingBoxParam.on("valueChanged",(A=>{this.setBoundingBoxDirty()}))}}}unbindItem(A,g){if(super.unbindItem(A,g),A instanceof ag){if(this.isSelected()){const g="kinematicGroupItemHighlight"+this.getId();A.removeHighlight(g,!0)}this.memberXfoOps[g].detach(),this.memberXfoOps.splice(g,1),this.setBoundingBoxDirty()}}addItem(A,g=!0){super.addItem(A,g),g&&this.calcGroupXfo()}removeItem(A,g=!0){super.removeItem(A,g),g&&this.calcGroupXfo()}setItems(A){super.setItems(A),this.calcGroupXfo()}clearItems(A=!0){super.clearItems(A),this.memberXfoOps=[],A&&this.calcGroupXfo()}loadDone(){this.calculatingGroupXfo=!0,this.calcGroupXfo(),this.calculatingGroupXfo=!1}clone(A){const g=new tC;return g.copyFrom(this,A),g}}e.register("KinematicGroup",tC);class BC extends xI{constructor(A){super(A),this.materialParam=new rg("Material"),this.__backupMaterials={},this.addParameter(this.materialParam),this.materialParam.on("valueChanged",(()=>{this.updateMaterial()}))}updateHighlight(){this.__updateHighlightHelper()}__updateHighlightHelper(){let A,g=!1;this.isSelected()&&(A=this.getHighlight(),g=!0,A.a=.2);const I="kinematicGroupItemHighlight"+this.getId();Array.from(this.itemsParam.value).forEach((C=>{C instanceof ag&&(g?C.addHighlight(I,A,!0):C.removeHighlight(I,!0))}))}setSelected(A){super.setSelected(A),this.updateHighlight()}updateOpacity(){super.updateOpacity(),Array.from(this.itemsParam.value).forEach((A=>{A instanceof ag&&(A.opacityParam.value=this.opacity)}))}updateMaterial(){this.updateMaterialHelper()}updateMaterialHelper(){const A=this.materialParam.value;Array.from(this.itemsParam.value).forEach((g=>{g.traverse((g=>{if(g instanceof LI){const I=g.materialParam;if(A){const g=I.value;g==A||g&&"LinesShader"==g.getShaderName()||(this.__backupMaterials[I.getId()]=g,I.value=A)}else this.__backupMaterials[I.getId()]&&(I.value=this.__backupMaterials[I.getId()])}}))}))}bindItem(A,g){if(super.bindItem(A,g),!(A instanceof ag))return;if(this.isSelected()){const g=this.getHighlight();g.a=.2;const I="materialGroupItemHighlight"+this.getId();A.addHighlight(I,g,!0)}const I=this.materialParam.value;I&&A.traverse((A=>{if(A instanceof LI){const g=A.materialParam;if(I){const A=g.value;A==I||A&&"LinesShader"==A.getShaderName()||(this.__backupMaterials[g.getId()]=A,g.value=I)}}}),!0),A.opacityParam.value=this.opacity}unbindItem(A,g){if(super.unbindItem(A,g),A instanceof ag&&this.isSelected()){const g="materialGroupItemHighlight"+this.getId();A.removeHighlight(g,!0)}}clone(A){const g=new BC(this.__name+"clone");return g.copyFrom(this,A),g}}e.register("MaterialGroup",BC);class oC extends eg{constructor(A,g){super(),this.groupGlobalXfo=new Bg("GroupGlobalXfo"),this.cuttingPlane=new Ig("CuttingPlane"),this.groupGlobalXfo.setParam(A),this.cuttingPlane.setParam(g),this.addInput(this.groupGlobalXfo),this.addOutput(this.cuttingPlane)}evaluate(){const A=this.groupGlobalXfo.getValue(),g=A.ori.getZaxis(),I=A.tr.dot(g);this.cuttingPlane.setClean(new s(g.x,g.y,g.z,-I))}}class sC extends xI{constructor(A=""){super(A),this.cutAwayEnabledParam=new fA("CutAwayEnabled",!1),this.cutPlaneParam=new UA("CutPlane",new s(1,0,0)),this.addParameter(this.cutAwayEnabledParam),this.addParameter(this.cutPlaneParam),this.cutPlaneOp=new oC(this.globalXfoParam,this.cutPlaneParam),this.cutAwayEnabledParam.on("valueChanged",(A=>{this.updateCutaway(A)})),this.cutPlaneParam.on("valueChanged",(A=>{this.updateCutaway(A)}));const g=new XI("plane","FlatSurfaceShader");g.getParameter("BaseColor").value=new l(1,1,1,.2);const I=new kI("PlaneGeom",new AI(1,1),g);I.setSelectable(!1),this.addChild(I);const C=new XI("border","LinesShader");C.getParameter("BaseColor").value=new l(1,0,0,1);const i=new kI("BorderGeom",new xg(1,1),C);i.setSelectable(!1),this.addChild(i)}updateCutaway(A){const g=this.cutAwayEnabledParam.value,I=this.cutPlaneParam.value,C=I.xyz,i=I.w;A instanceof LI?(A.setCutawayEnabled(g),A.setCutVector(C),A.setCutDist(i)):Array.from(this.itemsParam.value).forEach((A=>{A.traverse((A=>{A instanceof LI&&(A.setCutawayEnabled(g),A.setCutVector(C),A.setCutDist(i))}),!0)}))}bindItem(A,g){if(!(A instanceof ag))return;this.cutAwayEnabledParam.value&&this.updateCutaway(A);const I=new b;Array.from(this.itemsParam.value).forEach((A=>{A instanceof ag&&I.addBox3(A.boundingBoxParam.value)}));{const A=I.p1.x-I.p0.x,g=I.p1.y-I.p0.y,C=new m;C.sc.set(A,g,1),this.getChild(0).localXfoParam.value=C,this.getChild(1).localXfoParam.value=C}}unbindItem(A,g){A instanceof ag&&A.traverse((A=>{A instanceof LI&&A.setCutawayEnabled(!1)}),!0)}clone(A){const g=new sC;return g.copyFrom(this,A),g}}e.register("CuttingPlane",sC);class aC extends $I{constructor(A){super(A),this.cadfileVersion=new WA("0,0,0"),this.metadataLoaded=!1}clone(A){const g=new aC;return g.copyFrom(this,A),g}copyFrom(A,g){super.copyFrom(A,g),A.loaded||A.once("geomsLoaded",(A=>{this.emit("geomsLoaded",A)}))}getVersion(){return this.cadfileVersion}readRootLevelBinary(A,g){g.versions={},g.versions["zea-cad"]=new WA(A.loadStr()),g.sdk=A.loadStr(),this.sdk=g.sdk,this.cadfileVersion=g.versions["zea-cad"],super.readBinary(A,g)}load(A,I=new AC){return this.loadPromise||(this.loadPromise=new Promise(((C,i)=>{const e=A.lastIndexOf("/")>-1?A.substring(0,A.lastIndexOf("/"))+"/":"",t=A.lastIndexOf("/")>-1?A.substring(A.lastIndexOf("/")+1):"",B=t.substring(0,t.lastIndexOf("."));this.url=A,(I=I.clone()).assetItem=this,I.url=A,I.folder=e,I.on("done",(()=>{this.loaded=!0,C(),this.emit("loaded");const A=[];this.geomLibrary.isLoaded()||A.push(new Promise((A=>this.geomLibrary.once("loaded",A)))),this.traverse((A=>{A instanceof aC&&!A.geomLibrary.isLoaded()&&new Promise((g=>A.once("geomsLoaded",g)))})),Promise.all(A).then((()=>{this.emit("geomsLoaded")}))})),I.incrementAsync(),FA.incrementWorkload(1),this.geomLibrary.once("loaded",(()=>{FA.incrementWorkDone(1)})),FA.loadFile("archive",A).then((C=>{if(!C.tree2&&!C.tree)return console.error("Corrupt zcad file. Missing 'tree':",A),FA.incrementWorkDone(1),void I.decrementAsync();const i=new YA((C.tree2||C.tree).buffer,0,g.isMobileDevice),o=this.getName();if(this.readRootLevelBinary(i,I),""!=o&&this.setName(o),I.versions["zea-cad"]=this.getVersion(),I.versions["zea-engine"]=this.getEngineDataVersion(),C.geoms)this.geomLibrary.readBinaryBuffer(t,C.geoms.buffer,I),C.geomsdata&&(this.geomLibrary.loadMetadata(C.geomsdata,I),this.metadataLoaded=!0);else if(C["geomLibrary.json"]){const g=JSON.parse(new TextDecoder("utf-8").decode(C["geomLibrary.json"])),i=e+B;0==g.numGeomFiles?(console.error("Corrupt zcad file. Missing 'geoms':",A),FA.incrementWorkDone(1)):this.geomLibrary.loadGeomFilesStream(g,i,I)}else FA.incrementWorkDone(1);I.decrementAsync()}),(A=>{I.decrementAsync(),FA.incrementWorkDone(1),this.emit("error",A),i(A)}))}))),this.loadPromise}loadMetadata(A=""){return this.metadataLoaded?Promise.resolve():(this.metadataLoadPromise||(this.metadataLoadPromise=new Promise(((g,I)=>{if(this.metadataLoaded&&g(),""==A){const g=this.url,I=g.substring(0,g.lastIndexOf("."));A=I+".zmetadata"}console.log(A),FA.incrementWorkload(),FA.loadFile("archive",A).then((A=>{const I=new AC;I.versions["zea-cad"]=this.getVersion(),I.versions["zea-engine"]=this.getEngineDataVersion(),this.geomLibrary.loadMetadata(A.geomsdata,I),FA.incrementWorkDone(1),this.metadataLoaded=!0,g()}),(A=>{FA.incrementWorkDone(1),this.emit("error",A),I(A)}))}))),this.metadataLoadPromise)}}e.register("CADAsset",aC);class lC extends ag{constructor(A){super(A)}clone(A){const g=new lC;return g.copyFrom(this,A),g}}e.register("CADAssembly",lC);class nC extends ag{constructor(A){super(A)}clone(A){const g=new nC;return g.copyFrom(this,A),g}}e.register("CADPart",nC);class dC extends kI{constructor(A){super(A),this.shattered=!1}setShatterState(A){this.shattered!=A&&(this.shattered=A,this.emit("shatterStateChanged",new x(A)))}clone(A){const g=new dC;return g.copyFrom(this,A),g}readBinary(A,g){if(g.versions["zea-engine"].compare([3,9,0])<0){if(LI.prototype.readBinary.call(this,A,g),A.loadSInt32(),g.versions["zea-cad"].compare([0,0,4])<0){const I=A.loadStr();let C=g.assetItem.getMaterialLibrary().getMaterial(I,!1);C||(C=new XI(I,"SimpleSurfaceShader"),C.getParameter("BaseColor").setValue(l.random(.25)),g.assetItem.getMaterialLibrary().addMaterial(C)),this.materialParam.setValue(C)}if(g.versions["zea-cad"].compare([0,0,2])>=0&&g.versions["zea-cad"].compare([0,0,4])<0){this.__layers=A.loadStrArray();for(const A of this.__layers)g.addGeomToLayer(this,A)}}else super.readBinary(A,g)}}e.register("CADBody",dC);const hC=new jg(1,1,1);let cC=null;class rC extends kI{addHighlight(A,g,I=!1){}removeHighlight(A,g=!1){}}class GC extends ag{constructor(A){super(A),this.materialMapping={}}clone(A){const g=new GC;return g.copyFrom(this,A),g}setSelected(A){super.setSelected(A),A?this.activate():this.deactivate()}activate(){}deactivate(){}addHighlight(A,g,I=!1){if(super.addHighlight(A,g,!1),I){const A=g.clone();A.a=1;const I={};this.traverse((g=>{if(g instanceof rC)return!1;if(g instanceof kI){const C=g.materialParam.value;if(this.materialMapping[g.getId()]=C,!(C.getId()in I)){const i=C.clone();if(i.hasParameter("BaseColor")){const g=i.getParameter("BaseColor");g instanceof Qg&&(g.colorSpace=pA.Gamma),g.setValue(A)}if(i.hasParameter("EdgeColor")){const g=i.getParameter("EdgeColor");g instanceof Qg&&(g.colorSpace=pA.Gamma),g.setValue(A)}i.hasParameter("Overlay")&&i.getParameter("Overlay").setValue(.85),i.__isOpaque=!1,g.materialParam.value=i,I[C.getId()]=i}g.materialParam.value=I[C.getId()]}}))}const C=this.getOwner().getOwner().getOwner();if(C){const I={},i={},e=this.getParameter("LinkedEntities");if(e){e.getValue().forEach(((e,t)=>{if(""==e)return;const B=e.split(", "),o=B.pop();try{const e=C.resolvePath(B);if(e&&e instanceof dC)if(0==e.getNumChildren())e.setShatterState(!0),I[e.getId()]||(I[e.getId()]=e,i[e.getId()]=[]),i[e.getId()].push(o);else{const I=e.getChildByName(o);I&&I.addHighlight(A,g,!0)}else console.log("linkedEntity.addHighlight(name, color, true):",B)}catch(A){console.log(t+":"+A.message)}}));for(let C in I){const e=I[C],t=i[C];e.addHighlight(A+":"+t.toString(),g,!0)}}}}removeHighlight(A,g=!1){super.removeHighlight(A,!1),g&&this.traverse((A=>{A instanceof kI&&A.getId()in this.materialMapping&&(A.materialParam.value=this.materialMapping[A.getId()],delete this.materialMapping[A.getId()])}));const I=this.getOwner().getOwner().getOwner();if(I){const g={},C={},i=this.getParameter("LinkedEntities");if(i){i.getValue().forEach((i=>{if(""==i)return;const e=i.split(", "),t=e.pop();try{const i=I.resolvePath(e);if(i&&i instanceof dC)if(0==i.getNumChildren())i.setShatterState(!1),g[i.getId()]||(g[i.getId()]=i,C[i.getId()]=[]),C[i.getId()].push(t);else{const g=i.getChildByName(t);g&&g.removeHighlight(A,!0)}else console.log("linkedEntity.addHighlight(name, color, true):failed")}catch(A){console.log(A.message)}}));for(let I in g){const i=g[I],e=C[I];i.removeHighlight(A+":"+e.toString(),!0)}}}}readBinary(A,g){super.readBinary(A,g),this.traverse((A=>{if(A instanceof kI){const g=A.materialParam.value;"StandardSurfaceShader"==g.getShaderName()&&g.setShaderName("FlatSurfaceShader"),A.__opacity=.99}})),g.assetItem.getGeometryLibrary().once("loaded",(()=>{this.traverse((A=>{if(A.getName().startsWith("Text")){const g=[];return A.traverse((A=>{if(A instanceof kI){const I=A.geomParam.value.getBoundingBox();cC||(cC=new YI("plane"),cC.baseColorParam.value=new l(1,1,0,.001),cC.overlayParam.value=-.001);const C=new rC("plane",hC,cC),i=A.localXfoParam.value.multiply(A.geomOffsetXfoParam.value);i.tr.addInPlace(I.center()),i.sc.multiplyInPlace(I.diagonal()),C.localXfoParam.value=i,g.push(C)}}),!1),g.forEach((g=>A.addChild(g,!1))),!1}}),!1)}))}}e.register("PMIItem",GC);class mC extends GC{constructor(A){super(A),this.camera=null}clone(A){const g=new mC;return g.copyFrom(this,A),g}activate(){super.activate();let A=[];this.hasParameter("GraphicalElements")&&(A=this.getParameter("GraphicalElements").getValue());const g=(()=>{let A=this;for(;A&&!(A instanceof aC);)A=A.getParentItem();return A instanceof aC?A:null})(),I=this.getParentItem().getParentItem(),C=I.getParentItem();if(C){const g=[];I.traverse((A=>{A instanceof mC||A instanceof GC&&g.push(A)})),g.forEach((g=>{const I=A.includes(g.getName());g.setVisible(I)}))}if(this.camera){const A=this.localXfoParam.value.clone(),I=this.getParameter("TargetPoint").getValue().clone(),C=this.getParameter("CameraType").getValue();A.tr.scaleInPlace(g.unitsScale),I.scaleInPlace(g.unitsScale);const i=A.tr.distanceTo(I);if(A.sc.set(1,1,1),this.camera.globalXfoParam.value=A,this.camera.setFocalDistance(i),"Camera_Orthographic"==C&&(this.camera.setIsOrthographic(1,0),this.hasParameter("CameraZoom")&&g)){const A=1/this.getParameter("CameraZoom").getValue()*g.unitsScale*2;this.camera.setFrustumHeight(A)}}if(this.hasParameter("ClippingPlaneOrigin")){const A=this.getParameter("ClippingPlaneOrigin").getValue(),I=this.getParameter("ClippingPlaneNormal").getValue(),i=!0,e=-A.dot(I)*g.unitsScale;C.traverse((A=>{if(A instanceof GC)return!1;A instanceof kI&&(A.setCutawayEnabled(i),A.setCutVector(I),A.setCutDist(e))}))}else C.traverse((A=>{if(A instanceof GC)return!1;A instanceof kI&&A.setCutawayEnabled(!1)}))}deactivate(){super.deactivate()}readBinary(A,g){super.readBinary(A,g),g.camera&&(this.camera=g.camera)}}e.register("PMIView",mC);class QC extends aC{constructor(A){super(A)}clone(A){const g=new QC;return g.copyFrom(this,A),g}readBinary(A,g){A.loadStr();const I=A.loadStr();this.setName(I);let C=A.loadStr();const i=new m;if(g.versions["zea-cad"].compare([3,6,2])>0?(i.tr=A.loadFloat32Vec3(),i.ori=A.loadFloat32Quat(),this.localXfoParam.value=i):""==I&&this.setName(C),g.incrementAsync(),g.xrefs[C]){const A=g.xrefs[C],e=()=>{this.copyFrom(A),this.setName(I),this.localXfoParam.value=i,this.loaded=!0,this.emit("loaded"),g.decrementAsync()};A.loaded?e():A.on("loaded",e)}else{let A;g.resources?g.resources[C]?A=g.resources[C]:(C.includes("/")?C=C.slice(C.lastIndexOf("/")+1):C.includes("\\")&&(C=C.slice(C.lastIndexOf("\\")+1)),g.resources[C]?A=g.resources[C]:g.xrefLoadCallback&&(A=g.xrefLoadCallback.call(g,C,this))):g.xrefLoadCallback?A=g.xrefLoadCallback.call(g,C,this):(C.includes("/")?C=C.slice(C.lastIndexOf("/")+1):C.includes("\\")&&(C=C.slice(C.lastIndexOf("\\")+1)),A=g.folder+C+".zcad"),A?(g.xrefs[C]=this,this.load(A,new AC(g)).then((()=>{g.decrementAsync()}),(()=>{g.decrementAsync()}))):(g.decrementAsync(),console.warn(`While Loading ${this.getPath()} unable to resolve ${C}`))}}}e.register("XRef",QC);const EC={OPAQUE:1,TRANSPARENT:2,OVERLAY:4};class bC extends nA{constructor(){super(),this.enabled=!0,this.passIndex=-1,this.__gl=null,this.renderer=null,this.__renderer=null,this.enabledParam=new fA("Enabled",!0),this.enabled=!0,this.passIndex=0,this.addParameter(this.enabledParam),this.enabledParam.on("valueChanged",(()=>this.enabled=this.enabledParam.value))}parameterValueChanged(A){super.parameterValueChanged(A),this.renderer&&this.renderer.requestRedraw()}init(A,g){if(null==g)throw new Error("Missing constructor argument.");this.__gl=A.gl,this.renderer=A,this.__renderer=A,this.passIndex=g}setPassIndex(A){this.passIndex=A}getPassType(){return EC.OPAQUE}itemAddedToScene(A,g){throw Error(`${this.constructor.name} must implement itemAddedToScene and itemRemovedFromScene`)}itemRemovedFromScene(A,g){throw Error(`${this.constructor.name} must implement itemAddedToScene and itemRemovedFromScene`)}startPresenting(){}stopPresenting(){}draw(A){throw Error("draw not implemented on GLPass")}drawHighlightedGeoms(A){}drawGeomData(A){}getGeomItemAndDist(A){throw Error("getGeomItemAndDist not implemented on GLPass")}}class ZC extends ag{constructor(A=5,g=50,I=new l("#DCDCDC")){super("GridTree"),this.disableBoundingBox=!0,this.setSelectable(!1);const C=new KI("gridMaterial");C.baseColorParam.value=I,C.overlayParam.value=0;const i=new Pg(A,A,g,g,!0),e=new kI("GridItem",i,C);e.setSelectable(!1),this.addChild(e,!1);const t=new Yg;t.setNumVertices(2),t.setNumSegments(1),t.setSegmentVertexIndices(0,0,1);const B=t.getVertexAttribute("positions");B.getValueRef(0).set(-.5*A,0,0),B.getValueRef(1).set(.5*A,0,0);const s=new KI("gridXAxisMaterial");s.baseColorParam.value=new l(I.luminance(),0,0),s.overlayParam.value=0;const a=new kI("xAxisLine",t,s);a.setSelectable(!1),this.addChild(a,!1);const n=new KI("gridYAxisMaterial");n.baseColorParam.value=new l(0,I.luminance(),0),n.overlayParam.value=0;const d=new kI("yAxisLine",t,n);d.setSelectable(!1);const h=new m;h.ori.setFromAxisAndAngle(new o(0,0,1),.5*Math.PI),d.geomOffsetXfoParam.value=h,this.addChild(d,!1)}_cleanBoundingBox(){return new b}}e.register("GridTreeItem",ZC);const yC=new l("#DCDCDC");class uC{constructor(){this.envMapParam=new OA("EnvMap"),this.displayEnvMapParam=new fA("Display EnvMap",!1),this.envMapLODParam=new JA("EnvMapLOD",0),this.root=new ag("root")}getRoot(){return this.root}getResourceLoader(){return FA}setEnvMap(A){this.envMapParam.value=A}setupGrid(A=5,g=50,I=yC){const C=new ZC(A,g,I);return this.root.addChild(C,!1),C}}class RC extends $I{constructor(A){super(A),this.geomLibrary.on("loaded",(()=>{this.emit("geomsLoaded")}))}readBinary(A,g){g.versions["zea-engine"]||(g.versions["zea-mesh"]=new WA(A.loadStr()));const I=A.loadUInt32();return super.readBinary(A,g),g.versions["zea-engine"].compare([2,1,0])<0&&A.loadFloat32Vec2(),this.geomLibrary.setNumGeoms(A.loadUInt32()),I}load(A,I=new AC){return new Promise(((C,i)=>{const e=A.lastIndexOf("/")>-1?A.substring(0,A.lastIndexOf("/"))+"/":"",t=A.lastIndexOf("/")>-1?A.substring(A.lastIndexOf("/")+1):"",B=t.substring(0,t.lastIndexOf("."));let o=0;I.assetItem=this,I.url=A,I.folder=e,FA.incrementWorkload(1),this.geomLibrary.on("loaded",(()=>{FA.incrementWorkDone(1)})),FA.loadFile("archive",A).then((A=>{let i;if(A.tree2)i=new YA(A.tree2.buffer,0,g.isMobileDevice);else{const C=A.tree?A.tree:A[Object.keys(A)[0]];i=new YA(C.buffer,0,g.isMobileDevice),I.versions["zea-engine"]=new WA}if(o=this.readBinary(i,I),this.loaded=!0,this.emit("loaded"),0==o&&A.geoms)this.geomLibrary.readBinaryBuffer(t,A.geoms.buffer,I);else{const A=e+B,g={numGeomsPerFile:o,numGeoms:this.geomLibrary.getNumGeoms()};this.geomLibrary.loadGeomFilesStream(g,A,I)}C()}),(A=>{this.emit("error",A),i(A)}))}))}}e.register("VLAAsset",RC);class VC extends nA{constructor(){super(),this.__activated=!1}activateTool(){if(this.__activated)throw new Error("Tool already activate");this.__activated=!0,this.emit("activatedChanged",{activated:this.__activated})}deactivateTool(){this.__activated=!1,this.emit("activatedChanged",{activated:this.__activated})}onPointerDown(A){}onPointerMove(A){}onPointerUp(A){}onPointerDoublePress(A){}onPointerEnter(A){}onPointerLeave(A){}onWheel(A){}onKeyDown(A){}onKeyUp(A){}onTouchCancel(A){}}const FC={pan:0,dolly:1,focussing:2,look:3,turntable:4,tumbler:5,trackball:6};class SC extends VC{constructor(A){super(),this.orbitAroundCursor=!1,this.zoomTowardGeomUnderCursor=!1,this.aimFocusOnTouchTap=2,this.aimFocusOnMouseClick=2,this.enabledWASDWalkMode=!1,this.defaultManipulationState=FC.turntable,this.pointerDown=!1,this.dragging=0,this.keyboardMovement=!1,this.keysPressed=[],this.velocity=new o,this.prevVelocityIntegrationTime=-1,this.ongoingTouches={},this.mouseWheelMovementDist=0,this.mouseWheelZoomCount=0,this.mouseWheelZoomId=-1,this.orbitRateParam=new JA("OrbitRate",g.isMobileDevice?.5:1),this.dollySpeedParam=new JA("DollySpeed",.02),this.mouseWheelDollySpeedParam=new JA("MouseWheelDollySpeed",.1),this.walkSpeedParam=new JA("WalkSpeed",5),this.walkModeCollisionDetection=new fA("WalkModeCollisionDetection",!1),this.appData=A,this.defaultManipulationState=FC.turntable,this.manipulationState=this.defaultManipulationState,this.addParameter(this.orbitRateParam),this.addParameter(this.dollySpeedParam),this.addParameter(this.mouseWheelDollySpeedParam),this.addParameter(this.walkSpeedParam),this.addParameter(this.walkModeCollisionDetection)}activateTool(){super.activateTool(),this.appData&&this.appData.renderer&&(this.prevCursor=this.appData.renderer.getGLCanvas().style.cursor,this.appData.renderer.getGLCanvas().style.cursor="cursor")}deactivateTool(){super.deactivateTool(),this.appData&&this.appData.renderer&&(this.appData.renderer.getGLCanvas().style.cursor=this.prevCursor)}setDefaultManipulationMode(A){if(this.defaultManipulationState="string"==typeof A?FC[A]:A,!Object.values(FC).includes(this.defaultManipulationState))throw new Error("Invalid Camera Manipulation Mode. Must be one of "+Object.keys(FC))}look(A,g){const{viewport:I}=A,C=I.getCamera(),i=this.orbitRateParam.value,e=C.globalXfoParam.value,t=new c;t.rotateZ(g.x/I.getWidth()*Math.PI*i),e.ori=t.multiply(e.ori);const B=new c;B.rotateX(g.y/I.getHeight()*Math.PI*i),e.ori.multiplyInPlace(B),C.globalXfoParam.value=e}turntable(A,g){const{viewport:I}=A,C=I.getCamera(),i=this.orbitRateParam.value,e=C.globalXfoParam.value,t=e.ori.inverse().rotateVec3(e.tr.subtract(this.orbitTarget)),B=new c;B.rotateZ(g.x/I.getWidth()*2*Math.PI*-i),e.ori=B.multiply(e.ori);const o=new c;o.rotateX(g.y/I.getHeight()*Math.PI*-i),e.ori.multiplyInPlace(o),e.tr=this.orbitTarget.add(e.ori.rotateVec3(t)),C.globalXfoParam.value=e}tumbler(A,g){const{viewport:I}=A,C=I.getCamera(),i=this.orbitRateParam.value,e=C.globalXfoParam.value,t=e.ori.getXaxis(),B=e.ori.getYaxis(),o=e.ori.getZaxis(),s=t.scale(-g.x).add(B.scale(g.y)).cross(o);s.normalizeInPlace();const a=g.length(),l=e.ori.inverse().rotateVec3(e.tr.subtract(this.orbitTarget)),n=new c;n.setFromAxisAndAngle(s,a/I.getWidth()*Math.PI*-i),e.ori=n.multiply(e.ori),e.tr=this.orbitTarget.add(e.ori.rotateVec3(l)),C.globalXfoParam.value=e}trackball(A,g){const{viewport:I}=A,C=I.getCamera(),i=this.orbitRateParam.value,e=C.globalXfoParam.value,t=e.ori.getXaxis(),B=e.ori.getYaxis(),o=e.ori.getZaxis(),s=t.scale(-g.x).add(B.scale(g.y)).cross(o);s.normalizeInPlace();const a=g.length(),l=e.ori.inverse().rotateVec3(e.tr.subtract(this.orbitTarget)),n=new c;n.setFromAxisAndAngle(s,a/I.getWidth()*Math.PI*-i),e.ori=n.multiply(e.ori),e.tr=this.orbitTarget.add(e.ori.rotateVec3(l)),C.globalXfoParam.value=e}pan(A,g){const{viewport:I}=A,C=I.getCamera(),i=new m,e=new o(1,0,0),t=new o(0,1,0);if(C.isOrthographic()){const A=C.getFrustumHeight(),B=A*(I.getWidth()/I.getHeight());i.tr=e.scale(-g.x/I.getWidth()*B),i.tr.addInPlace(t.scale(g.y/I.getHeight()*A))}else{const A=C.getFocalDistance(),B=C.getFov(),o=2*A*Math.tan(.5*B),s=o*(I.getWidth()/I.getHeight());i.tr=e.scale(-g.x/I.getWidth()*s),i.tr.addInPlace(t.scale(g.y/I.getHeight()*o))}const B=C.globalXfoParam.value;C.globalXfoParam.value=B.multiply(i)}dolly(A,g){const{viewport:I}=A,C=I.getCamera(),i=C.getFocalDistance(),e=()=>{const A=g.y*this.dollySpeedParam.value*i,I=new m;I.tr.set(0,0,A);const e=C.globalXfoParam.value;C.globalXfoParam.value=e.multiply(I)},t=()=>{const A=g.y*this.dollySpeedParam.value,I=C.getFrustumHeight(),i=I*A;C.setFrustumHeight(I+i)};C.isOrthographic()?t():e()}initDrag(A){const{pointerPos:g}=A;A.setCapture(this),this.pointerDown=!0;const I=A.viewport.getCamera(),C=I.globalXfoParam.value;if(this.orbitAroundCursor)if(null!=A.intersectionData&&this.orbitAroundCursor){this.orbitTarget=A.intersectionData.intersectionPos;const g=C.inverse().transformVec3(A.intersectionData.intersectionPos);I.setFocalDistance(-g.z)}else A.pointerRay?this.orbitTarget=A.pointerRay.pointAtDist(I.getFocalDistance()):this.orbitTarget=C.tr.add(C.ori.getZaxis().scale(-I.getFocalDistance()));else this.orbitTarget=C.tr.add(C.ori.getZaxis().scale(-I.getFocalDistance()));this.prevPointerPos=g,this.dragging=1}endDrag(A){A.getCapture()==this&&A.releaseCapture(),this.dragging=0,this.pointerDown=!1}aimFocus(A,g,I=-1,C=400){this.focusIntervalId&&clearInterval(this.focusIntervalId);const i=Math.round(C/20),e=this.manipulationState;let t=0;const B=()=>{const C=A.globalXfoParam.value,o=A.getFocalDistance(),s=g.subtract(C.tr),a=s.normalizeInPlace(),l=C.clone();if(e==FC.turntable||e==FC.look){{const A=C.ori.getZaxis().clone();A.z=0;const g=s.negate();g.z=0;const I=new c;I.setFrom2Vectors(A,g),l.ori=I.multiply(l.ori)}{const A=C.ori.getXaxis().clone(),g=C.ori.getZaxis().clone(),I=s.negate();I.subtractInPlace(A.scale(I.dot(A))),I.normalizeInPlace();const i=new c;g.cross(I).dot(A)>0?i.rotateX(g.angleTo(I)):i.rotateX(-g.angleTo(I)),l.ori=l.ori.multiply(i)}{const A=l.ori.getXaxis().clone(),g=A.clone();g.z=0,g.normalizeInPlace();const I=new c;I.setFrom2Vectors(A,g),l.ori=I.multiply(l.ori)}}else{const A=C.ori.getZaxis().clone(),g=s.negate(),I=new c;I.setFrom2Vectors(A,g),l.ori=I.multiply(l.ori)}const n=Math.pow(t/i,2),d=C.clone();if(d.ori=C.ori.lerp(l.ori,n),I>0){const A=s.scale(a-I);d.tr.addInPlace(A.scale(n))}A.setFocalDistance(o+(a-o)*n),A.globalXfoParam.value=d,t++,t<=i?this.focusIntervalId=setTimeout(B,20):(this.focusIntervalId=void 0,this.emit("movementFinished"),A.emit("movementFinished"))};B()}orientPointOfView(A,g,I,C=0,i=400){this.focusIntervalId&&clearInterval(this.focusIntervalId);const e=Math.round(i/20);let t=0;const B=()=>{const i=A.globalXfoParam.value,o=A.getTargetPosition(),s=Math.pow(t/e,2),a=g.subtract(i.tr),l=a.normalizeInPlace(),n=a.scale(l-C),d=i.tr.add(n.scale(s)),h=o.lerp(I,s);A.setPositionAndTarget(d,h),t++,t<=e?this.focusIntervalId=setTimeout(B,20):(this.focusIntervalId=void 0,this.emit("movementFinished"),A.emit("movementFinished"))};B()}onPointerDoublePress(A){const g=g=>{const I=A.viewport.getCamera(),C=I.globalXfoParam.value.tr.add(g.dir.scale(A.intersectionData.dist));this.aimFocus(I,C),A.aimTarget=C,A.aimDistance=A.intersectionData.dist,this.emit("aimingFocus",A),I.emit("aimingFocus",A),A.stopPropagation()};if(A.intersectionData&&this.aimFocusOnMouseClick){if(A.pointerType===q.mouse&&2==this.aimFocusOnMouseClick){const I=A;g(I.pointerRay),I.preventDefault()}if(A.pointerType===q.touch&&2==this.aimFocusOnTouchTap){g(A.pointerRay)}}}onPointerDown(A){if(A.pointerType===q.mouse){1==this.dragging&&this.endDrag(A),this.initDrag(A);const g=A;2==g.button?this.manipulationState=FC.pan:g.ctrlKey&&g.altKey?this.manipulationState=FC.dolly:g.ctrlKey||2==g.button?this.manipulationState=FC.look:this.manipulationState=this.defaultManipulationState,g.preventDefault()}else A.pointerType===q.touch&&this._onTouchStart(A);A.stopPropagation()}onPointerMove(A){0!=this.dragging&&(A.pointerType===q.mouse&&this._onMouseMove(A),A.pointerType===q.touch&&this._onTouchMove(A),this.dragging=2,A.stopPropagation())}_onMouseMove(A){if(!this.pointerDown)return;const g=A.pointerPos,I=g.subtract(this.prevPointerPos);switch(this.manipulationState){case FC.turntable:this.turntable(A,I);break;case FC.tumbler:this.tumbler(A,I);break;case FC.trackball:this.trackball(A,I);break;case FC.look:this.look(A,I);break;case FC.pan:this.pan(A,g.subtract(this.prevPointerPos));break;case FC.dolly:this.dolly(A,I)}this.prevPointerPos=g,A.preventDefault()}_onTouchMove(A){const g=A.touches;if(1==g.length){const I=g[0],C=new B(I.clientX,I.clientY),i=this.ongoingTouches[I.identifier];if(!i)return;const e=C.subtract(i.pos);switch(this.defaultManipulationState){case FC.look:e.scaleInPlace(6),this.look(A,e);break;case FC.turntable:this.turntable(A,e);break;case FC.tumbler:this.tumbler(A,e);break;case FC.trackball:this.trackball(A,e)}i.pos=C}else if(2==g.length){const I=g[0],C=this.ongoingTouches[I.identifier],i=g[1],e=this.ongoingTouches[i.identifier];if(!C||!e)return;const t=new B(I.clientX,I.clientY),s=new B(i.clientX,i.clientY),a=e.pos.subtract(C.pos).length()-s.subtract(t).length(),l=t.subtract(C.pos),n=s.subtract(e.pos),d=l.add(n);d.scaleInPlace(.5);const h=.002*a,{viewport:r}=A,G=r.getCamera(),Q=G.getFocalDistance(),E=G.getFov(),b=new o(1,0,0),Z=new o(0,1,0),y=2*Q*Math.tan(.5*E),u=y*(r.getWidth()/r.getHeight()),R=new m;R.tr=b.scale(-d.x/r.getWidth()*u),R.tr.addInPlace(Z.scale(d.y/r.getHeight()*y));const V=h*Q;switch(G.setFocalDistance(Q+V),R.tr.z+=V,this.defaultManipulationState){case FC.tumbler:case FC.trackball:const A=e.pos.subtract(C.pos),g=s.subtract(t);let I=A.normalize().angleTo(g.normalize());A.cross(g)<0&&(I=-I);const i=new c;i.rotateZ(I),R.ori.multiplyInPlace(i)}const F=G.globalXfoParam.value;G.globalXfoParam.value=F.multiply(R),C.pos=t,e.pos=s}}onPointerUp(A){if(1==this.dragging){if(this.endDrag(A),A.intersectionData&&(A.pointerType===q.mouse&&1==this.aimFocusOnMouseClick||A.pointerType===q.touch&&1==this.aimFocusOnTouchTap)){const g=A.viewport.getCamera(),I=g.globalXfoParam.value,C=(A.pointerType,A.pointerRay),i=I.tr.add(C.dir.scale(A.intersectionData.dist));this.aimFocus(g,i),A.aimTarget=i,A.aimDistance=A.intersectionData.dist,this.emit("aimingFocus",A),g.emit("aimingFocus",A),A.stopPropagation(),A.pointerType===q.mouse&&A.preventDefault()}}else if(2==this.dragging){if(A.pointerType===q.mouse){this.endDrag(A),this.emit("movementFinished");A.viewport.getCamera().emit("movementFinished")}else if(A.pointerType===q.touch){const g=A,{changedTouches:I,touches:C}=g;for(let A=0;A<I.length;A++)this.__endTouch(I[A]);0==Object.keys(this.ongoingTouches).length?this.endDrag(A):C.length||(this.endDrag(A),this.ongoingTouches={}),g.preventDefault()}A.stopPropagation()}}onPointerLeave(A){this.keysPressed.length>0&&(this.keysPressed=[],this.velocity.set(0,0,0),this.keyboardMovement=!1)}onWheel(A){const g=A.viewport.getCamera(),I=this.mouseWheelDollySpeedParam.value,C=A.shiftKey?.1:.5,i=g.globalXfoParam.value;let e;if(!g.isOrthographic())if(this.zoomTowardGeomUnderCursor)if(null!=A.intersectionData){e=i.tr.subtract(A.intersectionData.intersectionPos),e.normalizeInPlace();const I=i.inverse().transformVec3(A.intersectionData.intersectionPos);g.setFocalDistance(-I.z)}else{const I=A.pointerRay.pointAtDist(g.getFocalDistance());e=i.tr.subtract(I),e.normalizeInPlace()}else e=g.globalXfoParam.value.ori.getZaxis();const t=A.deltaY<0?-1:1,B=()=>{const A=g.getFocalDistance(),I=A*this.mouseWheelMovementDist;i.tr.addInPlace(e.scale(I)),g.setFocalDistance(A+I),g.globalXfoParam.value=i,this.mouseWheelZoomCount++,this.mouseWheelZoomCount<6?this.mouseWheelZoomId=window.setTimeout(B,10):(this.mouseWheelZoomId=-1,this.emit("movementFinished"),g.emit("movementFinished"))},o=()=>{const A=50*this.mouseWheelMovementDist;(new m).tr.set(0,0,A),i.tr.addInPlace(e.scale(A)),g.globalXfoParam.value=i},s=()=>{const I=g.getFrustumHeight(),C=I*this.mouseWheelMovementDist;if(g.setFrustumHeight(I+C),A.intersectionData&&this.zoomTowardGeomUnderCursor){const e=i.tr.subtract(A.intersectionData.intersectionPos),t=i.ori.getZaxis();e.subtractInPlace(t.scale(e.dot(t))),i.tr.addInPlace(e.scale(C/(I+C))),g.globalXfoParam.value=i}this.mouseWheelZoomCount++,this.mouseWheelZoomCount<6?this.mouseWheelZoomId=window.setTimeout(s,10):(this.mouseWheelZoomId=-1,this.emit("movementFinished"),g.emit("movementFinished"))};this.mouseWheelZoomId>0?(this.mouseWheelMovementDist+=t*I*C*.5/6,this.mouseWheelZoomCount=0):(this.mouseWheelMovementDist=t*I*C/6,this.mouseWheelZoomCount=0,g.isOrthographic()?s():A.ctrlKey?o():B()),A.preventDefault(),A.stopPropagation()}integrateVelocityChange(A){const{viewport:g}=A,I=g.getCamera(),C=performance.now();if(this.prevVelocityIntegrationTime>0){const A=(C-this.prevVelocityIntegrationTime)/1e3,i=this.walkSpeedParam.value;if(i>0){const C=new m;C.tr=this.velocity.normalize().scale(i*A);const e=I.globalXfoParam.value.multiply(C);if(this.walkModeCollisionDetection.value){const A=1.5,I=1.5,C=.5,i=new m(e.tr),t=new G(e.tr,new o(0,0,-1)),B=g.getRenderer().raycastCluster(i,t,I,C,EC.OPAQUE);if(B.length>0){let g=0;B.forEach((A=>{g+=A.dist})),g/=B.length,e.tr=t.start.add(t.dir.scale(g-A))}}I.globalXfoParam.value=e}}this.prevVelocityIntegrationTime=C}onKeyDown(A){if(!this.enabledWASDWalkMode)return;const g=A.key.toLowerCase();if(!this.keysPressed.includes(g)){switch(g){case"w":this.velocity.z-=1;break;case"s":this.velocity.z+=1;break;case"a":this.velocity.x-=1;break;case"d":this.velocity.x+=1;break;default:return}if(A.stopPropagation(),this.keysPressed.push(g),!this.keyboardMovement){this.keyboardMovement=!0,this.prevVelocityIntegrationTime=performance.now();const g=()=>{this.integrateVelocityChange(A),this.keyboardMovement&&window.requestAnimationFrame(g)};window.requestAnimationFrame(g)}}}onKeyUp(A){const g=A.key.toLowerCase();if(!this.keysPressed.includes(g))return;switch(g){case"w":this.velocity.z+=1;break;case"s":this.velocity.z-=1;break;case"a":this.velocity.x+=1;break;case"d":this.velocity.x-=1;break;default:return}A.stopPropagation();const I=this.keysPressed.indexOf(g);this.keysPressed.splice(I,1),0==this.keysPressed.length&&(this.keyboardMovement=!1)}__startTouch(A){this.ongoingTouches[A.identifier]={identifier:A.identifier,pos:new B(A.clientX,A.clientY)}}__endTouch(A){delete this.ongoingTouches[A.identifier]}_onTouchStart(A){const g=A.changedTouches;for(let A=0;A<g.length;A++)this.__startTouch(g[A]);this.initDrag(A)}onTouchEnd(A){A.preventDefault(),A.stopPropagation();const g=A.changedTouches;for(let A=0;A<g.length;A++)this.__endTouch(g[A]);0==Object.keys(this.ongoingTouches).length&&this.endDrag(A)}onTouchCancel(A){A.preventDefault();const g=A.touches;for(let A=0;A<g.length;A++)this.__endTouch(g[A]);0==Object.keys(this.ongoingTouches).length&&this.endDrag(A)}static get MANIPULATION_MODES(){return FC}}const wC=function(A,g){let I=null;if(null!=g.webglContextType)try{I=A.getContext(g.webglContextType,g),I.name=g.webglContextType}catch(A){}else{const C=["webgl2","webgl"];for(let i=0;i<C.length;i++){const e=C[i];try{I=A.getContext(e,g),I.name=e}catch(A){}if(I)break}}if(!I)throw new Error("WebGL not supported on your system");return I.sizeInBytes=function(A){switch(A){case this.BYTE:case this.UNSIGNED_BYTE:return 1;case this.SHORT:case this.UNSIGNED_SHORT:return 2;case this.INT:case this.UNSIGNED_INT:case this.FLOAT:return 4;default:throw new Error("unknown type")}},"webgl2"==I.name?(I.floatTexturesSupported=!0,I.__ext_float_linear=I.getExtension("OES_texture_float_linear"),I.__ext_texture_half_float_linear=I.getExtension("OES_texture_half_float_linear"),I.__ext_color_buffer_float=I.getExtension("EXT_color_buffer_float")):(I.__ext_float=I.getExtension("OES_texture_float"),I.__ext_float?(I.floatTexturesSupported=!0,I.__ext_float_linear=I.getExtension("OES_texture_float_linear")):console.warn("OES_texture_float is not available"),I.__ext_half_float=I.getExtension("OES_texture_half_float"),I.__ext_half_float&&(I.HALF_FLOAT=I.__ext_half_float.HALF_FLOAT_OES,I.floatTexturesSupported=!0,I.__ext_texture_half_float_linear=I.getExtension("OES_texture_half_float_linear")),I.__ext_color_buffer_float=I.getExtension("EXT_color_buffer_float"),I.__ext_std_derivatives=I.getExtension("OES_standard_derivatives"),I.__ext_Inst=I.getExtension("ANGLE_instanced_arrays"),I.__ext_Inst&&(I.vertexAttribDivisor=I.__ext_Inst.vertexAttribDivisorANGLE.bind(I.__ext_Inst),I.drawArraysInstanced=I.__ext_Inst.drawArraysInstancedANGLE.bind(I.__ext_Inst),I.drawElementsInstanced=I.__ext_Inst.drawElementsInstancedANGLE.bind(I.__ext_Inst)),I.__ext_VAO=I.getExtension("OES_vertex_array_object"),I.__ext_VAO&&(I.createVertexArray=I.__ext_VAO.createVertexArrayOES.bind(I.__ext_VAO),I.deleteVertexArray=I.__ext_VAO.deleteVertexArrayOES.bind(I.__ext_VAO),I.bindVertexArray=I.__ext_VAO.bindVertexArrayOES.bind(I.__ext_VAO)),I.__ext_element_index_uint=I.getExtension("OES_element_index_uint"),I.__ext_WEBGL_depth_texture=I.getExtension("WEBGL_depth_texture"),I.__ext_WEBGL_depth_texture&&(I.UNSIGNED_INT_24_8=I.__ext_WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL),I.DRAW_FRAMEBUFFER=I.FRAMEBUFFER),I.__ext_frag_depth=I.getExtension("EXT_frag_depth"),I.setupInstancedQuad=function(){const A=new Float32Array([0,1,2,3]),g=new Uint16Array([0,1,2,2,1,3]);this.__quadVertexIdsBuffer=this.createBuffer(),this.bindBuffer(this.ARRAY_BUFFER,this.__quadVertexIdsBuffer),this.bufferData(this.ARRAY_BUFFER,A,this.STATIC_DRAW),this.__quadIndexBuffer=this.createBuffer(),this.bindBuffer(this.ELEMENT_ARRAY_BUFFER,this.__quadIndexBuffer),this.bufferData(this.ELEMENT_ARRAY_BUFFER,g,this.STATIC_DRAW),this.__quadattrbuffers={vertexIDs:{buffer:this.__quadVertexIdsBuffer,dataType:"Float32",dimension:1,count:A.length,shared:!0}}},I.drawQuad=function(){this.drawElements(this.TRIANGLES,6,this.UNSIGNED_SHORT,0)},I},XC=function(A,g){if(!g.width||!g.height){if(!g.width)throw new Error("Invalid texture params. 'width' not provided");if(!g.height)throw new Error("Invalid texture params. 'height' not provided")}const I=A.getParameter(A.MAX_TEXTURE_SIZE);if(g.width<=0||g.width>I||g.height<=0||g.height>I)throw new Error("GLTextureParams: Invalid texture size. width:"+g.width+" height:"+g.height+" maxSize:"+I);const C={width:g.width,height:g.height},i=g=>isNaN(g)?A[g]:g,e=(A,I)=>{A in g?C[A]=i(g[A]):I&&(C[A]=i(I))};if(e("format"),e("internalFormat",C.format),e("type",A.UNSIGNED_BYTE),e("minFilter",g.filter?g.filter:A.LINEAR),e("magFilter",g.filter?g.filter:A.LINEAR),e("wrapS",g.wrapS?g.wrapS:A.CLAMP_TO_EDGE),e("wrapT",g.wrapT?g.wrapT:A.CLAMP_TO_EDGE),e("flipY",!1),e("mipMapped",!1),e("depthInternalFormat"),e("depthFormat"),e("depthType"),g.createDepthTexture&&("webgl2"==A.name||A.__ext_WEBGL_depth_texture?(A.name,C.depthFormat=A.DEPTH_COMPONENT,C.depthType=A.UNSIGNED_INT):C.depthType=A.UNSIGNED_SHORT),C.format==A.FLOAT)if("webgl2"==A.name)C.filter!=A.LINEAR||A.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),C.filter=A.NEAREST);else if(A.__ext_float)C.filter!=A.LINEAR||A.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),C.filter=A.NEAREST);else{if(!A.__ext_half_float)throw new Error("OES_texture_half_float is not available");C.format=A.HALF_FLOAT,C.filter!=A.LINEAR||A.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),C.filter=A.NEAREST)}else if(C.format==A.HALF_FLOAT)if("webgl2"==A.name);else{if(!A.__ext_half_float)throw new Error("OES_texture_half_float is not available");if(C.filter!=A.LINEAR||A.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),C.filter=A.NEAREST),C.channels==A.RGB)throw new Error("OES_texture_half_float onlysupports RGBA textures")}else if("sRGB"==C.format&&!A.__ext_sRGB)throw new Error("EXT_sRGB is not available");return null!=C.format&&"webgl2"==A.name&&C.internalFormat==C.format&&(C.type==A.FLOAT?C.format==A.RED?C.internalFormat=A.R32F:C.format==A.RG?C.internalFormat=A.RG32F:C.format==A.RGB?C.internalFormat=A.RGB32F:C.format==A.RGBA&&(C.internalFormat=A.RGBA32F):C.type==A.HALF_FLOAT?C.format==A.RED?C.internalFormat=A.R16F:C.format==A.RGB?C.internalFormat=A.RGB16F:C.format==A.RGBA&&(C.internalFormat=A.RGBA16F):C.type==A.UNSIGNED_BYTE&&(C.format==A.RED&&(C.internalFormat=A.R8),C.format==A.RGB?C.internalFormat=A.RGB8:C.format==A.RGBA&&(C.internalFormat=A.RGBA8))),null!=C.depthFormat&&("webgl2"==A.name?C.depthType==A.UNSIGNED_SHORT?C.depthInternalFormat=A.DEPTH_COMPONENT16:C.depthType==A.UNSIGNED_INT&&(C.depthInternalFormat=A.DEPTH_COMPONENT24):C.depthInternalFormat=C.depthFormat),C};class HC extends lA{constructor(A,g){if(super(),this.__image=null,this.__internalFormat=0,this.__type=0,this.__format=0,this.__wrapParam=0,this.params={},this.__minFilter=0,this.__magFilter=0,this.__wrapS=0,this.__wrapT=0,this.__flipY=!1,this.__mipMapped=!1,this.invert=!1,this.alphaFromLuminance=!1,this.__gltex=null,this.__typeParam="",this.__formatParam="",this.__gl=A,this.ready=!1,this.width=0,this.height=0,this.textureType=1,this.textureDesc=[0,0,0,0],this.__loaded=!1,this.__bound=!1,null!=g)if(g instanceof Gg){this.__image=g;const A=()=>{const A=this.__image.getParams(),g=A.width,I=A.height,C=A.data;this.bufferData(C,g,I)};this.__image.on("updated",A),this.__image.isLoaded()?this.configure(this.__image.getParams()):this.__image.on("loaded",(()=>{this.configure(this.__image.getParams())}))}else this.configure(g)}isLoaded(){return this.__loaded}getImage(){return this.__image}getInternalFormat(){return this.__internalFormat}getType(){return this.__type}getFormat(){return this.__format}getWrap(){return this.__wrapParam}getMipMapped(){return this.__mipMapped}configure(A){const g=this.__gl,I=XC(g,A);this.params=I,this.__format=I.format,this.__internalFormat=I.internalFormat,this.__type=I.type,this.__minFilter=I.minFilter,this.__magFilter=I.magFilter,this.__wrapS=I.wrapS,this.__wrapT=I.wrapT,this.__flipY="flipY"in A&&A.flipY,this.__mipMapped="mipMapped"in A&&A.mipMapped,this.invert="invert"in A&&A.invert,this.alphaFromLuminance="alphaFromLuminance"in A&&A.alphaFromLuminance,this.textureType=1,this.textureDesc[0]=this.width,this.textureDesc[1]=this.height,1==this.textureType&&this.__format==g.RGBA&&(this.textureType=2),this.__gltex&&g.deleteTexture(this.__gltex),this.__gltex=g.createTexture(),this.__updateGLTexParams();const C=I.width,i=I.height,e=A.data;e?this.bufferData(e,C,i,!1,!1):this.resize(C,i,!1,!1),this.__loaded||(this.emit("ready"),this.__loaded=!0)}__updateGLTexParams(){const A=this.__gl;A.bindTexture(A.TEXTURE_2D,this.__gltex),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,this.__minFilter),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.__magFilter),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,this.__wrapS),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,this.__wrapT)}bufferData(A,g=-1,I=-1,C=!0,i=!0){const e=this.__gl;if(null!=A){if(A instanceof WebGLTexture)this.__gltex=A;else if(A instanceof HTMLImageElement||A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof HTMLImageElement||A instanceof HTMLVideoElement)C&&e.bindTexture(e.TEXTURE_2D,this.__gltex),e.texImage2D(e.TEXTURE_2D,0,this.__internalFormat,this.__format,this.__type,A),this.width=A.width,this.height=A.height;else{-1==g&&(g=this.width),-1==I&&(I=this.height);const i=g*I;let t;switch(this.__format){case e.RED:case e.RED_INTEGER:case e.ALPHA:case e.LUMINANCE:case e.LUMINANCE_ALPHA:t=1;break;case e.RG:t=2,e.pixelStorei(e.UNPACK_ALIGNMENT,2);break;case e.RGB:t=3;break;case e.RGBA:t=4;break;default:console.warn("Reaching default case: numChannels:=1"),t=1}A.length!=i*t&&console.warn("Invalid data for Image width:"+g+" height:"+I+" format:"+this.__formatParam+" type:"+this.__typeParam+" Data Length:"+A.length+" Expected:"+i*t);let B=A;this.__type==e.HALF_FLOAT&&A instanceof Float32Array&&(B=r.convertFloat32ArrayToUInt16Array(A)),C&&e.bindTexture(e.TEXTURE_2D,this.__gltex),"webgl2"==e.name?e.texImage2D(e.TEXTURE_2D,0,this.__internalFormat,g,I,0,this.__format,this.__type,B,0):e.texImage2D(e.TEXTURE_2D,0,this.__internalFormat,g,I,0,this.__format,this.__type,B),this.width=g,this.height=I}this.__mipMapped&&e.generateMipmap(e.TEXTURE_2D)}else C&&e.bindTexture(e.TEXTURE_2D,this.__gltex),e.texImage2D(e.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,null),this.width=g,this.height=I;i&&this.emit("updated")}clear(){const A=this.__gl,g=this.width*this.height;let I,C;switch(this.__format){case A.RED:case A.RED_INTEGER:case A.ALPHA:case A.LUMINANCE:case A.LUMINANCE_ALPHA:I=1;break;case A.RG:I=2;break;case A.RGB:I=3;break;case A.RGBA:I=4;break;default:throw new Error("Invalid Format")}switch(this.__type){case A.UNSIGNED_BYTE:C=new Uint8Array(g*I);break;case A.HALF_FLOAT:C=new Uint16Array(g*I);break;case A.FLOAT:C=new Float32Array(g*I);break;default:throw new Error("Invalid Type")}"webgl2"==A.name?A.texImage2D(A.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,C,0):A.texImage2D(A.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,C)}resize(A,g,I=!1,C=!0){const i=this.__gl;if(this.width!=A||this.height!=g){const e=i.getParameter(i.MAX_TEXTURE_SIZE);if(A<0||A>e||g<0||g>e)throw new Error("gl-texture2d: Invalid texture size. width:"+A+" height:"+g+" maxSize:"+e);if(I){const I=i.createTexture();i.bindTexture(i.TEXTURE_2D,I),i.texImage2D(i.TEXTURE_2D,0,this.__internalFormat,A,g,0,this.__format,this.__type,null);const C=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,C),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.__gltex,0),i.bindTexture(i.TEXTURE_2D,I),i.copyTexImage2D(i.TEXTURE_2D,0,this.__internalFormat,0,0,this.width,this.height,0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.deleteFramebuffer(C),this.__gl.deleteTexture(this.__gltex),this.__gltex=I,this.__updateGLTexParams()}else this.width>0&&this.height>0&&(this.__gl.deleteTexture(this.__gltex),this.__gltex=i.createTexture(),this.__updateGLTexParams()),i.bindTexture(i.TEXTURE_2D,this.__gltex),i.texImage2D(i.TEXTURE_2D,0,this.__internalFormat,A,g,0,this.__format,this.__type,null);if(this.width=A,this.height=g,C){const I=new F(A,g);this.emit("resized",I)}}}populate(A,g,I,C=0,i=0,e=!0){const t=this.__gl;e&&t.bindTexture(t.TEXTURE_2D,this.__gltex),t.texSubImage2D(t.TEXTURE_2D,0,C,i,g,I,this.__format,this.__type,A)}getSize(){return[this.width,this.height]}get glTex(){return this.__gltex}getTexHdl(){return this.__gltex}preBind(A,g){return{textureTypeUnif:g[A.name+"Type"],textureDescUnif:g[A.name+"Desc"]}}bindToUniform(A,g,I){if(!this.__loaded)return!1;if(!this.__gltex)throw new Error("Unable to bind non-initialized or deleted texture.");const C=A.boundTextures++,i=this.__gl;return i.activeTexture(i.TEXTURE0+C),i.bindTexture(i.TEXTURE_2D,this.__gltex),i.uniform1i(g.location,C),I&&(I.textureTypeUnif&&i.uniform1i(I.textureTypeUnif.location,this.textureType),I.textureDescUnif&&i.uniform4fv(I.textureDescUnif.location,this.textureDesc)),!0}destroy(){super.destroy(),this.__gl.deleteTexture(this.__gltex),this.__gltex=null}static getCachedGLTexture2D(A){return WC[A.getId()]}static setCachedGLTexture2D(A,g){WC[A.getId()]=g}}const WC={};let YC={bool:"Boolean",int:"SInt32",uint:"UInt32",float:"Float32",ivec2:"Vec2",ivec3:"Vec3",ivec4:"Vec4",vec2:"Vec2",vec3:"Vec3",vec4:"Vec4",color:"Color",mat3:"Mat3",mat4:"Mat4",sampler2D:"BaseImage",samplerCube:"BaseImage"};const KC=/\s+/;class pC{constructor(){this.__shaderModules={},this.materialTemplates={}}setShaderModule(A,g){A in this.__shaderModules||(this.__shaderModules[A]=g)}getShaderModule(A){return this.__shaderModules[A]}getShaderModuleNames(){const A=[];for(const g in this.__shaderModules)A.push(g);return A}parseAttr(A,g,I,C){if(!(A[1]in YC))throw new Error("Error while parsing \nType not recognized:"+A[1]);const i=A[2].slice(0,A[2].length-1);I.attributes[i]={type:YC[A[1]],instanced:g},"color"==A[1]&&(A[1]="vec4",A.join(" "))}handleImport(A,g,I,C,i){if(I in this.__shaderModules){const e=this.__shaderModules[I];if(!e)throw Error("snippet not loaded or does not exists!");const t=this.parseShaderHelper(g,e,C,i);C.push(I),A.glsl=A.glsl+t.glsl,A.numLines+=t.numLines,A.uniforms=Object.assign(Object.assign({},A.uniforms),t.uniforms),A.attributes=Object.assign(Object.assign({},A.attributes),t.attributes)}else console.log("shaderName: "+g),console.log("SNIPPET NOT FOUND: "+I)}parseShader(A,g){return this.parseShaderHelper(A,g,[],0)}parseShaderHelper(A,g,I,C){const i=(A,g)=>{A.glsl=A.glsl+g+"\n",A.numLines++};I.push(A);const e={glsl:"",numLines:0,uniforms:{},attributes:{}},t=(g=g.toString()).split("\n");for(let g=0;g<t.length;g++){let B=t[g];const o=B.trim(),s=o.split(KC);switch(s[0]){case"<%include":case"import":{const g=o.split(/'|"|`/)[1].split("/").pop();I.includes(g)||this.handleImport(e,A,g,I,C);break}case"attribute":this.parseAttr(s,!1,e,B),i(e,B);break;case"instancedattribute":this.parseAttr(s,!0,e,B),s[0]="attribute",B=s.join(" "),i(e,B);break;case"uniform":{let g=1;4==s.length&&(g=2);const I=s[g];if(!(I in YC))throw new Error("Error while parsing :"+A+" \nType not recognized:"+s[1]);const C=s[g+1].slice(0,s[g+1].length-1);C.includes("[")?e.uniforms[C.substring(0,C.indexOf("["))]=YC[I]:e.uniforms[C]=YC[I],"struct"==e.uniforms[C]&&console.log(s),"color"==s[1]&&(s[1]="vec4",B=s.join(" ")),i(e,B);break}default:i(e,B)}}return e}}const NC=new pC;let JC=0;class DC extends hA{constructor(A,g){super(g),A&&(this.__gl=A),this.__shaderStagesGLSL={},this.__shaderStages={},this.__shaderProgramHdls={},this.__gltextures={},this.__id=JC++}setGLContext(A){this.__gl=A}setShaderStage(A,g){this.__shaderStagesGLSL[A]=g,this.clearProgramsCache()}getShaderStage(A){return this.__shaderStagesGLSL[A]}clearProgramsCache(){const A=this.__gl;for(const g in this.__shaderProgramHdls){const I=this.__shaderProgramHdls[g];for(const g in I.shaderHdls)A.deleteShader(I.shaderHdls[g]);A.deleteProgram(I.shaderProgramHdl)}}static isOpaque(){return!0}static isOverlay(){return!1}__compileShaderStage(A,g,I,C){const i=this.__gl;if(C||(C=i.shaderopts),C){if(C.repl)for(const g in C.repl)A=t.replaceAll(A,g,C.repl[g]);if(C.directives){A=C.directives.join("\n")+"\n"+A}}let e;"webgl2"==i.name&&(A=t.replaceAll(A,"attribute","in"),A="vertexShader"==I?t.replaceAll(A,"varying","out"):t.replaceAll(A,"varying","in"),e="#version 300 es\n",A="#version 300 es\n"+(A=t.replaceAll(A,"texture2D","texture")));const B=i.createShader(g);if(!B)throw Error("shaderHdl not defined");if(i.shaderSource(B,A),i.compileShader(B),!i.getShaderParameter(B,i.COMPILE_STATUS)){console.log("Errors in :"+this.constructor.name);const g=i.getShaderInfoLog(B).split("\n"),C={};for(let A=0;A<g.length;A++){if(g[A].startsWith("'")){g[A-1]=g[A-1]+g[A],delete g[A],A--;continue}const I=g[A].split(":");if(I.length>=2){const i=parseInt(I[2]);isNaN(i)||(C[i]?C[i].push(g[A]):C[i]=[g[A]])}}const e=[],t=A.split("\n");for(const A in C){const g=Number.parseInt(A)-1;for(let A=Math.max(0,g-4);A<g;A++)e.push((g+1+" ").padStart(3)+t[A]);e.push((g+1+">").padStart(3)+t[g]);for(let A=g+1;A<Math.min(t.length-1,g+5);A++)e.push((g+1+" ").padStart(3)+t[A]);const I=C[A];for(const A of I)e.push(A)}throw new Error("An error occurred compiling the shader \n=================\n"+this.constructor.name+"."+I+": \n\n"+e.join("\n"))}return B}__createProgram(A){const g=this.__gl;this.__shaderCompilationAttempted=!0;const I=g.createProgram();if(!I)throw Error("shaderProgramHdl not defined");const C={};this.__shaderStages.VERTEX_SHADER||(this.__shaderStages.VERTEX_SHADER=NC.parseShader("VERTEX_SHADER",this.__shaderStagesGLSL.VERTEX_SHADER));const i=this.__shaderStages.VERTEX_SHADER.glsl;if(null!=i){const e=this.__compileShaderStage(i,g.VERTEX_SHADER,"vertexShader",A);if(!e)return!1;g.attachShader(I,e),C[g.VERTEX_SHADER]=e}this.__shaderStages.FRAGMENT_SHADER||(this.__shaderStages.FRAGMENT_SHADER=NC.parseShader("FRAGMENT_SHADER",this.__shaderStagesGLSL.FRAGMENT_SHADER));const e=this.__shaderStages.FRAGMENT_SHADER.glsl;if(null!=e){const i=Object.assign({},g.shaderopts,A);i.frag&&(i.defines=i.frag.defines+i.defines);const t=this.__compileShaderStage(e,g.FRAGMENT_SHADER,"fragmentShader",i);if(!t)return!1;g.attachShader(I,t),C[g.FRAGMENT_SHADER]=t}if(g.linkProgram(I),!g.getProgramParameter(I,g.LINK_STATUS)){const A=g.getProgramInfoLog(I);if(!A)throw Error("info not defined");if(A.includes("D3D shader compilation failed")){const A=g.getExtension("WEBGL_debug_shaders");if(A){const I=A.getTranslatedShaderSource(C[g.VERTEX_SHADER]);console.log(I)}}throw console.log("vertexShaderGLSL:"+i),console.log("fragmentShaderGLSL:"+e),new Error("Unable to link the shader program:"+this.constructor.name+"\n==================\n"+A)}const t=this.__extractAttributeAndUniformLocations(I,A);return t.shaderHdls=C,t.shaderProgramHdl=I,t}__extractAttributeAndUniformLocations(A,g){const I=this.__gl,C=this.getAttributes(),i={attrs:{},unifs:{}};for(const g in C){const e=I.getAttribLocation(A,g);if(null==e){console.warn("Shader attribute not found:"+g);continue}const t=C[g];i.attrs[g]={name:g,location:e,type:t.type,instanced:t.instanced}}const e=this.getUniforms();for(let C in e){const t=e[C];if(g&&g.repl)for(const A in g.repl)C=C.replace(A,g.repl[A]);const B=I.getUniformLocation(A,C);null!=B&&(i.unifs[C]={name:C,location:B,type:t})}return i}getAttributes(){const A={};for(const g in this.__shaderStages){const I=this.__shaderStages[g];for(const g in I.attributes)A[g]=I.attributes[g]}return A}getUniforms(){const A={};for(const g in this.__shaderStages){const I=this.__shaderStages[g];for(const g in I.uniforms)A[g]=I.uniforms[g]}return A}isCompiledForTarget(A){const g=A||this.getId();return null!=this.__shaderProgramHdls[g]}compileForTarget(A,g){const I=A||this.getId();let C=this.__shaderProgramHdls[I];return C||(C=this.__createProgram(g||{}),C.shaderkey=I,this.__shaderProgramHdls[I]=C,C)}compile(){this.compileForTarget()}bind(A,g){const I=this.__gl;if(A.glShader!=this){const C=this.compileForTarget(g,A.shaderopts);if(!C)return console.warn(this.constructor.name+" is not compiled for "+g),!1;const i=C.shaderProgramHdl;I.useProgram(i),A.glShader=this,A.shaderkey=C.shaderkey,A.unifs=C.unifs,A.attrs=C.attrs,A.boundTextures=0,A.glGeom=void 0,A.bindRendererUnifs&&A.bindRendererUnifs(C.unifs)}return A.supportsInstancing=!0,!0}unbind(A){return A.glShader=null,A.shaderkey="",A.unifs={},A.attrs={},!0}getGeomDataShaderName(){return""}getSelectedShaderName(){return""}static supportsInstancing(){return!0}static getPackedMaterialData(A){return new Float32Array(4)}static getMaterialTemplate(){throw new Error("Shader does not provide a material template.")}destroy(){const A=this.__gl;for(const g in this.__shaderProgramHdls){const I=this.__shaderProgramHdls[g];A.deleteProgram(I.shaderProgramHdl)}this.__shaderProgramHdls={}}}class fC{constructor(A,I,C=!1){this.colorTextureResizeEventId=-1,this.__depthTexture=null,this.__fbo=null,this.__prevBoundFbo=null,!g.isIOSDevice||"webgl"!=A.name||I.getType()!=A.FLOAT&&I.getType()!=A.HALF_FLOAT||console.error("IOS devices are unable to render to float textures."),this.__gl=A,this.__colorTexture=I,this.__createDepthTexture=C,this.__clearColor=new l(0,0,0,0),this.__colorTexture&&(this.colorTextureResizeEventId=this.__colorTexture.on("resized",(()=>{console.warn("This code path will be deprecated. Instead, resize the GLFbo and it will resize the texture."),this.resize(this.__colorTexture.width,this.__colorTexture.height,!1)}))),this.setup()}setClearColor(A){this.__clearColor=A}getWidth(){return this.__colorTexture.width}getHeight(){return this.__colorTexture.height}getSize(){return[this.__colorTexture.width,this.__colorTexture.height]}getColorTexture(){return this.__colorTexture}getDepthTextureGL(){return this.__depthTexture}get width(){return this.__colorTexture.width}get height(){return this.__colorTexture.height}get size(){return[this.__colorTexture.width,this.__colorTexture.height]}get colorTexture(){return this.__colorTexture}setColorTexture(A){const g=this.__gl;this.__colorTexture=A,g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,this.__colorTexture.glTex,0)}get depthTextureGL(){return this.__depthTexture}setup(){const A=this.__gl;this.__fbo=A.createFramebuffer(),"webgl2"==A.name?A.bindFramebuffer(A.DRAW_FRAMEBUFFER,this.__fbo):A.bindFramebuffer(A.FRAMEBUFFER,this.__fbo),this.__colorTexture&&("webgl2"==A.name?A.framebufferTexture2D(A.DRAW_FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,this.__colorTexture.glTex,0):A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,this.__colorTexture.glTex,0)),this.__createDepthTexture&&this.createDepthTexture(),MC(A,this.width,this.height),"webgl2"==A.name?A.bindFramebuffer(A.DRAW_FRAMEBUFFER,null):A.bindFramebuffer(A.FRAMEBUFFER,null)}createDepthTexture(){const A=this.__gl;if("webgl2"==A.name||A.__ext_WEBGL_depth_texture)A.activeTexture(A.TEXTURE0),this.__depthTexture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.__depthTexture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),"webgl2"==A.name?(A.texImage2D(A.TEXTURE_2D,0,A.DEPTH_COMPONENT24,this.width,this.height,0,A.DEPTH_COMPONENT,A.UNSIGNED_INT,null),A.framebufferTexture2D(A.DRAW_FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,this.__depthTexture,0)):(A.texImage2D(A.TEXTURE_2D,0,A.DEPTH_COMPONENT,this.width,this.height,0,A.DEPTH_COMPONENT,A.UNSIGNED_INT,null),A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,this.__depthTexture,0));else{const g=A.createRenderbuffer();A.bindRenderbuffer(A.RENDERBUFFER,g),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,this.width,this.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,g)}}resize(A,g,I=!0){const C=this.__gl;C.bindFramebuffer(C.FRAMEBUFFER,null),C.deleteFramebuffer(this.__fbo),I&&this.__colorTexture.resize(A,g,!1,!1),this.__fbo=C.createFramebuffer(),"webgl2"==C.name?C.bindFramebuffer(C.DRAW_FRAMEBUFFER,this.__fbo):C.bindFramebuffer(C.FRAMEBUFFER,this.__fbo),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,this.__colorTexture.glTex,0),this.__depthTexture&&(C.deleteTexture(this.__depthTexture),this.createDepthTexture()),MC(C,this.width,this.height)}bindForWriting(A){A&&(this.__prevBoundFbo=A.boundRendertarget,A.boundRendertarget=this.__fbo);const g=this.__gl;"webgl2"==g.name?g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.__fbo):g.bindFramebuffer(g.FRAMEBUFFER,this.__fbo),g.viewport(0,0,this.width,this.height)}unbindForWriting(A){A&&(A.boundRendertarget=this.__prevBoundFbo);const g=this.__gl;"webgl2"==g.name?g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.__prevBoundFbo):g.bindFramebuffer(g.FRAMEBUFFER,this.__prevBoundFbo)}bind(A){this.bindForWriting(A)}unbind(A){if(A)this.unbindForWriting(A);else{const A=this.__gl;A.bindFramebuffer(A.FRAMEBUFFER,null)}}bindForReading(A){const g=this.__gl;"webgl2"==g.name?g.bindFramebuffer(g.READ_FRAMEBUFFER,this.__fbo):g.bindFramebuffer(g.FRAMEBUFFER,this.__fbo)}unbindForReading(){const A=this.__gl;"webgl2"==A.name?A.bindFramebuffer(A.READ_FRAMEBUFFER,null):A.bindFramebuffer(A.FRAMEBUFFER,null)}clear(){const A=this.__gl;A.colorMask(!0,!0,!0,!0);const g=this.__clearColor.asArray();A.clearColor(g[0],g[1],g[2],g[3]),this.__createDepthTexture?A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT):A.clear(A.COLOR_BUFFER_BIT)}bindAndClear(A){this.bind(A),this.clear()}destroy(){const A=this.__gl;A.bindFramebuffer(A.FRAMEBUFFER,null),A.deleteFramebuffer(this.__fbo),this.__fbo=null,this.__colorTexture.removeListenerById("resized",this.colorTextureResizeEventId)}}function MC(A,g,I){let C;if(C="webgl2"==A.name?A.checkFramebufferStatus(A.DRAW_FRAMEBUFFER):A.checkFramebufferStatus(A.FRAMEBUFFER),C!==A.FRAMEBUFFER_COMPLETE)switch(A.bindTexture(A.TEXTURE_2D,null),"webgl2"==A.name?A.bindFramebuffer(A.DRAW_FRAMEBUFFER,null):A.bindFramebuffer(A.FRAMEBUFFER,null),console.warn("Error creating Fbo width:",g,", height:",I),C){case A.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case A.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case A.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case A.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}}class LC extends V{constructor(A,g){super(),this.params={},this.flipY=!1,this.width=0,this.height=0,this.__gl=A,this.textureTargets=[],this.depthTexture=null,this.textureDesc=[0,0,0,0],this.clearColor=new l(0,0,0,0),this.colorMask=[!0,!0,!0,!0],g&&this.configure(g)}configure(A){const g=this.__gl,I=XC(g,A);this.textureTargets.forEach((A=>{g.deleteTexture(A)})),this.textureTargets=[],this.depthTexture&&(g.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&g.deleteFramebuffer(this.frameBuffer),this.params=I,this.type=I.type,this.format=I.format,this.internalFormat=I.internalFormat,this.minFilter=I.minFilter?I.minFilter:I.filter,this.minFilter=I.magFilter?I.magFilter:I.filter,this.wrap=I.wrap,this.flipY=I.flipY,this.width=I.width,this.height=I.height,this.textureType=1,this.textureDesc[0]=this.width,this.textureDesc[1]=this.height;const C=null!=A.numColorChannels?A.numColorChannels:null!=I.format?1:0;for(let A=0;A<C;A++){g.activeTexture(g.TEXTURE0+1);const A=g.createTexture();g.bindTexture(g.TEXTURE_2D,A),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,I.wrapS),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,I.wrapT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,I.minFilter),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,I.magFilter),g.texImage2D(g.TEXTURE_2D,0,this.internalFormat,I.width,I.height,0,this.format,this.type,null),this.textureTargets.push(A)}if(I.depthFormat){if("webgl"==g.name&&!g.__ext_WEBGL_depth_texture)throw new Error("Depth textures not support on this device");g.activeTexture(g.TEXTURE0),this.depthTexture=g.createTexture(),g.bindTexture(g.TEXTURE_2D,this.depthTexture),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,I.wrapS),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,I.wrapT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,I.minFilter),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,I.magFilter),g.texImage2D(g.TEXTURE_2D,0,I.depthInternalFormat,I.width,I.height,0,I.depthFormat,I.depthType,null)}if(this.frameBuffer=g.createFramebuffer(),this.bindForWriting(),this.textureTargets.length>0){this.textureTargets.length>1&&"webgl"==g.name&&g.drawBuffers;const A=[];for(let I=0;I<this.textureTargets.length;I++)g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0+I,g.TEXTURE_2D,this.textureTargets[I],0),A.push(g.COLOR_ATTACHMENT0+I);this.textureTargets.length>1&&g.drawBuffers(A)}this.depthTexture&&g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,this.depthTexture,0),this.checkFramebuffer()}checkFramebuffer(){this.bindForWriting();const A=this.__gl,g=A.checkFramebufferStatus(A.DRAW_FRAMEBUFFER);if(g!=A.FRAMEBUFFER_COMPLETE)switch(g){case A.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case A.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case A.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case A.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}this.unbindForWriting()}bindForWriting(A,g=!1){A&&(this.__prevBoundFbo=A.boundRendertarget,A.boundRendertarget=this.frameBuffer);const I=this.__gl;"webgl2"==I.name?I.bindFramebuffer(I.DRAW_FRAMEBUFFER,this.frameBuffer):I.bindFramebuffer(I.FRAMEBUFFER,this.frameBuffer),I.viewport(0,0,this.width,this.height),g&&this.clear()}unbindForWriting(A){A&&(A.boundRendertarget=this.__prevBoundFbo);const g=this.__gl;g.bindFramebuffer("webgl2"==g.name?g.DRAW_FRAMEBUFFER:g.FRAMEBUFFER,this.__prevBoundFbo),this.__prevBoundFbo=null}clear(A=!0){const g=this.__gl,I=this.colorMask;g.colorMask(I[0],I[1],I[2],I[3]);const C=this.clearColor.asArray();g.clearColor(C[0],C[1],C[2],C[3]);let i=0;this.textureTargets.length>0&&(i|=g.COLOR_BUFFER_BIT),this.depthTexture&&(i|=g.DEPTH_BUFFER_BIT),g.clear(i)}bindForReading(){const A=this.__gl;"webgl2"==A.name?A.bindFramebuffer(A.READ_FRAMEBUFFER,this.frameBuffer):A.bindFramebuffer(A.FRAMEBUFFER,this.frameBuffer)}unbindForReading(){const A=this.__gl;"webgl2"==A.name?A.bindFramebuffer(A.READ_FRAMEBUFFER,null):A.bindFramebuffer(A.FRAMEBUFFER,null)}bindColorTexture(A,g,I=0){const C=this.__gl,i=A.boundTextures++;return C.uniform1i(g.location,i),C.activeTexture(C.TEXTURE0+i),C.bindTexture(C.TEXTURE_2D,this.textureTargets[I]),!0}bindDepthTexture(A,g){const I=this.__gl,C=A.boundTextures++;return I.uniform1i(g.location,C),I.activeTexture(I.TEXTURE0+C),I.bindTexture(I.TEXTURE_2D,this.depthTexture),!0}unbind(A){this.unbindForWriting(A)}resize(A,g,I=!1){const C=this.__gl;if(this.width!=A||this.height!=g){const i=C.getParameter(C.MAX_TEXTURE_SIZE);if(A<0||A>i||g<0||g>i)throw new Error(`GLRenderTarget: Invalid texture size. width: ${A} height: ${g} maxSize: ${i}`);I&&this.bindForReading();const e=this.params;for(let i=0;i<this.textureTargets.length;i++){const t=C.createTexture();C.bindTexture(C.TEXTURE_2D,t),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,e.wrapS),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,e.wrapT),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,e.minFilter),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,e.magFilter),C.texImage2D(C.TEXTURE_2D,0,this.internalFormat,A,g,0,this.format,this.type,null),I&&C.copyTexImage2D(C.TEXTURE_2D,0,this.internalFormat,0,0,Math.min(A,this.width),Math.min(g,this.height),0),C.deleteTexture(this.textureTargets[i]),this.textureTargets[i]=t}if(e.depthFormat){if("webgl"==C.name&&!C.__ext_WEBGL_depth_texture)throw new Error("Depth textures not support on this device");C.activeTexture(C.TEXTURE0);const i=C.createTexture();C.bindTexture(C.TEXTURE_2D,i),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,e.wrapS),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,e.wrapT),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,e.minFilter),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,e.magFilter),C.texImage2D(C.TEXTURE_2D,0,e.depthInternalFormat,A,g,0,e.depthFormat,e.depthType,null),I&&C.copyTexImage2D(C.TEXTURE_2D,0,this.internalFormat,0,0,Math.min(A,this.width),Math.min(g,this.height),0),C.deleteTexture(this.depthTexture),this.depthTexture=i}if(I&&this.unbindForReading(),this.width=A,this.height=g,this.frameBuffer&&C.deleteFramebuffer(this.frameBuffer),this.frameBuffer=C.createFramebuffer(),this.bindForWriting(),this.textureTargets.length>0){this.textureTargets.length>1&&"webgl"==C.name&&C.drawBuffers;const A=[];for(let g=0;g<this.textureTargets.length;g++)C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.COLOR_ATTACHMENT0+g,C.TEXTURE_2D,this.textureTargets[g],0),A.push(C.COLOR_ATTACHMENT0+g);this.textureTargets.length>1&&C.drawBuffers(A)}this.depthTexture&&C.framebufferTexture2D(C.DRAW_FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,this.depthTexture,0),this.checkFramebuffer()}}bindToUniform(A,g,I){const C=A.boundTextures++,i=this.__gl.TEXTURE0+C,e=this.__gl;return e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,this.textureTargets[0]),e.uniform1i(g.location,C),I&&(I.textureTypeUnif&&e.uniform1i(I.textureTypeUnif.location,this.textureType),I.textureDescUnif&&this.__gl.uniform4fv(I.textureDescUnif.location,this.textureDesc)),!0}destroy(){const A=this.__gl;this.textureTargets.forEach((g=>{A.deleteTexture(g)})),this.textureTargets=[],this.depthTexture&&(A.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&A.deleteFramebuffer(this.frameBuffer)}}var UC="#define GLSLIFY 1\n\n#ifdef ENABLE_MULTI_DRAW\n\n#ifdef EMULATE_MULTI_DRAW\n\nuniform int geomItemId;\nint getGeomItemId() {\n  return geomItemId;\n}\n\nvec4 getDrawItemIds() {\n  return vec4(float(geomItemId), 0.0, -1.0, -1.0);\n}\n\n#else // EMULATE_MULTI_DRAW\n\nuniform sampler2D drawIdsTexture;\n\nint getGeomItemId() {\n  ivec2 drawIdsTextureSize = textureSize(drawIdsTexture, 0);\n  ivec2 drawIdsArrayCoords = ivec2(gl_DrawID % drawIdsTextureSize.x, gl_DrawID / drawIdsTextureSize.x);\n  return int(texelFetch(drawIdsTexture, drawIdsArrayCoords, 0).r + 0.5);\n}\n\nvec4 getDrawItemIds() {\n  ivec2 drawIdsTextureSize = textureSize(drawIdsTexture, 0);\n  ivec2 drawIdsArrayCoords = ivec2(gl_DrawID % drawIdsTextureSize.x, gl_DrawID / drawIdsTextureSize.x);\n  vec4 color = texelFetch(drawIdsTexture, drawIdsArrayCoords, 0);\n  // Note: a 0 value in the texture means no sub-geom index is being rendered.\n  // subtract off 1 to get the true sub-geom index.\n  return vec4(color.r, color.g - 1.0, color.b, color.a);\n}\n\n#endif // EMULATE_MULTI_DRAW\n\n#else // ENABLE_MULTI_DRAW\n\nuniform int geomItemId;\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nattribute float instancedIds;    // instanced attribute..\nuniform int instancedDraw;\n\nint getGeomItemId() {\n  if (instancedDraw == 0) {\n    return geomItemId;\n  }\n  else {\n    return int(instancedIds);\n  }\n}\n\nvec4 getDrawItemIds() {\n  if (instancedDraw == 0) {\n    return vec4(float(geomItemId), 0.0, -1.0, -1.0);\n  }\n  else {\n    return vec4(float(instancedIds), 0.0, -1.0, -1.0);\n  }\n}\n\n#else\n\nint getGeomItemId() {\n  return geomItemId;\n}\n\nvec4 getDrawItemIds() {\n    return vec4(float(geomItemId), 0.0, -1.0, -1.0);\n}\n\n#endif // ENABLE_FLOAT_TEXTURES\n#endif // ENABLE_MULTI_DRAW\n\n// For backwards compatibility with older plugins (UX.HandleShader)\nint getDrawItemId() {\n  return getGeomItemId();\n}\n";NC.setShaderModule("imageAtlas.glsl","#define GLSLIFY 1\n// Note: On mobile, I can't seem to pass around a stuct containing sampler2D.\n// I have to unpack the struct and pass its members. :(\n// struct ImageAtlas {\n//     sampler2D layout;\n//     sampler2D image;\n//     vec4 desc;\n// };\n\nimport 'GLSLUtils.glsl'\n\nvec4 getSubImageLayout(int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    return fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n}\nvec2 calcSubImageTexCoords(vec2 texCoord, int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    // The following line is a hack to fix artifacts in our PBR lighting\n    // We were seeing loads of lighting garbage on some sufaces that were orthogonal\n    // to the world. The UV coordinates would have been landing right on the edges\n    // of our subimages and were often sampling outside the image. This couuld\n    // have been because of filtering, or an error in the uv coords. \n    texCoord = clamp(texCoord, vec2(0.01, 0.01), vec2(0.99, 0.99));\n    vec2 subimageTexel = texCoord * layoutData.zw;\n    // subimageTexel = clamp(subimageTexel, vec2(0.0, 0.0), vec2(1.0, 1.0));\n    return subimageTexel + layoutData.xy;\n}\nvec4 sampleSubImage(vec2 texCoord, int index, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    vec2 atlasCoords = calcSubImageTexCoords(texCoord, index, atlasLayout, atlasDesc);\n    return texture2D(atlasImage, atlasCoords);\n}"),NC.setShaderModule("surfaceGeomData.glsl","#define GLSLIFY 1\n  uniform int floatGeomBuffer;\n  uniform int passId;\n  uniform int occlusionCulling;\n\n  import 'GLSLBits.glsl'\n  \n  vec4 setFragColor_geomData(vec3 v_viewPos, int floatGeomBuffer, int passId, float geomItemId, float elemItemId, int isOrthographic){\n    vec4 fragColor;\n\n    float viewDist;\n    if (isOrthographic > 0) {\n      viewDist = abs(v_viewPos.z);\n    } else {\n      viewDist = length(v_viewPos);\n    }\n    if (floatGeomBuffer != 0) {\n      fragColor.r = float(passId); \n      fragColor.g = float(geomItemId);\n      fragColor.b = elemItemId;\n      fragColor.a = viewDist;\n    }\n    else {\n      ///////////////////////////////////\n      // UInt8 buffer\n      fragColor.r = mod(geomItemId, 256.) / 255.;\n      fragColor.g = (floor(geomItemId / 256.) + float(passId) * 32.) / 255.;\n\n      // encode the dist as a 16 bit float\n      vec2 float16bits = encode16BitFloatInto2xUInt8(viewDist);\n      fragColor.b = float16bits.x;\n      fragColor.a = float16bits.y;\n    }\n\n#ifdef ENABLE_ES3\n    if (occlusionCulling != 0) {\n      // Calculate a simple stochastic transparency to reduce the cost of the reduction shader.\n      // We only need one pixel to be visible to consider the geometry visible, so here we \n      // keep only one in 7x7 (49) pixels. This signficatly reduces the cost of reducing the scene\n      // to the reduction data buffer.\n      // Note: this is not a stochastic transparency, as we are simply setting black pixels to \n      // reduce the number of reduction points for this geometry. The black pixels (not discarded)\n      // still occlude other geometries, but during reduction count to nothing.\n      int x = int(gl_FragCoord.x * 1000.0);\n      int y = int(gl_FragCoord.y * 1000.0);\n      if (x % 7 != 0 || y % 7 != 0) {\n        fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      };\n    }\n#endif // ENABLE_ES3\n\n    return fragColor;\n  }\n\n  // Note: the older code imported drawItemId.glsl and newer code is importing geomItemId.glsl\n  // This code keeps compatibility with the older shaders.\n  vec4 setFragColor_geomData(vec3 v_viewPos, int floatGeomBuffer, int passId, float geomItemId, int isOrthographic){\n    return setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, geomItemId, -1.0, isOrthographic);\n  }"),NC.setShaderModule("surfaceHighlight.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor(int id) {\n    return highlightColor;\n}\n\n#endif\n\nvec4 setFragColor_highlight(float v_geomItemId){\n  vec4 fragColor; \n  int geomItemId = int(v_geomItemId + 0.5);\n  fragColor = getHighlightColor(geomItemId);\n  return fragColor;\n}\n"),NC.setShaderModule("computeViewNormal.glsl","#define GLSLIFY 1\n  \n#ifdef ENABLE_ES3\nvec3 computeViewNormal(vec3 viewPos) {\n  vec3 fdx = dFdx(viewPos);\n  vec3 fdy = dFdy(viewPos);\n  return normalize(cross(fdx, fdy));\n}\n#else \nvec3 computeViewNormal(vec3 viewPos) {\n  return vec3(0.0, 0.0, 0.0);\n}\n#endif\n"),NC.setShaderModule("calcFatLinesViewPos.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\nvec3 calcFatLinesViewPos(int vertexID, mat4 modelViewMatrix, inout vec3 viewNormal, inout vec2 texCoord, inout vec3 pos) {\n\n  int seqentialIndex_0 = int(mod(segmentIndices.x, 2.));\n  int seqentialIndex_1 = int(mod(segmentIndices.y, 2.));\n  int index_0 = int(segmentIndices.x) / 2;\n  int index_1 = int(segmentIndices.y) / 2;\n\n  vec3 viewPos;\n  vec4 data_0 = fetchTexel(positionsTexture, positionsTextureSize, index_0);\n  vec4 data_1 = fetchTexel(positionsTexture, positionsTextureSize, index_1);\n\n  // During XR sessions, there is a scaling applied to the view matrix\n  // which causes a distortion to the line width. We extract that scale here\n  // and use to correct the distortion.\n  // See also: FatPointsShader\n  vec3 viewZ = modelViewMatrix[2].xyz;\n  float viewScale = length(viewZ);\n\n  vec4 pos_0 = modelViewMatrix * vec4(data_0.xyz, 1.0);\n  vec4 pos_1 = modelViewMatrix * vec4(data_1.xyz, 1.0);\n  // Note: multiply the per-vertex line thickness with the line thickness uniform value;\n  float lineThickness_0 = LineThickness * data_0.w * viewScale;\n  float lineThickness_1 = LineThickness * data_1.w * viewScale;\n\n  if (vertexID < 2) {\n    pos = data_0.xyz;\n    viewPos = pos_0.xyz;\n  }\n  else {\n    pos = data_1.xyz;\n    viewPos = pos_1.xyz;\n  }\n  if (pos_1 != pos_0) {\n    vec3 segmentDir = normalize(pos_1.xyz - pos_0.xyz);\n    vec3 viewVector = normalize(viewPos);\n\n    if (vertexID < 2) {\n      vec3 segmentStartDir = segmentDir;\n      if (seqentialIndex_0 != 0) {\n        //if index_0 == 0, get the last index in the line as previous\n        int index_prev = (index_0 > 0) ? (index_0-1) : (positionsTextureSize-1);\n        vec4 data_prev = fetchTexel(positionsTexture, positionsTextureSize, index_prev);\n        vec4 pos_prev = modelViewMatrix * vec4(data_prev.xyz, 1.0);\n        segmentStartDir = normalize(segmentDir + normalize(pos_0.xyz - pos_prev.xyz));\n        // segmentStartDir = segmentDir;\n      }\n      // vec3 startBiTangent = normalize(cross(segmentStartDir, viewVector));\n      // viewNormal = normalize(cross(segmentStartDir, startBiTangent));\n      vec3 startBiTangent = normalize(vec3(-segmentStartDir.y, segmentStartDir.x, 0.0));\n      viewNormal = normalize(-viewVector);\n      // Move the endpoints to overlap a bit more.\n      //viewPos -= vec3(segmentStartDir * lineThickness_0 * 0.25);\n      if (mod(vertexIDs, 2.0) == 0.0) {\n        viewPos += vec3(startBiTangent * lineThickness_0);\n        texCoord.x = 1.0;\n      }\n      else {\n        viewPos -= vec3(startBiTangent * lineThickness_0);\n        texCoord.x = 0.0;\n      }\n      texCoord.y = 0.0;\n    }\n    else {\n      vec3 segmentEndDir = segmentDir;\n      if (seqentialIndex_1 != 0) {\n        //if index_1 == numPoints-1, get the first index in the line as next\n        int index_next = (index_1 < (positionsTextureSize-1)) ? (index_1+1) : 0;\n        vec4 data_next = fetchTexel(positionsTexture, positionsTextureSize, index_next);\n        vec4 pos_next = modelViewMatrix * vec4(data_next.xyz, 1.0);\n        segmentEndDir = normalize(segmentDir + normalize(pos_next.xyz - pos_1.xyz));\n        // segmentEndDir = segmentDir;\n      }\n      // vec3 endBiTangent = normalize(cross(segmentEndDir, viewVector));\n      // viewNormal = normalize(cross(segmentEndDir, endBiTangent));\n      vec3 endBiTangent = normalize(vec3(-segmentEndDir.y, segmentEndDir.x, 0.0));\n      viewNormal = normalize(-viewVector);\n      // Move the endpoints to overlap a bit more.\n      //viewPos += vec3(segmentEndDir * lineThickness_1 * 0.25);\n      if (mod(vertexIDs, 2.0) == 0.0) {\n        viewPos += vec3(endBiTangent * lineThickness_1);\n        texCoord.x = 1.0;\n      }\n      else {\n        viewPos -= vec3(endBiTangent * lineThickness_1);\n        texCoord.x = 0.0;\n      }\n      texCoord.y = 1.0;\n    }\n\n    // Move the line towards the viewer by the line thickness.\n    // this is to avoid depth issues when lines are rendered over meshes. \n    viewPos.z += (lineThickness_0 + lineThickness_1) * 0.5;\n  }\n\n  return viewPos;\n}\n\n"),NC.setShaderModule("constants.glsl","#define GLSLIFY 1\n#define PI 3.141592653589793\n#define TwoPI (2.0 * PI)\n#define HalfPI (0.5 * PI)\n\n"),NC.setShaderModule("convolve-helpers.glsl","#define GLSLIFY 1\n\n#ifdef ENVMAP_CUBE\n\nuniform samplerCube envMap;\n\nvec4 sampleEnvMap(vec3 dir) {\n  return texture(envMap, dir);\n}\n\n#else \n\nuniform sampler2D   envMap;\n\nimport 'envmap-octahedral.glsl'\n\nvec4 sampleEnvMap(vec3 dir) {\n  vec2 uv = dirToSphOctUv(dir);\n  vec4 texel = texture2D(envMap, vec2(uv.x, 1.0 - uv.y));\n  return vec4(texel.rgb/texel.a, 1.0); // TODO: Check this line. Do we need it?\n}\n\n#endif \n\nvec3 cubeFaceUvToDir(float u, float v, int faceId) {\n\n  // normalize into [-1, 1] range\n  float n_u = 2.0 * u - 1.0;\n  float n_v = 2.0 * v - 1.0;\n\n  vec3 dir;\n  switch (faceId)\n  {\n  case 0: //TEXTURE_CUBE_MAP_POSITIVE_X:\n    dir.x = 1.0f;\n    dir.y = n_v;\n    dir.z = -n_u;\n    break;\n  case 1: //TEXTURE_CUBE_MAP_NEGATIVE_X:\n    dir.x = -1.0f;\n    dir.y = n_v;\n    dir.z = n_u;\n    break;\n  case 3: //TEXTURE_CUBE_MAP_POSITIVE_Y:\n    dir.x = n_u;\n    dir.y = 1.0f;\n    dir.z = -n_v;\n    break;\n  case 2: //TEXTURE_CUBE_MAP_NEGATIVE_Y:\n    dir.x = n_u;\n    dir.y = -1.0f;\n    dir.z = n_v;\n    break;\n  case 4: //TEXTURE_CUBE_MAP_POSITIVE_Z:\n    dir.x = n_u;\n    dir.y = n_v;\n    dir.z = 1.0f;\n    break;\n  case 5: //TEXTURE_CUBE_MAP_NEGATIVE_Z:\n    dir.x = -n_u;\n    dir.y = n_v;\n    dir.z = -1.0f;\n    break;\n  }\n  return normalize(dir);\n}\n\n"),NC.setShaderModule("cutaways.glsl","#define GLSLIFY 1\nconst int GEOMITEM_FLAG_CUTAWAY = 1; // 1<<0;\nconst int GEOMITEM_INVISIBLE_IN_GEOMDATA = 2; // 1<<1;\nconst int GEOMITEM_TRANSPARENT = 4; // 1<<1;\n\nuniform color cutColor;\n\n#ifdef ENABLE_FLOAT_TEXTURES\n  vec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n  }\n\n#else\n\n  uniform vec4 cutawayData;\n\n  vec4 getCutaway(int id) {\n    return cutawayData;\n  }\n\n#endif\n\n#define RAY_EPS 0.0000001\nstruct Ray {\n  vec3 start;\n  vec3 dir;\n};\n\nfloat intersectRayPlane(Ray ray, Ray plane) {\n  vec3 w = ray.start - plane.start;\n  float D = dot(plane.dir, ray.dir);\n  float N = dot(-plane.dir, w);\n\n  if (abs(D) < RAY_EPS) {\n    // segment is parallel to plane\n    if (N == 0.0)\n      return -1.0; // segment lies in plane\n    else\n      return -1.0; // no intersection\n  }\n  // they are not parallel\n  // compute intersect param\n  float sI = N / D;\n  if (sI < -RAY_EPS) {\n    return -1.0; // no intersection\n  }\n  return sI;\n}\n\nbool cutaway(vec3 worldPos, vec3 planeNormal, float planeDist) {\n\n  vec3 planePos = planeNormal * planeDist;\n  vec3 planeDir = worldPos + planePos;\n  float planeOffset = dot(planeDir, planeNormal);\n  if (planeOffset > 0.0) {\n    return true;\n  }\n  return false;\n}\n"),NC.setShaderModule("debugColors.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\n\nvec3 getDebugColor(float id) {\n  int sel = int(round(mod(round(id), 16.0)));\n  \n  if (sel==0)\n    return vec3(0.0, 1.0, 1.0);\n  else if (sel==1)\n    return vec3(0.0, 1.0, 0.0);\n  else if (sel==2)\n    return vec3(1.0, 0.0, 1.0);\n  else if (sel==3)\n    return vec3(0.75, 0.75, 0.0);\n  else if (sel==4)\n    return vec3(0.0, 0.75, 0.75);\n  else if (sel==5)\n    return vec3(0.75, 0.0, 0.75);\n  else if (sel==6)\n    return vec3(0.45, 0.95, 0.0);\n  else if (sel==7)\n    return vec3(0.0, 0.45, 0.95);\n  else if (sel==8)\n    return vec3(0.95, 0.0, 0.45);\n  else if (sel==9)\n    return vec3(0.95, 0.45, 0.0);\n  else if (sel==10)\n    return vec3(0.0, 0.95, 0.45);\n  else if (sel==11)\n    return vec3(0.45, 0.0, 0.95);\n  else if (sel==12)\n    return vec3(0.45, 0.45, 0.95);\n  else if (sel==13)\n    return vec3(0.0, 0.0, 0.45);\n  else if (sel==14)\n    return vec3(0.0, 0.45, 0.45);\n  else if (sel==15)\n    return vec3(0.45, 0.0, 0.45);\n  else return vec3(0.2, 0.2, 0.2);\n}\n\n"),NC.setShaderModule("drawItemId.glsl",UC),NC.setShaderModule("geomItemId.glsl",UC),NC.setShaderModule("geomType.glsl","#define GLSLIFY 1\n\nconst int TRIANGLES = 0;\nconst int LINES = 1;\nconst int POINTS = 2;"),NC.setShaderModule("drawItemTexture.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nuniform sampler2D instancesTexture;\nuniform highp int instancesTextureSize;\n\n// See also: src\\Renderer\\GLSLConstants.js\n// const pixelsPerGLGeomItem = 8\nconst int pixelsPerItem = 8;\n\nvec4 getInstanceData(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 0);\n}\n\n#else\n\nuniform vec4 drawItemData;\n\nvec4 getInstanceData(int id) {\n  return drawItemData;\n}\n\n#endif\n\n"),NC.setShaderModule("envmap-dualfisheye.glsl","#define GLSLIFY 1\n\nvec2 dualfisheyeUVsFromDir(vec3 dir) {\n  vec2 result;\n  float angle = 0.465;\n  if (dir.x < 0.0) {\n    result = vec2(((dir.z * -angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n  }\n  else {\n    result = vec2( 0.5 + ((dir.z * angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n  }\n  return result;\n}\n\n"),NC.setShaderModule("envmap-equirect.glsl","#define GLSLIFY 1 \nimport 'constants.glsl'\n\nvec2 latLongUVsFromDir(vec3 dir) {\n  // Math function taken from...\n  // http://gl.ict.usc.edu/Data/HighResProbes/\n  // Note: Scaling from u=[0,2], v=[0,1] to u=[0,1], v=[0,1]\n  float phi = acos(dir.z);\n  float theta = atan(dir.x, dir.y);\n  return vec2((1.0 + theta / PI) / 2.0, phi / PI);\n}\n\n// Note: when u == 0.5 z = 1.0\nvec3 dirFromLatLongUVs(float u, float v) {\n  // http://gl.ict.usc.edu/Data/HighResProbes/\n  float theta = PI*((u * 2.0) - 1.0);\n  float phi = PI*v;\n  return vec3(sin(phi)*sin(theta), sin(phi)*cos(theta), cos(phi));\n}\n\nvec3 dirFromPolar(vec2 polar) {\n  float u = polar.x / (PI * 2.0);\n  float v = polar.y / PI;\n  return dirFromLatLongUVs(u, v);\n}\n\n"),NC.setShaderModule("envmap-octahedral.glsl","#define GLSLIFY 1\nimport 'constants.glsl'\nimport 'GLSLUtils.glsl'\n#define sectorize(value) step(0.0, (value))*2.0-1.0\n#define sum(value) dot(clamp((value), 1.0, 1.0), (value))\n\nvec2 dirToSphOctUv(vec3 normal) {\n  normal = normalize(normal);\n  vec3 aNorm = abs(normal);\n  vec3 sNorm = sectorize(normal);\n  \n  vec2 dir = aNorm.xy;\n  float orient = atan(dir.x, max(dir.y,0.0000000000000001))/HalfPI;\n\n  dir = vec2(aNorm.z, length(aNorm.xy));\n  float pitch = atan(dir.y, dir.x)/HalfPI;\n\n  vec2 uv = vec2(sNorm.x*orient, sNorm.y*(1.0-orient))*pitch;\n\n  if (normal.z < 0.0) {\n    uv = sNorm.xy - abs(uv.ts)*sNorm.xy;\n  }\n  vec2 res = uv*0.5+0.5;\n  // Flip-v\n  // return res;\n  return vec2(res.x, 1.0 - res.y);\n}\n\nvec3 sphOctUvToDir(vec2 uv) {\n  uv = uv*2.0-1.0;\n  // Flip-v\n  uv.y = -uv.y;\n  vec2 suv = sectorize(uv);\n  float sabsuv = sum(abs(uv));\n  float pitch = sabsuv*HalfPI;\n\n  if (pitch <= 0.0) {\n    return vec3(0.0, 0.0, 1.0);\n  }\n  if (abs(pitch - PI) < 0.000001) {\n    return vec3(0.0, 0.0, -1.0);\n  }\n  if (sabsuv > 1.0) {\n    uv = (1.0-abs(uv.ts))*suv;\n  }\n\n  float orient = (abs(uv.s)/sabsuv)*HalfPI;\n  float sOrient = sin(orient);\n  float cOrient = cos(orient);\n  float sPitch = sin(pitch);\n  float cPitch = cos(pitch);\n\n  return vec3(\n    sOrient*suv.s*sPitch,\n    cOrient*suv.t*sPitch,\n    cPitch\n  );\n}\n\n"),NC.setShaderModule("GLSLBits.glsl",'#define GLSLIFY 1\n    \n/////////////////////////////////////////////////////////////////\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\nfloat shift_right(float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\n  return floor(v * exp2(amt) + 0.5);\n}\n\nfloat mask_last(float v, float bits) {\n  return mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\n  from = floor(from + 0.5);\n  to = floor(to + 0.5);\n  return mask_last(shift_right(num, from), to - from);\n}\n\n/////////////////////////////////////////////////////////////////\n// https://stackoverflow.com/questions/18453302/how-do-you-pack-one-32bit-int-into-4-8bit-ints-in-glsl-webgl\n\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\nvec4 EncodeFloatRGBA (float v) {\n  vec4 enc = bitEnc * v;\n  enc = fract(enc);\n  enc -= enc.yzww * vec2(1./255., 0.).xxxy;\n  return enc;\n}\nfloat DecodeFloatRGBA (vec4 v) {\n  return dot(v, bitDec);\n}\n\n/////////////////////////////////////////////////////////////////\n// https://gist.github.com/Flexi23/1713774\n// \nvec2 encode16BitFloatInto2xUInt8(float v) {\n  vec2 c = vec2(0.);\n\n  int signum = (v >= 0.) ? 128 : 0;\n  v = abs(v);\n  int exponent = 15;\n  float limit = 1024.; // considering the bias from 2^-5 to 2^10 (==1024)\n  for(int exp = 15; exp > 0; exp--) {\n    if ( v < limit) {\n      limit /= 2.;\n      exponent--;\n    }\n  }\n\n  float rest;\n  if (exponent == 0) {\n    rest = v / limit / 2.;      // "subnormalize" implicite preceding 0. \n  } \n  else {\n    rest = (v - limit)/limit;   // normalize accordingly to implicite preceding 1.\n  }\n\n  int mantissa = int(rest * 2048.);   // 2048 = 2^11 for the (split) 11 bit mantissa\n  int msb = mantissa / 256;           // the most significant 3 bits go into the lower part of the first byte\n  int lsb = mantissa - msb * 256;     // there go the other 8 bit of the lower significance\n\n  c.x = float(signum + exponent * 8 + msb) / 255.;    // color normalization for texture2D\n  c.y = float(lsb) / 255.;\n\n  if (v >= 2048.) {\n    c.y = 1.;\n  }\n\n  return c;\n}\n\nfloat decode16BitFloatFrom2xUInt8(vec2 c) {\n  float v = 0.;\n\n  int ix = int(c.x*255.); // 1st byte: 1 bit signum, 4 bits exponent, 3 bits mantissa (MSB)\n  int iy = int(c.y*255.); // 2nd byte: 8 bit mantissa (LSB)\n\n  int s = (c.x >= 0.5) ? 1 : -1;\n  ix = (s > 0) ? ix - 128 : ix;   // remove the signum bit from exponent\n  int iexp = ix / 8;              // cut off the last 3 bits of the mantissa to select the 4 exponent bits\n  int msb = ix - iexp * 8;        // subtract the exponent bits to select the 3 most significant bits of the mantissa\n\n  int norm = (iexp == 0) ? 0 : 2048;          // distinguish between normalized and subnormalized numbers\n  int mantissa = norm + msb * 256 + iy;       // implicite preceding 1 or 0 added here\n  norm = (iexp == 0) ? 1 : 0;                 // normalization toggle\n  float exponent = pow( 2., float(iexp + norm) - 16.); // -5 for the the exponent bias from 2^-5 to 2^10 plus another -11 for the normalized 12 bit mantissa \n  v = float( s * mantissa ) * exponent;\n\n  return v;\n}\n\n// TODO : Encoding Float32 to 4x UInt8\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n// http://ultraist.hatenablog.com/entry/20110608/1307539319\n\n'),NC.setShaderModule("GLSLUtils.glsl","#define GLSLIFY 1\n\nint ftoi(float val) {\n  return int(floor(val + 0.5));\n}\nivec2 ftoi(vec2 v2) {\n  return ivec2(ftoi(v2.x), ftoi(v2.y));\n}\nivec3 ftoi(vec3 v4) {\n  return ivec3(ftoi(v4.x), ftoi(v4.y), ftoi(v4.z));\n}\nivec4 ftoi(vec4 v4) {\n  return ivec4(ftoi(v4.x), ftoi(v4.y), ftoi(v4.z), ftoi(v4.w));\n}\n\n#ifdef ENABLE_ES3\n\nint imod(int x, int y) {\n  return x % y;\n}\n\nvoid setFlag(inout int flags, int flag) {\n  flags |= flag;\n}\n\nvoid clearFlag(inout int flags, int flag) {\n  flags &= ~flag;\n}\n\nbool testFlag(int flags, int flag) {\n  return (flags & flag) != 0;\n}\n\n// private function: Mangle me...\nivec2 _pixelIndexToUV(int index, int textureWidth) {\n  return ivec2(index % textureWidth, index / textureWidth);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureWidth, int index) {\n  return texelFetch(texture, _pixelIndexToUV(index, textureWidth), 0);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n  return texelFetch(texture, texCoord, 0);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, int index) {\n    return texelFetch(texture, _pixelIndexToUV(index, textureSize.x), 0);\n}\n\n#else\n\n// TODO: integrate: https://gist.github.com/mattatz/70b96f8c57d4ba1ad2cd\n\nint max(int a, int b) {\n  return a > b ? a : b;\n}\nint min(int a, int b) {\n  return a < b ? a : b;\n}\n\nfloat round(float val) {\n  return floor(val + 0.4);\n}\n\nint imod(int x, int y) {\n  return x-y*(x/y);\n}\n\nvoid setFlag(inout int flags, int flag) {\n  flags += flag;\n}\nvoid clearFlag(inout int flags, int flag) {\n  flags -= flag;\n}\n\nbool testFlag(int flags, int flag) {\n  return imod(flags / flag, 2) != 0;\n}\n\n// private function: Mangle me...\nvec2 _pixelIndexToUV(int index, int textureSize) {\n  float flTexSize = float(textureSize);\n  float x = (float(imod(index, textureSize))+0.5)/flTexSize;\n  float y = (floor(float(index / textureSize))+0.5)/flTexSize;\n  return vec2(x, y);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureSize, int index) {\n  vec2 texCoord = _pixelIndexToUV(index, textureSize);\n  return texture2D(texture, texCoord);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n  vec2 ftextureSize = vec2(textureSize);\n  return texture2D(texture, (vec2(texCoord) + 0.5) / ftextureSize);\n}\n\n#endif // ENABLE_ES3\n\nint uvToPixelIndex(vec2 uv, int textureSize) {\n  return int(uv.x * float(textureSize)) + (int(floor(uv.y * float(textureSize))) * textureSize);\n}\n\n"),NC.setShaderModule("Hammersley.glsl","#define GLSLIFY 1\nfloat RadicalInverse_VdC(uint bits) \n{\n  bits = (bits << 16u) | (bits >> 16u);\n  bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n  bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n  bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n  bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n  return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n}\n// ----------------------------------------------------------------------------\nvec2 Hammersley(uint i, uint N)\n{\n  return vec2(float(i)/float(N), RadicalInverse_VdC(i));\n} \n"),NC.setShaderModule("ImportanceSampleGGX.glsl","#define GLSLIFY 1\nimport 'constants.glsl'\n\nvec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n{\n  float a = roughness*roughness;\n\n  float phi = 2.0 * PI * Xi.x;\n  float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n  float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n\n  // from spherical coordinates to cartesian coordinates\n  vec3 H = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\n  // from tangent-space vector to world-space sample vector\n  vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n  vec3 tangent   = normalize(cross(up, N));\n  vec3 bitangent = cross(N, tangent);\n\n  vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n  return normalize(sampleVec);\n} \n"),NC.setShaderModule("materialparams.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\nimport 'gamma.glsl'\n\n#ifdef ENABLE_MULTI_DRAW\n \nuniform sampler2D materialsTexture;\nuniform highp ivec2 materialsTextureSize;\n\nvec4 getMaterialValue(vec2 materialCoords, int valueIndex) {\n  int index = ftoi(materialCoords.x) + valueIndex;\n  ivec2 texelCoords = ivec2(imod(index, materialsTextureSize.x), index / materialsTextureSize.x);\n  \n  return fetchTexel(materialsTexture, materialsTextureSize, texelCoords);\n}\n\n#else // ENABLE_MULTI_DRAW\n\n////////////////////////\n// Material Param Helpers.\n\nvec4 getColorParamValue(vec4 value, sampler2D tex, int texType, vec2 texCoord) {\n  if (texType == 0) {\n    return value;\n  }\n  else if (texType == 1 || texType == 2) {\n    // Note: we assume textures are always in gamma space, and must be converted\n    // to linear. I cann't find evidence that 8-bit textures can be in linear space.\n    // TODO: Use SRGB textures.\n    return toLinear(texture2D(tex, texCoord));\n  }\n  else if (texType == 3) {\n    // Float HDR Texture. We assume these textures are in linear space.\n    return texture2D(tex, texCoord);\n  }\n  else\n    return value;\n}\n\nfloat luminanceFromRGB(vec3 rgb) {\n  return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\nfloat getLuminanceParamValue(float value, sampler2D tex, int texType, vec2 texCoord) {\n  if (texType == 0)\n    return value;\n  else\n    return luminanceFromRGB(texture2D(tex, texCoord).rgb);\n}\n\n#endif // ENABLE_MULTI_DRAW\n"),NC.setShaderModule("modelMatrix.glsl","#define GLSLIFY 1\n#ifdef ENABLE_FLOAT_TEXTURES\nimport 'GLSLUtils.glsl'\nimport 'transpose.glsl'\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n  // Unpack 3 x 4 matrix columns into a 4 x 4 matrix.\n  vec4 col0 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 1);\n  vec4 col1 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 2);\n  vec4 col2 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 3);\n  mat4 result = transpose(mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0)));\n  return result;\n}\n\nmat4 getModelMatrix(int id) {\n  return getMatrix(instancesTexture, instancesTextureSize, id);\n}\n\n#else\n\nuniform mat4 modelMatrix;\n\nmat4 getModelMatrix(int id) {\n  return modelMatrix;\n}\n\n#endif\n\n"),NC.setShaderModule("PBRSurfaceRadiance.glsl","#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\nconst int ENVMAP_FLAG_HEADLIGHT =  1; // 1<<0;\n\nstruct MaterialParams {\n  vec3 baseColor;\n  float ambientOcclusion;\n  float metallic;\n  float roughness;\n  float reflectance;\n  float opacity;\n  float emission;\n};\n\n#ifndef ENABLE_PBR\n\nvec4 pbrSurfaceRadiance(in MaterialParams material, vec3 normal, in vec3 viewVector) {\n  vec3 irradiance = vec3(dot(normal, viewVector));\n  float ao = material.ambientOcclusion; \n  return vec4(material.baseColor * ao * irradiance + (material.emission * material.baseColor), material.opacity);\n\n  // return vec4(material.baseColor * ao * irradiance , material.opacity);\n}\n\n#else\n\nuniform int envMapFlags;\nuniform samplerCube irradianceMap;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\n\nvec3 sampleIrradiance(vec3 dir) {\n  return texture(irradianceMap, dir).rgb;\n}\n\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness) {\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\n}\n\nfloat luminance(vec3 color) {\n  return 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\n\nvec4 pbrSurfaceRadiance(in MaterialParams material, vec3 normal, in vec3 viewVector) {\n  if (envMapFlags == -1) {\n    vec3 irradiance = vec3(dot(normal, viewVector));\n    float ao = material.ambientOcclusion; \n    return vec4(material.baseColor * ao * irradiance + (material.emission * material.baseColor), material.opacity);\n  }\n\n  vec3 N = normal;\n  vec3 V = viewVector;\n  vec3 R = reflect(-V, N);\n  float roughness = material.roughness * material.roughness;\n  vec3 diffuseColor = (1.0 - material.metallic) * material.baseColor;\n\n  // Note: The specular reflectance of metallic surfaces is chromatic\n  // https://google.github.io/filament/Filament.html#listing_fnormal\n  vec3 F0 = 0.16 * material.reflectance * material.reflectance * (1.0 - material.metallic) + material.baseColor * material.metallic;\n\n  float NdotV = dot(N, V);\n\n  vec3 F = fresnelSchlickRoughness(max(NdotV, 0.0), F0, roughness);\n\n  vec3 kS = F;\n  vec3 kD = 1.0 - kS;\n  kD *= 1.0 - material.metallic;\n  float ao = material.ambientOcclusion; \n  \n  vec3 irradiance;\n  vec3 irradianceSampleDir = normal;\n  \n  bool headLightMode = testFlag(envMapFlags, ENVMAP_FLAG_HEADLIGHT);\n  if (headLightMode) {\n    irradianceSampleDir = viewVector;\n  }\n  irradiance = sampleIrradiance(irradianceSampleDir);\n  // vec3 irradiance = shGetIrradianceAt(shCoefficients, N);\n  vec3 diffuse    = irradiance * diffuseColor;\n  \n  const float MAX_REFLECTION_LOD = 4.0;\n  vec3 prefilteredColor = textureLod(prefilterMap, R,  roughness * MAX_REFLECTION_LOD).rgb;   \n  vec2 envBRDF  = texture(brdfLUT, vec2(max(NdotV, 0.0), roughness)).rg;\n  vec3 specular = prefilteredColor * (F * envBRDF.x + envBRDF.y);\n  \n  vec3 radiance = (kD * diffuse + specular) * ao;\n  \n  // Now handle semi-transparent objects. We need to be able to linearly interpolate\n  // opacity to make objects disappear, so we need a continuous change.\n  float opacity = material.opacity;\n  vec4 transparent = vec4((radiance * opacity) + specular, opacity + luminance(specular) + luminance(F));\n  vec4 result = mix(transparent, vec4(radiance, 1.0), opacity);\n\n  // Add emission on as the final component.\n  // Note: emission allows a material to blend off its specular component, \n  // which can also be used to make an object completely disappear if also transparent.\n  return mix(result, vec4(material.baseColor, opacity), material.emission);\n}\n\n#endif // ENABLE_PBR\n"),NC.setShaderModule("SHCoeffs.glsl","#define GLSLIFY 1\nuniform vec3 shCoeffs[9];\n\nvec3 sampleSHCoeffs(vec3 dir) {\n  // dir is assumed to have unit length\n  float x = dir.x, y = dir.y, z = dir.z;\n  // band 0\n  vec3 result = shCoeffs[ 0 ] * 0.886227;\n  // band 1\n  result += shCoeffs[ 1 ] * 2.0 * 0.511664 * y;\n  result += shCoeffs[ 2 ] * 2.0 * 0.511664 * z;\n  result += shCoeffs[ 3 ] * 2.0 * 0.511664 * x;\n  // band 2\n  result += shCoeffs[ 4 ] * 2.0 * 0.429043 * x * y;\n  result += shCoeffs[ 5 ] * 2.0 * 0.429043 * y * z;\n  result += shCoeffs[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n  result += shCoeffs[ 7 ] * 2.0 * 0.429043 * x * z;\n  result += shCoeffs[ 8 ] * 0.429043 * ( x * x - y * y );\n  return result;\n}\n"),NC.setShaderModule("gamma.glsl","#define GLSLIFY 1\nconst float gamma_const = 2.2;\n\nfloat toLinear(float v) {\n  return pow(v, gamma_const);\n}\n\nvec2 toLinear(vec2 v) {\n  return pow(v, vec2(gamma_const));\n}\n\nvec3 toLinear(vec3 v) {\n  return pow(v, vec3(gamma_const));\n}\n\nvec4 toLinear(vec4 v) {\n  return vec4(toLinear(v.rgb), v.a);\n}\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma_const);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma_const));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma_const));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nfloat toGamma(float v, float gamma) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v, float gamma) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v, float gamma) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v, float gamma) {\n  return vec4(toGamma(v.rgb, gamma), v.a);\n}\n\n"),NC.setShaderModule("inverse.glsl","#define GLSLIFY 1\n\n#ifndef ENABLE_ES3\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n#endif\n\n"),NC.setShaderModule("transpose.glsl","#define GLSLIFY 1\n\n#ifndef ENABLE_ES3\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n#endif\n\n"),NC.setShaderModule("quadVertexFromID.glsl","#define GLSLIFY 1\nattribute float vertexIDs;\n\nvec2 getQuadVertexPositionFromID() {\n  int vertexID = int(vertexIDs);\n  if (vertexID == 0)\n    return vec2(-0.5, -0.5);\n  else if (vertexID == 1)\n    return vec2(0.5, -0.5);\n  else if (vertexID == 2)\n    return vec2(-0.5, 0.5);\n  else if (vertexID == 3)\n    return vec2(0.5, 0.5);\n  return vec2(0,0);\n}\n"),NC.setShaderModule("unpackHDR.glsl","#define GLSLIFY 1\n\nvec3 decodeHDR(const in vec3 ldrPixel, const in float cdmAlpha) {\n  float avg = (cdmAlpha * 16.0 - 8.0);\n  float scl = 1.0;\n  vec3 color;\n  color.x = (tan((ldrPixel.x-0.5)*1.5)/scl)+avg;\n  color.y = (tan((ldrPixel.y-0.5)*1.5)/scl)+avg;\n  color.z = (tan((ldrPixel.z-0.5)*1.5)/scl)+avg;\n\n  // convert from logarithmic curve to linear curve.\n  // subtract the epsilon that was added during encoding.\n  const float eps = 0.001;\n  color.x = pow(10.0, color.x) - eps;\n  color.y = pow(10.0, color.y) - eps;\n  color.z = pow(10.0, color.z) - eps;\n  return color;\n}\n\nvec3 decodeHDR(sampler2D ldrSampler, sampler2D cdmSampler, vec2 texCoord) {\n#ifdef ENABLE_ES3\n  float cdm = texture2D(cdmSampler, texCoord).r;\n#else\n  float cdm = texture2D(cdmSampler, texCoord).a;\n#endif\n  return decodeHDR(texture2D(ldrSampler, texCoord).rgb, cdm);\n}\n\n");class vC extends DC{constructor(A){super(A,"UnpackHDRShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER"," \nprecision highp float;\n#define GLSLIFY 1\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D cdmSampler;\nuniform vec4 srcRegion; // pos, and size of the source region\n\nimport 'unpackHDR.glsl'\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 srcUv = srcRegion.xy + (v_texCoord * srcRegion.zw);\n\n  fragColor = vec4(decodeHDR(ldrSampler, cdmSampler, srcUv), 1.0);\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n")}}const kC=(A,g)=>{let I,C,i;switch(g){case"UInt8":I=1,C=4,i=A.UNSIGNED_BYTE;break;case"SInt8":I=1,C=4,i=A.BYTE;break;case"UInt16":I=1,C=4,i=A.UNSIGNED_SHORT;break;case"SInt16":I=1,C=4,i=A.SHORT;break;case"UInt32":I=1,C=4,i=A.UNSIGNED_INT;break;case"SInt32":I=1,C=4,i=A.INT;break;case"Float32":I=1,C=4,i=A.FLOAT;break;case"Vec2":I=2,C=4,i=A.FLOAT;break;case"Vec3":I=3,C=4,i=A.FLOAT;break;case"Vec4":case"Color":I=4,C=4,i=A.FLOAT;break;case"RGBA":I=4,C=1,i=A.UNSIGNED_BYTE;break;default:throw"Unhandled Type"}return{dimension:I,elementSize:C,dataType:i}};class xC{}class zC extends xC{constructor(A,g,I,C){super(),this.gl=A,this.shaderAttrs=g,this.glattrbuffers=I,this.indexBuffer=C}bind(A){const g=this.gl;for(const A in this.shaderAttrs){if("instancedIds"==A)continue;const I=this.shaderAttrs[A],C=I.location;if(-1==C)continue;const i=this.glattrbuffers[A];if(!i){g.disableVertexAttribArray(C);continue}const e=kC(this.gl,i.dataType),t=e.dimension*e.elementSize,B=null!=i.offset?i.offset*e.dimension*e.elementSize:0,o=1==i.normalized,s=I.instanced;g.enableVertexAttribArray(C),g.bindBuffer(g.ARRAY_BUFFER,i.buffer),g.vertexAttribPointer(C,e.dimension,e.dataType,o,t,B),g.vertexAttribDivisor&&(1==s?g.vertexAttribDivisor(C,1):g.vertexAttribDivisor(C,0))}return g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.indexBuffer),!0}unbind(){const A=this.gl;for(const g in this.shaderAttrs){const I=this.shaderAttrs[g],C=I.location;-1==C&&A.enableVertexAttribArray(C),I.instanced&&A.vertexAttribDivisor(C,0)}A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,null)}destroy(){}}class TC extends xC{constructor(A,g,I,C){super(),this.gl=A,this.vao=A.createVertexArray(),A.bindVertexArray(this.vao);for(const C in g){if("instancedIds"==C)continue;const i=g[C],e=i.location;if(-1==e)continue;let t=I[C];if(!t&&(C.endsWith("Next")&&(t=I[C.substring(0,C.length-4)],i.offset=1),!t)){A.disableVertexAttribArray(e);continue}const B=kC(A,t.dataType),o=B.dimension*B.elementSize,s=null!=i.offset?i.offset*B.dimension*B.elementSize:0,a=1==t.normalized,l=i.instanced;A.enableVertexAttribArray(e),A.bindBuffer(A.ARRAY_BUFFER,t.buffer),A.vertexAttribPointer(e,B.dimension,B.dataType,a,o,s),A.vertexAttribDivisor&&(1==l?A.vertexAttribDivisor(e,1):A.vertexAttribDivisor(e,0))}this.indexBuffer=C,this.indexBuffer&&A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}bind(A){const g=this.gl;return g.bindVertexArray(this.vao),this.indexBuffer&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.indexBuffer),!0}unbind(){const A=this.gl;A.bindVertexArray(null),this.indexBuffer&&A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,null)}destroy(){const A=this.gl;this.indexBuffer&&(A.bindVertexArray(this.vao),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,null)),A.deleteVertexArray(this.vao)}}function _C(A,g,I,C){return null==A.createVertexArray?new zC(A,g,I,C):new TC(A,g,I,C)}class PC{constructor(A){this.stack=[],this.gl=A,this.pushGLStack()}pushGLStack(){this.top={enabled:new Set,disabled:new Set,functions:{}},this.stack.push(this.top)}popGLStack(){const A=this.top;this.top=this.stack.pop(),this.stack.length>0&&(A.enabled.forEach((A=>{let g;for(g=this.stack.length-1;g>=0;g--){const I=this.stack[g];if(I.enabled.has(A))break;if(I.disabled.has(A)){this.gl.disable(A);break}}g<0&&this.gl.disable(A)})),A.disabled.forEach((A=>{let g;for(g=this.stack.length-1;g>=0;g--){const I=this.stack[g];if(I.disabled.has(A))break;if(I.enabled.has(A)){this.gl.enable(A);break}}g<0&&this.gl.enable(A)})))}glEnable(A){this.gl.enable(A),this.top.enabled.add(A)}glDisable(A){this.gl.disable(A),this.top.disabled.add(A)}setGLParam(A,g){this.top[A]=g,Array.isArray(g)?this.gl[A](...g):this.gl[A](g)}}class OC extends PC{}class jC extends PC{toHighlightRenderState(){const A=new OC(this.gl);return A.boundRendertarget=this.boundRendertarget,A.viewXfo=this.viewXfo,A.viewScale=this.viewScale,A.region=this.region,A.cameraMatrix=this.cameraMatrix,A.viewport=this.viewport,A.viewports=this.viewports,A.vrPresenting=this.vrPresenting,A}}class qC extends PC{}class $C extends HC{constructor(A,g){super(A),this.listenerIDs={},this.fbo=null,this.srcLDRTex=null,this.srcCDMTex=null,this.unpackHDRShader=null,this.shaderBinding=null,this.hdrImage=g;const I=()=>{this.__unpackHDRImage(this.hdrImage.getParams())};this.listenerIDs.updated=this.hdrImage.on("updated",I),this.hdrImage.isLoaded()?I():this.listenerIDs.loaded=this.hdrImage.on("loaded",I)}getImage(){return this.hdrImage}__unpackHDRImage(A){const g=this.__gl,I=A.data.ldr,C=A.data.cdm;if(this.fbo)this.srcLDRTex.bufferData(I),this.srcCDMTex.bufferData(C);else{this.configure({format:"RGBA",type:"FLOAT",width:I.width,height:I.height,filter:"LINEAR",wrap:"CLAMP_TO_EDGE"}),this.fbo=new fC(this.__gl,this),this.fbo.setClearColor(new l(0,0,0,0)),this.srcLDRTex=new HC(this.__gl,{format:"RGB",type:"UNSIGNED_BYTE",width:I.width,height:I.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:I}),this.srcCDMTex=new HC(this.__gl,{format:"webgl2"==g.name?"RED":"ALPHA",type:"UNSIGNED_BYTE",width:I.width,height:I.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:C}),this.unpackHDRShader=new vC(this.__gl);const A=this.unpackHDRShader.compileForTarget("GLHDRImage",{directives:["#define ENABLE_ES3"]});this.shaderBinding=_C(this.__gl,A.attrs,g.__quadattrbuffers,g.__quadIndexBuffer)}this.fbo.bindAndClear();const i=new PC(g);this.unpackHDRShader.bind(i,"GLHDRImage"),this.shaderBinding.bind(i);const e=i.unifs;this.srcLDRTex.bindToUniform(i,e.ldrSampler),this.srcCDMTex.bindToUniform(i,e.cdmSampler),g.uniform4fv(e.srcRegion.location,[0,0,1,1]),g.drawQuad(),this.fbo.unbind(),this.emit("updated")}bindToUniform(A,g,I){return super.bindToUniform(A,g,I)}destroy(){super.destroy(),this.fbo&&(this.fbo.destroy(),this.srcLDRTex.destroy(),this.srcCDMTex.destroy()),this.unpackHDRShader&&this.unpackHDRShader.destroy(),this.shaderBinding&&this.shaderBinding.destroy(),"loaded"in this.listenerIDs&&this.hdrImage.removeListenerById("loaded",this.listenerIDs.loaded),this.hdrImage.removeListenerById("updated",this.listenerIDs.updated)}}class Ai extends DC{constructor(A){super(A,"PreComputeBRDFShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nvarying vec2 v_texCoord;\n\nimport 'GLSLUtils.glsl'\nimport 'Hammersley.glsl'\nimport 'ImportanceSampleGGX.glsl'\n\nfloat GeometrySchlickGGX(float NdotV, float roughness)\n{\n  float a = roughness;\n  float k = (a * a) / 2.0;\n\n  float nom   = NdotV;\n  float denom = NdotV * (1.0 - k) + k;\n\n  return nom / denom;\n}\n// ----------------------------------------------------------------------------\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n{\n  float NdotV = max(dot(N, V), 0.0);\n  float NdotL = max(dot(N, L), 0.0);\n  float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n  float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n  return ggx1 * ggx2;\n}\n\nvec2 IntegrateBRDF(float NdotV, float roughness)\n{\n  vec3 V;\n  V.x = sqrt(1.0 - NdotV*NdotV);\n  V.y = 0.0;\n  V.z = NdotV;\n\n  float A = 0.0;\n  float B = 0.0;\n\n  vec3 N = vec3(0.0, 0.0, 1.0);\n\n  for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n  {\n    vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n    vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n    vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n    float NdotL = max(L.z, 0.0);\n    float NdotH = max(H.z, 0.0);\n    float VdotH = max(dot(V, H), 0.0);\n\n    if (NdotL > 0.0)\n    {\n      float G = GeometrySmith(N, V, L, roughness);\n      float G_Vis = (G * VdotH) / (NdotH * NdotV);\n      float Fc = pow(1.0 - VdotH, 5.0);\n\n      A += (1.0 - Fc) * G_Vis;\n      B += Fc * G_Vis;\n    }\n  }\n  A /= float(SAMPLE_COUNT);\n  B /= float(SAMPLE_COUNT);\n  return vec2(A, B);\n}\n\nout vec2 fragColor;\nvoid main(void) {\n  vec2 integratedBRDF = IntegrateBRDF(v_texCoord.x, v_texCoord.y);\n  fragColor = integratedBRDF;\n}\n\n")}}class gi extends DC{constructor(A){super(A,"ConvolveIrradianceShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\nimport 'constants.glsl'\nimport 'convolve-helpers.glsl'\n\nuniform float roughness;\nuniform int faceId;\nvarying vec2 v_texCoord;\n\nout vec4 fragColor;\nvoid main(void) {\n\n  vec3 N = cubeFaceUvToDir(v_texCoord.x, v_texCoord.y, faceId);   \n\n  vec3 irradiance = vec3(0.0);\n\n  vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n  vec3 tangent   = normalize(cross(up, N));\n  vec3 bitangent = cross(N, tangent);\n\n  float nrSamples = 0.0; \n  for(float phi = 0.0; phi < 2.0 * PI; phi += SAMPLE_DELTA)\n  {\n    for(float theta = 0.0; theta < 0.5 * PI; theta += SAMPLE_DELTA)\n    {\n      // spherical to cartesian (in tangent space)\n      // from spherical coordinates to cartesian coordinates\n      vec3 H = vec3(cos(phi) * sin(theta), sin(phi) * sin(theta), cos(theta));\n      // tangent space to world\n      vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n\n      irradiance += sampleEnvMap(normalize(sampleVec)).rgb * cos(theta) * sin(theta);\n      nrSamples++;\n    }\n  }\n  irradiance = PI * irradiance * (1.0 / float(nrSamples));\n\n  fragColor = vec4(irradiance, 1.0);\n}\n")}}class Ii extends DC{constructor(A){super(A,"ConvolveSpecularShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","precision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'ImportanceSampleGGX.glsl'\nimport 'convolve-helpers.glsl'\nimport 'Hammersley.glsl'\n  \n  \nuniform float roughness;\nuniform int faceId;\nvarying vec2 v_texCoord;\n\nout vec4 fragColor;\nvoid main(void) {\n\n  vec3 N = cubeFaceUvToDir(v_texCoord.x, v_texCoord.y, faceId);   \n\n  vec3 R = N;\n  vec3 V = R;\n\n  float totalWeight = 0.0;   \n  vec3 prefilteredColor = vec3(0.0);     \n  for(uint i = 0u; i < SAMPLE_COUNT; ++i)\n  {\n    vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n    vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n    vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n    float NdotL = max(dot(N, L), 0.0);\n    if (NdotL > 0.0)\n    {\n      prefilteredColor += sampleEnvMap(L).rgb * NdotL;\n      totalWeight      += NdotL;\n    }\n  }\n  prefilteredColor = prefilteredColor / totalWeight;\n\n  fragColor = vec4(prefilteredColor, 1.0);\n}\n")}}class Ci extends V{constructor(A,g){super(),this.__gl=A;const I=A;this.maxFragmentShaderTextureUnits=A.getParameter(this.__gl.MAX_TEXTURE_IMAGE_UNITS),I.__quadVertexIdsBuffer||I.setupInstancedQuad(),this.textureType=1,this.textureDesc=[0,0,0,0],this.__convolved=!1,this.__fbos=[]}convolveProbe(A){const I=this.__gl,C=new PC(I);C.shaderopts={directives:["#define ENABLE_ES3","#define ENABLE_FLOAT_TEXTURES"]},"Low"==g.deviceCategory?(C.shaderopts.directives.push("#define SAMPLE_DELTA 0.1"),C.shaderopts.directives.push("#define SAMPLE_COUNT 64u")):"Medium"==g.deviceCategory?(C.shaderopts.directives.push("#define SAMPLE_DELTA 0.08"),C.shaderopts.directives.push("#define SAMPLE_COUNT 256u")):(C.shaderopts.directives.push("#define SAMPLE_DELTA 0.025"),C.shaderopts.directives.push("#define SAMPLE_COUNT 1024u")),this.brdfLUTTexture=I.createTexture(),I.bindTexture(I.TEXTURE_2D,this.brdfLUTTexture),I.texImage2D(I.TEXTURE_2D,0,I.RG16F,512,512,0,I.RG,I.FLOAT,null),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR);const i=new Ai(this.__gl),e=i.compileForTarget("GLProbe",C.shaderopts),t=_C(this.__gl,e.attrs,I.__quadattrbuffers,I.__quadIndexBuffer),B=I.createFramebuffer();I.bindFramebuffer(I.DRAW_FRAMEBUFFER,B),I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,this.brdfLUTTexture,0),i.bind(C),t.bind(C),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),I.viewport(0,0,512,512),I.drawQuad(),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,null),I.deleteFramebuffer(B),i.unbind(C),i.destroy();{const g=new gi(this.__gl),i=g.compileForTarget("GLProbe",C.shaderopts),e=_C(this.__gl,i.attrs,I.__quadattrbuffers,I.__quadIndexBuffer);g.bind(C,"GLProbe"),e.bind(C);const t=C.unifs;A.bindToUniform(C,t.envMap);const B=64;this.irradianceCubeTex=I.createTexture(),I.bindTexture(I.TEXTURE_CUBE_MAP,this.irradianceCubeTex),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MIN_FILTER,I.LINEAR_MIPMAP_LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_R,I.CLAMP_TO_EDGE);for(let A=0;A<6;A++)I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,I.RGBA32F,B,B,0,I.RGBA,I.FLOAT,null);const o=I.createFramebuffer();I.bindFramebuffer(I.DRAW_FRAMEBUFFER,o);for(let A=0;A<6;++A)I.uniform1i(t.faceId.location,A),I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+A,this.irradianceCubeTex,0),I.viewport(0,0,B,B),I.clearColor(1,0,0,1),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),I.drawQuad();I.bindFramebuffer(I.DRAW_FRAMEBUFFER,null),I.deleteFramebuffer(o),I.generateMipmap(I.TEXTURE_CUBE_MAP)}{const g=new Ii(this.__gl),i=g.compileForTarget("GLProbe",C.shaderopts),e=_C(this.__gl,i.attrs,I.__quadattrbuffers,I.__quadIndexBuffer);g.bind(C,"GLProbe"),e.bind(C);const t=C.unifs;A.bindToUniform(C,t.envMap),this.specularCubetex=I.createTexture(),I.bindTexture(I.TEXTURE_CUBE_MAP,this.specularCubetex),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MIN_FILTER,I.LINEAR_MIPMAP_LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_R,I.CLAMP_TO_EDGE);const B=256;for(let A=0;A<6;A++)I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,I.RGBA32F,B,B,0,I.RGBA,I.FLOAT,null);I.generateMipmap(I.TEXTURE_CUBE_MAP);const o=5;for(let A=0;A<o;++A){const g=B*Math.pow(.5,A),C=B*Math.pow(.5,A),i=I.createFramebuffer();I.bindFramebuffer(I.DRAW_FRAMEBUFFER,i),I.viewport(0,0,g,C);const e=A/(o-1);I.uniform1f(t.roughness.location,e);for(let g=0;g<6;++g)I.uniform1i(t.faceId.location,g),I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+g,this.specularCubetex,A),I.drawQuad();I.bindFramebuffer(I.DRAW_FRAMEBUFFER,null),I.deleteFramebuffer(i)}g.destroy()}this.__convolved=!0}bind(A){const g=this.__gl,{irradianceMap:I,prefilterMap:C,brdfLUT:i,envMapFlags:e}=A.unifs;if(!this.__convolved)return I&&g.uniform1i(I.location,this.maxFragmentShaderTextureUnits-1),C&&g.uniform1i(C.location,this.maxFragmentShaderTextureUnits-1),e&&g.uniform1i(e.location,-1),!1;if(i){const I=A.boundTextures++;g.activeTexture(this.__gl.TEXTURE0+I),g.bindTexture(g.TEXTURE_2D,this.brdfLUTTexture),g.uniform1i(i.location,I)}if(I){const C=A.boundTextures++,i=this.__gl.TEXTURE0+C;g.activeTexture(i),g.bindTexture(g.TEXTURE_CUBE_MAP,this.irradianceCubeTex),g.uniform1i(I.location,C)}if(C){const I=A.boundTextures++,i=this.__gl.TEXTURE0+I;g.activeTexture(i),g.bindTexture(g.TEXTURE_CUBE_MAP,this.specularCubetex),g.uniform1i(C.location,I)}return e&&g.uniform1i(e.location,0),!0}destroy(){}}class ii extends DC{constructor(A){super(A,"EnvMapShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\nimport 'inverse.glsl'\nimport 'transpose.glsl'\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID() * 2.0;\n  v_texCoord = position * 0.5 + 0.5;\n\n  mat4 inverseProjection = inverse(projectionMatrix);\n  mat3 inverseModelview = transpose(mat3(viewMatrix));\n\n  // transform from the normalized device coordinates back to the view space\n  vec3 unprojected = (inverseProjection * vec4(position, 0, 1)).xyz;\n\n  // transfrom from the view space back to the world space\n  // and use it as a sampling vector\n  v_worldDir = inverseModelview * unprojected;\n\n  gl_Position = vec4(position, 0, 1);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'gamma.glsl'\nimport 'constants.glsl'\n\nuniform float focus;\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#define ENABLE_INLINE_GAMMACORRECTION\n\n#define ENV_MAP_LATLONG 0\n#define ENV_MAP_OCT 1\n#define ENV_MAP_CUBE 2\n#define ENV_MAP_irradianceMap 8\n#define ENV_MAP_prefilterMap 3\n#define ENV_MAP_STEREO_LATLONG 4\n#define ENV_MAP_DUALFISHEYE 5\n#define ENV_MAP_SH 6\n#define ENV_MAP_BRDF_LUT 7\n\n#define ENV_MAPTYPE ENV_MAP_OCT\n\n#if (ENV_MAPTYPE == ENV_MAP_LATLONG)  \n\nimport 'envmap-equirect.glsl'\n\nuniform sampler2D backgroundImage;\n\nvec4 sampleEnvMap(vec3 dir) {\n  vec2 uv = latLongUVsFromDir(normalize(dir));\n  vec4 texel = texture2D(backgroundImage, uv) * exposure;\n  return vec4(texel.rgb/texel.a, 1.0);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_OCT)  \n\nimport 'envmap-octahedral.glsl'\n\nuniform sampler2D   envMap;\n\nvec4 sampleEnvMap(vec3 dir) {\n  vec2 uv = dirToSphOctUv(normalize(dir));\n  if (false) {\n    vec4 texel = texture2D(envMap, uv);\n    return vec4(texel.rgb/texel.a, 1.0);\n  }\n  else {\n    return texture2D(envMap, uv) * exposure;\n  }\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_CUBE)\n\nuniform samplerCube cubeMap;\n\nvec4 sampleEnvMap(vec3 dir) {\n  return texture(cubeMap, dir, 0.0);// * exposure;\n  // return textureLod(cubeMap, dir, exposure);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_irradianceMap)\n\nuniform samplerCube irradianceMap;\n\nvec4 sampleEnvMap(vec3 dir) {\n  return textureLod(irradianceMap, dir, exposure);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_prefilterMap)\n\nuniform samplerCube prefilterMap;\n\nvec4 sampleEnvMap(vec3 dir) {\n  return textureLod(prefilterMap, dir, exposure);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_STEREO_LATLONG)  \n\nimport 'envmap-equirect.glsl'\nuniform int eye;// L = 0, R = 1;\nuniform sampler2D backgroundImage;\n\nvec4 sampleEnvMap(vec3 dir) {\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n  uv.y *= 0.5;\n  if (eye == 1) {\n    uv.y += 0.5;\n  }\n  vec4 texel = texture2D(backgroundImage, uv) * exposure;\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_DUALFISHEYE)\n\nimport 'envmap-dualfisheye.glsl'\n\nvec4 sampleEnvMap(vec3 dir) {\n  vec2 uv = dualfisheyeUVsFromDir(dir);\n  return texture2D(backgroundImage, uv) * exposure;\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_SH)\n\nimport 'SHCoeffs.glsl'\n\nvec4 sampleEnvMap(vec3 dir) {\n\treturn vec4(sampleSHCoeffs(dir) * exposure, 1.0);\n}\n\n#elif (ENV_MAPTYPE == ENV_MAP_BRDF_LUT)\n\nuniform sampler2D brdfLUT;\n\nvec4 sampleEnvMap(vec3 dir) {\n  return texture2D(brdfLUT, v_texCoord);\n}\n#endif\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = sampleEnvMap(normalize(v_worldDir));\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}class ei extends Ci{constructor(A,g){super(A.gl,"EnvMap"),this.__srcGLTex=null,this.__envMapShader=null,this.__envMapShaderBinding=null,this.__renderer=A,this.__envMap=g,this.__backgroundFocus=0,this.__envMap.isLoaded()?this.init():this.__envMap.once("loaded",(A=>{this.init()}))}init(){const A=this.__renderer.gl;A.__quadVertexIdsBuffer||A.setupInstancedQuad(),this.__srcGLTex=new $C(A,this.__envMap),this.__envMapShader=new ii(A);const g=this.__envMapShader.compileForTarget("GLEnvMap",{directives:["#define ENABLE_ES3"]});this.__envMapShaderBinding=_C(A,g.attrs,A.__quadattrbuffers,A.__quadIndexBuffer);const I=this.__envMap.headlightModeParam,C=()=>{I.value?this.textureDesc[3]|=1:this.textureDesc[3]&=-2};C(),I.on("valueChanged",(()=>{C(),this.emit("updated")})),this.convolveProbe(this.__srcGLTex),this.emit("updated")}getEnvMap(){return this.__envMap}getBackgroundFocus(){return this.__backgroundFocus}setBackgroundFocus(A){this.__backgroundFocus=A,this.__renderer.requestRedraw()}draw(A){if(this.__envMap.isLoaded()){const g=this.__gl;{this.__envMapShader.bind(A,"GLEnvMap");const I=A.unifs,{envMap:C,focus:i,exposure:e}=A.unifs;C&&this.__srcGLTex.bindToUniform(A,C),i&&g.uniform1f(i.location,this.__backgroundFocus),e&&g.uniform1f(e.location,A.exposure),this.__envMapShaderBinding.bind(A),g.depthMask(!1),A.bindViewports(I,(()=>{g.drawQuad()})),g.depthMask(!0)}}}destroy(){super.destroy(),this.__srcGLTex&&this.__srcGLTex.destroy()}}function ti(A){var g=typeof A;return null!=A&&("object"==g||"function"==g)}var Bi="object"==typeof global&&global&&global.Object===Object&&global,oi="object"==typeof self&&self&&self.Object===Object&&self,si=Bi||oi||Function("return this")(),ai=function(){return si.Date.now()},li=/\s/;var ni=/^\s+/;function di(A){return A?A.slice(0,function(A){for(var g=A.length;g--&&li.test(A.charAt(g)););return g}(A)+1).replace(ni,""):A}var hi=si.Symbol,ci=Object.prototype,ri=ci.hasOwnProperty,Gi=ci.toString,mi=hi?hi.toStringTag:void 0;var Qi=Object.prototype.toString;var Ei=hi?hi.toStringTag:void 0;function bi(A){return null==A?void 0===A?"[object Undefined]":"[object Null]":Ei&&Ei in Object(A)?function(A){var g=ri.call(A,mi),I=A[mi];try{A[mi]=void 0;var C=!0}catch(A){}var i=Gi.call(A);return C&&(g?A[mi]=I:delete A[mi]),i}(A):function(A){return Qi.call(A)}(A)}var Zi=/^[-+]0x[0-9a-f]+$/i,yi=/^0b[01]+$/i,ui=/^0o[0-7]+$/i,Ri=parseInt;function Vi(A){if("number"==typeof A)return A;if(function(A){return"symbol"==typeof A||function(A){return null!=A&&"object"==typeof A}(A)&&"[object Symbol]"==bi(A)}(A))return NaN;if(ti(A)){var g="function"==typeof A.valueOf?A.valueOf():A;A=ti(g)?g+"":g}if("string"!=typeof A)return 0===A?A:+A;A=di(A);var I=yi.test(A);return I||ui.test(A)?Ri(A.slice(2),I?2:8):Zi.test(A)?NaN:+A}var Fi=Math.max,Si=Math.min;function wi(A,g,I){var C,i,e,t,B,o,s=0,a=!1,l=!1,n=!0;if("function"!=typeof A)throw new TypeError("Expected a function");function d(g){var I=C,e=i;return C=i=void 0,s=g,t=A.apply(e,I)}function h(A){return s=A,B=setTimeout(r,g),a?d(A):t}function c(A){var I=A-o;return void 0===o||I>=g||I<0||l&&A-s>=e}function r(){var A=ai();if(c(A))return G(A);B=setTimeout(r,function(A){var I=g-(A-o);return l?Si(I,e-(A-s)):I}(A))}function G(A){return B=void 0,n&&C?d(A):(C=i=void 0,t)}function m(){var A=ai(),I=c(A);if(C=arguments,i=this,o=A,I){if(void 0===B)return h(o);if(l)return clearTimeout(B),B=setTimeout(r,g),d(o)}return void 0===B&&(B=setTimeout(r,g)),t}return g=Vi(g)||0,ti(I)&&(a=!!I.leading,e=(l="maxWait"in I)?Fi(Vi(I.maxWait)||0,g):e,n="trailing"in I?!!I.trailing:n),m.cancel=function(){void 0!==B&&clearTimeout(B),s=0,C=o=i=B=void 0},m.flush=function(){return void 0===B?t:G(ai())},m}class Xi extends DC{constructor(A){super(A,"ScreenQuadShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\nuniform vec2 pos;\nuniform vec2 size;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * abs(size) * 2.0), 0.0, 1.0);\n  if (size.x < 0.0)\n    v_texCoord.x = 1.0 - v_texCoord.x;\n  if (size.y < 0.0)\n    v_texCoord.y = 1.0 - v_texCoord.y;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D image;\nuniform vec4 color;\nuniform int isTextured;\n\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  if (isTextured != 0)\n    fragColor = texture2D(image, v_texCoord);\n  else \n    fragColor = color;\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}class Hi{constructor(A,g){this.__gl=A,this.__pos=[0,0],this.__size=[1,1],this.flipY=!0,this.__glshader=new Xi(A),A.__quadVertexIdsBuffer||A.setupInstancedQuad();const I=this.__glshader.compileForTarget("GLScreenQuad",g);this.__quadBinding=_C(this.__gl,I.attrs,A.__quadattrbuffers,A.__quadIndexBuffer),this.ready=!0}bind(A,g,I,C){const i=A.unifs,e=this.__gl;g&&g instanceof HC?(e.uniform1i(i.isTextured.location,1),g.bindToUniform(A,A.unifs.image)):g&&g instanceof l&&(e.uniform1i(i.isTextured.location,0),e.uniform4fv(i.color.location,g.asArray()));{const A=i.pos;if(A){let g=I?I instanceof B?I.asArray():I:this.__pos;e.uniform2fv(A.location,g)}}{const A=i.size;if(A){let g=C?C instanceof B?C.asArray():C:this.__size;e.uniform2fv(A.location,g)}}this.__quadBinding.bind(A)}bindShader(A){return this.__glshader.bind(A,"GLScreenQuad")}draw(A,g,I,C){this.bind(A,g,I,C);const i=this.__gl;i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}}class Wi extends lA{constructor(A,g){super(),this.genBufferOpts={},this.__indexBuffer=null,this.__gl=A,this.__geom=g,this.__glattrbuffers={},this.__shaderBindings={},this.buffersDirty=!0;this.__geom.on("geomDataChanged",(A=>{this.dirtyBuffers(A)}));this.__geom.on("geomDataTopologyChanged",(A=>{this.clearBuffers(),this.dirtyBuffers(A)}))}getGeom(){return this.__geom}dirtyBuffers(A){this.genBufferOpts=A,this.buffersDirty=!0,this.emit("updated")}genBuffers(A){}updateBuffers(A){this.genBuffers(A),this.buffersDirty=!1}bind(A){if(this.__destroyed)throw new Error("Error binding a destroyed geom");this.buffersDirty&&this.updateBuffers();let g=this.__shaderBindings[A.shaderkey];if(!g){g=_C(this.__gl,A.attrs,this.__glattrbuffers,this.__indexBuffer),this.__shaderBindings[A.shaderkey]=g}g.bind(A)}unbind(A){const g=this.__shaderBindings[A.shaderkey];g&&g.unbind(A)}draw(A){throw new Error("Not implemented. Implement this method in a derived class.")}drawInstanced(A,g){throw new Error("Not implemented. Implement this method in a derived class.")}bindAndDraw(A){this.bind(A),this.draw(A)}clearBuffers(){const A=this.__gl;for(const g in this.__glattrbuffers){const I=this.__glattrbuffers[g];I.shared||A.deleteBuffer(I.buffer)}this.__glattrbuffers={};for(const A in this.__shaderBindings){this.__shaderBindings[A].destroy()}this.__shaderBindings={}}destroy(){this.__geom.deleteMetadata("glgeom"),this.clearBuffers(),this.__destroyed=!0,this.emit("destructing")}}class Yi extends Wi{constructor(A,g){super(A,g),this.__numTriIndices=0,this.__indexDataType=0,this.__numVertices=0,this.__numTriangles=0,this.__numRenderVerts=0}genBuffers(){super.genBuffers();const A=this.__gl,g=this.__geom.genBuffers(),I=g.indices;this.__numTriIndices=g.indices.length,I instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),I instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),I instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT),this.__numVertices=this.__geom.getNumVertices(),this.__numTriangles=I.length/3,this.__numRenderVerts=g.numRenderVerts,this.__indexBuffer&&A.deleteBuffer(this.__indexBuffer),this.__indexBuffer=A.createBuffer(),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,g.indices,A.STATIC_DRAW);for(const I in g.attrBuffers){const C=g.attrBuffers[I];this.__glattrbuffers[I]&&this.__glattrbuffers[I].buffer&&A.deleteBuffer(this.__glattrbuffers[I].buffer);const i=A.createBuffer();A.bindBuffer(A.ARRAY_BUFFER,i),A.bufferData(A.ARRAY_BUFFER,C.values,A.STATIC_DRAW),this.__glattrbuffers[I]={buffer:i,dataType:C.dataType,normalized:C.normalized},"textureCoords"==I&&(this.__glattrbuffers.texCoords=this.__glattrbuffers.textureCoords)}}updateBuffers(A){const g=this.__gl;if(this.__numVertices!=this.__geom.getNumVertices())return void this.genBuffers();const I=this.__geom.genBuffers({includeIndices:!1});for(const A in I.attrBuffers){const C=I.attrBuffers[A],i=this.__glattrbuffers[A];g.bindBuffer(g.ARRAY_BUFFER,i.buffer),g.bufferData(g.ARRAY_BUFFER,C.values,g.STATIC_DRAW)}this.buffersDirty=!1}clearBuffers(){this.__gl.deleteBuffer(this.__indexBuffer),this.__indexBuffer=null,super.clearBuffers()}draw(A){this.__gl.drawElements(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0)}drawInstanced(A,g){this.__gl.drawElementsInstanced(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0,g)}destroy(){super.destroy();this.__gl.deleteBuffer(this.__indexBuffer),this.__indexBuffer=null}}const Ki={MSAA_RENDERBUFFER:0,COLORBUFFER:1,DEPTHBUFFER:2};class pi extends nA{constructor(A){super(),this.__fbo=null,this.offscreenBuffer=null,this.depthTexture=null,this.__backgroundTexture=null,this.__backgroundGLTexture=null,this.offscreenBufferFbo=null,this.__width=0,this.__height=0,this.__canvasWidth=0,this.__canvasHeight=0,this.fb=null,this.depthBuffer=null,this.EXT_frag_depth=null,this.depthRange=[0,0],this.backgroundColorParam=new xA("BackgroundColor",new l("#eeeeee")),this.doubleClickTimeParam=new JA("DoubleClickTimeMS",200),this.renderer=A,this.__renderer=A,this.addParameter(this.doubleClickTimeParam);const g=this.__renderer.gl;this.__gl=g,this.quad=new Yi(g,new AI(1,1)),"webgl2"==g.name&&(this.offscreenBuffer=new HC(g,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"LINEAR",width:4,height:4}),this.depthTexture=new HC(g,{type:g.UNSIGNED_INT_24_8,format:g.DEPTH_STENCIL,internalFormat:"webgl2"==g.name?g.DEPTH24_STENCIL8:g.DEPTH_COMPONENT,filter:g.NEAREST,wrap:g.CLAMP_TO_EDGE,width:4,height:4})),this.highlightedGeomsBuffer=new HC(g,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:4,height:4}),this.highlightedGeomsBufferFbo=new fC(g,this.highlightedGeomsBuffer,!0),this.highlightedGeomsBufferFbo.setClearColor(new l(0,0,0,0));const I=()=>{const A=this.backgroundColorParam.value;A instanceof Gg?A instanceof BI?(this.__backgroundTexture=A,this.__backgroundGLTexture=new $C(g,A)):(this.__backgroundTexture=A,this.__backgroundGLTexture=new HC(g,A)):A instanceof l?(this.__backgroundGLTexture&&(this.__backgroundGLTexture.destroy(),this.__backgroundGLTexture=null,this.__backgroundTexture=null),this.offscreenBufferFbo&&this.offscreenBufferFbo.setClearColor(new l(A.asArray()))):console.warn("Invalid background:"+A),this.emit("updated")};I(),this.backgroundColorParam.on("valueChanged",I)}getRenderer(){return this.renderer}getWidth(){return this.__width}getHeight(){return this.__height}resize(A,g){if(this.__canvasWidth==A&&this.__canvasHeight==g)return;this.__canvasWidth=A,this.__canvasHeight=g,this.__width=A,this.__height=g,this.resizeRenderTargets(A,g);const I=new F(this.__width,this.__height);this.emit("resized",I)}resizeRenderTargets(A,I){this.highlightedGeomsBuffer&&this.highlightedGeomsBufferFbo.resize(A,I);const C=this.__renderer.gl;if(this.renderer.outlineThickness>0&&"image"==this.renderer.outlineMethod){if("Safari"==g.browserName||"webgl"==C.name)return void console.warn("Disabling outlines on Safari due to a regression in WebKit",g);this.fb&&(C.deleteFramebuffer(this.fb[Ki.MSAA_RENDERBUFFER]),C.deleteFramebuffer(this.fb[Ki.COLORBUFFER]),C.deleteFramebuffer(this.fb[Ki.DEPTHBUFFER]),this.colorRenderbuffer&&C.deleteRenderbuffer(this.colorRenderbuffer),this.depthBuffer&&C.deleteRenderbuffer(this.depthBuffer)),this.offscreenBuffer.resize(A,I),this.depthTexture.resize(A,I),this.fb=[],this.fb[Ki.MSAA_RENDERBUFFER]=C.createFramebuffer(),C.bindFramebuffer(C.FRAMEBUFFER,this.fb[Ki.MSAA_RENDERBUFFER]),this.colorRenderbuffer=C.createRenderbuffer(),C.bindRenderbuffer(C.RENDERBUFFER,this.colorRenderbuffer),this.renderer.multiSampledScreenBuffer?C.renderbufferStorage(C.RENDERBUFFER,C.RGBA8,A,I):C.renderbufferStorageMultisample(C.RENDERBUFFER,4,C.RGBA8,A,I),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.RENDERBUFFER,this.colorRenderbuffer),this.depthBuffer=C.createRenderbuffer(),C.bindRenderbuffer(C.RENDERBUFFER,this.depthBuffer),this.renderer.multiSampledScreenBuffer?C.renderbufferStorage(C.RENDERBUFFER,C.DEPTH24_STENCIL8,A,I):C.renderbufferStorageMultisample(C.RENDERBUFFER,4,C.DEPTH24_STENCIL8,A,I),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.RENDERBUFFER,this.depthBuffer),this.fb[Ki.COLORBUFFER]=C.createFramebuffer(),C.bindFramebuffer(C.FRAMEBUFFER,this.fb[Ki.COLORBUFFER]),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,this.offscreenBuffer.glTex,0),C.bindFramebuffer(C.FRAMEBUFFER,null),this.fb[Ki.DEPTHBUFFER]=C.createFramebuffer(),C.bindFramebuffer(C.FRAMEBUFFER,this.fb[Ki.DEPTHBUFFER]),C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.TEXTURE_2D,this.depthTexture.glTex,0),C.bindFramebuffer(C.FRAMEBUFFER,null);const i=C.checkFramebufferStatus("webgl2"==C.name?C.DRAW_FRAMEBUFFER:C.FRAMEBUFFER);if(i!==C.FRAMEBUFFER_COMPLETE)switch(i){case C.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case C.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}}}draw(A){const I=this.__renderer.gl;A.pushGLStack();const C=A.boundRendertarget;if(this.renderer.outlineThickness>0&&"image"==this.renderer.outlineMethod){if("Safari"==g.browserName||"webgl"==I.name)console.warn("Disabling outlines on Safari due to a regression in WebKit",g);else{this.fb||this.resizeRenderTargets(this.__width,this.__height);const g=this.fb[Ki.MSAA_RENDERBUFFER];I.bindFramebuffer("webgl2"==I.name?I.DRAW_FRAMEBUFFER:I.FRAMEBUFFER,g),A.boundRendertarget=g}}else A.boundRendertarget||I.bindFramebuffer(I.FRAMEBUFFER,null);I.viewport(0,0,this.__width,this.__height);const i=this.backgroundColorParam.value.asArray();I.clearColor(i[0],i[1],i[2],i[3]),I.colorMask(!0,!0,!0,!1),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),A.glEnable(I.DEPTH_TEST),this.__renderer.drawScene(A);const e=A.toHighlightRenderState();if(this.drawHighlights(e),1!=e.stack.length&&console.warn(" corrupt highlightRenderState.stack.length:",e.stack.length),this.fb){const g=I;g.bindFramebuffer(g.READ_FRAMEBUFFER,this.fb[Ki.MSAA_RENDERBUFFER]),g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.fb[Ki.COLORBUFFER]),g.clearBufferfv(g.COLOR,0,[0,0,0,0]),g.blitFramebuffer(0,0,this.__width,this.__height,0,0,this.__width,this.__height,g.COLOR_BUFFER_BIT,g.LINEAR),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,C),A.boundRendertarget=C,I.viewport(0,0,this.__width,this.__height),I.disable(I.DEPTH_TEST);const i=this.__renderer.screenQuad;i.bindShader(A),i.draw(A,this.offscreenBuffer),I.enable(I.DEPTH_TEST)}A.popGLStack(),this.renderer.emit("redrawOccurred")}drawSilhouettes(A){A.pushGLStack();const g=this.__renderer.gl,I=g;I.bindFramebuffer(I.READ_FRAMEBUFFER,this.fb[Ki.MSAA_RENDERBUFFER]),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,this.fb[Ki.DEPTHBUFFER]),I.clearBufferfv(I.COLOR,0,[1,1,1,1]),I.blitFramebuffer(0,0,this.__width,this.__height,0,0,this.__width,this.__height,I.DEPTH_BUFFER_BIT,I.NEAREST),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,this.fb[Ki.MSAA_RENDERBUFFER]),A.boundRendertarget=this.fb[Ki.MSAA_RENDERBUFFER],I.viewport(0,0,this.__width,this.__height),A.glEnable(g.BLEND),A.glDisable(g.DEPTH_TEST),I.blendEquation(I.FUNC_ADD),I.blendFunc(I.SRC_ALPHA,I.ONE_MINUS_SRC_ALPHA),I.depthMask(!1),this.renderer.silhouetteShader.bind(A);const C=A.unifs;this.depthTexture.bindToUniform(A,C.depthTexture),I.uniform2f(C.screenSize.location,this.__width,this.__height),I.uniform1f(C.outlineThickness.location,this.renderer.outlineThickness*window.devicePixelRatio);const i=this.renderer.outlineColor.asArray();I.uniform4f(C.outlineColor.location,i[0],i[1],i[2],i[3]),I.uniform1f(C.outlineSensitivity.location,this.renderer.outlineSensitivity),I.uniform1f(C.outlineDepthBias.location,this.renderer.outlineDepthBias),I.uniform2f(C.depthRange.location,this.depthRange[0],this.depthRange[1]),this.quad.bindAndDraw(A),I.depthMask(!0),A.popGLStack()}drawHighlights(A){if(this.highlightedGeomsBufferFbo){const g=this.__renderer.gl;this.highlightedGeomsBufferFbo.bindForWriting(A),this.highlightedGeomsBufferFbo.clear(),A.pushGLStack(),A.glEnable(g.CULL_FACE),A.glEnable(g.DEPTH_TEST),A.glDisable(g.BLEND),g.depthFunc(g.LESS),g.depthMask(!0),A.glShader=null,this.__renderer.drawHighlightedGeoms(A),this.highlightedGeomsBufferFbo.unbindForWriting(A),g.viewport(0,0,this.__width,this.__height);{this.renderer.highlightsShader.bind(A),A.pushGLStack(),A.glEnable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA);const I=A.unifs;g.uniform1f(I.outlineThickness.location,this.renderer.highlightOutlineThickness),this.highlightedGeomsBuffer.bindToUniform(A,I.highlightDataTexture),g.uniform2f(I.highlightDataTextureSize.location,A.region[2],A.region[3]),this.quad.bindAndDraw(A),A.popGLStack()}A.popGLStack()}}getManipulator(){return this.manipulator}setManipulator(A){this.manipulator!=A&&(this.manipulator&&this.manipulator.deactivateTool&&this.manipulator.deactivateTool(),this.manipulator=A,this.manipulator.activateTool&&this.manipulator.activateTool())}onPointerDown(A){console.warn("@GLBaseViewport#onPointerDown - Implement me!")}onPointerUp(A){console.warn("@GLBaseViewport#onPointerUp - Implement me!")}onPointerMove(A){console.warn("@GLBaseViewport#onPointerMove - Implement me!")}onPointerEnter(A){console.warn("@GLBaseViewport#onPointerEnter - Implement me!")}onPointerLeave(A){console.warn("@GLBaseViewport#onPointerLeave - Implement me!")}onMouseLeave(A){}onKeyDown(A){}onKeyUp(A){}}class Ni extends pi{constructor(A,g,I,C){super(A),this.__geomDataBufferSizeFactor=1,this.debugGeomDataBuffer=!1,this.debugOcclusionBuffer=!1,this.debugReductionBuffer=!1,this.debugHighlightedGeomsBuffer=!1,this.__x=0,this.__y=0,this.region=[0,0,0,0],this.__cameraXfo=new m,this.__cameraMat=new h,this.__viewMat=new h,this.__geomDataBufferInvalid=!0,this.__screenPos=null,this.__name=g,this.__projectionMatrix=new h,this.__frustumDim=new B,this.__bl=new B(0,0),this.__tr=new B(1,1),this.__prevDownTime=0;const i=this.__renderer.gl;this.__geomDataBuffer=new HC(i,{type:A.floatGeomBuffer?"FLOAT":"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:I<=1?1:Math.floor(I/this.__geomDataBufferSizeFactor),height:C<=1?1:Math.floor(C/this.__geomDataBufferSizeFactor)}),this.__geomDataBufferFbo=new fC(i,this.__geomDataBuffer,!0),this.__geomDataBufferFbo.setClearColor(new l(0,0,0,0)),this.__camera=new IC("DefaultCamera"),this.setCamera(this.__camera),this.setManipulator(new SC({renderer:A})),this.resize(I,C)}getBl(){return this.__bl}setBl(A){this.__bl.x=A,this.__bl.y=A,this.resize(this.__canvasWidth,this.__canvasHeight)}getTr(){return this.__tr}setTr(A){this.__tr.x=A,this.__tr.y=A,this.resize(this.__canvasWidth,this.__canvasHeight)}getPosX(){return this.__x}getPosY(){return this.__y}resize(A,g){if(this.__canvasWidth==A&&this.__canvasHeight==g)return;this.__canvasWidth=A,this.__canvasHeight=g,this.__x=A*this.__bl.x,this.__y=A*this.__bl.y,this.__width=A*this.__tr.x-A*this.__bl.x,this.__height=g*this.__tr.y-g*this.__bl.y,this.region=[this.__x,this.__y,this.__width,this.__height],this.__camera&&this.__updateProjectionMatrix(),this.resizeRenderTargets(this.__width,this.__height);const I=new F(this.__width,this.__height);this.emit("resized",I)}resizeRenderTargets(A,g){super.resizeRenderTargets(A,g),this.__geomDataBufferFbo&&(this.__geomDataBufferFbo.resize(Math.floor(this.__width/this.__geomDataBufferSizeFactor),Math.floor(this.__height/this.__geomDataBufferSizeFactor)),this.renderGeomDataFbo())}getCamera(){return this.__camera}setCamera(A){this.__camera=A,this.depthRange=[this.__camera.getNear(),this.__camera.getFar()];const g=A.globalXfoParam,I=()=>{this.__cameraXfo=g.value,this.__cameraMat=this.__cameraXfo.toMat4(),this.__viewMat=this.__cameraMat.inverse()};I(),g.on("valueChanged",(()=>{I(),this.invalidateGeomDataBuffer(),this.emit("updated");const A=new P("CameraAndPointer",this.__cameraXfo);this.emit("viewChanged",A)})),this.__camera.on("projectionParamChanged",(()=>{this.__updateProjectionMatrix(),this.depthRange=[this.__camera.getNear(),this.__camera.getFar()],this.emit("updated")})),this.__updateProjectionMatrix()}__updateProjectionMatrix(){const A=this.__width/this.__height;this.__camera.updateProjectionMatrix(this.__projectionMatrix,A);const g=Math.tan(this.__camera.getFov()/2)*this.__camera.getNear()*2,I=g*A;this.__frustumDim.set(I,g)}getProjectionMatrix(){return this.__projectionMatrix}getViewMatrix(){return this.__viewMat}frameView(A){this.__width>0&&this.__height>0?this.__camera.frameView(this,A):this.once("resized",(()=>this.frameView()))}calcScreenPosFromWorldPos(A){const g=this.__projectionMatrix.multiply(this.__viewMat).transformVec4(new s(A.x,A.y,A.z,1));return g.x/=g.w,g.y/=g.w,new B((.5*g.x+.5)*this.__width,(-.5*g.y+.5)*this.__height)}calcRayFromScreenPos(A){const g=this.__canvasHeight*(1-this.__tr.y);let I=(A.x-this.__x)/this.__width,C=(A.y-g)/this.__height;I=2*I-1,C=2*C-1;const i=this.__cameraMat,e=this.__projectionMatrix.inverse();if(null==e)return console.warn(`Unable to generate Ray from screen pos:${A.toString()} in region ${this.region}`),new G;let t,B;if(this.__camera.isOrthographic()){const A=e.transformVec3(new o(I,-C,-1));A.z=0,t=i.transformVec3(A),B=new o(0,0,-1)}else t=i.translation,B=e.transformVec3(new o(I,-C,-1));return B=i.rotateVec3(B).normalize(),new G(t,B)}renderGeomDataFbo(){if(this.__geomDataBufferFbo){const A=new qC(this.renderer.__gl);this.initRenderState(A),A.geomDataFbo=this.__geomDataBufferFbo,this.__geomDataBufferFbo.bindAndClear(A),this.__renderer.drawSceneGeomData(A),this.__geomDataBufferInvalid=!1,this.__geomDataBufferFbo.unbind()}}invalidateGeomDataBuffer(){this.__geomDataBufferInvalid=!0}getGeomDataAtPos(A,g){if(this.__geomDataBufferFbo){if(this.__geomDataBufferInvalid&&(this.renderGeomDataFbo(),this.__screenPos=null),A===this.__screenPos)return this.__intersectionData;this.__screenPos=A,this.__intersectionData=null;const I=this.__renderer.gl;I.finish(),this.__geomDataBufferFbo.bindForReading();const C=this.__geomDataBufferFbo.width,i=this.__geomDataBufferFbo.height,e=Math.floor(A.x*(C/this.__width)),t=Math.floor(A.y*(i/this.__height));let B,o;if(this.__renderer.floatGeomBuffer){if(o=new Float32Array(4),I.readPixels(e,i-t-1,1,1,I.RGBA,I.FLOAT,o),0==o[3])return null;B=63&Math.round(o[0])}else{if(o=new Uint8Array(4),I.readPixels(e,i-t-1,1,1,I.RGBA,I.UNSIGNED_BYTE,o),I.bindFramebuffer(I.FRAMEBUFFER,null),0==o[0]&&0==o[1])return;B=Math.floor(o[1]/32)}this.__geomDataBufferFbo.unbind();const s=this.__renderer.getPass(B);if(!s)return console.warn("Geom data buffer returns invalid pass id:",B),null;const a=s.getGeomItemAndDist(o);if(a){if(!a.geomItem.isSelectable())return null;g||(g=this.calcRayFromScreenPos(A));const I=g.start.add(g.dir.scale(a.dist));this.__intersectionData=new H(A,g,I,o,a)}return this.__intersectionData}return null}getGeomItemsInRect(A,g){var I;if(this.__geomDataBufferFbo){const C=this.__renderer.gl;C.finish();const i=this.__geomDataBufferFbo.width,e=this.__geomDataBufferFbo.height,t=i/this.__width,B=e/this.__height,o=Math.round(A.x*t),s=Math.round(A.y*B),a=Math.round(g.x*t),l=Math.round(g.y*B),n=Math.round(e-l),d=Math.round(o),h=Math.round(a-o),c=Math.round(l-s),r=h*c;let G;this.__geomDataBufferFbo.bindForReading(),this.__renderer.floatGeomBuffer?(G=new Float32Array(4*r),C.readPixels(d,n,h,c,C.RGBA,C.FLOAT,G)):(G=new Uint8Array(4*r),C.readPixels(d,n,h,c,C.RGBA,C.UNSIGNED_BYTE,G)),C.bindFramebuffer(C.FRAMEBUFFER,null);const m=new Set;for(let A=0;A<r;A++){let g;const C=G.subarray(4*A,4*(A+1));if(this.__renderer.floatGeomBuffer){if(0==C[3])continue;g=Math.round(C[0])}else{if(0==C[0]&&0==C[1])continue;g=Math.floor(C[1]/64)}const i=null===(I=this.__renderer.getPass(g))||void 0===I?void 0:I.getGeomItemAndDist(C);if(i){if(!i.geomItem.isSelectable())continue;m.add(i.geomItem)}}return m}return new Set}__getPointerPos(A,g){return new B((A-this.getPosX())*window.devicePixelRatio,(g-this.getPosY())*window.devicePixelRatio)}prepareUIEvent(A){A.viewport=this}onPointerDown(A){if(this.prepareUIEvent(A),A.pointerType===q.mouse){const g=A;g.pointerPos=this.__getPointerPos(g.rendererX,g.rendererY),g.pointerRay=this.calcRayFromScreenPos(g.pointerPos),g.intersectionData=this.getGeomDataAtPos(g.pointerPos,g.pointerRay)}else if(A.pointerType===q.touch){const g=A;if(1==g.touches.length){const A=g.touches[0];g.pointerPos=this.__getPointerPos(A.rendererX,A.rendererY),g.pointerRay=this.calcRayFromScreenPos(g.pointerPos),g.intersectionData=this.getGeomDataAtPos(g.pointerPos,g.pointerRay)}}const g=Date.now();if(g-this.__prevDownTime<this.doubleClickTimeParam.value&&(A instanceof iA||A instanceof tA&&1==A.touches.length)){if(this.manipulator&&(this.manipulator.onPointerDoublePress(A),!A.propagating))return;if(this.emit("pointerDoublePressed",A),!A.propagating)return}else this.__prevDownTime=g;A.getCapture()&&(A.getCapture().onPointerDown(A),!A.propagating)||(null==A.intersectionData||(A.intersectionData.geomItem.onPointerDown(A),A.propagating))&&(this.emit("pointerDown",A),A.propagating&&(!this.manipulator||(this.manipulator.onPointerDown(A),A.propagating)))}onPointerUp(A){if(this.prepareUIEvent(A),A.pointerType===q.mouse){const g=A;g.pointerPos=this.__getPointerPos(g.rendererX,g.rendererY),g.pointerRay=this.calcRayFromScreenPos(g.pointerPos),g.intersectionData=this.getGeomDataAtPos(g.pointerPos,g.pointerRay)}else if(A.pointerType===q.touch){const g=A;if(0==g.touches.length&&1==g.changedTouches.length){const A=g.changedTouches[0];g.pointerPos=this.__getPointerPos(A.rendererX,A.rendererY),g.pointerRay=this.calcRayFromScreenPos(g.pointerPos),g.intersectionData=this.getGeomDataAtPos(g.pointerPos,g.pointerRay)}}A.getCapture()&&(A.getCapture().onPointerUp(A),!A.propagating)||(null==A.intersectionData||(A.intersectionData.geomItem.onPointerUp(A),A.propagating))&&(this.emit("pointerUp",A),A.propagating&&(!this.manipulator||(this.manipulator.onPointerUp(A),A.propagating)))}onPointerMove(A){if(this.prepareUIEvent(A),A.pointerType===q.mouse){const g=A,I=this.__getPointerPos(g.rendererX,g.rendererY);g.pointerPos=I,g.pointerRay=this.calcRayFromScreenPos(I)}else if(A.pointerType===q.touch){const g=A;for(let A=0;A<g.touches.length;A++){const I=g.touches[A];I.touchPos=this.__getPointerPos(I.rendererX,I.rendererY),I.touchRay=this.calcRayFromScreenPos(I.touchPos)}g.pointerPos=g.touches[0].touchPos,g.pointerRay=g.touches[0].touchRay}if(!A.getCapture()||(A.getCapture().onPointerMove(A),A.propagating)){if(A.intersectionData=this.getGeomDataAtPos(A.pointerPos,A.pointerRay),A.intersectionData){if(A.intersectionData.geomItem!=this.pointerOverItem){if(this.pointerOverItem&&(A.leftGeometry=this.pointerOverItem,this.pointerOverItem.onPointerLeave(A),A.propagating&&this.emit("pointerLeaveGeom",A)),A.propagating=!0,this.pointerOverItem=A.intersectionData.geomItem,this.pointerOverItem.onPointerEnter(A),!A.propagating)return;this.emit("pointerOverGeom",A)}if(A.propagating=!0,A.intersectionData.geomItem.onPointerMove(A),!A.propagating)return}else if(this.pointerOverItem){if(A.leftGeometry=this.pointerOverItem,this.pointerOverItem.onPointerLeave(A),this.pointerOverItem=null,!A.propagating)return;this.emit("pointerLeaveGeom",A)}this.emit("pointerMove",A),A.propagating&&(!this.manipulator||(this.manipulator.onPointerMove(A),A.propagating))}}onPointerEnter(A){this.prepareUIEvent(A),this.emit("pointerEnter",A),A.propagating&&(!this.manipulator||!this.manipulator.onPointerEnter||(this.manipulator.onPointerEnter(A),A.propagating))}onPointerLeave(A){this.prepareUIEvent(A),this.emit("pointerLeave",A),A.propagating&&(!this.manipulator||!this.manipulator.onPointerLeave||(this.manipulator.onPointerLeave(A),A.propagating))}onKeyDown(A){this.prepareUIEvent(A),this.manipulator&&(this.manipulator.onKeyDown(A),!A.propagating)||this.emit("keyDown",A)}onKeyUp(A){this.prepareUIEvent(A),this.manipulator&&(this.manipulator.onKeyUp(A),!A.propagating)||this.emit("keyUp",A)}onWheel(A){this.prepareUIEvent(A),A.pointerPos=this.__getPointerPos(A.rendererX,A.rendererY),A.pointerRay=this.calcRayFromScreenPos(A.pointerPos),A.intersectionData=this.getGeomDataAtPos(A.pointerPos,A.pointerRay),(null==A.intersectionData||(A.intersectionData.geomItem.onWheel(A),A.propagating))&&(this.manipulator?this.manipulator.onWheel(A):this.emit("mouseWheel",A))}onTouchCancel(A){this.prepareUIEvent(A),A.getCapture()&&(A.getCapture().onTouchCancel(A),!A.propagating)||this.manipulator&&(this.manipulator.onTouchCancel(A),!A.propagating)||this.emit("touchCancel",A)}initRenderState(A){A.viewXfo=this.__cameraXfo,A.viewScale=1,A.region=this.region,A.cameraMatrix=this.__cameraMat,A.viewport=this,A.viewports=[{region:this.region,viewMatrix:this.__viewMat,projectionMatrix:this.__projectionMatrix,viewportFrustumSize:this.__frustumDim,isOrthographic:this.__camera.isOrthographic()?1:0,fovY:this.__camera.getFov()}]}draw(A){const g=this.__renderer.gl;if(this.initRenderState(A),A.pushGLStack(),A.glDisable(g.BLEND),A.glEnable(g.DEPTH_TEST),A.glEnable(g.CULL_FACE),super.draw(A),A.popGLStack(),this.debugGeomDataBuffer){this.renderGeomDataFbo();const A=new jC(this.__renderer.gl),g=this.__renderer.screenQuad;g.bindShader(A),g.draw(A,this.__geomDataBuffer,new B(0,0),new B(1,1))}if(this.debugHighlightedGeomsBuffer){const A=new jC(this.__renderer.gl),g=this.__renderer.screenQuad;g.bindShader(A),g.draw(A,this.highlightedGeomsBuffer,new B(0,0),new B(1,1))}if(this.debugOcclusionBuffer){const g=this.__renderer.glGeomItemLibrary.occlusionDataBuffer,I=this.__renderer.screenQuad;I.bindShader(A);const C=A.unifs.image;g.bindColorTexture(A,C);const i=this.__renderer.gl;i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),I.draw(A,null,new B(0,0),new B(1,1)),i.disable(i.BLEND)}if(this.debugReductionBuffer){const g=this.__renderer.glGeomItemLibrary.reductionDataBuffer,I=this.__renderer.screenQuad;I.bindShader(A);const C=A.unifs.image;g.bindColorTexture(A,C);const i=this.__renderer.gl;i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),I.draw(A,null,new B(0,0),new B(1,1)),i.disable(i.BLEND)}}}class Ji{constructor(A,g){this.__xrvp=A,this.__treeItem=new ag("XRHead"),g.addChild(this.__treeItem),this.__mat4=new h,this.__localXfo=new m}setVisible(A){if(A&&!this.hmdGeomItem){const A=this.__xrvp.getAsset();if(!A)return;const g=A.getChildByName("HMD");if(!g)return;this.hmdGeomItem=g.clone({assetItem:A}),this.hmdGeomItem&&(this.hmdGeomItem.localXfoParam.value=new m(new o(0,-.035,-.03),new c(0,1,0,Math.PI),new o(.001,.001,.001)),this.__treeItem.addChild(this.hmdGeomItem,!1))}this.hmdGeomItem&&(this.hmdGeomItem.visibleParam.value=A)}update(A){this.__mat4.setDataArray(A.transform.matrix),this.__localXfo.setFromMat4(this.__mat4),this.__treeItem.localXfoParam.value=this.__localXfo}getTreeItem(){return this.__treeItem}getXfo(){return this.__localXfo}}class Di extends V{constructor(A,I,C){if(super(),this.pressedButtons=[],this.raycastTick=5,this.raycastArea=.005,this.raycastDist=.04,this.pointerRay=new G,this.raycastAreaCache=0,this.raycastDistCache=0,this.rayCastRenderTargetProjMatrix=new h,this.capturedItem=null,this.xrvp=A,this.inputSource=I,this.id=C,this.buttonPressed=!1,this.inputSource.gamepad.buttons.forEach(((A,g)=>{0!=g&&(this.pressedButtons[g]=A.pressed)})),this.mat4=new h,this.xfo=new m,this.treeItem=new ag("XRController:"+I.handedness+C),!g.isMobileDevice){this.tipItem=new ag("Tip");const g=new m;if(g.tr.set(0,-.05,-.13),this.tipItem.localXfoParam.value=g,this.treeItem.addChild(this.tipItem,!1),A.getTreeItem().addChild(this.treeItem),"tracked-pointer"==I.targetRayMode){switch(I.profiles[0]){case"htc-vive":localStorage.setItem("ZeaEngine_XRDevice","Vive");break;case"oculus-touch":case"oculus-touch-v2":case"oculus-touch-v3":localStorage.setItem("ZeaEngine_XRDevice","Oculus")}A.loadHMDResources().then((A=>{if(!A)return;const g=new m;let C;if(g.ori.setFromAxisAndAngle(new o(0,1,0),Math.PI),g.sc.set(.001,.001,.001),"htc-vive"==I.profiles[0])C=A.getChildByName("Controller"),g.tr.set(0,-.035,-.085);else switch(I.handedness){case"left":C=A.getChildByName("LeftController"),g.tr.set(0,-.035,-.085),g.sc.scaleInPlace(.85);break;case"right":C=A.getChildByName("RightController"),g.tr.set(0,-.035,-.085),g.sc.scaleInPlace(.85);break;case"none":case"left-right":case"left-right-none":C=A.getChildByName("Controller")}if(C){const I=C.clone({assetItem:A});I.localXfoParam.value=g,this.treeItem.addChild(I,!1)}}))}}this.tick=0}getHandedness(){return this.inputSource.handedness}getId(){return this.id}getTreeItem(){return this.treeItem}getTipItem(){return this.tipItem}getTipXfo(){return this.tipItem.globalXfoParam.value}getTouchPadValue(){return this.touchpadValue}isButtonPressed(){return this.buttonPressed}getControllerStageLocalXfo(){return this.xfo}getControllerTipStageLocalXfo(){return this.xfo.multiply(this.tipItem.localXfoParam.value)}updatePose(A,g,I){const C=g.getPose(I.gripSpace,A);if(C&&C.transform){if(this.mat4.setDataArray(C.transform.matrix),this.xfo.setFromMat4(this.mat4),this.treeItem.localXfoParam.value=this.xfo,this.hitTested=!1,this.raycastDist>0&&this.raycastTick>0&&this.tick%this.raycastTick==0){const A=this.getGeomItemAtTip();if(null!=A){const g=new gA(this.xrvp,this,0,this.buttonPressed?1:0);g.intersectionData=A,g.pointerRay=this.pointerRay,A.geomItem!=this.pointerOverItem&&(this.pointerOverItem&&(g.leftGeometry=this.pointerOverItem,this.pointerOverItem.onPointerLeave(g),g.propagating&&this.xrvp.emit("pointerLeaveGeom",g)),g.propagating=!0,this.pointerOverItem=A.geomItem,this.pointerOverItem.onPointerEnter(g),g.propagating&&this.xrvp.emit("pointerOverGeom",g)),A.geomItem.onPointerMove(g)}else if(this.pointerOverItem){const A=new gA(this.xrvp,this,0,this.buttonPressed?1:0);A.pointerRay=this.pointerRay,A.leftGeometry=this.pointerOverItem,this.pointerOverItem.onPointerLeave(A),this.pointerOverItem=null}}this.inputSource.gamepad.buttons.forEach(((A,g)=>{if(0!=g)if(A.pressed&&!this.pressedButtons[g]){this.pressedButtons[g]=!0;const A=new gA(this.xrvp,this,g,1);A.intersectionData=this.getGeomItemAtTip(),A.pointerRay=this.pointerRay,this.emit("buttonPressed",A)}else if(!A.pressed&&this.pressedButtons[g]){this.pressedButtons[g]=!1;const A=new gA(this.xrvp,this,g,0);this.emit("buttonReleased",A)}})),this.tick++}}getGeomItemAtTip(){if(this.hitTested)return this.intersectionData;if(this.hitTested=!0,0==this.raycastDist)return null;const A=this.xrvp.getRenderer(),g=this.tipItem.globalXfoParam.value.clone();g.sc.set(1,1,1),this.pointerRay.start=g.tr,this.pointerRay.dir=g.ori.getZaxis().negate();const I=this.raycastDist*this.xrvp.stageScale,C=this.raycastArea*this.xrvp.stageScale;return I==this.raycastDistCache&&C==this.raycastAreaCache||(this.rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5*C,.5*C,-.5*C,.5*C,0,I),this.raycastDistCache=I,this.raycastAreaCache=C),this.intersectionData=A.raycastWithProjection(g,this.rayCastRenderTargetProjMatrix,this.pointerRay),this.intersectionData}}class fi extends VC{constructor(A){super(),this.listenerIDs={},this.__controllerTriggersHeld=[],this.xrvp=A,this.vrControllerToolTip=new gI(.015),this.vrControllerToolTipMat=new XI("Cross","FlatSurfaceShader"),this.vrControllerToolTipMat.getParameter("BaseColor").value=new l("#03E3AC"),this.listenerIDs={}}addIconToController(A){const g=new kI("HandleToolTip",this.vrControllerToolTip,this.vrControllerToolTipMat);g.setSelectable(!1),A.getTipItem().removeAllChildren(),A.getTipItem().addChild(g,!1)}activateTool(){super.activateTool();for(const A of this.xrvp.getControllers())this.addIconToController(A);this.listenerIDs.controllerAdded=this.xrvp.on("controllerAdded",(A=>{this.addIconToController(A.controller)}))}deactivateTool(){super.deactivateTool();for(const A of this.xrvp.getControllers())A.getTipItem().removeAllChildren();this.xrvp.removeListenerById("controllerAdded",this.listenerIDs.controllerAdded)}__initMoveStage(){if(1==this.__controllerTriggersHeld.length)this.__grabPos=this.__controllerTriggersHeld[0].getControllerTipStageLocalXfo().tr.clone(),this.stageXfo__GrabStart=this.xrvp.getXfo().clone(),this.__invOri=this.stageXfo__GrabStart.ori.inverse();else if(2==this.__controllerTriggersHeld.length){const A=this.__controllerTriggersHeld[0].getControllerTipStageLocalXfo().tr,g=this.__controllerTriggersHeld[1].getControllerTipStageLocalXfo().tr;this.__grabDir=g.subtract(A),this.__grabPos=A.lerp(g,.5),this.__grabDir.y=0,this.__grabDist=this.__grabDir.length(),this.__grabDir.scaleInPlace(1/this.__grabDist),this.stageXfo__GrabStart=this.xrvp.getXfo().clone(),this.__grab_to_stage=this.__grabPos.subtract(this.stageXfo__GrabStart.tr)}}onVRControllerButtonDown(A){if(0!=A.button)return;-1==this.__controllerTriggersHeld.indexOf(A.controller)&&(this.__controllerTriggersHeld.push(A.controller),this.__initMoveStage(),A.stopPropagation())}onVRControllerButtonUp(A){if(0!=A.button)return;const g=this.__controllerTriggersHeld.indexOf(A.controller);-1!=g&&(this.__controllerTriggersHeld.splice(g,1),this.__initMoveStage(),A.stopPropagation())}onVRControllerDoubleClicked(A){console.log("onVRControllerDoubleClicked:",this.__controllerTriggersHeld.length);const g=this.xrvp.getXfo().clone();g.sc.set(1,1,1),this.xrvp.setXfo(g)}onVRPoseChanged(A){if(1==this.__controllerTriggersHeld.length){const A=this.__controllerTriggersHeld[0].getControllerTipStageLocalXfo().tr,g=new m;g.tr=this.__grabPos.subtract(A);const I=this.stageXfo__GrabStart.multiply(g);this.xrvp.setXfo(I)}else if(2==this.__controllerTriggersHeld.length){const A=this.__controllerTriggersHeld[0].getControllerTipStageLocalXfo().tr,g=this.__controllerTriggersHeld[1].getControllerTipStageLocalXfo().tr,I=A.lerp(g,.5),C=g.subtract(A);C.y=0;const i=C.length();if(i<1e-4)return;C.scaleInPlace(1/i);const e=new m,t=Math.max(Math.min(this.__grabDist/i,10),.1);e.sc.set(t,t,t);let B=this.__grabDir.angleTo(C);this.__grabDir.cross(C).y>0&&(B=-B),e.ori.rotateY(B);const o=e.ori.rotateVec3(this.__grabPos);e.tr.addInPlace(this.__grabPos.subtract(o));const s=this.__grabPos.scale(1-t);e.tr.addInPlace(e.ori.rotateVec3(s));const a=this.__grabPos.subtract(I).scale(t);e.tr.addInPlace(e.ori.rotateVec3(a));const l=this.stageXfo__GrabStart.multiply(e);this.xrvp.setXfo(l)}}onPointerDown(A){A.pointerType===q.xr&&this.onVRControllerButtonDown(A)}onPointerMove(A){A.pointerType===q.xr&&this.onVRPoseChanged(A)}onPointerUp(A){A.pointerType===q.xr&&this.onVRControllerButtonUp(A)}onPointerDoublePress(A){A.pointerType===q.xr&&this.onVRControllerDoubleClicked(A)}}class Mi extends pi{constructor(A){super(A),this.viewXfo=new m,this.stageXfo=new m,this.invStageMatrix=new h,this.session=null,this.hmd="",this.region=[],this.projectionMatrices=[],this.viewMatrices=[],this.cameraMatrices=[],this.doubleClickTimeParam.value=300,this.__projectionMatricesUpdated=!1,this.__stageTreeItem=new ag("VRStage"),this.__stageTreeItem.setVisible(!1),this.__renderer.addTreeItem(this.__stageTreeItem),this.__xrhead=new Ji(this,this.__stageTreeItem),this.controllersMap={},this.controllers=[],this.controllerPointerDownTime=[],this.spectatorMode=!1,this.tick=0;const g=new m;g.ori.setFromAxisAndAngle(new o(1,0,0),.5*Math.PI),this.setXfo(g),this.setManipulator(new fi(this))}getRenderer(){return this.renderer}getAsset(){return this.__vrAsset}getTreeItem(){return this.__stageTreeItem}getVRHead(){return this.__xrhead}getXfo(){return this.stageXfo}setXfo(A){this.stageXfo=A,this.__stageTreeItem.globalXfoParam.value=A,this.invStageMatrix=A.inverse().toMat4(),this.stageScale=A.sc.x}getControllers(){return this.controllers}getHMDName(){return this.hmd}isPresenting(){return null!=this.session}setSpectatorMode(A){if(!A){const A=this.__renderer.gl;A.bindFramebuffer(A.FRAMEBUFFER,null),A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);let g=this.backgroundColorParam.value.asArray();A.clearColor(g[0],g[1],g[2],g[3]),A.colorMask(!0,!0,!0,!0),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT)}this.spectatorMode=A}__startSession(){const A=(g,I)=>{this.session&&(this.session.requestAnimationFrame(A),this.drawXRFrame(I))};this.session.requestAnimationFrame(A)}loadHMDResources(){if(g.isMobileDevice)return Promise.resolve(null);let A=localStorage.getItem("ZeaEngine_XRDevice");if(A||(A="Oculus",localStorage.setItem("ZeaEngine_XRDevice",A)),this.hmd!=A)this.hmdAssetPromise=void 0;else if(this.hmdAssetPromise)return this.hmdAssetPromise;return this.hmd=A,this.hmdAssetPromise=new Promise(((g,I)=>{{let I;switch(A){case"Vive":default:I="ZeaEngine/Vive.vla";break;case"Oculus":I="ZeaEngine/Oculus.vla"}if(!FA.commonResources[I]){const A=new RC(I);A.load(FA.systemUrls[I]),FA.commonResources[I]=A}this.__vrAsset=FA.getCommonResource(I);const C=()=>{const A=this.__vrAsset.getMaterialLibrary(),I=A.getMaterialNames();for(const g of I){const I=A.getMaterial(g,!1);I&&I.setShaderName("SimpleSurfaceShader")}this.__vrAsset.traverse((A=>{A.setSelectable(!1)})),g(this.__vrAsset)};this.__vrAsset.isLoaded()?C():this.__vrAsset.once("loaded",C)}})),this.hmdAssetPromise}startPresenting(){return new Promise(((A,I)=>{this.spectatorMode||this.setSpectatorMode(!1);(()=>{navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor"]}).then((C=>{const i=this.__renderer.getViewport();if(i){const A=i.getCamera().globalXfoParam.value,g=new m;g.tr=A.tr.clone(),g.tr.z-=1.3;const I=A.ori.getZaxis();I.z=0,I.normalizeInPlace(),g.ori.setFromDirectionAndUpvector(I,new o(0,0,1)),this.setXfo(g)}C.addEventListener("end",(A=>{this.__stageTreeItem.setVisible(!1),this.session=null,this.emit("presentingChanged",new x(!1))}));const e=A=>{console.log("creating controller:",A.handedness,A.profiles);const g=this.controllers.length,I=new Di(this,A,g);this.controllersMap[A.handedness]=I,this.controllers[g]=I;const C=new W(I);return this.emit("controllerAdded",C),I};C.addEventListener("selectstart",(A=>{const g=this.controllersMap[A.inputSource.handedness];g&&(g.buttonPressed=!0,this.onPointerDown(new gA(this,g,0,1)))})),C.addEventListener("selectend",(A=>{const g=this.controllersMap[A.inputSource.handedness];g&&(g.buttonPressed=!1,this.onPointerUp(new gA(this,g,0,0)))})),C.addEventListener("inputsourceschange",(A=>{for(const g of A.added)0!=g.profiles.length&&e(g)})),this.session=C;const t=new XRWebGLLayer(C,this.__gl);C.updateRenderState({baseLayer:t}),this.__width=t.framebufferWidth,this.__height=t.framebufferHeight,this.region=[0,0,this.__width,this.__height],this.depthRange=[C.renderState.depthNear,C.renderState.depthFar],this.resizeRenderTargets(this.__width,this.__height);const B=g=>{this.__refSpace=g,this.__stageTreeItem.setVisible(!0),this.emit("presentingChanged",new x(!0)),this.loadHMDResources().then((()=>{this.__startSession(),A()}))};C.requestReferenceSpace(g.isMobileDevice?"local":"bounded-floor").catch((A=>{console.log("Falling back to local-floor reference space"),C.requestReferenceSpace("local-floor").then(B)})).then((A=>{B(A)})).catch((A=>{console.warn(A.message),I(new Error("Unable to start XR Session:"+A.message))}))})).catch((A=>{console.warn(A.message)}))})()}))}stopPresenting(){this.session&&this.session.end()}togglePresenting(){this.session?this.stopPresenting():this.startPresenting()}updateControllers(A){const g=this.session.inputSources;for(let I=0;I<g.length;I++){const C=g[I];if(0==C.profiles.length)return;this.controllers[I]?this.controllers[I].updatePose(this.__refSpace,A,C):console.warn("Missing controller")}}initCullingRenderState(A){A.viewXfo=this.viewXfo,A.viewScale=1,A.region=this.region,A.cameraMatrix=A.viewXfo.toMat4(),A.viewport=this,A.viewports=[{region:this.region,viewMatrix:A.cameraMatrix.inverse(),isOrthographic:0}]}drawXRFrame(A){const I=A.session,C=I.renderState.baseLayer,i=A.getViewerPose(this.__refSpace);if(!i)return;this.__xrhead.update(i);const e=this.__xrhead.getTreeItem().globalXfoParam.value;this.viewXfo=e;const t=i.views;if(!this.__projectionMatricesUpdated){this.projectionMatrices=[],this.viewMatrices=[],this.cameraMatrices=[];for(let A=0;A<t.length;A++){const g=t[A],I=new h;I.setDataArray(g.projectionMatrix),this.projectionMatrices[A]=I,this.viewMatrices[A]=new h,this.cameraMatrices[A]=new h}this.__projectionMatricesUpdated=!0}const B=this.__renderer.gl;B.bindFramebuffer(B.FRAMEBUFFER,C.framebuffer);let o=this.backgroundColorParam.value.asArray();B.clearColor(o[0],o[1],o[2],o[3]),B.colorMask(!0,!0,!0,!0),B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT),this.depthRange=[I.renderState.depthNear,I.renderState.depthFar];const s=new jC(this.__renderer.gl);s.boundRendertarget=C.framebuffer,s.region=this.region,s.viewport=this,s.vrviewport=this,s.viewports=[];for(let A=0;A<t.length;A++){const g=t[A];this.viewMatrices[A].setDataArray(g.transform.inverse.matrix),this.viewMatrices[A].multiplyInPlace(this.invStageMatrix);const I=C.getViewport(g);s.viewports.push({viewMatrix:this.viewMatrices[A],projectionMatrix:this.projectionMatrices[A],region:[I.x,I.y,I.width,I.height],isOrthographic:0})}s.viewXfo=e,s.viewScale=1/this.stageScale,s.cameraMatrix=s.viewXfo.toMat4(),s.region=this.region,s.vrPresenting=!0,this.draw(s);const a=new IA(this,e,this.controllers);this.updateControllers(A),a.getCapture()&&a.getCapture().onPointerMove(a),this.manipulator&&a.propagating&&this.manipulator.onPointerMove(a);const l=new j(s.viewXfo);if(l.hmd=this.hmd,l.controllers=this.controllers,l.viewport=this,l.vrviewport=this,this.emit("viewChanged",l),this.spectatorMode&&!g.isMobileDevice&&this.tick%5==0){const A=this.__renderer.getViewport();if(A){this.__xrhead.setVisible(!0);const g=new jC(this.renderer.__gl);A.draw(g),this.__xrhead.setVisible(!1)}}this.tick++}onPointerDown(A){A.intersectionData=A.controller.getGeomItemAtTip(),A.pointerRay=A.controller.pointerRay;const g=Date.now();if(g-this.controllerPointerDownTime[A.controller.id]<this.doubleClickTimeParam.value){if(this.emit("pointerDoublePressed",A),!A.propagating)return;if(this.manipulator&&(this.manipulator.onPointerDoublePress(A),!A.propagating))return}this.controllerPointerDownTime[A.controller.id]=g,A.getCapture()&&(A.getCapture().onPointerDown(A),!A.propagating)||(null==A.intersectionData||(A.intersectionData.geomItem.onPointerDown(A),A.propagating))&&(this.emit("pointerDown",A),A.propagating&&this.manipulator&&this.manipulator.onPointerDown(A))}onPointerUp(A){this.controllerPointerDownTime[A.controller.id]=0,A.pointerRay=A.controller.pointerRay,A.getCapture()&&(A.getCapture().onPointerUp(A),!A.propagating)||(A.intersectionData=A.controller.getGeomItemAtTip(),(null==A.intersectionData||(A.intersectionData.geomItem.onPointerUp(A),A.propagating))&&(this.emit("pointerUp",A),A.propagating&&(!this.manipulator||(this.manipulator.onPointerUp(A),A.propagating))))}}class Li extends u{constructor(A){super(),this.dirty=!1,this.unif=A}bind(A){}unbind(A){}destroy(){}}class Ui extends Li{constructor(A,g,I,C,i){super(C),this.gltexture=null,this.textureType=-1;const e=I.getName();switch(this.param=I,this.unif=C,this.textureUnif=i[e+"Tex"],this.textureTypeUnif=i[e+"TexType"],this.uniform1i=A.uniform1i.bind(A),this.unif.type){case"Boolean":case"SInt32":this.uniformXX=A.uniform1i.bind(A);break;case"UInt32":"webgl2"==A.name?this.uniformXX=A.uniform1ui.bind(A):this.uniformXX=A.uniform1i.bind(A);break;case"Float32":this.uniformXX=A.uniform1f.bind(A)}this.bind=this.bindValue;const t=I=>{let C=HC.getCachedGLTexture2D(I);C||(C="FLOAT"===I.type?new $C(A,I):new HC(A,I),HC.setCachedGLTexture2D(I,C)),this.texBinding=C.preBind(this.textureUnif,i),C.on("updated",(()=>{g.emit("updated")})),this.gltexture=C,this.gltexture.addRef(this),this.textureType=1,this.bind=this.bindTexture,g.emit("updated")};let B,o;if(this.update=()=>{try{B||("boolean"==typeof I.value?this.val=I.value?1:0:this.val=I.value)}catch(A){}g.emit("updated")},I instanceof mg){const A=A=>{A.isLoaded()?t(A):o=A.on("loaded",(()=>{t(B)})),B=A},C=()=>{HC.getCachedGLTexture2D(B).removeRef(this),this.texBinding=null,this.gltexture=null,this.textureType=-1,this.bind=this.bindValue,o&&B.removeListenerById("loaded",o),B=null,o=null,g.emit("updated")};I.getImage()&&A(I.getImage()),I.on("textureConnected",(()=>{A(I.getImage())})),I.on("textureDisconnected",(()=>{C()}))}this.dirty=!0,I.on("valueChanged",(()=>{this.dirty=!0,g.emit("updated")}))}bindValue(A){this.dirty&&(this.update(),this.dirty=!1),this.unif&&this.uniformXX(this.unif.location,this.val),this.textureTypeUnif&&this.uniform1i(this.textureTypeUnif.location,0)}bindTexture(A){this.dirty&&(this.update(),this.dirty=!1),this.gltexture.bindToUniform(A,this.textureUnif,this.texBinding)}}class vi extends Li{constructor(A,g,I,C){switch(super(C),this.param=I,this.unif.type){case"Vec2":this.uniformXX=A.uniform2fv.bind(A);break;case"Vec3":this.uniformXX=A.uniform3fv.bind(A);break;case"Vec4":this.uniformXX=A.uniform4fv.bind(A)}this.dirty=!0,I.on("valueChanged",(()=>{this.dirty=!0,g.emit("updated")}))}bind(A){this.dirty&&(this.values=this.param.value.asArray(),this.dirty=!1),this.uniformXX(this.unif.location,this.values)}unbind(){}destroy(){}}class ki extends Li{constructor(A,g,I,C){switch(super(C),this.values=new Float32Array(0),this.param=I,this.unif.type){case"Mat3":this.uniformMatrixXXX=A.uniformMatrix3fv.bind(A);break;case"Mat4":this.uniformMatrixXXX=A.uniformMatrix4fv.bind(A)}this.dirty=!0,I.on("valueChanged",(()=>{this.dirty=!0,g.emit("updated")}))}bind(A){this.dirty&&(this.values=this.param.value.asArray(),this.dirty=!1),this.uniformMatrixXXX(this.unif.location,!1,this.values)}unbind(){}destroy(){}}class xi extends Li{constructor(A,g,I,C,i){super(C);const e=I.getName();this.param=I,this.textureUnif=i[e+"Tex"],this.textureTypeUnif=i[e+"TexType"],this.values=Float32Array.from([0,0,0,0]),this.bind=this.bindValue;const t=I=>{B=I;let C=HC.getCachedGLTexture2D(I);C||(C="FLOAT"===I.type?new $C(A,I):new HC(A,I),HC.setCachedGLTexture2D(I,C)),this.texBinding=C.preBind(this.textureUnif,i),C.on("updated",(()=>{g.emit("updated")})),this.gltexture=C,this.gltexture.addRef(this),this.textureType=1,this.bind=this.bindTexture,g.emit("updated")};let B,o;const s=A=>{A.isLoaded()?t(A):o=A.once("loaded",(()=>{t(A)}))},a=()=>{this.gltexture.removeRef(this),this.gltexture=null,this.texBinding=null,this.textureType=null,o&&B.removeListenerById("loaded",o),this.bind=this.bindValue,B=null,o=null,g.emit("updated")};this.update=()=>{try{B||this.unif&&(I instanceof Qg&&I.colorSpace==pA.Gamma?this.values=I.value.toLinear().asArray():this.values=I.value.asArray())}catch(A){}g.emit("updated")},I instanceof Qg&&(I.getImage()&&s(I.getImage()),I.on("textureConnected",(()=>{s(I.getImage())})),I.on("textureDisconnected",(()=>{a()}))),this.dirty=!0,I.on("valueChanged",(()=>{this.dirty=!0})),this.uniform1i=A.uniform1i.bind(A),this.uniform4fv=A.uniform4fv.bind(A)}bindValue(A){this.unif&&(this.dirty&&(this.update(),this.dirty=!1),this.unif&&this.uniform4fv(this.unif.location,this.values),this.textureTypeUnif&&this.uniform1i(this.textureTypeUnif.location,0))}bindTexture(A){this.dirty&&(this.update(),this.dirty=!1),this.gltexture.bindToUniform(A,this.textureUnif,this.texBinding)}}const zi={};class Ti{constructor(A,g,I,C){this.uniformBindings=[];const i=i=>{const e=i.getName(),t=I[e];if(null!=t)switch(t.type){case"Boolean":case"UInt32":case"SInt32":case"Float32":this.uniformBindings.push(new Ui(A,g,i,t,I));break;case"Vec2":case"Vec3":case"Vec4":this.uniformBindings.push(new vi(A,g,i,t));break;case"Color":this.uniformBindings.push(new xi(A,g,i,t,I));break;case"Mat4":this.uniformBindings.push(new ki(A,g,i,t));break;default:return void console.warn("Param :"+e+" has unhandled data type:"+t.type)}else{if(I[e+"Tex"])return void this.uniformBindings.push(new xi(A,g,i,t,I));if(C){const A=g.getMaterial().getShaderName();zi[A]||(zi[A]={}),zi[A][e]||(console.warn("Material:"+g.getMaterial().getName(),"with Shader ",A,"Param has no unif",e),zi[A][e]=!0)}}},e=g.getMaterial().getParameters();for(const A of e)i(A)}bind(A){for(const g of this.uniformBindings)g.bind(A);return!0}unbind(A){for(const g of this.uniformBindings)g.unbind(A)}destroy(){for(const A of this.uniformBindings)A.destroy()}}class _i extends V{constructor(A,g,I){super(),this.__gl=A,this.__material=g,this.__glshader=I,this.__shaderBindings={},g.on("parameterValueChanged",(()=>this.emit("updated")))}getMaterial(){return this.__material}getGLShader(){return this.__glshader}bind(A,g){this.__boundTexturesBeforeMaterial=A.boundTextures;let I=this.__shaderBindings[A.shaderkey];if(!I){const C=this.__gl;I=new Ti(C,this,A.unifs,g),this.__shaderBindings[A.shaderkey]=I}I.bind(A)}unbind(A){A.boundTextures=this.__boundTexturesBeforeMaterial}}class Pi extends V{constructor(A){super(),this.materials=[],this.materialIndices={},this.glMaterials={},this.refCounts=[],this.freeIndices=[],this.dirtyIndices=new Set,this.materialsAllocator=new X,this.renderer=A,this.materialsAllocator.on("dataReallocated",(A=>{const g=A.id;this.dirtyIndices.add(g)}))}addMaterial(A){let g=this.materialIndices[A.getId()];if(null!=g)return this.refCounts[g]++,g;g=this.freeIndices.length?this.freeIndices.pop():this.materials.length,this.materials[g]=A,this.refCounts[g]=1,this.materialIndices[A.getId()]=g;const I=A.getShaderClass().getPackedMaterialData(A);this.materialsAllocator.allocate(g,I.length/4);return A.on("parameterValueChanged",(()=>{this.dirtyIndices.add(g),this.emit("updated")})),this.dirtyIndices.add(g),g}getGLMaterial(A){if(this.glMaterials[A.getId()])return this.glMaterials[A.getId()];const g=this.renderer.getOrCreateShader(A.getShaderName()),I=this.renderer.gl,C=new _i(I,A,g);return C.on("updated",(()=>{this.renderer.requestRedraw()})),A.setMetadata("glMaterial",C),this.glMaterials[A.getId()]=C,C}getMaterialAllocation(A){const g=this.materialIndices[A.getId()];if(null!=g)return this.materialsAllocator.getAllocation(g)}removeMaterial(A){const g=this.materialIndices[A.getId()];this.refCounts[g]--,this.refCounts[g]>0||(this.freeIndices.push(g),this.materialsAllocator.deallocate(g),this.materials[g]=null,delete this.materialIndices[A.getId()],this.dirtyIndices.has(g)&&this.dirtyIndices.delete(g))}uploadMaterials(A){const g=this.renderer.__gl,I=r.nextPow2(Math.ceil(Math.sqrt(this.materialsAllocator.reservedSpace))),C=A.boundTextures++;if(g.activeTexture(g.TEXTURE0+C),this.materialsTexture){if(this.materialsTexture.width<I){this.materialsTexture.resize(I,I);for(let A=0;A<this.materials.length;A++)this.materialsAllocator.getAllocation(A)&&this.dirtyIndices.add(A)}}else this.materialsTexture=new HC(this.renderer.__gl,{format:"RGBA",type:"FLOAT",width:I,height:I,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.materialsTexture.clear();const i=this.materialsTexture,e=this.materialsTexture.width;g.bindTexture(g.TEXTURE_2D,i.glTex),this.dirtyIndices.forEach((A=>{const I=this.materialsAllocator.getAllocation(A),C=this.materials[A],t=C.getShaderClass().getPackedMaterialData(C),B=I.start%e,o=Math.ceil((B+I.size)/e);let s=0,a=I.size,l=B;for(let A=0;A<o;A++){let A;l+a>e?(A=e-l,l=0):A=a;const C=(I.start+s)%e,B=Math.floor((I.start+s)/e),o=t.subarray(4*s,4*(s+A));g.texSubImage2D(g.TEXTURE_2D,0,C,B,A,1,i.getFormat(),i.getType(),o),s+=A,a-=A}})),this.dirtyIndices=new Set,g.bindTexture(g.TEXTURE_2D,null),A.boundTextures--}update(A){this.dirtyIndices.size>0&&this.uploadMaterials(A)}bind(A){if(this.dirtyIndices.size>0&&this.uploadMaterials(A),!this.materialsTexture)return!1;const{materialsTexture:g,materialsTextureSize:I}=A.unifs;if(g&&(this.materialsTexture.bindToUniform(A,g),I)){this.renderer.gl.uniform2i(I.location,this.materialsTexture.width,this.materialsTexture.height)}return!0}}class Oi extends Wi{constructor(A,g){super(A,g),this.__numVertices=9,this.__vboState=-1,this.genBuffers()}genBuffers(A){super.genBuffers(A);const g=this.__gl,I=this.__geom.genBuffers();for(const A in I.attrBuffers){const C=I.attrBuffers[A],i=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,i),g.bufferData(g.ARRAY_BUFFER,C.values,g.STATIC_DRAW),this.__glattrbuffers[A]={buffer:i,dataType:C.dataType,normalized:C.normalized}}this.__numVertices=I.numVertices,this.__vboState=2}updateBuffers(A){const g=this.__gl,I=this.__geom.genBuffers(),C=I.numVertices!=this.__numVertices;for(const A in I.attrBuffers){const i=I.attrBuffers[A],e=this.__glattrbuffers[A];C&&(g.deleteBuffer(e.buffer),e.buffer=g.createBuffer()),g.bindBuffer(g.ARRAY_BUFFER,e.buffer),g.bufferData(g.ARRAY_BUFFER,i.values,g.STATIC_DRAW)}this.__numVertices=I.numVertices}bind(A){if(A.unifs.PointSize){const g=this.__gl;let I=this.__shaderBindings[A.shaderkey];if(!I){g.__quadVertexIdsBuffer||g.setupInstancedQuad();const C=Object.assign(this.__glattrbuffers,g.__quadattrbuffers);I=_C(this.__gl,A.attrs,C,g.__quadIndexBuffer),this.__shaderBindings[A.shaderkey]=I}return I.bind(A),!0}return super.bind(A),!0}draw(A){const g=this.__gl;A.unifs.PointSize?g.drawElementsInstanced(g.TRIANGLES,6,g.UNSIGNED_SHORT,0,this.__numVertices):g.drawArrays(g.POINTS,0,this.__numVertices)}drawInstanced(A,g){this.__gl.drawArraysInstanced(this.__gl.POINTS,0,this.__numVertices,g)}}class ji extends Wi{constructor(A,g){super(A,g),this.__numSegIndices=0,this.__numVertices=0,this.__fatBuffersNeedUpload=!1,this.fatBuffers=null,this.__buffersNeedUpload=!1,this.__indexDataType=0,this.__numSegIndices=0,this.__numVertices=0,this.__fatBuffersNeedUpload=!0}dirtyBuffers(A){super.dirtyBuffers(A),this.__fatBuffersNeedUpload=!0,this.emit("updated")}clearBuffers(){const A=this.__gl;if(A.deleteBuffer(this.__indexBuffer),this.__indexBuffer=null,this.fatBuffers&&this.fatBuffers.positionsTexture){this.fatBuffers.positionsTexture&&(this.fatBuffers.positionsTexture.destroy(),this.fatBuffers.positionsTexture=null);const g=this.fatBuffers.glattrbuffers.segmentIndices;g.buffer&&(A.deleteBuffer(g.buffer),this.fatBuffers.glattrbuffers.segmentIndices=null)}super.clearBuffers()}genFatBuffers(A){const g=this.__gl,I=this.__geom.genBuffers(),C=I.indices,i=I.numVertices!=this.__numVertices;g.__quadVertexIdsBuffer||g.setupInstancedQuad(),this.fatBuffers||(this.fatBuffers={drawCount:0,positionsTexture:null,glattrbuffers:{}},this.fatBuffers.glattrbuffers.vertexIDs=g.__quadattrbuffers.vertexIDs);const e=A.boundTextures++;g.activeTexture(this.__gl.TEXTURE0+e),this.fatBuffers.drawCount=C.length/2;const t=this.__geom.getVertexAttributes(),B=t.positions,s=t.lineThickness,a=new Float32Array(4*B.getCount());for(let A=0;A<B.getCount();A++){new o(new Float32Array(a.buffer,4*A*4,3)).setFromOther(B.getValueRef(A)),a[4*A+3]=s?s.getFloat32Value(A):1}i&&this.fatBuffers.positionsTexture&&(this.fatBuffers.positionsTexture.destroy(),this.fatBuffers.positionsTexture=null),this.fatBuffers.positionsTexture?this.fatBuffers.positionsTexture.bufferData(a,B.getCount(),1):this.fatBuffers.positionsTexture=new HC(this.__gl,{format:"RGBA",type:"FLOAT",width:B.getCount(),height:1,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",data:a,mipMapped:!1});const l=()=>{const A=new Float32Array(C.length);for(let g=0;g<C.length;g++){let I;I=g%2==0?g>0?C[g]==C[g-1]:C[g]==C[C.length-1]:g<C.length-1?C[g]==C[g+1]:C[g]==C[0],A[g]=(I?1:0)+2*C[g]}return A};if(this.fatBuffers.glattrbuffers.segmentIndices)(!this.genBufferOpts||this.genBufferOpts&&this.genBufferOpts.topologyChanged)&&(g.bindBuffer(g.ARRAY_BUFFER,this.fatBuffers.glattrbuffers.segmentIndices.buffer),g.bufferData(g.ARRAY_BUFFER,l(),g.STATIC_DRAW));else{const A=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,A),g.bufferData(g.ARRAY_BUFFER,l(),g.STATIC_DRAW),this.fatBuffers.glattrbuffers.segmentIndices={buffer:A,dimension:2,dataType:"Vec2"}}this.__numSegIndices=C.length,this.__numVertices=I.numVertices,g.bindTexture(g.TEXTURE_2D,null),A.boundTextures--,this.__fatBuffersNeedUpload=!1}genBuffers(A){const g=this.__gl,I=this.__geom.genBuffers(),C=I.indices,i=I.numVertices!=this.__numVertices;this.__indexBuffer?(!this.genBufferOpts||this.genBufferOpts&&this.genBufferOpts.topologyChanged)&&(this.__numSegIndices!=C.length&&(g.deleteBuffer(this.__indexBuffer),this.__indexBuffer=g.createBuffer()),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,C,g.STATIC_DRAW),this.__numSegIndices=C.length):(this.__indexBuffer=g.createBuffer(),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,C,g.STATIC_DRAW));for(const A in I.attrBuffers){const C=I.attrBuffers[A];if(this.__glattrbuffers[A]){const I=this.__glattrbuffers[A];i&&(g.deleteBuffer(I.buffer),I.buffer=g.createBuffer()),g.bindBuffer(g.ARRAY_BUFFER,I.buffer),g.bufferData(g.ARRAY_BUFFER,C.values,g.STATIC_DRAW)}else{const I=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,I),g.bufferData(g.ARRAY_BUFFER,C.values,g.STATIC_DRAW),this.__glattrbuffers[A]={buffer:I,dataType:C.dataType,normalized:C.normalized}}}this.__numSegIndices=C.length,this.__numVertices=I.numVertices,this.__buffersNeedUpload=!1,C instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),C instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),C instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT)}bind(A){const g=this.__gl,I=A.unifs;if(I.LineThickness&&g.floatTexturesSupported){this.__fatBuffersNeedUpload&&this.genFatBuffers(A);const C=this.fatBuffers;let i=this.__shaderBindings[A.shaderkey];return i||(i=_C(this.__gl,A.attrs,C.glattrbuffers,g.__quadIndexBuffer),this.__shaderBindings[A.shaderkey]=i),i.bind(A),I.positionsTexture&&(C.positionsTexture.bindToUniform(A,I.positionsTexture),g.uniform1i(I.positionsTextureSize.location,C.positionsTexture.width)),!0}return super.bind(A),!0}drawPoints(){this.__gl.drawArrays(this.__gl.POINTS,0,this.__geom.numVertices())}draw(A){const g=this.__gl;A.unifs.LineThickness&&g.floatTexturesSupported?g.drawElementsInstanced(g.TRIANGLES,6,g.UNSIGNED_SHORT,0,this.fatBuffers.drawCount):g.drawElements(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0)}drawInstanced(A,g){const I=this.__gl,{occluded:C}=A.unifs;C&&I.uniform1i(C.location,0),I.drawElementsInstanced(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0,g),C&&(I.uniform1i(C.location,1),I.depthFunc(I.GREATER),I.drawElementsInstanced(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0,g),I.depthFunc(I.LEQUAL))}}const qi=(A,g)=>{const I=new Int32Array(g);return I.set(A),I};class $i extends V{constructor(A){super(),this.shaderAttrSpec={},this.freeGeomIndices=[],this.geoms=[],this.geomRefCounts=[],this.geomsDict={},this.glGeomsDict={},this.geomBuffersTmp=[],this.glattrbuffers={},this.shaderBindings={},this.attributesBufferNeedsRealloc=!1,this.attributesBufferNeedsAlloc=[],this.attributesAllocator=new X,this.dirtyGeomIndices=new Set,this.geomVertexOffsets=new Int32Array(1),this.geomVertexCounts=new Int32Array(1),this.numIndices=0,this.indicesBufferNeedsRealloc=!1,this.indicesAllocator=new X,this.indicesCounts=new Int32Array(1),this.indicesOffsets=new Int32Array(1),this.indexBuffer=null,this.freeDataAfterUpload=!0,this.__destroyed=!1,this.renderer=A,this.__gl=A.gl,this.attributesAllocator.on("resized",(()=>{this.attributesBufferNeedsRealloc=!0})),this.attributesAllocator.on("dataReallocated",(A=>{const g=A.id,I=A.allocation;this.dirtyGeomIndices.add(g),this.geomVertexOffsets[g]=I.start,this.geomVertexCounts[g]=I.size})),this.freeGeomIndices.push(0),this.indicesAllocator.on("resized",(()=>{this.indicesBufferNeedsRealloc=!0})),this.indicesAllocator.on("dataReallocated",(A=>{const g=A.id;this.dirtyGeomIndices.add(g)}));const g=Math.pow(2,23);this.attributesAllocator.reservedSpace=g,this.indicesAllocator.reservedSpace=4*g,this.attributesBufferNeedsRealloc=!0,this.indicesBufferNeedsRealloc=!0}constructGLGeom(A){let g=this.glGeomsDict[A.getId()];if(null!=g)return g;const I=this.__gl;if(A instanceof Kg||A instanceof Dg)g=new Yi(I,A);else if(A instanceof Yg||A instanceof Jg)g=new ji(I,A);else{if(!(A instanceof Wg||A instanceof Ng))throw new Error("Unsupported geom type:"+A.constructor.name);g=new Oi(I,A)}return this.glGeomsDict[A.getId()]=g,g.on("updated",(()=>{this.renderer.requestRedraw()})),g.addRef(this),g}addGeom(A){let g=this.geomsDict[A.getId()];if(null!=g)return this.geomRefCounts[g]++,g;if(0==this.freeGeomIndices.length){const A=this.geomVertexCounts.length,g=2*A;this.geomVertexCounts=qi(this.geomVertexCounts,g),this.geomVertexOffsets=qi(this.geomVertexOffsets,g),this.indicesCounts=qi(this.indicesCounts,g),this.indicesOffsets=qi(this.indicesOffsets,g);for(let I=g-1;I>=A;I--)this.freeGeomIndices.push(I)}g=this.freeGeomIndices.pop(),this.geoms[g]=A,this.geomRefCounts[g]=1,this.geomsDict[A.getId()]=g,this.dirtyGeomIndices.add(g),this.geomVertexCounts[g]=0,this.geomVertexOffsets[g]=0,this.indicesCounts[g]=0,this.indicesOffsets[g]=0;return A.on("geomDataChanged",(()=>{this.dirtyGeomIndices.add(g),this.emit("updated")})),A.on("geomDataTopologyChanged",(()=>{this.dirtyGeomIndices.add(g),this.emit("updated")})),g}removeGeom(A){const g=this.geomsDict[A.getId()];this.geomRefCounts[g]--,this.geomRefCounts[g]>0||(this.attributesAllocator.getAllocation(g)&&this.attributesAllocator.deallocate(g),this.indicesAllocator.getAllocation(g)&&this.indicesAllocator.deallocate(g),this.dirtyGeomIndices.has(g)&&this.dirtyGeomIndices.delete(g),this.geomVertexCounts[g]=0,this.geomVertexOffsets[g]=0,this.geoms[g]=null,this.freeGeomIndices.push(g),delete this.geomsDict[A.getId()],delete this.geomBuffersTmp[g],this.indicesCounts[g]=0,this.indicesOffsets[g]=0)}getGeom(A){return this.geoms[A]}getGeomOffsetAndCount(A){return[this.indicesOffsets[A],this.indicesCounts[A]]}getGeomBuffers(A){return this.geomBuffersTmp[A]}allocateBuffers(A){const g=this.geoms[A];if(!g)return;const I=g.genBuffers(),C=I.numRenderVerts?I.numRenderVerts:I.numVertices;if(this.geomVertexCounts[A]!=C)if(0==C)this.attributesAllocator.deallocate(A),this.geomVertexOffsets[A]=0,this.geomVertexCounts[A]=0;else{const g=this.attributesAllocator.allocate(A,C);this.geomVertexOffsets[A]=g.start,this.geomVertexCounts[A]=g.size}for(const A in I.attrBuffers)if(!this.shaderAttrSpec[A]){const g=I.attrBuffers[A],C=kC(this.__gl,g.dataType);this.shaderAttrSpec[A]={dataType:g.dataType,normalized:g.normalized,dimension:C.dimension,elementSize:C.elementSize},this.attributesBufferNeedsAlloc.push(A)}if(I.indices){const g=I.indices.length;if(this.indicesCounts[A]!=g)if(0==g)this.indicesAllocator.deallocate(A),this.indicesOffsets[A]=0,this.indicesCounts[A]=0;else{const I=this.indicesAllocator.allocate(A,g),C=4;this.indicesOffsets[A]=I.start*C,this.indicesCounts[A]=I.size}}else this.indicesOffsets[A]=this.geomVertexOffsets[A],this.indicesCounts[A]=this.geomVertexCounts[A];this.geomBuffersTmp[A]=I}genAttributesBuffers(){for(const A in this.shaderAttrSpec)this.genAttributesBuffer(A);this.attributesBufferNeedsAlloc=[]}genAttributesBuffer(A){const g=this.attributesAllocator.reservedSpace,I=this.__gl;{const C=this.shaderAttrSpec[A],i=g*C.dimension,e=I.createBuffer();I.bindBuffer(I.ARRAY_BUFFER,e);const t=i*C.elementSize;I.bufferData(I.ARRAY_BUFFER,t,I.STATIC_DRAW),this.glattrbuffers[A]&&this.glattrbuffers[A].buffer&&(I.bindBuffer(I.COPY_WRITE_BUFFER,e),I.bindBuffer(I.COPY_READ_BUFFER,this.glattrbuffers[A].buffer),I.copyBufferSubData(I.COPY_READ_BUFFER,I.COPY_WRITE_BUFFER,0,0,this.glattrbuffers[A].length*C.elementSize),I.deleteBuffer(this.glattrbuffers[A].buffer)),C.numValues=i;const B="textureCoords"==A?"texCoords":A;this.glattrbuffers[B]={buffer:e,dataType:C.dataType,normalized:C.normalized,length:i,dimension:C.dimension}}}genIndicesBuffers(){const A=this.indicesAllocator.reservedSpace;if(this.numIndices!=A){const g=this.__gl,I=g.createBuffer();g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,I);const C=4,i=A*C;g.bufferData(g.ELEMENT_ARRAY_BUFFER,i,g.STATIC_DRAW),this.indexBuffer&&(g.bindBuffer(g.COPY_WRITE_BUFFER,I),g.bindBuffer(g.COPY_READ_BUFFER,this.indexBuffer),g.copyBufferSubData(g.COPY_READ_BUFFER,g.COPY_WRITE_BUFFER,0,0,this.numIndices*C),g.deleteBuffer(this.indexBuffer)),this.indexBuffer=I,this.numIndices=A}}uploadBuffers(A){const g=this.__gl;let I=this.geomBuffersTmp[A];if(!I){const g=this.geoms[A];if(!g)return;I=g.genBuffers(),this.geomBuffersTmp[A]=I}const C=this.geomVertexCounts[A],i=I.numRenderVerts?I.numRenderVerts:I.numVertices;if(C!=i)throw new Error("Invalid allocation for this geom");if(0!=i){for(const C in I.attrBuffers){const i=this.shaderAttrSpec[C],e=I.attrBuffers[C],t=this.glattrbuffers[C];if(!e||!t)continue;g.bindBuffer(g.ARRAY_BUFFER,t.buffer);const B=i.elementSize,o=this.geomVertexOffsets[A]*B*i.dimension;g.bufferSubData(g.ARRAY_BUFFER,o,e.values)}if(g.bindBuffer(g.ARRAY_BUFFER,null),I.indices&&I.indices.length>0){const g=I.indices,C=this.indicesAllocator.getAllocation(A);if(C.size!=g.length)throw new Error("Invalid allocation for this geom");const i=this.attributesAllocator.getAllocation(A),e=new Uint32Array(C.size);for(let A=0;A<g.length;A++)e[A]=I.indices[A]+i.start;const t=this.__gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);const B=4,o=C.start*B;t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,o,e),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}this.emit("geomDataChanged",new p(A))}else{const g=new p(A);this.emit("geomDataChanged",g)}}cleanGeomBuffers(){if(this.dirtyGeomIndices.forEach((A=>{this.allocateBuffers(A)})),this.attributesBufferNeedsRealloc||this.indicesBufferNeedsRealloc){for(const A in this.shaderBindings){this.shaderBindings[A].destroy()}this.shaderBindings={},this.attributesBufferNeedsRealloc&&(this.genAttributesBuffers(),this.attributesBufferNeedsRealloc=!1),this.indicesBufferNeedsRealloc&&(this.genIndicesBuffers(),this.indicesBufferNeedsRealloc=!1)}else this.attributesBufferNeedsAlloc.length>0&&(this.attributesBufferNeedsAlloc.forEach((A=>{this.genAttributesBuffer(A)})),this.attributesBufferNeedsAlloc=[]);this.dirtyGeomIndices.forEach((A=>{this.uploadBuffers(A)})),this.dirtyGeomIndices=new Set}bind(A){this.dirtyGeomIndices.size>0&&this.cleanGeomBuffers();let g=this.shaderBindings[A.shaderkey];if(g)g.bind(A);else{g=_C(this.__gl,A.attrs,this.glattrbuffers,this.indexBuffer),this.shaderBindings[A.shaderkey]=g;{const A=this.__gl;A.drawElements(A.POINTS,1,A.UNSIGNED_INT,0),A.drawElements(A.LINES,2,A.UNSIGNED_INT,0),A.drawElements(A.TRIANGLES,3,A.UNSIGNED_INT,0);const g=new Uint32Array(1),I=4,C=this.indicesAllocator.allocatedSpace*I;A.bufferSubData(A.ELEMENT_ARRAY_BUFFER,C,g)}}return!0}unbind(A){const g=this.shaderBindings[A.shaderkey];g&&g.unbind(A)}clearBuffers(){const A=this.__gl;for(const g in this.glattrbuffers){const I=this.glattrbuffers[g];I.shared||A.deleteBuffer(I.buffer)}this.glattrbuffers={},this.indexBuffer&&(A.deleteBuffer(this.indexBuffer),this.indexBuffer=null);for(const A in this.shaderBindings){this.shaderBindings[A].destroy()}this.shaderBindings={}}destroy(){this.clearBuffers(),this.__destroyed=!0,this.emit("destructing")}}const Ae={GEOMITEM_FLAG_CUTAWAY:1,GEOMITEM_INVISIBLE_IN_GEOMDATA:2,GEOMITEM_TRANSPARENT:4};class ge extends V{constructor(A,g,I,C,i,e=!1){if(super(),this.listenerIDs={},this.shattered=!1,this.culled=!1,this.cutDataChanged=!1,this.cutData=[],this.geomMatrixDirty=!1,this.gl=A,this.geomItem=g,this.geomItemId=I,this.geomId=C,this.materialId=i,this.supportInstancing=e,this.visible=this.geomItem.isVisible(),this.listenerIDs.visibilityChanged=this.geomItem.on("visibilityChanged",(A=>{const g=!this.culled&&this.visible;this.visible=A.visible;const I=!this.culled&&this.visible;g!=I&&this.emit("visibilityChanged",new O(I))})),g instanceof dC&&(this.shattered=g.shattered),this.listenerIDs.shatterStateChanged=this.geomItem.on("shatterStateChanged",(A=>{this.shattered=A.state,this.emit("shatterStateChanged",A)})),!this.supportInstancing){this.cutDataChanged=!1,this.cutData=[0,0,0,0];const A=0;let I=0;this.geomItem.isCutawayEnabled()&&(I|=Ae.GEOMITEM_FLAG_CUTAWAY),g.isSelectable()||(I|=Ae.GEOMITEM_INVISIBLE_IN_GEOMDATA),g.materialParam.value.isOpaque()||(I|=Ae.GEOMITEM_TRANSPARENT),this.geomData=[I,A,0,0],this.geomMatrixDirty=!0,this.listenerIDs["GeomMat.valueChanged"]=this.geomItem.geomMatParam.on("valueChanged",(()=>{this.geomMatrixDirty=!0,this.emit("updated")})),this.listenerIDs.cutAwayChanged=this.geomItem.on("cutAwayChanged",(()=>{this.cutDataChanged=!0,this.emit("updated")}));const C=A=>{if(A.isOpaqueStateChanged){let g=this.geomData[0];A.isOpaque?g&=~Ae.GEOMITEM_TRANSPARENT:g|=Ae.GEOMITEM_TRANSPARENT,this.geomData[0],this.emit("updated")}};this.listenerIDs.opacityChanged=this.geomItem.on("opacityChanged",C),this.listenerIDs["material:opacityChanged"]=this.geomItem.materialParam.on("opacityChanged",C)}}getGeomItem(){return this.geomItem}isVisible(){return!this.culled&&this.visible}getGeomItemId(){return this.geomItemId}setCulled(A){const g=!this.culled&&this.visible;this.culled=A;const I=!this.culled&&this.visible;g!=I&&this.emit("visibilityChanged",new O(I))}bind(A){const g=this.gl,I=A.unifs;if(!this.supportInstancing){const A=I.modelMatrix;A&&(this.geomMatrixDirty&&(this.modelMatrixArray=this.geomItem.geomMatParam.value.asArray()),g.uniformMatrix4fv(A.location,!1,this.modelMatrixArray));const C=I.drawItemData;C&&g.uniform4fv(C.location,this.geomData);const i=I.cutawayData;if(i){if(this.cutDataChanged&&this.geomItem.isCutawayEnabled()){const A=this.geomItem.getCutVector(),g=this.geomItem.getCutDist();this.cutData=[A.x,A.y,A.z,g]}g.uniform4fv(i.location,this.cutData)}}const C=I.geomItemId;return C&&g.uniform1i(C.location,this.geomItemId),!0}destroy(){this.geomItem.removeListenerById("visibilityChanged",this.listenerIDs.visibilityChanged),this.supportInstancing||(this.geomItem.geomMatParam.removeListenerById("valueChanged",this.listenerIDs["GeomMat.valueChanged"]),this.geomItem.removeListenerById("cutAwayChanged",this.listenerIDs.cutAwayChanged))}}class Ie extends DC{constructor(A){super(A,"ReductionShader"),this.setShaderStage("VERTEX_SHADER","\n\nprecision highp float;\n\nuniform int reductionTextureWidth;\nuniform sampler2D geomDataTexture;\n\nivec2 texelCoordFromVertexId(){\n  ivec2 texSize = textureSize(geomDataTexture, 0);\n  return ivec2(\n    gl_VertexID % texSize.x, \n    gl_VertexID / texSize.x\n    );\n}\n\nvec2 pointPositionFromGeomItemId(int geomItemId){\n  vec2 result = vec2(\n    (float(geomItemId % reductionTextureWidth) + 0.5) / float(reductionTextureWidth), \n    (float(geomItemId / reductionTextureWidth) + 0.5) / float(reductionTextureWidth)\n    );\n  return vec2(-1.0, -1.0) + (result * 2.0);\n}\n\nvoid main()\n{\n  // Get the texel coordinate in the source geomdata buffer.\n  // there is one point for every pixel in the geomdata texture.\n  ivec2 texelCoord = texelCoordFromVertexId();\n  int geomItemId = int(texelFetch(geomDataTexture, texelCoord, 0).g + 0.5);\n\n  if (geomItemId > 0) {\n    vec2 position = pointPositionFromGeomItemId(geomItemId);\n    gl_Position = vec4(position, 0.0, 1.0);\n    gl_PointSize = 1.0;\n  } else {\n    // Move it off screen\n    gl_Position = vec4(-2.0, -2.0, 0.0, 1.0);\n    gl_PointSize = 0.0;\n  }\n}\n\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n")}}class Ce extends DC{constructor(A){super(A,"BoundingBoxShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec4 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 cameraMatrix;\n\nuniform highp int occlusionCulling;\nuniform sampler2D reductionDataTexture;\n\nimport 'transpose.glsl'\nimport 'GLSLUtils.glsl'\nimport 'stack-gl/transpose.glsl'\nimport 'stack-gl/inverse.glsl'\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\nconst int GEOMITEM_INVISIBLE_IN_GEOMDATA = 2; // 1<<1;\n\n/* VS Outputs */\nvarying vec4 v_color;\n\nvoid main(void) {\n\n  int drawItemId = getGeomItemId();\n  vec4 geomItemData  = getInstanceData(drawItemId);\n  int flags = int(geomItemData.r + 0.5);\n\n  if (occlusionCulling != 0) {\n    // Check if in the reduction texture, this item is already flagged as visible.\n    // Note: we only draw bboxes for those that have been flagged as invisible, but might\n    // be just off screen, or onscreen, but were culled in the previous update.\n    int isVisible = int(fetchTexel(reductionDataTexture, textureSize(reductionDataTexture, 0), drawItemId).r);\n    if (isVisible > 0) {\n      return;\n    }\n    if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n      return;\n    }\n  }\n\n  vec4 bboxMin = fetchTexel(instancesTexture, instancesTextureSize, (drawItemId * pixelsPerItem) + 6);\n  vec4 bboxMax = fetchTexel(instancesTexture, instancesTextureSize, (drawItemId * pixelsPerItem) + 7);\n  mat4 viewProjectionMatrix = projectionMatrix * viewMatrix;\n\n  if (occlusionCulling != 0) {\n    // TODO: The bounding box stochastic\n    v_color = vec4(0.0, float(drawItemId), 0.0, 1.0);\n  } else {\n    v_color = fetchTexel(instancesTexture, instancesTextureSize, (drawItemId * pixelsPerItem) + 4);\n  }\n\n  vec4 pos = positions;\n  if (pos.x < 0.0) pos.x = bboxMin.x;\n  else if (pos.x > 0.0) pos.x = bboxMax.x;\n  if (pos.y < 0.0) pos.y = bboxMin.y;\n  else if (pos.y > 0.0) pos.y = bboxMax.y;\n  if (pos.z < 0.0) pos.z = bboxMin.z;\n  else if (pos.z > 0.0) pos.z = bboxMax.z;\n\n  gl_Position = viewProjectionMatrix * pos;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\n/* VS Outputs */\nvarying vec4 v_color;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int drawItemId = int(v_color.g);\n  fragColor = v_color;\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}var ie=ZA("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwp2YXIgd29ya2VyX2NvZGUgPSAoZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAndXNlIHN0cmljdCc7CgogIC8qIGVzbGludC1kaXNhYmxlIGNhbWVsY2FzZSAqLwogIGNvbnN0IHZlYzNfc3VidHJhY3QgPSAodmVjMSwgdmVjMikgPT4gewogICAgcmV0dXJuIFt2ZWMxWzBdIC0gdmVjMlswXSwgdmVjMVsxXSAtIHZlYzJbMV0sIHZlYzFbMl0gLSB2ZWMyWzJdXQogIH07CiAgY29uc3QgdmVjM19sZW5ndGggPSAodmVjKSA9PiB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KHZlY1swXSAqIHZlY1swXSArIHZlY1sxXSAqIHZlY1sxXSArIHZlY1syXSAqIHZlY1syXSkKICB9OwogIGNvbnN0IHZlYzJfc2NhbGUgPSAodmVjLCBzY2wpID0+IHsKICAgIHJldHVybiBbdmVjWzBdICogc2NsLCB2ZWNbMV0gKiBzY2xdCiAgfTsKICBjb25zdCB2ZWMyX2xlbmd0aCA9ICh2ZWMpID0+IHsKICAgIHJldHVybiBNYXRoLnNxcnQodmVjWzBdICogdmVjWzBdICsgdmVjWzFdICogdmVjWzFdKQogIH07CgogIGNvbnN0IHF1YXRfY29uanVnYXRlID0gKHF1YXQpID0+IHsKICAgIHJldHVybiBbLXF1YXRbMF0sIC1xdWF0WzFdLCAtcXVhdFsyXSwgcXVhdFszXV0KICB9OwogIGNvbnN0IHF1YXRfbXVsdGlwbHkgPSAocXVhdDEsIHF1YXQyKSA9PiB7CiAgICBjb25zdCBheCA9IHF1YXQxWzBdOwogICAgY29uc3QgYXkgPSBxdWF0MVsxXTsKICAgIGNvbnN0IGF6ID0gcXVhdDFbMl07CiAgICBjb25zdCBhdyA9IHF1YXQxWzNdOwogICAgY29uc3QgYnggPSBxdWF0MlswXTsKICAgIGNvbnN0IGJ5ID0gcXVhdDJbMV07CiAgICBjb25zdCBieiA9IHF1YXQyWzJdOwogICAgY29uc3QgYncgPSBxdWF0MlszXTsKCiAgICByZXR1cm4gWwogICAgICBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5LAogICAgICBheSAqIGJ3ICsgYXcgKiBieSArIGF6ICogYnggLSBheCAqIGJ6LAogICAgICBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4LAogICAgICBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6LAogICAgXQogIH07CiAgY29uc3QgcXVhdF9yb3RhdGVWZWMzID0gKHF1YXQsIHZlYzMpID0+IHsKICAgIGNvbnN0IHZxID0gW3ZlYzNbMF0sIHZlYzNbMV0sIHZlYzNbMl0sIDAuMF07CiAgICBjb25zdCBwcSA9IHF1YXRfbXVsdGlwbHkocXVhdF9tdWx0aXBseShxdWF0LCB2cSksIHF1YXRfY29uanVnYXRlKHF1YXQpKTsKICAgIHJldHVybiBbcHFbMF0sIHBxWzFdLCBwcVsyXV0KICB9OwoKICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogIC8vIEZydXN0dW0gQ3VsbGluZyBkYXRhLgogIGxldCBlbmFibGVPY2NsdXNpb25DdWxsaW5nID0gZmFsc2U7CiAgY29uc3QgZ2VvbUl0ZW1zRGF0YSA9IFtdOwogIGNvbnN0IG91dE9mRnJ1c3R1bSA9IFtdOwogIGxldCBmcnVzdHVtQ3VsbGVkQ291bnQgPSAwOwogIGxldCBuZXdseUN1bGxlZCA9IFtdOwogIGxldCBuZXdseVVuQ3VsbGVkID0gW107CgogIGxldCB2aXNpYmxlQ291bnQgPSAwOwogIGNvbnN0IHRvdGFsR2VvbVN0YXRzID0gewogICAgdHJpYW5nbGVzOiAwLAogICAgbGluZXM6IDAsCiAgICBwb2ludHM6IDAsCiAgfTsKICBjb25zdCB2aXNpYmxlR2VvbVN0YXRzID0gewogICAgdHJpYW5nbGVzOiAwLAogICAgbGluZXM6IDAsCiAgICBwb2ludHM6IDAsCiAgfTsKICBjb25zdCBnZW9tU3RhdHNfYWRkVG90YWwgPSAoZ2VvbVN0YXRzKSA9PiB7CiAgICAvLyBjb25zb2xlLmxvZygnZ2VvbVN0YXRzX2FkZDonLCBnZW9tU3RhdHMudHJpYW5nbGVzLCB2aXNpYmxlR2VvbVN0YXRzLnRyaWFuZ2xlcykKICAgIHRvdGFsR2VvbVN0YXRzLnRyaWFuZ2xlcyArPSBnZW9tU3RhdHMudHJpYW5nbGVzOwogICAgdG90YWxHZW9tU3RhdHMubGluZXMgKz0gZ2VvbVN0YXRzLmxpbmVzOwogICAgdG90YWxHZW9tU3RhdHMucG9pbnRzICs9IGdlb21TdGF0cy5wb2ludHM7CiAgfTsKICBjb25zdCBnZW9tU3RhdHNfc3VidHJhY3RUb3RhbCA9IChnZW9tU3RhdHMpID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKCdnZW9tU3RhdHNfc3VidHJhY3Q6JywgZ2VvbVN0YXRzLnRyaWFuZ2xlcywgdmlzaWJsZUdlb21TdGF0cy50cmlhbmdsZXMpCiAgICB0b3RhbEdlb21TdGF0cy50cmlhbmdsZXMgLT0gZ2VvbVN0YXRzLnRyaWFuZ2xlczsKICAgIHRvdGFsR2VvbVN0YXRzLmxpbmVzIC09IGdlb21TdGF0cy5saW5lczsKICAgIHRvdGFsR2VvbVN0YXRzLnBvaW50cyAtPSBnZW9tU3RhdHMucG9pbnRzOwogIH07CiAgY29uc3QgZ2VvbVN0YXRzX2FkZCA9IChnZW9tU3RhdHMpID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKCdnZW9tU3RhdHNfYWRkOicsIGdlb21TdGF0cy50cmlhbmdsZXMsIHZpc2libGVHZW9tU3RhdHMudHJpYW5nbGVzKQogICAgdmlzaWJsZUNvdW50Kys7CiAgICB2aXNpYmxlR2VvbVN0YXRzLnRyaWFuZ2xlcyArPSBnZW9tU3RhdHMudHJpYW5nbGVzOwogICAgdmlzaWJsZUdlb21TdGF0cy5saW5lcyArPSBnZW9tU3RhdHMubGluZXM7CiAgICB2aXNpYmxlR2VvbVN0YXRzLnBvaW50cyArPSBnZW9tU3RhdHMucG9pbnRzOwogIH07CiAgY29uc3QgZ2VvbVN0YXRzX3N1YnRyYWN0ID0gKGdlb21TdGF0cykgPT4gewogICAgLy8gY29uc29sZS5sb2coJ2dlb21TdGF0c19zdWJ0cmFjdDonLCBnZW9tU3RhdHMudHJpYW5nbGVzLCB2aXNpYmxlR2VvbVN0YXRzLnRyaWFuZ2xlcykKICAgIHZpc2libGVDb3VudC0tOwogICAgdmlzaWJsZUdlb21TdGF0cy50cmlhbmdsZXMgLT0gZ2VvbVN0YXRzLnRyaWFuZ2xlczsKICAgIHZpc2libGVHZW9tU3RhdHMubGluZXMgLT0gZ2VvbVN0YXRzLmxpbmVzOwogICAgdmlzaWJsZUdlb21TdGF0cy5wb2ludHMgLT0gZ2VvbVN0YXRzLnBvaW50czsKICB9OwoKICBsZXQgY2FtZXJhUG9zOwogIGxldCBjYW1lcmFJbnZPcmk7CiAgbGV0IGlzT3J0aG9ncmFwaGljID0gZmFsc2U7CiAgbGV0IGZydXN0dW1IZWlnaHQgPSAwOwogIGxldCBmcnVzdHVtV2lkdGggPSAwOwogIGxldCBmcnVzdHVtSGFsZkFuZ2xlWCA9IDA7CiAgbGV0IGZydXN0dW1IYWxmQW5nbGVZID0gMDsKICBsZXQgc29saWRBbmdsZUxpbWl0ID0gMC4wMDQ7CgogIGNvbnN0IGN1bGwgPSAoaW5kZXgpID0+IHsKICAgIGlmICghb3V0T2ZGcnVzdHVtW2luZGV4XSkgewogICAgICBvdXRPZkZydXN0dW1baW5kZXhdID0gdHJ1ZTsKICAgICAgZnJ1c3R1bUN1bGxlZENvdW50Kys7CiAgICAgIG5ld2x5Q3VsbGVkLnB1c2goaW5kZXgpOwoKICAgICAgLy8gV2UgY291bGQgYmUgY3VsbGluZyBzb21ldGhpbmcgdGhhdCB3YXMgYWxyZWFkeQogICAgICAvLyBub3QgdmlzaWJsZSBpbiB0aGUgb2NjbHVzaW9uIGJ1ZmZlci4KICAgICAgaWYgKCFlbmFibGVPY2NsdXNpb25DdWxsaW5nIHx8ICFvY2NsdWRlZFtpbmRleF0pIHsKICAgICAgICBnZW9tU3RhdHNfc3VidHJhY3QoZ2VvbUl0ZW1zRGF0YVtpbmRleF0uZ2VvbVN0YXRzKTsKICAgICAgfQogICAgfQogIH07CiAgY29uc3QgdW5DdWxsID0gKGluZGV4KSA9PiB7CiAgICBpZiAob3V0T2ZGcnVzdHVtW2luZGV4XSkgewogICAgICBvdXRPZkZydXN0dW1baW5kZXhdID0gZmFsc2U7CiAgICAgIGZydXN0dW1DdWxsZWRDb3VudC0tOwogICAgICBuZXdseVVuQ3VsbGVkLnB1c2goaW5kZXgpOwoKICAgICAgLy8gT2NjbHVzaW9uIGN1bGxpbmcgY2FuIG9ubHkgZGV0ZXJtaW5lIGlmIHNvbWV0aGluZyBpcyB2aXNpYmxlCiAgICAgIC8vIG1lYW5pbmcgdGhhdCB3ZSBhc3N1bWUgaXQgaXMgbm90LCB1bnRpbCBpdCBzaG93cyB1cCBpbiB0aGUgb2NjbHVzaW9uIGJ1ZmZlci4KICAgICAgLy8gT25jZSBpdCBhcHBlYXJzIGluIHRoZSBvY2NsdXNpb24gYnVmZmVyLCB3ZSBzdGFydCByZW5kZXJpbmcgaXQgYWdhaW4uCiAgICAgIC8vIFNvLCB3aGVuIGFuIGl0ZW0gY29tZXMgYmFjayBpbnRvIHRoZSBmcnVzdHVtLCB3ZSBzdGFydCByZW5kZXJpbmcgaXRzIGJib3guCiAgICAgIC8vIFRoZW4gaWYgdGhlIGJib3ggaXMgc2Vlbiwgd2UgdGhlbiBzdGFydCBzaG93aW5nIGl0LgogICAgICBpZiAoZW5hYmxlT2NjbHVzaW9uQ3VsbGluZyAmJiAhZ2VvbUl0ZW1zRGF0YVtpbmRleF0udHJhbnNwYXJlbnQpIHsKICAgICAgICBvY2NsdWRlZFtpbmRleF0gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGdlb21TdGF0c19hZGQoZ2VvbUl0ZW1zRGF0YVtpbmRleF0uZ2VvbVN0YXRzKTsKICAgICAgfQogICAgfQogIH07CgogIGNvbnN0IGNoZWNrR2VvbUl0ZW0gPSAoZ2VvbUl0ZW1EYXRhKSA9PiB7CiAgICBpZiAoIWdlb21JdGVtRGF0YSB8fCAhY2FtZXJhUG9zKSByZXR1cm4KICAgIGlmICghZ2VvbUl0ZW1EYXRhLnZpc2libGUpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLy8gU29tZSBpdGVtcywgbGlrZSBIYW5kbGVzIGFuZCB0aGUgZ3JpZCwgb3Igb3IgdGhlIFZSIGNvbnRyb2xsZXJzIHRoYXQgc2hvdWxkIG5vdCBiZSBjdWxsZWQuCiAgICBpZiAoIWdlb21JdGVtRGF0YS5jdWxsYWJsZSkgewogICAgICB1bkN1bGwoZ2VvbUl0ZW1EYXRhLmlkKTsKICAgICAgcmV0dXJuCiAgICB9CiAgICBjb25zdCBib3VuZGluZ1JhZGl1cyA9IGdlb21JdGVtRGF0YS5ib3VuZGluZ1JhZGl1czsKCiAgICBpZiAoaXNPcnRob2dyYXBoaWMpIHsKICAgICAgLy8gQ3VsbCB2ZXJ5IHNtYWxsIGl0ZW1zCiAgICAgIC8vIE5vdGU6IHdoZW4gaW4gVlIsIHRoZSBGb1YgYmVjb21lcyB2ZXJ5IHdpZGUgYW5kIHRoZSBwaXhlbAogICAgICAvLyBoZWlnaHQgdmFyaWVzLiBJdCBzZWVtcyBtb3JlIGNvbnNpc3RlbnQgdG8ganVzdCB1c2Ugc29saWRBbmdsZQogICAgICAvLyB3aGljaCBpcyByZXNvbHV0aW9uIGludmFyaWFudC4KICAgICAgY29uc3QgdmhlaWdodCA9IGJvdW5kaW5nUmFkaXVzIC8gZnJ1c3R1bUhlaWdodDsKICAgICAgaWYgKHNvbGlkQW5nbGVMaW1pdCA+IDAgJiYgdmhlaWdodCA8IHNvbGlkQW5nbGVMaW1pdCkgewogICAgICAgIGN1bGwoZ2VvbUl0ZW1EYXRhLmlkKTsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gTm93IHdlIGNoZWNrIGlmIHRoZSBpdGVtIGlzIHdpdGhpbiB0aGUgdmlldyBmcnVzdHVtLgogICAgICAvLyBXZSBuZWVkIHRoZSBzb2xpZCBhbmdsZSBvZiB0aGUgaXRlbSBmb3IgZWFjaCBheGlzIChYICYgWSkKICAgICAgLy8gVGhpcyBpcyBiZWNhdXNlIGF0IHRoZSBjb3JuZXJzIG9mIHRoZSBzY3JlZW4sIHRoZSBvYmplY3QgaXMgc2xpZ2h0bHkKICAgICAgLy8gZnVydGhlciBhd2F5LCBzbyB0aGUgc29saWQgYW5nbGUgY2FsY3VsYXRlZCBhYm92ZSBnZXRzIHNtYWxsZXIuCiAgICAgIC8vIFRoaXMgd2FzIGNhdXNpbmcgaXRlbXMgd2l0aCBiaWcgYm91bmRpbmcgc3BoZXJlcyB0byBiZSBjdWxsZWQgdG9vIGVhcmx5CiAgICAgIC8vIGF0IHRoZSBjb3JuZXIgb2YgdGhlIHNjcmVlbi4KICAgICAgY29uc3QgdmVjID0gdmVjM19zdWJ0cmFjdChnZW9tSXRlbURhdGEucG9zLCBjYW1lcmFQb3MpOwogICAgICBjb25zdCB2aWV3UG9zID0gcXVhdF9yb3RhdGVWZWMzKGNhbWVyYUludk9yaSwgdmVjKTsKICAgICAgaWYgKAogICAgICAgIE1hdGguYWJzKHZpZXdQb3NbMF0pIC0gYm91bmRpbmdSYWRpdXMgPiBmcnVzdHVtV2lkdGggKiAwLjUgfHwKICAgICAgICBNYXRoLmFicyh2aWV3UG9zWzFdKSAtIGJvdW5kaW5nUmFkaXVzID4gZnJ1c3R1bUhlaWdodCAqIDAuNQogICAgICApIHsKICAgICAgICBjdWxsKGdlb21JdGVtRGF0YS5pZCk7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHZlYyA9IHZlYzNfc3VidHJhY3QoZ2VvbUl0ZW1EYXRhLnBvcywgY2FtZXJhUG9zKTsKICAgICAgY29uc3QgZGlzdCA9IHZlYzNfbGVuZ3RoKHZlYyk7CiAgICAgIC8vIHVuQ3VsbCBpdGVtcyBjbG9zZSB0byB0aGUgdmlldy4KICAgICAgaWYgKGRpc3QgPCBib3VuZGluZ1JhZGl1cykgewogICAgICAgIHVuQ3VsbChnZW9tSXRlbURhdGEuaWQpOwogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIC8vIEN1bGwgdmVyeSBzbWFsbCBpdGVtcwogICAgICAvLyBOb3RlOiB3aGVuIGluIFZSLCB0aGUgRm9WIGJlY29tZXMgdmVyeSB3aWRlIGFuZCB0aGUgcGl4ZWwKICAgICAgLy8gaGVpZ2h0IHZhcmllcy4gSXQgc2VlbXMgbW9yZSBjb25zaXN0ZW50IHRvIGp1c3QgdXNlIHNvbGlkQW5nbGUKICAgICAgLy8gd2hpY2ggaXMgcmVzb2x1dGlvbiBpbnZhcmlhbnQuCiAgICAgIGNvbnN0IHNvbGlkQW5nbGUgPSBNYXRoLmFzaW4oYm91bmRpbmdSYWRpdXMgLyBkaXN0KTsKICAgICAgaWYgKHNvbGlkQW5nbGVMaW1pdCA+IDAgJiYgc29saWRBbmdsZSA8IHNvbGlkQW5nbGVMaW1pdCkgewogICAgICAgIGN1bGwoZ2VvbUl0ZW1EYXRhLmlkKTsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gTm93IHdlIGNoZWNrIGlmIHRoZSBpdGVtIGlzIHdpdGhpbiB0aGUgdmlldyBmcnVzdHVtLgogICAgICAvLyBXZSBuZWVkIHRoZSBzb2xpZCBhbmdsZSBvZiB0aGUgaXRlbSBmb3IgZWFjaCBheGlzIChYICYgWSkKICAgICAgLy8gVGhpcyBpcyBiZWNhdXNlIGF0IHRoZSBjb3JuZXJzIG9mIHRoZSBzY3JlZW4sIHRoZSBvYmplY3QgaXMgc2xpZ2h0bHkKICAgICAgLy8gZnVydGhlciBhd2F5LCBzbyB0aGUgc29saWQgYW5nbGUgY2FsY3VsYXRlZCBhYm92ZSBnZXRzIHNtYWxsZXIuCiAgICAgIC8vIFRoaXMgd2FzIGNhdXNpbmcgaXRlbXMgd2l0aCBiaWcgYm91bmRpbmcgc3BoZXJlcyB0byBiZSBjdWxsZWQgdG9vIGVhcmx5CiAgICAgIC8vIGF0IHRoZSBjb3JuZXIgb2YgdGhlIHNjcmVlbi4KICAgICAgY29uc3Qgdmlld1BvcyA9IHF1YXRfcm90YXRlVmVjMyhjYW1lcmFJbnZPcmksIHZlYyk7CiAgICAgIGNvbnN0IHZpZXdWZWNYWiA9IFt2aWV3UG9zWzBdLCB2aWV3UG9zWzJdXTsKICAgICAgY29uc3Qgdmlld1ZlY1laID0gW3ZpZXdQb3NbMV0sIHZpZXdQb3NbMl1dOwogICAgICBjb25zdCBkaXN0WCA9IHZlYzJfbGVuZ3RoKHZpZXdWZWNYWik7CiAgICAgIGNvbnN0IGRpc3RZID0gdmVjMl9sZW5ndGgodmlld1ZlY1laKTsKICAgICAgY29uc3Qgc29saWRBbmdsZVhaID0gTWF0aC5hc2luKGJvdW5kaW5nUmFkaXVzIC8gZGlzdFgpOwogICAgICBjb25zdCBzb2xpZEFuZ2xlWVogPSBNYXRoLmFzaW4oYm91bmRpbmdSYWRpdXMgLyBkaXN0WSk7CiAgICAgIGNvbnN0IHZpZXdWZWNOb3JtWFogPSB2ZWMyX3NjYWxlKHZpZXdWZWNYWiwgMSAvIGRpc3RYKTsKICAgICAgY29uc3Qgdmlld1ZlY05vcm1ZWiA9IHZlYzJfc2NhbGUodmlld1ZlY1laLCAxIC8gZGlzdFkpOwoKICAgICAgbGV0IHZpZXdBbmdsZTsKICAgICAgLy8gSWYgYW4gaXRlbSBpcyBiZWhpbmQgdGhlIHZpZXdlcgogICAgICBpZiAodmlld1Bvc1syXSA+IDApIHsKICAgICAgICB2aWV3QW5nbGUgPSBbCiAgICAgICAgICBNYXRoLlBJIC0gTWF0aC5hYnMoTWF0aC5hc2luKHZpZXdWZWNOb3JtWFpbMF0pKSAtIHNvbGlkQW5nbGVYWiwKICAgICAgICAgIE1hdGguUEkgLSBNYXRoLmFicyhNYXRoLmFzaW4odmlld1ZlY05vcm1ZWlswXSkpIC0gc29saWRBbmdsZVlaLAogICAgICAgIF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmlld0FuZ2xlID0gWwogICAgICAgICAgTWF0aC5hYnMoTWF0aC5hc2luKHZpZXdWZWNOb3JtWFpbMF0pKSAtIHNvbGlkQW5nbGVYWiwKICAgICAgICAgIE1hdGguYWJzKE1hdGguYXNpbih2aWV3VmVjTm9ybVlaWzBdKSkgLSBzb2xpZEFuZ2xlWVosCiAgICAgICAgXTsKICAgICAgfQogICAgICAvLyBjb25zb2xlLmxvZyhnZW9tSXRlbURhdGEuaWQsICdhbmdsZSBUbyBJdGVtOicsIGZydXN0dW1IYWxmQW5nbGVYLCB2aWV3QW5nbGVbMF0sIGZydXN0dW1IYWxmQW5nbGVZLCB2aWV3QW5nbGVbMV0pCiAgICAgIGlmICh2aWV3QW5nbGVbMF0gPiBmcnVzdHVtSGFsZkFuZ2xlWCB8fCB2aWV3QW5nbGVbMV0gPiBmcnVzdHVtSGFsZkFuZ2xlWSkgewogICAgICAgIGN1bGwoZ2VvbUl0ZW1EYXRhLmlkKTsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgfQoKICAgIHVuQ3VsbChnZW9tSXRlbURhdGEuaWQpOwogIH07CgogIGNvbnN0IG9uVmlld1BvcnRDaGFuZ2VkID0gKGRhdGEsIHBvc3RNZXNzYWdlKSA9PiB7CiAgICBpZiAoZGF0YS5pc09ydGhvZ3JhcGhpYykgewogICAgICBpc09ydGhvZ3JhcGhpYyA9IHRydWU7CiAgICAgIGZydXN0dW1IZWlnaHQgPSBkYXRhLmZydXN0dW1IZWlnaHQ7CiAgICAgIGZydXN0dW1XaWR0aCA9IGRhdGEuZnJ1c3R1bVdpZHRoOwogICAgfSBlbHNlIHsKICAgICAgaXNPcnRob2dyYXBoaWMgPSBmYWxzZTsKICAgICAgZnJ1c3R1bUhhbGZBbmdsZVggPSBkYXRhLmZydXN0dW1IYWxmQW5nbGVYOwogICAgICBmcnVzdHVtSGFsZkFuZ2xlWSA9IGRhdGEuZnJ1c3R1bUhhbGZBbmdsZVk7CiAgICB9CgogICAgc29saWRBbmdsZUxpbWl0ID0gZGF0YS5zb2xpZEFuZ2xlTGltaXQ7CiAgICBpZiAoY2FtZXJhUG9zICYmIGNhbWVyYUludk9yaSkgewogICAgICBnZW9tSXRlbXNEYXRhLmZvckVhY2goY2hlY2tHZW9tSXRlbSk7CiAgICAgIG9uRG9uZUZydXN0dW1DdWxsKHBvc3RNZXNzYWdlKTsKICAgIH0KICB9OwoKICBjb25zdCBvblZpZXdDaGFuZ2VkID0gKGRhdGEsIHBvc3RNZXNzYWdlKSA9PiB7CiAgICBjYW1lcmFQb3MgPSBkYXRhLmNhbWVyYVBvczsKICAgIGNhbWVyYUludk9yaSA9IHF1YXRfY29uanVnYXRlKGRhdGEuY2FtZXJhT3JpKTsKICAgIHNvbGlkQW5nbGVMaW1pdCA9IGRhdGEuc29saWRBbmdsZUxpbWl0OwogICAgaWYgKGdlb21JdGVtc0RhdGEubGVuZ3RoID4gMCkgewogICAgICBnZW9tSXRlbXNEYXRhLmZvckVhY2goY2hlY2tHZW9tSXRlbSk7CiAgICAgIG9uRG9uZUZydXN0dW1DdWxsKHBvc3RNZXNzYWdlKTsKICAgIH0KICB9OwoKICBsZXQgaW5GcnVzdHVtRHJhd0lkc0J1ZmZlclBvcHVsYXRlZCA9IGZhbHNlOwogIGNvbnN0IGdlbmVyYXRlSW5GcnVzdHVtSW5kaWNlcyA9ICgpID0+IHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgb3V0T2ZGcnVzdHVtLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICBpZiAoaW5kZXggPiAwICYmICF2YWx1ZSAmJiBnZW9tSXRlbXNEYXRhW2luZGV4XS52aXNpYmxlICYmICFnZW9tSXRlbXNEYXRhW2luZGV4XS50cmFuc3BhcmVudCkgb2Zmc2V0Kys7CiAgICB9KTsKICAgIC8vIENyZWF0ZSBhIGZsb2F0IGFycmF5IHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gaW5zdGFuY2VzCiAgICAvLyBhdHRyaWJ1dGUgdG8gcGFzcyBpbnRvIHRoZSBkcmF3aW5nIG9mIHRoZSBib3VuZGluZyBib3hlcy4KICAgIGNvbnN0IGluRnJ1c3R1bUluZGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KG9mZnNldCk7CiAgICBvZmZzZXQgPSAwOwogICAgb3V0T2ZGcnVzdHVtLmZvckVhY2goKHZhbHVlLCBpbmRleCkgPT4gewogICAgICBpZiAoaW5kZXggPiAwICYmICF2YWx1ZSAmJiBnZW9tSXRlbXNEYXRhW2luZGV4XS52aXNpYmxlICYmICFnZW9tSXRlbXNEYXRhW2luZGV4XS50cmFuc3BhcmVudCkgewogICAgICAgIGluRnJ1c3R1bUluZGljZXNbb2Zmc2V0XSA9IGluZGV4OwogICAgICAgIG9mZnNldCsrOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBpbkZydXN0dW1JbmRpY2VzCiAgfTsKCiAgY29uc3Qgb25Eb25lRnJ1c3R1bUN1bGwgPSAocG9zdE1lc3NhZ2UpID0+IHsKICAgIGlmICghZW5hYmxlT2NjbHVzaW9uQ3VsbGluZykgewogICAgICBjb25zdCBjb3VudEluRnJ1c3R1bSA9IGdlb21JdGVtc0RhdGEubGVuZ3RoIC0gMSAtIGZydXN0dW1DdWxsZWRDb3VudDsKCiAgICAgIHBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiAnQ3VsbFJlc3VsdHMnLAogICAgICAgIG5ld2x5Q3VsbGVkLAogICAgICAgIG5ld2x5VW5DdWxsZWQsCiAgICAgICAgdmlzaWJsZTogY291bnRJbkZydXN0dW0sCiAgICAgICAgdG90YWw6IGdlb21JdGVtc0RhdGEubGVuZ3RoIC0gMSwKICAgICAgICB2aXNpYmxlR2VvbVN0YXRzLAogICAgICAgIHRvdGFsR2VvbVN0YXRzLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdGcnVzdHVtQ3VsbFJlc3VsdHM6JywgJ25ld2x5Q3VsbGVkOicsIG5ld2x5Q3VsbGVkLCAnbmV3bHlVbkN1bGxlZDonLCBuZXdseVVuQ3VsbGVkLCBvdXRPZkZydXN0dW0pCiAgICAgIC8vIGNvbnN0IGNvdW50SW5GcnVzdHVtID0gZ2VvbUl0ZW1zRGF0YS5sZW5ndGggLSAxIC0gZnJ1c3R1bUN1bGxlZENvdW50CgogICAgICAvLyBpZiAoY291bnRJbkZydXN0dW0gPiAzMDApIHsKICAgICAgLy8gICBjb25zb2xlLmxvZygnY291bnRJbkZydXN0dW06JywgY291bnRJbkZydXN0dW0pCiAgICAgIC8vIH0KICAgICAgaWYgKG5ld2x5Q3VsbGVkLmxlbmd0aCA+IDAgfHwgbmV3bHlVbkN1bGxlZC5sZW5ndGggPiAwIHx8ICFpbkZydXN0dW1EcmF3SWRzQnVmZmVyUG9wdWxhdGVkKSB7CiAgICAgICAgY29uc3QgaW5GcnVzdHVtSW5kaWNlcyA9IGdlbmVyYXRlSW5GcnVzdHVtSW5kaWNlcygpOwoKICAgICAgICAvLyBXaGVuIG9jY2x1c2lvbiBjdWxsaW5nIGlzIG9uLCB3ZSBvbmx5IHVuY3VsbCBpdGVtcyBhZnRlciB0aGV5CiAgICAgICAgLy8gYXJlIGRldGVjdGVkIGluIHRoZSBvY2NsdXNpb24gYnVmZmVyLiBUcmFuc3BhcmVudCBpdGVtcyBhcmUgbm90CiAgICAgICAgLy8gcmVuZGVyZWQgdG8gdGhlIG9jY2x1c2lvbiBidWZmZXIsIHNvIG11c3QgYmUgdW5jdWxsZWQgaW1tZWRpYXRlbHkuCiAgICAgICAgY29uc3QgbmV3bHlVbkN1bGxlZF90cmFuc3BhcmVudCA9IFtdOwogICAgICAgIG5ld2x5VW5DdWxsZWQuZm9yRWFjaCgoaW5kZXgpID0+IHsKICAgICAgICAgIGlmIChpbmRleCA+IDAgJiYgZ2VvbUl0ZW1zRGF0YVtpbmRleF0gJiYgZ2VvbUl0ZW1zRGF0YVtpbmRleF0udmlzaWJsZSAmJiBnZW9tSXRlbXNEYXRhW2luZGV4XS50cmFuc3BhcmVudCkgewogICAgICAgICAgICBuZXdseVVuQ3VsbGVkX3RyYW5zcGFyZW50LnB1c2goaW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHBvc3RNZXNzYWdlKAogICAgICAgICAgewogICAgICAgICAgICB0eXBlOiAnSW5GcnVzdHVtSW5kaWNlcycsCiAgICAgICAgICAgIG5ld2x5Q3VsbGVkLAogICAgICAgICAgICBuZXdseVVuQ3VsbGVkOiBuZXdseVVuQ3VsbGVkX3RyYW5zcGFyZW50LAogICAgICAgICAgICAvKiBXaGVuIG9jY2x1c2lvbiBjdWxsaW5nIGlzIHJ1bm5pbmcsd2Ugb25seSBjb25zaWRlcgogICAgICAgICAgICBjdWxsaW5nIGNvbXBsZXRlZCBhZnRlciB0aGUgb2NjbHVzaW9uIGN1bGxpbmcgaXMgZG9uZS4KICAgICAgICAgICAgdmlzaWJsZTogdmlzaWJsZUNvdW50LAogICAgICAgICAgICB0b3RhbDogZ2VvbUl0ZW1zRGF0YS5sZW5ndGggLSAxLAogICAgICAgICAgICB2aXNpYmxlR2VvbVN0YXRzLAogICAgICAgICAgICB0b3RhbEdlb21TdGF0cywqLwogICAgICAgICAgICBpbkZydXN0dW1JbmRpY2VzLAogICAgICAgICAgfSwKICAgICAgICAgIFtpbkZydXN0dW1JbmRpY2VzLmJ1ZmZlcl0KICAgICAgICApOwogICAgICAgIGluRnJ1c3R1bURyYXdJZHNCdWZmZXJQb3B1bGF0ZWQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdGU6IHRoZSBpbkZydXN0dW1EcmF3SWRzQnVmZmVyIGlzIGFscmVhZHkgdXAgdG8gZGF0ZSB3ZSBjYW4gc2tpcCB0aGlzLgogICAgICAgIHBvc3RNZXNzYWdlKHsKICAgICAgICAgIHR5cGU6ICdJbkZydXN0dW1JbmRpY2VzJywKICAgICAgICAgIG5ld2x5Q3VsbGVkOiBbXSwKICAgICAgICAgIG5ld2x5VW5DdWxsZWQ6IFtdLAogICAgICAgICAgdmlzaWJsZTogdmlzaWJsZUNvdW50LAogICAgICAgICAgdG90YWw6IGdlb21JdGVtc0RhdGEubGVuZ3RoIC0gMSwKICAgICAgICAgIHZpc2libGVHZW9tU3RhdHMsCiAgICAgICAgICB0b3RhbEdlb21TdGF0cywKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIG5ld2x5Q3VsbGVkID0gW107CiAgICBuZXdseVVuQ3VsbGVkID0gW107CiAgfTsKCiAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAvLyBPY2NsdXNpb24gQ3VsbGluZyBkYXRhLgogIGNvbnN0IG9jY2x1ZGVkID0gW107CiAgY29uc3QgcHJvY2Vzc09jY2x1c2lvbkRhdGEgPSAoZGF0YSkgPT4gewogICAgY29uc3QgdmlzaWJsZUl0ZW1zID0gZGF0YS52aXNpYmxlSXRlbXM7CgogICAgY29uc3QgbmV3bHlDdWxsZWQgPSBbXTsKICAgIGNvbnN0IG5ld2x5VW5DdWxsZWQgPSBbXTsKICAgIHZpc2libGVJdGVtcy5zb21lKCh2YWx1ZSwgaW5kZXgpID0+IHsKICAgICAgaWYgKGluZGV4ID09IDApIHJldHVybiBmYWxzZQogICAgICBpZiAoaW5kZXggPj0gZ2VvbUl0ZW1zRGF0YS5sZW5ndGgpIHJldHVybiB0cnVlCgogICAgICBjb25zdCBnZW9tSXRlbURhdGEgPSBnZW9tSXRlbXNEYXRhW2luZGV4XTsKICAgICAgaWYgKCFnZW9tSXRlbURhdGEgfHwgIWdlb21JdGVtRGF0YS5jdWxsYWJsZSB8fCAhZ2VvbUl0ZW1EYXRhLnZpc2libGUgfHwgZ2VvbUl0ZW1EYXRhLnRyYW5zcGFyZW50KSByZXR1cm4gZmFsc2UKCiAgICAgIGlmICghb3V0T2ZGcnVzdHVtW2luZGV4XSkgewogICAgICAgIGlmICh2YWx1ZSA9PSAwKSB7CiAgICAgICAgICAvLyBOb3QgdHJhbnNwYXJlbnQgb2JqZWN0IGNhbiBub3QgYmUgb2NjbHVzaW9uIGN1bGxlZCwgYmVjYXVzZSB3ZSBkbyBub3QgcmVuZGVyIHRoZW0gdG8gdGhlCiAgICAgICAgICAvLyBvY2NsdXNpb24gYnVmZmVyLiBUaGlzIG1lYW5zIHRoZXkgY2Fubm90IG9jY2x1ZGUsIG9yIGJlIGNvbnNpZGVyZWQgb2NjbHVkZWQuCiAgICAgICAgICBpZiAoIW9jY2x1ZGVkW2luZGV4XSkgewogICAgICAgICAgICBvY2NsdWRlZFtpbmRleF0gPSB0cnVlOwogICAgICAgICAgICBuZXdseUN1bGxlZC5wdXNoKGluZGV4KTsKICAgICAgICAgICAgZ2VvbVN0YXRzX3N1YnRyYWN0KGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAob2NjbHVkZWRbaW5kZXhdKSB7CiAgICAgICAgICAgIG9jY2x1ZGVkW2luZGV4XSA9IGZhbHNlOwogICAgICAgICAgICBuZXdseVVuQ3VsbGVkLnB1c2goaW5kZXgpOwogICAgICAgICAgICBnZW9tU3RhdHNfYWRkKGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICAvLyBOb3RlOiBldmVuIGlmIG9jY2x1c2lvbiBjdWxsaW5nIGRpZCBudCBmaWx0ZXIgb3V0IGFueSBtb3JlIGl0ZW1zCiAgICAvLyB3ZSBtdXN0IGVtaXQgdGhpcyBtZXNzYWdlIHRvIHRoZSBtYWlucyB3b3JrZXIgc28gaXQga25vd3MgdGhhdCBjdWxsaW5nIGlzIGNvbXBsZXRlZC4KICAgIHBvc3RNZXNzYWdlKHsKICAgICAgdHlwZTogJ0N1bGxSZXN1bHRzJywKICAgICAgbmV3bHlDdWxsZWQsCiAgICAgIG5ld2x5VW5DdWxsZWQsCiAgICAgIHZpc2libGU6IHZpc2libGVDb3VudCwKICAgICAgdG90YWw6IGdlb21JdGVtc0RhdGEubGVuZ3RoIC0gMSwKICAgICAgdmlzaWJsZUdlb21TdGF0cywKICAgICAgdG90YWxHZW9tU3RhdHMsCiAgICB9KTsKICB9OwoKICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogIC8vIE1lc3NhZ2luZwogIGNvbnN0IGhhbmRsZU1lc3NhZ2UgPSAoZGF0YSwgcG9zdE1lc3NhZ2UpID0+IHsKICAgIGlmIChkYXRhLnR5cGUgPT0gJ0luaXQnKSB7CiAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsaXplZCBDdWxsaW5nIFdvcmtlcicpOwogICAgICBlbmFibGVPY2NsdXNpb25DdWxsaW5nID0gZGF0YS5lbmFibGVPY2NsdXNpb25DdWxsaW5nOwogICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT0gJ1ZpZXdwb3J0Q2hhbmdlZCcpIHsKICAgICAgb25WaWV3UG9ydENoYW5nZWQoZGF0YSwgcG9zdE1lc3NhZ2UpOwogICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT0gJ1ZpZXdDaGFuZ2VkJykgewogICAgICBvblZpZXdDaGFuZ2VkKGRhdGEsIHBvc3RNZXNzYWdlKTsKICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09ICdVcGRhdGVHZW9tSXRlbXMnKSB7CiAgICAgIGRhdGEucmVtb3ZlZEl0ZW1JbmRpY2VzLmZvckVhY2goKGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgZ2VvbUl0ZW1EYXRhID0gZ2VvbUl0ZW1zRGF0YVtpbmRleF07CiAgICAgICAgaWYgKGdlb21JdGVtRGF0YSAmJiBnZW9tSXRlbURhdGEudmlzaWJsZSkgewogICAgICAgICAgZ2VvbVN0YXRzX3N1YnRyYWN0VG90YWwoZ2VvbUl0ZW1EYXRhLmdlb21TdGF0cyk7CiAgICAgICAgICBpZiAoIWVuYWJsZU9jY2x1c2lvbkN1bGxpbmcgfHwgIW9jY2x1ZGVkW2luZGV4XSkgewogICAgICAgICAgICBnZW9tU3RhdHNfc3VidHJhY3QoZ2VvbUl0ZW1EYXRhLmdlb21TdGF0cyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGdlb21JdGVtc0RhdGFbaW5kZXhdID0gbnVsbDsKICAgICAgICBvdXRPZkZydXN0dW1baW5kZXhdID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIGRhdGEuZ2VvbUl0ZW1zLmZvckVhY2goKGdlb21JdGVtRGF0YSkgPT4gewogICAgICAgIGNvbnN0IGluZGV4ID0gZ2VvbUl0ZW1EYXRhLmlkOwogICAgICAgIC8vIE5ldyBnZW9tcyBkZWZhdWx0IHRvIGJlaW5nIHVuLWN1bGxlZAogICAgICAgIC8vIEV4aXN0aW5nIGdlb21zIHRoYXQgbWF5IGJlIGNoYW5naW5nIHN0YXRlLCBsaWtlIGNoYW5naW5nCiAgICAgICAgLy8gdmlzaWJpbGl0eSBvciB0cmFuc2Zvcm1hdGlvbnMgc2hvdWxkIHNpbXBseSB1cGRhdGUuCiAgICAgICAgaWYgKCFnZW9tSXRlbXNEYXRhW2luZGV4XSkgewogICAgICAgICAgb3V0T2ZGcnVzdHVtW2luZGV4XSA9IGZhbHNlOwogICAgICAgICAgaWYgKGdlb21JdGVtRGF0YS52aXNpYmxlKSB7CiAgICAgICAgICAgIGdlb21TdGF0c19hZGRUb3RhbChnZW9tSXRlbURhdGEuZ2VvbVN0YXRzKTsKICAgICAgICAgICAgZ2VvbVN0YXRzX2FkZChnZW9tSXRlbURhdGEuZ2VvbVN0YXRzKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gYXJlIGVpdGhlciBhZGRpbmcgYSBuZXcgaXRlbSwgb3IgdW5oaWRpbmcgYW4gZXhpc3RpbmcgaXRlbS4KICAgICAgICAgIGNvbnN0IGJlY29taW5nVmlzaWJsZSA9ICFnZW9tSXRlbXNEYXRhW2luZGV4XS52aXNpYmxlICYmIGdlb21JdGVtRGF0YS52aXNpYmxlOwogICAgICAgICAgY29uc3QgYmVjb21pbmdJblZpc2libGUgPSBnZW9tSXRlbXNEYXRhW2luZGV4XS52aXNpYmxlICYmICFnZW9tSXRlbURhdGEudmlzaWJsZTsKICAgICAgICAgIGlmIChiZWNvbWluZ1Zpc2libGUpIHsKICAgICAgICAgICAgZ2VvbVN0YXRzX2FkZFRvdGFsKGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgICBvdXRPZkZydXN0dW1baW5kZXhdID0gdHJ1ZTsKICAgICAgICAgICAgb2NjbHVkZWRbaW5kZXhdID0gZmFsc2U7CiAgICAgICAgICAgIC8vIGlmICghb3V0T2ZGcnVzdHVtW2luZGV4XSAmJiAhb2NjbHVkZWRbaW5kZXhdKSB7CiAgICAgICAgICAgIC8vICAgZ2VvbVN0YXRzX2FkZChnZW9tSXRlbURhdGEuZ2VvbVN0YXRzKQogICAgICAgICAgICAvLyB9CiAgICAgICAgICB9IGVsc2UgaWYgKGJlY29taW5nSW5WaXNpYmxlKSB7CiAgICAgICAgICAgIGdlb21TdGF0c19zdWJ0cmFjdFRvdGFsKGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgICBpZiAoIW91dE9mRnJ1c3R1bVtpbmRleF0gJiYgKCFlbmFibGVPY2NsdXNpb25DdWxsaW5nIHx8ICFvY2NsdWRlZFtpbmRleF0pKSB7CiAgICAgICAgICAgICAgZ2VvbVN0YXRzX3N1YnRyYWN0KGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dE9mRnJ1c3R1bVtpbmRleF0gPSB0cnVlOwogICAgICAgICAgICBvY2NsdWRlZFtpbmRleF0gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGJlY29taW5nVHJhbnNwYXJlbnQgPSAhZ2VvbUl0ZW1zRGF0YVtpbmRleF0udHJhbnNwYXJlbnQgJiYgZ2VvbUl0ZW1EYXRhLnRyYW5zcGFyZW50OwogICAgICAgICAgICBjb25zdCBiZWNvbWluZ09wYXF1ZSA9IGdlb21JdGVtc0RhdGFbaW5kZXhdLnRyYW5zcGFyZW50ICYmICFnZW9tSXRlbURhdGEudHJhbnNwYXJlbnQ7CiAgICAgICAgICAgIGlmIChiZWNvbWluZ1RyYW5zcGFyZW50KSB7CiAgICAgICAgICAgICAgaWYgKGVuYWJsZU9jY2x1c2lvbkN1bGxpbmcgJiYgIW91dE9mRnJ1c3R1bVtpbmRleF0gJiYgb2NjbHVkZWRbaW5kZXhdKSB7CiAgICAgICAgICAgICAgICAvLyBJdGVtcyBiZWNvbWluZyB0cmFuc3BhcmVudCBtdXN0IGJlIHVuY3VsbGVkIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAgICAgbmV3bHlVbkN1bGxlZC5wdXNoKGluZGV4KTsKICAgICAgICAgICAgICAgIGdlb21TdGF0c19hZGQoZ2VvbUl0ZW1EYXRhLmdlb21TdGF0cyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGJlY29taW5nT3BhcXVlKSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0JlY29taW5nIG9wYXF1ZTonLCBpbmRleCkKICAgICAgICAgICAgICAvLyBJdGVtcyBiZWNvbWluZyB0cmFuc3BhcmVudCBtdXN0IGJlIHVuY3VsbGVkIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAgIC8vIE9jY2x1c2lvbiBjdWxsaW5nIGNhbiBvbmx5IGRldGVybWluZSBpZiBzb21ldGhpbmcgaXMgdmlzaWJsZQogICAgICAgICAgICAgIC8vIG1lYW5pbmcgdGhhdCB3ZSBhc3N1bWUgaXQgaXMgbm90LCB1bnRpbCBpdCBzaG93cyB1cCBpbiB0aGUgb2NjbHVzaW9uIGJ1ZmZlci4KICAgICAgICAgICAgICAvLyBPbmNlIGl0IGFwcGVhcnMgaW4gdGhlIG9jY2x1c2lvbiBidWZmZXIsIHdlIHN0YXJ0IHJlbmRlcmluZyBpdCBhZ2Fpbi4KICAgICAgICAgICAgICAvLyBTbywgd2hlbiBhbiBpdGVtIGNvbWVzIGJhY2sgaW50byB0aGUgZnJ1c3R1bSwgd2Ugc3RhcnQgcmVuZGVyaW5nIGl0cyBiYm94LgogICAgICAgICAgICAgIC8vIFRoZW4gaWYgdGhlIGJib3ggaXMgc2Vlbiwgd2UgdGhlbiBzdGFydCBzaG93aW5nIGl0LgogICAgICAgICAgICAgIGlmIChlbmFibGVPY2NsdXNpb25DdWxsaW5nICYmICFvdXRPZkZydXN0dW1baW5kZXhdKSB7CiAgICAgICAgICAgICAgICBvY2NsdWRlZFtpbmRleF0gPSB0cnVlOwogICAgICAgICAgICAgICAgZ2VvbVN0YXRzX3N1YnRyYWN0KGdlb21JdGVtRGF0YS5nZW9tU3RhdHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBnZW9tSXRlbXNEYXRhW2luZGV4XSA9IGdlb21JdGVtRGF0YTsKICAgICAgICBjaGVja0dlb21JdGVtKGdlb21JdGVtc0RhdGFbaW5kZXhdKTsKICAgICAgfSk7CiAgICAgIGluRnJ1c3R1bURyYXdJZHNCdWZmZXJQb3B1bGF0ZWQgPSBmYWxzZTsKICAgICAgb25Eb25lRnJ1c3R1bUN1bGwocG9zdE1lc3NhZ2UpOwogICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT0gJ09jY2x1c2lvbkRhdGEnKSB7CiAgICAgIHByb2Nlc3NPY2NsdXNpb25EYXRhKGRhdGEpOwogICAgfQogIH07CgogIHNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBoYW5kbGVNZXNzYWdlKGV2ZW50LmRhdGEsIHNlbGYucG9zdE1lc3NhZ2UpOwogIH07CgogIGV4cG9ydHMuaGFuZGxlTWVzc2FnZSA9IGhhbmRsZU1lc3NhZ2U7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7CgogIHJldHVybiBleHBvcnRzOwoKfSkoe30pOwoK",null,!1);function ee(A,g,I,C,i,e=0,t=0){return mA(this,void 0,void 0,(function*(){const B=A.fenceSync(A.SYNC_GPU_COMMANDS_COMPLETE,0);return A.flush(),yield function(A,g,I,C){return new Promise(((i,e)=>{!function t(){const B=A.clientWaitSync(g,I,0);B!=A.WAIT_FAILED?B!=A.TIMEOUT_EXPIRED?i():setTimeout(t,C):e()}()}))}(A,B,0,10),A.deleteSync(B),A.bindBuffer(g,I),A.getBufferSubData(g,C,i,e,t),A.bindBuffer(g,null),i}))}class te extends Yg{constructor(){super(),this.setNumVertices(8);const A=this.getVertexAttribute("positions");A.getValueRef(0).set(.5,-.5,.5),A.getValueRef(1).set(.5,.5,.5),A.getValueRef(2).set(-.5,.5,.5),A.getValueRef(3).set(-.5,-.5,.5),A.getValueRef(4).set(.5,-.5,-.5),A.getValueRef(5).set(.5,.5,-.5),A.getValueRef(6).set(-.5,.5,-.5),A.getValueRef(7).set(-.5,-.5,-.5),this.setNumSegments(34),this.setSegmentVertexIndices(0,0,1),this.setSegmentVertexIndices(1,0,2),this.setSegmentVertexIndices(2,0,3),this.setSegmentVertexIndices(3,0,4),this.setSegmentVertexIndices(4,0,5),this.setSegmentVertexIndices(5,0,6),this.setSegmentVertexIndices(6,0,7),this.setSegmentVertexIndices(7,1,0),this.setSegmentVertexIndices(8,1,2),this.setSegmentVertexIndices(9,1,3),this.setSegmentVertexIndices(10,1,4),this.setSegmentVertexIndices(11,1,5),this.setSegmentVertexIndices(12,1,6),this.setSegmentVertexIndices(13,1,7),this.setSegmentVertexIndices(14,2,0),this.setSegmentVertexIndices(15,2,1),this.setSegmentVertexIndices(16,2,3),this.setSegmentVertexIndices(17,2,4),this.setSegmentVertexIndices(18,2,5),this.setSegmentVertexIndices(19,2,6),this.setSegmentVertexIndices(20,2,7),this.setSegmentVertexIndices(21,3,1),this.setSegmentVertexIndices(22,3,2),this.setSegmentVertexIndices(23,3,0),this.setSegmentVertexIndices(24,3,4),this.setSegmentVertexIndices(25,3,5),this.setSegmentVertexIndices(26,3,6),this.setSegmentVertexIndices(27,3,7),this.setSegmentVertexIndices(28,4,5),this.setSegmentVertexIndices(29,4,6),this.setSegmentVertexIndices(30,4,7),this.setSegmentVertexIndices(31,5,6),this.setSegmentVertexIndices(32,5,7),this.setSegmentVertexIndices(33,6,7)}}class Be extends V{constructor(A,g){var I;super(),this.glGeomItems=[null],this.glGeomItemEventHandlers=[],this.glGeomItemsMap={},this.glGeomItemsIndexFreeList=[],this.dirtyItemIndices=[],this.dirtyWorkerItemIndices=new Set,this.removedItemIndices=[],this.glGeomItemsTexture=null,this.xrPresenting=!1,this.xrFovY=0,this.xrProjectionMatrix=new h,this.debugOcclusionBuffer=!1,this.inFrustumIndicesCount=0,this.drawIdsBufferDirty=!1,this.timer_query_ext=null,this.renderer=A,this.enableFrustumCulling=g.enableFrustumCulling||g.enableOcclusionCulling;const C=this.renderer.gl;this.enableOcclusionCulling=g.enableOcclusionCulling&&"webgl2"==C.name,this.debugOcclusionBuffer=null!==(I=g.debugOcclusionBuffer)&&void 0!==I&&I,this.enableFrustumCulling&&this.setupCullingWorker(A)}setupCullingWorker(A){this.worker=new ie,this.worker.postMessage({type:"Init",enableOcclusionCulling:this.enableOcclusionCulling});let g=!0;this.worker.onmessage=A=>{"InFrustumIndices"==A.data.type?this.enableOcclusionCulling?(A.data.newlyCulled&&this.applyCullResults(A.data),this.calculateOcclusionCulling(A.data.inFrustumIndices)):(this.applyCullResults(A.data),this.emitCullingUpdateData(A.data),g=!0):"CullResults"==A.data.type?(this.applyCullResults(A.data),this.emitCullingUpdateData(A.data),g=!0):"Done"==A.data.type&&this.renderer.emit("CullingUpdated"),g=!0};const I=()=>{const g=A.getViewport(),I=A.getViewport().getCamera(),C=g.getWidth()/g.getHeight();if(I.isOrthographic()){const g=I.getFrustumHeight(),i=g*C;this.worker.postMessage({type:"ViewportChanged",frustumHeight:g,frustumWidth:i,isOrthographic:!0,solidAngleLimit:A.solidAngleLimit})}else{const g=.5*I.getFov(),i=Math.atan(Math.tan(g)*C);this.worker.postMessage({type:"ViewportChanged",frustumHalfAngleX:i,frustumHalfAngleY:g,isOrthographic:!1,solidAngleLimit:A.solidAngleLimit})}};A.on("resized",I);const C=A.getViewport().getCamera();C.on("projectionParamChanged",(A=>{C.isOrthographic()&&I()})),I(),A.once("xrViewportSetup",(g=>{this.xrViewport=g.xrViewport;const C=g.xrViewport;C.on("presentingChanged",(g=>{if(this.xrPresenting=g.state,g.state){e=10;const g=Math.PI/180;let I=62*g,i=50*g;if("Vive"===C.getHMDName())I*=.6,i*=.6;else I*=.5,i*=.5;this.xrFovY=2*I;const t=1.24,B=C.depthRange[0],o=C.depthRange[1];this.xrProjectionMatrix.setPerspectiveMatrix(this.xrFovY,t,B,o),this.worker.postMessage({type:"ViewportChanged",frustumHalfAngleX:i,frustumHalfAngleY:I,isOrthographic:!1,solidAngleLimit:A.solidAngleLimit})}else e=5,I(),t()}))}));let i=0,e=5;A.on("viewChanged",(I=>{if(g){if(i%e==0){g=!1;const C=I.viewXfo.tr,i=I.viewXfo.ori;this.worker.postMessage({type:"ViewChanged",cameraPos:C.asArray(),cameraOri:i.asArray(),solidAngleLimit:A.solidAngleLimit})}i++}}));const t=()=>{const g=A.getViewport().getCamera().globalXfoParam.value,I=g.tr,C=g.ori;this.worker.postMessage({type:"ViewChanged",cameraPos:I.asArray(),cameraOri:C.asArray(),solidAngleLimit:A.solidAngleLimit})};if(A.getViewport().getCamera().on("movementFinished",t),t(),this.enableOcclusionCulling){const A=this.renderer.gl;this.timer_query_ext=A.getExtension("EXT_disjoint_timer_query_webgl2");let g=1/window.devicePixelRatio;const I=Math.ceil(this.renderer.getWidth()*g),C=Math.ceil(this.renderer.getHeight()*g);this.occlusionDataBuffer=new LC(A,{type:A.FLOAT,format:A.RGBA,minFilter:A.NEAREST,magFilter:A.NEAREST,width:I,height:C,depthType:A.UNSIGNED_SHORT,depthFormat:A.DEPTH_COMPONENT,depthInternalFormat:A.DEPTH_COMPONENT16}),this.renderer.on("resized",(A=>{this.xrPresenting||this.occlusionDataBuffer.resize(Math.ceil(A.width*g),Math.ceil(A.height*g))})),this.reductionDataBuffer=new LC(A,{type:A.UNSIGNED_BYTE,internalFormat:A.R8,format:A.RED,minFilter:A.NEAREST,magFilter:A.NEAREST,width:1,height:1,depthType:A.UNSIGNED_SHORT,depthFormat:A.DEPTH_COMPONENT,depthInternalFormat:A.DEPTH_COMPONENT16}),this.bbox=new ji(A,new te),this.reductionShader=new Ie(A),this.boundingBoxShader=new Ce(A),this.boundingBoxShader.compileForTarget("GLGeomItemLibrary",{directives:this.renderer.directives}),this.inFrustumIndicesCount=0}}applyCullResults(A){A.newlyCulled&&A.newlyCulled.forEach((A=>{this.glGeomItems[A]&&this.glGeomItems[A].setCulled(!0)})),A.newlyUnCulled&&A.newlyUnCulled.forEach((A=>{this.glGeomItems[A]&&this.glGeomItems[A].setCulled(!1)})),this.renderer.requestRedraw()}emitCullingUpdateData(A){var g,I;this.renderer.emit("CullingUpdated",{culled:null===(g=A.newlyCulled)||void 0===g?void 0:g.length,unCulled:null===(I=A.newlyUnCulled)||void 0===I?void 0:I.length,visible:A.visible,total:A.total,visibleGeomStats:A.visibleGeomStats,totalGeomStats:A.totalGeomStats})}updateCulledDrawIDsBuffer(A){const g=this.renderer.gl;if(!g.floatTexturesSupported)return void(this.drawIdsBufferDirty=!1);this.inFrustumDrawIdsBuffer&&this.inFrustumIndicesCount!=A.length&&(g.deleteBuffer(this.inFrustumDrawIdsBuffer),this.inFrustumDrawIdsBuffer=null),this.inFrustumDrawIdsBuffer||(this.inFrustumDrawIdsBuffer=g.createBuffer(),g.bindBuffer(g.ARRAY_BUFFER,this.inFrustumDrawIdsBuffer)),g.bindBuffer(g.ARRAY_BUFFER,this.inFrustumDrawIdsBuffer),g.bufferData(g.ARRAY_BUFFER,A,g.STATIC_DRAW),this.inFrustumIndicesCount=A.length,this.drawIdsBufferDirty=!1;const I=Math.max(4,r.nextPow2(Math.round(Math.sqrt(this.glGeomItems.length)+.5)));this.reductionDataBuffer.width!=I&&(this.reductionDataBuffer.resize(I,I),this.reductionDataArray=new Uint8Array(I*I))}calculateOcclusionCulling(A){if(A&&A.length>0&&this.updateCulledDrawIDsBuffer(A),0==this.inFrustumIndicesCount)return void this.worker.postMessage({type:"OcclusionData",visibleItems:[]});const g=this.renderer.gl,I=new qC(g);this.renderer.bindGLBaseRenderer(I),I.directives=[...this.renderer.directives,"#define DRAW_GEOMDATA"],I.shaderopts.directives=I.directives,I.floatGeomBuffer=!0,I.occlusionCulling=1,this.xrPresenting?(this.xrViewport.initCullingRenderState(I),I.viewports[0].fovY=this.xrFovY,I.viewports[0].projectionMatrix=this.xrProjectionMatrix):this.renderer.getViewport().initRenderState(I);const C=this.occlusionDataBuffer.width*this.occlusionDataBuffer.height,i=this.timer_query_ext,e=(A,I,e)=>{this.reductionDataBuffer.bindForWriting(A,I),I||(g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.SRC_COLOR,g.DST_COLOR)),this.reductionShader.bind(A);const{geomDataTexture:t,reductionTextureWidth:B}=A.unifs;t&&this.occlusionDataBuffer.bindToUniform(A,t),B&&g.uniform1i(B.location,this.reductionDataBuffer.width),i&&g.beginQuery(i.TIME_ELAPSED_EXT,e),g.drawArrays(g.POINTS,0,C),i&&g.endQuery(i.TIME_ELAPSED_EXT),I||g.disable(g.BLEND),this.reductionDataBuffer.unbindForWriting(A)};let t,B,o,s;i&&(t=g.createQuery(),g.beginQuery(i.TIME_ELAPSED_EXT,t)),(A=>{this.occlusionDataBuffer.bindForWriting(A,!0),A.glDisable(g.BLEND),A.glDisable(g.CULL_FACE),A.glEnable(g.DEPTH_TEST),g.depthFunc(g.LESS),g.depthMask(!0);this.renderer.getPass(0).drawGeomData(A);this.renderer.getPass(1).drawGeomData(A),this.occlusionDataBuffer.unbindForWriting(A)})(I),i&&g.endQuery(i.TIME_ELAPSED_EXT),i&&(B=g.createQuery()),e(I,!0,B),i&&(o=g.createQuery(),g.beginQuery(i.TIME_ELAPSED_EXT,o)),(()=>{this.occlusionDataBuffer.bindForWriting(I,!1),this.debugOcclusionBuffer||(g.colorMask(!0,!0,!0,!0),g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT)),this.boundingBoxShader.bind(I,"GLGeomItemLibrary"),this.bbox.bind(I);const{instancesTexture:A,instancesTextureSize:C,instancedDraw:i,reductionDataTexture:e,occlusionCulling:t}=I.unifs;this.glGeomItemsTexture.bindToUniform(I,A),g.uniform1i(C.location,this.glGeomItemsTexture.width),g.uniform1i(i.location,1),g.uniform1i(t.location,1),this.reductionDataBuffer.bindColorTexture(I,e);const B=I.attrs.instancedIds.location;g.enableVertexAttribArray(B),g.bindBuffer(g.ARRAY_BUFFER,this.inFrustumDrawIdsBuffer),g.vertexAttribPointer(B,1,g.FLOAT,!1,4,0),g.vertexAttribDivisor(B,1),I.bindViewports(I.unifs,(()=>{this.bbox.drawInstanced(I,this.inFrustumIndicesCount)})),this.occlusionDataBuffer.unbindForWriting(I)})(),i&&g.endQuery(i.TIME_ELAPSED_EXT),i&&(s=g.createQuery()),e(I,!1,s);const a={numReductionPoints:C},l=(A,I)=>{const C=g.getQueryParameter(I,g.QUERY_RESULT_AVAILABLE),e=g.getParameter(i.GPU_DISJOINT_EXT);if(C&&!e){const C=g.getQueryParameter(I,g.QUERY_RESULT);a[A]=C/1e6,g.deleteQuery(I)}},n=this.reductionDataBuffer.width,d=this.reductionDataBuffer.height,h=g.RED,c=g.UNSIGNED_BYTE;this.reductionDataBuffer.bindForReading(),function(A,g,I,C,i,e,t,B){return mA(this,void 0,void 0,(function*(){const o=A.createBuffer();return A.bindBuffer(A.PIXEL_PACK_BUFFER,o),A.bufferData(A.PIXEL_PACK_BUFFER,B.byteLength,A.STREAM_READ),A.readPixels(g,I,C,i,e,t,0),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),yield ee(A,A.PIXEL_PACK_BUFFER,o,0,B),A.deleteBuffer(o),B}))}(g,0,0,n,d,h,c,this.reductionDataArray).then((()=>{this.reductionDataBuffer.unbindForReading(),i&&(l("queryDrawScene",t),l("queryDrawCulledBBoxes",o),l("queryReduceSceneGeoms",B),l("queryReduceBBoxes",s),this.renderer.emit("occlusionCullingProfilingData",a)),this.worker.postMessage({type:"OcclusionData",visibleItems:this.reductionDataArray})}))}addGeomItem(A){let g=this.glGeomItemsMap[A.getId()];if(null!=g)return this.glGeomItems[g];performance.now();const I=A.materialParam;let C=I.value,i=-1;i=this.renderer.glMaterialLibrary.addMaterial(C);const e=()=>{this.renderer.glMaterialLibrary.removeMaterial(C),C=I.value,n.materialId=this.renderer.glMaterialLibrary.addMaterial(C),h(),d()};I.on("valueChanged",e);const t=A.geomParam;let B=t.value;const o=this.renderer.glGeomLibrary.addGeom(B),s=()=>{this.renderer.glGeomLibrary.removeGeom(B),B=t.value,n.geomId=this.renderer.glGeomLibrary.addGeom(B),this.enableFrustumCulling&&this.dirtyWorkerItemIndices.add(g),d()};t.on("valueChanged",s),this.glGeomItemsIndexFreeList.length>0?g=this.glGeomItemsIndexFreeList.pop():(g=this.glGeomItems.length,this.glGeomItems.push(null)),this.removedItemIndices.includes(g)&&this.removedItemIndices.splice(this.removedItemIndices.indexOf(g),1),this.dirtyItemIndices.push(g);const a=this.renderer.gl,l=a.floatTexturesSupported,n=new ge(a,A,g,o,i,l),d=()=>{this.dirtyItemIndices.includes(g)||(this.dirtyItemIndices.push(g),this.renderer.drawItemChanged())};A.geomMatParam.on("valueChanged",d),A.on("cutAwayChanged",d),A.on("highlightChanged",d),A.on("selectabilityChanged",d),A.on("opacityChanged",d);const h=()=>{this.enableFrustumCulling&&(this.dirtyWorkerItemIndices.has(g)||(this.dirtyWorkerItemIndices.add(g),this.renderer.drawItemChanged()))};return this.enableFrustumCulling&&this.dirtyWorkerItemIndices.add(g),A.on("visibilityChanged",h),A.on("opacityChanged",h),A.geomMatParam.on("valueChanged",h),t.on("boundingBoxChanged",h),this.glGeomItems[g]=n,this.glGeomItemEventHandlers[g]={geomItemChanged:d,materialChanged:e,geomChanged:s,workerItemDataChanged:h},this.glGeomItemsMap[A.getId()]=g,this.renderer.requestRedraw(),n}removeGeomItem(A){const g=this.glGeomItemsMap[A.getId()];if(null==g)return null;const I=this.glGeomItems[g],C=A.geomParam.value;this.renderer.glGeomLibrary.removeGeom(C);const i=A.materialParam.value;this.renderer.glMaterialLibrary.removeMaterial(i);const e=this.glGeomItemEventHandlers[g],t=A.geomParam;return A.materialParam.off("valueChanged",e.materialChanged),t.off("valueChanged",e.geomChanged),A.geomMatParam.off("valueChanged",e.geomItemChanged),A.off("cutAwayChanged",e.geomItemChanged),A.off("highlightChanged",e.geomItemChanged),A.off("selectabilityChanged",e.geomItemChanged),A.off("opacityChanged",e.geomItemChanged),A.off("visibilityChanged",e.workerItemDataChanged),A.geomMatParam.off("valueChanged",e.workerItemDataChanged),t.off("boundingBoxChanged",e.workerItemDataChanged),A.off("opacityChanged",e.workerItemDataChanged),this.glGeomItems[g]=null,this.glGeomItemEventHandlers[g]=null,this.glGeomItemsIndexFreeList.push(g),delete this.glGeomItemsMap[A.getId()],this.removedItemIndices.push(g),this.dirtyWorkerItemIndices.has(g)&&this.dirtyWorkerItemIndices.delete(g),this.renderer.requestRedraw(),I}getGeomItem(A){var g;if(!(A>=this.glGeomItems.length))return null===(g=this.glGeomItems[A])||void 0===g?void 0:g.geomItem;console.warn("Invalid Draw Item id:"+A+" NumItems:"+(this.glGeomItems.length-1))}getGLGeomItem(A){const g=this.glGeomItemsMap[A.getId()];return null!=g?this.glGeomItems[g]:null}populateDrawItemDataArray(A,g,I){const C=this.glGeomItems[A];if(!C)return;const{geomItem:i,geomId:e}=C,t=i.materialParam.value,B=32*g;let o=0;i.isCutawayEnabled()&&(o|=Ae.GEOMITEM_FLAG_CUTAWAY),i.isSelectable()||(o|=Ae.GEOMITEM_INVISIBLE_IN_GEOMDATA),t.isOpaque()&&i.isOpaque()||(o|=Ae.GEOMITEM_TRANSPARENT);const a=new s(new Float32Array(I.buffer,4*(B+0),4));a.set(o,i.opacity,0,0);const l=this.renderer.glMaterialLibrary.getMaterialAllocation(t);l&&(a.z=l.start),a.w=e;const n=i.geomMatParam.value,d=new s(new Float32Array(I.buffer,4*(B+4),4)),h=new s(new Float32Array(I.buffer,4*(B+8),4)),c=new s(new Float32Array(I.buffer,4*(B+12),4));d.set(n.xAxis.x,n.yAxis.x,n.zAxis.x,n.translation.x),h.set(n.xAxis.y,n.yAxis.y,n.zAxis.y,n.translation.y),c.set(n.xAxis.z,n.yAxis.z,n.zAxis.z,n.translation.z);const r=new s(new Float32Array(I.buffer,4*(B+16),4));if(i.isHighlighted()){const A=i.getHighlight();r.set(A.r,A.g,A.b,A.a)}const G=new s(new Float32Array(I.buffer,4*(B+20),4));if(i.isCutawayEnabled()){const A=i.getCutVector(),g=i.getCutDist();G.set(A.x,A.y,A.z,g)}const m=i.boundingBoxParam.value,Q=new s(new Float32Array(I.buffer,4*(B+24))),E=new s(new Float32Array(I.buffer,4*(B+28)));Q.set(m.p0.x,m.p0.y,m.p0.z,0),E.set(m.p1.x,m.p1.y,m.p1.z,0)}getCullingWorkerData(A,g,I){const C=A.boundingBoxParam.value,i=.5*C.size(),e=C.center();let t=0!=A.cullable;const B=g.getParameter("MaintainScreenSize");B&&B.value&&(t=!1),g.getShaderName().startsWith("ScreenSpace")&&(t=!1),g.hasParameter("PointSize")&&(t=!1),this.enableOcclusionCulling&&!A.isSelectable()&&(t=!1);const o=!A.isOpaque()||!g.isOpaque(),s={triangles:0,lines:0,points:0},a=A.geomParam.value;if(a instanceof Mg)s.triangles+=a.getNumTriangles(),s.lines+=a.getNumLineSegments(),s.points+=a.getNumPoints();else if(a instanceof Kg||a instanceof Dg)s.triangles+=a.getNumTriangles();else if(a instanceof Yg||a instanceof Jg)s.lines+=a.getNumLineSegments();else{if(!(a instanceof Wg||a instanceof Ng))throw new Error("Unsupported geom type:"+a.constructor.name);s.points+=a.getNumVertices()}return{id:I,boundingRadius:i,pos:e.asArray(),cullable:t,visible:A.isVisible(),transparent:o,geomStats:s}}uploadGeomItemsToWorker(){if(this.enableFrustumCulling){const A=[];this.dirtyWorkerItemIndices.forEach((g=>{const I=this.glGeomItems[g];if(!I)return;const{geomItem:C}=I,i=C.materialParam.value;A.push(this.getCullingWorkerData(C,i,g))})),this.worker.postMessage({type:"UpdateGeomItems",geomItems:A,removedItemIndices:this.removedItemIndices}),this.dirtyWorkerItemIndices.clear(),this.removedItemIndices=[]}}uploadGeomItems(A){const g=this.renderer.gl;if(!g.floatTexturesSupported)return;let I=Math.round(Math.sqrt(8*this.glGeomItems.length)+.5);I=r.nextPow2(I),I%8!=0&&(I+=8-I%8),this.glGeomItemsTexture?this.glGeomItemsTexture.width!=I&&(this.glGeomItemsTexture.resize(I,I),this.dirtyItemIndices=Array(I*I/8).fill(0).map(((A,g)=>g))):(this.glGeomItemsTexture=new HC(g,{format:"RGBA",type:"FLOAT",width:I,height:I,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.glGeomItemsTexture.clear()),g.bindTexture(g.TEXTURE_2D,this.glGeomItemsTexture.glTex);const C=this.glGeomItemsTexture.getType();for(let A=0;A<this.dirtyItemIndices.length;A++){const i=this.dirtyItemIndices[A],e=Math.floor(8*i/I);let t=i+1;for(let g=A+1;g<this.dirtyItemIndices.length;g++){const A=this.dirtyItemIndices[g];if(Math.floor(8*A/I)!=e)break;if(A!=t)break;t++}const B=t-i,o=8*i%I,s=8*B,a=1,l=new Float32Array(32*B);for(let A=i;A<t;A++)this.populateDrawItemDataArray(A,A-i,l);if(C==g.FLOAT)this.glGeomItemsTexture.populate(l,s,a,o,e,!1);else{const A=r.convertFloat32ArrayToUInt16Array(l);this.glGeomItemsTexture.populate(A,s,a,o,e,!1)}A+=B-1}this.removedItemIndices=[],this.dirtyItemIndices=[]}bind(A){(this.dirtyWorkerItemIndices.size>0||this.removedItemIndices.length>0)&&this.uploadGeomItemsToWorker(),this.dirtyItemIndices.length>0&&this.uploadGeomItems(A);const g=this.renderer.gl,{instancesTexture:I,instancesTextureSize:C}=A.unifs;I&&(this.glGeomItemsTexture.bindToUniform(A,I),g.uniform1i(C.location,this.glGeomItemsTexture.width))}}let oe,se=!1,ae=!1;const le={};class ne extends nA{constructor(A,I={}){var C;if(super(),this.listenerIDs={},this.directives=[],this.solidAngleLimit=.004,this.__glcanvas=null,this.__scene=null,this.__shaderDirectives={},this.__renderGeomDataFbosRequested=!1,this.__shaders={},this.__passes={},this.passAssignments={},this.__passesRegistrationOrder=[],this.__passCallbacks=[],this.__viewports=[],this.__activeViewport=void 0,this.__continuousDrawing=!1,this.__redrawRequested=!1,this.__isMobile=!1,this.__drawSuspensionLevel=0,this.__xrViewportPresenting=!1,this.floatGeomBuffer=!0,this.multiSampledScreenBuffer=!1,this.__supportXR=!1,this.__xrViewport=void 0,this.screenQuad=null,!g.gpuDesc)throw new Error("Unable to create renderer. WebGL not Supported");this.__isMobile=g.isMobileDevice,this.requestRedraw=this.requestRedraw.bind(this),this.__gl=this.setupWebGL(A,I),this.screenQuad=new Hi(this.__gl,{directives:this.directives}),this.bindEventHandlers();const i=this.addViewport("main");i.debugGeomDataBuffer=I.debugGeomDataBuffer,i.debugOcclusionBuffer=I.debugOcclusionBuffer,this.glMaterialLibrary=new Pi(this),this.glMaterialLibrary.on("updated",(()=>{this.requestRedraw()})),this.glGeomLibrary=new $i(this),this.glGeomLibrary.on("updated",(()=>{this.requestRedraw()})),this.glGeomItemLibrary=new Be(this,I),this.glGeomItemLibrary.on("updated",(()=>{this.requestRedraw()}));for(const A in le)for(const g of le[A])this.addPass(new g,parseInt(A),!1);this.__supportXR=null===(C=I.supportXR)||void 0===C||C,this.__xrViewportPromise=new Promise(((A,g)=>{var I,C;if(this.__supportXR&&(null===(I=navigator)||void 0===I?void 0:I.xr)){const g=()=>{this.__gl.makeXRCompatible().then((()=>{this.__xrViewport=this.__setupXRViewport();let g=new CA(this.__xrViewport);this.emit("xrViewportSetup",g),A(this.__xrViewport)}))};null===(C=navigator)||void 0===C||C.xr.isSessionSupported("immersive-vr").then((A=>{A&&g()})).catch((A=>{console.warn("Unable to setup XR:"+A)}))}}))}addShaderPreprocessorDirective(A,g){this.__shaderDirectives[A]=g?"#define "+A+" = "+g:"#define "+A;const I=[];for(const A in this.__shaderDirectives)I.push(this.__shaderDirectives[A]);this.directives=I}getWidth(){return this.__glcanvas.width}getHeight(){return this.__glcanvas.height}addViewport(A){const g=new Ni(this,A,this.getWidth(),this.getHeight());return g.on("updated",(()=>{this.requestRedraw()})),g.on("viewChanged",(A=>{this.__xrViewportPresenting||this.emit("viewChanged",A)})),this.__viewports.push(g),this.__activeViewport=g,g}getViewport(A=0){return this.__viewports[A]}getViewportAtPos(A,g){for(const I of this.__viewports){const C=I.getPosX(),i=I.getPosY(),e=I.getWidth(),t=I.getHeight();if(A>=C&&g>=i&&A<=e+C&&g<=t+i)return I}}activateViewport(A){this.__activeViewport!=A&&(this.__activeViewport=A)}activateViewportAtPos(A,g){if(this.__xrViewportPresenting)return;const I=this.getViewportAtPos(A,g);I&&I!=this.__activeViewport&&this.activateViewport(I)}getActiveViewport(){return this.__activeViewport}suspendDrawing(){this.__drawSuspensionLevel++}resumeDrawing(){this.__drawSuspensionLevel--,0==this.__drawSuspensionLevel&&(this.renderGeomDataFbos(),this.requestRedraw())}renderGeomDataFbos(){if(1==this.__renderGeomDataFbosRequested)return;this.__renderGeomDataFbosRequested=!0;window.requestAnimationFrame((()=>{for(const A of this.__viewports)A.renderGeomDataFbo();this.__renderGeomDataFbosRequested=!1}))}getScene(){return this.__scene}setScene(A){this.__scene=A,this.addTreeItem(this.__scene.getRoot());let g=new L(this.__scene);this.emit("sceneSet",g)}addTreeItem(A){if(!(A instanceof ag))return;const g=A.getId(),I={};if(this.listenerIDs[g]=I,A instanceof kI){const g=A.geomParam;if(null==g.value){const C=()=>{delete I["Geometry.valueChanged"],this.assignTreeItemToGLPass(A)};I["Geometry.valueChanged"]=g.once("valueChanged",C)}else this.assignTreeItemToGLPass(A)}else this.assignTreeItemToGLPass(A);for(const g of A.getChildren())g&&this.addTreeItem(g);I.childAdded=A.on("childAdded",(A=>{this.addTreeItem(A.childItem)})),I.childRemoved=A.on("childRemoved",(A=>{this.removeTreeItem(A.childItem)})),this.renderGeomDataFbos()}assignTreeItemToGLPass(A){if(A instanceof kI){const g=A;this.glGeomItemLibrary.addGeomItem(g)}let g=!1;for(let I=this.__passesRegistrationOrder.length-1;I>=0;I--){const C={continueInSubTree:!0};if(g=this.__passesRegistrationOrder[I].itemAddedToScene(A,C),g){if(this.passAssignments[A.getId()]=I,!C.continueInSubTree)return;break}}if(!g)for(const g of this.__passCallbacks){const I={continueInSubTree:!0};if(g.itemAddedFn(A,I)){if(!I.continueInSubTree)return;break}}}removeTreeItem(A){if(!(A instanceof ag))return;const g=A.getId(),I=this.listenerIDs[g];delete this.listenerIDs[g],A.removeListenerById("childAdded",I.childAdded),A.removeListenerById("childRemoved",I.childRemoved);const C=this.passAssignments[g];if(null!=C){const I={continueInSubTree:!0};this.getPass(C).itemRemovedFromScene(A,I),delete this.passAssignments[g]}for(const g of A.getChildren())g&&this.removeTreeItem(g);if(A instanceof kI){const g=A;if(I["Geometry.valueChanged"]){A.geomParam.removeListenerById("valueChanged",I["Geometry.valueChanged"])}this.glGeomItemLibrary.removeGeomItem(g)}this.renderGeomDataFbos()}get gl(){return this.__gl}getGL(){return this.__gl}handleResize(A,g){if(this.__xrViewportPresenting)return;const I=Math.max(4,A)*window.devicePixelRatio,C=Math.max(4,g)*window.devicePixelRatio;this.__glcanvas.width=I,this.__glcanvas.height=C,this.__viewports.forEach((A=>{A.resize(I,C)}));const i=new F(I,C);this.emit("resized",i),this.requestRedraw()}getDiv(){return this.__glcanvas.parentElement}setupWebGL(A,I={}){var C,i;const{tagName:e}=A;if(!["DIV","CANVAS"].includes(e))throw new Error("Only CANVAS and DIV are valid root elements.");const t="DIV"===e;this.__glcanvas=A,t?(console.warn("@GLBaseRenderer#setupWebGL.","Using a DIV as root element is deprecated.","Use a CANVAS instead.","See: https://docs.zea.live/zea-engine/#/getting-started/get-started-with-engine?id=basic-setup"),this.__glcanvas=document.createElement("canvas"),A.appendChild(this.__glcanvas)):this.__glcanvas=A,this.__glcanvas.style["touch-action"]="none",this.__glcanvas.parentElement.style.position="relative",this.__glcanvas.parentElement.style.overflow="hidden",this.__glcanvas.style.width="100%",this.__glcanvas.style.height="100%",this.__glcanvas.style.position="absolute";const B=function(A,g,I){var C=!0,i=!0;if("function"!=typeof A)throw new TypeError("Expected a function");return ti(I)&&(C="leading"in I?!!I.leading:C,i="trailing"in I?!!I.trailing:i),wi(A,g,{leading:C,maxWait:g,trailing:i})}((A=>{if(Array.isArray(A)&&A.length)for(const g of A){if(!g.contentRect)return;const A=Math.round(g.contentRect.width),I=Math.round(g.contentRect.height);this.handleResize(A,I)}}),500);window.addEventListener("resize",(()=>{const A=[{contentRect:{width:this.__glcanvas.parentElement.clientWidth,height:this.__glcanvas.parentElement.clientHeight}}];B(A)}));const o=new ResizeObserver(B);try{o.observe(this.__glcanvas.parentNode,{box:"device-pixel-content-box"})}catch(A){o.observe(this.__glcanvas.parentNode,{box:"content-box"})}this.handleResize(this.__glcanvas.parentElement.clientWidth,this.__glcanvas.parentElement.clientHeight);const s="macOS"===g.OS&&"Chrome"===g.browserName,a=g.isIOSDevice,l={preserveDrawingBuffer:!0};l.antialias=!s&&!a&&(null===(C=I.antialias)||void 0===C||C),l.depth=!0,l.stencil=!0,l.alpha=null!==(i=I.alpha)&&void 0!==i&&i,l.xrCompatible=!1,this.multiSampledScreenBuffer=l.antialias,l.powerPreference=I.powerPreference||"high-performance";const n=wC(this.__glcanvas,l);n||alert("Unable to create WebGL context. WebGL not supported."),"webgl2"==n.name&&this.addShaderPreprocessorDirective("ENABLE_ES3"),n.floatTexturesSupported&&this.addShaderPreprocessorDirective("ENABLE_FLOAT_TEXTURES");{const A="webgl2"==n.name?n.getExtension("WEBGL_multi_draw"):null;A&&!I.disableMultiDraw?(n.multiDrawArrays=A.multiDrawArraysWEBGL.bind(A),n.multiDrawElements=A.multiDrawElementsWEBGL.bind(A),n.multiDrawElementsInstanced=A.multiDrawElementsInstancedWEBGL.bind(A),n.multiDrawArraysInstanced=A.multiDrawArraysInstancedWEBGL.bind(A)):this.addShaderPreprocessorDirective("EMULATE_MULTI_DRAW")}return"Safari"==g.browserName&&"webgl"==n.name?this.floatGeomBuffer=!1:this.floatGeomBuffer=null!=I.floatGeomBuffer?I.floatGeomBuffer:n.floatTexturesSupported,n.floatGeomBuffer=this.floatGeomBuffer,n}bindEventHandlers(){const A=()=>this.getWidth()>0&&this.getHeight(),I=A=>!!g.isMobileDevice&&(console.warn("Mobile device is triggering mouse event:",A.type),!0);this.__glcanvas.addEventListener("mousedown",(A=>{if(I(A))return;const g=new iA(A,this.__glcanvas.getBoundingClientRect());se=!0,oe=this,this.activateViewportAtPos(g.rendererX,g.rendererY);const C=this.getActiveViewport();C&&C.onPointerDown(g),ae=!1})),document.addEventListener("mouseup",(g=>{if(I(g))return;if(oe!=this||!A())return;const C=new iA(g,this.__glcanvas.getBoundingClientRect());se=!1;const i=this.getActiveViewport();i&&i.onPointerUp(C),ae&&(i&&i.onPointerLeave(C),oe=void 0)})),document.addEventListener("mousemove",(g=>{if(I(g))return;if(oe!=this||!A())return;const C=new iA(g,this.__glcanvas.getBoundingClientRect());se||this.activateViewportAtPos(C.rendererX,C.rendererY);const i=this.getActiveViewport();i&&i.onPointerMove(C)})),this.__glcanvas.addEventListener("mouseenter",(A=>{if(!I(A)&&!se){oe=this;const g=new iA(A,this.__glcanvas.getBoundingClientRect());if(this.activateViewportAtPos(g.rendererX,g.rendererY),!se){const A=this.getActiveViewport();A&&A.onPointerEnter(g)}ae=!1}})),this.__glcanvas.addEventListener("mouseleave",(g=>{if(I(g))return;if(oe!=this||!A())return;const C=new iA(g,this.__glcanvas.getBoundingClientRect());if(se)ae=!0;else{const A=this.getActiveViewport();A&&A.onPointerLeave(C),oe=void 0}})),document.addEventListener("contextmenu",(g=>{oe==this&&A()&&(g.preventDefault(),g.stopPropagation())})),this.__glcanvas.addEventListener("touchstart",(A=>{oe=this;const g=this.getActiveViewport(),I=new tA(A,this.__glcanvas.getBoundingClientRect());g.onPointerDown(I)}),{passive:!0}),this.__glcanvas.addEventListener("touchend",(A=>{const g=this.getActiveViewport(),I=new tA(A,this.__glcanvas.getBoundingClientRect());g.onPointerUp(I)}),{passive:!0}),this.__glcanvas.addEventListener("touchmove",(A=>{const g=this.getActiveViewport(),I=new tA(A,this.__glcanvas.getBoundingClientRect());g.onPointerMove(I)}),{passive:!0}),this.__glcanvas.addEventListener("touchcancel",(A=>{const g=this.getActiveViewport(),I=new tA(A,this.__glcanvas.getBoundingClientRect());g.onTouchCancel(I)}),{passive:!0});window.addEventListener("wheel",(g=>{if(oe==this&&A()&&oe){const A=new BA(g,this.__glcanvas.getBoundingClientRect()),I=oe.getActiveViewport();I&&I.onWheel(A)}}),{passive:!1}),document.addEventListener("keydown",(g=>{if(oe!=this||!A())return;const I=new J(g),C=oe.getActiveViewport();C&&C.onKeyDown(I)})),document.addEventListener("keyup",(g=>{if(oe!=this||!A())return;const I=new J(g),C=oe.getActiveViewport();C&&C.onKeyUp(I)}))}getGLCanvas(){return this.__glcanvas}frameAll(A=0){this.__viewports[A].frameView([this.__scene.getRoot()])}getOrCreateShader(A){let g=this.__shaders[A];return g||(g=e.constructClass(A),g||console.error("@GLBaseRenderer#getOrCreateShader - Shader not registered with the Registry:",A),g.setGLContext(this.__gl),this.__shaders[A]=g),g}addPass(A,g=-1,I=!0){-1==g&&(g=A.getPassType()),this.__passes[g]||(this.__passes[g]=[]);let C=0;for(const A in this.__passes){if(A==g.toString())break;C+=this.__passes[A].length}if(C+=this.__passes[g].length,A.on("updated",(A=>{this.requestRedraw(),this.renderGeomDataFbos()})),A.init(this,C),this.__passes[g].push(A),I){let A=0;for(const g in this.__passes){const I=this.__passes[g];I.forEach(((g,I)=>{g.setPassIndex(A+I)})),A+=I.length}}return this.__passesRegistrationOrder.push(A),this.requestRedraw(),C}getPass(A){let g=0;for(const I in this.__passes){const C=this.__passes[I];if(A-g<C.length)return C[A-g];g+=C.length}}supportsVR(){var A;return console.warn("@GLBaseRenderer#supportVR - Deprecated Method. Please instead connect to the vrViewportSetup signal."),this.__supportXR&&null!=(null===(A=navigator)||void 0===A?void 0:A.xr)}__setupXRViewport(){const A=new Mi(this),g=A=>{this.emit("viewChanged",A)};return A.on("presentingChanged",(I=>{const C=I.state;if(this.__xrViewportPresenting!=C)if(this.__xrViewportPresenting=C,C){for(const A in this.__passes){const g=this.__passes[A];for(const A of g)A.startPresenting()}A.on("viewChanged",g)}else{A.off("viewChanged",g),this.emit("updated");for(const A in this.__passes){const g=this.__passes[A];for(const A of g)A.stopPresenting()}const I=this.getViewport().getCamera().globalXfoParam.value,C=new P("CameraAndPointer",I);this.emit("viewChanged",C),this.requestRedraw()}})),A}getVRViewport(){return this.__xrViewport}getXRViewport(){return this.__xrViewportPromise}isXRViewportPresenting(){return this.__xrViewportPresenting}isContinuouslyDrawing(){return this.__continuousDrawing}startContinuousDrawing(){if(this.isContinuouslyDrawing()||this.__xrViewportPresenting)return;const A=()=>{const g=new jC(this.gl);this.__continuousDrawing&&!this.__xrViewportPresenting&&window.requestAnimationFrame(A);for(const A of this.__viewports)A.draw(g)};this.__continuousDrawing=!0,window.requestAnimationFrame(A)}stopContinuousDrawing(){this.__continuousDrawing=!1}toggleContinuousDrawing(){this.__continuousDrawing?this.stopContinuousDrawing():this.startContinuousDrawing()}drawItemChanged(){for(const A of this.__viewports)A.invalidateGeomDataBuffer();this.requestRedraw()}requestRedraw(){if(this.__redrawRequested||this.__continuousDrawing||this.__xrViewportPresenting||this.__drawSuspensionLevel>0)return!1;return window.requestAnimationFrame((()=>{this.__redrawRequested=!1;const A=new jC(this.gl);for(const g of this.__viewports)g.draw(A);1!=A.stack.length&&console.warn(" corrupt renderstate.stack.length:",A.stack.length)})),this.__redrawRequested=!0,!0}forceRender(){if(!this.__redrawRequested)return void console.warn("@GlBaseRenderer#forceRender - Scene is not dirty");this.__redrawRequested=!1;const A=new jC(this.gl);for(const g of this.__viewports)g.draw(A)}bindGLBaseRenderer(A){A.gl=this.__gl,A.shaderopts={directives:this.directives};const g=this.__gl;A.viewports&&1!=A.viewports.length?(A.bindRendererUnifs=I=>{const{cameraMatrix:C}=I;C&&g.uniformMatrix4fv(C.location,!1,A.cameraMatrix.asArray())},A.bindViewports=(I,C)=>{A.viewports.forEach(((A,i)=>{let e=A.region;g.viewport(e[0],e[1],e[2],e[3]);const{viewMatrix:t,projectionMatrix:B,eye:o,isOrthographic:s}=I;t&&g.uniformMatrix4fv(t.location,!1,A.viewMatrix.asArray()),B&&g.uniformMatrix4fv(B.location,!1,A.projectionMatrix.asArray()),o&&g.uniform1i(o.location,i),s&&g.uniform1i(s.location,A.isOrthographic),C()}))}):(A.bindRendererUnifs=I=>{const{cameraMatrix:C,viewMatrix:i,projectionMatrix:e,eye:t,isOrthographic:B}=I;C&&g.uniformMatrix4fv(C.location,!1,A.cameraMatrix.asArray());const o=A.viewports[0];i&&g.uniformMatrix4fv(i.location,!1,o.viewMatrix.asArray()),e&&g.uniformMatrix4fv(e.location,!1,o.projectionMatrix.asArray()),t&&g.uniform1i(t.location,0),B&&g.uniform1i(B.location,o.isOrthographic)},A.bindViewports=(A,g)=>g())}drawScene(A){A.directives=[...this.directives,"#define DRAW_COLOR"],A.shaderopts.directives=A.directives;for(const g in this.__passes){const I=this.__passes[g];for(const g of I)g.enabled&&g.draw(A)}}drawHighlightedGeoms(A){this.bindGLBaseRenderer(A),A.directives=[...this.directives,"#define DRAW_HIGHLIGHT"],A.shaderopts.directives=A.directives;for(const g in this.__passes){const I=this.__passes[g];for(const g of I)g.enabled&&g.drawHighlightedGeoms(A)}}drawSceneGeomData(A,g=255){A.pushGLStack(),A.glEnable(this.__gl.DEPTH_TEST),A.glEnable(this.__gl.CULL_FACE),this.bindGLBaseRenderer(A),A.directives=[...this.directives,"#define DRAW_GEOMDATA"],A.shaderopts.directives=A.directives,A.floatGeomBuffer=this.floatGeomBuffer;for(const I in this.__passes){if(0==(Number.parseInt(I)&g))continue;const C=this.__passes[I];for(const g of C)g.enabled&&g.drawGeomData(A)}A.popGLStack()}static registerPass(A,g){le[g]||(le[g]=[]),le[g].push(A)}destroy(){this.resizeObserver.disconnect()}}class de extends DC{constructor(A){super(A,"HighlightsShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 positions;    //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  v_texCoord = positions.xy+0.5;\n  gl_Position = vec4(positions.xy*2.0, 0.0, 1.0);\n}\n\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform float outlineThickness;\nuniform sampler2D highlightDataTexture;\nuniform vec2 highlightDataTextureSize;\n\nvarying vec2 v_texCoord;\n\nvec3 SobelFactor(vec3 ldc, vec3 ldl, vec3 ldr, vec3 ldu, vec3 ldd)\n{\n  return abs(ldl - ldc) +\n      abs(ldr - ldc) +\n      abs(ldu - ldc) +\n      abs(ldd - ldc);\n}\n\n// https://github.com/ssell/UnitySobelOutline/blob/2e1f4a5b4e703ae2c96aaf08d5518ce58abbaab9/Assets/Resources/Shaders/SobelOutlineHLSL.shader#L18\nvec4 SobelSample(vec2 uv)\n{\n  vec3 offset = vec3((1.0 / highlightDataTextureSize.x), (1.0 / highlightDataTextureSize.y), 0.0) * outlineThickness;\n\n  vec4 pixelCenter = texture2D(highlightDataTexture, uv);\n  vec3 pixelLeft   = texture2D(highlightDataTexture, uv - offset.xz).rgb;\n  vec3 pixelRight  = texture2D(highlightDataTexture, uv + offset.xz).rgb;\n  vec3 pixelUp     = texture2D(highlightDataTexture, uv + offset.zy).rgb;\n  vec3 pixelDown   = texture2D(highlightDataTexture, uv - offset.zy).rgb;\n\n  vec3 sobelNormalVec = SobelFactor(pixelCenter.rgb, pixelLeft, pixelRight, pixelUp, pixelDown);\n  \n  float sobelNormal = sobelNormalVec.x + sobelNormalVec.y + sobelNormalVec.z;\n  \n  float outlineDepthMultiplier = 10.0;\n  float outlineDepthBias = 2.5;\n  sobelNormal = pow(sobelNormal * outlineDepthMultiplier, outlineDepthBias);\n\n  sobelNormal = clamp(sobelNormal, 0.0, 1.0);\n\n  \n  float pixelCenterWeight = length(pixelCenter.rgb) > 0.0 ? 1.0 : 0.0;\n  float pixelLeftWeight   = length(pixelLeft) > 0.0 ? 1.0 : 0.0;\n  float pixelRightWeight  = length(pixelRight) > 0.0 ? 1.0 : 0.0;\n  float pixelUpWeight     = length(pixelUp) > 0.0 ? 1.0 : 0.0;\n  float pixelDownWeight   = length(pixelDown) > 0.0 ? 1.0 : 0.0;\n  \n  // Weight each neighbors contribution to the current pixel color.\n  pixelCenter.rgb = pixelCenter.rgb * pixelCenterWeight;\n  pixelLeft   *= pixelLeftWeight;\n  pixelRight  *= pixelRightWeight;\n  pixelUp     *= pixelUpWeight;\n  pixelDown   *= pixelDownWeight;\n\n  // Add all the weighted contributions, and then normalize.\n  vec3 outlineColor = pixelCenter.rgb + pixelLeft + pixelRight +  pixelUp + pixelDown;\n  outlineColor /= pixelCenterWeight + pixelLeftWeight + pixelRightWeight + pixelUpWeight + pixelDownWeight;\n\n  return mix(vec4(outlineColor, sobelNormal), pixelCenter, pixelCenter.a);\n}\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n    \n  vec4 outlineColor = SobelSample(v_texCoord);\n  \n  if (outlineColor.a > 0.0001) {\n#ifndef ENABLE_ES3\n    gl_FragColor = outlineColor;\n#else\n    fragColor = outlineColor;\n#endif\n  }\n  else {\n      discard;\n  }\n}\n\n")}}class he extends DC{constructor(A){super(A,"SilhouetteShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 positions;    //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  v_texCoord = positions.xy+0.5;\n  gl_Position = vec4(positions.xy*2.0, 0.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\n#ifndef ENABLE_ES3\n#extension GL_EXT_frag_depth: enable\n#endif\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform vec2 screenSize;\nuniform vec2 depthRange;\n\nuniform float outlineThickness;\nuniform color outlineColor;\nuniform float outlineSensitivity;\nuniform float outlineDepthBias;\n\nvarying vec2 v_texCoord;\n\n// http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\nfloat LinearEyeDepth(float z_b) {\n  float z_n = 2.0 * z_b - 1.0;\n  float z_e = 2.0 * depthRange.x * depthRange.y / (depthRange.y + depthRange.x - z_n * (depthRange.y - depthRange.x));\n  return z_e;\n}\n\nfloat LogEyeDepth(float z_b) {\n  return depthRange.x + ((depthRange.y - depthRange.x) * z_b);\n}\n\n// https://www.vertexfragment.com/ramblings/unity-postprocessing-sobel-outline/#depth-based-outline\n// https://github.com/ssell/UnitySobelOutline/blob/2e1f4a5b4e703ae2c96aaf08d5518ce58abbaab9/Assets/Resources/Shaders/SobelOutlineHLSL.shader\n\nfloat SobelDepth(float ldc, float ldl, float ldr, float ldu, float ldd)\n{\n  return abs(ldl - ldc) +\n      abs(ldr - ldc) +\n      abs(ldu - ldc) +\n      abs(ldd - ldc);\n}\n\nfloat SobelSampleDepth(vec2 uv, vec3 offset)\n{\n  float pixelCenter = LinearEyeDepth(texture2D(depthTexture, uv).r);\n  float pixelLeft   = LinearEyeDepth(texture2D(depthTexture, uv - offset.xz).r);\n  float pixelRight  = LinearEyeDepth(texture2D(depthTexture, uv + offset.xz).r);\n  float pixelUp     = LinearEyeDepth(texture2D(depthTexture, uv + offset.zy).r);\n  float pixelDown   = LinearEyeDepth(texture2D(depthTexture, uv - offset.zy).r);\n\n  float  outlineDepthMultiplier = (1.0 / pixelCenter) * outlineSensitivity;\n\n  return SobelDepth(pixelCenter, pixelLeft, pixelRight, pixelUp, pixelDown) * outlineDepthMultiplier;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec3 offset = vec3((1.0 / screenSize.x), (1.0 / screenSize.y), 0.0) * outlineThickness;\n  float sobelDepth = SobelSampleDepth(v_texCoord, offset);\n  float sobelValue = pow(sobelDepth, outlineDepthBias);\n\n  float minEdgeValue = 0.25;\n  float maxEdgeValue = 0.55;\n  sobelDepth = smoothstep(minEdgeValue, maxEdgeValue, sobelValue);\n\n#ifdef ENABLE_ES3\n  fragColor = vec4(outlineColor.rgb, sobelDepth);\n#else\n  fragColor = vec4(mix(texture2D(colorTexture, v_texCoord).rgb, outlineColor.rgb, sobelDepth), 1.0);\n#ifdef  GL_EXT_frag_depth\n  gl_FragDepthEXT = texture2D(depthTexture, v_texCoord).r;\n#endif\n#endif\n\n  // float z = texture2D(depthTexture, v_texCoord).r;\n  // float near = depthRange.x * 2.0;    // the near plane\n  // float far = depthRange.y / 2.0;     // the far plane\n  // float c = (2.0 * near) / (far + near - z * (far - near));  // convert to linear values \n  // fragColor = vec4(vec3(c), 1.0);\n\n  \n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}const ce=EC.OPAQUE|EC.TRANSPARENT|EC.OVERLAY;class re extends ne{constructor(A,g={}){super(A,g),this.__exposure=1,this.__gamma=2.2,this.__glEnvMap=null,this.highlightOutlineThickness=1,this.renderMode="pbr",this.outlineMethod="geometry",this.outlineThickness=0,this.outlineColor=new l(.15,.15,.15,1),this.hiddenLineColor=new l(.15,.15,.15,0),this.outlineSensitivity=2,this.outlineDepthBias=.7,this.__rayCastRenderTarget=null,this.__backgroundMapShader=null,this.__backgroundMapShaderBinding=null,this.__rayCastRenderTargetProjMatrix=new h,this.__exposure=1,this.__gamma=2.2,this.__displayEnvironment=!0,this.__debugMode=0,this.rayCastDist=0,this.rayCastArea=0;const I=this.__gl;this.highlightsShader=new de(I),this.silhouetteShader=new he(I),this.__debugTextures=[void 0],this.addShaderPreprocessorDirective("ENABLE_INLINE_GAMMACORRECTION"),g.disableTextures||this.addShaderPreprocessorDirective("ENABLE_TEXTURES"),g.debugGeomIds&&this.addShaderPreprocessorDirective("DEBUG_GEOM_ID")}__bindEnvMap(A){const g=this.__gl;if(!(A instanceof RI)){const I=A;if("FLOAT"===I.type?this.__glBackgroundMap=new $C(this.__gl,I):this.__glBackgroundMap=new HC(this.__gl,I),this.__glBackgroundMap.on("loaded",(()=>{this.requestRedraw()})),this.__glBackgroundMap.on("updated",(()=>{this.requestRedraw()})),!this.__backgroundMapShader){g.__quadVertexIdsBuffer||g.setupInstancedQuad(),this.__backgroundMapShader=new ii(this.__gl);const A=this.__backgroundMapShader.compileForTarget();this.__backgroundMapShaderBinding=_C(this.__gl,A.attrs,g.__quadattrbuffers,g.__quadIndexBuffer)}return}if("webgl2"!==g.name)return;"FLOAT"===A.type&&(this.addShaderPreprocessorDirective("ENABLE_PBR"),this.__glEnvMap=new ei(this,A)),this.__glEnvMap.on("loaded",(A=>{this.requestRedraw()})),this.__glEnvMap.on("updated",(A=>{this.requestRedraw()}));const I=new K(this.__glEnvMap);this.emit("envMapAssigned",I)}setScene(A){const g=A.envMapParam;null!=g.value&&this.__bindEnvMap(g.value),g.on("valueChanged",(()=>{this.__bindEnvMap(g.value)}));const I=A.displayEnvMapParam;this.__displayEnvironment=I.value,I.on("valueChanged",(()=>{this.__displayEnvironment=I.value,this.requestRedraw()})),super.setScene(A)}addViewport(A){return super.addViewport(A)}get exposure(){return this.__exposure}set exposure(A){this.__exposure=A,this.requestRedraw()}get gamma(){return this.__gamma}set gamma(A){this.__gamma=A,this.requestRedraw()}get displayEnvironment(){return this.__displayEnvironment}set displayEnvironment(A){this.__displayEnvironment=A,this.requestRedraw()}raycastWithRay(A,g,I=.01,C=ce){const i=new m;return i.setLookAt(A.start,A.start.add(A.dir),new o(0,0,1)),this.raycast(i,A,g,I,C)}raycastWithXfo(A,g,I=.01,C=ce){const i=new G(A.tr,A.ori.getZaxis().negate());return this.raycast(A,i,g,I,C)}raycast(A,g,I,C=.01,i=ce){return this.rayCastDist==I&&this.rayCastArea==C||(this.__rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5*C,.5*C,-.5*C,.5*C,0,I),this.rayCastDist=I,this.rayCastArea=C),this.raycastWithProjection(A,this.__rayCastRenderTargetProjMatrix,g,i)}raycastWithProjection(A,g,I,C=ce){var i;const e=new qC(this.__gl);e.cameraMatrix=A.toMat4(),e.viewports=[{region:[0,0,3,3],viewMatrix:A.inverse().toMat4(),projectionMatrix:g,isOrthographic:1,fovY:0}];const t=this.__gl;this.__rayCastRenderTarget||(this.__rayCastRenderTarget=new LC(t,{type:"FLOAT",format:"RGBA",filter:"NEAREST",createDepthTexture:!0,width:3,height:3,numColorChannels:1})),this.__rayCastRenderTarget.bindForWriting(e,!0),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.depthMask(!0),this.drawSceneGeomData(e,C),t.finish(),this.__rayCastRenderTarget.unbindForWriting(),this.__rayCastRenderTarget.bindForReading();const B=new Float32Array(36);t.readPixels(0,0,3,3,t.RGBA,t.FLOAT,B),this.__rayCastRenderTarget.unbindForReading();const o=[4,3,5,1,7];let s;for(const A of o)if(0!=B[4*A+3]){s=B.subarray(4*A,4*A+4);break}if(!s)return null;const a=63&Math.round(s[0]),l=null===(i=this.getPass(a))||void 0===i?void 0:i.getGeomItemAndDist(s);if(l){const A=I.start.add(I.dir.scale(l.dist));return{pointerRay:I,intersectionPos:A,geomItem:l.geomItem,componentId:-1,dist:l.dist,geomData:s}}return null}raycastCluster(A,g,I,C=.01,i=ce){const e=this.__gl;this.__rayCastRenderTarget||(this.__rayCastRenderTarget=new LC(e,{type:"FLOAT",format:"RGBA",filter:"NEAREST",createDepthTexture:!0,width:3,height:3,numColorChannels:1}),this.__rayCastRenderTargetProjMatrix=new h),this.rayCastDist==I&&this.rayCastArea==C||(this.__rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5*C,.5*C,-.5*C,.5*C,0,I),this.rayCastDist=I,this.rayCastArea=C);const t=new qC(this.__gl);t.viewports=[{region:[0,0,3,3],viewMatrix:A.inverse().toMat4(),projectionMatrix:this.__rayCastRenderTargetProjMatrix,isOrthographic:1}],t.cameraMatrix=A.toMat4(),this.__rayCastRenderTarget.bindForWriting(t,!0),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthMask(!0),this.drawSceneGeomData(t,i),e.finish(),this.__rayCastRenderTarget.unbindForWriting(),this.__rayCastRenderTarget.bindForReading();const B=new Float32Array(36);e.readPixels(0,0,3,3,e.RGBA,e.FLOAT,B),this.__rayCastRenderTarget.unbindForReading();const o=[];for(let A=0;A<9;A++)if(0!=B[4*A+3]){const I=B.subarray(4*A,4*A+4),C=63&Math.round(I[0]),i=this.getPass(C);if(i){const A=i.getGeomItemAndDist(I);if(A){const C=g.start.add(g.dir.scale(A.dist));o.push({pointerRay:g,intersectionPos:C,geomItem:A.geomItem,componentId:-1,dist:A.dist,geomData:I})}}}return o}drawBackground(A){if(this.__glBackgroundMap&&this.__backgroundMapShader&&this.__backgroundMapShaderBinding){if(!this.__glBackgroundMap.isLoaded())return;const g=this.__gl;g.depthMask(!1),this.__backgroundMapShader.bind(A);const I=A.unifs;this.__glBackgroundMap.bindToUniform(A,I.backgroundImage),this.__backgroundMapShaderBinding.bind(A),g.drawQuad()}else this.__glEnvMap&&this.__glEnvMap.draw&&this.__glEnvMap.draw(A)}bindGLRenderer(A){super.bindGLBaseRenderer(A),A.envMap=this.__glEnvMap,A.exposure=this.__exposure,A.renderMode=this.renderMode,A.outlineThickness=this.outlineThickness,A.outlineColor=this.outlineColor,A.hiddenLineColor=this.hiddenLineColor,A.outlineMethod=this.outlineMethod,A.screenQuad=this.screenQuad}drawScene(A){this.bindGLRenderer(A),this.__displayEnvironment&&this.drawBackground(A),super.drawScene(A)}}class Ge extends V{constructor(A,g){super(),this.drawIdsArray=null,this.drawIdsBuffer=null,this.highlightedIdsArray=null,this.highlightedIdsBuffer=null,this.gl=A,this.glGeom=g,this.id=g?g.getGeom().getId():this.getId(),this.glGeomItems=[],this.glgeomItems_freeIndices=[],this.glgeomItemEventHandlers=[],this.drawIdsArray=null,this.drawIdsBuffer=null,this.drawIdsBufferDirty=!0,this.highlightedIdsArray=null,this.highlightedIdsBuffer=null,this.highlightedIdsBufferDirty=!0,this.visibleItems=[],this.highlightedItems=[]}getGLGeom(){return this.glGeom}getDrawCount(){return this.visibleItems.length}addGLGeomItem(A){let g;if(this.glgeomItems_freeIndices.length>0?g=this.glgeomItems_freeIndices.pop():(g=this.glGeomItems.length,this.glGeomItems.push(null)),A.geomItem.isVisible()){this.visibleItems.push(g);const A=new Y(1,this.visibleItems.length);this.emit("drawCountChanged",A)}A.geomItem.isHighlighted()&&(this.highlightedItems.push(g),this.highlightedIdsBufferDirty=!0);const I={};I.highlightChanged=I=>{if(A.geomItem.isHighlighted()){if(this.highlightedItems.includes(g))return;this.highlightedItems.push(g);const A=new Y(1,this.highlightedItems.length);this.emit("highlightedCountChanged",A)}else{this.highlightedItems.splice(this.highlightedItems.indexOf(g),1);const A=new Y(-1,this.highlightedItems.length);this.emit("highlightedCountChanged",A)}this.highlightedIdsBufferDirty=!0},A.geomItem.on("highlightChanged",I.highlightChanged),I.visibilityChanged=A=>{if(A.visible){this.visibleItems.push(g);const A=new Y(1,this.visibleItems.length);this.emit("drawCountChanged",A)}else{this.visibleItems.splice(this.visibleItems.indexOf(g),1);const A=new Y(-1,this.visibleItems.length);this.emit("drawCountChanged",A)}this.drawIdsBufferDirty=!0},A.geomItem.on("visibilityChanged",I.visibilityChanged),this.glGeomItems[g]=A,this.glgeomItemEventHandlers[g]=I,this.drawIdsBufferDirty=!0,A.GLGeomItemSet=this}removeGLGeomItem(A){const g=this.glGeomItems.indexOf(A),I=this.glgeomItemEventHandlers[g];if(A.geomItem.off("highlightChanged",I.highlightChanged),A.geomItem.off("visibilityChanged",I.visibilityChanged),this.glGeomItems[g]=null,this.glgeomItemEventHandlers[g]=null,A.GLGeomItemSet=null,this.glgeomItems_freeIndices.push(g),A.geomItem.isVisible()){this.visibleItems.splice(this.visibleItems.indexOf(g),1);const A=new Y(-1,this.visibleItems.length);this.emit("drawCountChanged",A)}if(A.geomItem.isHighlighted()){this.highlightedItems.splice(this.highlightedItems.indexOf(g),1);const A=new Y(-1,this.highlightedItems.length);this.emit("highlightedCountChanged",A)}this.drawIdsBufferDirty=!0,this.glGeomItems.length==this.glgeomItems_freeIndices.length&&this.destroy()}updateDrawIDsBuffer(){const A=this.gl;A.floatTexturesSupported?(this.drawIdsBuffer&&this.glGeomItems.length!=this.drawIdsArray.length&&(this.gl.deleteBuffer(this.drawIdsBuffer),this.drawIdsBuffer=null),this.drawIdsBuffer||(this.drawIdsBuffer=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,this.drawIdsBuffer)),A.bindBuffer(A.ARRAY_BUFFER,this.drawIdsBuffer),A.bufferData(A.ARRAY_BUFFER,this.getDrawIdsArray(),A.STATIC_DRAW),this.drawIdsBufferDirty=!1):this.drawIdsBufferDirty=!1}getDrawIdsArray(){return this.drawIdsBufferDirty&&(this.drawIdsArray&&this.glGeomItems.length==this.drawIdsArray.length||(this.drawIdsArray=new Float32Array(this.glGeomItems.length)),this.visibleItems.forEach(((A,g)=>{this.drawIdsArray[g]=this.glGeomItems[A].getGeomItemId()})),this.drawIdsBufferDirty=!1),this.drawIdsArray}updateHighlightedIDsBuffer(){const A=this.gl;A.floatTexturesSupported?(this.highlightedIdsBuffer&&this.glGeomItems.length>this.highlightedIdsArray.length&&(this.gl.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null),this.highlightedIdsBuffer||(this.highlightedIdsBuffer=A.createBuffer()),A.bindBuffer(A.ARRAY_BUFFER,this.highlightedIdsBuffer),A.bufferData(A.ARRAY_BUFFER,this.getHighlightedIdsArray(),A.STATIC_DRAW),this.highlightedIdsBufferDirty=!1):this.highlightedIdsBufferDirty=!1}getHighlightedIdsArray(){return this.highlightedIdsBufferDirty&&((!this.highlightedIdsArray||this.highlightedItems.length>this.highlightedIdsArray.length)&&(this.highlightedIdsArray=new Float32Array(this.glGeomItems.length)),this.highlightedItems.forEach(((A,g)=>{this.highlightedIdsArray[g]=this.glGeomItems[A].getGeomItemId()})),this.highlightedIdsBufferDirty=!1),this.highlightedIdsArray}draw(A){0!=this.visibleItems.length&&(this.drawIdsBufferDirty&&this.updateDrawIDsBuffer(),this.__bindAndRender(A,this.visibleItems,this.drawIdsBuffer))}drawHighlighted(A){0!=this.highlightedItems.length&&(this.highlightedIdsBufferDirty&&this.updateHighlightedIDsBuffer(),this.__bindAndRender(A,this.highlightedItems,this.highlightedIdsBuffer))}drawGeomData(A){0!=this.visibleItems.length&&(this.drawIdsBufferDirty&&this.updateDrawIDsBuffer(),this.__bindAndRender(A,this.visibleItems,this.drawIdsBuffer))}__bindAndRender(A,g,I){const C=this.gl,i=A.unifs;if(A.glGeom!=this.glGeom&&(this.glGeom.bind(A),A.glGeom=this.glGeom),C.floatTexturesSupported&&C.drawElementsInstanced&&A.supportsInstancing){A.unifs.instancedDraw&&C.uniform1i(A.unifs.instancedDraw.location,1);const e=A.attrs.instancedIds.location;C.enableVertexAttribArray(e),C.bindBuffer(C.ARRAY_BUFFER,I),C.vertexAttribPointer(e,1,C.FLOAT,!1,4,0),C.vertexAttribDivisor(e,1),A.bindViewports(i,(()=>{this.glGeom.drawInstanced(A,g.length)}))}else A.unifs.instancedDraw&&C.uniform1i(A.unifs.instancedDraw.location,0),g.forEach((g=>{this.glGeomItems[g].bind(A),A.bindViewports(i,(()=>{this.glGeom.draw(A)}))}))}destroy(){this.drawIdsBuffer&&(this.gl.deleteBuffer(this.drawIdsBuffer),this.drawIdsBuffer=null),this.highlightedIdsBuffer&&(this.gl.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null),this.emit("destructing")}}class me extends V{constructor(A,g){super(),this.glGeomItemSets={},this.pass=A,this.__gl=A.renderer.gl,this.glMaterial=g,this.glGeomItemSets={},this.drawCount=0;const I=g.getMaterial(),C=A=>{I.off("opacityChanged",C);for(const A in this.glGeomItemSets){const g=this.glGeomItemSets[A];for(const A of g.glGeomItems){const g=A.geomItem;this.pass.removeGeomItem(g),this.pass.renderer.assignTreeItemToGLPass(g)}}};I.on("opacityChanged",C)}getGLMaterial(){return this.glMaterial}addGLGeomItem(A,g){const I=g.getGeom().getId();let C=this.glGeomItemSets[I];C||(C=new Ge(this.__gl,g),this.addGeomItemSet(C)),C.addGLGeomItem(A)}drawCountChanged(A){this.drawCount+=A.change,this.emit("updated")}__materialChanged(){const A=this.glMaterial.getMaterial();if(!this.pass.checkMaterial(A))for(const A in this.glGeomItemSets){const g=this.glGeomItemSets[A];for(const A of g.glGeomItems){const g=A.geomItem;this.pass.removeGeomItem(g),this.pass.renderer.assignTreeItemToGLPass(g)}}}addGeomItemSet(A){const g=A.getGLGeom().getGeom().getId();this.glGeomItemSets[g]=A;const I=A.on("drawCountChanged",(A=>{this.drawCountChanged(A)}));A.once("destructing",(()=>{A.removeListenerById("drawCountChanged",I),delete this.glGeomItemSets[g],0==Object.keys(this.glGeomItemSets).length&&this.emit("destructing")}))}draw(A){if(0==this.drawCount)return;this.glMaterial.bind(A,!0);for(const g in this.glGeomItemSets){this.glGeomItemSets[g].draw(A)}this.glMaterial.unbind(A)}drawHighlighted(A){this.glMaterial.bind(A,!1);for(const g in this.glGeomItemSets){this.glGeomItemSets[g].drawHighlighted(A)}this.glMaterial.unbind(A)}drawGeomData(A){this.glMaterial.bind(A,!1);for(const g in this.glGeomItemSets){this.glGeomItemSets[g].draw(A)}this.glMaterial.unbind(A)}}class Qe extends V{constructor(A,g,I){super(),this.gl=A,this.pass=g,this.glShader=I.glShader,this.glgeomdatashader=I.glgeomdatashader,this.glselectedshader=I.glselectedshader,this.glMaterialGeomItemSets=[]}findMaterialGeomItemSets(A){for(const g of this.glMaterialGeomItemSets)if(g.glMaterial==A)return g;return null}addGLGeomItem(A,g,I){let C=this.findMaterialGeomItemSets(I);C||(C=new me(this.pass,I),this.addMaterialGeomItemSets(C)),C.addGLGeomItem(A,g)}addMaterialGeomItemSets(A){this.glMaterialGeomItemSets.push(A);const g=()=>{this.emit("updated")},I=()=>{A.off("updated",g),A.off("destructing",I);const C=this.glMaterialGeomItemSets.indexOf(A);this.glMaterialGeomItemSets.splice(C,1),0==this.glMaterialGeomItemSets.length&&this.emit("destructing")};A.on("updated",g),A.on("destructing",I)}removeMaterialGeomItemSets(A){const g=this.glMaterialGeomItemSets.indexOf(A);this.glMaterialGeomItemSets.splice(g,1)}getMaterialGeomItemSets(){return this.glMaterialGeomItemSets}draw(A){const g=this.glShader;if(this.glShader.bind(A)){this.pass.renderer.glGeomItemLibrary.bind(A);for(const g of this.glMaterialGeomItemSets)g.draw(A);g.unbind(A)}}drawHighlightedGeoms(A){if(this.glselectedshader&&this.glselectedshader.bind(A,"highlight")){this.pass.renderer.glGeomItemLibrary.bind(A);for(const g of this.glMaterialGeomItemSets)g.drawHighlighted(A);this.glselectedshader.unbind(A)}}drawGeomData(A){var g;if(!this.glgeomdatashader||!this.glgeomdatashader.bind(A,"geomData"))return;this.pass.renderer.glGeomItemLibrary.bind(A);const I=this.gl,{floatGeomBuffer:C,passId:i,occlusionCulling:e}=A.unifs;C&&I.uniform1i(C.location,A.floatGeomBuffer?1:0),i&&I.uniform1i(i.location,A.passIndex),e&&I.uniform1i(e.location,null!==(g=A.occlusionCulling)&&void 0!==g?g:0);for(const g of this.glMaterialGeomItemSets)g.drawGeomData(A);this.glgeomdatashader.unbind(A)}}class Ee extends DC{constructor(A){super(A,"BillboardShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 cameraMatrix;\nuniform int isOrthographic;\n\nimport 'GLSLUtils.glsl'\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\n// A sorted attribute of instance Ids so we draw from back to front.\ninstancedattribute float instanceIds;\n\nimport 'transpose.glsl'\nimport 'imageAtlas.glsl'\n\nuniform sampler2D atlasBillboards_layout;\nuniform vec4 atlasBillboards_desc;\n\nuniform sampler2D instancesTexture;\nuniform int instancesTextureSize;\nuniform int passId;\n\nconst int cols_per_instance = 7;\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n  vec4 col0 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 0);\n  vec4 col1 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 1);\n  vec4 col2 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 2);\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n  return transpose(result);\n  // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n  return getMatrix(instancesTexture, instancesTextureSize, id);\n}\nvec4 getInstanceData(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 3);\n}\nvec4 getPivot(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 4);\n}\nvec4 getTintColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 5);\n}\n\n#else\n\nuniform vec4 atlasBillboards_desc;\n\nuniform mat4 modelMatrix;\nuniform vec2 pivot;\nuniform vec4 billboardData;\nuniform vec4 tintColor;\nuniform vec4 layoutData;\n\n#endif\n\nuniform int inVR;\n\nmat4 calcLookAtMatrix(vec3 origin, vec3 target, float roll) {\n  // vec3 rr = vec3(sin(roll), 0.0, cos(roll));\n  vec3 rr = vec3(0.0, 0.0, 1.0);\n  vec3 ww = normalize(target - origin);\n  vec3 uu = normalize(cross(rr, ww));\n  vec3 vv = normalize(cross(ww, uu));\n\n  return mat4(vec4(uu, 0.0), vec4(vv, 0.0), vec4(ww, 0.0), vec4(origin, 1.0));\n}\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\n/* VS Outputs */\nvarying float v_instanceID;\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\nvarying vec3 v_viewPos;\n\nvoid main(void) {\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\n  int instanceID = int(instanceIds);\n  v_instanceID = float(instanceID) + 0.25;\n\n  mat4 modelMatrix = getModelMatrix(instanceID);\n  vec2 pivot = getPivot(instanceID).xy;\n  vec4 billboardData = getInstanceData(instanceID);\n  vec4 layoutData = fetchTexel(atlasBillboards_layout, int(atlasBillboards_desc.z), int(billboardData.z));\n  v_tint = getTintColor(instanceID);\n\n#else\n\n  v_tint = tintColor;\n\n#endif\n\n  vec2 quadVertex = getQuadVertexPositionFromID();\n  \n  vec2 pos = quadVertex + vec2(0.5, 0.0) - pivot;\n  v_texCoord = vec2(quadVertex.x, -quadVertex.y) + 0.5;\n  v_alpha = billboardData.w;\n  v_texCoord *= layoutData.zw;\n  v_texCoord += layoutData.xy;\n\n  float scl = billboardData.x;\n  float width = layoutData.z * atlasBillboards_desc.x * scl;\n  float height = layoutData.w * atlasBillboards_desc.y * scl;\n  int flags = int(billboardData.y);\n\n  // Use cross platform bit flags methods\n  bool alignedToCamera = testFlag(flags, 4); // flag = 1<<2\n  bool drawOnTop = testFlag(flags, 8); // flag = 1 << 3\n  bool fixedSizeOnscreen = testFlag(flags, 16); // flag = 1 << 4\n\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  // Note: items in front of the camera will have a negative value here.\n  float sc = 1.0;\n  if (fixedSizeOnscreen) {\n    sc = -modelViewMatrix[3][2];\n    \n    if (inVR == 1) {\n      // During XR sessions, there is a scaling applied to the view matrix\n      // which causes a distortion to the line width. We extract that scale here\n      // and use to correct the distortion.\n      // See also: FatPointsShader\n      vec3 viewZ = modelViewMatrix[2].xyz;\n      float viewScale = length(viewZ);\n      sc /= viewScale;\n    }\n  }\n  \n  mat4 modelViewProjectionMatrix;\n  if (alignedToCamera) {\n    if (inVR == 0) {\n      gl_Position = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n      gl_Position += vec4(pos.x * width * sc, (pos.y + 0.5) * height * sc, 0.0, 0.0);\n      v_viewPos = gl_Position.xyz;\n      gl_Position = projectionMatrix * gl_Position;\n    } else {\n      vec3 cameraPos = vec3(cameraMatrix[3][0], cameraMatrix[3][1], cameraMatrix[3][2]);\n      vec3 billboardPos = vec3(modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2]);\n      mat4 lookAt = calcLookAtMatrix(billboardPos, cameraPos, 0.0);\n      mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * lookAt;\n      gl_Position = modelViewProjectionMatrix * vec4(pos.x * width * sc, (pos.y + 0.5) * height * sc, 0.0, 1.0);\n      v_viewPos = (modelViewMatrix * vec4(pos.x * width * sc, (pos.y + 0.5) * height * sc, 0.0, 1.0)).xyz;\n    }\n  }\n  else {\n    modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(pos.x * width, (pos.y + 0.5) * height, 0.0, 1.0);\n    v_viewPos = (modelViewMatrix * vec4(pos.x * width, (pos.y + 0.5) * height, 0.0, 1.0)).xyz;\n  }\n\n  // Use cross platform bit flags methods\n  if (drawOnTop) {\n    if (isOrthographic > 0){\n      gl_Position.z = mix(gl_Position.z, -1.0, 0.5);\n    } else {\n      gl_Position.z = mix(gl_Position.z, -gl_Position.z, 0.5);\n    }\n  }\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nimport 'imageAtlas.glsl'\n\nuniform sampler2D atlasBillboards;\n\n/* VS Outputs */\nvarying float v_instanceID;\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\nvarying vec3 v_viewPos;\n\nuniform sampler2D instancesTexture;\nuniform int instancesTextureSize;\n\n#if defined(DRAW_GEOMDATA)\n  uniform int isOrthographic;\n  import 'surfaceGeomData.glsl'\n#endif // DRAW_GEOMDATA\n\nconst int cols_per_instance = 7;\n\nvec4 getHilightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 6);\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int instanceID = int(v_instanceID);\n  vec4 imageColor = texture2D(atlasBillboards, v_texCoord) * v_tint;\n  imageColor.a *= v_alpha;\n  if(imageColor.a < 0.1)\n    discard;\n\n#if defined(DRAW_COLOR)\n  fragColor = imageColor;\n  // fragColor.r = 1.0;\n  // fragColor.a = 1.0;\n#elif defined(DRAW_GEOMDATA)\n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_instanceID, 0.0, isOrthographic);\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = getHilightColor(instanceID);\n  // Skip unhilighting labels.\n  if(fragColor.r < 0.001 && fragColor.g < 0.001 && fragColor.b < 0.001)\n    discard;\n#endif // DRAW_HIGHLIGHT\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}class be extends DC{constructor(A){super(A,"EnvProjectionShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 projectionCenter;\n\nimport 'inverse.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n \nvoid main()\n{\n  int geomItemId = getGeomItemId();\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n\n  gl_Position = modelViewProjectionMatrix * pos;\n\n  vec4 worldPos = modelMatrix * pos;\n  v_worldDir = worldPos.xyz - projectionCenter;\n}\n\n")}}new XI("EnvProjectionShader_template").addParameter(new LA("projectionCenter",new o(0,0,1.7)));class Ze extends DC{constructor(A){super(A,"FatLinesShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\ninstancedattribute vec2 segmentIndices;\nattribute float vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\nuniform int geomItemId;\nint getGeomItemId() {\n  return geomItemId;\n}\n\nuniform sampler2D positionsTexture;\nuniform int positionsTextureSize;\n\nuniform float LineThickness;\nuniform float Overlay;\n\nimport 'calcFatLinesViewPos.glsl'\n\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n\n  int geomItemId = getGeomItemId();\n  v_geomItemId = float(geomItemId);\n  v_geomItemData = getInstanceData(geomItemId);\n\n  int vertexID = int(vertexIDs);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec3 pos;\n\n  #if defined(DRAW_COLOR)\n    v_viewPos       = calcFatLinesViewPos(vertexID, modelViewMatrix, v_viewNormal, v_texCoord, pos);\n  #elif defined(DRAW_GEOMDATA)\n    vec3  viewNormal;\n    vec2  texCoord;\n    v_viewPos       = calcFatLinesViewPos(vertexID, modelViewMatrix, viewNormal, texCoord, pos);\n    v_drawItemID = float(getGeomItemId());\n    v_worldPos      = (modelMatrix * vec4(pos, 1.0)).xyz;\n  #endif\n\n  gl_Position     = projectionMatrix * vec4(v_viewPos, 1.0);\n\n  if (isOrthographic > 0){\n    gl_Position.z -= mix(gl_Position.z, -1.0, Overlay);\n  } else {\n    gl_Position.z = mix(gl_Position.z, -gl_Position.z, Overlay);\n  }\n\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform color BaseColor;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\nimport 'cutaways.glsl'\nimport 'GLSLBits.glsl'\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n#if defined(DRAW_HIGHLIGHT)\n  import 'surfaceHighlight.glsl'\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n  float treeItemOpacity = v_geomItemData.y;\n\n#if defined(DRAW_COLOR)\n  int debugLevel = 0;\n  if (debugLevel == 0) {\n\n    vec3 viewVector = mat3(cameraMatrix) * normalize(-v_viewPos);\n    vec3 normal = mat3(cameraMatrix) * v_viewNormal;\n    float NdotV = dot(normalize(normal), normalize(viewVector));\n\n    // Modulate the lighting using the texture coord so the line looks round.\n    NdotV *= cos((v_texCoord.x - 0.5) * 2.0);\n\n    vec4 color = BaseColor * NdotV;\n    fragColor = vec4(color.rgb, BaseColor.a * treeItemOpacity);\n  }\n  else {\n    fragColor = vec4(v_texCoord.x, 0.0, 0.0, 1.0);\n  }\n#elif defined(DRAW_GEOMDATA)\n  int geomItemId = int(v_geomItemId + 0.5);\n  int flags = int(v_geomItemData.x + 0.5);\n\n // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n    vec4 cutAwayData  = getCutaway(geomItemId);\n    vec3 planeNormal = cutAwayData.xyz;\n    float planeDist = cutAwayData.w;\n    if (cutaway(v_worldPos, planeNormal, planeDist)) {\n      discard;\n      return;\n    }\n  }\n  if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n    discard;\n    return;\n  }\n\n  float dist = length(v_viewPos);\n\n  if (floatGeomBuffer != 0) {\n    fragColor.r = float(passId); \n    fragColor.g = float(v_drawItemID);\n    fragColor.b = 0.0;// TODO: store poly-id or something.\n    fragColor.a = dist;\n  }\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = setFragColor_highlight(v_geomItemId);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}bind(A,g){return!!super.bind(A,g)&&(A.supportsInstancing=!1,!0)}static supportsInstancing(){return!1}static getMaterialTemplate(){return ye}}const ye=new HI("FatLinesShader_template");e.register("FatLinesShader",Ze);class ue extends DC{constructor(A){super(A,"FlatSurfaceShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\nimport 'GLSLUtils.glsl'\n\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n#ifdef ENABLE_MULTI_DRAW\nimport 'materialparams.glsl'\n#else\nuniform float Overlay;\n#endif\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  v_drawItemIds = getDrawItemIds();\n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  v_geomItemData  = getInstanceData(geomItemId);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  vec4 pos = vec4(positions, 1.);\n  vec4 viewPos = (modelViewMatrix * pos);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = viewPos.xyz;\n#ifdef ENABLE_TEXTURES\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n#endif\n\n  //////////////////////////////////////////////\n  // Overlay\n\n#ifdef ENABLE_MULTI_DRAW\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 materialValue1 = getMaterialValue(materialCoords, 1);\n  float overlay = materialValue1.x;\n#else\n  float overlay = Overlay;\n#endif\n\n  if (isOrthographic > 0){\n    gl_Position.z -= overlay;\n  } else {\n    gl_Position.z = mix(gl_Position.z, -gl_Position.z, overlay);\n  }\n\n  //////////////////////////////////////////////\n  \n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\nimport 'cutaways.glsl'\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\n\n#ifdef DEBUG_GEOM_ID\nimport 'debugColors.glsl'\n#endif\n\n#ifndef ENABLE_MULTI_DRAW\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n#endif // ENABLE_MULTI_DRAW\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\n#if defined(DRAW_GEOMDATA)\n  uniform int isOrthographic;\n  import 'surfaceGeomData.glsl'\n#elif defined(DRAW_HIGHLIGHT)\n  import 'surfaceHighlight.glsl'\n#endif // DRAW_HIGHLIGHT\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  int flags = int(v_geomItemData.x + 0.5);\n  float treeItemOpacity = v_geomItemData.y;\n\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n  {\n    vec4 cutAwayData   = getCutaway(geomItemId);\n    vec3 planeNormal = cutAwayData.xyz;\n    float planeDist = cutAwayData.w;\n    if (cutaway(v_worldPos, planeNormal, planeDist)) {\n      discard;\n      return;\n    }\n  }\n\n  //////////////////////////////////////////////\n  // Material\n#ifdef ENABLE_MULTI_DRAW\n\n  vec2 materialCoords = v_geomItemData.zw;\n  if (v_drawItemIds.z > 0.5) {\n    materialCoords.x = v_drawItemIds.z;\n  }\n  vec4 baseColor = getMaterialValue(materialCoords, 0);\n\n#else // ENABLE_MULTI_DRAW\n\n#ifndef ENABLE_TEXTURES\n  vec4 baseColor = BaseColor;\n#else\n  vec4 baseColor = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif // ENABLE_TEXTURES\n\n#endif // ENABLE_MULTI_DRAW\n\n  baseColor.a *= treeItemOpacity;\n  if (baseColor.a < 0.001) discard;\n\n#if defined(DRAW_COLOR)\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n    if (!gl_FrontFacing) {\n#ifdef ENABLE_ES3\n      fragColor = cutColor;\n#else\n      gl_FragColor = cutColor;\n#endif\n      return;\n    }\n  }\n\n  //////////////////////////////////////////////\n  fragColor = baseColor;\n\n#ifdef DEBUG_GEOM_ID\n  // ///////////////////////\n  // Debug Draw ID (this correlates to GeomID within a GLGeomSet)\n  float geomId = v_geomItemData.w;\n  fragColor.rgb = getDebugColor(geomId);\n  // ///////////////////////\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#elif defined(DRAW_GEOMDATA)\n\n  if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n    discard;\n    return;\n  }\n  if (occlusionCulling != 0) {\n    // Transparent geoms do not render to the occlusion buffer\n    if (testFlag(flags, GEOMITEM_TRANSPARENT)) {\n      discard;\n      return;\n    }\n  }\n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_drawItemIds.x, v_drawItemIds.y, isOrthographic);\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = setFragColor_highlight(v_drawItemIds.x);\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}bind(A,g){super.bind(A,g),A.pushGLStack();const I=this.__gl;return A.glDisable(I.CULL_FACE),!0}unbind(A){return super.unbind(A),this.__gl,A.popGLStack(),!0}static getPackedMaterialData(A){const g=new Float32Array(8),I=A.getParameter("BaseColor");let C;C=I instanceof Qg&&I.colorSpace==pA.Gamma?I.value.toLinear():I.value,g[0]=C.r,g[1]=C.g,g[2]=C.b,g[3]=C.a;const i=A.getParameter("Overlay");return i&&(g[4]=i.getValue()),g}static getMaterialTemplate(){return Re}}const Re=new YI("FlatSurfaceShader_template");e.register("FlatSurfaceShader",ue);class Ve extends DC{constructor(A){super(A,"LinesShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nattribute vec3 positions;\nattribute vec3 positionsNext;\n\nimport 'GLSLUtils.glsl'\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\n#ifdef ENABLE_MULTI_DRAW\nimport 'materialparams.glsl'\n#else\nuniform float Overlay;\n#endif\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_worldPos;\nvarying vec3 v_nextVertexDist;\n\nvoid main(void) {\n  int geomItemId = getGeomItemId();\n  v_geomItemId = float(geomItemId);\n  v_geomItemData  = getInstanceData(geomItemId);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  vec4 viewPosNext = modelViewMatrix * vec4(positionsNext, 1.0);\n\n#ifdef ENABLE_ES3\n  float nextVertexDist = length(viewPosNext.xyz - viewPos.xyz);\n  if (imod(gl_VertexID, 2) == 0) {\n    v_nextVertexDist.x = nextVertexDist;\n    v_nextVertexDist.y = 0.0;\n  } else {\n    v_nextVertexDist.x = 0.0;\n    v_nextVertexDist.y = nextVertexDist;\n  }\n  v_nextVertexDist.z = float(gl_VertexID);\n#endif\n\n  v_viewPos = viewPos.xyz;\n  gl_Position = projectionMatrix * viewPos;\n    \n\n  //////////////////////////////////////////////\n  // Overlay\n\n#ifdef ENABLE_MULTI_DRAW\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 materialValue1 = getMaterialValue(materialCoords, 1);\n  float overlay = materialValue1.y;\n#else\n  float overlay = Overlay;\n#endif\n\n   \n#if defined(DRAW_GEOMDATA)\n  float _overlay = mix(overlay, 1.0, 0.0001);\n#else\n  float _overlay = overlay;\n#endif\n\n  if (isOrthographic > 0){\n    gl_Position.z -= _overlay;\n  } else {\n    gl_Position.z = mix(gl_Position.z, -gl_Position.z, _overlay);\n  }\n\n  //////////////////////////////////////////////\n  \n  \n  vec4 pos = vec4(positions, 1.);\n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\nimport 'cutaways.glsl'\nimport 'materialparams.glsl'\n\n#if defined(DRAW_COLOR)\n\nuniform int occluded;\nuniform vec4 hiddenLineColor;\n\n#ifndef ENABLE_MULTI_DRAW\n\nuniform color BaseColor;\nuniform float Opacity;\n\nuniform color OccludedColor;\n\n#endif // ENABLE_MULTI_DRAW\n\n#elif defined(DRAW_GEOMDATA)\n\nuniform int isOrthographic;\n\nimport 'surfaceGeomData.glsl'\n\n#elif defined(DRAW_HIGHLIGHT)\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else // ENABLE_FLOAT_TEXTURES\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n  return highlightColor;\n}\n\n#endif // ENABLE_FLOAT_TEXTURES\n\n#endif // DRAW_HIGHLIGHT\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_worldPos;\nvarying vec3 v_nextVertexDist;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int geomItemId = int(v_geomItemId + 0.5);\n  int flags = int(v_geomItemData.x + 0.5);\n  float treeItemOpacity = v_geomItemData.y;\n\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n  {\n    vec4 cutAwayData   = getCutaway(geomItemId);\n    vec3 planeNormal = cutAwayData.xyz;\n    float planeDist = cutAwayData.w;\n    if (cutaway(v_worldPos, planeNormal, planeDist)) {\n      discard;\n      return;\n    }\n  }\n\n  //////////////////////////////////////////////\n  // Material\n\n#ifdef ENABLE_MULTI_DRAW\n\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 BaseColor = getMaterialValue(materialCoords, 0);\n  vec4 matValue1 = getMaterialValue(materialCoords, 1);\n  vec4 matValue2 = getMaterialValue(materialCoords, 2);\n  float Opacity  = matValue1.r;\n#endif // ENABLE_MULTI_DRAW\n\n  //////////////////////////////////////////////\n  // Color\n#if defined(DRAW_COLOR)\n\n  fragColor = BaseColor;\n  \n  if (occluded == 1) {\n    fragColor = hiddenLineColor;\n  }\n\n  fragColor.a *= Opacity * treeItemOpacity;\n\n  //////////////////////////////////////////////\n  // GeomData\n#elif defined(DRAW_GEOMDATA)\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n    discard;\n    return;\n  }\n  \n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_geomItemId, 0.0, isOrthographic);\n  \n  //////////////////////////////////////////////\n  // Highlight\n#elif defined(DRAW_HIGHLIGHT)\n  \n  fragColor = getHighlightColor(geomItemId);\n\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}static getPackedMaterialData(A){const g=new Float32Array(8),I=A.getParameter("BaseColor");let C;return C=I instanceof Qg&&I.colorSpace==pA.Gamma?I.value.toLinear():I.value,g[0]=C.r,g[1]=C.g,g[2]=C.b,g[3]=C.a,g[4]=A.getParameter("Opacity").value,g[5]=A.getParameter("Overlay").value,g}static getMaterialTemplate(){return Fe}}const Fe=new KI("LinesShader_template");e.register("LinesShader",Ve);class Se extends DC{constructor(A){super(A,"PointsShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 positions;\n\nimport 'GLSLUtils.glsl'\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\n#ifdef ENABLE_MULTI_DRAW\nimport 'materialparams.glsl'\n#else\nuniform float PointSize;\nuniform float Overlay;\n#endif\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n\nvoid main(void) {\n  int geomItemId = getGeomItemId();\n  v_geomItemId = float(geomItemId);\n  v_geomItemData  = getInstanceData(geomItemId);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.);\n  gl_Position = projectionMatrix * viewPos;\n  \n\n  //////////////////////////////////////////////\n  // Material\n#ifdef ENABLE_MULTI_DRAW\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 materialValue1 = getMaterialValue(materialCoords, 1);\n  int maintainScreenSize = int(materialValue1.x + 0.5);\n  float pointSize = materialValue1.x;\n  float overlay = materialValue1.y;\n#else\n  float pointSize = PointSize;\n  float overlay = Overlay;\n#endif\n  //////////////////////////////////////////////\n\n  // Note: as of 22/01/2021 gl_PointSize has stopped working again...\n  gl_PointSize = pointSize;\n\n#if defined(DRAW_GEOMDATA)\n  // Make the geom data point size at least 8 pixels across, else its impossible to hit.\n  gl_PointSize = max(8.0, pointSize);\n#endif\n\n  if (isOrthographic > 0){\n    gl_Position.z -= overlay;\n  } else {\n    gl_Position.z = mix(gl_Position.z, -gl_Position.z, overlay);\n  }\n  \n  v_viewPos = -viewPos.xyz;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\n#ifndef ENABLE_MULTI_DRAW\n\nuniform color BaseColor;\n\n#endif\n\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\nimport 'cutaways.glsl'\nimport 'materialparams.glsl'\n\n#if defined(DRAW_GEOMDATA)\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\nimport 'GLSLBits.glsl'\n\n#elif defined(DRAW_HIGHLIGHT)\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else // ENABLE_FLOAT_TEXTURES\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n  return highlightColor;\n}\n\n#endif // ENABLE_FLOAT_TEXTURES\n\n#endif // DRAW_HIGHLIGHT\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\n/* VS Outputs */\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  //////////////////////////////////////////////\n  // Color\n#if defined(DRAW_COLOR)\n\n#ifdef ENABLE_MULTI_DRAW\n\n  vec2 materialCoords = v_geomItemData.zw;\n  vec4 baseColor = getMaterialValue(materialCoords, 0);\n  vec4 matValue1 = getMaterialValue(materialCoords, 1);\n  float pointSize       = baseColor.a * matValue1.r;\n  float overlay      = matValue1.g;\n\n#else // ENABLE_MULTI_DRAW\n\n  vec4 baseColor = BaseColor;\n\n#endif // ENABLE_MULTI_DRAW\n\n  fragColor = baseColor;\n\n  //////////////////////////////////////////////\n  // GeomData\n#elif defined(DRAW_GEOMDATA)\n\n  float viewDist = length(v_viewPos);\n\n  if (floatGeomBuffer != 0) {\n    fragColor.r = float(passId); \n    fragColor.g = float(v_geomItemId);\n    fragColor.b = 0.0;// TODO: store poly-id or something.\n    fragColor.a = viewDist;\n  }\n  else {\n    ///////////////////////////////////\n    // UInt8 buffer\n    fragColor.r = mod(v_geomItemId, 256.) / 256.;\n    fragColor.g = (floor(v_geomItemId / 256.) + (float(passId) * 64.)) / 256.;\n\n    // encode the dist as a 16 bit float\n    vec2 float16bits = encode16BitFloatInto2xUInt8(viewDist);\n    fragColor.b = float16bits.x;\n    fragColor.a = float16bits.y;\n  }\n\n  //////////////////////////////////////////////\n  // Highlight\n#elif defined(DRAW_HIGHLIGHT)\n  \n  int geomItemId = int(v_geomItemId + 0.5);\n  fragColor = getHighlightColor(geomItemId);\n\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}static getPackedMaterialData(A){const g=new Float32Array(12),I=A.getParameter("BaseColor");let C;return C=I instanceof Qg&&I.colorSpace==pA.Gamma?I.value.toLinear():I.value,g[0]=C.r,g[1]=C.g,g[2]=C.b,g[3]=C.a,g[4]=A.getParameter("PointSize").value,g[5]=A.getParameter("Overlay").value,g}static getMaterialTemplate(){return we}}const we=new pI("PointsShader_template");e.register("PointsShader",Se);class Xe extends DC{constructor(A){super(A,"FatPointsShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\ninstancedattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\nimport 'GLSLUtils.glsl' \nimport 'inverse.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\nimport 'quadVertexFromID.glsl'\n\nuniform int geomItemId;\nint getGeomItemId() {\n  return geomItemId;\n}\n\nuniform float PointSize;\nuniform float Overlay;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_geomItemId;\n\nvoid main(void) {\n  int geomItemId = getGeomItemId();\n  vec2 quadPointPos = getQuadVertexPositionFromID();\n  v_texCoord = quadPointPos + 0.5;\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.);\n\n  // During XR sessions, there is a scaling applied to the view matrix\n  // which causes a distortion to the line width. We extract that scale here\n  // and use to correct the distortion.\n  // See also: FatLinesShader\n  vec3 viewZ = modelViewMatrix[2].xyz;\n  float viewScale = length(viewZ);\n  viewPos += vec4(vec3(quadPointPos, 0.0) * PointSize * viewScale, 0.);\n\n  // Generate a quad which is 0.5 * PointSize closer towards\n  // us. This allows points to be visualized even if snug on \n  // a surface. (else they get fully clipped)\n  viewPos.z += 0.5 * PointSize;\n\n  v_geomItemId = float(getGeomItemId());\n  v_viewPos = -viewPos.xyz;\n  \n  gl_Position = projectionMatrix * viewPos;\n\n  if (isOrthographic > 0){\n    gl_Position.z -= Overlay;\n  } else {\n    gl_Position.z = mix(gl_Position.z, -gl_Position.z, Overlay);\n  }\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nimport 'constants.glsl'\n\nuniform color BaseColor;\nuniform float Rounded;\nuniform float BorderWidth;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_geomItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\n#if defined(DRAW_GEOMDATA)\n  uniform int isOrthographic;\n  import 'surfaceGeomData.glsl'\n#elif defined(DRAW_HIGHLIGHT)\n  import 'surfaceHighlight.glsl'\n#endif // DRAW_HIGHLIGHT\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\nfloat dist = length(v_texCoord - 0.5);\nif (dist > 0.5)\n  discard;\n\n#if defined(DRAW_COLOR)\n\n  if (dist > 0.5 - (BorderWidth * 0.5))\n    fragColor = vec4(0.,0.,0.,1.);\n  else {\n    // Modulate the lighting using the texture coord so the point looks round.\n    float NdotV = cos(dist * PI);\n\n    fragColor = BaseColor * mix(1.0, NdotV, Rounded);\n  }\n\n#elif defined(DRAW_GEOMDATA)\n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_geomItemId, 0.0, isOrthographic);\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = setFragColor_highlight(v_geomItemId);\n#endif // DRAW_HIGHLIGHT\n\n  \n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}bind(A,g){return!!super.bind(A,g)&&(A.supportsInstancing=!1,!0)}static supportsInstancing(){return!1}static getMaterialTemplate(){return He}}const He=new WI("FatPointsShader_template");e.register("FatPointsShader",Xe);class We extends DC{constructor(A){super(A,"SimpleSurfaceShader"),this.setShaderStage("VERTEX_SHADER","precision highp float;\n#define GLSLIFY 1\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nimport 'GLSLUtils.glsl'\nimport 'transpose.glsl'\nimport 'inverse.glsl'\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  v_drawItemIds = getDrawItemIds();\n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  v_geomItemData  = getInstanceData(geomItemId);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  vec4 pos = vec4(positions, 1.);\n  vec4 viewPos    = modelViewMatrix * pos;\n  gl_Position     = projectionMatrix * viewPos;\n\n  mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n  v_viewPos       = -viewPos.xyz;\n  v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n  v_textureCoord  = texCoords;\n  // v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n#endif\n\n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n"),this.setShaderStage("FRAGMENT_SHADER","precision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl'\nimport 'cutaways.glsl'\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\n\n#ifdef DEBUG_GEOM_ID\nimport 'debugColors.glsl'\n#endif\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nuniform mat4 cameraMatrix;\nuniform int isOrthographic;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\n#if defined(DRAW_COLOR)\n\n#ifndef ENABLE_MULTI_DRAW\n\nuniform color BaseColor;\nuniform float Opacity;\nuniform float EmissiveStrength;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\nuniform sampler2D OpacityTex;\nuniform int OpacityTexType;\nuniform sampler2D EmissiveStrengthTex;\nuniform int EmissiveStrengthTexType;\n#endif // ENABLE_TEXTURES\n\n#endif // ENABLE_MULTI_DRAW\n\nimport 'computeViewNormal.glsl'\n  \n// end DRAW_COLOR\n#elif defined(DRAW_GEOMDATA)\n  import 'surfaceGeomData.glsl'\n#elif defined(DRAW_HIGHLIGHT)\n  import 'surfaceHighlight.glsl'\n#endif // DRAW_HIGHLIGHT\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  int elemId = int(v_drawItemIds.y + 0.5);\n  int perFaceMaterialId = int(v_drawItemIds.z);\n  int flags = int(v_geomItemData.x + 0.5);\n  float treeItemOpacity = v_geomItemData.y;\n\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n  {\n    vec4 cutAwayData   = getCutaway(geomItemId);\n    vec3 planeNormal = cutAwayData.xyz;\n    float planeDist = cutAwayData.w;\n    if (cutaway(v_worldPos, planeNormal, planeDist)) {\n      discard;\n      return;\n    }\n  }\n\n#if defined(DRAW_COLOR)\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n  {\n    if (!gl_FrontFacing) {\n#ifdef ENABLE_ES3\n      fragColor = cutColor;\n#else\n      gl_FragColor = cutColor;\n#endif\n      return;\n    }\n  }\n\n  //////////////////////////////////////////////\n  // Normals\n  \n  vec3 viewNormal;\n  if (length(v_viewNormal) < 0.1) {\n    viewNormal = computeViewNormal(v_viewPos);\n  } else {\n    viewNormal = normalize(v_viewNormal);\n  }\n  vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n  \n  vec3 viewVector;\n  if (isOrthographic == 0)\n    viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n  else \n    viewVector = vec3(-cameraMatrix[2][0], -cameraMatrix[2][1], -cameraMatrix[2][2]);\n  \n  //////////////////////////////////////////////\n  // Material\n\n#ifdef ENABLE_MULTI_DRAW\n\n  vec2 materialCoords = v_geomItemData.zw;\n  if (v_drawItemIds.z > 0.5) {\n    materialCoords.x = v_drawItemIds.z;\n  }\n  vec4 baseColor      = getMaterialValue(materialCoords, 0);\n  vec4 matValue1      = getMaterialValue(materialCoords, 1);\n  float opacity       = baseColor.a * matValue1.r;\n  float emission      = matValue1.g;\n\n#else // ENABLE_MULTI_DRAW\n\n#ifndef ENABLE_TEXTURES\n  vec4 baseColor      = BaseColor;\n  float emission      = EmissiveStrength;\n  float opacity       = baseColor.a * Opacity;\n#else\n  vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n  float opacity       = baseColor.a * getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, v_textureCoord) * treeItemOpacity;\n  float emission      = getLuminanceParamValue(EmissiveStrength, EmissiveStrengthTex, EmissiveStrengthTexType, v_textureCoord);\n#endif\n\n#endif // ENABLE_MULTI_DRAW\n\n  // Hacky simple irradiance. \n  float ndotv = dot(normal, viewVector);\n  if (ndotv < 0.0) {\n    normal = -normal;\n    ndotv = dot(normal, viewVector);\n\n    // Note: these 2 lines can be used to debug inverted meshes.\n    //baseColor = vec4(1.0, 0.0, 0.0, 1.0);\n    //ndotv = 1.0;\n  }\n\n  fragColor = vec4((ndotv * baseColor.rgb) + (emission * baseColor.rgb), opacity);\n\n  // Note: the 'treeItemOpacity' is not an input to the lighting, \n  // as we want to also blend off the specular reflections to make an object\n  // fade away to nothing. (not become a transparent glass object).\n  fragColor.a *= treeItemOpacity;\n\n#ifdef DEBUG_GEOM_ID\n  // ///////////////////////\n  // Debug Draw ID (this correlates to GeomID within a GLGeomSet)\n  float geomId = v_geomItemData.w;\n  fragColor.rgb = getDebugColor(geomId);\n  // ///////////////////////\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#elif defined(DRAW_GEOMDATA)\n\n  if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n    discard;\n    return;\n  }\n  if (occlusionCulling != 0) {\n    // Transparent geoms do not render to the occlusion buffer\n    if (testFlag(flags, GEOMITEM_TRANSPARENT)) {\n      discard;\n      return;\n    }\n  }\n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_drawItemIds.x, v_drawItemIds.y, isOrthographic);\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = setFragColor_highlight(v_drawItemIds.x);\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}")}static getPackedMaterialData(A){const g=new Float32Array(8),I=A.getParameter("BaseColor");let C;return C=I instanceof Qg&&I.colorSpace==pA.Gamma?I.value.toLinear():I.value,g[0]=C.r,g[1]=C.g,g[2]=C.b,g[3]=C.a,g[4]=A.getParameter("Opacity").value,g[5]=A.getParameter("EmissiveStrength").value,g}static getMaterialTemplate(){return Ye}}const Ye=new JI("SimpleSurfaceShader_template");e.register("SimpleSurfaceShader",We);class Ke extends DC{constructor(A){super(A,"StandardSuraceShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\nprecision highp int;\n#define GLSLIFY 1\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int isOrthographic;\n\n// Now that we render multiple types of geometry from a single shader\n// we need to know what kind of geometry it is...\nuniform int geomType;\n\nuniform float outlineThickness;\nuniform vec2 viewportSize;\n\n// should be imported by bottom 3\nimport 'GLSLUtils.glsl'\nimport 'transpose.glsl'\nimport 'inverse.glsl'\n\nimport 'geomItemId.glsl'\nimport 'geomType.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n#if defined(DRAW_COLOR)\n#elif defined(DRAW_GEOMDATA)\n#elif defined(DRAW_HIGHLIGHT)\n#endif // DRAW_HIGHLIGHT\n\nvoid main(void) {\n\n  v_drawItemIds = getDrawItemIds();\n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  v_geomItemData = getInstanceData(geomItemId);\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec4 viewPos    = modelViewMatrix * pos;\n  gl_Position     = projectionMatrix * viewPos;\n  v_viewPos = -viewPos.xyz;\n  v_worldPos      = (modelMatrix * pos).xyz;\n\n  mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n  v_viewPos       = -viewPos.xyz;\n  v_viewNormal    = normalMatrix * normals;\n  \n  // offset slightly the lines and points to make them clearly defined.\n  // This ensures that lines drawn over surfaces are solid and not clipped\n  // at all by the surface.\n  if (geomType == TRIANGLES) {\n    if (outlineThickness > 0.00001) {\n      vec2 screenNormal = v_viewNormal.xy;\n      gl_Position.xy += normalize(screenNormal) * ((2.0 / viewportSize) * outlineThickness) * gl_Position.w;\n    }\n  }\n  else if (geomType == LINES) { // start 'LINES'\n    float overlay = 0.00003;\n    if (isOrthographic > 0){\n      gl_Position.z -= overlay;\n    } else {\n      gl_Position.z = mix(gl_Position.z, -gl_Position.z, overlay);\n    }\n  } // end 'LINES'\n  else if (geomType == POINTS) { // start 'POINTS'\n    float overlay = 0.00005;\n    if (isOrthographic > 0){\n      gl_Position.z -= overlay;\n    } else {\n      gl_Position.z = mix(gl_Position.z, -gl_Position.z, overlay);\n    }\n  }  // end 'POINTS'\n\n#ifdef ENABLE_TEXTURES\n  v_textureCoord  = texCoords;\n#endif\n\n}\n"),this.setShaderStage("FRAGMENT_SHADER","precision highp float;\nprecision highp int;\n#define GLSLIFY 1\nimport 'GLSLUtils.glsl'\nimport 'drawItemTexture.glsl' \nimport 'cutaways.glsl'\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\nimport 'GLSLBits.glsl'\n\n/* VS Outputs */\nvarying vec4 v_drawItemIds;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\n// Now that we render multiple types of geometry from a single shader\n// we need to know what kind of geometry it is...\nuniform int geomType;\nimport 'geomType.glsl'\n\nuniform int isOrthographic;\n\n#if defined(DRAW_COLOR)\n\nuniform int renderMode;\nuniform int occluded;\nuniform float outlineThickness;\nuniform vec4 hiddenLineColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\n#ifndef ENABLE_MULTI_DRAW\n\nuniform color BaseColor;\nuniform float AmbientOcclusion;\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\nuniform float EmissiveStrength;\nuniform float Opacity;\n\nuniform color EdgeColor;\nuniform color PointColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\nuniform sampler2D AmbientOcclusionTex;\nuniform int AmbientOcclusionTexType;\n\n#ifdef ENABLE_PBR\nuniform sampler2D RoughnessTex;\nuniform int RoughnessTexType;\n\nuniform sampler2D MetallicTex;\nuniform int MetallicTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform int ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform int NormalTexType;\n#endif // ENABLE_PBR\n\nuniform sampler2D EmissiveStrengthTex;\nuniform int EmissiveStrengthTexType;\n\n#endif // ENABLE_TEXTURES\n#endif // ENABLE_MULTI_DRAW\n\nimport 'PBRSurfaceRadiance.glsl'\n\n#ifdef ENABLE_PBR\nmat3 cotangentFrame( in vec3 normal, in vec3 pos, in vec2 texCoord ) {\n  // https://stackoverflow.com/questions/5255806/how-to-calculate-tangent-and-binormal\n  vec3 n = normal;\n  // derivations of the fragment position\n  vec3 pos_dx = dFdx( pos );\n  vec3 pos_dy = dFdy( pos );\n  // derivations of the texture coordinate\n  vec2 texC_dx = dFdx( texCoord );\n  vec2 texC_dy = dFdy( texCoord );\n  // tangent vector and binormal vector\n  vec3 t = -(texC_dy.y * pos_dx - texC_dx.y * pos_dy);\n  vec3 b = -(texC_dx.x * pos_dy - texC_dy.x * pos_dx);\n\n  t = t - n * dot( t, n ); // orthonormalization ot the tangent vectors\n  b = b - n * dot( b, n ); // orthonormalization of the binormal vectors to the normal vector\n  b = b - t * dot( b, t ); // orthonormalization of the binormal vectors to the tangent vector\n  mat3 tbn = mat3( normalize(t), normalize(b), n );\n\n  return tbn;\n}\n#endif\n\nimport 'computeViewNormal.glsl'\n\n#ifdef DEBUG_GEOM_ID\nimport 'debugColors.glsl'\n#endif\n\n// end DRAW_COLOR\n#elif defined(DRAW_GEOMDATA)\n\nimport 'surfaceGeomData.glsl'\n\n#elif defined(DRAW_HIGHLIGHT)\nimport 'surfaceHighlight.glsl'\n#endif // DRAW_HIGHLIGHT\n\nvoid main(void) {\n  #ifndef ENABLE_ES3\n    vec4 fragColor;\n  #endif\n  \n  int geomItemId = int(v_drawItemIds.x + 0.5);\n  int elemId = int(v_drawItemIds.y + 0.5);\n  int perFaceMaterialId = int(v_drawItemIds.z);\n  int flags = int(v_geomItemData.x + 0.5);\n  float treeItemOpacity = v_geomItemData.y;\n\n  if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n    vec4 cutAwayData   = getCutaway(geomItemId);\n    vec3 planeNormal = cutAwayData.xyz;\n    float planeDist = cutAwayData.w;\n    if (cutaway(v_worldPos, planeNormal, planeDist)) {\n        discard;\n        return;\n    }\n  }\n  vec2 materialCoords = v_geomItemData.zw;\n  if (v_drawItemIds.z > 0.5) {\n    materialCoords.x = v_drawItemIds.z;\n  }\n  \n#if defined(DRAW_COLOR)\n\n  if (geomType == TRIANGLES) { // start 'TRIANGLES'\n\n  // Cutaways\n    if (testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n      if (!gl_FrontFacing) {\n#ifdef ENABLE_ES3\n        fragColor = cutColor;\n#else\n        gl_FragColor = cutColor;\n#endif\n        return;\n      }\n    }\n\n    //////////////////////////////////////////////\n    // Normals\n    vec3 viewNormal;\n    if (length(v_viewNormal) < 0.1) {\n      viewNormal = computeViewNormal(v_viewPos);\n    } else {\n      viewNormal = normalize(v_viewNormal);\n    }\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    \n    vec3 viewVector;\n    if (isOrthographic == 0)\n      viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    else \n      viewVector = vec3(cameraMatrix[2][0], cameraMatrix[2][1], cameraMatrix[2][2]);\n      \n    if (dot(normal, viewVector) < 0.0) {\n      normal = -normal;\n      // Note: this line can be used to debug inverted meshes.\n      //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    //////////////////////////////////////////////\n    // Material\n\n    MaterialParams material;\n\n#ifdef ENABLE_MULTI_DRAW\n    vec4 matValue0      = getMaterialValue(materialCoords, 0);\n    vec4 matValue1      = getMaterialValue(materialCoords, 1);\n    vec4 matValue2      = getMaterialValue(materialCoords, 2);\n\n    material.baseColor     = matValue0.rgb;\n    material.ambientOcclusion      = matValue1.r;\n    material.metallic      = matValue1.g;\n    material.roughness     = matValue1.b;\n    material.reflectance   = matValue1.a;\n\n    material.emission      = matValue2.r;\n    material.opacity       = matValue2.g * matValue0.a;\n    if (material.opacity < 0.001) discard;\n\n#else // ENABLE_MULTI_DRAW\n\n#ifndef ENABLE_TEXTURES\n    material.baseColor     = BaseColor.rgb;\n    material.emission      = EmissiveStrength;\n\n#ifdef ENABLE_PBR\n    material.roughness     = Roughness;\n    material.metallic      = Metallic;\n    material.reflectance   = Reflectance;\n#endif\n\n#else // ENABLE_TEXTURES\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord       = v_worldPos.xz * 0.2;\n    vec2 texCoord          = v_textureCoord;\n\n    vec4 baseColor         = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord);\n\n    material.ambientOcclusion = getLuminanceParamValue(AmbientOcclusion, AmbientOcclusionTex, AmbientOcclusionTexType, texCoord);\n    material.baseColor     = baseColor.rgb;\n    \n    material.opacity       = Opacity * baseColor.a;\n    if (material.opacity < 0.001) discard;\n\n#ifdef ENABLE_PBR\n\n    material.metallic      = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.roughness     = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n\n    // TODO: Communicate that this tex contains the roughness as well.\n    if (MetallicTexType != 0) {\n      vec4 metallicRoughness = vec4(Metallic, Roughness, 0.0, 1.0);\n      metallicRoughness     = texture2D(MetallicTex, texCoord);\n      material.roughness     = metallicRoughness.g;\n      material.metallic     = metallicRoughness.b;\n    }\n\n    material.reflectance   = getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n#endif // ENABLE_PBR\n    material.emission         = getLuminanceParamValue(EmissiveStrength, EmissiveStrengthTex, EmissiveStrengthTexType, texCoord);\n#endif // ENABLE_TEXTURES\n\n#ifdef ENABLE_TEXTURES\n#ifdef ENABLE_PBR\n    if (NormalTexType != 0) {\n      mat3 tbn = cotangentFrame(normal, viewVector, texCoord);\n      normal = normalize(tbn * (texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0));\n    }\n#endif // ENABLE_PBR\n#endif // ENABLE_TEXTURES\n#endif // ENABLE_MULTI_DRAW\n\n    if (outlineThickness > 0.00001) {\n#ifdef ENABLE_MULTI_DRAW\n      vec4 edgeColor      = getMaterialValue(materialCoords, 3);\n      vec4 matValue2      = getMaterialValue(materialCoords, 2);\n      float opacity       = matValue2.g;\n#else \n      vec4 edgeColor      = EdgeColor;\n      float opacity        = Opacity;\n#endif // ENABLE_MULTI_DRAW\n      edgeColor.a = edgeColor.a * opacity * treeItemOpacity;\n      if (edgeColor.a < 0.001) discard;\n      fragColor = edgeColor;\n    } else {\n      if (renderMode == 1) { // Flat\n        fragColor = vec4(material.baseColor, material.opacity);\n      } else if (renderMode == 2) { // Shaded\n        // simple irradiance. \n        float ndotv = dot(normal, viewVector);\n        fragColor = vec4((ndotv * material.baseColor) + (material.emission * material.baseColor), material.opacity);\n      } else if (renderMode == 3) { // PBR\n        fragColor = pbrSurfaceRadiance(material, normal, viewVector);\n      }\n      \n      // Note: the 'treeItemOpacity' is not an input to the PBR lighting, \n      // as we want to also blend off the specular reflections to make an object\n      // fade away to nothing. (not become a transparent glass object).\n      fragColor.a *= treeItemOpacity;\n\n      // Debugging code to help understand what might be happening in the shader.\n      // fragColor = vec4(texture2D(NormalTex, texCoord).rgb, 1.0);\n      // fragColor = metallicRoughness;\n      // fragColor = vec4(material.baseColor, 1.0);;\n      // fragColor = vec4(vec3(material.metallic), 1.0);;\n      // fragColor = vec4(vec3(material.roughness), 1.0);;\n      // fragColor = vec4(vec3(material.ambientOcclusion), 1.0);\n    }\n\n  } // end 'TRIANGLES'\n  else if (geomType == LINES) { // start 'LINES'\n    if (occluded == 1) {\n#ifdef ENABLE_MULTI_DRAW\n      vec4 matValue2      = getMaterialValue(materialCoords, 2);\n      float opacity       = matValue2.g;\n#else \n      float opacity        = Opacity;\n#endif // ENABLE_MULTI_DRAW\n      fragColor = hiddenLineColor;\n      fragColor.a = hiddenLineColor.a * opacity * treeItemOpacity;\n      if (fragColor.a < 0.001) discard;\n    } else {\n#ifdef ENABLE_MULTI_DRAW\n      vec4 edgeColor      = getMaterialValue(materialCoords, 3);\n      vec4 matValue2      = getMaterialValue(materialCoords, 2);\n      float opacity       = matValue2.g;\n#else \n      vec4 edgeColor      = EdgeColor;\n      float opacity        = Opacity;\n#endif // ENABLE_MULTI_DRAW\n      edgeColor.a = edgeColor.a * opacity * treeItemOpacity;\n      if (edgeColor.a < 0.001) discard;\n      fragColor = edgeColor;\n    }\n  } // end 'LINES'\n  else if (geomType == POINTS) { // start 'POINTS'\n#ifdef ENABLE_MULTI_DRAW\n    vec4 pointColor     = getMaterialValue(materialCoords, 4);\n    vec4 matValue2      = getMaterialValue(materialCoords, 2);\n    float opacity       = matValue2.g;\n#else \n    vec4 pointColor      = PointColor;\n    float opacity        = Opacity;\n#endif // ENABLE_MULTI_DRAW\n    pointColor.a = pointColor.a * opacity * treeItemOpacity;\n    if (pointColor.a < 0.001) discard;\n    fragColor = pointColor;\n  }  // end 'POINTS'\n  \n#ifdef DEBUG_GEOM_ID\n  // ///////////////////////\n  // Debug Draw ID (this correlates to GeomID within a GLGeomSet)\n  float geomId = v_geomItemData.w;\n  fragColor.rgb = getDebugColor(geomId);\n  // ///////////////////////\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n// end DRAW_COLOR\n#elif defined(DRAW_GEOMDATA)\n  // Cutaways\n  if (testFlag(flags, GEOMITEM_INVISIBLE_IN_GEOMDATA)) {\n    discard;\n    return;\n  }\n  if (occlusionCulling != 0) {\n    // Transparent geoms do not render to the occlusion buffer\n    if (testFlag(flags, GEOMITEM_TRANSPARENT)) {\n      discard;\n      return;\n    }\n  }\n\n  // We can make geoms invisible to hide them. \n  // Avoid drawing GeomData for geoms that are completely transparent.\n  if (geomType == TRIANGLES) { // start 'TRIANGLES'\n    vec4 matValue0      = getMaterialValue(materialCoords, 0);\n    vec4 matValue2      = getMaterialValue(materialCoords, 2);\n    float opacity          = matValue2.g * matValue0.a * treeItemOpacity;\n    if (opacity < 0.001) {\n      discard;\n      return;\n    }\n  } // end 'TRIANGLES'\n  else if (geomType == LINES) { // start 'LINES'\n#ifdef ENABLE_MULTI_DRAW\n    vec4 edgeColor      = getMaterialValue(materialCoords, 3);\n#else \n    vec4 edgeColor      = EdgeColor;\n#endif // ENABLE_MULTI_DRAW\n    float opacity          = edgeColor.a * treeItemOpacity;\n    if (opacity < 0.001) {\n      discard;\n      return;\n    }\n  } // end 'LINES'\n  else if (geomType == POINTS) { // start 'POINTS'\n#ifdef ENABLE_MULTI_DRAW\n    vec4 pointColor      = getMaterialValue(materialCoords, 4);\n#else \n    vec4 pointColor      = PointColor;\n#endif // ENABLE_MULTI_DRAW\n    float opacity          = pointColor.a * treeItemOpacity;\n    if (opacity < 0.001) {\n      discard;\n      return;\n    }\n  }  // end 'POINTS'\n\n  \n  fragColor = setFragColor_geomData(v_viewPos, floatGeomBuffer, passId, v_drawItemIds.x, v_drawItemIds.y, isOrthographic);\n   \n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = getHighlightColor(geomItemId);\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n\n}")}bind(A,g){if(super.bind(A,g),A instanceof jC){const g=A,I=this.__gl;g.envMap&&g.envMap.bind(g);const{exposure:C,cutColor:i,renderMode:e}=g.unifs;C&&I.uniform1f(C.location,g.exposure),g.renderMode&&e&&("flat"==g.renderMode||"flat-noedges"==g.renderMode?I.uniform1i(e.location,1):"shaded"==g.renderMode||"shaded-noedges"==g.renderMode?I.uniform1i(e.location,2):"pbr"!=g.renderMode&&"pbr-noedges"!=g.renderMode||I.uniform1i(e.location,3)),i&&I.uniform4f(i.location,.3,0,0,1)}return!0}static getPackedMaterialData(A){const g=new Float32Array(20),I=A.getParameter("BaseColor");let C;C=I instanceof Qg&&I.colorSpace==pA.Gamma?I.value.toLinear():I.value,g[0]=C.r,g[1]=C.g,g[2]=C.b,g[3]=C.a,g[4]=A.getParameter("AmbientOcclusion").value,g[5]=A.getParameter("Metallic").value,g[6]=A.getParameter("Roughness").value,g[7]=A.getParameter("Reflectance").value,g[8]=A.getParameter("EmissiveStrength").value,g[9]=A.getParameter("Opacity").value;const i=A.getParameter("EdgeColor").value;g[12]=i.r,g[13]=i.g,g[14]=i.b,g[15]=i.a;const e=A.getParameter("PointColor").value;return g[16]=e.r,g[17]=e.g,g[18]=e.b,g[19]=e.a,g}static getMaterialTemplate(){return pe}}const pe=new DI("StandardSurfaceShader_template");e.register("StandardSurfaceShader",Ke),e.register("TransparentSurfaceShader",Ke);class Ne extends DC{constructor(A){super(A,"ScreenSpaceShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nimport 'GLSLUtils.glsl'\nimport 'geomItemId.glsl'\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\nvoid main(void) {\n  int geomItemId = getGeomItemId();\n  v_geomItemId = float(geomItemId);\n  v_geomItemData  = getInstanceData(geomItemId);\n\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n\n  gl_Position = (modelMatrix * vec4(positions, 1.0));\n\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\n#ifdef ENABLE_MULTI_DRAW\nimport 'drawItemTexture.glsl'\n#endif // ENABLE_MULTI_DRAW\n\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\n\n#if defined(DRAW_COLOR)\n\n  #ifndef ENABLE_MULTI_DRAW\n\n    uniform color BaseColor;\n\n    #ifdef ENABLE_TEXTURES\n      uniform sampler2D BaseColorTex;\n      uniform int BaseColorTexType;\n    #endif\n\n  #endif // ENABLE_MULTI_DRAW\n#endif // DRAW_COLOR\n\n/* VS Outputs */\nvarying float v_geomItemId;\nvarying vec4 v_geomItemData;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n#if defined(DRAW_GEOMDATA)\n  uniform int isOrthographic;\n  import 'surfaceGeomData.glsl'\n#elif defined(DRAW_HIGHLIGHT)\n  import 'surfaceHighlight.glsl'\n#endif // DRAW_HIGHLIGHT\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n  \n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  //////////////////////////////////////////////\n  // Color\n#if defined(DRAW_COLOR)\n\n  #ifdef ENABLE_MULTI_DRAW\n\n    vec2 materialCoords = v_geomItemData.zw;\n    vec4 baseColor = getMaterialValue(materialCoords, 0);\n\n  #else // ENABLE_MULTI_DRAW\n\n  #ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n  #else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n  #endif\n\n  #endif // ENABLE_MULTI_DRAW\n\n    fragColor = baseColor;\n\n  #ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n  #endif\n\n  //////////////////////////////////////////////\n  // GeomData\n#elif defined(DRAW_GEOMDATA)\n  fragColor = setFragColor_geomData(vec3(0,0,0), floatGeomBuffer, passId, v_geomItemId, 0.0, isOrthographic);\n#elif defined(DRAW_HIGHLIGHT)\n  fragColor = setFragColor_highlight(v_geomItemId);\n#endif // DRAW_HIGHLIGHT\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}static isOverlay(){return!0}static getPackedMaterialData(A){const g=new Float32Array(8),I=A.getParameter("BaseColor").value;return g[0]=I.r,g[1]=I.g,g[2]=I.b,g[3]=I.a,g}static getMaterialTemplate(){return Je}}const Je=new NI("ScreenSpaceShader_template");e.register("ScreenSpaceShader",Ne);class De extends bC{constructor(){super(),this.materials={},this.listenerIDs={}}init(A,g){super.init(A,g)}itemAddedToScene(A,g){if(A instanceof kI){const g=A;return!!this.filterGeomItem(g)&&(this.addGeomItem(g),!0)}return!1}itemRemovedFromScene(A,g){return A instanceof kI&&(this.removeGeomItem(A),!0)}filterGeomItem(A){return!0}addGeomItem(A){const g={};this.listenerIDs[A.getId()]=g;const I=()=>{this.removeGeomItem(A),this.renderer.assignTreeItemToGLPass(A)};g["materialParam.valueChanged"]=A.materialParam.on("valueChanged",I),g["geomParam.valueChanged"]=A.geomParam.on("valueChanged",I);const C=A=>{A.isOpaqueStateChanged&&I()},i=A.materialParam.value;this.materials[A.getId()]=i,g["geomItem.opacityChanged"]=A.on("opacityChanged",C),g["material.opacityChanged"]=i.on("opacityChanged",C)}removeGeomItem(A){const g=A.getId(),I=this.listenerIDs[g];delete this.listenerIDs[g],A.materialParam.removeListenerById("valueChanged",I["materialParam.valueChanged"]),A.geomParam.removeListenerById("valueChanged",I["geomParam.valueChanged"]);const C=this.materials[A.getId()];delete this.materials[g],A.removeListenerById("opacityChanged",I["geomItem.opacityChanged"]),C.removeListenerById("opacityChanged",I["material.opacityChanged"])}constructShaders(A){let g,I;const C=this.__renderer.getOrCreateShader(A);return g=C.getGeomDataShaderName()?this.__renderer.getOrCreateShader(C.getGeomDataShaderName()):C,I=C.getSelectedShaderName()?this.__renderer.getOrCreateShader(C.getSelectedShaderName()):C,{glShader:C,glgeomdatashader:g,glselectedshader:I}}getGeomItemAndDist(A){let g,I,C=-1;A instanceof Float32Array?(g=Math.round(A[1]),C=Math.round(A[2]),I=A[3]):(g=A[0]+((63&A[1])<<8),I=r.decode16BitFloatFrom2xUInt8(A.slice(2,3)));const i=this.renderer.glGeomItemLibrary.getGeomItem(g);if(i)return{geomItem:i,componentId:C,dist:I}}}class fe extends DC{constructor(A){super(A,"FattenLinesShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 positions;  //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  v_texCoord = positions.xy+0.5;\n  gl_Position = vec4(positions.xy*2.0, -1.0, 1.0);\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform vec2 screenSize;\n\nuniform float growth;\n\nvarying vec2 v_texCoord;\n\nbool sampleNeiPixel(vec2 fragCoord, inout vec4 res) {\n  res = texture2D(colorTexture, fragCoord/screenSize);\n  if (res.a > 0.0) {\n    return true;\n  }\n  return false;\n}\n\nvec4 samplePixels(vec2 fragCoord) {\n  vec4 res = vec4(0.0);\n  \n  if (sampleNeiPixel(fragCoord, res)) return res; // M\n  \n  // Search surrounding pixels for geoms\n  if (sampleNeiPixel(fragCoord+vec2( 1, 0), res)) return res; // E\n  if (sampleNeiPixel(fragCoord+vec2(-1, 0), res)) return res; // W\n  if (sampleNeiPixel(fragCoord+vec2( 0, 1), res)) return res; // N\n  if (sampleNeiPixel(fragCoord+vec2( 0,-1), res)) return res; // S\n  if (sampleNeiPixel(fragCoord+vec2( 1, 1), res)) return res; // NW\n  if (sampleNeiPixel(fragCoord+vec2(-1, 1), res)) return res; // NE\n  if (sampleNeiPixel(fragCoord+vec2( 1,-1), res)) return res; // SW\n  if (sampleNeiPixel(fragCoord+vec2(-1,-1), res)) return res; // SE\n  \n  return res;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = samplePixels(gl_FragCoord.xy);\n  if (fragColor.a < 0.0001) {\n    discard; \n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}}var Me,Le;!function(A){A[A.TRIANGLES=0]="TRIANGLES",A[A.LINES=1]="LINES",A[A.POINTS=2]="POINTS"}(Me||(Me={}));class Ue extends V{constructor(A){super(),this.glGeomItems=[],this.glGeomIdsMapping={},this.glgeomItemEventHandlers=[],this.freeIndices=[],this.dirtyGeomItems=new Set,this.drawIdsBufferDirty=!0,this.drawIdsArraysAllocators={},this.drawIdsArrays={},this.drawIdsTextures={},this.drawElementCounts={},this.drawElementOffsets={},this.drawOrderToIndex=[],this.indexToDrawIndex=[],this.highlightedItems={},this.highlightedIdsArraysAllocators={},this.highlightElementCounts={},this.highlightElementOffsets={},this.highlightedIdsArray={},this.highlightedIdsTextures={},this.dirtyHighlightedGeomItems=new Set,this.highlightedIdsBufferDirty=!0,this.linesGeomDataBuffer=null,this.fattenLinesShader=null,this.quad=null,this.fbo=null,this.renderer=A,this.gl=A.gl,this.renderer.glGeomLibrary.on("geomDataChanged",(A=>{const g=this.glGeomIdsMapping[A.index];null!=g&&g.forEach((A=>{this.dirtyGeomItems.add(A),this.drawIdsBufferDirty||(this.drawIdsBufferDirty=!0,this.emit("updated"))}))}))}addGLGeomItem(A){const g=this.freeIndices.length>0?this.freeIndices.pop():this.glGeomItems.length;this.glGeomIdsMapping[A.geomId]?this.glGeomIdsMapping[A.geomId].push(g):this.glGeomIdsMapping[A.geomId]=[g];const I={};A.visible&&(this.indexToDrawIndex[g]=this.drawOrderToIndex.length,this.drawOrderToIndex.push(g),this.dirtyGeomItems.add(g)),I.visibilityChanged=I=>{if(I.visible){const I=this.renderer.glGeomLibrary.getGeomBuffers(A.geomId);for(let C in I.counts){if(0==I.counts[C])continue;const i=this.drawIdsArraysAllocators[C];if(i){const e=i.getAllocation(g);if(e){const g=e.start;if(A.shattered)for(let A=0;A<e.size;A++)this.drawElementCounts[C][g+A]=I.subGeomCounts[C][A];else{const A=I.materialSubGeoms[C];for(let I=0;I<e.size;I++){const i=A[I];this.drawElementCounts[C][g+I]=i.count}}}}}}else for(let A in this.drawIdsArraysAllocators){const I=this.drawIdsArraysAllocators[A];if(I){const C=I.getAllocation(g);if(C){const g=C.start;for(let I=0;I<C.size;I++)this.drawElementCounts[A][g+I]=0}}}this.emit("updated")},A.on("visibilityChanged",I.visibilityChanged);const C=A=>{const I=A.indexOf(":");let C=[];var i,e;(-1!=I&&(C=A.substring(I+1).split(",").map((A=>Number.parseInt(A)))),!this.highlightedItems[g]||(i=this.highlightedItems[g],e=C,i.length!=e.length||i.some(((A,g)=>A!=e[g]))))&&(this.highlightedItems[g]=C,this.highlightedIdsBufferDirty=!0,this.emit("updated"))};A.geomItem.isHighlighted()&&C(A.geomItem.getHighlightName()),I.highlightChanged=A=>{A&&A.name?C(A.name):(delete this.highlightedItems[g],this.highlightedIdsBufferDirty=!0,this.emit("updated"))},A.geomItem.on("highlightChanged",I.highlightChanged),I.shatterStateChanged=A=>{this.dirtyGeomItems.add(g),this.drawIdsBufferDirty=!0,this.renderer.renderGeomDataFbos()},A.on("shatterStateChanged",I.shatterStateChanged);A.geomItem.geomParam.value.materials.forEach((A=>{this.renderer.glMaterialLibrary.addMaterial(A)}));this.glGeomItems[g]=A,this.glgeomItemEventHandlers[g]=I,this.drawIdsBufferDirty=!0,this.emit("updated")}removeGLGeomItem(A){const g=this.glGeomItems.indexOf(A),I=this.glGeomIdsMapping[A.geomId];I.splice(I.indexOf(g),1),0==I.length&&delete this.glGeomIdsMapping[A.geomId];const C=this.glgeomItemEventHandlers[g];A.geomItem.off("highlightChanged",C.highlightChanged),A.off("visibilityChanged",C.visibilityChanged),this.glGeomItems[g]=null,this.glgeomItemEventHandlers[g]=null,this.freeIndices.push(g),this.dirtyGeomItems.has(g)&&this.dirtyGeomItems.delete(g);for(let A in this.drawIdsArraysAllocators){const I=this.drawIdsArraysAllocators[A].getAllocation(g);if(I){for(let g=0;g<I.size;g++)this.drawElementOffsets[A][I.start+g]=0,this.drawElementCounts[A][I.start+g]=0;this.drawIdsArraysAllocators[A].deallocate(g)}}if(A.isVisible()){const A=this.drawOrderToIndex.indexOf(g);this.drawOrderToIndex.splice(A,1),this.indexToDrawIndex[g]=-1,this.drawIdsBufferDirty=!0}A.geomItem.isHighlighted()&&(delete this.highlightedItems[g],this.highlightedIdsBufferDirty=!0),this.emit("updated")}updateDrawIDsBuffer(A){this.dirtyGeomItems.forEach((A=>{const g=this.glGeomItems[A];if(g){const I=this.renderer.glGeomLibrary.getGeomBuffers(g.geomId);let C={};if(g.shattered)for(let A in I.subGeomCounts)C[A]=I.subGeomCounts[A].length;else for(let A in I.materialSubGeoms)C[A]=I.materialSubGeoms[A].length;for(let g in C){const I=C[g];this.drawIdsArraysAllocators[g]||(this.drawIdsArraysAllocators[g]=new X);const i=this.drawIdsArraysAllocators[g].getAllocation(A);if(i)for(let A=0;A<i.size;A++)this.drawElementCounts[g][i.start+A]=0;this.drawIdsArraysAllocators[g].allocate(A,I)}}}));let g=!1;for(let A in this.drawIdsArraysAllocators){const I=this.drawIdsArraysAllocators[A];(!this.drawElementCounts[A]||I.reservedSpace>this.drawElementCounts[A].length-1)&&(this.drawElementCounts[A]&&I.reservedSpace>this.drawElementCounts[A].length-1&&(g=!0),this.drawIdsArrays[A]=new Float32Array(4*I.reservedSpace),this.drawElementOffsets[A]=new Int32Array(I.reservedSpace+1),this.drawElementCounts[A]=new Int32Array(I.reservedSpace+1))}if(g)for(let A=0;A<this.drawOrderToIndex.length;A++)this.dirtyGeomItems.add(A);this.dirtyGeomItems.forEach((A=>{const g=this.glGeomItems[A];if(!g)return;const I=this.renderer.glGeomLibrary.getGeomOffsetAndCount(g.geomId),C=this.renderer.glGeomLibrary.getGeomBuffers(g.geomId),i=g.isVisible();if(g.shattered){let e=0;const t=(t,B,o)=>{const s=this.drawIdsArraysAllocators[o],a=this.drawIdsArrays[o],l=this.drawElementOffsets[o],n=this.drawElementCounts[o],d=s.getAllocation(A);if(!d)return;const h=C.materials;for(let A=0;A<t.length;A++){const o=d.start+A;if(l[o]=I[0]+4*t[A],n[o]=i?B[A]:0,a[4*o+0]=g.geomItemId,a[4*o+1]=e+1,h.length>0&&C.subGeomMaterialIndices[A]>0){const g=C.subGeomMaterialIndices[A]-1,I=C.materials[g];this.renderer.glMaterialLibrary.addMaterial(I);const i=this.renderer.glMaterialLibrary.getMaterialAllocation(I);a[4*o+2]=i.start}else a[4*o+2]=0;a[4*o+3]=0,e++}};t(C.subGeomOffsets.TRIANGLES,C.subGeomCounts.TRIANGLES,"TRIANGLES"),t(C.subGeomOffsets.LINES,C.subGeomCounts.LINES,"LINES"),t(C.subGeomOffsets.POINTS,C.subGeomCounts.POINTS,"POINTS")}else{const e=(e,t)=>{const B=this.drawIdsArraysAllocators[t],o=this.drawIdsArrays[t],s=this.drawElementOffsets[t],a=this.drawElementCounts[t],l=B.getAllocation(A);if(!l)return;const n=C.materials;for(let A=0;A<e.length;A++){const t=e[A],B=l.start+A;if(s[B]=I[0]+4*t.offset,a[B]=i?t.count:0,o[4*B+0]=g.geomItemId,o[4*B+1]=0,n.length>0&&t.materialId>=0&&C.materials[t.materialId]){const A=C.materials[t.materialId];this.renderer.glMaterialLibrary.addMaterial(A);const g=this.renderer.glMaterialLibrary.getMaterialAllocation(A);o[4*B+2]=g.start}else o[4*B+2]=0;o[4*B+3]=0}};for(let g in C.materialSubGeoms){if(!this.drawIdsArraysAllocators[g].getAllocation(A))continue;e(C.materialSubGeoms[g],g)}}}));const I=this.renderer.gl;if(!I.multiDrawElements)return;const C=C=>{const i=this.drawIdsArrays[C];let e=this.drawIdsTextures[C];const t=this.drawIdsArraysAllocators[C].reservedSpace,B=A.boundTextures++;I.activeTexture(I.TEXTURE0+B);const o=r.nextPow2(Math.ceil(Math.sqrt(t)));if(e){if(e.width<o||e.height<o){e.resize(o,o);for(let A=0;A<this.drawOrderToIndex.length;A++)this.dirtyGeomItems.add(A);g=!0}}else e=new HC(this.gl,{format:"RGBA",type:"FLOAT",width:o,height:o,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.drawIdsTextures[C]=e,g=!0;{const A=e,t=e.width;I.bindTexture(I.TEXTURE_2D,A.glTex);const B=0,o=0,s=1,a=A.getFormat(),l=A.getType();if(g){const A=this.drawIdsArraysAllocators[C].allocatedSpace,g=Math.ceil((o+A)/t);let e=0,n=A,d=o;for(let A=0;A<g;A++){let A;d+n>t?(A=t-d,d=0):A=n;const g=e%t,C=Math.floor(e/t),o=i.subarray(4*e,4*(e+A));if(o.length!=4*A)throw new Error("Invalid drawIds subarray :"+o.length+" width:"+A);I.texSubImage2D(I.TEXTURE_2D,B,g,C,A,s,a,l,o),e+=A,n-=A}}else{const A=this.drawIdsArraysAllocators[C];this.dirtyGeomItems.forEach((g=>{const C=A.getAllocation(g);if(!C)return;const e=C.start,o=C.size,n=e%t,d=Math.ceil((n+o)/t);let h=0,c=o,r=n;for(let A=0;A<d;A++){let A;r+c>t?(A=t-r,r=0):A=c;const g=(e+h)%t,C=Math.floor((e+h)/t),o=i.subarray(4*(e+h),4*(e+h+A));if(o.length!=4*A)throw new Error("Invalid drawIds subarray :"+o.length+" width:"+A);I.texSubImage2D(I.TEXTURE_2D,B,g,C,A,s,a,l,o),h+=A,c-=A}}))}}I.bindTexture(I.TEXTURE_2D,null),A.boundTextures--};for(let A in this.drawIdsArrays)C(A);this.dirtyGeomItems=new Set,this.drawIdsBufferDirty=!1}updateHighlightedIDsBuffer(A){if(this.highlightedIdsBufferDirty){this.highlightedIdsArraysAllocators={},this.highlightedIdsArray={},this.highlightElementOffsets={},this.highlightElementCounts={};for(let A in this.highlightedItems){const g=Number.parseInt(A),I=this.highlightedItems[A],C=this.glGeomItems[g],i=this.renderer.glGeomLibrary.getGeomBuffers(C.geomId);let e={TRIANGLES:0,LINES:0,POINTS:0};if(I.length>0)I.forEach((A=>{if(A<i.subGeomCounts.TRIANGLES.length)e.TRIANGLES+=1;else{const g=A-i.subGeomCounts.TRIANGLES.length;if(g<i.subGeomCounts.LINES.length)e.LINES+=1;else{g-i.subGeomCounts.LINES.length<i.subGeomCounts.POINTS.length&&(e.POINTS+=1)}}}));else for(let A in i.counts)i.counts[A]>0&&(e[A]=1);for(let A in e){const I=e[A];0!=I&&(this.highlightedIdsArraysAllocators[A]||(this.highlightedIdsArraysAllocators[A]=new X),this.highlightedIdsArraysAllocators[A].allocate(g,I))}}for(let A in this.highlightedIdsArraysAllocators){const g=this.highlightedIdsArraysAllocators[A];(!this.highlightElementCounts[A]||g.reservedSpace>this.highlightElementCounts[A].length-1)&&(this.highlightedIdsArray[A]=new Float32Array(4*g.reservedSpace),this.highlightElementOffsets[A]=new Int32Array(g.reservedSpace+1),this.highlightElementCounts[A]=new Int32Array(g.reservedSpace+1))}const A=4;for(let g in this.highlightedItems){const I=Number.parseInt(g),C=this.highlightedItems[g],i=this.glGeomItems[I],e=this.renderer.glGeomLibrary.getGeomOffsetAndCount(i.geomId),t=this.renderer.glGeomLibrary.getGeomBuffers(i.geomId);if(0!=C.length)C.forEach(((g,C)=>{const B=(t,B,o,s)=>{const a=this.highlightedIdsArraysAllocators[o],l=this.highlightedIdsArray[o],n=this.highlightElementOffsets[o],d=this.highlightElementCounts[o],h=a.getAllocation(I).start+C;n[h]=e[0]+t[s]*A,d[h]=B[s],l[4*h+0]=i.geomItemId,l[4*h+1]=g+1,l[4*h+2]=0,l[4*h+3]=0};if(g<t.subGeomCounts.TRIANGLES.length)B(t.subGeomOffsets.TRIANGLES,t.subGeomCounts.TRIANGLES,"TRIANGLES",g);else{const A=g-t.subGeomCounts.TRIANGLES.length;if(A<t.subGeomCounts.LINES.length)B(t.subGeomOffsets.LINES,t.subGeomCounts.LINES,"LINES",A);else{t.subGeomCounts.LINES.length;t.subGeomCounts.POINTS.length}}}));else for(let g in t.offsets){const C=t.counts[g];if(0==C)continue;const B=t.offsets[g],o=this.highlightedIdsArraysAllocators[g].getAllocation(I).start;this.highlightElementOffsets[g][o]=e[0]+B*A,this.highlightElementCounts[g][o]=C,this.highlightedIdsArray[g][4*o+0]=i.geomItemId}}this.highlightedIdsBufferDirty=!1}const g=this.renderer.gl;if(!g.multiDrawElements)return;const I=I=>{const C=this.highlightedIdsArray[I];if(!C||0==C.length)return;let i=this.highlightedIdsTextures[I];const e=this.highlightedIdsArraysAllocators[I].reservedSpace,t=A.boundTextures++;g.activeTexture(g.TEXTURE0+t);const B=r.nextPow2(Math.ceil(Math.sqrt(e)));i?(i.width<B||i.height<B)&&i.resize(B,B):(i=new HC(this.gl,{format:"RGBA",type:"FLOAT",width:B,height:B,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.highlightedIdsTextures[I]=i);{const A=i,e=i.width;g.bindTexture(g.TEXTURE_2D,A.glTex);const t=0,B=0,o=1,s=A.getFormat(),a=A.getType(),l=this.highlightedIdsArraysAllocators[I].allocatedSpace,n=Math.ceil((B+l)/e);let d=0,h=l,c=B;for(let A=0;A<n;A++){let A;c+h>e?(A=e-c,c=0):A=h;const I=d%e,i=Math.floor(d/e),B=C.subarray(4*d,4*(d+A));if(B.length!=4*A)throw new Error("Invalid drawIds subarray :"+B.length+" width:"+A);g.texSubImage2D(g.TEXTURE_2D,t,I,i,A,o,s,a,B),d+=A,h-=A}}g.bindTexture(g.TEXTURE_2D,null),A.boundTextures--};for(let A in this.highlightedIdsArray)I(A)}draw(A){if(0==this.drawOrderToIndex.length)return;this.drawIdsBufferDirty&&this.updateDrawIDsBuffer(A),A.pushGLStack();const g=this.drawIdsArrays,I=this.drawElementCounts,C=this.drawElementOffsets,i=this.drawIdsTextures,e=this.drawIdsArraysAllocators,t=this.gl,B=A.unifs;t.depthFunc(t.LEQUAL);const{drawIdsTexture:o,geomType:s,outlineThickness:a,viewportSize:l,occluded:n,renderMode:d}=A.unifs,h=A instanceof jC&&d?A.renderMode:null,c="flat-noedges"!=h&&"shaded-noedges"!=h&&"pbr-noedges"!=h,r=A instanceof jC&&a&&l&&"geometry"==A.outlineMethod&&A.outlineThickness>0&&c,G=r&&"wireframe"==h,m=A.hiddenLineColor&&A.hiddenLineColor.a>0&&n;if(G?(t.enable(t.STENCIL_TEST),t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT),t.stencilOpSeparate(t.FRONT,t.DECR_WRAP,t.DECR_WRAP,t.DECR_WRAP),t.stencilOpSeparate(t.BACK,t.INCR_WRAP,t.INCR_WRAP,t.INCR_WRAP),t.stencilFunc(t.ALWAYS,0,255),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.DEPTH_TEST),t.depthMask(!1),t.colorMask(!1,!1,!1,!1)):"hiddenline"==h?t.colorMask(!1,!1,!1,!1):t.disable(t.CULL_FACE),g.TRIANGLES&&e.TRIANGLES.allocatedSpace>0)if(t.multiDrawElements&&i.TRIANGLES.bindToUniform(A,o),s&&t.uniform1i(s.location,Me.TRIANGLES),a&&t.uniform1f(a.location,0),A.bindViewports(B,(()=>{this.multiDrawMeshes(A,g.TRIANGLES,I.TRIANGLES,C.TRIANGLES,e.TRIANGLES.allocatedSpace)})),r){if(t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.uniform1f(a.location,this.renderer.outlineThickness*window.devicePixelRatio),t.uniform2f(l.location,A.region[2]-A.region[0],A.region[3]-A.region[1]),"hiddenline"==h&&t.colorMask(!0,!0,!0,!1),G||(A.glEnable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)),A.bindViewports(B,(()=>{this.multiDrawMeshes(A,g.TRIANGLES,I.TRIANGLES,C.TRIANGLES,e.TRIANGLES.allocatedSpace)})),t.disable(t.CULL_FACE),t.cullFace(t.BACK),G){t.enable(t.DEPTH_TEST),t.depthMask(!0),t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),A.glEnable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);const g=A.glShader,I=A.shaderkey,C=this.renderer.screenQuad;C.bindShader(A),C.draw(A,this.renderer.outlineColor),g.bind(A,I),this.renderer.glGeomItemLibrary.bind(A),this.renderer.glGeomLibrary.bind(A),this.renderer.glMaterialLibrary.bind(A),t.disable(t.STENCIL_TEST)}}else A.glEnable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);if(c&&g.LINES&&e.LINES.allocatedSpace>0&&(t.multiDrawElements&&i.LINES.bindToUniform(A,o),s&&t.uniform1i(s.location,Me.LINES),A.bindViewports(B,(()=>{this.multiDrawLines(A,g.LINES,I.LINES,C.LINES,e.LINES.allocatedSpace)})),m)){const{hiddenLineColor:i}=A.unifs;t.uniform1i(n.location,1),t.uniform4fv(i.location,A.hiddenLineColor.asArray()),t.depthFunc(t.GREATER),t.depthMask(!1),A.bindViewports(B,(()=>{this.multiDrawLines(A,g.LINES,I.LINES,C.LINES,e.LINES.allocatedSpace)})),t.depthFunc(t.LEQUAL),t.depthMask(!0),t.uniform1i(n.location,0)}if(g.POINTS&&e.POINTS.allocatedSpace>0&&(t.multiDrawElements&&i.POINTS.bindToUniform(A,o),s&&t.uniform1i(s.location,Me.POINTS),A.bindViewports(B,(()=>{this.multiDrawPoints(A,g.POINTS,I.POINTS,C.POINTS,e.POINTS.allocatedSpace)})),m)){const{hiddenLineColor:i}=A.unifs;t.uniform1i(n.location,1),t.uniform4fv(i.location,A.hiddenLineColor.asArray()),t.depthFunc(t.GREATER),t.depthMask(!1),A.bindViewports(B,(()=>{this.multiDrawPoints(A,g.POINTS,I.POINTS,C.POINTS,e.POINTS.allocatedSpace)})),t.depthFunc(t.LEQUAL),t.depthMask(!0),t.uniform1i(n.location,0)}s&&t.uniform1i(s.location,0),A.popGLStack()}drawGeomData(A){this.drawIdsBufferDirty&&this.updateDrawIDsBuffer(A),A.pushGLStack();const g=this.renderer.gl,I=A.unifs,{drawIdsTexture:C,geomType:i}=I,e=this.drawElementCounts,t=this.drawElementOffsets,B=this.drawIdsTextures,o=this.drawIdsArraysAllocators,s=this.drawIdsArrays;"wireframe"!=this.renderer.renderMode&&A.bindViewports(I,(()=>{s.TRIANGLES&&o.TRIANGLES.allocatedSpace>0&&(g.multiDrawElements&&B.TRIANGLES.bindToUniform(A,C),i&&g.uniform1i(i.location,Me.TRIANGLES),this.multiDrawMeshes(A,s.TRIANGLES,e.TRIANGLES,t.TRIANGLES,o.TRIANGLES.allocatedSpace))}));if(A.geomDataFbo){this.linesGeomDataBuffer||(this.linesGeomDataBuffer=new HC(g,{type:this.renderer.floatGeomBuffer?"FLOAT":"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:1,height:2}),this.fattenLinesShader=new fe(g),this.quad=new Yi(g,new AI(1,1)));const I=A.geomDataFbo,C=I.width,i=I.height;if(this.linesGeomDataBuffer.width!=C||this.linesGeomDataBuffer.height!=i){this.fbo&&(g.deleteFramebuffer(this.fbo),this.fbo=null),this.linesGeomDataBuffer.resize(C,i),this.fbo=g.createFramebuffer();const A=this.linesGeomDataBuffer.glTex,e=I.__depthTexture;"webgl2"==g.name?(g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.fbo),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,e,0)):(g.bindFramebuffer(g.FRAMEBUFFER,this.fbo),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0),g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,e,0)),MC(g,C,i)}else"webgl2"==g.name?g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.fbo):g.bindFramebuffer(g.FRAMEBUFFER,this.fbo);g.colorMask(!0,!0,!0,!0),g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT)}if(A.bindViewports(I,(()=>{s.LINES&&o.LINES.allocatedSpace>0&&(g.multiDrawElements&&B.LINES.bindToUniform(A,C),i&&g.uniform1i(i.location,Me.LINES),this.multiDrawLines(A,s.LINES,e.LINES,t.LINES,o.LINES.allocatedSpace)),s.POINTS&&o.POINTS.allocatedSpace>0&&(g.multiDrawElements&&B.POINTS.bindToUniform(A,C),i&&g.uniform1i(i.location,Me.POINTS),this.multiDrawPoints(A,s.POINTS,e.POINTS,t.POINTS,o.POINTS.allocatedSpace))})),this.linesGeomDataBuffer&&A.geomDataFbo){A.boundRendertarget=null,A.geomDataFbo.bindForWriting(A);const I=A.glShader,C=A.shaderkey;this.fattenLinesShader.bind(A),g.disable(g.DEPTH_TEST);const{colorTexture:i,screenSize:e}=A.unifs;this.linesGeomDataBuffer.bindToUniform(A,i);const t=A.geomDataFbo;g.uniform2f(e.location,t.width,t.height),this.quad.bindAndDraw(A),g.enable(g.DEPTH_TEST),I.bind(A,C),this.renderer.glGeomLibrary.bind(A),this.renderer.glMaterialLibrary.bind(A)}A.popGLStack()}drawHighlighted(A){if(0==Object.keys(this.highlightedItems).length)return;this.highlightedIdsBufferDirty&&this.updateHighlightedIDsBuffer(A),A.pushGLStack();const g=this.highlightedIdsArray,I=this.highlightElementCounts,C=this.highlightElementOffsets,i=this.highlightedIdsTextures,e=this.highlightedIdsArraysAllocators,t=A.unifs,B=this.renderer.gl;B.depthFunc(B.LEQUAL),A.glDisable(B.CULL_FACE);const{drawIdsTexture:o,geomType:s}=A.unifs;A.bindViewports(t,(()=>{g.TRIANGLES&&e.TRIANGLES.allocatedSpace>0&&(B.multiDrawElements&&i.TRIANGLES.bindToUniform(A,o),s&&B.uniform1i(s.location,Me.TRIANGLES),this.multiDrawMeshes(A,g.TRIANGLES,I.TRIANGLES,C.TRIANGLES,e.TRIANGLES.allocatedSpace)),g.LINES&&e.LINES.allocatedSpace>0&&(B.multiDrawElements&&i.LINES.bindToUniform(A,o),s&&B.uniform1i(s.location,Me.LINES),this.multiDrawLines(A,g.LINES,I.LINES,C.LINES,e.LINES.allocatedSpace)),g.POINTS&&e.POINTS.allocatedSpace>0&&(B.multiDrawElements&&i.POINTS.bindToUniform(A,o),s&&B.uniform1i(s.location,Me.POINTS),this.multiDrawPoints(A,g.POINTS,I.POINTS,C.POINTS,e.POINTS.allocatedSpace))})),s&&B.uniform1i(s.location,0),A.popGLStack()}multiDrawMeshes(A,g,I,C,i){const e=this.gl;if(e.multiDrawElements)e.multiDrawElements(e.TRIANGLES,I,0,e.UNSIGNED_INT,C,0,i);else{const{geomItemId:t}=A.unifs;for(let A=0;A<i;A++)e.uniform1i(t.location,g[4*A]),e.drawElements(e.TRIANGLES,I[A],e.UNSIGNED_INT,C[A])}}multiDrawLines(A,g,I,C,i){const e=this.gl;if(e.multiDrawElements)e.multiDrawElements(e.LINES,I,0,e.UNSIGNED_INT,C,0,i);else{const{geomItemId:t}=A.unifs;for(let A=0;A<i;A++)e.uniform1i(t.location,g[4*A]),e.drawElements(e.LINES,I[A],e.UNSIGNED_INT,C[A])}}multiDrawPoints(A,g,I,C,i){const e=this.gl;if(e.multiDrawElements)e.multiDrawElements(e.POINTS,I,0,e.UNSIGNED_INT,C,0,i);else{const{geomItemId:t}=A.unifs;for(let A=0;A<i;A++)e.uniform1i(t.location,g[4*A]),e.drawElements(e.POINTS,I[A],e.UNSIGNED_INT,C[A])}}sortItems(A){this.drawIdsBufferDirty}destroy(){for(let A in this.drawIdsTextures)this.drawIdsTextures[A].destroy();for(let A in this.highlightedIdsTextures)this.highlightedIdsTextures[A].destroy();this.emit("destructing")}}class ve extends V{constructor(A){super(),this.glGeomItems=[],this.glGeomIdsMapping={},this.glgeomItemEventHandlers=[],this.freeIndices=[],this.viewPos=new o,this.drawElementCounts=new Int32Array(0),this.drawElementOffsets=new Int32Array(0),this.highlightElementCounts=new Int32Array(0),this.highlightElementOffsets=new Int32Array(0),this.drawOrderToIndex=[],this.indexToDrawIndex=[],this.drawIdsArray=new Float32Array(0),this.drawIdsBufferDirty=!0,this.drawIdsTexture=null,this.highlightedItems=[],this.highlightedIdsArray=null,this.highlightedIdsTexture=null,this.highlightedIdsBufferDirty=!1,this.dirtyGeomIndices=new Set,this.renderer=A,this.gl=A.gl,this.renderer.glGeomLibrary.on("geomDataChanged",(A=>{this.dirtyGeomIndices.add(A.index)}))}addGLGeomItem(A){const g=this.freeIndices.length>0?this.freeIndices.pop():this.glGeomItems.length;this.glGeomIdsMapping[A.geomId]?this.glGeomIdsMapping[A.geomId].push(g):this.glGeomIdsMapping[A.geomId]=[g],this.indexToDrawIndex[g]=this.drawOrderToIndex.length,this.drawOrderToIndex.push(g);const I={};I.visibilityChanged=I=>{const C=this.indexToDrawIndex[g];if(I.visible){const g=this.renderer.glGeomLibrary.getGeomOffsetAndCount(A.geomId);this.drawElementCounts[C]=g[1]}else this.drawElementCounts[C]=0;this.emit("updated")},A.on("visibilityChanged",I.visibilityChanged),A.geomItem.isHighlighted()&&(this.highlightedItems.push(A),this.highlightedIdsBufferDirty=!0),I.highlightChanged=g=>{if(g&&g.name){if(this.highlightedItems.includes(A))return;this.highlightedItems.push(A)}else this.highlightedItems.splice(this.highlightedItems.indexOf(A),1);this.highlightedIdsBufferDirty=!0,this.emit("updated")},A.geomItem.on("highlightChanged",I.highlightChanged),this.glGeomItems[g]=A,this.glgeomItemEventHandlers[g]=I,this.drawIdsBufferDirty=!0,this.emit("updated")}removeGLGeomItem(A){const g=this.glGeomItems.indexOf(A),I=this.glGeomIdsMapping[A.geomId];I.splice(I.indexOf(g),1),0==I.length&&(delete this.glGeomIdsMapping[A.geomId],this.dirtyGeomIndices.has(A.geomId)&&this.dirtyGeomIndices.delete(A.geomId));const C=this.glgeomItemEventHandlers[g];if(A.geomItem.off("highlightChanged",C.highlightChanged),A.off("visibilityChanged",C.visibilityChanged),this.glGeomItems[g]=null,this.glgeomItemEventHandlers[g]=null,this.drawIdsArray[g]=0,this.drawElementOffsets[g]=0,this.drawElementCounts[g]=0,this.freeIndices.push(g),A.isVisible()){const A=this.drawOrderToIndex.indexOf(g);this.drawOrderToIndex.splice(A,1),this.indexToDrawIndex[g]=-1,this.drawElementCounts[A]=0,this.drawIdsBufferDirty=!0}if(A.geomItem.isHighlighted()){const g=this.highlightedItems.indexOf(A);this.highlightedItems.splice(g,1),this.highlightedIdsBufferDirty=!0}this.emit("updated")}cleanGeomIds(){this.dirtyGeomIndices.forEach((A=>{const g=this.glGeomIdsMapping[A];if(null!=g){const I=this.renderer.glGeomLibrary.getGeomOffsetAndCount(A);g.forEach((A=>{const g=this.glGeomItems[A];if(g.isVisible()){const C=this.indexToDrawIndex[A];this.drawElementOffsets[C]=I[0],this.drawElementCounts[C]=I[1],this.drawIdsArray[C]=g.geomItemId;const i=this.highlightedItems.indexOf(g);-1!=i&&(this.highlightElementOffsets[i]=I[0],this.highlightElementCounts[i]=I[1])}}))}})),this.dirtyGeomIndices=new Set}updateDrawIDsBuffer(A){(!this.drawIdsArray||this.drawOrderToIndex.length>this.drawIdsArray.length)&&(this.drawIdsArray=new Float32Array(this.drawOrderToIndex.length),this.drawElementOffsets=new Int32Array(this.drawOrderToIndex.length+1),this.drawElementCounts=new Int32Array(this.drawOrderToIndex.length+1)),this.drawOrderToIndex.forEach(((A,g)=>{const I=this.glGeomItems[A];if(!I)return;const C=this.renderer.glGeomLibrary.getGeomOffsetAndCount(I.geomId);this.drawElementOffsets[g]=C[0],this.drawElementCounts[g]=I.isVisible()?C[1]:0,this.drawIdsArray[g]=I.geomItemId,this.indexToDrawIndex[A]=g})),this.dirtyGeomIndices=new Set;const g=this.renderer.gl;if(!g.multiDrawElements)return;const I=A.boundTextures++;g.activeTexture(g.TEXTURE0+I);const C=2*r.nextPow2(Math.ceil(Math.sqrt(this.drawOrderToIndex.length)));this.drawIdsTexture?(this.drawIdsTexture.width<C||this.drawIdsTexture.height<C)&&this.drawIdsTexture.resize(C,C):this.drawIdsTexture=new HC(this.gl,{format:"webgl2"==g.name?"RED":"ALPHA",type:"FLOAT",width:C,height:C,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1});{const A=this.drawIdsTexture,I=this.drawIdsTexture.width;g.bindTexture(g.TEXTURE_2D,A.glTex);const C=0,i=0,e=1,t=A.getFormat(),B=A.getType(),o=Math.ceil((i+this.drawOrderToIndex.length)/I);let s=0,a=this.drawOrderToIndex.length,l=i;for(let A=0;A<o;A++){let A;l+a>I?(A=I-l,l=0):A=a;const i=s%I,o=Math.floor(s/I),n=this.drawIdsArray.subarray(s,s+A);g.texSubImage2D(g.TEXTURE_2D,C,i,o,A,e,t,B,n),s+=A,a-=A}}g.bindTexture(g.TEXTURE_2D,null),A.boundTextures--,this.drawIdsBufferDirty=!1}updateHighlightedIDsBuffer(A){if(this.highlightedIdsBufferDirty){(!this.highlightedIdsArray||this.highlightedItems.length>this.highlightedIdsArray.length)&&(this.highlightedIdsArray=new Float32Array(this.highlightedItems.length),this.highlightElementOffsets=new Int32Array(this.highlightedItems.length+1),this.highlightElementCounts=new Int32Array(this.highlightedItems.length+1)),this.highlightedItems.forEach(((A,g)=>{this.highlightedIdsArray[g]=A.geomItemId;const I=this.renderer.glGeomLibrary.getGeomOffsetAndCount(A.geomId);this.highlightElementOffsets[g]=I[0],this.highlightElementCounts[g]=I[1]}));for(let A=this.highlightedItems.length;A<this.highlightElementCounts.length;A++)this.highlightElementOffsets[A]=0,this.highlightElementCounts[A]=0;this.highlightedIdsBufferDirty=!1}const g=this.renderer.gl;if(!g.multiDrawElements)return;const I=A.boundTextures++;g.activeTexture(g.TEXTURE0+I);const C=r.nextPow2(Math.ceil(Math.sqrt(this.highlightedItems.length)));this.highlightedIdsTexture?(this.highlightedIdsTexture.width<C||this.highlightedIdsTexture.height<C)&&this.highlightedIdsTexture.resize(C,C):this.highlightedIdsTexture=new HC(this.gl,{format:"webgl2"==g.name?"RED":"ALPHA",type:"FLOAT",width:C,height:C,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1});{const A=this.highlightedIdsTexture,I=this.highlightedIdsTexture.width;g.bindTexture(g.TEXTURE_2D,A.glTex);const C=0,i=0,e=1,t=A.getFormat(),B=A.getType(),o=Math.ceil((i+this.highlightedIdsArray.length)/I);let s=0,a=this.highlightedIdsArray.length,l=i;for(let A=0;A<o;A++){let A;l+a>I?(A=I-l,l=0):A=a;const i=s%I,o=Math.floor(s/I),n=this.highlightedIdsArray.subarray(s,s+A);g.texSubImage2D(g.TEXTURE_2D,C,i,o,A,e,t,B,n),s+=A,a-=A}}g.bindTexture(g.TEXTURE_2D,null),A.boundTextures--}draw(A){if(this.drawIdsBufferDirty?this.updateDrawIDsBuffer(A):this.dirtyGeomIndices.size>0&&this.cleanGeomIds(),0!=this.drawIdsArray.length){if(this.drawIdsTexture){const{drawIdsTexture:g}=A.unifs;this.drawIdsTexture.bindToUniform(A,g)}this.bindAndRender(A,this.drawIdsArray,this.drawElementCounts,this.drawElementOffsets,this.drawOrderToIndex.length)}}drawHighlighted(A){if(0!=this.highlightedItems.length){if(this.highlightedIdsBufferDirty&&this.updateHighlightedIDsBuffer(A),this.highlightedIdsTexture){const{drawIdsTexture:g}=A.unifs;this.highlightedIdsTexture.bindToUniform(A,g)}this.bindAndRender(A,this.highlightedIdsArray,this.highlightElementCounts,this.highlightElementOffsets,this.highlightedItems.length)}}drawGeomData(A){if(this.drawIdsBufferDirty&&this.updateDrawIDsBuffer(A),0!=this.drawOrderToIndex.length){if(this.drawIdsTexture){const{drawIdsTexture:g}=A.unifs;this.drawIdsTexture.bindToUniform(A,g)}this.bindAndRender(A,this.drawIdsArray,this.drawElementCounts,this.drawElementOffsets,this.drawOrderToIndex.length)}}bindAndRender(A,g,I,C,i){const e=this.gl,t=A.unifs;t.instancedDraw&&e.uniform1i(A.unifs.instancedDraw.location,1),A.bindViewports(t,(()=>{this.multiDraw(A,g,I,C,i)}))}sortItems(A){const g=new Float32Array(this.drawOrderToIndex.length);this.drawOrderToIndex.forEach((I=>{const C=this.glGeomItems[I];if(C){const i=C.geomItem.boundingBoxParam.value,e=i.center(),t=i.size(),B=e.distanceTo(A)-t;g[I]=B}})),this.drawOrderToIndex.sort(((A,I)=>g[I]-g[A])),this.drawOrderToIndex.forEach(((A,g)=>{const I=this.glGeomItems[A];I&&(this.drawIdsArray[g]=I.geomItemId,this.indexToDrawIndex[A]=g)})),this.drawIdsBufferDirty=!0,this.viewPos=A}destroy(){this.drawIdsTexture&&this.drawIdsTexture.destroy(),this.highlightedIdsTexture&&this.highlightedIdsTexture.destroy(),this.emit("destructing")}}class ke extends ve{multiDraw(A,g,I,C,i){const{occluded:e,hiddenLineColor:t}=A.unifs,B=A.hiddenLineColor&&A.hiddenLineColor.a>0&&e&&t,o=this.gl;if(o.multiDrawArrays)o.multiDrawElements(o.LINES,I,0,o.UNSIGNED_INT,C,0,i),B&&(o.uniform1i(e.location,1),o.uniform4fv(t.location,A.hiddenLineColor.asArray()),o.depthFunc(o.GREATER),o.depthMask(!1),o.multiDrawElements(o.LINES,I,0,o.UNSIGNED_INT,C,0,i),o.depthFunc(o.LEQUAL),o.depthMask(!0),o.uniform1i(e.location,0));else{const{geomItemId:s}=A.unifs;for(let A=0;A<i;A++)o.uniform1i(s.location,g[A]),o.drawElements(o.LINES,I[A],o.UNSIGNED_INT,C[A]);if(B){o.uniform1i(e.location,1),o.uniform4fv(t.location,A.hiddenLineColor.asArray()),o.depthFunc(o.GREATER),o.depthMask(!1);for(let A=0;A<i;A++)o.uniform1i(s.location,g[A]),o.drawElements(o.LINES,I[A],o.UNSIGNED_INT,C[A]);o.depthFunc(o.LEQUAL),o.depthMask(!0),o.uniform1i(e.location,0)}}}}class xe extends ve{multiDraw(A,g,I,C,i){const e=this.gl;if(e.multiDrawArrays)e.multiDrawArrays(e.POINTS,C,0,I,0,i);else{const{geomItemId:t}=A.unifs;for(let A=0;A<i;A++)e.uniform1i(t.location,g[A]),e.drawArrays(e.POINTS,C[A],I[A])}}}!function(A){A[A.TRIANGLES=0]="TRIANGLES",A[A.LINES=1]="LINES",A[A.POINTS=2]="POINTS"}(Le||(Le={}));class ze extends ve{multiDraw(A,g,I,C,i){const e=this.gl,t=()=>{if(e.multiDrawElements)e.multiDrawElements(e.TRIANGLES,I,0,e.UNSIGNED_INT,C,0,i);else{const{geomItemId:t}=A.unifs;for(let A=0;A<i;A++)e.uniform1i(t.location,g[A]),e.drawElements(e.TRIANGLES,I[A],e.UNSIGNED_INT,C[A])}};e.depthFunc(e.LEQUAL);const{geomType:B,outlineThickness:o,viewportSize:s,renderMode:a}=A.unifs,l=A instanceof jC&&a?A.renderMode:null,n=A instanceof jC&&o&&s&&"geometry"==A.outlineMethod&&A.outlineThickness>0&&"flat-noedges"!=l&&"pbr-noedges"!=l,d=n&&"wireframe"==l;if(d?(e.enable(e.STENCIL_TEST),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT),e.stencilOpSeparate(e.FRONT,e.DECR_WRAP,e.DECR_WRAP,e.DECR_WRAP),e.stencilOpSeparate(e.BACK,e.INCR_WRAP,e.INCR_WRAP,e.INCR_WRAP),e.stencilFunc(e.ALWAYS,0,255),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.disable(e.DEPTH_TEST),e.depthMask(!1),e.colorMask(!1,!1,!1,!1)):"hiddenline"==l&&e.colorMask(!1,!1,!1,!1),B&&e.uniform1i(B.location,Le.TRIANGLES),o&&e.uniform1f(o.location,0),t(),n){const g=A;if(e.enable(e.CULL_FACE),e.cullFace(e.FRONT),e.uniform1f(o.location,g.outlineThickness*window.devicePixelRatio),e.uniform2f(s.location,A.region[2]-A.region[0],A.region[3]-A.region[1]),"hiddenline"==l&&e.colorMask(!0,!0,!0,!1),d||(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),t(),e.disable(e.CULL_FACE),e.cullFace(e.BACK),d){e.enable(e.DEPTH_TEST),e.depthMask(!0),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const A=g.glShader,I=g.shaderkey,C=g.screenQuad;C.bindShader(g),C.draw(g,g.outlineColor),A.bind(g,I),this.renderer.glGeomItemLibrary.bind(g),this.renderer.glGeomLibrary.bind(g),this.renderer.glMaterialLibrary.bind(g),e.disable(e.STENCIL_TEST)}}}}class Te extends V{constructor(A,g,I){super(),this.glGeomItemSets={},this.glGeomDataShaderKey="",this.glHighlightShaderKey="",this.pass=A,this.gl=g,this.glShader=I.glShader,this.glGeomDataShader=I.glgeomdatashader?I.glgeomdatashader:I.glShader,this.glHighlightShader=I.glselectedshader?I.glselectedshader:I.glShader,this.glShaderKey=I.glShader.getId()+"multidraw-draw",this.glGeomDataShader&&(this.glGeomDataShaderKey=this.glGeomDataShader.getId()+"multidraw-geomdata"),this.glHighlightShader&&(this.glHighlightShaderKey=this.glHighlightShader.getId()+"multidraw-highlight")}getOrCreateGLGeomItemSet(A){let g;if(A instanceof Mg){if(this.glGeomItemSets.CompoundGeom)return this.glGeomItemSets.CompoundGeom;g=new Ue(this.pass.renderer),this.glGeomItemSets.CompoundGeom=g}else if(A instanceof Kg||A instanceof Dg){if(this.glGeomItemSets.GLMesh)return this.glGeomItemSets.GLMesh;g=new ze(this.pass.renderer),this.glGeomItemSets.GLMesh=g}else if(A instanceof Yg||A instanceof Jg){if(this.glGeomItemSets.GLLines)return this.glGeomItemSets.GLLines;g=new ke(this.pass.renderer),this.glGeomItemSets.GLLines=g}else{if(!(A instanceof Wg||A instanceof Ng))throw new Error("Unsupported geom type:"+A.constructor.name);if(this.glGeomItemSets.GLPoints)return this.glGeomItemSets.GLPoints;g=new xe(this.pass.renderer),this.glGeomItemSets.GLPoints=g}return g.on("updated",(()=>{this.emit("updated")})),g}addGLGeomItem(A){const g=A.geomItem.geomParam.value,I=this.getOrCreateGLGeomItemSet(g);A.GLGeomItemSet=I,I.addGLGeomItem(A)}removeGLGeomItem(A){A.GLGeomItemSet.removeGLGeomItem(A),A.GLGeomItemSet=null}bindShader(A,g,I){const C=this.gl;if(A.isCompiledForTarget(I)||(C.multiDrawElements?g.shaderopts.directives.push("#define ENABLE_MULTI_DRAW\n#extension GL_ANGLE_multi_draw : enable"):g.shaderopts.directives.push("#define ENABLE_MULTI_DRAW"),A.compileForTarget(I,g.shaderopts),g.shaderopts.directives.pop()),!A.bind(g,I))throw new Error("Unable to bind shader:"+A);this.pass.renderer.glGeomItemLibrary.bind(g),this.pass.renderer.glGeomLibrary.bind(g),this.pass.renderer.glMaterialLibrary.bind(g)}draw(A){this.bindShader(this.glShader,A,this.glShaderKey);for(const g in this.glGeomItemSets)this.glGeomItemSets[g].draw(A);this.glShader.unbind(A)}drawHighlightedGeoms(A){if(this.glHighlightShader){this.bindShader(this.glHighlightShader,A,this.glHighlightShaderKey);for(const g in this.glGeomItemSets)this.glGeomItemSets[g].drawHighlighted(A);this.glHighlightShader.unbind(A)}}drawGeomData(A){var g;this.bindShader(this.glGeomDataShader,A,this.glGeomDataShaderKey);const I=A.gl,{floatGeomBuffer:C,passId:i,occlusionCulling:e,viewportSize:t}=A.unifs;C&&I.uniform1i(C.location,A.floatGeomBuffer?1:0),i&&I.uniform1i(i.location,A.passIndex),e&&I.uniform1i(e.location,null!==(g=A.occlusionCulling)&&void 0!==g?g:0);for(const g in this.glGeomItemSets)this.glGeomItemSets[g].drawGeomData(A);this.glGeomDataShader.unbind(A)}sortItems(A){for(const g in this.glGeomItemSets)this.glGeomItemSets[g].sortItems(A)}}class _e extends De{constructor(){super(),this.__glshadermaterials={},this.__glShaderGeomSets={}}getPassType(){return EC.OPAQUE}filterGeomItem(A){const g=A.materialParam.value;return A.isOpaque()&&g.isOpaque()}checkMaterial(A){return A.isOpaque()}removeAndReAddGeomItem(A){this.removeGeomItem(A),this.__renderer.assignTreeItemToGLPass(A)}addGeomItem(A){super.addGeomItem(A);const g=A.materialParam.value,I=this.renderer.glGeomLibrary,C=this.renderer.glGeomItemLibrary;if(!g.isTextured()&&g.getShaderClass().supportsInstancing()){const I=g.getShaderName();let C=this.__glShaderGeomSets[I];if(!C){const A=this.constructShaders(I);C=new Te(this,this.__gl,A),C.on("updated",(()=>{this.__renderer.requestRedraw()})),this.__glShaderGeomSets[I]=C}const i=this.renderer.glGeomItemLibrary.getGLGeomItem(A);return C.addGLGeomItem(i),i.GLShaderGeomSets=C,this.emit("updated"),!0}const i=I.constructGLGeom(A.geomParam.value),e=C.getGLGeomItem(A),t=g.getShaderName(),B=this.renderer.glMaterialLibrary.getGLMaterial(g);let o=this.__glshadermaterials[t];if(!o){const A=this.constructShaders(t);o=new Qe(this.__gl,this,A),this.__glshadermaterials[t]=o,o.on("updated",(()=>{this.__renderer.requestRedraw()}))}return o.addGLGeomItem(e,i,B),!0}removeGeomItem(A){super.removeGeomItem(A);const g=this.renderer.glGeomItemLibrary.getGLGeomItem(A);if(g.GLShaderGeomSets){return g.GLShaderGeomSets.removeGLGeomItem(g),g.GLShaderGeomSets=null,!0}if(g.GLGeomItemSet){return g.GLGeomItemSet.removeGLGeomItem(g),g.GLGeomItemSet=null,!0}return!0}removeMaterial(A){const g=A.getShaderName(),I=this.__glshadermaterials[g];if(!I||I!=A.getMetadata("glshaderMaterials"))return void console.warn("Material not found in pass");const C=A.getMetadata("glMaterialGeomItemSets");I.removeMaterialGeomItemSets(C)}__traverseTreeAndDraw(A){for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].draw(A);for(const g in this.__glshadermaterials)this.__glshadermaterials[g].draw(A);A.glGeom&&A.glGeom.unbind(A)}draw(A){const g=this.__gl;A.pushGLStack(),A.glDisable(g.BLEND),A.glEnable(g.DEPTH_TEST),A.glDisable(g.CULL_FACE),g.depthFunc(g.LEQUAL),g.depthMask(!0),this.__traverseTreeAndDraw(A);const I=this.renderer;I.outlineThickness>0&&"image"==I.outlineMethod&&A.viewport.drawSilhouettes(A),A.popGLStack()}drawHighlightedGeoms(A){const g=this.__gl;g.disable(g.CULL_FACE);for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].drawHighlightedGeoms(A);for(const g in this.__glshadermaterials){this.__glshadermaterials[g].drawHighlightedGeoms(A)}A.glGeom&&A.glGeom.unbind(A)}drawGeomData(A){A.passIndex=this.passIndex;const g=this.__gl;g.disable(g.BLEND),g.disable(g.CULL_FACE),g.enable(g.DEPTH_TEST),g.depthFunc(g.LEQUAL),g.depthMask(!0);for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].drawGeomData(A);for(const g in this.__glshadermaterials){this.__glshadermaterials[g].drawGeomData(A)}A.glGeom&&A.glGeom.unbind(A)}}re.registerPass(_e,EC.OPAQUE);class Pe extends _e{constructor(){super(),this.linesGeomDataBuffer=null,this.fattenLinesShader=null,this.quad=null,this.fbo=null}init(A,g){super.init(A,g)}filterGeomItem(A){const g=A.geomParam.value;return g instanceof Yg||g instanceof Jg||g instanceof Wg||g instanceof Ng}draw(A){const g=this.__gl;A.pushGLStack(),A.glEnable(g.BLEND),A.glEnable(g.DEPTH_TEST),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),g.depthFunc(g.LEQUAL),g.depthMask(!0),this.__traverseTreeAndDraw(A),A.popGLStack()}drawGeomData(A){const g=this.__gl;if(A.geomDataFbo&&!A.occlusionCulling){this.linesGeomDataBuffer||(this.linesGeomDataBuffer=new HC(g,{type:this.__renderer.floatGeomBuffer?"FLOAT":"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:1,height:2}),this.fattenLinesShader=new fe(g),this.quad=new Yi(g,new AI(1,1)));const I=A.geomDataFbo,C=I.width,i=I.height;if(this.linesGeomDataBuffer.width!=C||this.linesGeomDataBuffer.height!=i){this.fbo&&(g.deleteFramebuffer(this.fbo),this.fbo=null),this.linesGeomDataBuffer.resize(C,i),this.fbo=g.createFramebuffer();const A=this.linesGeomDataBuffer.glTex,e=I.__depthTexture;"webgl2"==g.name?(g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.fbo),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0),g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,e,0)):(g.bindFramebuffer(g.FRAMEBUFFER,this.fbo),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0),g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.TEXTURE_2D,e,0)),MC(g,C,i)}else"webgl2"==g.name?g.bindFramebuffer(g.DRAW_FRAMEBUFFER,this.fbo):g.bindFramebuffer(g.FRAMEBUFFER,this.fbo);g.colorMask(!0,!0,!0,!0),g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT)}if(super.drawGeomData(A),A.geomDataFbo&&!A.occlusionCulling){A.geomDataFbo.bindForWriting(A),this.fattenLinesShader.bind(A);const{colorTexture:I,screenSize:C}=A.unifs;this.linesGeomDataBuffer.bindToUniform(A,I);const i=A.geomDataFbo;g.uniform2f(C.location,i.width,i.height),this.quad.bindAndDraw(A)}}}re.registerPass(Pe,EC.OPAQUE);class Oe extends De{constructor(){super(),this.itemCount=0,this.__glShaderGeomSets={},this.transparentItems=[],this.transparentItemIndices={},this.freeList=[],this.visibleItems=[],this.prevSortCameraPos=new o,this.sortCameraMovementDistance=0,this.reSort=!1}init(A,g){super.init(A,g),this.itemCount=0,this.__glShaderGeomSets={},this.transparentItems=[],this.transparentItemIndices={},this.freeList=[],this.visibleItems=[],this.prevSortCameraPos=new o(999,999,999),this.sortCameraMovementDistance=.25,this.reSort=!1}getPassType(){return EC.TRANSPARENT}filterGeomItem(A){const g=A.geomParam.value;if(g instanceof Yg||g instanceof Wg||g instanceof Ng||g instanceof Jg)return!1;const I=A.materialParam.value;return!A.isOpaque()||!I.isOpaque()}resortNeeded(){this.reSort=!0}addGeomItem(A){super.addGeomItem(A),this.itemCount++;const g=this.listenerIDs[A.getId()],I=A.materialParam.value,C=I.getShaderName(),i=this.constructShaders(C);if(!I.isTextured()&&I.getShaderClass().supportsInstancing()){let I=this.__glShaderGeomSets[C];I||(I=new Te(this,this.__gl,i),I.on("updated",(()=>{this.renderer.requestRedraw()})),this.__glShaderGeomSets[C]=I);const e=this.renderer.glGeomItemLibrary.getGLGeomItem(A);return I.addGLGeomItem(e),g["glGeomItem.visibilityChanged"]=e.on("visibilityChanged",(()=>{this.resortNeeded()})),this.emit("updated"),e.GLShaderGeomSets=I,void(this.reSort=!0)}const e=this.renderer.glGeomLibrary.constructGLGeom(A.geomParam.value),t=this.renderer.glGeomItemLibrary.getGLGeomItem(A);if(!t)throw new Error("glGeomItem not found for geomItem:"+A.getName());const B=this.renderer.glMaterialLibrary.getGLMaterial(I);g["glGeomItem.visibilityChanged"]=t.on("visibilityChanged",(A=>{if(A.visible)this.visibleItems.push(o);else{const A=this.visibleItems.indexOf(o);this.visibleItems.splice(A,1)}this.reSort=!0})),g["GeomMat.valueChanged"]=A.geomMatParam.on("valueChanged",(()=>{this.reSort=!0}));const o={geomItem:A,shaders:i,glGeom:e,glMaterial:B,glGeomItem:t,material:I};let s;s=this.freeList.length>0?this.freeList.pop():this.transparentItems.length,this.transparentItems[s]=o,this.transparentItemIndices[A.getId()]=s,A.isVisible()&&this.visibleItems.push(o),this.reSort=!0}removeGeomItem(A){this.itemCount--;const g=this.listenerIDs[A.getId()];super.removeGeomItem(A);const I=this.renderer.glGeomItemLibrary.getGLGeomItem(A);if(!I)throw new Error("glGeomItem not found for geomItem:"+A.getName());if(I.removeListenerById("visibilityChanged",g["glGeomItem.visibilityChanged"]),I.GLShaderGeomSets){I.GLShaderGeomSets.removeGLGeomItem(I),I.GLShaderGeomSets=null}else{const g=this.transparentItemIndices[A.getId()],I=this.transparentItems[g];delete this.transparentItemIndices[A.getId()],this.transparentItems[g]=null,this.freeList.push(g);const C=this.visibleItems.indexOf(I);-1!=C&&this.visibleItems.splice(C,1)}return this.emit("updated"),!0}sortItems(A){for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].sortItems(A);for(const g of this.visibleItems){const I=g.glGeomItem.geomItem.geomMatParam.value;g.dist=I.translation.distanceTo(A)}this.visibleItems.sort(((A,g)=>A.dist>g.dist?-1:A.dist<g.dist?1:0)),this.reSort=!1}_drawItem(A,g,I){I.currentGLMaterial!=g.glMaterial&&(I.currentGLMaterial=g.glMaterial,I.currentGLMaterial.bind(A)),I.currentGLGeom!=g.glGeom&&(I.currentGLGeom=g.glGeom,I.currentGLGeom.bind(A));g.glGeomItem.bind(A),A.bindViewports(A.unifs,(()=>{I.currentGLGeom.draw(A)}))}_drawItems(A){for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].draw(A);const g={currentglShader:null,currentGLMaterial:null,currentGLGeom:null};for(const I of this.visibleItems){const C=I.shaders.glShader;if(g.currentglShader!=C){if(!C.bind(A,"color"))continue;const I=this.__gl,i=A.unifs;i.instancedDraw&&I.uniform1i(i.instancedDraw.location,0),this.renderer.glGeomItemLibrary.bind(A),g.currentglShader=C}this._drawItem(A,I,g)}}draw(A){if(0==this.itemCount)return;const g=this.__gl,I=A.viewXfo.tr;if(this.reSort||I.distanceTo(this.prevSortCameraPos)>this.sortCameraMovementDistance)if(this.sortItems(I),this.prevSortCameraPos=I,A.vrviewport)this.sortCameraMovementDistance=.2*A.viewScale;else if(A.viewport){const g=A.viewport.getCamera();this.sortCameraMovementDistance=.3*g.getFocalDistance()}A.pushGLStack(),A.glEnable(g.BLEND),A.glEnable(g.DEPTH_TEST),A.glEnable(g.CULL_FACE),g.depthFunc(g.LESS),g.blendEquation(g.FUNC_ADD),A.pass="ADD",g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),g.cullFace(g.BACK),this._drawItems(A),A.popGLStack()}drawHighlightedGeoms(A){const g=this.__gl;g.disable(g.CULL_FACE);for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].drawHighlightedGeoms(A);const I={currentglShader:null,currentGLMaterial:null,currentGLGeom:null};for(const C of this.visibleItems){if(!C.geomItem.isHighlighted())continue;if(!C.shaders.glselectedshader)continue;const i=C.shaders;if(I.currentglShader!=i.glselectedshader){if(!i.glselectedshader.bind(A,"highlight"))continue;I.currentglShader=i.glselectedshader}const{floatGeomBuffer:e,passId:t,instancedDraw:B}=A.unifs;e&&g.uniform1i(e.location,g.floatGeomBuffer?1:0),t&&g.uniform1i(t.location,this.passIndex),B&&g.uniform1i(B.location,0),this.renderer.glGeomItemLibrary.bind(A),this._drawItem(A,C,I)}I.currentGLGeom&&I.currentGLGeom.unbind(A)}drawGeomData(A){const g=this.__gl;A.pushGLStack(),A.glEnable(g.DEPTH_TEST),A.glEnable(g.CULL_FACE);for(const g in this.__glShaderGeomSets)this.__glShaderGeomSets[g].drawGeomData(A);const I={currentglShader:null,currentGLMaterial:null,currentGLGeom:null};for(const C of this.visibleItems){if(!C.glGeomItem.geomItem.isSelectable())continue;const i=C.shaders;if(!i.glgeomdatashader)continue;if(I.currentglShader!=i.glgeomdatashader){if(!i.glgeomdatashader.bind(A,"geomdata"))continue;I.currentglShader=i.glgeomdatashader}const{floatGeomBuffer:e,passId:t,instancedDraw:B}=A.unifs;e&&g.uniform1i(e.location,g.floatGeomBuffer?1:0),t&&g.uniform1i(t.location,this.passIndex),B&&g.uniform1i(B.location,0),this.renderer.glGeomItemLibrary.bind(A),this._drawItem(A,C,I)}I.currentGLGeom&&I.currentGLGeom.unbind(A),A.popGLStack()}}re.registerPass(Oe,EC.TRANSPARENT);class je extends DC{constructor(A){super(A,"AtlasLayoutShader"),this.setShaderStage("VERTEX_SHADER","\n\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'quadVertexFromID.glsl'\n\nuniform vec2 pos;\nuniform vec2 size;\nuniform vec2 srctextureDim;\nconst int border = 2;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * size * 2.0), 0.0, 1.0);\n\n  vec2 borderVec2 = vec2(float(border), float(border));\n  v_texCoord *= (srctextureDim + (borderVec2 * 2.0)) / srctextureDim;\n  v_texCoord -= borderVec2 / srctextureDim;\n}\n\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D srctexture;\nuniform vec2 srctextureDim;\nuniform bool alphaFromLuminance;\nuniform bool invert;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\nfloat luminanceFromRGB(vec3 rgb) {\n  return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n  vec2 pixelCoord = v_texCoord*srctextureDim;\n  vec2 uv = v_texCoord;\n\n  // Wrap X coords\n  if (pixelCoord.x < 0.0) {\n    uv.x += 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n  else if (pixelCoord.x > srctextureDim.x) {\n    uv.x -= 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n\n  // Wrap Y coords\n  if (pixelCoord.y < 0.0) {\n    uv.y += 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n  else if (pixelCoord.y > srctextureDim.y) {\n    uv.y -= 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n\n  vec4 texel = texture2D(srctexture, uv);\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  // TODO: check why we pre-multiply alphas here.\n  // fragColor = vec4(texel.rgb/texel.a, texel.a);\n\n  if (alphaFromLuminance) {\n    fragColor = vec4(texel.rgb, luminanceFromRGB(texel.rgb));\n  }\n  else {\n    fragColor = texel;\n  }\n  \n  if (invert) {\n    fragColor = vec4(1.0) - fragColor;\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n")}}class qe extends LC{constructor(A,g,I="RGBA",C="FLOAT"){super(A),this.__asyncCount=0,this.loaded=!1,this.ready=!1,this.__layout=[],this.__layoutVec4s=[],this.__atlasLayoutShaderBinding=null,this.__atlasLayoutShader=null,this.__name=g,this.__formatParam=I,this.__typeParam=C,this.clearColor=new l(0,0,0,0),this.__subImages=[],this.__layoutNeedsRegeneration=!1,this.__asyncCount=0,this.loaded=!1}incAsyncCount(A=1){this.__asyncCount+=A,this.ready=!1}decAsyncCount(){this.__asyncCount>0&&(this.__asyncCount--,0==this.__asyncCount&&(this.loaded=!0,this.emit("loaded")))}isLoaded(){return 0==this.__asyncCount}addSubImage(A){if(A instanceof Gg){const g=new HC(this.__gl,A);A.isLoaded()||(this.incAsyncCount(),A.on("loaded",(()=>{this.decAsyncCount()}))),A.setMetadata("ImageAtlas_gltex",g),g.addRef(this);const I=()=>{this.__layoutNeedsRegeneration=!0,this.renderAtlas()};A.on("updated",I),this.__subImages.push(g)}else{const g=A;g.addRef(this),this.__subImages.push(g)}return this.__layoutNeedsRegeneration=!0,this.__subImages.length-1}removeSubImage(A){let g;if(A instanceof Gg){const I=A.getMetadata("ImageAtlas_gltex");g=this.__subImages.indexOf(I),A.deleteMetadata("ImageAtlas_gltex")}else g=this.__subImages.indexOf(A);this.__subImages[g].removeRef(this),this.__subImages.splice(g,1),this.__layoutNeedsRegeneration=!0}getSubImage(A){return this.__subImages[A]}numSubImages(){return this.__layout?this.__layout.length:this.__subImages.length}generateAtlasLayout(A){if(0==this.__subImages.length)return void(this.__layoutNeedsRegeneration=!1);const g=[];this.__subImages.forEach(((A,I)=>{g.push({w:A.width+4,h:A.height+4,area:A.width*A.height,index:I})})),g.sort(((A,g)=>A.area>g.area?-1:A.area<g.area?1:0));const I=new S;I.fit(g),this.__layout=[],g.forEach(((A,g)=>{A.fit?this.__layout[A.index]={pos:new B(A.fit.x+2,A.fit.y+2),size:new B(A.w,A.h)}:console.warn("Unable to fit image")}));const C=I.root.w,i=I.root.h;this.configure({width:C,height:i,format:"FLOAT"==this.__typeParam&&"RGB"==this.__formatParam?"RGBA":this.__formatParam,type:this.__typeParam,filter:"LINEAR"});const e=this.__gl;if(e.__quadVertexIdsBuffer||e.setupInstancedQuad(),!this.__atlasLayoutShader){this.__atlasLayoutShader=new je(this.__gl);const A=[];"webgl2"==e.name&&A.push("#define ENABLE_ES3");const g=this.__atlasLayoutShader.compileForTarget("GLImageAtlas",{directives:A});this.__atlasLayoutShaderBinding=_C(this.__gl,g.attrs,e.__quadattrbuffers,e.__quadIndexBuffer)}let t=Math.round(Math.sqrt(1*this.__layout.length)+.5);if(t=r.nextPow2(t),t%1!=0&&(t+=1-t%1),e.floatTexturesSupported){const A=new Float32Array(t*t*4);for(let g=0;g<this.__layout.length;g++){const I=this.__layout[g];new s(new Float32Array(A.buffer,4*g*4,4)).set(I.pos.x/C,I.pos.y/i,I.size.x/C,I.size.y/i)}this.__atlasLayoutTexture&&this.__atlasLayoutTexture.width==t&&this.__atlasLayoutTexture.height==t?this.__atlasLayoutTexture.bufferData(A,t,t):(this.__atlasLayoutTexture&&this.__atlasLayoutTexture.destroy(),this.__atlasLayoutTexture=new HC(e,{format:"RGBA",type:"FLOAT",filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1,width:t,height:t,data:A}))}else this.__layoutVec4s=[],this.__layout.forEach(((A,g)=>{this.__layoutVec4s[g]=[A.pos.x/C,A.pos.y/i,A.size.x/C,A.size.y/i]}));this.textureDesc[0]=this.width,this.textureDesc[1]=this.height,this.textureDesc[2]=this.__atlasLayoutTexture.width,this.__layoutNeedsRegeneration=!1}getLayoutData(A){return this.__layoutVec4s[A]}renderAtlas(A=!1,g=0){if(0==this.__subImages.length)return;this.__layoutNeedsRegeneration&&this.generateAtlasLayout();const I=this.__gl,C=new PC(I);this.bindForWriting(C,!0),this.__atlasLayoutShader.bind(C,"GLImageAtlas"),this.__atlasLayoutShaderBinding.bind(C);const i=new B(1/this.width,1/this.height),e=C.unifs;for(let A=g;A<this.__subImages.length;A++){const g=this.__subImages[A],t=this.__layout[A];g.bindToUniform(C,e.srctexture)&&(I.uniform2fv(e.pos.location,t.pos.multiply(i).asArray()),I.uniform2fv(e.size.location,t.size.multiply(i).asArray()),I.uniform2f(e.srctextureDim.location,g.width,g.height),I.uniform1i(e.alphaFromLuminance.location,g.alphaFromLuminance?1:0),I.uniform1i(e.invert.location,g.invert?1:0),I.drawQuad(),C.boundTextures--)}A&&this.cleanup(),this.unbind(C),this.emit("updated")}isReady(){return null!=this.__atlasLayoutTexture}bindToUniform(A,g){super.bindToUniform(A,g);const I=A.unifs;if(this.__atlasLayoutTexture){const C=I[g.name+"_layout"];C&&this.__atlasLayoutTexture.bindToUniform(A,C);const i=I[g.name+"_desc"];i&&this.__gl.uniform4fv(i.location,this.textureDesc)}else{const A=I[g.name+"_desc"];A&&this.__gl.uniform4f(A.location,this.width,this.height,0,0)}return!0}cleanup(){for(const A of this.__subImages)A.removeRef(this);this.__subImages=[],this.destroy()}destroy(){this.cleanup(),super.destroy()}}class $e extends bC{constructor(){super(),this.atlas=null,this.indexArrayUpdateNeeded=!1,this.instanceIdsBuffer=null,this.indexArray=new Float32Array(0),this.glshader=null,this.shaderComp={},this.shaderBinding=null,this.modelMatrixArray=[],this.billboardDataArray=[],this.tintColorArray=[],this.width=0,this.drawItemsTexture=null,this.billboards=[],this.dirtyBillboards=new Set,this.freeIndices=[],this.drawCount=0,this.threshold=0,this.updateRequested=!1,this.prevSortCameraPos=new o}init(A,g){super.init(A,g),this.atlas=new qe(this.renderer.gl,"Billboards","RGBA","UNSIGNED_BYTE"),this.atlas.clearColor=new l(1,1,1,0);const I=A=>this.emit("updated",A);this.atlas.on("loaded",I),this.atlas.on("updated",I)}getPassType(){return EC.TRANSPARENT}itemAddedToScene(A,g){return A instanceof gC&&(this.addBillboard(A),!0)}itemRemovedFromScene(A,g){return A instanceof gC&&(this.removeBillboard(A),!0)}addBillboard(A){const g=A.imageParam,I=g.value;if(!I)return void g.on("valueChanged",(()=>this.addBillboard(A)));let C;C=this.freeIndices.length>0?this.freeIndices.pop():this.billboards.length;const i=this.atlas.addSubImage(I);A.setMetadata("GLBillboardsPass_Index",C);const e=()=>{A.isVisible()?(this.drawCount++,this.dirtyBillboards.add(C)):this.drawCount--,this.reqUpdateIndexArray()};A.on("visibilityChanged",e);const t=()=>{A.isVisible()&&(this.dirtyBillboards.add(C),this.emit("updated"))};A.globalXfoParam.on("valueChanged",t),A.alphaParam.on("valueChanged",t),A.on("highlightChanged",t),A.isVisible()&&this.drawCount++,this.billboards[C]={billboard:A,imageIndex:i,visibilityChanged:e,updateBillboard:t},this.indexArrayUpdateNeeded=!0,this.requestUpdate()}removeBillboard(A){const g=A.getMetadata("GLBillboardsPass_Index");if(-1==g)return void console.warn("Billboard already removed.");const I=this.billboards[g],C=I.billboard.imageParam.value;this.atlas.removeSubImage(C),A.off("visibilityChanged",I.visibilityChanged),A.off("highlightChanged",I.updateBillboard),A.globalXfoParam.off("valueChanged",I.updateBillboard),A.alphaParam.off("valueChanged",I.updateBillboard),this.billboards[g]=null,this.freeIndices.push(g),A.isVisible()&&this.drawCount--,this.indexArrayUpdateNeeded=!0,this.requestUpdate()}populateBillboardDataArray(A,g,I){const C=A.billboard,i=C.globalXfoParam.value.toMat4(),e=C.pixelsPerMeterParam.value,t=C.pivotParam.value,B=1/e;let o=0;C.alignedToCameraParam.value&&(o|=4),C.drawOnTopParam.value&&(o|=8),C.fixedSizeOnscreenParam.value&&(o|=16);const a=C.alphaParam.value,l=C.colorParam.value,n=7*g*4,d=new s(new Float32Array(I.buffer,4*n,4)),h=new s(new Float32Array(I.buffer,4*(n+4),4)),c=new s(new Float32Array(I.buffer,4*(n+8),4)),r=new s(new Float32Array(I.buffer,4*(n+12),4));d.set(i.xAxis.x,i.yAxis.x,i.zAxis.x,i.translation.x),h.set(i.xAxis.y,i.yAxis.y,i.zAxis.y,i.translation.y),c.set(i.xAxis.z,i.yAxis.z,i.zAxis.z,i.translation.z),r.set(B,o,A.imageIndex,a);new s(new Float32Array(I.buffer,4*(n+16),4)).set(t.x,t.y,0,0);if(new s(new Float32Array(I.buffer,4*(n+20),4)).set(l.r,l.g,l.b,l.a),C.isHighlighted()){const A=C.getHighlight();new s(new Float32Array(I.buffer,4*(n+24),4)).set(A.r,A.g,A.b,A.a)}}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.emit("updated"))}reqUpdateIndexArray(){this.indexArrayUpdateNeeded||(this.indexArrayUpdateNeeded=!0,this.emit("updated"))}updateIndexArray(){const A=this.__gl;this.indexArray&&this.indexArray.length!=this.drawCount&&(A.deleteBuffer(this.instanceIdsBuffer),this.instanceIdsBuffer=null),this.indexArray=new Float32Array(this.drawCount);let g=0;for(let A=0;A<this.billboards.length;A++)this.billboards[A]&&this.billboards[A].billboard.isVisible()&&(this.indexArray[g]=A,g++);this.instanceIdsBuffer||(this.instanceIdsBuffer=A.createBuffer()),A.bindBuffer(A.ARRAY_BUFFER,this.instanceIdsBuffer),A.bufferData(A.ARRAY_BUFFER,this.indexArray,A.STATIC_DRAW),this.indexArrayUpdateNeeded=!1}updateBillboards(A){const g=()=>{this.indexArrayUpdateNeeded&&this.updateIndexArray();const g=this.__gl;if(!this.glshader){g.__quadVertexIdsBuffer||g.setupInstancedQuad(),this.glshader=new Ee(g);const I=this.glshader.compileForTarget("GLBillboardsPass",A.shaderopts);this.shaderBinding=_C(g,I.attrs,g.__quadattrbuffers,g.__quadIndexBuffer)}if(this.atlas.renderAtlas(),!g.floatTexturesSupported||!g.drawElementsInstanced)return this.modelMatrixArray=[],this.billboardDataArray=[],this.tintColorArray=[],this.indexArray.forEach((A=>{const g=this.billboards[A],I=g.billboard,C=I.globalXfoParam.value.toMat4(),i=1/I.pixelsPerMeterParam.value;let e=0;I.alignedToCameraParam.value&&(e|=4),I.drawOnTopParam.value&&(e|=8),I.fixedSizeOnscreenParam.value&&(e|=16);const t=I.alphaParam.value,B=I.colorParam.value;this.modelMatrixArray[A]=C.asArray(),this.billboardDataArray[A]=[i,e,g.imageIndex,t],this.tintColorArray[A]=[B.r,B.g,B.b,B.a]})),void(this.updateRequested=!1);let I=Math.round(Math.sqrt(7*(this.billboards.length-this.freeIndices.length))+.5);if(I%7!=0&&(I+=7-I%7),this.width=I,this.drawItemsTexture)this.drawItemsTexture.resize(I,I);else{const A={format:"RGBA",type:"FLOAT",width:I,height:I,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1};this.drawItemsTexture=new HC(g,A),this.drawItemsTexture.clear()}this.indexArray.forEach((A=>{-1!=A&&this.updateBillboard(A)})),this.updateRequested=!1};this.atlas.isLoaded()?g():this.atlas.on("loaded",g)}updateBillboard(A){if(0==this.drawCount||!this.drawItemsTexture)return;const g=this.billboards[A];if(!g.billboard.isVisible())return;const I=this.__gl,C=new Float32Array(28);this.populateBillboardDataArray(g,0,C),I.bindTexture(I.TEXTURE_2D,this.drawItemsTexture.glTex);const i=7*A%this.width,e=Math.floor(7*A/this.width),t=this.drawItemsTexture.getType(),B=this.drawItemsTexture.getFormat();if(t==I.FLOAT)I.texSubImage2D(I.TEXTURE_2D,0,i,e,7,1,B,t,C);else{const A=r.convertFloat32ArrayToUInt16Array(C);I.texSubImage2D(I.TEXTURE_2D,0,i,e,7,1,B,t,A)}}sort(A){for(const g of this.billboards){const{billboard:I}=g;if(I&&I.isVisible()){const C=I.globalXfoParam.value;g.dist=C.tr.distanceTo(A)}}this.indexArray.sort(((A,g)=>-1==A?1:-1==g||this.billboards[A].dist>this.billboards[g].dist?-1:this.billboards[A].dist<this.billboards[g].dist?1:0));const g=this.__gl;g.floatTexturesSupported&&this.instanceIdsBuffer&&(g.bindBuffer(g.ARRAY_BUFFER,this.instanceIdsBuffer),g.bufferData(g.ARRAY_BUFFER,this.indexArray,g.STATIC_DRAW))}__draw(A,g){const I=this.__gl;if(!this.glshader)return;this.glshader.bind(A,g),this.shaderBinding.bind(A);const C=A.unifs,{atlasBillboards:i,passId:e,floatGeomBuffer:t,inVR:B}=A.unifs;if(i&&this.atlas.bindToUniform(A,C.atlasBillboards),t&&A instanceof qC&&I.uniform1i(t.location,A.floatGeomBuffer?1:0),e&&I.uniform1i(e.location,this.passIndex),B&&I.uniform1i(B.location,A.vrPresenting?1:0),I.floatTexturesSupported&&I.drawElementsInstanced){const{instancesTexture:g,instancesTextureSize:i}=A.unifs;this.drawItemsTexture.bindToUniform(A,g),I.uniform1i(i.location,this.width);{const g=A.attrs.instanceIds.location;I.enableVertexAttribArray(g),I.bindBuffer(I.ARRAY_BUFFER,this.instanceIdsBuffer),I.vertexAttribPointer(g,1,I.FLOAT,!1,4,0),I.vertexAttribDivisor(g,1)}A.bindViewports(C,(()=>{I.drawElementsInstanced(I.TRIANGLES,6,I.UNSIGNED_SHORT,0,this.drawCount)}))}else{const{modelMatrix:g,billboardData:i,tintColor:e,layoutData:t}=A.unifs,B=this.indexArray.length;for(let o=0;o<B;o++)I.uniformMatrix4fv(g.location,!1,this.modelMatrixArray[o]),I.uniform4fv(i.location,this.billboardDataArray[o]),I.uniform4fv(e.location,this.tintColorArray[o]),I.uniform4fv(t.location,this.atlas.getLayoutData(this.billboards[o].imageIndex)),A.bindViewports(C,(()=>{I.drawQuad()}))}}draw(A){if(0==this.drawCount)return;if(this.updateRequested&&this.updateBillboards(A),this.dirtyBillboards.size>0&&(this.dirtyBillboards.forEach((A=>{this.updateBillboard(A)})),this.dirtyBillboards.clear()),this.indexArrayUpdateNeeded&&this.updateIndexArray(),!this.glshader)return;const g=A.viewXfo.tr;if(g.distanceTo(this.prevSortCameraPos)>this.threshold)if(this.sort(g),this.prevSortCameraPos=g.clone(),this.drawCount>1){const A=this.indexArray[this.indexArray.length-1],g=this.indexArray[this.indexArray.length-2],I=this.billboards[A].billboard,C=this.billboards[g].billboard,i=I.globalXfoParam.value.tr,e=C.globalXfoParam.value.tr;this.threshold=i.distanceTo(e)}else this.threshold=9999;const I=this.__gl;I.depthMask(!1),I.disable(I.CULL_FACE),I.enable(I.BLEND),I.blendEquation(I.FUNC_ADD),I.blendFunc(I.SRC_ALPHA,I.ONE_MINUS_SRC_ALPHA),this.__draw(A,"DRAW_COLOR"),I.disable(I.BLEND),I.depthMask(!0)}drawHighlightedGeoms(A){0!=this.drawCount&&this.__draw(A,"DRAW_HIGHLIGHT")}drawGeomData(A){0!=this.drawCount&&this.__draw(A,"DRAW_GEOMDATA")}getGeomItemAndDist(A){let g,I;if(A instanceof Float32Array?(g=Math.round(A[1]),I=A[3]):(g=A[0]+((63&A[1])<<8),I=r.decode16BitFloatFrom2xUInt8(A.slice(2,3))),!(g>=this.billboards.length))return{geomItem:this.billboards[g].billboard,componentId:0,dist:I};console.warn("Invalid Draw Item id:"+g+" NumBillboards:"+(this.billboards.length-1))}}re.registerPass($e,EC.TRANSPARENT);class At extends _e{constructor(){super()}getPassType(){return EC.OVERLAY}filterGeomItem(A){if(A.isOverlay())return!0;const g=A.materialParam.value.getShaderClass();return!(!g||!g.isOverlay())}draw(A){const g=this.__gl;g.clear(g.DEPTH_BUFFER_BIT),g.enable(g.CULL_FACE),g.cullFace(g.BACK),g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),A.pass="ADD",g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this.__traverseTreeAndDraw(A),g.disable(g.BLEND)}drawGeomData(A){const g=this.__gl;g.clear(g.DEPTH_BUFFER_BIT),g.enable(g.CULL_FACE),g.cullFace(g.BACK),g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),A.pass="ADD",g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),super.drawGeomData(A),g.disable(g.BLEND),g.enable(g.DEPTH_TEST)}}re.registerPass(At,EC.OVERLAY);console.log("Zea Engine v4.4.0");const gt=new class{constructor(A){this.version=A,this.registry={}}registerLib(A){const g=A.name,I=A.version;this.registry[g]&&console.warn("Library already registered:"+g),this.registry[g]=I,console.log(`Registered lib '${g}' v${I}`)}listLibs(){return this.registry}}("4.4.0");var It=Object.freeze({__proto__:null,Allocation1D:w,Allocator1D:X,AssetItem:$I,AssetLoadContext:AC,Attribute:bg,BaseClass:u,BaseEvent:R,BaseGeom:wg,BaseGeomItem:LI,BaseGroup:xI,BaseImage:Gg,BaseItem:hA,BaseProxy:pg,BaseTool:VC,BillboardItem:gC,BillboardShader:Ee,BinReader:YA,BinWriter:class{constructor(A=0){this.__data=new ArrayBuffer(A),this.__byteOffset=0,this.__reserved=A,this.__dataView=new DataView(this.__data)}pos(){return this.__byteOffset}seek(A){this.__byteOffset=A}seekEnd(){this.__byteOffset=this.__reserved}getBuffer(){if(this.__data.byteLength==this.__byteOffset)return this.__data;return new Uint8Array(this.__data).slice(0,this.__byteOffset).buffer}__grow(){const A=2*(this.__reserved>0?this.__reserved:1),g=new ArrayBuffer(A),I=new Uint8Array(g),C=new Uint8Array(this.__data);I.set(C),this.__data=g,this.__dataView=new DataView(this.__data),this.__reserved=A}__reserve(A){this.__byteOffset+A>this.__reserved&&this.__grow()}__offset(A){this.__byteOffset+=A,this.__byteOffset>this.__reserved&&this.__grow()}writeUInt8(A){this.__reserve(1),this.__dataView.setUint8(this.__byteOffset,A),this.__offset(1)}writeUInt16(A){this.__reserve(2),this.__dataView.setUint16(this.__byteOffset,A,!0),this.__offset(2)}writeUInt32(A){this.__reserve(4),this.__dataView.setUint32(this.__byteOffset,A,!0),this.__offset(4)}writeSInt32(A){this.__reserve(4),this.__dataView.setInt32(this.__byteOffset,A,!0),this.__offset(4)}writeFloat16(A){const g=r.encode16BitFloat(A);this.writeUInt16(g)}writeFloat32(A){this.__reserve(4),this.__dataView.setFloat32(this.__byteOffset,A,!0),this.__offset(4)}writeUInt8Array(A,g=!0){const I=(A.length,A.length);this.__reserve(I+(g?4:0)),g&&this.writeUInt32(I);for(let g=0;g<I;g++)this.writeUInt8(A[g])}writeUInt16Array(A,g=!0){const I=(A.length,A.length);this.__reserve(2*I+(g?4:0)),g&&this.writeUInt32(I);for(let g=0;g<I;g++)this.writeUInt16(A[g])}writeUInt32Array(A,g=!0){const I=(A.length,A.length);this.__reserve(4*I+(g?4:0)),g&&this.writeUInt32(I);for(let g=0;g<I;g++)this.writeUInt32(A[g])}writeFloat32Array(A,g=!0){const I=(A.length,A.length);this.__reserve(4*I+(g?4:0)),g&&this.writeUInt32(I);for(let g=0;g<I;g++)this.writeFloat32(A[g])}writeStr(A,g=!0){const I=A.length;this.__reserve(4*I+(g?4:0)),g&&this.writeUInt32(I);for(let g=0;g<I;g++)this.writeFloat32(A.charCodeAt(g))}writeSInt32Vec2(A){this.writeSInt32(A.x),this.writeSInt32(A.y)}writeUInt32Vec2(A){this.writeUInt32(A.x),this.writeUInt32(A.y)}writeFloat16Vec2(A){this.writeFloat16(A.x),this.writeFloat16(A.y)}writeFloat32Vec2(A){this.writeFloat32(A.x),this.writeFloat32(A.y)}writeFloat16Vec3(A){this.writeFloat16(A.x),this.writeFloat16(A.y),this.writeFloat16(A.z)}writeFloat32Vec3(A){this.writeFloat32(A.x),this.writeFloat32(A.y),this.writeFloat32(A.z)}writeFloat16Quat(A){this.writeFloat16(A.x),this.writeFloat16(A.y),this.writeFloat16(A.z),this.writeFloat16(A.w)}writeFloat32Quat(A){this.writeFloat32(A.x),this.writeFloat32(A.y),this.writeFloat32(A.z),this.writeFloat32(A.w)}writeRGBFloat32Color(A){this.writeFloat32(A.r),this.writeFloat32(A.g),this.writeFloat32(A.b)}writeRGBAFloat32Color(A){this.writeFloat32(A.r),this.writeFloat32(A.g),this.writeFloat32(A.b),this.writeFloat32(A.a)}writeRGBUInt8Color(A){this.writeUInt8(A.r),this.writeUInt8(A.g),this.writeUInt8(A.b)}writeRGBAUInt8Color(A){this.writeUInt8(A.r),this.writeUInt8(A.g),this.writeUInt8(A.b),this.writeUInt8(A.a)}writeBox2(A){this.writeFloat32Vec2(A.p0),this.writeFloat32Vec2(A.p1)}writeBox3(A){this.writeFloat32Vec3(A.p0),this.writeFloat32Vec3(A.p1)}writePadd(A){const g=A-this.__byteOffset;this.__reserve(g),this.__offset(g)}writeAlignment(A){const g=this.__byteOffset%A;0!=g&&(this.__reserve(A-g),this.__offset(A-g))}},BooleanOperatorInput:class extends tg{},BooleanOperatorOutput:class extends gg{},BooleanParameter:fA,Box2:Q,Box2Parameter:vA,Box3:b,Box3Parameter:kA,CADAssembly:lC,CADAsset:aC,CADBody:dC,CADPart:nC,Camera:IC,CameraManipulator:SC,ChildAddedEvent:oA,Circle:zg,Color:l,ColorAttribute:Hg,ColorOperatorInput:class extends tg{},ColorOperatorOutput:class extends gg{},ColorParameter:xA,get ColorSpace(){return pA},CompoundGeom:Mg,Cone:Og,ControllerAddedEvent:W,CountChangedEvent:Y,Cross:Tg,Cuboid:jg,CuttingPlane:sC,Cylinder:qg,DataImage:CI,Disc:$g,EnvMap:RI,EnvMapAssignedEvent:K,EnvMapShader:ii,EnvProjectionShader:be,EulerAngles:n,EventEmitter:V,FRAMEBUFFER:Ki,FatLinesMaterial:HI,FatLinesShader:Ze,FatPointsMaterial:WI,FatPointsShader:Xe,FileImage:eI,FileImage2D:class extends eI{constructor(A,g={}){console.warn("FileImage2D is becoming deprecated in favor of simple FileImage"),super(A,g)}},FilePathParameter:cg,FlatSurfaceMaterial:YI,FlatSurfaceShader:ue,Float32:6,Frustum:class{constructor(A,g,I,C,i,e){this.planes=[A||new Z,g||new Z,I||new Z,C||new Z,i||new Z,e||new Z]}setFromMatrix(A){const g=A,I=this.planes;I[0].set(g.m03-g.m00,g.m13-g.m10,g.m23-g.m20,g.m33-g.m30),I[1].set(g.m03+g.m00,g.m13+g.m10,g.m23+g.m20,g.m33+g.m30),I[2].set(g.m03+g.m01,g.m13+g.m11,g.m23+g.m21,g.m33+g.m31),I[3].set(g.m03-g.m01,g.m13-g.m11,g.m23-g.m21,g.m33-g.m31),I[4].set(g.m03-g.m02,g.m13-g.m12,g.m23-g.m22,g.m33-g.m32),I[5].set(g.m03+g.m02,g.m13+g.m12,g.m23+g.m22,g.m33+g.m32),I.forEach((A=>A.normalizeInPlace()))}intersectsBox(A){const g=new o,I=this.planes,{min:C,max:i}=A;for(let A=0;A<6;A++){const e=I[A];if(g.x=e.normal.x>0?i.x:C.x,g.y=e.normal.y>0?i.y:C.y,g.z=e.normal.z>0?i.z:C.z,e.distanceToPoint(g)<0)return!1}return!0}toJSON(){return{p0:this.planes[0].toJSON(),p1:this.planes[1].toJSON(),p2:this.planes[2].toJSON(),p3:this.planes[3].toJSON(),p4:this.planes[4].toJSON(),p5:this.planes[5].toJSON()}}fromJSON(A){this.planes[0].fromJSON(A.p0),this.planes[1].fromJSON(A.p1),this.planes[2].fromJSON(A.p2),this.planes[3].fromJSON(A.p3),this.planes[4].fromJSON(A.p4),this.planes[5].fromJSON(A.p5)}toString(){return t.stringifyJSONWithFixedPrecision(this.toJSON())}},GIFImage:uI,GLBaseViewport:pi,GLBillboardsPass:$e,GLBoundingBoxPass:class extends bC{constructor(){super(),this.boxes=[],this.dirtyBoxes=new Set,this.freeIndices=[],this.idToIndex=[],this.drawCount=0,this.indexArrayUpdateNeeded=!1,this.__updateRequested=!1,this.__modelMatrixArray=[],this.__treeItemDataArray=[],this.__tintColorArray=[],this.__indexArray=new Float32Array(0),this.__width=0}getPassType(){return EC.OPAQUE}init(A,g){super.init(A,g);const I=this.__renderer.gl;this.glgeom=new ji(I,new _g(1,1,1)),this.glshader=new Ce(I)}itemAddedToScene(A,g){return!1}itemRemovedFromScene(A,g){return!1}addTreeItem(A,g=!0){if(A instanceof ag&&(this.bindTreeItem(A),g)){for(const g of A.getChildren())g&&this.addTreeItem(g);A.on("childAdded",(A=>{this.addTreeItem(A.childItem)})),A.on("childRemoved",(A=>{this.unbindTreeItem(A.childItem)}))}}bindTreeItem(A){let g,I=this.freeIndices.pop();g=I||this.boxes.length,this.idToIndex[A.getId()]=g;const C=()=>{A.isVisible()?(this.drawCount++,this.dirtyBoxes.add(g)):this.drawCount--,this.indexArrayUpdateNeeded=!0};A.on("visibilityChanged",C);const i=()=>{A.isVisible()&&(this.dirtyBoxes.add(g),this.emit("updated"))};A.globalXfoParam.on("valueChanged",i),A.boundingBoxParam.on("valueChanged",i),A.isVisible()&&this.drawCount++,this.boxes[g]={treeItem:A,visibilityChanged:C,xfoChanged:i},this.indexArrayUpdateNeeded=!0,this.__updateRequested=!0,this.emit("updated")}unbindTreeItem(A){if(!(A.getId()in this.idToIndex))return void console.warn("Billboard already removed.");const g=this.idToIndex[A.getId()],I=this.boxes[g];A.off("visibilityChanged",I.visibilityChanged),A.globalXfoParam.off("valueChanged",I.xfoChanged),A.boundingBoxParam.off("valueChanged",I.xfoChanged),this.boxes[g]=null,this.freeIndices.push(g),A.isVisible()&&this.drawCount--,this.indexArrayUpdateNeeded=!0,this.__updateRequested=!0,this.__updateBoxes(),this.emit("updated")}__populateBoxesDataArray(A,g,I){const C=A.treeItem;let i,e;C instanceof kI?(i=new l(1,0,0,1),e=C.geomMatParam.value):(i=new l(0,0,1,1),e=C.globalXfoParam.value.toMat4());const t=C.boundingBoxParam.value,B=8*g*4,o=new s(new Float32Array(I.buffer,4*B,4)),a=new s(new Float32Array(I.buffer,4*(B+4),4)),n=new s(new Float32Array(I.buffer,4*(B+8),4)),d=new s(new Float32Array(I.buffer,4*(B+12),4)),h=new s(new Float32Array(I.buffer,4*(B+16),4)),c=new s(new Float32Array(I.buffer,4*(B+24),4)),r=new s(new Float32Array(I.buffer,4*(B+28),4));o.set(0,0,0,0),a.set(e.xAxis.x,e.yAxis.x,e.zAxis.x,e.translation.x),n.set(e.xAxis.y,e.yAxis.y,e.zAxis.y,e.translation.y),d.set(e.xAxis.z,e.yAxis.z,e.zAxis.z,e.translation.z),h.set(i.r,i.g,i.b,i.a),c.set(t.p0.x,t.p0.y,t.p0.z,0),r.set(t.p1.x,t.p1.y,t.p1.z,0)}__updateIndexArray(){const A=this.__gl;this.__indexArray&&this.__indexArray.length!=this.drawCount&&(A.deleteBuffer(this.__instanceIdsBuffer),this.__instanceIdsBuffer=void 0),this.__indexArray=new Float32Array(this.drawCount);let g=0;for(let A=0;A<this.boxes.length;A++)this.boxes[A]&&this.boxes[A].treeItem.isVisible()&&(this.__indexArray[g]=A,g++);this.__instanceIdsBuffer||(this.__instanceIdsBuffer=A.createBuffer()),A.bindBuffer(A.ARRAY_BUFFER,this.__instanceIdsBuffer),A.bufferData(A.ARRAY_BUFFER,this.__indexArray,A.STATIC_DRAW),this.indexArrayUpdateNeeded=!1}__updateBoxes(){this.indexArrayUpdateNeeded&&this.__updateIndexArray();const A=this.__renderer.gl;let g=Math.round(Math.sqrt(8*(this.boxes.length-this.freeIndices.length))+.5);g%8!=0&&(g+=8-g%8),this.__width=g,this.__drawItemsTexture?this.__drawItemsTexture.resize(g,g):(this.__drawItemsTexture=new HC(A,{format:"RGBA",type:"FLOAT",width:g,height:g,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.__drawItemsTexture.clear()),this.__indexArray.forEach((A=>{-1!=A&&this.__updateBox(A)})),this.__updateRequested=!1}__updateBox(A){if(0==this.drawCount||!this.__drawItemsTexture)return;const g=this.boxes[A];if(!g.treeItem.isVisible())return;const I=this.__gl,C=new Float32Array(32);this.__populateBoxesDataArray(g,0,C),I.bindTexture(I.TEXTURE_2D,this.__drawItemsTexture.glTex);const i=8*A%this.__width,e=Math.floor(8*A/this.__width),t=this.__drawItemsTexture.getType(),B=this.__drawItemsTexture.getFormat();if(t==I.FLOAT)I.texSubImage2D(I.TEXTURE_2D,0,i,e,8,1,B,t,C);else{const A=r.convertFloat32ArrayToUInt16Array(C);I.texSubImage2D(I.TEXTURE_2D,0,i,e,8,1,B,t,A)}}draw(A){if(0==this.drawCount)return;this.__updateRequested&&this.__updateBoxes(),this.dirtyBoxes.size>0&&(this.dirtyBoxes.forEach((A=>{this.__updateBox(A)})),this.dirtyBoxes.clear()),this.indexArrayUpdateNeeded&&this.__updateIndexArray();const g=this.__gl;this.glshader.bind(A),this.glgeom.bind(A);const I=A.unifs;if(g.uniform1i(I.occlusionCulling.location,0),g.floatTexturesSupported&&g.drawElementsInstanced){this.__drawItemsTexture.bindToUniform(A,I.instancesTexture),g.uniform1i(I.instancesTextureSize.location,this.__width);{const I=A.attrs.instancedIds.location;g.enableVertexAttribArray(I),g.bindBuffer(g.ARRAY_BUFFER,this.__instanceIdsBuffer),g.vertexAttribPointer(I,1,g.FLOAT,!1,4,0),g.vertexAttribDivisor(I,1)}g.uniform1i(I.instancedDraw.location,1),A.bindViewports(I,(()=>{this.glgeom.drawInstanced(A,this.drawCount)}))}else{const C=this.__indexArray.length;for(let i=0;i<C;i++)A.bindViewports(I,(()=>{g.drawQuad()}))}}},GLCADPass:class extends bC{constructor(A=!1){super(),console.warn("GLCADPass is deprecated. No need to install this pass in the renderer.")}itemAddedToScene(A,g){return!1}itemRemovedFromScene(A,g){return!1}},GLFbo:fC,GLGeom:Wi,GLGeomItem:ge,GLGeomItemChangeType:{GEOMITEM_CHANGED:0,GEOM_CHANGED:1,VISIBILITY_CHANGED:2,HIGHLIGHT_CHANGED:3},GLGeomItemFlags:Ae,GLGeomItemSet:Ge,GLLines:ji,GLLinesPass:Pe,GLMaterial:_i,GLMaterialGeomItemSets:me,GLMesh:Yi,GLOpaqueGeomsPass:_e,GLOverlayPass:At,GLPass:bC,GLPoints:Oi,GLRenderTarget:LC,GLRenderer:re,GLShader:DC,GLShaderMaterials:Qe,GLStandardGeomsPass:De,GLTexture2D:HC,GLTransparentGeomsPass:Oe,GLViewport:Ni,GeomItem:kI,GeomLibrary:OI,GeometryParameter:hg,Grid:Pg,GridTreeItem:ZC,GrowingPacker:S,HDRImage:BI,IGeomShaderBinding:xC,ImageParameter:OA,IndexEvent:p,InstanceItem:MI,IntersectionData:H,ItemEvent:ng,ItemSetParameter:dg,KeyboardEvent:J,KinematicGroup:tC,LDRImage:tI,LDRVideo:oI,Label:SI,LabelManager:VI,LatLongEnvProjectionShader:class extends be{constructor(A){super(A),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'envmap-equirect.glsl'\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = latLongUVsFromDir(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}},Lines:Yg,LinesCuboid:_g,LinesMaterial:KI,LinesProxy:Jg,LinesShader:Ve,ListParameter:$A,Mat3:d,Mat3OperatorInput:class extends tg{},Mat3OperatorOutput:class extends gg{},Mat3Parameter:TA,Mat4:h,Mat4OperatorInput:class extends tg{},Mat4OperatorOutput:ig,Mat4Parameter:_A,Material:XI,MaterialColorParam:Qg,MaterialFloatParam:mg,MaterialGroup:BC,MaterialLibrary:jI,MaterialParameter:rg,MathFunctions:r,Mesh:Kg,MeshProxy:Dg,MultiChoiceParameter:DA,NameChangedEvent:sA,NormalsShader:class extends DC{constructor(A){super(A,"NormalsShader"),this.setShaderStage("VERTEX_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\ninstancedattribute vec3 positions;\ninstancedattribute vec3 normals;\nattribute vec2 vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float normalLength;\n\nimport 'drawItemTexture.glsl'\nimport 'modelMatrix.glsl'\n\n/* VS Outputs */\nvarying float v_weight;\n\nvoid main(void) {\n  mat4 modelMatrix = getModelMatrix(geomItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  if (vertexIDs.x == 0.0) {\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n    v_weight = 1.0;\n  }\n  else {\n    gl_Position = modelViewProjectionMatrix * vec4(positions+(normals*normalLength), 1.0);\n    v_weight = 0.0;\n  }\n}\n"),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nuniform color normalColor;\n\n/* VS Outputs */\nvarying float v_weight;\n\nvoid main(void) {\n  gl_FragColor = normalColor;\n  gl_FragColor.a = v_weight;\n}\n")}},NumberOperatorInput:class extends tg{},NumberOperatorOutput:class extends gg{},NumberParameter:JA,ObjAsset:class extends $I{constructor(A){super(A),this.splitObjects=new fA("splitObjects",!1),this.splitGroupsIntoObjects=new fA("splitGroupsIntoObjects",!1),this.loadMtlFile=new fA("loadMtlFile",!0),this.unitsConversion=new JA("unitsConversion",1),this.defaultShader=new jA("defaultShader",""),this.splitObjectsParam=new fA("splitObjects",!1),this.splitGroupsIntoObjectsParam=new fA("splitGroupsIntoObjects",!1),this.loadMtlFileParam=new fA("loadMtlFile",!0),this.unitsConversionParam=new JA("unitsConversion",1),this.defaultShaderParam=new jA("defaultShader",""),this.addParameter(this.splitObjectsParam),this.addParameter(this.splitGroupsIntoObjectsParam),this.addParameter(this.loadMtlFileParam),this.addParameter(this.unitsConversionParam),this.addParameter(this.defaultShaderParam)}load(A){return this.loaded=!1,new Promise(((g,I)=>{const C=A.substring(0,A.lastIndexOf("/"))+"/",i=A=>{const g=A.split("\n"),I=/\s+/;let i;const e=function(A){if(3==A.length)return new l(parseFloat(A[0]),parseFloat(A[1]),parseFloat(A[2]));throw new Error("Unable to parse a color from the following parts:"+A.join("_"))},t=(A,g)=>{const I=new eI(A);return I.load(C+g),I};for(let A=0;A<g.length;A++){let C=g[A].trim();if(C.startsWith("#"))continue;C.includes("#")&&(C=C.substring(0,C.indexOf("#")).trim());const B=C.split(I),o=B.shift(),s=B.join(" ");switch(o){case"newmtl":i=new XI(s),i.setShaderName("StandardSurfaceShader"),this.materialLibrary.addMaterial(i);break;case"Kd":{const A=i.getParameter("BaseColor");A.value=e(B),A instanceof Qg&&(A.colorSpace,pA.Linear);break}case"map_Kd":{const A=i.getParameter("BaseColor");A instanceof Qg&&A.setImage(t("map_Kd",B[0]));break}case"Ks":const A=(parseFloat(B[0])+parseFloat(B[1])+parseFloat(B[2]))/3;i.getParameter("Roughness").value=1-A,i.getParameter("Reflectance").value=A;break;case"map_Ks":const g=i.getParameter("Roughness");g instanceof mg&&g.setImage(t("map_Ks",B[0])),i.getParameter("Reflectance").value=.2;break;case"d":const I=parseFloat(s);I<1&&(i.setShaderName("TransparentSurfaceShader"),i.getParameter("Opacity").value=I);break;case"map_d":i.getParameter("alpha").value=parseFloat(B[0]);break;case"map_bump":const C=i.getParameter("Normal");C instanceof Qg&&C.setImage(t("normal",B[0]))}}},e=A=>new Promise((g=>{rA(A,(A=>{FA.incrementWorkDone(1),i(A),FA.incrementWorkDone(1),g()}))})),t=[],s=[],a=[],n={},d=A=>mA(this,void 0,void 0,(function*(){const g=A.split("\n"),I=/\s+/;let i,B,o=0;const l=A=>{if(A in n){let g=1;for(;A+String(g)in n;)g++;A+=String(g)}i={verticesRemapping:{},texCoordsRemapping:{},normalsRemapping:{},vertexIndices:[],texCoordIndices:[],normalIndices:[],numVertices:0,numTexCoords:0,numNormals:0,faceCounts:[],material:B},n[A]=i,o++};l("geom");const d=this.splitGroupsIntoObjectsParam.value;for(let A=0;A<g.length;A++){let h=g[A].trim();if(h.startsWith("#"))continue;h.includes("#")&&(h=h.substring(0,h.indexOf("#")).trim());const c=h.split(I),r=c.shift(),G=c.join(" ");switch(r){case"":case"s":continue;case"mtllib":if(!this.loadMtlFileParam.value)continue;FA.incrementWorkload(2);const A=C+G;A&&(yield e(A));break;case"o":l(G);break;case"usemtl":B=G,l(G+Object.keys(n).length);break;case"g":d&&l(G?c.join("_"):"Group"+o);break;case"v":t.push(c.map((A=>parseFloat(A))));break;case"vt":a.push(c.map((A=>parseFloat(A))));break;case"vn":s.push(c.map((A=>parseFloat(A))));break;case"f":{const A=[],g=[],I=[];for(let C=0,e=c.length;C<e;C++){const e=c[C].split("/").map((A=>parseInt(A)-1)),t=e[0];let B=i.verticesRemapping[t];if(null==B&&(B=i.numVertices,i.verticesRemapping[t]=B,i.numVertices++),A.push(B),e.length>1&&!isNaN(e[1])){const A=e[1];g.push(A)}if(e.length>2&&!isNaN(e[2])){const A=e[2];I.push(A)}}i.vertexIndices.push(A),I.length>0&&i.normalIndices.push(I),g.length>0&&i.texCoordIndices.push(g),null==i.faceCounts[A.length-3]&&(i.faceCounts[A.length-3]=[]),i.faceCounts[A.length-3]++;break}default:console.warn("Unhandled line:"+h)}}})),h=()=>{for(const A in n)0!=n[A].numVertices&&c(A,n[A]);this.emit("loaded"),this.getGeometryLibrary().emit("loaded"),this.emit("geomsLoaded"),g()},c=(A,g)=>{for(let A=0;A<g.faceCounts.length;A++)null==g.faceCounts[A]&&(g.faceCounts[A]=0);const I=g.numVertices,C=new Kg;C.setDebugName(A),C.setFaceCounts(g.faceCounts),C.setNumVertices(I);const i=C.getVertexAttribute("positions"),e=this.unitsConversionParam.value;for(const A in g.verticesRemapping){const I=Number.parseInt(A),C=g.verticesRemapping[I];i.getValueRef(C).set(t[I][0]*e,t[I][1]*e,t[I][2]*e)}let l,n;g.normalIndices.length>0&&(l=new Zg,C.addVertexAttribute("normals",l)),g.texCoordIndices.length>0&&(n=new yg,C.addVertexAttribute("texCoords",n));const d=Array(g.faceCounts.length).fill(0);for(let A=0;A<g.vertexIndices.length;A++){const I=g.vertexIndices[A];let i=0;for(let A=0;A<I.length-3;++A)g.faceCounts[A]&&(i+=g.faceCounts[A]);if(i+=d[I.length-3],d[I.length-3]++,C.setFaceVertexIndices(i,I),l){const I=g.normalIndices[A];for(let A=0;A<I.length;A++){const g=new o(s[I[A]][0],s[I[A]][1],s[I[A]][2]);l.setFaceVertexValue(i,A,g)}}if(n&&g.texCoordIndices.length==g.vertexIndices.length){const I=g.texCoordIndices[A];for(let A=0;A<I.length;A++){const g=new B(a[I[A]][0],a[I[A]][1]);n.setFaceVertexValue(i,A,g)}}}const h=new kI(A,C),c=C.getBoundingBox().center();{const A=c.negate(),g=C.getVertexAttribute("positions");for(let I=0;I<g.getCount();I++)g.getValueRef(I).addInPlace(A);C.setBoundingBoxDirty()}if(h.localXfoParam.value=new m(c),null!=g.material&&this.materialLibrary.hasMaterial(g.material))h.materialParam.value=this.materialLibrary.getMaterial(g.material);else{const g=this.defaultShaderParam.value,I=new XI(A+" mat");I.setShaderName(""!=g?g:"StandardSurfaceShader"),this.materialLibrary.addMaterial(I),h.materialParam.value=I}this.addChild(h,!1)};(()=>{FA.incrementWorkload(2),rA(A,(A=>{FA.incrementWorkDone(1),d(A).then((()=>{h(),FA.incrementWorkDone(1)}))}),(A=>{this.emit("error",A),I(A)}))})()}))}},OctahedralEnvProjectionShader:class extends be{constructor(A){super(A),this.setShaderStage("FRAGMENT_SHADER","\nprecision highp float;\n#define GLSLIFY 1\n\nimport 'GLSLUtils.glsl'\nimport 'envmap-octahedral.glsl'\nimport 'gamma.glsl'\nimport 'materialparams.glsl'\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n")}},OpacityStateChangedEvent:_,Operator:eg,OperatorInput:tg,OperatorOutput:gg,get OperatorOutputMode(){return KA},PMIItem:GC,PMIView:mC,POINTER_TYPES:q,Parameter:NA,ParameterAddedEvent:D,ParameterOwner:nA,ParameterRemovedEvent:f,PassType:EC,Plane:AI,PlaneType:Z,PointGrid:kg,Points:Wg,PointsMaterial:pI,PointsProxy:Ng,PointsShader:Se,ProceduralLines:Ug,ProceduralMesh:vg,ProceduralPoints:Lg,Quat:c,QuatOperatorInput:class extends tg{},QuatOperatorOutput:class extends gg{},QuatParameter:zA,RGBA:a,RangeLoadedEvent:M,Ray:G,Rect:xg,RefCounted:lA,Registry:e,ResizedEvent:F,ResourceLoader:VA,SInt16:3,SInt32:5,SInt8:1,Scene:uC,SceneSetEvent:L,ScreenQuadShader:Xi,ScreenSpaceMaterial:NI,ScreenSpaceShader:Ne,SelectabilityChangedEvent:U,SelectedEvent:v,SelectionSet:zI,ShaderLibrary:pC,ShaderNameChangedEvent:k,SimpleSurfaceMaterial:JI,SimpleSurfaceShader:We,Sphere:gI,SphereType:E,StandardSurfaceMaterial:DI,StandardSurfaceShader:Ke,StateChangedEvent:x,StreamFileParsedEvent:z,StringFunctions:t,StringListParameter:qA,StringParameter:jA,StructParameter:Ag,SystemDesc:g,TexturedChangedEvent:T,Torus:II,Touch:eA,TreeItem:ag,TreeItemParameter:lg,UInt16:2,UInt32:4,UInt8:0,UnpackHDRShader:vC,VLAAsset:RC,VRController:class extends Di{},VRViewport:class extends Mi{},Vec2:B,Vec2Attribute:yg,Vec2OperatorInput:class extends tg{},Vec2OperatorOutput:class extends gg{},Vec2Parameter:MA,Vec3:o,Vec3Attribute:Zg,Vec3OperatorInput:class extends tg{},Vec3OperatorOutput:class extends gg{},Vec3Parameter:LA,Vec4:s,Vec4Attribute:Xg,Vec4OperatorInput:class extends tg{},Vec4OperatorOutput:Ig,Vec4Parameter:UA,Version:WA,VideoStreamImage2D:wI,ViewChangedEvent:P,VisibilityChangedEvent:O,XRController:Di,XRControllerEvent:gA,XRHead:Ji,XRPoseEvent:IA,XRViewChangedEvent:j,XRViewManipulator:fi,XRViewport:Mi,XRef:QC,Xfo:m,XfoOperatorInput:Bg,XfoOperatorOutput:Cg,XfoParameter:PA,XrViewportEvent:CA,ZeaMouseEvent:iA,ZeaPointerEvent:AA,ZeaTouchEvent:tA,ZeaUIEvent:N,ZeaWheelEvent:BA,checkFramebuffer:MC,create3DContext:wC,genDataTypeDesc:kC,generateShaderGeomBinding:_C,getFileFolder:function(A){return A.substring(0,A.lastIndexOf("/"))+"/"},labelManager:FI,libsRegistry:gt,loadBinfile:GA,loadJSONfile:function(A,g,I,C){cA(A,"json",(A=>{g(A.response,A)}),(g=>{if(null==I)throw new Error("Unable to XHR File:"+A);I(g)}),C)},loadTextfile:rA,loadXMLfile:function(A,g,I,C){cA(A,"document",(A=>{g(A.responseXML)}),(g=>{if(null==I)throw new Error("Unable to XHR File:"+A);I(g)}),C)},resourceLoader:FA,shaderLibrary:NC}),Ct="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function it(A,g,I){return A(I={path:g,exports:{},require:function(A,g){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==g&&I.path)}},I.exports),I.exports}function et(A){if(A.__esModule)return A;var g=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(A).forEach((function(I){var C=Object.getOwnPropertyDescriptor(A,I);Object.defineProperty(g,I,C.get?C:{enumerable:!0,get:function(){return A[I]}})})),g}var tt=it((function(A){!function(g){var I={bytesToHex:function(A){return function(A){return A.map((function(A){return g=A.toString(16),I=2,g.length>I?g:Array(I-g.length+1).join("0")+g;var g,I})).join("")}(A)},hexToBytes:function(A){if(A.length%2==1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return 0===A.indexOf("0x")&&(A=A.slice(2)),A.match(/../g).map((function(A){return parseInt(A,16)}))}};A.exports?A.exports=I:g.convertHex=I}(Ct)})),Bt=it((function(A){!function(g){var I={bytesToString:function(A){return A.map((function(A){return String.fromCharCode(A)})).join("")},stringToBytes:function(A){return A.split("").map((function(A){return A.charCodeAt(0)}))}};I.UTF8={bytesToString:function(A){return decodeURIComponent(escape(I.bytesToString(A)))},stringToBytes:function(A){return I.stringToBytes(unescape(encodeURIComponent(A)))}},A.exports?A.exports=I:g.convertString=I}(Ct)}));it((function(A){!function(g){var I={};A.exports?(I.bytesToHex=tt.bytesToHex,I.convertString=Bt,A.exports=t):(I.bytesToHex=g.convertHex.bytesToHex,I.convertString=g.convertString,g.sha256=t);var C=[];!function(){function A(A){for(var g=Math.sqrt(A),I=2;I<=g;I++)if(!(A%I))return!1;return!0}function g(A){return 4294967296*(A-(0|A))|0}for(var I=2,i=0;i<64;)A(I)&&(C[i]=g(Math.pow(I,1/3)),i++),I++}();var i=[],e=function(A,g,I){for(var e=A[0],t=A[1],B=A[2],o=A[3],s=A[4],a=A[5],l=A[6],n=A[7],d=0;d<64;d++){if(d<16)i[d]=0|g[I+d];else{var h=i[d-15],c=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,r=i[d-2],G=(r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10;i[d]=c+i[d-7]+G+i[d-16]}var m=e&t^e&B^t&B,Q=(e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22),E=n+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&a^~s&l)+C[d]+i[d];n=l,l=a,a=s,s=o+E|0,o=B,B=t,t=e,e=E+(Q+m)|0}A[0]=A[0]+e|0,A[1]=A[1]+t|0,A[2]=A[2]+B|0,A[3]=A[3]+o|0,A[4]=A[4]+s|0,A[5]=A[5]+a|0,A[6]=A[6]+l|0,A[7]=A[7]+n|0};function t(A,g){A.constructor===String&&(A=I.convertString.UTF8.stringToBytes(A));var C=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],i=function(A){for(var g=[],I=0,C=0;I<A.length;I++,C+=8)g[C>>>5]|=A[I]<<24-C%32;return g}(A),t=8*A.length;i[t>>5]|=128<<24-t%32,i[15+(t+64>>9<<4)]=t;for(var B=0;B<i.length;B+=16)e(C,i,B);var o=function(A){for(var g=[],I=0;I<32*A.length;I+=8)g.push(A[I>>>5]>>>24-I%32&255);return g}(C);return g&&g.asBytes?o:g&&g.asString?I.convertString.bytesToString(o):I.bytesToHex(o)}t.x2=function(A,g){return t(t(A,{asBytes:!0}),g)}}(Ct)}));export{AC as A,fA as B,lC as C,V as E,kI as G,MI as I,Jg as L,Dg as M,JA as N,GC as P,c as Q,jA as S,ag as T,o as V,m as X,Ct as a,nC as b,it as c,dC as d,Mg as e,SC as f,et as g,l as h,It as i,xA as j,aC as k,XI as l,ZC as m,b as n,re as o,uC as p,g as q,RI as r,FA as s};
//# sourceMappingURL=sha256-806d8515.js.map
