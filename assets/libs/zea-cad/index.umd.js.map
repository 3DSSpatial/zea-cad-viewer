{"version":3,"file":"index.umd.js","sources":["../src/CADConstants.js","../src/Hull.js","../src/CADSurfaceLibrary.js","../src/CADTrimSetLibrary.js","../src/CADBodyLibrary.js","../src/CADBody.js","../src/CADAsset.js","../src/CADAssembly.js","../src/CADPart.js","../src/StringListParameter.js","../src/PMIView.js","../src/XRef.js","../src/GLSurfaceDrawSet.js","../src/GLCurveDrawSet.js","../src/GLEvaluateCADCurveShader.js","../src/GLCurveLibrary.js","../src/Math/BinReader.js","../src/GLSLBinReader.js","../src/GLSLMath.js","../src/GLSLCADCurves.js","../src/GLSLCADSurfaces.js","../src/GLSLNURBS.js","../src/GLSLNURBSCurves.js","../src/GLSLNURBSSurfaces.js","../src/GLEvaluateCADSurfaceShader.js","../src/GLSurfaceLibrary.js","../src/GLTrimCurveDrawSet.js","../src/GLDrawTrimCurveFansShader.js","../src/GLFlattenTrimSetsShader.js","../src/GLDrawTrimCurveStripsShader.js","../src/GLDebugTrimSetsShader.js","../src/GLTrimSetLibrary.js","../src/GLCADBody.js","../node_modules/rollup-plugin-web-worker-loader/src/WorkerLoaderHelper.js","../src/GLCADAsset.js","../src/GLCADMaterialLibrary.js","../src/GLSLCADConstants.js","../src/GLSLCADSurfaceDrawing.js","../src/GLCADShader.js","../src/GLDrawCADSurfaceNormalsShader.js","../src/GLDrawCADSurfaceShader.js","../src/GLDrawCADSurfaceGeomDataShader.js","../src/GLDrawSelectedCADSurfaceShader.js","../src/GLDrawCADCurveShader.js","../src/GLCADPass.js"],"sourcesContent":["const CADCurveTypes = {\r\n  CURVE_TYPE_LINE: 20,\r\n  CURVE_TYPE_CIRCLE: 21,\r\n  CURVE_TYPE_ELIPSE: 22,\r\n  //  CURVE_TYPE_HYPERBOLA: 23,\r\n  //  CURVE_TYPE_PARABOLA: 24,\r\n  //  CURVE_TYPE_BEZIERCURVE: 25,\r\n  CURVE_TYPE_NURBS_CURVE: 26,\r\n  //  CURVE_TYPE_OFFSET_CURVE: 27,\r\n  //  CURVE_TYPE_TRIMMED_CURVE: 28\r\n}\r\n\r\nconst CADSurfaceTypes = {\r\n  SURFACE_TYPE_PLANE: 0,\r\n  SURFACE_TYPE_CONE: 1,\r\n  SURFACE_TYPE_CYLINDER: 2,\r\n  SURFACE_TYPE_SPHERE: 3,\r\n  SURFACE_TYPE_TORUS: 4,\r\n  SURFACE_TYPE_LINEAR_EXTRUSION: 5,\r\n  SURFACE_TYPE_REVOLUTION: 6,\r\n  //  SURFACE_TYPE_BEZIER_SURFACE: 7,\r\n  SURFACE_TYPE_NURBS_SURFACE: 8,\r\n  SURFACE_TYPE_OFFSET_SURFACE: 9,\r\n  SURFACE_TYPE_TRIMMED_RECT_SURFACE: 10,\r\n  SURFACE_TYPE_POLY_PLANE: 14,\r\n  SURFACE_TYPE_FAN: 15,\r\n  SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN: 16,\r\n}\r\n\r\nconst getCurveTypeName = (id) => {\r\n  switch (id) {\r\n    case CADCurveTypes.CURVE_TYPE_LINE:\r\n      return 'CURVE_TYPE_LINE'\r\n    case CADCurveTypes.CURVE_TYPE_CIRCLE:\r\n      return 'CURVE_TYPE_CIRCLE'\r\n    case CADCurveTypes.CURVE_TYPE_ELIPSE:\r\n      return 'CURVE_TYPE_ELIPSE'\r\n    // case CADCurveTypes.CURVE_TYPE_HYPERBOLA: return 'CURVE_TYPE_HYPERBOLA';\r\n    // case CADCurveTypes.CURVE_TYPE_PARABOLA: return 'CURVE_TYPE_PARABOLA';\r\n    // case CADCurveTypes.CURVE_TYPE_BEZIERCURVE: return 'CURVE_TYPE_BEZIERCURVE';\r\n    case CADCurveTypes.CURVE_TYPE_NURBS_CURVE:\r\n      return 'CURVE_TYPE_NURBS_CURVE'\r\n    // case CADCurveTypes.CURVE_TYPE_OFFSET_CURVE: return 'CURVE_TYPE_OFFSET_CURVE';\r\n    // case CADCurveTypes.CURVE_TYPE_TRIMMED_CURVE: return 'CURVE_TYPE_TRIMMED_CURVE';\r\n  }\r\n}\r\n\r\nconst getSurfaceTypeName = (id) => {\r\n  switch (id) {\r\n    case CADSurfaceTypes.SURFACE_TYPE_PLANE:\r\n      return 'SURFACE_TYPE_PLANE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_CONE:\r\n      return 'SURFACE_TYPE_CONE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_CYLINDER:\r\n      return 'SURFACE_TYPE_CYLINDER'\r\n    case CADSurfaceTypes.SURFACE_TYPE_SPHERE:\r\n      return 'SURFACE_TYPE_SPHERE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_TORUS:\r\n      return 'SURFACE_TYPE_TORUS'\r\n    case CADSurfaceTypes.SURFACE_TYPE_LINEAR_EXTRUSION:\r\n      return 'SURFACE_TYPE_LINEAR_EXTRUSION'\r\n    case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION:\r\n      return 'SURFACE_TYPE_REVOLUTION'\r\n    //    case CADSurfaceTypes.SURFACE_TYPE_BEZIER_SURFACE: return 'SURFACE_TYPE_BEZIER_SURFACE';\r\n    case CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE:\r\n      return 'SURFACE_TYPE_NURBS_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_OFFSET_SURFACE:\r\n      return 'SURFACE_TYPE_OFFSET_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_TRIMMED_RECT_SURFACE:\r\n      return 'SURFACE_TYPE_TRIMMED_RECT_SURFACE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_POLY_PLANE:\r\n      return 'SURFACE_TYPE_POLY_PLANE'\r\n    case CADSurfaceTypes.SURFACE_TYPE_FAN:\r\n      return 'SURFACE_TYPE_FAN'\r\n    case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN:\r\n      return 'SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN'\r\n  }\r\n}\r\n\r\nconst geomLibraryHeaderSize = 8 // 2 FP16 pixels at the start of the GeomLibrary and CurveLibrary\r\n// const pixelsPerDrawItem = 10 // The number of RGBA pixels per draw item.\r\nconst pixelsPerDrawItem = 3 // tr, ori, sc: number of RGBA pixels per draw item.\r\nconst valuesPerCurveTocItem = 8\r\nconst valuesPerSurfaceTocItem = 9\r\nconst valuesPerCurveLibraryLayoutItem = 8\r\nconst valuesPerSurfaceLibraryLayoutItem = 8\r\n//const valuesPerSurfaceRef = 11 // A surfaceRef within a BodyDesc// This is now different based on the version.\r\nconst drawItemShaderAttribsStride = 8\r\nconst floatsPerSceneBody = 2\r\nconst drawShaderAttribsStride = 4 //drawCoords: body ID, Surface index in Body, Surface Id, TrimSet Id // + 2 drawItemTexAddr\r\nconst numValuesPerTrimSetCurveRef = 14 //patchCoords.xyzw, tr.xy, ori.xy, ori.zy, addr.xy, flags, curveId, curveIndexWithinLoop\r\n\r\nconst CURVE_FLAG_PERIODIC = 1 << 0\r\nconst CURVE_FLAG_UNUSED2 = 1 << 2\r\nconst CURVE_FLAG_COST_IS_DETAIL = 1 << 3\r\n\r\nconst SURFACE_FLAG_PERIODIC_U = 1 << 0\r\nconst SURFACE_FLAG_PERIODIC_V = 1 << 1\r\nconst SURFACE_FLAG_UNUSED2 = 1 << 2\r\nconst SURFACE_FLAG_UNUSED3 = 1 << 3\r\nconst SURFACE_FLAG_FLIPPED_NORMAL = 1 << 4\r\nconst SURFACE_FLAG_FLIPPED_UV = 1 << 5\r\nconst SURFACE_FLAG_COST_IS_DETAIL_U = 1 << 6\r\nconst SURFACE_FLAG_COST_IS_DETAIL_V = 1 << 7\r\n\r\nconst BODY_FLAG_CUTAWAY = 1 << 8\r\nconst BODY_FLAG_INVISIBLE = 1 << 9\r\n\r\nexport {\r\n  CADCurveTypes,\r\n  CADSurfaceTypes,\r\n  getCurveTypeName,\r\n  getSurfaceTypeName,\r\n  CURVE_FLAG_COST_IS_DETAIL,\r\n  SURFACE_FLAG_PERIODIC_U,\r\n  SURFACE_FLAG_PERIODIC_V,\r\n  SURFACE_FLAG_COST_IS_DETAIL_U,\r\n  SURFACE_FLAG_COST_IS_DETAIL_V,\r\n  SURFACE_FLAG_FLIPPED_NORMAL,\r\n  SURFACE_FLAG_FLIPPED_UV,\r\n  BODY_FLAG_CUTAWAY,\r\n  BODY_FLAG_INVISIBLE,\r\n  geomLibraryHeaderSize,\r\n  pixelsPerDrawItem,\r\n  valuesPerCurveTocItem,\r\n  valuesPerSurfaceTocItem,\r\n  valuesPerCurveLibraryLayoutItem,\r\n  valuesPerSurfaceLibraryLayoutItem,\r\n  /*valuesPerSurfaceRef,*/\r\n  drawItemShaderAttribsStride,\r\n  drawShaderAttribsStride,\r\n  floatsPerSceneBody,\r\n  numValuesPerTrimSetCurveRef,\r\n}\r\n","import { Lines } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a hull.\r\n * @extends Lines\r\n * @ignore\r\n */\r\nclass Hull extends Lines {\r\n  /**\r\n   * Create a hull.\r\n   * @param {number} numCPsU - The numCPsU value.\r\n   * @param {number} numCPsV - The numCPsV value.\r\n   */\r\n  constructor(numCPsU = 1, numCPsV = 1) {\r\n    super()\r\n    this.__numSpansU = numCPsU - 1\r\n    this.__numSpansV = numCPsV - 1\r\n    this.__rebuild()\r\n  }\r\n\r\n  /**\r\n   * The __rebuild method.\r\n   * @private\r\n   */\r\n  __rebuild() {\r\n    this.setNumVertices((this.__numSpansU + 1) * (this.__numSpansV + 1))\r\n    this.setNumSegments(this.__numSpansU * (this.__numSpansV + 1) + (this.__numSpansU + 1) * this.__numSpansV)\r\n\r\n    let idx = 0\r\n    for (let j = 0; j <= this.__numSpansV; j++) {\r\n      for (let i = 0; i < this.__numSpansU; i++) {\r\n        const v0 = (this.__numSpansU + 1) * j + i\r\n        const v1 = (this.__numSpansU + 1) * j + (i + 1)\r\n        this.setSegmentVertexIndices(idx, v0, v1)\r\n        idx++\r\n      }\r\n    }\r\n    for (let j = 0; j < this.__numSpansV; j++) {\r\n      for (let i = 0; i <= this.__numSpansU; i++) {\r\n        const v0 = (this.__numSpansU + 1) * j + i\r\n        const v1 = (this.__numSpansU + 1) * (j + 1) + i\r\n        this.setSegmentVertexIndices(idx, v0, v1)\r\n        idx++\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { Hull }\r\n// export default Hull;\r\n","import { Vec2, Vec3, Vec4, Box2, Quat, Color, Plane, Material, BinReader } from '@zeainc/zea-engine'\r\nimport { Hull } from './Hull.js'\r\nimport {\r\n  geomLibraryHeaderSize,\r\n  valuesPerCurveTocItem,\r\n  valuesPerSurfaceTocItem,\r\n  SURFACE_FLAG_PERIODIC_U,\r\n  SURFACE_FLAG_PERIODIC_V,\r\n  CADCurveTypes,\r\n  CADSurfaceTypes,\r\n  getCurveTypeName,\r\n  getSurfaceTypeName,\r\n} from './CADConstants.js'\r\n\r\n/** Class representing a CAD surface library.\r\n * @ignore\r\n */\r\nclass CADSurfaceLibrary {\r\n  /**\r\n   * Create a CAD surface library.\r\n   * @param {any} cadAsset - The cadAsset value.\r\n   * @param {any} trimSetLibrary - The trimSetLibrary value.\r\n   */\r\n  constructor(cadAsset, trimSetLibrary) {\r\n    this.__cadAsset = cadAsset\r\n    this.__trimSetLibrary = trimSetLibrary\r\n    this.__curveLibraryBuffer = undefined\r\n    this.__meshes = []\r\n    this.__hulls = []\r\n    this.__formFactors = {}\r\n\r\n    this.__maxNumKnots = 0\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffers method.\r\n   * @param {any} curveLibraryBuffer - The curveLibraryBuffer param.\r\n   * @param {any} surfaceLibraryBuffer - The surfaceLibraryBuffer param.\r\n   * @param {number} version - The version param.\r\n   */\r\n  setBinaryBuffers(curveLibraryBuffer, surfaceLibraryBuffer, cadDataVersion) {\r\n    this.__surfaceLibraryBuffer = surfaceLibraryBuffer\r\n    this.cadDataVersion = cadDataVersion\r\n    this.__surfaceLibraryReader = new BinReader(this.__surfaceLibraryBuffer)\r\n\r\n    this.__surfaceLibrarySize = Math.sqrt(surfaceLibraryBuffer.byteLength / 8) // RGBA16 pixels\r\n    this.__numSurfaces = this.__surfaceLibraryReader.loadUInt32()\r\n    this.__totalSurfaceArea = this.__surfaceLibraryReader.loadFloat32()\r\n\r\n    // this.__totalSurfaceCost = this.__surfaceLibraryReader.loadFloat32();\r\n\r\n    // for (let i = 0; i < this.__numCurves; i++) {\r\n    //   const dims = this.getCurveDims(i);\r\n    //   console.log(this.getCurveTypeLabel(i), \" length:\", dims.length, \" curvature:\", dims.curvature);\r\n    // }\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   const dims = this.getSurfaceDims(i);\r\n    //   const area = dims.sizeU * dims.sizeV;\r\n\r\n    //   console.log(this.getSurfaceTypeLabel(i), \" sizeU:\", dims.sizeU, \" sizeV:\", dims.sizeV, \" curvatureU:\", dims.curvatureU, \" curvatureV:\", dims.curvatureV);\r\n    // }\r\n\r\n    // if (this.__totalSurfaceArea == 0.0) {\r\n    //   this.__totalSurfaceArea == 0.0;\r\n    //   this.__totalSurfaceCost = 0.0;\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   const dims = this.getSurfaceDims(i);\r\n    //   const area = dims.sizeU * dims.sizeV;\r\n\r\n    //   console.log(this.getSurfaceTypeLabel(i), \" sizeU:\", dims.sizeU, \" sizeV:\", dims.sizeV, \" curvatureU:\", dims.curvatureU, \" curvatureV:\", dims.curvatureV);\r\n    //   // this.__totalSurfaceArea += area;\r\n    //   // this.__totalSurfaceCost += (1.0 + (dims.sizeU * dims.curvatureU)) * (1.0 + (dims.sizeV * dims.curvatureV));\r\n    // }\r\n    // }\r\n    // console.log(this.__totalSurfaceCost);\r\n\r\n    // this.__triCounts = [\r\n    //   10,\r\n    //   20,\r\n    //   40,\r\n    //   80,\r\n    // ]\r\n\r\n    if (this.__totalSurfaceArea == 0.0) {\r\n      for (let i = 0; i < this.__numSurfaces; i++) {\r\n        const dims = this.getSurfaceDims(i)\r\n        const area = dims.sizeU * dims.sizeV\r\n        this.__totalSurfaceArea += area\r\n      }\r\n    }\r\n\r\n    this.__curveLibraryBuffer = curveLibraryBuffer\r\n    this.__curveLibraryReader = new BinReader(this.__curveLibraryBuffer)\r\n    this.__curveLibrarySize = Math.sqrt(curveLibraryBuffer.byteLength / 8) // RGBA16 pixels\r\n    this.__numCurves = this.__curveLibraryReader.loadUInt32()\r\n\r\n    // for (let i = 0; i < this.__numSurfaces; i++) {\r\n    //   console.log(this.getSurfaceData(i, false));\r\n    // }\r\n    // for (let i = 0; i < this.__numCurves; i++) {\r\n    //   console.log(this.getCurveData(i));\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getCurveBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveBuffer() {\r\n    return this.__curveLibraryBuffer\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceBuffer() {\r\n    return this.__surfaceLibraryBuffer\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfaces method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfaces() {\r\n    return this.__numSurfaces\r\n  }\r\n\r\n  /**\r\n   * The getNumCurves method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumCurves() {\r\n    return this.__numCurves\r\n  }\r\n\r\n  /**\r\n   * The getDetailFactor method.\r\n   * @param {any} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDetailFactor(lod) {\r\n    // Given a target poly count, calculate the detail factor given the total surface cost.\r\n    // const targetQuadCount = this.__triCounts[Math.clamp(0, lod, this.__triCounts.length-1)] * 1000;\r\n    // return targetQuadCount / this.__totalSurfaceCost;\r\n    const mult = Math.pow(2, lod)\r\n    return mult * this.__cadAsset.curvatureToDetail\r\n  }\r\n\r\n  /**\r\n   * The getCurveDataTexelCoords method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveDataTexelCoords(curveId) {\r\n    this.__curveLibraryReader.seek(geomLibraryHeaderSize + curveId * (valuesPerCurveTocItem * 2) /* bpc*/)\r\n    const x = this.__curveLibraryReader.loadFloat16()\r\n    const y = this.__curveLibraryReader.loadFloat16()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __seekCurveData method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @param {number} offsetInBytes - The offsetInBytes param.\r\n   * @private\r\n   */\r\n  __seekCurveData(curveId, offsetInBytes = 0) {\r\n    const addr = this.getCurveDataTexelCoords(curveId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 8 // RGBA16 pixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__curveLibrarySize\r\n    // console.log(\"__seekSurfaceData:\" + curveId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__curveLibraryReader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getCurveType method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveType(curveId) {\r\n    this.__seekCurveData(curveId)\r\n    const curveType = this.__curveLibraryReader.loadFloat16()\r\n    return curveType\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveTypeLabel(curveId) {\r\n    const curveType = this.getCurveType(curveId)\r\n    return getCurveTypeName(curveType)\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveDims(curveId) {\r\n    this.__curveLibraryReader.seek(geomLibraryHeaderSize + curveId * (valuesPerCurveTocItem * 2) /* bpc*/)\r\n\r\n    return {\r\n      addrX: this.__curveLibraryReader.loadFloat16(),\r\n      addrY: this.__curveLibraryReader.loadFloat16(),\r\n      curvature: this.__curveLibraryReader.loadFloat16(),\r\n      length: this.__curveLibraryReader.loadFloat16(),\r\n      flags: this.__curveLibraryReader.loadFloat16(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getCurveTypeLabel method.\r\n   * @param {any} curveId - The curveId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCurveData(curveId) {\r\n    const dims = this.getCurveDims(curveId)\r\n    const curveType = this.getCurveType(curveId)\r\n    const domain = new Vec2(this.__curveLibraryReader.loadFloat16(), this.__curveLibraryReader.loadFloat16())\r\n\r\n    switch (curveType) {\r\n      case CADCurveTypes.CURVE_TYPE_LINE: {\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_LINE',\r\n          domain,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_CIRCLE: {\r\n        const radius = this.__curveLibraryReader.loadFloat16()\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_CIRCLE',\r\n          domain,\r\n          radius,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_ELIPSE: {\r\n        const majorRadius = this.__curveLibraryReader.loadFloat16()\r\n        const minorRadius = this.__curveLibraryReader.loadFloat16()\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'SURFACE_TYPE_CYLINDER',\r\n          domain,\r\n          majorRadius,\r\n          minorRadius,\r\n        }\r\n        break\r\n      }\r\n      case CADCurveTypes.CURVE_TYPE_NURBS_CURVE: {\r\n        const degree = this.__curveLibraryReader.loadFloat16()\r\n        const numCPs = this.__curveLibraryReader.loadFloat16()\r\n        const numKnots = this.__curveLibraryReader.loadFloat16()\r\n        this.__curveLibraryReader.advance(4)\r\n\r\n        const controlPoints = []\r\n        for (let j = 0; j < numCPs; j++) {\r\n          const p = new Vec4(\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16(),\r\n            this.__curveLibraryReader.loadFloat16()\r\n          )\r\n          controlPoints.push(p)\r\n        }\r\n        const knots = []\r\n        for (let j = 0; j < numKnots; j++) {\r\n          knots.push(this.__curveLibraryReader.loadFloat16())\r\n        }\r\n        return {\r\n          curveId,\r\n          dims,\r\n          curveType: 'CURVE_TYPE_NURBS_CURVE',\r\n          domain,\r\n          degree,\r\n          numCPs,\r\n          controlPoints,\r\n          knots,\r\n        }\r\n      }\r\n      default:\r\n        console.warn('Invalid Curve Type:', curveType)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceDataTexelCoords method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceDataTexelCoords(surfaceId) {\r\n    this.__surfaceLibraryReader.seek(geomLibraryHeaderSize + surfaceId * (valuesPerSurfaceTocItem * 2) /* bpc*/)\r\n    const x = this.__surfaceLibraryReader.loadUFloat16()\r\n    const y = this.__surfaceLibraryReader.loadUFloat16()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __seekSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @param {number} offsetInBytes - The offsetInBytes param.\r\n   * @private\r\n   */\r\n  __seekSurfaceData(surfaceId, offsetInBytes = 0) {\r\n    const addr = this.getSurfaceDataTexelCoords(surfaceId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 8 // RGBA16 pixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__surfaceLibrarySize\r\n    // console.log(\"__seekSurfaceData:\" + surfaceId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__surfaceLibraryReader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceType method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceType(surfaceId) {\r\n    this.__seekSurfaceData(surfaceId)\r\n    const surfaceType = this.__surfaceLibraryReader.loadFloat16()\r\n    return surfaceType\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceTypeLabel method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceTypeLabel(surfaceId) {\r\n    const surfaceType = this.getSurfaceType(surfaceId)\r\n    return getSurfaceTypeName(surfaceType)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceDims method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceDims(surfaceId) {\r\n    this.__surfaceLibraryReader.seek(geomLibraryHeaderSize + surfaceId * (valuesPerSurfaceTocItem * 2) /* bpc*/)\r\n\r\n    const loadTrimSetId = () => {\r\n      if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n        // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n        const partA = this.__surfaceLibraryReader.loadFloat16()\r\n        const partB = this.__surfaceLibraryReader.loadFloat16()\r\n        return partA + (partB << 8)\r\n      } else {\r\n        return this.__surfaceLibraryReader.loadSInt32From2xFloat16()\r\n      }\r\n    }\r\n    return {\r\n      addrX: this.__surfaceLibraryReader.loadUFloat16(),\r\n      addrY: this.__surfaceLibraryReader.loadUFloat16(),\r\n      curvatureU: this.__surfaceLibraryReader.loadFloat16(),\r\n      curvatureV: this.__surfaceLibraryReader.loadFloat16(),\r\n      sizeU: this.__surfaceLibraryReader.loadFloat16(), // size U\r\n      sizeV: this.__surfaceLibraryReader.loadFloat16(), // size V\r\n      flags: this.__surfaceLibraryReader.loadFloat16(),\r\n      trimSetId: loadTrimSetId(), // trimSetId\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId, includeTrimSet = true) {\r\n    const dims = this.getSurfaceDims(surfaceId)\r\n\r\n    const surfaceType = this.getSurfaceType(surfaceId)\r\n    const readDomain = () => {\r\n      const domain = new Box2()\r\n      domain.p0.x = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p0.y = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p1.x = this.__surfaceLibraryReader.loadFloat16()\r\n      domain.p1.y = this.__surfaceLibraryReader.loadFloat16()\r\n      return domain\r\n    }\r\n    if (dims.trimSetId >= 0 && includeTrimSet) dims.trimSet = this.__trimSetLibrary.getTrimSetCurves(dims.trimSetId)\r\n\r\n    switch (surfaceType) {\r\n      case CADSurfaceTypes.SURFACE_TYPE_PLANE: {\r\n        const domain = readDomain()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_PLANE',\r\n          domain,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_FAN: {\r\n        const domain = readDomain()\r\n        const points = []\r\n        const numPoints = dims.curvatureU + 1\r\n        for (let j = 0; j < numPoints; j++) {\r\n          const p = new Vec2(this.__surfaceLibraryReader.loadFloat16(), this.__surfaceLibraryReader.loadFloat16())\r\n          points.push(p)\r\n        }\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_FAN',\r\n          domain,\r\n          points,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_CONE: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        const semiAngle = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_CONE',\r\n          domain,\r\n          radius,\r\n          semiAngle,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_CYLINDER: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_CYLINDER',\r\n          domain,\r\n          radius,\r\n        }\r\n        break\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_SPHERE: {\r\n        const domain = readDomain()\r\n        const radius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_SPHERE',\r\n          domain,\r\n          radius,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_TORUS: {\r\n        const domain = readDomain()\r\n        const majorRadius = this.__surfaceLibraryReader.loadFloat16()\r\n        const minorRadius = this.__surfaceLibraryReader.loadFloat16()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_TORUS',\r\n          domain,\r\n          majorRadius,\r\n          minorRadius,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_LINEAR_EXTRUSION: {\r\n        const domain = readDomain()\r\n\r\n        let curveIndex\r\n        // if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n        //   // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n        //   const partA = this.__surfaceLibraryReader.loadFloat16()\r\n        //   const partB = this.__surfaceLibraryReader.loadFloat16()\r\n        //   curveIndex = partA + (partB << 8)\r\n        // } else {\r\n        // curveIndex = this.__surfaceLibraryReader.loadUInt32From2xUFloat16()\r\n\r\n        const partA = this.__surfaceLibraryReader.loadUFloat16()\r\n        const partB = this.__surfaceLibraryReader.loadUFloat16()\r\n        curveIndex = partA + partB * 2048\r\n        // }\r\n\r\n        const curveData = this.getCurveData(curveIndex)\r\n\r\n        const curve_tr = new Vec3(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n        const curve_ori = new Quat(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_LINEAR_EXTRUSION',\r\n          domain,\r\n          curve_tr,\r\n          curve_ori,\r\n          curveData,\r\n          partA,\r\n          partB,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN:\r\n      case CADSurfaceTypes.SURFACE_TYPE_REVOLUTION: {\r\n        const domain = readDomain()\r\n\r\n        let curveIndex\r\n        if (this.cadDataVersion.compare([0, 0, 27]) < 0) {\r\n          // Note: -1 is a valid value for trimset id, so can't use an unsigned float value.\r\n          const partA = this.__surfaceLibraryReader.loadFloat16()\r\n          const partB = this.__surfaceLibraryReader.loadFloat16()\r\n          curveIndex = partA + (partB << 8)\r\n        } else {\r\n          curveIndex = this.__surfaceLibraryReader.loadUInt32From2xUFloat16()\r\n        }\r\n\r\n        const curve_tr = new Vec3(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n        const curve_ori = new Quat(\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16(),\r\n          this.__surfaceLibraryReader.loadFloat16()\r\n        )\r\n\r\n        const curveData = this.getCurveData(curveIndex)\r\n\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_REVOLUTION',\r\n          domain,\r\n          curve_tr,\r\n          curve_ori,\r\n          curveData,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE: {\r\n        const domain = readDomain()\r\n        const degreeU = this.__surfaceLibraryReader.loadFloat16()\r\n        const degreeV = this.__surfaceLibraryReader.loadFloat16()\r\n        const numCPsU = this.__surfaceLibraryReader.loadFloat16()\r\n\r\n        const numCPsV = this.__surfaceLibraryReader.loadFloat16()\r\n        const numKnotsU = this.__surfaceLibraryReader.loadFloat16()\r\n        const numKnotsV = this.__surfaceLibraryReader.loadFloat16()\r\n        const flags = this.__surfaceLibraryReader.loadFloat16()\r\n        const periodicU = (flags & SURFACE_FLAG_PERIODIC_U) != 0\r\n        const periodicV = (flags & SURFACE_FLAG_PERIODIC_V) != 0\r\n        // this.__surfaceLibraryReader.advance(2);\r\n\r\n        const controlPoints = []\r\n        for (let j = 0; j < numCPsU * numCPsV; j++) {\r\n          const p = new Vec4(\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16(),\r\n            this.__surfaceLibraryReader.loadFloat16()\r\n          )\r\n          controlPoints.push(p)\r\n        }\r\n        const knotsU = []\r\n        for (let j = 0; j < numKnotsU; j++) {\r\n          knotsU.push(this.__surfaceLibraryReader.loadFloat16())\r\n        }\r\n        const knotsV = []\r\n        for (let j = 0; j < numKnotsV; j++) {\r\n          knotsV.push(this.__surfaceLibraryReader.loadFloat16())\r\n        }\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_NURBS_SURFACE',\r\n          domain,\r\n          periodicU,\r\n          periodicV,\r\n          degreeU,\r\n          degreeV,\r\n          numCPsU,\r\n          numCPsV,\r\n          controlPoints,\r\n          knotsU,\r\n          knotsV,\r\n        }\r\n      }\r\n      case CADSurfaceTypes.SURFACE_TYPE_POLY_PLANE: {\r\n        const p0 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p1 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p2 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        const p3 = this.__surfaceLibraryReader.loadFloat16Vec2()\r\n        return {\r\n          surfaceId,\r\n          dims,\r\n          surfaceType: 'SURFACE_TYPE_POLY_PLANE',\r\n          points: [p0, p1, p2, p3],\r\n        }\r\n      }\r\n      default: {\r\n        const surfaceType = this.getSurfaceType(surfaceId)\r\n        console.warn('Invalid Surface Type:', surfaceType, ' surfaceId:', surfaceId)\r\n      }\r\n    }\r\n  }\r\n\r\n  /** ************************************************************\r\n   *  NURBS Utils\r\n   **************************************************************/\r\n\r\n  /**\r\n   * Finds knot vector span.\r\n   * @param {number} u - Parametric value.\r\n   * @param {number} degree - Degree.\r\n   * @param {array} knots - Knot vector.\r\n   * @param {array} knotValues - The knotValues param.\r\n   * @return {number} - Returns the span.\r\n   */\r\n  findSpan(u, degree, knots, knotValues) {\r\n    if (this.cadDataVersion.compare([0, 0, 6]) >= 0) {\r\n      this.cadDataVersion\r\n      // EXPORT_KNOTS_AS_DELTAS\r\n\r\n      let nextKnot = knots[0]\r\n      let knot = nextKnot\r\n\r\n      let span = 1\r\n      const n = knots.length - degree - 1\r\n      // Linear Search...\r\n      for (; span < n; span++) {\r\n        nextKnot += knots[span]\r\n        if (span > degree && u < nextKnot) {\r\n          span--\r\n          break\r\n        }\r\n        knot = nextKnot\r\n      }\r\n      if (span == n) {\r\n        span--\r\n      }\r\n\r\n      // Calculate knot values\r\n      knotValues[degree] = knot\r\n      let left = knot\r\n      let right = knot\r\n      for (let i = 1; i <= degree; i++) {\r\n        left -= knots[span - i + 1]\r\n        right += knots[span + i]\r\n        knotValues[degree - i] = left\r\n        knotValues[degree + i] = right\r\n      }\r\n      return span\r\n    } else {\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate basis functions.\r\n   * See The NURBS Book, page 70, algorithm A2.2\r\n   * span : span in which u lies\r\n   * @param {any} u - Parametric point.\r\n   * @param {any} degree - Degree.\r\n   * @param {any} knots - Knot vector.\r\n   * @param {any} bvD - The bvD param.\r\n   * @return {any} - Returns array[degree+1] with basis functions values.\r\n   */\r\n  calcBasisValues(u, degree, knots, bvD) {\r\n    const left = []\r\n    const right = []\r\n    // Basis[0] is always 1.0\r\n    const basisValues = [1.0]\r\n    bvD[0] = 0.0\r\n\r\n    for (let j = 1; j <= degree; ++j) {\r\n      left[j] = u - knots[degree + 1 - j]\r\n      right[j] = knots[degree + j] - u\r\n\r\n      let saved = 0.0\r\n      for (let r = 0; r < j; ++r) {\r\n        const rv = right[r + 1]\r\n        const lv = left[j - r]\r\n        const temp = basisValues[r] / (rv + lv)\r\n        basisValues[r] = saved + rv * temp\r\n        saved = lv * temp\r\n      }\r\n\r\n      basisValues[j] = saved\r\n\r\n      // Calculate N' if on second to last iteration\r\n      if (j == degree - 1 || degree == 1) {\r\n        saved = 0.0\r\n        // Loop through all basis values\r\n        for (let r = 0; r < degree; r++) {\r\n          // Calculate a temp variable\r\n          const jr_z = r + 1\r\n          // Calculate right side\r\n          const kp_0 = knots[jr_z + degree]\r\n          const kp_1 = knots[jr_z]\r\n          const tmp = (degree * basisValues[r]) / (kp_0 - kp_1)\r\n          // Calculate derivative value\r\n          bvD[r] = saved - tmp\r\n          // Swap right side to left\r\n          saved = tmp\r\n        }\r\n        // Save the last der-basis\r\n        bvD[degree] = saved\r\n      }\r\n    }\r\n\r\n    return basisValues\r\n  }\r\n\r\n  /**\r\n   * Calculate basis function derivativess.\r\n   * See The NURBS Book, page 70, algorithm A2.2\r\n   * span : span in which u lies\r\n   * https://github.com/pradeep-pyro/tinynurbs/blob/master/include/tinynurbs/core/basis.h#L163\r\n   * @param {any} u - Parametric point.\r\n   * @param {any} degree - Degree.\r\n   * @param {any} knots - Knot vector.\r\n   * @return {any} - Returns array[degree+1] with basis function derivative values.\r\n   */\r\n  calcBasisDerivatives(u, degree, knots) {\r\n    const left = []\r\n    const right = []\r\n    let saved = 0.0\r\n    let temp = 0.0\r\n\r\n    const ndu = []\r\n    for (let j = 0; j <= degree; j++) {\r\n      ndu.push([])\r\n    }\r\n    ndu[0][0] = 1.0\r\n\r\n    for (let j = 1; j <= degree; j++) {\r\n      left[j] = u - knots[degree + 1 - j]\r\n      right[j] = knots[degree + j] - u\r\n      saved = 0.0\r\n\r\n      for (let r = 0; r < j; r++) {\r\n        const rv = right[r + 1]\r\n        const lv = left[j - r]\r\n        const rvlv = rv + lv\r\n\r\n        // Lower triangle\r\n        ndu[j][r] = rvlv\r\n        temp = ndu[r][j - 1] / rvlv\r\n        // Upper triangle\r\n        ndu[r][j] = saved + rv * temp\r\n        saved = lv * temp\r\n      }\r\n\r\n      ndu[j][j] = saved\r\n    }\r\n\r\n    const ders = [[], []]\r\n    for (let j = 0; j <= degree; j++) {\r\n      ders[0][j] = ndu[j][degree]\r\n    }\r\n\r\n    const a = [[], []]\r\n    for (let j = 0; j <= degree; j++) {\r\n      a[0].push(0)\r\n      a[1].push(0)\r\n    }\r\n\r\n    for (let r = 0; r <= degree; r++) {\r\n      let s1 = 0\r\n      let s2 = 1\r\n      a[0][0] = 1.0\r\n\r\n      // for (int k = 1; k <= 1; k++)\r\n      {\r\n        const k = 1\r\n        let d = 0.0\r\n        const rk = r - k\r\n        const pk = degree - k\r\n        let j1 = 0\r\n        let j2 = 0\r\n\r\n        if (r >= k) {\r\n          a[s2][0] = a[s1][0] / ndu[pk + 1][rk]\r\n          d = a[s2][0] * ndu[rk][pk]\r\n        }\r\n\r\n        if (rk >= -1) {\r\n          j1 = 1\r\n        } else {\r\n          j1 = -rk\r\n        }\r\n\r\n        if (r - 1 <= pk) {\r\n          j2 = k - 1\r\n        } else {\r\n          j2 = degree - r\r\n        }\r\n\r\n        for (let j = j1; j <= j2; j++) {\r\n          a[s2][j] = (a[s1][j] - a[s1][j - 1]) / ndu[pk + 1][rk + j]\r\n          d += a[s2][j] * ndu[rk + j][pk]\r\n        }\r\n\r\n        if (r <= pk) {\r\n          a[s2][k] = -a[s1][k - 1] / ndu[pk + 1][r]\r\n          d += a[s2][k] * ndu[r][pk]\r\n        }\r\n\r\n        ders[k][r] = d\r\n\r\n        const temp = s1\r\n        s1 = s2\r\n        s2 = temp\r\n      }\r\n    }\r\n\r\n    let fac = degree\r\n    // for (int k = 1; k <= 1; k++)\r\n    {\r\n      const k = 1\r\n      for (let j = 0; j <= degree; j++) {\r\n        ders[k][j] = ders[k][j] * fac\r\n      }\r\n      fac *= degree - k\r\n    }\r\n\r\n    return ders\r\n  }\r\n\r\n  // http://www.nar-associates.com/nurbs/programs/dbasisu.c\r\n  /* Subroutine to generate B-spline basis functions and their derivatives for uniform open knot vectors. */\r\n\r\n  /**\r\n   * Calculate rational B-Spline surface point.\r\n   * See The NURBS Book, page 134, algorithm A4.3\r\n   *\r\n   * p1, p2 : degrees of B-Spline surface\r\n   * U1, U2 : knot vectors\r\n   * P      : control points (x, y, z, w)\r\n   * u, v   : parametric values\r\n   *\r\n   * returns point for given (u, v)\r\n   *\r\n   * @param {any} surfaceData - The surfaceData param.\r\n   * @param {any} params - The params param.\r\n   * @return {any} - The return value.\r\n   */\r\n  calcSurfacePoint(surfaceData, params) {\r\n    const d = surfaceData\r\n\r\n    const u = Math.remap(params[0], 0, 1, d.domain.p0.x, d.domain.p1.x)\r\n    const v = Math.remap(params[1], 0, 1, d.domain.p0.y, d.domain.p1.y)\r\n\r\n    const knotValuesU = []\r\n    const spanU = this.findSpan(u, d.degreeU, d.knotsU, knotValuesU)\r\n    const knotValuesV = []\r\n    const spanV = this.findSpan(v, d.degreeV, d.knotsV, knotValuesV)\r\n\r\n    const bvdsU = []\r\n    const basisValuesU = this.calcBasisValues(u, d.degreeU, knotValuesU, bvdsU)\r\n    const bvdsV = []\r\n    const basisValuesV = this.calcBasisValues(v, d.degreeV, knotValuesV, bvdsV)\r\n\r\n    // const dersU = this.calcBasisDerivatives(u, d.degreeU, knotValuesU)\r\n    // const dersV = this.calcBasisDerivatives(v, d.degreeV, knotValuesV)\r\n    // const basisValuesU = dersU[0]\r\n    // const basisValuesV = dersV[0]\r\n\r\n    // console.log(\"knotValuesU:\", knotValuesU)\r\n    // console.log(\"basisValuesU:\", basisValuesU)\r\n    // console.log(\"knotValuesV:\", knotValuesV)\r\n    // console.log(\"basisValuesV:\", basisValuesV)\r\n    // }\r\n    // else {\r\n\r\n    // }\r\n\r\n    const pos = new Vec3(0, 0, 0)\r\n    const tangentU = new Vec3(0, 0, 0)\r\n    const tangentV = new Vec3(0, 0, 0)\r\n    let w = 0.0\r\n    const cvU0 = spanU - d.degreeU\r\n    const cvV0 = spanV - d.degreeV\r\n    for (let y = 0; y <= d.degreeV; ++y) {\r\n      // let vindex = (spanV - d.degreeV + y) % d.numCPsV;\r\n      const vindex = cvV0 + y\r\n      for (let x = 0; x <= d.degreeU; ++x) {\r\n        // const uindex = (spanU - d.degreeU + x) % d.numCPsU;\r\n        const uindex = cvU0 + x\r\n\r\n        const pt = d.controlPoints[uindex + vindex * d.numCPsU]\r\n        const weight = pt.t\r\n\r\n        const bvU = basisValuesU[x]\r\n        const bvV = basisValuesV[y]\r\n        // const bvU = dersU[0][x]\r\n        // const bvV = dersV[0][y]\r\n\r\n        const bvw = weight * bvU * bvV\r\n        pos.addInPlace(pt.scale(bvw))\r\n        w += bvw\r\n\r\n        const bvdU = bvdsU[x]\r\n        const bvdV = bvdsV[y]\r\n        // const bvdU = dersU[1][x]\r\n        // const bvdV = dersV[1][y]\r\n        tangentU.addInPlace(pt.scale(bvdU * bvV))\r\n        tangentV.addInPlace(pt.scale(bvU * bvdV))\r\n      }\r\n    }\r\n    if (w == 0 || isNaN(w) || !isFinite(w)) console.warn('Unable to evaluate surface')\r\n\r\n    // console.log('spanV:', spanV, ' v:', v, ' w:', w)\r\n    pos.scaleInPlace(1 / w)\r\n\r\n    ///////////////////////////////////////////////////////\r\n    // Calculate normal.\r\n    const spanRangeU = knotValuesU[d.degreeU + 1] - knotValuesU[d.degreeU]\r\n    const spanRangeV = knotValuesV[d.degreeV + 1] - knotValuesV[d.degreeV]\r\n    const eqKnotRangeU = (d.domain.p1.x - d.domain.p0.x) / d.knotsU.length\r\n    const eqKnotRangeV = (d.domain.p1.y - d.domain.p0.y) / d.knotsV.length\r\n\r\n    // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n    // Note: for COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.\r\n    // this tollerance needed to be quite high. (bigger than 0.005)\r\n\r\n    if (spanRangeU / eqKnotRangeU < 0.01) {\r\n      // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n      // we have span segment which has close to zero delta, and\r\n      // so the normals are broken. We want to advace along the\r\n      // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n      // length of the span rather than when we have a pinched corner,\r\n      // where we move along the toher direction.\r\n      // console.log(v, 'spanRangeU:', spanRangeU, ' eqKnotRangeU:', eqKnotRangeU, spanRangeU / eqKnotRangeU)\r\n\r\n      let cvU = cvU0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvU = cvU0 + d.degreeU - 2\r\n      } else {\r\n        // if the broken normal is at the start of the U range, then\r\n        // we will grab the next in the row.\r\n        cvU = cvU0 + 1\r\n      }\r\n\r\n      const spanLerpV = (u - knotValuesV[d.degreeV]) / spanRangeV\r\n      const cvV = cvV0 + Math.floor(spanLerpV * d.degreeV)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + 1 + cvV * d.numCPsU].toVec3()\r\n\r\n      tangentU.setFromOther(pt1.subtract(pt0))\r\n    } else if (tangentU.length() < 0.05) {\r\n      // The derivative in the V direction is zero,\r\n      // so we calculate the linear derivative for the next control points along.\r\n\r\n      let cvV\r\n      if (spanV > d.degreeV) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvV = cvV0 + d.degreeV - 2\r\n      } else {\r\n        // if the broken normal is at the start of the V range, then\r\n        // we will grab the next in the row.\r\n        cvV = cvV0 + 1\r\n      }\r\n\r\n      const spanLerpU = (u - knotValuesU[d.degreeU]) / spanRangeU\r\n      const cvU = cvU0 + Math.floor(spanLerpU * d.degreeU)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + 1 + cvV * d.numCPsU].toVec3()\r\n\r\n      tangentU.setFromOther(pt1.subtract(pt0))\r\n      // tangentU.setFromOther(pt0.subtract(pt1));\r\n    }\r\n\r\n    if (spanRangeV / eqKnotRangeV < 0.01) {\r\n      // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n      // we have span segment which has close to zero delta, and\r\n      // so the normals are broken. We want to advace along the\r\n      // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n      // length of the span rather than when we have a pinched corner,\r\n      // where we move along the toher direction.\r\n      // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n      let cvV = cvV0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvV = cvV0 + d.degreeV - 2\r\n      } else {\r\n        // if the broken normal is at the start of the V range, then\r\n        // we will grab the next in the row.\r\n        cvV = cvV0 + 1\r\n      }\r\n\r\n      const spanLerpU = (u - knotValuesU[d.degreeU]) / spanRangeU\r\n      const cvU = cvU0 + Math.floor(spanLerpU * d.degreeU)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + (cvV + 1) * d.numCPsU].toVec3()\r\n\r\n      tangentV.setFromOther(pt1.subtract(pt0))\r\n    } else if (tangentV.length() < 0.05) {\r\n      // The derivative in the V direction is zero,\r\n      // so we calculate the linear derivative for the next control points along.\r\n\r\n      let cvU = cvU0\r\n      if (v > d.domain.p1.y - 0.0001) {\r\n        // If at the end then we grab the end of the pevious row.\r\n        cvU = cvU0 + d.degreeU - 2\r\n      } else {\r\n        // if the broken normal is at the start of the U range, then\r\n        // we will grab the next in the row.\r\n        cvU = cvU0 + 1\r\n      }\r\n\r\n      const spanLerpV = (u - knotValuesV[d.degreeV]) / spanRangeV\r\n      const cvV = cvV0 + Math.floor(spanLerpV * d.degreeV)\r\n\r\n      const pt0 = d.controlPoints[cvU + cvV * d.numCPsU].toVec3()\r\n      const pt1 = d.controlPoints[cvU + (cvV + 1) * d.numCPsU].toVec3()\r\n\r\n      tangentV.setFromOther(pt1.subtract(pt0))\r\n    }\r\n\r\n    const normal = tangentU.cross(tangentV).normalize()\r\n\r\n    return {\r\n      pos,\r\n      normal,\r\n    }\r\n  }\r\n\r\n  // https://github.com/arennuit/libnurbs/blob/3f7daae483a615a13d21e5c674f412ccb8587b6e/nurbs%2B%2B-3.0.11/nurbs/nurbs.cpp\r\n\r\n  /**\r\n   * The generatePolygonSurface method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   */\r\n  generatePolygonSurface(surfaceId, lod = 0) {\r\n    if (this.__meshes[surfaceId]) {\r\n      // const color = this.__meshes[surfaceId].mat.getParameter('BaseColor').getValue();\r\n      // color.r = color.r + 0.2;\r\n      // console.log(\"surface Instanced:\" + surfaceId + \":\" + color.r);\r\n      return this.__meshes[surfaceId]\r\n    }\r\n\r\n    if (this.getSurfaceType(surfaceId) != CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE) {\r\n      return\r\n    }\r\n    const surfaceData = this.getSurfaceData(surfaceId)\r\n    if (!surfaceData) {\r\n      return\r\n    }\r\n    const M = surfaceData.numCPsU * Math.pow(2, lod)\r\n    const N = surfaceData.numCPsV * Math.pow(2, lod)\r\n\r\n    console.log('generatePolygonSurface:' + surfaceId + ' M:' + M + ' N:' + N)\r\n\r\n    const quad = new Plane(1.0, 1.0, M, N)\r\n    const normalsGeom = new Lines()\r\n    normalsGeom.setNumVertices((M + 1) * (N + 1) * 2)\r\n    normalsGeom.setNumSegments((M + 1) * (N + 1))\r\n    const normalsGeom_PosAttr = normalsGeom.getVertexAttribute('positions')\r\n    const normalsLength = 0.2\r\n\r\n    let voff = 0\r\n    const positions = quad.getVertexAttribute('positions')\r\n    const normals = quad.getVertexAttribute('normals')\r\n    for (let j = 0; j <= N; j++) {\r\n      const v = j / N\r\n      for (let i = 0; i <= M; i++) {\r\n        const u = i / M\r\n        const pt = this.calcSurfacePoint(surfaceData, [u, v])\r\n\r\n        positions.getValueRef(voff).set(pt.pos.x, pt.pos.y, pt.pos.z)\r\n        normals.getValueRef(voff).set(pt.normal.x, pt.normal.y, pt.normal.z)\r\n\r\n        normalsGeom.setSegmentVertexIndices(voff, voff * 2, voff * 2 + 1)\r\n        // if (v == 0.0)\r\n        {\r\n          normalsGeom_PosAttr.getValueRef(voff * 2).set(pt.pos.x, pt.pos.y, pt.pos.z)\r\n          normalsGeom_PosAttr\r\n            .getValueRef(voff * 2 + 1)\r\n            .set(\r\n              pt.pos.x + pt.normal.x * normalsLength,\r\n              pt.pos.y + pt.normal.y * normalsLength,\r\n              pt.pos.z + pt.normal.z * normalsLength\r\n            )\r\n        }\r\n\r\n        voff++\r\n      }\r\n    }\r\n\r\n    // quad.computeVertexNormals();\r\n\r\n    const material = new Material('myMat', 'SimpleSurfaceShader')\r\n    material.getParameter('BaseColor').setValue(Color.random(0.15))\r\n    quad.material = material\r\n\r\n    const normalsGeomMaterial = new Material('myMat', 'FlatSurfaceShader')\r\n    normalsGeomMaterial.getParameter('BaseColor').setValue(new Color(1, 0, 0))\r\n    normalsGeom.material = normalsGeomMaterial\r\n\r\n    this.__meshes[surfaceId] = quad\r\n    return { mesh: quad, normals: normalsGeom }\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  generateHullGeometry(surfaceId) {\r\n    if (this.__hulls[surfaceId]) {\r\n      // const color = this.__hulls[surfaceId].mat.getParameter('BaseColor').getValue();\r\n      // color.r = color.r + 0.2;\r\n      // console.log(\"surface Instanced:\" + surfaceId + \":\" + color.r);\r\n      return this.__hulls[surfaceId]\r\n    }\r\n\r\n    if (this.getSurfaceType(surfaceId) != CADSurfaceTypes.SURFACE_TYPE_NURBS_SURFACE) {\r\n      return\r\n    }\r\n    const surfaceData = this.getSurfaceData(surfaceId)\r\n    if (!surfaceData) {\r\n      return\r\n    }\r\n    console.log(\r\n      'generateHullGeometry:' + surfaceId + ' numCPsU:' + surfaceData.numCPsU + ' numCPsV:' + surfaceData.numCPsV\r\n    )\r\n    const hull = new Hull(surfaceData.numCPsU, surfaceData.numCPsV)\r\n\r\n    const positions = hull.getVertexAttribute('positions')\r\n    let voff = 0\r\n    for (let j = 0; j < surfaceData.numCPsV; j++) {\r\n      for (let i = 0; i < surfaceData.numCPsU; i++) {\r\n        const index = i + j * surfaceData.numCPsU\r\n        const pt = surfaceData.controlPoints[index]\r\n        positions.getValueRef(voff).set(pt.x, pt.y, pt.z)\r\n        voff++\r\n      }\r\n    }\r\n\r\n    const material = new Material('hullMaterial', 'FlatSurfaceShader')\r\n    material.getParameter('BaseColor').setValue(Color.random(-0.25))\r\n    hull.material = material\r\n\r\n    this.__hulls[surfaceId] = hull\r\n    return hull\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugSurfaces method.\r\n   */\r\n  dumpDebugSurfaces() {\r\n    const surfacesData = []\r\n    for (let i = 0; i < this.__numSurfaces; i++) {\r\n      try {\r\n        surfacesData.push(this.getSurfaceData(i, false))\r\n      } catch (e) {\r\n        console.warn('Error accessing Surface: ', i, e)\r\n        surfacesData.push({})\r\n      }\r\n    }\r\n    return surfacesData\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugCurves method.\r\n   */\r\n  dumpDebugCurves() {\r\n    const curvesData = []\r\n    for (let i = 0; i < this.__numSurfaces; i++) {\r\n      try {\r\n        curvesData.push(this.getCurveData(i))\r\n      } catch (e) {\r\n        console.warn('Error accessing Curve: ', i, e)\r\n        curvesData.push({})\r\n      }\r\n    }\r\n    return curvesData\r\n  }\r\n\r\n  /**\r\n   * The logFormfactors method.\r\n   */\r\n  logFormfactors() {\r\n    for (const ff in this.__formFactors) console.log(ff + ':' + this.__formFactors[ff])\r\n  }\r\n}\r\n\r\nexport { CADSurfaceLibrary }\r\n","import { SystemDesc } from '@zeainc/zea-engine'\r\n\r\nconst sizeOfBBox = 24\r\n\r\n/** Class representing a CAD trim set library.\r\n * @ignore\r\n */\r\nclass CADTrimSetLibrary {\r\n  /**\r\n   * Create a CAD trim set library.\r\n   */\r\n  constructor() {\r\n    this.__reader = undefined\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffer method.\r\n   * @param {any} trimSetReader - The trimSetReader param.\r\n   * @param {number} version - The version param.\r\n   */\r\n  setBinaryBuffer(trimSetReader, version) {\r\n    this.__reader = trimSetReader\r\n\r\n    this.__numTrimSets = this.__reader.loadUInt32()\r\n    if (version.compare([0, 0, 0]) > 0) {\r\n      this.__totalTrimSurfaceArea = this.__reader.loadFloat32()\r\n    } else {\r\n      this.__totalTrimSurfaceArea = 0.0\r\n      for (let i = 0; i < this.__numTrimSets; i++) {\r\n        const dims = this.getTrimSetDim(i)\r\n        const area = dims[0] * dims[1]\r\n        this.__totalTrimSurfaceArea += area\r\n      }\r\n    }\r\n\r\n    const sideLength = Math.sqrt(this.__totalTrimSurfaceArea)\r\n\r\n    const maxTexSize = SystemDesc.gpuDesc.maxTextureSize\r\n    // I'm not sure whats going on here.\r\n    // The xlarge size should be at most maxTexSize >> 1 (e.g. 50% wasted space.)\r\n    const xlargeTexSize = maxTexSize >> 1\r\n    const largeTexSize = maxTexSize >> 2\r\n    const medTexSize = maxTexSize >> 3\r\n    const smallTexSize = maxTexSize >> 4\r\n\r\n    // Note: on big scenes like the Spyder, the texels often fail\r\n    // to pack when tex size is too small, causing artifacts in trimming.\r\n    // Therefore the biggest texture size is half the maximum.\r\n    this.__texelSizes = [\r\n      sideLength / smallTexSize,\r\n      sideLength / medTexSize,\r\n      sideLength / largeTexSize,\r\n      sideLength / xlargeTexSize,\r\n    ]\r\n    // console.log(\"sideLength:\", sideLength, this.__texelSizes);\r\n\r\n    ////////////////////////////\r\n    // Debugging.\r\n    // for (let i = 0; i < this.__numTrimSets; i++) {\r\n    //   console.log({\r\n    //     dims: this.getTrimSetDim(i),\r\n    //     curves: this.getTrimSetCurves(i)\r\n    //   })\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getBinaryBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBinaryBuffer() {\r\n    if (!this.__reader) return null\r\n    return this.__reader.data\r\n  }\r\n\r\n  /**\r\n   * The getNumTrimSets method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumTrimSets() {\r\n    return this.__numTrimSets\r\n  }\r\n\r\n  /**\r\n   * The getTrimArea method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimArea() {\r\n    return this.__totalTrimSurfaceArea\r\n  }\r\n\r\n  /**\r\n   * The getTexelSize method.\r\n   * @param {any} lod - The lod param.\r\n   * @param {any} numAssets - The numAssets param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTexelSize(lod, numAssets) {\r\n    // return 5\r\n    // For scenes with many assets we drop down the texel detail\r\n    // so they load without destroying the GPU.\r\n    let lodId\r\n    if (numAssets < 2) lodId = 3\r\n    else if (numAssets < 6) lodId = 2\r\n    else {\r\n      lodId = 1 // LOD 0 is just a mess.\r\n    }\r\n    // lodId = 1\r\n\r\n    // return 4\r\n    return this.__texelSizes[lodId]\r\n    // return this.__texelSizes[Math.clamp(lod, 0, this.__texelSizes.length-1)];\r\n  }\r\n\r\n  /**\r\n   * The getTrimSetDim method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimSetDim(trimSetId) {\r\n    this.__reader.seek(8 + trimSetId * 4)\r\n    this.__reader.seek(this.__reader.loadUInt32())\r\n\r\n    const size_x = this.__reader.loadFloat32() // size in scene units\r\n    const size_y = this.__reader.loadFloat32() // size in scene units\r\n    return [size_x, size_y]\r\n  }\r\n\r\n  /**\r\n   * The getTrimSetCurves method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getTrimSetCurves(trimSetId) {\r\n    this.__reader.seek(8 + trimSetId * 4)\r\n    this.__reader.seek(this.__reader.loadUInt32())\r\n\r\n    const size_x = this.__reader.loadFloat32() // size in scene units\r\n    const size_y = this.__reader.loadFloat32() // size in scene units\r\n    const numHoles = this.__reader.loadUInt32()\r\n    const numPermiterCurves = this.__reader.loadUInt32()\r\n    const loadCurveRef = () => {\r\n      return {\r\n        id: this.__reader.loadFloat32(),\r\n        xfo_tr: [this.__reader.loadFloat32(), this.__reader.loadFloat32()],\r\n        xfo_rot: [\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n          this.__reader.loadFloat32(),\r\n        ],\r\n        flags: this.__reader.loadFloat32(),\r\n      }\r\n    }\r\n    const perimeter = []\r\n    for (let i = 0; i < numPermiterCurves; i++) {\r\n      perimeter.push(loadCurveRef())\r\n    }\r\n    const holes = []\r\n    for (let i = 0; i < numHoles; i++) {\r\n      const hole = []\r\n      const numHoleCurves = this.__reader.loadUInt32()\r\n      for (let i = 0; i < numHoleCurves; i++) {\r\n        hole.push(loadCurveRef())\r\n      }\r\n      holes.push(hole)\r\n    }\r\n    return {\r\n      size: [size_x, size_y],\r\n      perimeter,\r\n      holes,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The dumpDebugTrimSets method.\r\n   */\r\n  dumpDebugTrimSets() {\r\n    const trimSetsData = []\r\n    for (let i = 0; i < this.__numTrimSets; i++) {\r\n      try {\r\n        trimSetsData.push({\r\n          dims: this.getTrimSetDim(i),\r\n          curves: this.getTrimSetCurves(i),\r\n        })\r\n      } catch (e) {\r\n        console.warn('Error accessing TrimSet: ', i, e)\r\n        trimSetsData.push({})\r\n      }\r\n    }\r\n    return trimSetsData\r\n  }\r\n}\r\n\r\nexport { CADTrimSetLibrary }\r\n","import { Box3, Xfo, BinReader } from '@zeainc/zea-engine'\r\nconst bytesPerValue = 4 // 32 bit floats\r\n\r\n/** Class representing a CAD body library.\r\n * @ignore\r\n */\r\nclass CADBodyLibrary {\r\n  /**\r\n   * Create a CAD body library.\r\n   * @param {any} buffer - The buffer value.\r\n   */\r\n  constructor(buffer) {\r\n    if (buffer != undefined) {\r\n      this.setBinaryBuffer(buffer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setBinaryBuffers method.\r\n   * @param {any} tocBuffer - The tocBuffer param.\r\n   * @param {any} buffer - The buffer param.\r\n   */\r\n  setBinaryBuffers(tocBuffer, buffer) {\r\n    this.__buffer = buffer\r\n    this.__reader = new BinReader(this.__buffer)\r\n    this.__size = Math.sqrt(buffer.byteLength / (4 * bytesPerValue)) // RGBA32 pixels\r\n\r\n    this.__toc = tocBuffer // new Uint32Array(tocBuffer);\r\n    this.__tocReader = new BinReader(tocBuffer)\r\n    this.__numBodies = this.__tocReader.loadUInt32()\r\n\r\n    // for (let i = 0; i < this.__numBodies; i++) {\r\n    //     // console.log(JSON.stringify(this.getBodyDescData(i)));\r\n    //     console.log(this.getBodyDescData(i));\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The getToc method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getToc() {\r\n    return this.__toc\r\n  }\r\n\r\n  /**\r\n   * The getBinaryBuffer method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBinaryBuffer() {\r\n    return this.__buffer\r\n  }\r\n\r\n  /**\r\n   * The getNumBodies method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumBodies() {\r\n    return this.__numBodies\r\n  }\r\n\r\n  /**\r\n   * The getBodyDataTexelCoords method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDataTexelCoords(bodyDescId) {\r\n    this.__tocReader.seek(4 + bodyDescId * (3 * 4))\r\n    const x = this.__tocReader.loadUInt32()\r\n    const y = this.__tocReader.loadUInt32()\r\n    return {\r\n      x,\r\n      y,\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  __seekBodyData(bodyDescId, offsetInBytes = 0) {\r\n    const addr = this.getBodyDataTexelCoords(bodyDescId)\r\n    // X, Y in pixels.\r\n\r\n    const bytesPerPixel = 16 // RGBA32 pixels == 16 bytes perpixel\r\n    const byteOffset = addr.x * bytesPerPixel + addr.y * bytesPerPixel * this.__size\r\n    // console.log(\"__seekSurfaceData:\" + bodyDescId + \" byteOffset:\" + (byteOffset +offset) + \" pixel:\" + ((byteOffset +offset)/8) + \" x:\" + addr.x + \" y:\" + addr.y);\r\n    this.__reader.seek(byteOffset + offsetInBytes)\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfacesForBody method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfacesForBody(bodyDescId) {\r\n    this.__seekBodyData(bodyDescId, 6 /* bbox*/ * bytesPerValue)\r\n    const numBodySurfaces = this.__reader.loadFloat32()\r\n    return numBodySurfaces\r\n  }\r\n\r\n  /**\r\n   * The getBodyBBox method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyBBox(bodyDescId) {\r\n    this.__seekBodyData(bodyDescId)\r\n    const bbox = new Box3()\r\n    bbox.p0 = this.__reader.loadFloat32Vec3()\r\n    bbox.p1 = this.__reader.loadFloat32Vec3()\r\n    return bbox\r\n  }\r\n\r\n  /**\r\n   * The getBodyDescData method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDescData(bodyDescId, includeXfosAndColors = true) {\r\n    this.__seekBodyData(bodyDescId)\r\n    // console.log(this.__reader.pos() / 8);\r\n\r\n    const bbox = new Box3()\r\n    bbox.p0 = this.__reader.loadFloat32Vec3()\r\n    bbox.p1 = this.__reader.loadFloat32Vec3()\r\n    // console.log(this.__reader.pos() / 8);\r\n    const numBodySurfaces = this.__reader.loadFloat32()\r\n    const numBodyCurves = this.__reader.loadFloat32()\r\n    const surfaceRefs = []\r\n    for (let j = 0; j < numBodySurfaces; j++) {\r\n      if (includeXfosAndColors) {\r\n        const surfaceRef = {\r\n          surfaceId: this.__reader.loadFloat32(),\r\n        }\r\n        surfaceRef.xfo = new Xfo(\r\n          this.__reader.loadFloat32Vec3(),\r\n          this.__reader.loadFloat32Quat(),\r\n          this.__reader.loadFloat32Vec3()\r\n        )\r\n        surfaceRef.color = this.__reader.loadRGBAFloat32Color()\r\n        surfaceRefs.push(surfaceRef)\r\n      } else {\r\n        surfaceRefs.push(this.__reader.loadFloat32())\r\n        this.__reader.advance(14 * 4)\r\n      }\r\n    }\r\n\r\n    const curveRefs = []\r\n    for (let j = 0; j < numBodyCurves; j++) {\r\n      if (includeXfosAndColors) {\r\n        const curveRef = {\r\n          curveId: this.__reader.loadFloat32(),\r\n        }\r\n        curveRef.xfo = new Xfo(\r\n          this.__reader.loadFloat32Vec3(),\r\n          this.__reader.loadFloat32Quat(),\r\n          this.__reader.loadFloat32Vec3()\r\n        )\r\n        curveRef.color = this.__reader.loadRGBAFloat32Color()\r\n        curveRefs.push(curveRef)\r\n      } else {\r\n        curveRefs.push(this.__reader.loadFloat32())\r\n        this.__reader.advance(14 * 4)\r\n      }\r\n    }\r\n\r\n    const bodyDescData = {\r\n      bbox,\r\n      surfaceRefs,\r\n      curveRefs,\r\n    }\r\n\r\n    return bodyDescData\r\n  }\r\n}\r\n\r\nexport { CADBodyLibrary }\r\n","import {\r\n  Color,\r\n  Box3,\r\n  MaterialParameter,\r\n  ColorParameter,\r\n  BaseGeomItem,\r\n  Material,\r\n  GeomItem,\r\n  TreeItem,\r\n  Registry,\r\n} from '@zeainc/zea-engine'\r\n\r\n/**\r\n * Represents a Body within a CAD Part. A Body is made up of either a single mesh or a collection of meshes, one for each surface.\r\n * When a zcad file is produced, the tool can  optimize bodies to contain only one mesh to speed up loading of large models, and support bigger models being loaded.\r\n *\r\n * **Parameters**\r\n * * **Material(`MaterialParameter`):** Specifies the material of the geometry item.\r\n * * **Color(`ColorParameter`):** Specifies the color of the geometry item.\r\n *\r\n * @extends BaseGeomItem\r\n */\r\nclass CADBody extends BaseGeomItem {\r\n  /**\r\n   * Creates an instance of CADBody setting up the initial configuration for Material and Color parameters.\r\n   *\r\n   * @param {string} name - The name value.\r\n   * @param {CADAsset} cadAsset - The cadAsset value.\r\n   */\r\n  constructor(name, cadAsset) {\r\n    super(name)\r\n    this.__bodyDescId = -1\r\n    this.__id = -1\r\n    this.__bodyBBox = new Box3()\r\n    this.__cadAsset = cadAsset // Note: used in testing scenes.\r\n    if (this.__cadAsset) this.__cadAsset.incCADBodyCount()\r\n\r\n    this.__materialParam = this.addParameter(new MaterialParameter('Material'))\r\n    this.__colorParam = this.addParameter(new ColorParameter('Color', new Color(1, 0, 0, 0)))\r\n  }\r\n\r\n  /**\r\n   * Returns the `CADAsset` object in current `CADBody`\r\n   *\r\n   * @return {CADAsset} - The return value.\r\n   */\r\n  getCADAsset() {\r\n    return this.__cadAsset\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new CADBody, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {CADBody} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new CADBody()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  /**\r\n   * The copyFrom method.\r\n   * @param {CADBody} src - The src param.\r\n   * @param {number} flags - The flags param.\r\n   * @private\r\n   */\r\n  copyFrom(src, flags) {\r\n    super.copyFrom(src, flags)\r\n    this.__cadAsset = src.getCADAsset()\r\n    this.__cadAsset.incCADBodyCount()\r\n\r\n    this.setBodyDescId(src.getBodyDescId())\r\n    this.setMaterial(src.getMaterial()) // clone?\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Geometry\r\n\r\n  /**\r\n   * The getBodyDataTexelCoords method.\r\n   * @param {any} bodyDescId - The bodyDescId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getBodyDataTexelCoords() {\r\n    return this.__cadAsset.getBodyLibrary().getBodyDataTexelCoords(this.__bodyDescId)\r\n  }\r\n\r\n  /**\r\n   * Returns an object that contains the bBox and all the SurfaceRefs of current object using the bodyDescId.\r\n   * @private\r\n   * @return {object} - The return value.\r\n   */\r\n  getBodyDescData() {\r\n    const bodyDescData = this.__cadAsset.getBodyLibrary().getBodyDescData(this.__bodyDescId)\r\n    for (const surfaceRef of bodyDescData.surfaceRefs) {\r\n      surfaceRef.surfaceType = this.__cadAsset.getSurfaceLibrary().getSurfaceTypeLabel(surfaceRef.surfaceId)\r\n      surfaceRef.dims = this.__cadAsset.getSurfaceLibrary().getSurfaceDims(surfaceRef.surfaceId)\r\n    }\r\n    return bodyDescData\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all SurfaceRefs of current `CADBody`.\r\n   * <br>\r\n   * Which contain the surfaceId, xfo object and the color.\r\n   *\r\n   * @return {array} - The return value.\r\n   */\r\n  getSurfaceRefs() {\r\n    const bodyData = this.getBodyDescData()\r\n    return bodyData.surfaceRefs\r\n  }\r\n\r\n  /**\r\n   * Returns the bodyDescId of current `CADBody`\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getBodyDescId() {\r\n    return this.__bodyDescId\r\n  }\r\n\r\n  /**\r\n   * Sets bodyDescId to current `CADBody`, but also calculates a new bBox.\r\n   * @private\r\n   * @param {number} bodyId - The bodyId param.\r\n   */\r\n  setBodyDescId(bodyId) {\r\n    this.__bodyDescId = bodyId\r\n    if (bodyId >= 0) {\r\n      this.__bodyBBox = this.__cadAsset.getBodyLibrary().getBodyBBox(this.__bodyDescId)\r\n      this._setBoundingBoxDirty()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns current Material parameter value.\r\n   * @deprecated\r\n   * @return {MaterialParameter} - The return value.\r\n   */\r\n  getMaterial() {\r\n    return this.__materialParam.getValue()\r\n  }\r\n\r\n  /**\r\n   * Sets Material parameter value.\r\n   * <br>\r\n   * For `mode` possible values check `Parameter` Class documentation.\r\n   * @see [Zea Engine]()\r\n   *\r\n   * @deprecated\r\n   * @param {MaterialParameter} material - The material param.\r\n   * @param {number} mode - The mode param.\r\n   */\r\n  setMaterial(material, mode) {\r\n    this.__materialParam.setValue(material, mode)\r\n  }\r\n\r\n  /**\r\n   * The _cleanBoundingBox method.\r\n   * @param {any} bbox - The bbox param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  _cleanBoundingBox(bbox) {\r\n    bbox = super._cleanBoundingBox(bbox)\r\n    if (this.__bodyDescId != -1) {\r\n      bbox.addBox3(this.__bodyBBox, this.getParameter('GlobalXfo').getValue())\r\n    }\r\n    return bbox\r\n  }\r\n\r\n  // ///////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Initializes CADBody's asset, material, version and layers; adding current `CADBody` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {object} context - The context param.\r\n   */\r\n  readBinary(reader, context) {\r\n    super.readBinary(reader, context)\r\n\r\n    // Cache only in debug mode.\r\n    this.__cadAsset = context.assetItem\r\n    this.__cadAsset.incCADBodyCount()\r\n\r\n    const bodyDescId = reader.loadSInt32()\r\n    if (bodyDescId >= 0) {\r\n      this.setBodyDescId(bodyDescId)\r\n    }\r\n\r\n    if (context.versions['zea-cad'].compare([0, 0, 4]) < 0) {\r\n      const materialName = reader.loadStr()\r\n      // const materialName = 'Mat' + this.__bodyDescId;\r\n\r\n      const materialLibrary = context.assetItem.getMaterialLibrary()\r\n      let material = materialLibrary.getMaterial(materialName, false)\r\n      if (!material) {\r\n        // console.warn(\"Body :'\" + this.name + \"' Material not found:\" + materialName);\r\n        // material = materialLibrary.getMaterial('DefaultMaterial');\r\n\r\n        material = new Material(materialName, 'SimpleSurfaceShader')\r\n        material.getParameter('BaseColor').setValue(Color.random(0.25))\r\n        context.assetItem.getMaterialLibrary().addMaterial(material)\r\n      }\r\n      this.getParameter('Material').setValue(material)\r\n    }\r\n\r\n    if (context.versions['zea-cad'].compare([0, 0, 2]) >= 0 && context.versions['zea-cad'].compare([0, 0, 4]) < 0) {\r\n      this.__layers = reader.loadStrArray()\r\n      // console.log(\"Layers:\", this.__layers)\r\n      for (const layer of this.__layers) context.addGeomToLayer(this, layer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The generatePolygonMeshSurfaces method.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generatePolygonMeshSurfaces(lod = 0) {\r\n    const treeItem = new TreeItem(this.getName())\r\n\r\n    // const standardMaterial = new Material('surfaces', 'SimpleSurfaceShader');\r\n    // standardMaterial.getParameter('BaseColor').setValue(Color.random(0.4));\r\n\r\n    const bodyData = this.getBodyDescData()\r\n    bodyData.surfaceRefs.forEach((surfaceRef, surfaceIndex) => {\r\n      const mesh = this.__cadAsset.getSurfaceLibrary().generatePolygonSurface(surfaceRef.surfaceId, lod)\r\n      if (mesh) {\r\n        const geomItem = new GeomItem('Surface' + surfaceIndex + ':' + surfaceRef.surfaceId, mesh, mesh.material) // this.__material);// mesh.mat);\r\n        geomItem.getParameter('LocalXfo').setValue(surfaceRef.xfo)\r\n        treeItem.addChild(geomItem)\r\n      }\r\n    })\r\n    return treeItem\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generateHullGeometry() {\r\n    const treeItem = new TreeItem(this.getName())\r\n    const bodyData = this.getBodyDescData()\r\n    bodyData.surfaceRefs.forEach((surfaceRef, surfaceIndex) => {\r\n      const hull = this.__cadAsset.getSurfaceLibrary().generateHullGeometry(surfaceRef.surfaceId)\r\n      if (hull) {\r\n        const geomItem = new GeomItem('Hull' + surfaceIndex + ':' + surfaceRef.surfaceId, hull, hull.material)\r\n        geomItem.getParameter('LocalXfo').setValue(surfaceRef.xfo)\r\n        treeItem.addChild(geomItem)\r\n        return false\r\n      }\r\n    })\r\n    return treeItem\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - The return value.\r\n   */\r\n  toJSON(flags = 0) {\r\n    const j = super.toJSON(flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The j param.\r\n   * @param {number} flags - The flags param.\r\n   */\r\n  fromJSON(j, flags = 0) {\r\n    super.fromJSON(j, flags)\r\n  }\r\n}\r\n\r\nRegistry.register('CADBody', CADBody)\r\n\r\nexport { CADBody }\r\n","/* eslint-disable no-unused-vars */\r\nimport {\r\n  Vec2,\r\n  Vec3,\r\n  Color,\r\n  FilePathParameter,\r\n  BooleanParameter,\r\n  NumberParameter,\r\n  ColorParameter,\r\n  Vec3Parameter,\r\n  Version,\r\n  BinReader,\r\n  SystemDesc,\r\n  AssetItem,\r\n  AssetLoadContext,\r\n  TreeItem,\r\n  Registry,\r\n  resourceLoader,\r\n} from '@zeainc/zea-engine'\r\nimport { CADSurfaceLibrary } from './CADSurfaceLibrary.js'\r\nimport { CADTrimSetLibrary } from './CADTrimSetLibrary.js'\r\nimport { CADBodyLibrary } from './CADBodyLibrary.js'\r\nimport { CADBody } from './CADBody.js'\r\n\r\nconst cadFileExts = new RegExp('\\\\.(stp|step|jt|3dm|ifc|vlcad|zcad)$', 'i')\r\n\r\n// eslint-disable-next-line require-jsdoc\r\nfunction getLOD() {\r\n  const urlParams = new URLSearchParams(window.location.search)\r\n  if (urlParams.has('lod')) {\r\n    return Number.parseInt(urlParams.get('lod'))\r\n  }\r\n  switch (SystemDesc.deviceCategory) {\r\n    case 'Low':\r\n      return 1\r\n    case 'Medium':\r\n      return 2\r\n    case 'High':\r\n      return 3\r\n  }\r\n  return 1\r\n}\r\n\r\n/**\r\n * Class representing a CAD asset.\r\n *\r\n * **Parameters**\r\n * * **DataFilePath(`FilePathParameter`):** Hosts file information used to load the asset(Like the URL).\r\n * * **DisplayEdges(`BooleanParameter`):** Hides/Shows edges of the asset(Like a border).\r\n * * **EdgeColor(`ColorParameter`):** Specifies the color of the edge(border-color).\r\n *\r\n * **Events**\r\n * * **loaded:** Triggered when the  asset is loaded\r\n * @extends AssetItem\r\n */\r\nclass CADAsset extends AssetItem {\r\n  /**\r\n   * Create a CAD asset.\r\n   * @param {string} name - The name value.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n\r\n    this.__trimSetLibrary = new CADTrimSetLibrary()\r\n    this.__surfaceLibrary = new CADSurfaceLibrary(this, this.__trimSetLibrary)\r\n    this.__bodyLibrary = new CADBodyLibrary()\r\n    this.__atlasSize = new Vec2()\r\n    this.__numCADBodyItems = 0\r\n    this.__loaded = false\r\n\r\n    this.__datafileParam = this.addParameter(new FilePathParameter('FilePath'))\r\n    this.addParameterDeprecationMapping('DataFilePath', 'FilePath')\r\n    this.__datafileParam.on('valueChanged', () => {\r\n      let url\r\n      const file = this.__datafileParam.getFileDesc()\r\n      if (file.metadata && file.metadata.ConvertFile) {\r\n        let zcadFile\r\n        const zcadfileext = new RegExp('\\\\.(vlcad|zcad)$', 'i')\r\n        file.metadata.ConvertFile.map((metadataFile) => {\r\n          if (zcadfileext.test(metadataFile.filename)) zcadFile = metadataFile\r\n        })\r\n        if (zcadFile) {\r\n          url = zcadFile.url\r\n        } else {\r\n          console.warn('ConvertFile metadata contains no vla file.')\r\n        }\r\n      } else if (file.url) {\r\n        url = file.url\r\n      } else {\r\n        console.warn('CADAsset unable to load file:', file)\r\n      }\r\n\r\n      this.load(url)\r\n    })\r\n\r\n    this.addParameter(new BooleanParameter('DisplayEdges', true))\r\n    this.addParameter(new ColorParameter('EdgeColor', new Color(0.1, 0.1, 0.1, 0.75)))\r\n\r\n    this.lod = getLOD()\r\n    this.curvatureToDetail = 0.5\r\n  }\r\n\r\n  /**\r\n   * Returns the loaded status of the AssetItem.\r\n   *\r\n   * @return {boolean} - Returns true if the asset has already loaded its data.\r\n   */\r\n  isLoaded() {\r\n    return this.__loaded\r\n  }\r\n\r\n  /**\r\n   * Returns `LOD` parameter value.\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getLOD() {\r\n    return Math.max(0, this.lod)\r\n  }\r\n\r\n  /**\r\n   * The incCADBodyCount method.\r\n   * @private\r\n   */\r\n  incCADBodyCount() {\r\n    this.__numCADBodyItems++\r\n  }\r\n\r\n  /**\r\n   * Returns the value of number CADBody items in the asset.\r\n   *\r\n   * @return {number} - The return value.\r\n   */\r\n  getNumBodyItems() {\r\n    return this.__numCADBodyItems\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADSurfaceLibrary` object on current Asset\r\n   *\r\n   * @return {CADSurfaceLibrary} - The return value.\r\n   */\r\n  getSurfaceLibrary() {\r\n    return this.__surfaceLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADTrimSetLibrary` object of current Asset\r\n   *\r\n   * @return {CADTrimSetLibrary} - The return value.\r\n   */\r\n  getTrimSetLibrary() {\r\n    return this.__trimSetLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `CADBodyLibrary` object of current Asset\r\n   *\r\n   * @return {CADBodyLibrary} - The return value.\r\n   */\r\n  getBodyLibrary() {\r\n    return this.__bodyLibrary\r\n  }\r\n\r\n  /**\r\n   * Returns the instantiated `MaterialLibrary` object of current Asset\r\n   *\r\n   * @return {MaterialLibrary} - The return value.\r\n   */\r\n  getMaterialLibrary() {\r\n    return this.__materials\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Returns the versioon of the data loaded by thie CADAsset.\r\n   *\r\n   * @return {string} - The return value.\r\n   */\r\n  getVersion() {\r\n    return this.cadfileversion\r\n  }\r\n\r\n  /**\r\n   * Initializes CADAsset's asset, material, version and layers; adding current `CADAsset` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {AssetLoadContext} context - The load context object that provides additional data such as the units of the scene we are loading into.\r\n   */\r\n  readRootLevelBinary(reader, context) {\r\n    this.__numCADBodyItems = 0\r\n\r\n    context.versions['zea-cad'] = new Version(reader.loadStr())\r\n    context.sdk = reader.loadStr()\r\n    this.cadfileversion = context.versions['zea-cad']\r\n    // console.log('Loading CAD File version:', this.cadfileversion, ' exported using SDK:', context.cadSDK)\r\n\r\n    super.readBinary(reader, context)\r\n  }\r\n\r\n  /**\r\n   * Loads all the geometries and metadata from the asset file.\r\n   * @param {string} url - The URL of the asset to load\r\n   * @param {AssetLoadContext} context - The load context object that provides additional data such as paths to external references.\r\n   * @return {Promise} - Returns a promise that resolves once the load of the tree is complete. Geometries, textures and other resources might still be loading.\r\n   */\r\n  load(url, context = new AssetLoadContext()) {\r\n    if (this.__loadPromise) return this.__loadPromise\r\n    this.__loadPromise = new Promise((resolve, reject) => {\r\n      const folder = url.lastIndexOf('/') > -1 ? url.substring(0, url.lastIndexOf('/')) + '/' : ''\r\n      const filename = url.lastIndexOf('/') > -1 ? url.substring(url.lastIndexOf('/') + 1) : ''\r\n      const stem = filename.substring(0, filename.lastIndexOf('.'))\r\n\r\n      this.url = url\r\n\r\n      // These values are used by XRef to generate URLS.\r\n      context.assetItem = this\r\n      context.url = url\r\n      context.folder = folder\r\n      context.xrefs = {}\r\n\r\n      context.on('done', () => {\r\n        this.__loaded = true\r\n        resolve()\r\n        this.emit('loaded')\r\n      })\r\n\r\n      context.incrementAsync()\r\n\r\n      // Increment the resource loader counter to provided an update to the progress bar.\r\n      // preload in case we don't have embedded geoms.\r\n      // completed by geomLibrary.on('loaded' ..\r\n      resourceLoader.incrementWorkload(1)\r\n      this.__geomLibrary.once('loaded', () => {\r\n        // A chunk of geoms are now parsed, so update the resource loader.\r\n        resourceLoader.incrementWorkDone(1)\r\n      })\r\n\r\n      resourceLoader.loadFile('archive', url).then(\r\n        (entries) => {\r\n          // const desc = entries['desc.json']\r\n          //   ? JSON.parse(new TextDecoder('utf-8').decode(entries['desc.json']))\r\n          //   : { numGeomFiles: 0 }\r\n\r\n          const treeReader = new BinReader((entries.tree2 || entries.tree).buffer, 0, SystemDesc.isMobileDevice)\r\n\r\n          if (entries.bodies) {\r\n            this.__bodyLibrary.setBinaryBuffers(entries.bodiestoc.buffer, entries.bodies.buffer)\r\n          }\r\n\r\n          const name = this.getName()\r\n          this.readRootLevelBinary(treeReader, context)\r\n\r\n          // Maintain the name provided by the user before loading.\r\n          if (name != '') this.setName(name)\r\n\r\n          context.versions['zea-cad'] = this.getVersion()\r\n          context.versions['zea-engine'] = this.getEngineDataVersion()\r\n\r\n          if (entries.geoms) {\r\n            this.__geomLibrary.readBinaryBuffer(filename, entries.geoms.buffer, context)\r\n          } else if (entries['geomLibrary.json']) {\r\n            entries['desc.json']\r\n            const geomLibraryJSON = JSON.parse(new TextDecoder('utf-8').decode(entries['geomLibrary.json']))\r\n            const basePath = folder + stem\r\n            this.__geomLibrary.loadGeomFilesStream(geomLibraryJSON, basePath, context)\r\n          } else {\r\n            // No geoms in this file, so we won't wait for the 'done' event in the GeomLibrary.\r\n            resourceLoader.incrementWorkDone(1)\r\n          }\r\n\r\n          if (entries.trimSets) {\r\n            const trimSets = entries.trimSets || entries.trimsets || entries.trimSets2\r\n            const trimSetReader = new BinReader(trimSets.buffer, 0, SystemDesc.isMobileDevice)\r\n\r\n            this.__trimSetLibrary.setBinaryBuffer(trimSetReader, this.getVersion())\r\n          }\r\n\r\n          if (entries.curves) {\r\n            this.__surfaceLibrary.setBinaryBuffers(entries.curves.buffer, entries.surfaces.buffer, this.getVersion())\r\n          }\r\n\r\n          // console.log(this.__name, \" NumBaseItems:\", this.getNumBaseItems(), \" NumCADBodyItems:\", this.__numCADBodyItems)\r\n          context.decrementAsync()\r\n        },\r\n        (error) => {\r\n          resourceLoader.incrementWorkDone(1)\r\n          this.emit('error', error)\r\n          reject(error)\r\n        }\r\n      )\r\n    })\r\n\r\n    return this.__loadPromise\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - The return value.\r\n   */\r\n  toJSON(context, flags) {\r\n    const j = super.toJSON(context, flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The json object this item must decode.\r\n   * @param {object} context - The context param.\r\n   * @param {callback} onDone - The onDone param.\r\n   */\r\n  fromJSON(j, context, onDone) {\r\n    const loadAssetJSON = () => {\r\n      const flags = TreeItem.LoadFlags.LOAD_FLAG_LOADING_BIN_TREE_VALUES\r\n      super.fromJSON(j, context, flags, onDone)\r\n      context.decAsyncCount()\r\n\r\n      // If the asset is nested within a bigger asset, then\r\n      // this subtree can noow be flagged as loded(and added to the renderer);\r\n      if (!this.__loaded) {\r\n        this.emit('loaded')\r\n        this.__loaded = true\r\n      }\r\n    }\r\n\r\n    if (j.params && j.params.DataFilePath) {\r\n      this.__datafileLoaded = loadAssetJSON\r\n      context.incAsyncCount()\r\n      const filePathJSON = j.params.DataFilePath\r\n      delete j.params.DataFilePath\r\n      this.__datafileParam.fromJSON(filePathJSON, context)\r\n    } else {\r\n      loadAssetJSON()\r\n    }\r\n  }\r\n\r\n  // ////////////////////////////////////////////////////\r\n  // Debugging\r\n\r\n  /**\r\n   * The generatePolygonMeshSurfaces method.\r\n   * @param {number} lod - The lod param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generatePolygonMeshSurfaces(lod = 0) {\r\n    // Traverse the tree adding items till we hit the leaves(which are usually GeomItems.)\r\n    // let count = 0\r\n    const surfacesTreeItem = new TreeItem('surfaces')\r\n    const traverse = (treeItem) => {\r\n      treeItem.getChildren().forEach((childItem) => {\r\n        if (childItem instanceof CADBody) {\r\n          const cadBodySurfaces = childItem.generatePolygonMeshSurfaces(lod)\r\n          const globalXfo = childItem.getParameter('GlobalXfo').getValue()\r\n          cadBodySurfaces.getParameter('GlobalXfo').setValue(globalXfo)\r\n          surfacesTreeItem.addChild(cadBodySurfaces)\r\n        } else traverse(childItem)\r\n      })\r\n    }\r\n    traverse(this)\r\n\r\n    surfaceLibrary.logFormfactors()\r\n    return surfacesTreeItem\r\n  }\r\n\r\n  /**\r\n   * The generateHullGeometry method.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  generateHullGeometry() {\r\n    // Traverse the tree adding items till we hit the leaves(which are usually GeomItems.)\r\n    // let count = 0\r\n    const hullTreeItem = new TreeItem('hull')\r\n    const traverse = (treeItem) => {\r\n      treeItem.getChildren().forEach((childItem) => {\r\n        if (childItem instanceof CADBody) {\r\n          const cadBodyHulls = childItem.generateHullGeometry()\r\n          const globalXfo = childItem.getParameter('GlobalXfo').getValue()\r\n          hullTreeItem.getParameter('GlobalXfo').setValue(globalXfo)\r\n          hullTreeItem.addChild(cadBodyHulls)\r\n        } else traverse(childItem)\r\n      })\r\n    }\r\n    traverse(this)\r\n\r\n    surfaceLibrary.logFormfactors()\r\n    return hullTreeItem\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Static Methods\r\n\r\n  /**\r\n   * Getter for LOADSTATE.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  static get LOADSTATE() {\r\n    return LOADSTATE\r\n  }\r\n\r\n  /**\r\n   * The supportsExt method.\r\n   * @param {any} filename - The filename param.\r\n   * @return {any} - The return value.\r\n   * @private\r\n   */\r\n  static supportsExt(filename) {\r\n    return cadFileExts.test(filename)\r\n  }\r\n}\r\n\r\nRegistry.register('CADAsset', CADAsset)\r\n\r\nexport { CADAsset }\r\n","import { TreeItem, Registry } from '@zeainc/zea-engine'\r\n\r\n/**\r\n * Represents a Tree Item of an Assembly modeling. Brings together components to define a larger product.\r\n *\r\n * @extends TreeItem\r\n */\r\nclass CADAssembly extends TreeItem {\r\n  /**\r\n   * Create a CAD assembly.\r\n   *\r\n   * @param {string} name - The name of the tree item.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new CADAssembly item, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {CADAssembly} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new CADAssembly()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  // ////////////////////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - Returns the json object.\r\n   */\r\n  toJSON(context, flags = 0) {\r\n    const j = super.toJSON(context, flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The json object this item must decode.\r\n   * @param {object} context - The context param.\r\n   * @param {number} flags - The flags param.\r\n   */\r\n  fromJSON(j, context, flags = 0) {\r\n    super.fromJSON(j, context, flags)\r\n  }\r\n}\r\n\r\nRegistry.register('CADAssembly', CADAssembly)\r\n\r\nexport { CADAssembly }\r\n","import { TreeItem, Registry } from '@zeainc/zea-engine'\n\n/**\n * Represents a Part within a CAD assembly.\n *\n * @extends TreeItem\n */\nclass CADPart extends TreeItem {\n  /**\n   * Creates an instance of CADPart setting up the initial configuration for Material and Color parameters.\n   *\n   * @param {string} name - The name value.\n   */\n  constructor(name) {\n    super(name)\n  }\n\n  /**\n   * The clone method constructs a new CADPart, copies its values\n   * from this item and returns it.\n   *\n   * @param {number} flags - The flags param.\n   * @return {CADPart} - The return value.\n   */\n  clone(flags) {\n    const cloned = new CADPart()\n    cloned.copyFrom(this, flags)\n    return cloned\n  }\n\n  /**\n   * The copyFrom method.\n   * @param {CADPart} src - The src param.\n   * @param {number} flags - The flags param.\n   * @private\n   */\n  copyFrom(src, flags) {\n    super.copyFrom(src, flags)\n  }\n\n  // ///////////////////////////\n  // Persistence\n\n  /**\n   * Initializes CADPart's asset, material, version and layers; adding current `CADPart` Geometry Item toall the layers in reader\n   *\n   * @param {BinReader} reader - The reader param.\n   * @param {object} context - The context param.\n   */\n  readBinary(reader, context) {\n    super.readBinary(reader, context)\n  }\n\n  /**\n   * The toJSON method encodes this type as a json object for persistences.\n   *\n   * @param {number} flags - The flags param.\n   * @return {object} - The return value.\n   */\n  toJSON(flags = 0) {\n    const j = super.toJSON(flags)\n    return j\n  }\n\n  /**\n   * The fromJSON method decodes a json object for this type.\n   *\n   * @param {object} j - The j param.\n   * @param {number} flags - The flags param.\n   */\n  fromJSON(j, flags = 0) {\n    super.fromJSON(j, flags)\n  }\n}\n\nRegistry.register('CADPart', CADPart)\n\nexport { CADPart }\n","import { Parameter, Registry, Vec3Parameter } from '@zeainc/zea-engine'\r\n\r\n/**\r\n * A parameter for storing an array of string values.\r\n *\r\n * @extends Parameter\r\n */\r\nclass StringListParameter extends Parameter {\r\n  /**\r\n   * Create a string parameter.\r\n   * @param {string} name - The name of the material color parameter.\r\n   * @param {string} value - The value of the parameter.\r\n   */\r\n  constructor(name, value = []) {\r\n    super(name, value, 'String[]')\r\n    this.multiLine = false\r\n  }\r\n\r\n  /**\r\n   * Extracts the string value from a buffer, updating current parameter state.\r\n   *\r\n   * @param {BinReader} reader - The reader value.\r\n   * @param {object} context - The context value.\r\n   */\r\n  readBinary(reader, context) {\r\n    this.__value = reader.loadStrArray()\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new string parameter, copies its values\r\n   * from this parameter and returns it.\r\n   *\r\n   * @return {StringListParameter} - Returns a new string parameter.\r\n   */\r\n  clone() {\r\n    const clonedParam = new StringListParameter(this.__name, this.__value)\r\n    return clonedParam\r\n  }\r\n}\r\n\r\nRegistry.register('StringListParameter', StringListParameter)\r\nRegistry.register('Property_StringList', StringListParameter)\r\nRegistry.register('Property_Vec3_32f', Vec3Parameter)\r\n\r\nexport { StringListParameter }\r\n","import { TreeItem, Registry } from '@zeainc/zea-engine'\r\nimport { StringListParameter } from './StringListParameter'\r\n\r\n/**\r\n * Represents a view of PMI data. within a CAD assembly.\r\n *\r\n * @extends TreeItem\r\n */\r\nclass PMIView extends TreeItem {\r\n  /**\r\n   * Creates an instance of PMIView setting up the initial configuration for Material and Color parameters.\r\n   *\r\n   * @param {string} name - The name value.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n    this.addParameter(new StringListParameter('GraphicalElements'))\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new PMIView, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {PMIView} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new PMIView()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  /**\r\n   * The copyFrom method.\r\n   * @param {PMIView} src - The src param.\r\n   * @param {number} flags - The flags param.\r\n   * @private\r\n   */\r\n  copyFrom(src, flags) {\r\n    super.copyFrom(src, flags)\r\n  }\r\n\r\n  /**\r\n   * Changes the current state of the selection of this item.\r\n   *\r\n   * @emits `selectedChanged` with selected state\r\n   * @param {boolean} sel - Boolean indicating the new selection state.\r\n   */\r\n  setSelected(sel) {\r\n    super.setSelected(sel)\r\n  }\r\n\r\n  /**\r\n   * Activates the PMIView, adjusting visibility of the PMI items and the camera Xfo\r\n   *\r\n   * @param {Camera} camera - Boolean indicating the new selection state.\r\n   */\r\n  activate(camera) {\r\n    const pmiItems = this.getOwner().getOwner().getChildByName('PMI')\r\n    const graphicalItems = this.getParameter('GraphicalElements').getValue()\r\n    pmiItems.getChildren().forEach((pmiItem) => {\r\n      const visible = graphicalItems.includes(pmiItem.getName())\r\n      pmiItem.setVisible(visible)\r\n    })\r\n\r\n    if (camera) {\r\n      const cameraXfo = this.getParameter('GlobalXfo').getValue().clone()\r\n      const TargetPoint = this.getParameter('TargetPoint').getValue()\r\n      // const UpDirection = this.getParameter('UpDirection').getValue()\r\n      TargetPoint.scaleInPlace(cameraXfo.sc.z)\r\n      const dist = cameraXfo.tr.distanceTo(TargetPoint) // * cameraXfo.sc.z\r\n      cameraXfo.sc.set(1.0, 1.0, 1.0)\r\n\r\n      camera.getParameter('GlobalXfo').setValue(cameraXfo)\r\n      camera.setFocalDistance(dist)\r\n    }\r\n  }\r\n\r\n  // ///////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Initializes PMIView's asset, material, version and layers; adding current `PMIView` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {object} context - The context param.\r\n   */\r\n  readBinary(reader, context) {\r\n    super.readBinary(reader, context)\r\n  }\r\n\r\n  /**\r\n   * The toJSON method encodes this type as a json object for persistences.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {object} - The return value.\r\n   */\r\n  toJSON(flags = 0) {\r\n    const j = super.toJSON(flags)\r\n    return j\r\n  }\r\n\r\n  /**\r\n   * The fromJSON method decodes a json object for this type.\r\n   *\r\n   * @param {object} j - The j param.\r\n   * @param {number} flags - The flags param.\r\n   */\r\n  fromJSON(j, flags = 0) {\r\n    super.fromJSON(j, flags)\r\n  }\r\n}\r\n\r\nRegistry.register('PMIView', PMIView)\r\n\r\nexport { PMIView }\r\n","import { Registry, AssetLoadContext } from '@zeainc/zea-engine'\r\nimport { StringListParameter } from './StringListParameter'\r\nimport { CADAsset } from './CADAsset'\r\n\r\n/**\r\n * Represents a view of PMI data. within a CAD assembly.\r\n *\r\n * @extends TreeItem\r\n */\r\nclass XRef extends CADAsset {\r\n  /**\r\n   * Creates an instance of XRef setting up the initial configuration for Material and Color parameters.\r\n   *\r\n   * @param {string} name - The name value.\r\n   */\r\n  constructor(name) {\r\n    super(name)\r\n  }\r\n\r\n  /**\r\n   * The clone method constructs a new XRef, copies its values\r\n   * from this item and returns it.\r\n   *\r\n   * @param {number} flags - The flags param.\r\n   * @return {XRef} - The return value.\r\n   */\r\n  clone(flags) {\r\n    const cloned = new XRef()\r\n    cloned.copyFrom(this, flags)\r\n    return cloned\r\n  }\r\n\r\n  // ///////////////////////////\r\n  // Persistence\r\n\r\n  /**\r\n   * Initializes XRef's asset, material, version and layers; adding current `XRef` Geometry Item toall the layers in reader\r\n   *\r\n   * @param {BinReader} reader - The reader param.\r\n   * @param {object} context - The context param.\r\n   */\r\n  readBinary(reader, context) {\r\n    reader.loadStr() // read type\r\n    reader.loadStr() // read name\r\n    const relativePath = reader.loadStr()\r\n\r\n    if (context.assets[relativePath]) {\r\n      const srcAsset = context.assets[relativePath]\r\n      if (srcAsset.isLoaded()) {\r\n        this.copyFrom(srcAsset, 0)\r\n      } else {\r\n        srcAsset.on('loaded', () => {\r\n          this.copyFrom(srcAsset, 0)\r\n        })\r\n      }\r\n    } else {\r\n      context.assets[relativePath] = this\r\n\r\n      this.setName(relativePath)\r\n\r\n      if (!context.resources[relativePath]) {\r\n        // Generate a path based on the path of the parent CADAsset.\r\n        // const stem = relativePath.substring(0, relativePath.lastIndexOf('.'))\r\n        // context.resources[relativePath] = context.folder + stem + '.zcad'\r\n        context.resources[relativePath] = context.folder + relativePath + '.zcad'\r\n      }\r\n\r\n      if (context.resources[relativePath]) {\r\n        console.log('resolving XRef:', relativePath, ' > ', context.resources[relativePath])\r\n        const url = context.resources[relativePath]\r\n        context.incrementAsync()\r\n\r\n        if (context.xrefs[relativePath]) {\r\n          const xref = context.xrefs[relativePath]\r\n          if (!xref.isLoaded()) {\r\n            xref.on('loaded', () => {\r\n              this.copyFrom(xref)\r\n            })\r\n          } else {\r\n            this.copyFrom(xref)\r\n          }\r\n        } else {\r\n          context.xrefs[relativePath] = this\r\n          this.on('loaded', () => {\r\n            context.decrementAsync()\r\n          })\r\n          this.load(\r\n            url,\r\n            new AssetLoadContext(context)\r\n          ) /*.then(\r\n          () => {\r\n            context.decrementAsync()\r\n          },\r\n          (error) => {\r\n            context.decrementAsync()\r\n          }\r\n        )*/\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nRegistry.register('XRef', XRef)\r\n\r\nexport { XRef }\r\n","import { Lines, Mesh, GLMesh, GLLines, Plane } from '@zeainc/zea-engine'\r\n\r\nimport { drawShaderAttribsStride } from './CADConstants.js'\r\n\r\n/** This class abstracts the rendering of a collection of geometries to screen.\r\n * @extends Lines\r\n * @ignore\r\n */\r\nclass SurfaceNormals extends Lines {\r\n  /**\r\n   * Create surface normals.\r\n   * @param {number} u - The u value.\r\n   * @param {number} v - The v value.\r\n   */\r\n  constructor(u, v) {\r\n    super()\r\n    this.setNumSegments(u * v)\r\n    this.setNumVertices(u * v * 2)\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i < v; i++) {\r\n      const y = i / (v - 1) - 0.5\r\n      for (let j = 0; j < u; j++) {\r\n        const x = j / (u - 1) - 0.5\r\n        const id = i * u + j\r\n        positions.getValueRef(id * 2).set(x, y, 0.0)\r\n        positions.getValueRef(id * 2 + 1).set(x, y, 1.0)\r\n        this.setSegmentVertexIndices(id, id * 2, id * 2 + 1)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a fan.\r\n * @extends Mesh\r\n * @ignore\r\n */\r\nclass Fan extends Mesh {\r\n  /**\r\n   * Create a fan.\r\n   * @param {any} vertexCount - The vertexCount value.\r\n   */\r\n  constructor(vertexCount) {\r\n    super()\r\n    this.setNumVertices(vertexCount)\r\n    const faceCount = vertexCount - 2\r\n    this.setFaceCounts([faceCount])\r\n\r\n    // ////////////////////////////\r\n    // build the topology\r\n    for (let j = 0; j < faceCount; j++) {\r\n      this.setFaceVertexIndices(j, [0, j + 1, j + 2])\r\n    }\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i < vertexCount; i++) {\r\n      // Note: the 'x,y' values are used as uv coords\r\n      // to look up the actual vertex values in the texture.\r\n      // (with a 0.5, 0.5 offset)\r\n      positions.getValueRef(i).set(i / vertexCount - 0.5, -0.5, 0.0)\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a sub set.\r\n * @ignore\r\n */\r\nclass SubSet {\r\n  /**\r\n   * Create a sub set.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    this.__gl = gl\r\n    this.__drawCoordsArray = null\r\n    this.__drawCoordsBuffer = null\r\n    this.__drawCount = 0 // The number of visible drawn geoms.\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, type, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  setDrawItems(itemsArray) {\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, itemsArray, gl.STATIC_DRAW)\r\n    this.__drawCount = itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  addDrawItems(itemsArray) {\r\n    // console.log(\"addDrawItems:\" + itemsArray);\r\n    if (!this.__drawCoordsArray) {\r\n      this.__drawCoordsArray = itemsArray\r\n    } else {\r\n      const new_Array = new Float32Array(this.__drawCoordsArray.length + itemsArray.length)\r\n      new_Array.set(this.__drawCoordsArray)\r\n      new_Array.set(itemsArray, this.__drawCoordsArray.length)\r\n      this.__drawCoordsArray = new_Array\r\n    }\r\n\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.__drawCoordsArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount += itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDrawCount() {\r\n    return this.__drawCount\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (this.__drawCount == 0) {\r\n      return 0\r\n    }\r\n\r\n    const gl = this.__gl\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n\r\n    const attrs = renderstate.attrs\r\n    this.__bindAttr(attrs.drawCoords.location, 4, gl.FLOAT, drawShaderAttribsStride * 4, 0)\r\n    // this.__bindAttr(attrs.drawItemTexAddr.location, 2, gl.FLOAT, drawShaderAttribsStride * 4, 4 * 4)\r\n\r\n    return this.__drawCount\r\n  }\r\n\r\n  destroy() {\r\n    const gl = this.__gl\r\n    gl.deleteBuffer(this.__drawCoordsBuffer)\r\n    this.__drawCoordsBuffer = null\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL surface draw set.\r\n * @ignore\r\n */\r\nclass GLSurfaceDrawSet {\r\n  /**\r\n   * Create a GL surface draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {number} x - The x value.\r\n   * @param {number} y - The y value.\r\n   */\r\n  constructor(gl, x, y) {\r\n    // console.log(\"GLSurfaceDrawSet:\" + x + \",\" + y)\r\n    this.__gl = gl\r\n\r\n    if (x == 0 || y == 0) console.error('invalid GLSurfaceDrawSet:' + x + ',' + y)\r\n\r\n    if (y == 1) {\r\n      const key = x\r\n      if (!__cache[key]) {\r\n        __cache[key] = new GLMesh(gl, new Fan(x))\r\n      }\r\n      this.__glgeom = __cache[key]\r\n      this.__numTris = x - 2\r\n      this.__glnormalsgeom = new GLLines(gl, new SurfaceNormals(x, y))\r\n\r\n      this.key = key\r\n    } else {\r\n      const key = x + 'x' + y\r\n      if (!__cache[key]) {\r\n        __cache[key] = new GLMesh(gl, new Plane(1.0, 1.0, x - 1, y - 1))\r\n      }\r\n      this.__glgeom = __cache[key]\r\n      this.__numTris = (x - 1) * (y - 1) * 2\r\n      this.__glnormalsgeom = new GLLines(gl, new SurfaceNormals(x, y))\r\n\r\n      this.key = key\r\n    }\r\n    this.__quadDetail = [x - 1, y - 1]\r\n    this.__freeIndices = []\r\n    this.__subSets = {}\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  setDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    const drawCount = this.__subSets[key].setDrawItems(itemsArray)\r\n    return this.__numTris * drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    const drawCount = this.__subSets[key].addDrawItems(itemsArray)\r\n    // console.log(this.key, \"key:\", key, drawCount)\r\n\r\n    return this.__numTris * drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @param {any} key - The key param.\r\n   * @return {number} - The return value.\r\n   */\r\n  getDrawCount(key) {\r\n    if (this.__subSets[key]) return this.__subSets[key].getDrawCount()\r\n    return 0\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  draw(renderstate, key) {\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.quadDetail) {\r\n      gl.uniform2i(unifs.quadDetail.location, this.__quadDetail[0], this.__quadDetail[1])\r\n    }\r\n\r\n    this.__glgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glgeom.drawInstanced(drawCount)\r\n\r\n      // To debug the mesh topology we can render as lines instead.\r\n      // gl.drawElementsInstanced(\r\n      //   this.__glgeom.__gl.LINES,\r\n      //   this.__glgeom.__numTriIndices,\r\n      //   this.__glgeom.__indexDataType,\r\n      //   0,\r\n      //   drawCount\r\n      // )\r\n    })\r\n  }\r\n\r\n  /**\r\n   * The drawNormals method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  drawNormals(renderstate, key) {\r\n    if (!this.__glnormalsgeom) return\r\n\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.quadDetail) {\r\n      gl.uniform2i(unifs.quadDetail.location, this.__quadDetail[0], this.__quadDetail[1])\r\n    }\r\n\r\n    this.__glnormalsgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glnormalsgeom.drawInstanced(drawCount)\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    // Note:  this.__glgeom is shared between all GLCADAssets using a global cache. See above\r\n    // this.__glgeom.destroy()\r\n\r\n    if (this.__glnormalsgeom) this.__glnormalsgeom.destroy()\r\n\r\n    for (const key in this.__subSets) {\r\n      let subSet = this.__subSets[key]\r\n      subSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLSurfaceDrawSet }\r\n","import { Lines, GLLines } from '@zeainc/zea-engine'\r\nimport { drawShaderAttribsStride } from './CADConstants.js'\r\n\r\n/** Class representing an Edge\r\n * @private\r\n */\r\nclass Edge extends Lines {\r\n  /**\r\n   * Create a strip.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super()\r\n    this.setNumVertices(detail + 1)\r\n    this.setNumSegments(detail)\r\n    const positions = this.getVertexAttribute('positions')\r\n    for (let i = 0; i <= detail; i++) {\r\n      if (i < detail) this.setSegmentVertexIndices(i, i, i + 1)\r\n      // Note: the 'x,y' values are used as uv coords\r\n      // to look up the actual vertex values in the texture.\r\n      // (with a 0.5, 0.5 offset)\r\n      positions.getValueRef(i).set(i / detail, 0.0, 0.0)\r\n    }\r\n    this.emit('geomDataTopologyChanged')\r\n  }\r\n}\r\n\r\n/** Class representing a sub set.\r\n * @private\r\n */\r\nclass SubSet {\r\n  /**\r\n   * Create a sub set.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    this.__gl = gl\r\n    this.__drawCoordsArray = null\r\n    this.__drawCoordsBuffer = null\r\n    this.__drawCount = 0 // The number of visible drawn geoms.\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, type, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  setDrawItems(itemsArray) {\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, itemsArray, gl.STATIC_DRAW)\r\n    this.__drawCount = itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   */\r\n  addDrawItems(itemsArray) {\r\n    // console.log(\"addDrawItems:\" + itemsArray);\r\n    if (!this.__drawCoordsArray) {\r\n      this.__drawCoordsArray = itemsArray\r\n    } else {\r\n      const new_Array = new Float32Array(this.__drawCoordsArray.length + itemsArray.length)\r\n      new_Array.set(this.__drawCoordsArray)\r\n      new_Array.set(itemsArray, this.__drawCoordsArray.length)\r\n      this.__drawCoordsArray = new_Array\r\n    }\r\n\r\n    if (this.__drawCoordsBuffer) {\r\n      this.__gl.deleteBuffer(this.__drawCoordsBuffer)\r\n      this.__drawCoordsBuffer = null\r\n    }\r\n\r\n    const gl = this.__gl\r\n    this.__drawCoordsBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.__drawCoordsArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount += itemsArray.length / drawShaderAttribsStride\r\n    return this.__drawCount\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getDrawCount() {\r\n    return this.__drawCount\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (this.__drawCount == 0) {\r\n      return 0\r\n    }\r\n    const gl = this.__gl\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__drawCoordsBuffer)\r\n\r\n    const attrs = renderstate.attrs\r\n    this.__bindAttr(attrs.drawCoords.location, 4, gl.FLOAT, drawShaderAttribsStride * 4, 0)\r\n    // this.__bindAttr(attrs.drawItemTexAddr.location, 2, gl.FLOAT, drawShaderAttribsStride * 4, 4 * 4)\r\n\r\n    return this.__drawCount\r\n  }\r\n\r\n  destroy() {\r\n    const gl = this.__gl\r\n    gl.deleteBuffer(this.__drawCoordsBuffer)\r\n    this.__drawCoordsBuffer = null\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL surface draw set.\r\n * @private\r\n */\r\nclass GLCurveDrawSet {\r\n  /**\r\n   * Create a GL surface draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {number} x - The x value.\r\n   * @param {number} y - The y value.\r\n   */\r\n  constructor(gl, detail) {\r\n    // console.log(\"GLCurveDrawSet:\" + x + \",\" + y)\r\n    this.__gl = gl\r\n\r\n    if (detail == 0) console.error('invalid GLCurveDrawSet:' + detail)\r\n\r\n    if (!__cache[detail]) {\r\n      __cache[detail] = new GLLines(gl, new Edge(detail))\r\n    }\r\n    this.key = detail\r\n    this.__glgeom = __cache[detail]\r\n    this.__edgeDetail = detail\r\n    this.__freeIndices = []\r\n    this.__subSets = {}\r\n    this.__numDrawItems = 0\r\n  }\r\n\r\n  /**\r\n   * The setDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  setDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    this.__subSets[key].setDrawItems(itemsArray)\r\n\r\n    this.__numDrawItems += itemsArray.length / 2\r\n    return this.__numDrawItems\r\n  }\r\n\r\n  /**\r\n   * The addDrawItems method.\r\n   * @param {any} itemsArray - The itemsArray param.\r\n   * @param {any} key - The key param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addDrawItems(itemsArray, key) {\r\n    if (!this.__subSets[key]) {\r\n      this.__subSets[key] = new SubSet(this.__gl)\r\n    }\r\n    this.__numDrawItems += this.__subSets[key].addDrawItems(itemsArray)\r\n    // console.log(this.key, \"key:\", key, this.__numDrawItems)\r\n  }\r\n\r\n  /**\r\n   * The getDrawCount method.\r\n   * @param {any} key - The key param.\r\n   * @return {number} - The return value.\r\n   */\r\n  getDrawCount(key) {\r\n    if (this.__subSets[key]) return this.__subSets[key].getDrawCount()\r\n    return 0\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} key - The key param.\r\n   */\r\n  draw(renderstate, key) {\r\n    const subSet = this.__subSets[key]\r\n    if (!subSet) return\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    if (unifs.edgeDetail) {\r\n      gl.uniform1i(unifs.edgeDetail.location, this.__edgeDetail)\r\n    }\r\n\r\n    this.__glgeom.bind(renderstate)\r\n\r\n    const drawCount = subSet.bind(renderstate)\r\n    renderstate.bindViewports(renderstate.unifs, () => {\r\n      this.__glgeom.drawInstanced(drawCount)\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    // Note:  this.__glgeom is shared between all GLCADAssets using a global cache. See above\r\n    // this.__glgeom.destroy()\r\n\r\n    if (this.__glnormalsgeom) this.__glnormalsgeom.destroy()\r\n\r\n    for (const key in this.__subSets) {\r\n      let subSet = this.__subSets[key]\r\n      subSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCurveDrawSet }\r\n","/* eslint-disable camelcase */\r\nimport { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL evaluate CAD curve shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateCADCurveShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate CAD curve shader.\r\n   * @param {any} gl - The gl value.\r\n   * @ignore\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateCADCurveShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 patchCoords;         // where the values will be written to in the target texture.\r\ninstancedattribute vec2 curveDataCoords;     // where the data will come from in the source texture\r\n\r\nuniform ivec2 curvesAtlasTextureSize;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_geomDataCoords;\r\nvarying vec2 v_patchSize;\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  vec2 patchPos = patchCoords.xy;\r\n  v_patchSize = patchCoords.zw;\r\n\r\n  v_geomDataCoords = curveDataCoords;\r\n  v_vertexCoord = (positions.xy + 0.5) * v_patchSize;\r\n\r\n  vec2 pos = (patchPos + v_vertexCoord) / vec2(curvesAtlasTextureSize);\r\n  gl_Position =  vec4((pos - 0.5) * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateCADCurveShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_geomDataCoords;\r\nvarying vec2 v_patchSize;\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\nstruct PosNorm {\r\n  vec3 pos;\r\n  vec3 normal;\r\n  int geomType;\r\n};\r\n\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLCADCurves.glsl\"/>\r\n<%include file=\"GLSLNURBS.glsl\"/>\r\n<%include file=\"GLSLNURBSCurves.glsl\"/>\r\n\r\nuniform sampler2D curveDataTexture;\r\nuniform ivec2 curveDataTextureSize;\r\nuniform int writeTangents;\r\n\r\nPosNorm evalCADCurves(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  // PosNorm result;\r\n  // result.pos = vec3(float(geomType));\r\n  // // fragColor = reader.buffer;\r\n  // // fragColor = vec4(float(reader.textureSize.x), float(reader.textureSize.y), float(geomType), 1.0);\r\n  // return result;\r\n\r\n\r\n  if(geomType == CURVE_TYPE_LINE) {\r\n      return calcLinePoint(params.x, reader, texture);\r\n  } \r\n  if(geomType == CURVE_TYPE_CIRCLE) {\r\n      return calcCirclePoint(params.x, reader, texture);\r\n  } \r\n  if(geomType == CURVE_TYPE_ELIPSE) {\r\n      return calcElipsePoint(params.x, reader, texture);\r\n  }\r\n  if(geomType == CURVE_TYPE_NURBS_CURVE) {\r\n      return calcNURBSCurve3dPoint(params.x, reader, texture);\r\n  } \r\n  \r\n  PosNorm detault;\r\n  return detault;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n\r\n  // Evaluate the curve per vertex\r\n\r\n  // compute exact xy coords per pixel by rounding the vertex coord to the nearest integer and then dividing my patch size.\r\n  // The interpollated xy coords from the quad are not exact because the quad must cover the pixels with some margin.\r\n\r\n  // The quad overlaps the pixels by half a pixel, so \r\n  vec2 params = vec2(floor(v_vertexCoord.x), floor(v_vertexCoord.y));\r\n  if(v_patchSize.x > 1.0)\r\n      params.x /= v_patchSize.x - 1.0;\r\n  // if(v_patchSize.y > 1.0)\r\n  //     params.y /= v_patchSize.y - 1.0;\r\n\r\n  ivec4 region = ivec4(0, 0, curveDataTextureSize.x, curveDataTextureSize.y);\r\n  ivec2 start = ivec2(int(v_geomDataCoords.x), int(v_geomDataCoords.y));\r\n\r\n  GLSLBinReader reader;\r\n  GLSLBinReader_init(reader, curveDataTextureSize, region, start, 32);\r\n  PosNorm posNorm = evalCADCurves(params, reader, curveDataTexture);\r\n\r\n  if(writeTangents == 1) {\r\n      fragColor = vec4(posNorm.normal, 1.0);\r\n  }\r\n  else {\r\n      fragColor = vec4(posNorm.pos, 1.0);\r\n  }\r\n  // fragColor = vec4(params.x, params.y, 0.0, 1.0);\r\n  // gl_FragData[0] = vec4(posNorm.pos, 1.0);\r\n  // gl_FragData[1] = vec4(posNorm.normal, 1.0);\r\n\r\n  // fragColor.r = v_geomDataCoords.x;\r\n  // fragColor.g = v_geomDataCoords.y;\r\n  // fragColor.b = float(curveDataTextureSize.x);\r\n  // fragColor.a = float(curveDataTextureSize.y);\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nRegistry.register('GLEvaluateCADCurveShader', GLEvaluateCADCurveShader)\r\n\r\nexport { GLEvaluateCADCurveShader }\r\n","import { GLTexture2D, GLRenderTarget } from '@zeainc/zea-engine'\r\nimport { valuesPerCurveLibraryLayoutItem } from './CADConstants.js'\r\nimport { GLEvaluateCADCurveShader } from './GLEvaluateCADCurveShader.js'\r\n\r\n/** Class representing a GL curve library.\r\n * @ignore\r\n */\r\nclass GLCurveLibrary {\r\n  /**\r\n   * Create a GL curve library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} surfacesLibrary - The surfacesLibrary value.\r\n   * @param {any} version - The version object.\r\n   */\r\n  constructor(gl, cadpassdata, surfacesLibrary, version) {\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__surfacesLibrary = surfacesLibrary\r\n    this.cadDataVersion = version\r\n\r\n    const curvesDataBuffer = this.__surfacesLibrary.getCurveBuffer()\r\n    const curveTexSize = Math.sqrt(curvesDataBuffer.byteLength / 8)\r\n\r\n    this.__curveDataTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'HALF_FLOAT',\r\n      width: curveTexSize,\r\n      height: curveTexSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: new Uint16Array(curvesDataBuffer),\r\n    })\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Curves\r\n\r\n  /**\r\n   * The evaluateCurves method.\r\n   * @param {any} curvesAtlasLayout - The curvesAtlasLayout param.\r\n   * @param {any} numCurves - The numCurves param.\r\n   * @param {any} curvesAtlasLayoutTextureSize - The curvesAtlasLayoutTextureSize param.\r\n   * @param {any} curvesAtlasTextureDim - The curvesAtlasTextureDim param.\r\n   */\r\n  evaluateCurves(curvesAtlasLayout, numCurves, curvesAtlasLayoutTextureSize, curvesAtlasTextureDim) {\r\n    // console.log(\"evaluateCurves:\" + assetId + \":\" + curvesAtlasTextureDim);\r\n\r\n    const count = numCurves\r\n    if (count == 0) return\r\n\r\n    const gl = this.__gl\r\n    {\r\n      this.__curveAtlasLayoutTexture = new GLTexture2D(this.__gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasLayoutTextureSize[0],\r\n        height: curvesAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: curvesAtlasLayout,\r\n      })\r\n    }\r\n\r\n    if (!this.__curvesAtlasRenderTarget) {\r\n      this.__curvesAtlasRenderTarget = new GLRenderTarget(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasTextureDim[0],\r\n        height: curvesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__curvesTangentAtlasRenderTarget = new GLRenderTarget(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: curvesAtlasTextureDim[0],\r\n        height: curvesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n    } else if (\r\n      this.__curvesAtlasRenderTarget.width != curvesAtlasTextureDim[0] ||\r\n      this.__curvesAtlasRenderTarget.height != curvesAtlasTextureDim[1]\r\n    ) {\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__curvesAtlasRenderTarget.resize(curvesAtlasTextureDim[0], curvesAtlasTextureDim[1], true)\r\n    }\r\n\r\n    const renderstate = {\r\n      shaderopts: {\r\n        directives: [...gl.shaderopts.directives],\r\n      },\r\n    }\r\n    this.__curvesAtlasRenderTarget.bindForWriting(renderstate, true)\r\n\r\n    if (this.cadDataVersion.compare([0, 0, 0]) > 0) {\r\n      renderstate.shaderopts.directives.push('#define EXPORT_KNOTS_AS_DELTAS 1')\r\n    }\r\n    if (this.cadDataVersion.compare([0, 0, 26]) > 0) {\r\n      renderstate.shaderopts.directives.push('#define INTS_PACKED_AS_2FLOAT16 1')\r\n    }\r\n\r\n    if (!this.evaluateCurveShader) {\r\n      this.evaluateCurveShader = new GLEvaluateCADCurveShader(gl)\r\n    }\r\n\r\n    this.evaluateCurveShader.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.uniform2i(\r\n      unifs.curvesAtlasTextureSize.location,\r\n      this.__curvesAtlasRenderTarget.width,\r\n      this.__curvesAtlasRenderTarget.height\r\n    )\r\n\r\n    this.__curveDataTexture.bindToUniform(renderstate, unifs.curveDataTexture)\r\n    gl.uniform2i(unifs.curveDataTextureSize.location, this.__curveDataTexture.width, this.__curveDataTexture.height)\r\n\r\n    const buffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, curvesAtlasLayout, gl.STATIC_DRAW)\r\n\r\n    this.__bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, valuesPerCurveLibraryLayoutItem * 4, 0)\r\n    this.__bindAttr(attrs.curveDataCoords.location, 2, gl.FLOAT, valuesPerCurveLibraryLayoutItem * 4, 4 * 4)\r\n\r\n    // //////////////////////////////////////////////\r\n    // Bind each Fbo and render separately.\r\n    // Bizzarly, this has turned out to be much faster\r\n    // than using mutiple render targets...\r\n    gl.uniform1i(unifs.writeTangents.location, 0)\r\n\r\n    this.__cadpassdata.glplanegeom.drawInstanced(count)\r\n\r\n    this.__curvesTangentAtlasRenderTarget.bindForWriting(renderstate, true)\r\n\r\n    gl.uniform1i(unifs.writeTangents.location, 1)\r\n    this.__cadpassdata.glplanegeom.drawInstanced(count)\r\n    // //////////////////////////////////////////////\r\n\r\n    gl.deleteBuffer(buffer)\r\n\r\n    const logCurveData = (curveId) => {\r\n      this.__curvesAtlasRenderTarget.bindForReading()\r\n      const layout = [\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 0],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 1],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 2],\r\n        curvesAtlasLayout[curveId * valuesPerCurveLibraryLayoutItem + 3],\r\n      ]\r\n      console.log('----------------------------------')\r\n      console.log('logCurveData ' + curveId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3])\r\n      const pixels = new Float32Array(layout[2] * 4)\r\n      for (let i = 0; i < layout[3]; i++) {\r\n        gl.readPixels(layout[0], layout[1] + i, layout[2], 1, gl.RGBA, gl.FLOAT, pixels)\r\n        for (let j = 0; j < layout[2]; j++) {\r\n          console.log(j, ':', pixels[j * 4 + 0], pixels[j * 4 + 1], pixels[j * 4 + 2], pixels[j * 4 + 3])\r\n        }\r\n        // console.log(i+\":\" + pixels);\r\n      }\r\n    }\r\n    // console.log(\"----------------------------------\");\r\n    // logCurveData(35799)\r\n    // logCurveData(1)\r\n    // console.log(\"----------------------------------\");\r\n\r\n    this.__curvesTangentAtlasRenderTarget.unbind()\r\n    gl.finish()\r\n  }\r\n\r\n  /**\r\n   * The bindCurvesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindCurvesAtlasLayout(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (this.__curvesAtlasRenderTarget) {\r\n      if (unifs.curvesAtlasLayoutTexture) {\r\n        this.__curveAtlasLayoutTexture.bindToUniform(renderstate, unifs.curvesAtlasLayoutTexture)\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasLayoutTextureSize.location,\r\n          this.__curveAtlasLayoutTexture.width,\r\n          this.__curveAtlasLayoutTexture.height\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindCurvesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindCurvesAtlas(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (this.__curvesAtlasRenderTarget) {\r\n      this.__curvesAtlasRenderTarget.bindColorTexture(renderstate, unifs.curvesAtlasTexture)\r\n\r\n      if (unifs.curveTangentsTexture) {\r\n        this.__curvesTangentAtlasRenderTarget.bindColorTexture(renderstate, unifs.curveTangentsTexture)\r\n      }\r\n      if (unifs.curvesAtlasTextureSize) {\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasTextureSize.location,\r\n          this.__curvesAtlasRenderTarget.width,\r\n          this.__curvesAtlasRenderTarget.height\r\n        )\r\n      }\r\n\r\n      if (unifs.curvesAtlasLayoutTexture) {\r\n        this.__curveAtlasLayoutTexture.bindToUniform(renderstate, unifs.curvesAtlasLayoutTexture)\r\n        gl.uniform2i(\r\n          unifs.curvesAtlasLayoutTextureSize.location,\r\n          this.__curveAtlasLayoutTexture.width,\r\n          this.__curveAtlasLayoutTexture.height\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__curveDataTexture.destroy()\r\n    if (this.__curveAtlasLayoutTexture) {\r\n      this.__curveAtlasLayoutTexture.destroy()\r\n      this.__curvesAtlasRenderTarget.destroy()\r\n      this.__curvesTangentAtlasRenderTarget.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCurveLibrary }\r\n","// import {\r\n//     Vec2,\r\n//     Vec3,\r\n//     Quat,\r\n//     Color,\r\n//     Box2,\r\n//     Box3\r\n// } from '../Math';\r\n\r\nconst decode16BitFloat = (h) => {\r\n  const s = (h & 0x8000) >> 15\r\n  const e = (h & 0x7c00) >> 10\r\n  const f = h & 0x03ff\r\n\r\n  if (e == 0) {\r\n    return (s ? -1 : 1) * Math.pow(2, -14) * (f / Math.pow(2, 10))\r\n  } else if (e == 0x1f) {\r\n    return f ? NaN : (s ? -1 : 1) * Infinity\r\n  }\r\n\r\n  return (s ? -1 : 1) * Math.pow(2, e - 15) * (1 + f / Math.pow(2, 10))\r\n}\r\n\r\n/** Class representing a bin reader.\r\n * @ignore\r\n */\r\nclass BinReader {\r\n  /**\r\n   * Create a bin reader.\r\n   * @param {Buffer} data - The data buffer.\r\n   * @param {number} byteOffset - The byte offset value to start reading the buffer.\r\n   * @param {boolean} isMobileDevice - The isMobileDevice value.\r\n   */\r\n  constructor(data, byteOffset = 0, isMobileDevice = true) {\r\n    this.__data = data\r\n    this.__byteOffset = byteOffset\r\n    this.__dataView = new DataView(this.__data)\r\n    this.__isMobileDevice = isMobileDevice\r\n    this.utf8decoder = new TextDecoder()\r\n  }\r\n\r\n  /**\r\n   * Getter for isMobileDevice.\r\n   * @return {Boolean} - Returns true is a mobile device is detected.\r\n   */\r\n  get isMobileDevice() {\r\n    return this.__isMobileDevice\r\n  }\r\n\r\n  /**\r\n   * Getter for data.\r\n   * @return {Buffer} - The data buffer we are reading from,\r\n   */\r\n  get data() {\r\n    return this.__data\r\n  }\r\n\r\n  /**\r\n   * Getter for byteLength.\r\n   * @return {number} - The total length of the buffer\r\n   */\r\n  get byteLength() {\r\n    return this.__dataView.byteLength\r\n  }\r\n\r\n  /**\r\n   * Getter for remainingByteLength.\r\n   * @return {number} - The reemaining length of the buffer to read.\r\n   */\r\n  get remainingByteLength() {\r\n    return this.__dataView.byteLength - this.__byteOffset\r\n  }\r\n\r\n  /**\r\n   * The pos method.\r\n   * @return {number} - The current offset in the binary buffer\r\n   */\r\n  pos() {\r\n    return this.__byteOffset\r\n  }\r\n\r\n  /**\r\n   * The seek method.\r\n   * @param {number} byteOffset - The byteOffset param.\r\n   */\r\n  seek(byteOffset) {\r\n    this.__byteOffset = byteOffset\r\n  }\r\n\r\n  /**\r\n   * The advance method.\r\n   * @param {number} byteOffset - The byte Offset amount.\r\n   */\r\n  advance(byteOffset) {\r\n    this.__byteOffset += byteOffset\r\n  }\r\n\r\n  /**\r\n   * The loadUInt8 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt8() {\r\n    const result = this.__dataView.getUint8(this.__byteOffset)\r\n    this.__byteOffset += 1\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt16 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt16() {\r\n    const result = this.__dataView.getUint16(this.__byteOffset, true)\r\n    this.__byteOffset += 2\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt32 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt32() {\r\n    const result = this.__dataView.getUint32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadSInt32 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadSInt32() {\r\n    const result = this.__dataView.getInt32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat16 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadFloat16() {\r\n    const uint16 = this.loadUInt16()\r\n    return decode16BitFloat(uint16)\r\n  }\r\n\r\n  /**\r\n   * The loadUFloat16 returns a float where the sign big indicates it is > 201.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUFloat16() {\r\n    const result = this.loadFloat16()\r\n    if (result < 0.0) {\r\n      return 2048.0 - result // Note: subtract a negative number to add it.\r\n    } else {\r\n      return result\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The loadFloat16From2xUInt8 method.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadFloat16From2xUInt8() {\r\n    const result = this.__dataView.getFloat16(this.__byteOffset, true)\r\n    // const uint8s = this.loadUInt8Array(2);\r\n    // return decode16BitFloat(uint8s);\r\n    this.__byteOffset += 2\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt32From2xUFloat16 loads a single Signed integer value from 2 Unsigned Float16 values.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadUInt32From2xUFloat16() {\r\n    const partA = this.loadUFloat16()\r\n    const partB = this.loadUFloat16()\r\n    return partA + partB * 4096\r\n  }\r\n\r\n  /**\r\n   * The loadSInt32From2xFloat16 loads a single Signed integer value from 2 signed Float16 values.\r\n   * @return {number} - The return value.\r\n   */\r\n  loadSInt32From2xFloat16() {\r\n    const partA = this.loadFloat16()\r\n    const partB = this.loadFloat16()\r\n    return partA + partB * 2048\r\n  }\r\n\r\n  /**\r\n   * The loadFloat32 method.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadFloat32() {\r\n    const result = this.__dataView.getFloat32(this.__byteOffset, true)\r\n    this.__byteOffset += 4\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat32 method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt8Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    const result = new Uint8Array(this.__data, this.__byteOffset, size)\r\n    this.__byteOffset += size\r\n    const padd = this.__byteOffset % 4\r\n    // this.readPadd();\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt16Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt16Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Uint16Array()\r\n    this.readPadd(2)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Uint16Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getUint16(this.__byteOffset, true)\r\n        this.__byteOffset += 2\r\n      }\r\n    } else {\r\n      result = new Uint16Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 2\r\n    }\r\n    // this.readPadd();\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadUInt32Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadUInt32Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Uint32Array()\r\n    this.readPadd(4)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Uint32Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getUint32(this.__byteOffset, true)\r\n        this.__byteOffset += 4\r\n      }\r\n    } else {\r\n      result = new Uint32Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 4\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadFloat32Array method.\r\n   * @param {any} size - The size param.\r\n   * @param {boolean} clone - The clone param.\r\n   * @return {any} - The return value.\r\n   */\r\n  loadFloat32Array(size = undefined, clone = false) {\r\n    if (size == undefined) size = this.loadUInt32()\r\n    if (size == 0) return new Float32Array()\r\n    this.readPadd(4)\r\n    let result\r\n    if (this.__isMobileDevice) {\r\n      result = new Float32Array(size)\r\n      for (let i = 0; i < size; i++) {\r\n        result[i] = this.__dataView.getFloat32(this.__byteOffset, true)\r\n        this.__byteOffset += 4\r\n      }\r\n    } else {\r\n      result = new Float32Array(this.__data, this.__byteOffset, size)\r\n      this.__byteOffset += size * 4\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadStr method.\r\n   * @return {string} - The return value.\r\n   */\r\n  loadStr() {\r\n    const numChars = this.loadUInt32()\r\n    const chars = new Uint8Array(this.__data, this.__byteOffset, numChars)\r\n    this.__byteOffset += numChars\r\n    let result = ''\r\n    for (let i = 0; i < numChars; i++) result = result + String.fromCharCode(chars[i])\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * The loadStrArray method.\r\n   * @return {array} - The return value.\r\n   */\r\n  loadStrArray() {\r\n    const size = this.loadUInt32()\r\n    const result = []\r\n    for (let i = 0; i < size; i++) {\r\n      result[i] = this.loadStr()\r\n    }\r\n    return result\r\n  }\r\n\r\n  // loadSInt32Vec2() {\r\n  //     const x = this.loadSInt32();\r\n  //     const y = this.loadSInt32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadUInt32Vec2() {\r\n  //     const x = this.loadUInt32();\r\n  //     const y = this.loadUInt32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat16Vec2() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat32Vec2() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     return new Vec2(x, y);\r\n  // }\r\n\r\n  // loadFloat16Vec3() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     const z = this.loadFloat16();\r\n  //     return new Vec3(x, y, z);\r\n  // }\r\n\r\n  // loadFloat32Vec3() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     const z = this.loadFloat32();\r\n  //     return new Vec3(x, y, z);\r\n  // }\r\n\r\n  // loadFloat16Quat() {\r\n  //     const x = this.loadFloat16();\r\n  //     const y = this.loadFloat16();\r\n  //     const z = this.loadFloat16();\r\n  //     const w = this.loadFloat16();\r\n  //     return new Quat(x, y, z, w);\r\n  // }\r\n\r\n  // loadFloat32Quat() {\r\n  //     const x = this.loadFloat32();\r\n  //     const y = this.loadFloat32();\r\n  //     const z = this.loadFloat32();\r\n  //     const w = this.loadFloat32();\r\n  //     return new Quat(x, y, z, w);\r\n  // }\r\n\r\n  // loadRGBFloat32Color() {\r\n  //     const r = this.loadFloat32();\r\n  //     const g = this.loadFloat32();\r\n  //     const b = this.loadFloat32();\r\n  //     return new Color(r, g, b);\r\n  // }\r\n\r\n  // loadRGBAFloat32Color() {\r\n  //     const r = this.loadFloat32();\r\n  //     const g = this.loadFloat32();\r\n  //     const b = this.loadFloat32();\r\n  //     const a = this.loadFloat32();\r\n  //     return new Color(r, g, b, a);\r\n  // }\r\n\r\n  // loadRGBUInt8Color() {\r\n  //     const r = this.loadUInt8();\r\n  //     const g = this.loadUInt8();\r\n  //     const b = this.loadUInt8();\r\n  //     return new Color(r / 255, g / 255, b / 255);\r\n  // }\r\n\r\n  // loadRGBAUInt8Color() {\r\n  //     const r = this.loadUInt8();\r\n  //     const g = this.loadUInt8();\r\n  //     const b = this.loadUInt8();\r\n  //     const a = this.loadUInt8();\r\n  //     return new Color(r / 255, g / 255, b / 255, a / 255);\r\n  // }\r\n\r\n  // loadBox2() {\r\n  //     return new Box2(this.loadFloat32Vec2(), this.loadFloat32Vec2());\r\n  // }\r\n\r\n  // loadBox3() {\r\n  //     return new Box3(this.loadFloat32Vec3(), this.loadFloat32Vec3());\r\n  // }\r\n\r\n  /**\r\n   * The loadStr method.\r\n   * @param {any} stride - The stride param.\r\n   */\r\n  readPadd(stride) {\r\n    const padd = this.__byteOffset % stride\r\n    if (padd != 0) this.__byteOffset += stride - padd\r\n  }\r\n}\r\n\r\nexport { BinReader }\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLBinReader.glsl',\r\n  `\r\n\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n\r\n/////////////////////////////////////////////////////////////////\r\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\r\n// Note: modulo on some GPUS. (e.g. iPhone)\r\n// often incur errors in modulo, leaving a result\r\n// that appears to boe the y param. in this use case\r\n// we are only interested in integer moduos anyway\r\n// so we just trim off erronious values. .Seems to work. \r\nfloat fixed_mod(float x, float y) {\r\n  float res = mod(x, y);\r\n  return (abs(y - res) < 0.5) ? 0.0 : res;\r\n}\r\n\r\nfloat shift_right(float v, float amt) {\r\n  v = floor(v) + 0.5;\r\n  return floor(v / exp2(amt));\r\n}\r\n\r\nfloat shift_left(float v, float amt) {\r\n  return floor(v * exp2(amt) + 0.5);\r\n}\r\n\r\nfloat mask_last(float v, float bits) {\r\n  return fixed_mod(v, shift_left(1.0, bits));\r\n}\r\n\r\nfloat extract_bits(float num, float from, float to) {\r\n  from = floor(from + 0.5);\r\n  to = floor(to + 0.5);\r\n  return mask_last(shift_right(num, from), to - from);\r\n}\r\n\r\n\r\n/////////////////////////////////////////////////////////////////\r\n\r\nfloat decode16BitFloatFrom2xUInt8_IEEE(vec2 c){\r\n  float v = 0.;\r\n\r\n  // int h = c.x + c.y * 256;\r\n  // const s = (h & 0x8000) >> 15;\r\n  // const e = (h & 0x7C00) >> 10;\r\n  // const f = h & 0x03FF;\r\n\r\n\r\n  // float h = c.x + c.y * 256.0;\r\n  // float s = extract_bits(h, 15.0, 16.0);\r\n  // float e = extract_bits(h, 10.0, 15.0);\r\n  // float f = extract_bits(h, 0.0, 10.0);\r\n\r\n  // float s = extract_bits(c.y, 7.0, 8.0);\r\n  // float e = extract_bits(c.y, 2.0, 7.0);\r\n\r\n  int s = (c.y >= 127.5) ? 1 : 0;\r\n  float e = shift_right(c.y - ((s == 1) ? 128.0 : 0.0), 2.0);\r\n  float f = c.x + mask_last(c.y, 2.0) * 256.0;\r\n  // return float(s);\r\n\r\n  if(e < 0.5) {\r\n    return ((s!=0)?-1.0:1.0) * exp2(-14.0) * (f/exp2(10.0));\r\n  } else if (int(e) == 0x1F) {\r\n    float NaN = 0.0;\r\n    float Inf = 0.0;\r\n    return (f==0.0)?(NaN):(((s!=0)?-1.0:1.0)*Inf);\r\n  }\r\n\r\n  return ((s!=0)?-1.0:1.0) * exp2(e-15.0) * (1.0+(f/exp2(10.0)));\r\n}\r\n\r\n#endif\r\n\r\n// RGBA16 textures\r\nvec4 GLSLBinReader_texelFetch2D(sampler2D texture, ivec2 textureSize, ivec2 address) {\r\n  return fetchTexel(texture, textureSize, address);\r\n}\r\n\r\nstruct GLSLBinReader {\r\n  ivec2 textureSize; \r\n  ivec4 region;\r\n  ivec2 start; /* the base address from which we base the offsets */\r\n  int offset; /* how far we have read into the buffer . Note: value is in channels. so 4 == 1 pixel.*/\r\n  vec4 buffer; \r\n  ivec2 bufferaddress;\r\n  int bpc; // bits per channel. (e.g. 8, 16, 32)\r\n};\r\n\r\nvoid GLSLBinReader_init(inout GLSLBinReader reader, ivec2 textureSize, ivec4 region, ivec2 start, int bpc) {\r\n  reader.textureSize = textureSize;\r\n  reader.region = region;\r\n  reader.start = start;\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n  reader.start = ivec2(start.x * 2, start.y);\r\n#else\r\n  reader.start = start;\r\n#endif\r\n  reader.bpc = bpc;\r\n  reader.bufferaddress = ivec2(-1, -1);\r\n}\r\n\r\nvoid GLSLBinReader_init(inout GLSLBinReader reader, ivec2 textureSize, int bpc) {\r\n  reader.textureSize = textureSize;\r\n  reader.region = ivec4(0, 0, textureSize.x, textureSize.y);\r\n  reader.start = ivec2(0,0);\r\n  reader.bpc = bpc;\r\n  reader.bufferaddress = ivec2(-1, -1);\r\n}\r\n\r\n\r\nivec2 GLSLBinReader_getAddress(in GLSLBinReader reader, int offset) {\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n  ivec2 address = ivec2(reader.start.x + (offset/2), reader.start.y);\r\n#else\r\n  ivec2 address = ivec2(reader.start.x + (offset/4), reader.start.y);\r\n#endif\r\n  address.y += address.x / reader.region.z;\r\n  address.x = imod(address.x, reader.region.z);\r\n  return address;\r\n}\r\n\r\n\r\nfloat GLSLBinReader_readFloat(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n\r\n  ivec2 address = GLSLBinReader_getAddress(reader, offset);\r\n\r\n  if(address != reader.bufferaddress){\r\n    reader.buffer = GLSLBinReader_texelFetch2D(texture, reader.textureSize, reader.region.xy + address);\r\n    reader.bufferaddress = address;\r\n  }\r\n\r\n#ifdef DECODE_16BIT_FLOAT_FROM_8BIT_INT\r\n\r\n  int swizelIndex = imod(offset, 2);\r\n  if(swizelIndex == 0)\r\n    return decode16BitFloatFrom2xUInt8_IEEE(reader.buffer.xy * 255.0);\r\n  return decode16BitFloatFrom2xUInt8_IEEE(reader.buffer.zw * 255.0);\r\n\r\n#else\r\n\r\n  int swizelIndex = imod(offset, 4);\r\n  if(swizelIndex == 0)\r\n    return reader.buffer.x;\r\n  if(swizelIndex == 1)\r\n    return reader.buffer.y;\r\n  if(swizelIndex == 2)\r\n    return reader.buffer.z;\r\n  return reader.buffer.w;\r\n  \r\n#endif\r\n}\r\n\r\n\r\nint GLSLBinReader_readInt(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture, offset) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture, offset);\r\n    return int(flt);\r\n  }\r\n}\r\n\r\nint GLSLBinReader_readUInt(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture, offset) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture, offset);\r\n    if (flt < 0.0) {\r\n      return int(2048.0 - flt);\r\n    }\r\n    else {\r\n      return int(flt);\r\n    }\r\n  }\r\n}\r\n\r\nvec4 GLSLBinReader_readVec4(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  ivec2 address = GLSLBinReader_getAddress(reader, offset);\r\n  return GLSLBinReader_texelFetch2D(texture, reader.textureSize, reader.region.xy + address);\r\n}\r\n\r\n\r\nvec3 GLSLBinReader_readVec3(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  return GLSLBinReader_readVec4(reader, texture, offset).rgb;\r\n}\r\n\r\nvec2 GLSLBinReader_readVec2(inout GLSLBinReader reader, sampler2D texture, int offset) {\r\n  return vec2(\r\n    GLSLBinReader_readFloat(reader, texture, offset),\r\n    GLSLBinReader_readFloat(reader, texture, offset+1)\r\n  );\r\n}\r\n\r\n\r\n\r\nfloat GLSLBinReader_readFloat(inout GLSLBinReader reader, sampler2D texture) {\r\n  float result = GLSLBinReader_readFloat( reader,  texture, reader.offset);\r\n  reader.offset++;\r\n  return result;\r\n}\r\n\r\nint GLSLBinReader_readInt(inout GLSLBinReader reader, sampler2D texture) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture) * 255.0);\r\n  else\r\n    return int(GLSLBinReader_readFloat(reader, texture));\r\n}\r\n\r\nint GLSLBinReader_readUInt(inout GLSLBinReader reader, sampler2D texture) {\r\n  if(reader.bpc == 8)\r\n    return int(GLSLBinReader_readFloat(reader, texture) * 255.0);\r\n  else {\r\n    float flt = GLSLBinReader_readFloat(reader, texture);\r\n    if (flt < 0.0) {\r\n      return int(2048.0 - flt);\r\n    }\r\n    else {\r\n      return int(flt);\r\n    }\r\n  }\r\n}\r\n\r\nint GLSLBinReader_readUIntFrom2xUFloat16(inout GLSLBinReader reader, sampler2D texture) {\r\n  int partA = GLSLBinReader_readUInt(reader, texture);\r\n  int partB = GLSLBinReader_readUInt(reader, texture);\r\n  \r\n#ifdef INTS_PACKED_AS_2FLOAT16\r\n  // Changed on version 0.0.28\r\n  return partA + (partB * 4096);\r\n#else\r\n  return partA + (partB * 256);\r\n#endif\r\n}\r\n\r\nvec4 GLSLBinReader_readVec4(inout GLSLBinReader reader, sampler2D texture) {\r\n  vec4 result = GLSLBinReader_readVec4( reader, texture, reader.offset);\r\n  reader.offset += 4;\r\n  return result;\r\n}\r\n\r\n\r\nvec3 GLSLBinReader_readVec3(inout GLSLBinReader reader, sampler2D texture) {\r\n  return GLSLBinReader_readVec4(reader, texture).rgb;\r\n}\r\n\r\nvec2 GLSLBinReader_readVec2(inout GLSLBinReader reader, sampler2D texture) {\r\n  return vec2(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLMath.glsl',\r\n  `\r\n\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n\r\n  ////////////////////////////////////////\r\n  \r\n  struct Xfo2d {\r\n    vec2 tr;\r\n    float rot;\r\n    vec2 sc;\r\n  };\r\n\r\n  vec2 rotateVec2(float rot, vec2 vec){\r\n    float cosa = cos(rot);\r\n    float sina = sin(rot);\r\n    return vec2(vec.x * cosa - vec.y * sina, vec.x * sina + vec.y * cosa);\r\n  }\r\n\r\n  vec2 Xfo2D_transformVec2(Xfo2d xfo2d, vec2 pos){\r\n    return xfo2d.tr + rotateVec2(xfo2d.rot, pos * xfo2d.sc);\r\n  }\r\n\r\n  ////////////////////////////////////////\r\n\r\n\r\n  vec4 quat_fromAxisAndAngle(vec3 axis, float angle) {\r\n    float halfAngle = angle / 2.0;\r\n    vec3 vec = axis* sin(halfAngle);\r\n    return vec4(vec.x, vec.y, vec.z, cos(halfAngle));\r\n  }\r\n\r\n  vec4 quat_conjugate(vec4 quat) {\r\n    return vec4(-quat.x, -quat.y, -quat.z, quat.w);\r\n  }\r\n\r\n  vec4 quat_multiply(vec4 lhs, vec4 rhs) {\r\n    float ax = lhs.x;\r\n    float ay = lhs.y;\r\n    float az = lhs.z;\r\n    float aw = lhs.w;\r\n    float bx = rhs.x;\r\n    float by = rhs.y;\r\n    float bz = rhs.z;\r\n    float bw = rhs.w;\r\n    return vec4(\r\n      ax * bw + aw * bx + ay * bz - az * by,\r\n      ay * bw + aw * by + az * bx - ax * bz,\r\n      az * bw + aw * bz + ax * by - ay * bx,\r\n      aw * bw - ax * bx - ay * by - az * bz\r\n    );\r\n  }\r\n\r\n  vec3 quat_rotateVec3(vec4 quat, vec3 rhs) {\r\n    vec4 vq = vec4(rhs.x, rhs.y, rhs.z, 0.0);\r\n    vec4 pq = quat_multiply(quat_multiply(quat, vq), quat_conjugate(quat));\r\n    return vec3(pq.x, pq.y, pq.z);\r\n  }\r\n\r\n\r\n  mat4 tr_toMat4(vec3 tr) {\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    vec4 col0 = vec4(1.0, 0.0, 0.0, 0.0);\r\n    vec4 col1 = vec4(0.0, 1.0, 0.0, 0.0);\r\n    vec4 col2 = vec4(0.0, 0.0, 1.0, 0.0);\r\n    vec4 col3 = vec4(tr, 1.0);\r\n    return mat4(col0, col1, col2, col3);\r\n  }\r\n\r\n  mat4 quat_toMat4(vec4 quat) {\r\n\r\n    float x2 = quat.x + quat.x;\r\n    float y2 = quat.y + quat.y;\r\n    float z2 = quat.z + quat.z;\r\n\r\n    float xx = quat.x * x2;\r\n    float yx = quat.y * x2;\r\n    float yy = quat.y * y2;\r\n    float zx = quat.z * x2;\r\n    float zy = quat.z * y2;\r\n    float zz = quat.z * z2;\r\n    float wx = quat.w * x2;\r\n    float wy = quat.w * y2;\r\n    float wz = quat.w * z2;\r\n\r\n\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    vec4 col0 = vec4(\r\n      1.0 - yy - zz,\r\n      yx - wz,\r\n      zx + wy,\r\n      0.0);\r\n\r\n    vec4 col1 = vec4(\r\n      yx + wz,\r\n      1.0 - xx - zz,\r\n      zy - wx,\r\n      0.0);\r\n\r\n    vec4 col2 = vec4(\r\n      zx - wy,\r\n      zy + wx,\r\n      1.0 - xx - yy,\r\n      0.0);\r\n\r\n    vec4 col3 = vec4(\r\n      0.0,\r\n      0.0,\r\n      0.0,\r\n      1.0);\r\n\r\n    // return mat4(col0, col1, col2, col3);\r\n    return transpose(mat4(col0, col1, col2, col3));\r\n  }\r\n\r\n  mat4 sc_toMat4(vec3 sc) {\r\n    // Note: GLSL matrices are transposed compared to the matrices in ZeaEngine\r\n    return mat4(\r\n      sc.x, 0.0,  0.0,  0.0,\r\n      0.0,  sc.y, 0.0,  0.0,\r\n      0.0,  0.0,  sc.z, 0.0,\r\n      0.0,  0.0,  0.0,  1.0);\r\n  }\r\n\r\n  struct Xfo {\r\n    vec3 tr;\r\n    vec4 ori;\r\n    vec3 sc;\r\n  };\r\n\r\n  Xfo xfo_multiply(Xfo xfo, Xfo other){\r\n    return Xfo(\r\n      xfo.tr + quat_rotateVec3(xfo.ori, xfo.sc * other.tr),\r\n      quat_multiply(xfo.ori, other.ori),\r\n      xfo.sc * other.sc\r\n    );\r\n  }\r\n\r\n  mat4 xfo_toMat4(Xfo xfo){\r\n    mat4 sc_mat4 = sc_toMat4(xfo.sc);\r\n    mat4 ori_mat4  = quat_toMat4(xfo.ori);\r\n    mat4 tr_mat4  = tr_toMat4(xfo.tr);\r\n    mat4 result = tr_mat4 * ori_mat4 * sc_mat4;\r\n    return result;\r\n  }\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADCurves.glsl',\r\n  `\r\n\r\n  // http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_curves\r\n\r\n\r\n\r\n// http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_surfaces\r\n\r\n\r\nvec2 loadVec2(inout GLSLBinReader reader, sampler2D texture) {\r\n  return vec2(GLSLBinReader_readFloat(reader, texture),  GLSLBinReader_readFloat(reader, texture));\r\n}\r\n\r\nfloat mapDomain1d(vec2 domain, float param) {\r\n  float u = domain.x + param * ( domain.y - domain.x );\r\n  return u;\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Line\r\n\r\nPosNorm calcLinePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float u = mapDomain1d( domain, param );\r\n  vec3 pos = vec3(u, 0.0, 0.0);\r\n  vec3 norm = vec3(1.0, 0.0, 0.0);\r\n  return PosNorm(pos, norm, CURVE_TYPE_LINE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Circle\r\n\r\nPosNorm calcCirclePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float radius = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  float u = mapDomain1d( domain, param );\r\n  vec3 pos = vec3(cos(u) * radius, sin(u) * radius, 0.0);\r\n  vec3 norm = vec3(-sin(u), cos(u), 0.0);\r\n  return PosNorm(pos, norm, CURVE_TYPE_CIRCLE);\r\n}\r\n\r\n\r\n\r\n/////////////////////////////////////////\r\n// Elipse3d\r\n// An ellipse is a periodic curve parametrized as follows: C(t) = P + X * R_major * cos(t) + Y * R_minor * sin(t), where\r\n\r\n// P is an origin point,\r\n// X and Y are directions,\r\n// R_major and R_minor are major and minor radii,\r\n// t belongs to [0, 2 * PI].\r\n// Note that major radius is always along the X-axis and minor radius - along the Y-axis, and that with t=0 the point corresponds to a major radius.\r\n\r\n\r\nPosNorm calcElipsePoint(float param, inout GLSLBinReader reader, sampler2D texture) {\r\n  vec2 domain = loadVec2(reader, texture);\r\n  float u = mapDomain1d( domain, param );\r\n  float minorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float majorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  vec3 pos = vec3(cos(u) * majorRadius, sin(u) * minorRadius, 0.0);\r\n  vec3 norm = normalize(vec3(-sin(u) * majorRadius, cos(u) * minorRadius, 0.0)); // TODO: fix this broken line.\r\n\r\n  // pos = vec3(float(minorRadius));\r\n\r\n  return PosNorm(pos, norm, CURVE_TYPE_ELIPSE);\r\n}\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSimpleSurfaces.glsl',\r\n  `\r\n\r\n  // http://cadexchanger.com/download/sdk/doc/dev/html/sdk_data_model_geometry_topology.html#sdk_data_model_geometry_surfaces\r\n\r\n\r\n/////////////////////////////////////////\r\n// Plane\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcPlaneSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 pos = vec3(uv.x, uv.y, 0.0);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_PLANE);\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Poly Plane\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcPolyPlaneSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Domain does not need to be mapped in this case.\r\n  vec2 uv = params;\r\n  vec2 p0 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p1 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p2 = GLSLBinReader_readVec2(reader, texture);\r\n  vec2 p3 = GLSLBinReader_readVec2(reader, texture);\r\n\r\n  vec2 pos = mix(mix(p0, p1, uv.x), mix(p3, p2, uv.x), uv.y);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(vec3(pos, 0.0), normal, SURFACE_TYPE_POLY_PLANE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Fan\r\n// A plane is parametrized as follows: S(u,v) = P + u * dX + v * dY, where\r\n\r\n// P is an origin point,\r\n// dX and dY are directions (unit vectors) of X and Y axes respectively,\r\n// u, v belongs to (-Infinity, +Infinity).\r\n\r\nPosNorm calcFanSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Domain does not need to be mapped in this case.\r\n  vec2 uv = params;\r\n  // Skip forward 2 values for each vertex.\r\n  reader.offset += int(2.0 * floor(v_vertexCoord.x));\r\n  vec2 pos = GLSLBinReader_readVec2(reader, texture);\r\n  vec3 normal = vec3(0.0, 0.0, 1.0);\r\n\r\n  return PosNorm(vec3(pos, 0.0), normal, SURFACE_TYPE_FAN);\r\n}\r\n\r\n\r\n\r\n/////////////////////////////////////////\r\n// Cone\r\n// A conical surface is parametrized as follows: S(u,v) = P + r * cos(u) * Dx + r * sin(u) * Dy + v * cos() * Dz, where\r\n\r\n// P is an origin point,\r\n// Dx, Dy and Dz are directions (unit vectors) of X, Y and Z axes respectively,\r\n//  - semi-angle, i.e. an angle between Dz and any generatrix,\r\n// r = R + v * sin(), i.e. a radius of a circle at respective parameter v,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to (-infinity, +infinity).\r\n// U-parameter is an angle along the circle at a given parameter V and V-parameter is a length along the cone. Thus, U-isolines are lines and V-isoline are circles.\r\n\r\n// V-isoline at V=0 is a circle of radius R in the plane defined by an axis placement.\r\n\r\n// Conical surface contains both halfs of mathematical cone.\r\n\r\n// Conical surface is U-periodical with period 2 * PI. At a cone apex, r equals 0, hence V-parameter of an apex equals -R / sin()\r\n\r\n\r\nPosNorm calcConeSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n  float semiAngle = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  float r_at_v = r + v * sin(semiAngle);\r\n  vec3 pos = vec3(r_at_v * cos(u), r_at_v * sin(u), v * cos(semiAngle));\r\n  vec3 normal = normalize(vec3(cos(u)*cos(semiAngle), sin(u)*cos(semiAngle), -sin(semiAngle)));\r\n  return PosNorm(pos, normal, SURFACE_TYPE_CONE);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Cylinder\r\n// A cylindrical surface is parametrized as follows: S(u,v) = P + R * cos(u) * dX + R * sin(u) * dY + v * dZ, where\r\n\r\n// P is an origin point,\r\n// dX, dY and dZ are directions (unit vectors) of X, Y and Z axes respectively,\r\n// R is a radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to (-infinity, +infinity).\r\n\r\n\r\nPosNorm calcCylinderSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 normal = vec3(cos(uv.x), sin(uv.x), 0.0);\r\n  vec3 pos = r * normal + vec3(0.0, 0.0, uv.y);\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_CYLINDER);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Sphere\r\n// A spherical surface is parametrized as follows: S(u,v) = P + R * cos(v) * (cos(u) * Dx + sin(u) * Dy) + R * sin(v) * Dz, where\r\n\r\n// P is an origin point,\r\n// Dx, Dy and Dz are directions (unit vectors) of X, Y and Z axes respectively,\r\n// R is a radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to [-PI/2, +PI/2].\r\n// U-parameter is an angle of rotation around the Dz axis counterclockwise (i.e. similar to longitude on the Earth), and V-parameter is an angle between plane defined by an axis placement and line from P to a point on a sphere (i.e. latitude). Thus, U-isolines are semi-circles and V-isoline are circles.\r\n\r\n// V-isoline at V=0 is a circle of radius R in the plane defined by an axis placement. U-isoline at U=0 corresponds to a semi-circle from south to north pole.\r\n\r\n// Spherical surface is U-periodical with period 2 * PI.\r\n\r\n// If a face lies on a full spherical surface its boundary wire will contain two a degenerated edges corresponding to the south and north poles (V equals -PI/2 and PI/2 respectively), and a seam-edge.\r\n\r\n\r\nPosNorm calcSphereSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float r = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  vec3 normal = vec3(cos(v) * cos(u), cos(v) * sin(u), sin(v));\r\n  vec3 pos = r * normal;\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_SPHERE);\r\n}\r\n\r\n/////////////////////////////////////////\r\n// Torus\r\n\r\n// A toroidal surface is parametrized as follows: S(u,v) = (R1 + R2 * cos(v)) * (cos(u) * Dx + sin(u) * Dy) + R2 * sin(v) * Dz, where\r\n\r\n// R1 is a major radius,\r\n// R2 is a minor radius,\r\n// u belongs to [0, 2 * PI],\r\n// v belongs to [0, 2 * PI],\r\n// U-parameter is an angle when rotating around the Dz axis counterclockwise, and V-parameter is an angle in circular section at a given parameter U. Thus, U-isolines circles lying in the plane containing Z axis and V-isolines are circles in the planes perpendicular to Z axis.\r\n\r\n// V-isoline at V=0 is a circle of radius (R1 + R2) in the plane defined by an axis placement. U-isoline at U=0 is a circle of radius R2 in the plane containing Z and X axes.\r\n\r\n// Radii R1 and R2 must be positive. If R2 > R1 then toroidal surface will be self-intersecting.\r\n\r\n// Toroidal surface is both U- and V-periodical with periods 2 * PI.\r\n\r\n// If a face lies on a full toroidal surface its boundary wire will contain two seam-edges, corresponding to U=0 and U=2*PI, and V=0 and V=2*PI respectively.\r\n\r\n\r\nPosNorm calcTorusSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  float majorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float minorRadius = GLSLBinReader_readFloat(reader, texture);\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n  vec3 pos = (majorRadius + minorRadius * cos(v)) * vec3(cos(u), sin(u), 0.0) + vec3(0.0, 0.0, minorRadius * sin(v));\r\n\r\n  vec3 normal = vec3(cos(v) * cos(u), cos(v) * sin(u), sin(v));\r\n  // vec3 pos = majorRadius * normal;\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_TORUS);\r\n}\r\n\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADCompoundSurfaces.glsl',\r\n  `\r\n\r\n/////////////////////////////////////////\r\n// LinearExtrusion\r\n\r\nPosNorm calcLinearExtrusionSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  \r\n  int curve_index = GLSLBinReader_readUIntFrom2xUFloat16(reader, texture);\r\n\r\n  vec3 curve_tr = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec4 curve_ori = vec4(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n    );\r\n  vec3 curve_sc = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  PosNorm curveResult = evalCADCurve3d(curve_index, uv.x);\r\n  \r\n  vec3 pos = quat_rotateVec3(curve_ori, curveResult.pos * curve_sc) + curve_tr;\r\n  pos.z += uv.y;\r\n\r\n  vec3 normal = normalize(cross(vec3(0.0, 0.0, 1.0), quat_rotateVec3(curve_ori, curveResult.normal)));\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_LINEAR_EXTRUSION);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// Revolution\r\nPosNorm calcRevolutionSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture, bool flipDomain) {\r\n  box2 domain = loadBox2(reader, texture);\r\n\r\n  int curve_index = GLSLBinReader_readUIntFrom2xUFloat16(reader, texture);\r\n\r\n  vec3 curve_tr = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec4 curve_ori = vec4(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n    );\r\n  vec3 curve_sc = vec3(\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture),\r\n    GLSLBinReader_readFloat(reader, texture)\r\n  );\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n  vec3 axis = vec3(0.0, 0.0, 1.0);\r\n  PosNorm curveResult;\r\n  vec4 rev;\r\n  if (flipDomain) {\r\n    curveResult = evalCADCurve3d(curve_index, uv.x);\r\n    rev = quat_fromAxisAndAngle(axis, uv.y);\r\n  } else {\r\n    curveResult = evalCADCurve3d(curve_index, uv.y);\r\n    rev = quat_fromAxisAndAngle(axis, uv.x);\r\n  }\r\n\r\n  vec3 p_t = quat_rotateVec3(curve_ori, curveResult.pos * curve_sc) + curve_tr;\r\n  vec3 pos = quat_rotateVec3(rev, p_t);\r\n\r\n  vec3 p_n = quat_rotateVec3(rev, quat_rotateVec3(curve_ori, curveResult.normal));\r\n  \r\n  vec3 tangent;\r\n  if (abs(1.0 - dot(p_n, axis)) > 0.001) {\r\n    tangent = cross(p_n, axis);\r\n  } else {\r\n    tangent = cross(pos, axis);\r\n  }\r\n  // TODO: Find a conclusive test file that demonstrates this as correct.\r\n  // I think it is the master cylinder sample.\r\n  // vec3 normal = normalize(cross(p_n, tangent));\r\n  vec3 normal = normalize(cross(tangent, p_n));\r\n\r\n  // vec3 pos;\r\n  // vec3 normal;\r\n  // pos.x = float(partA);\r\n  // pos.y = float(partB);\r\n  // pos.z = float(curve_index);\r\n  return PosNorm(pos, normal, SURFACE_TYPE_REVOLUTION);\r\n}\r\n\r\n\r\n/////////////////////////////////////////\r\n// OffsetSurface\r\n\r\nPosNorm calcOffsetSurfaceSurfacePoint(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain = loadBox2(reader, texture);\r\n  int surfaceId = GLSLBinReader_readUInt(reader, texture);\r\n  float offset = GLSLBinReader_readFloat(reader, texture);\r\n  vec2 uv = mapDomain(domain, params);\r\n\r\n/*\r\n  GLSLBinReader subSurfaceReader = reader;\r\n  subSurfaceReader.start = \r\n  GLSLBinReader_init(reader, surfaceDataTextureSize, region, start, 32);\r\n\r\n  vec3 p = calcCurvePoint(uv.x);\r\n  vec3 pos = p + dir * (dist * uv.y);\r\n  \r\n*/\r\n  vec3 pos;\r\n  vec3 normal;\r\n  return PosNorm(pos, normal, SURFACE_TYPE_OFFSET_SURFACE);\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBS.glsl',\r\n  `\r\n\r\n#define MAX_KNOTS 256\r\n// Note: The BRP motorcycle features many surfaces of degree 15.\r\n#define MAX_DEGREE 16\r\n\r\nfloat kp(int index, inout GLSLBinReader r, sampler2D t, int offset) {\r\n  return GLSLBinReader_readFloat(r, t, offset+index);\r\n}\r\n\r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n\r\nint findSpan(float u, in int degree, in int numKnots, int kpOff, inout GLSLBinReader r, sampler2D t, out highp float knots[MAX_DEGREE*2+1]) {\r\n  \r\n  float nextKnot = kp(0, r, t, kpOff);\r\n  float knot = nextKnot;\r\n\r\n  int span = 1;\r\n  int n = numKnots - degree - 1;\r\n  // Linear Search...\r\n  for (; span<n; span++){\r\n    nextKnot += kp(span, r, t, kpOff);\r\n    if (span > degree && u < nextKnot){\r\n      span--;\r\n      break;\r\n    }\r\n    knot = nextKnot;\r\n  }\r\n  if (span == n) {\r\n    span--;\r\n  }\r\n\r\n\r\n  //Calculate knot values\r\n  knots[degree] = knot;\r\n  float left = knot;\r\n  float right = knot; \r\n  for (int i=1; i<=degree; i++) {\r\n    left -= kp(span-i+1, r, t, kpOff);\r\n    right += kp(span+i, r, t, kpOff);\r\n    knots[degree-i] = left;\r\n    knots[degree+i] = right;\r\n  }\r\n\r\n  return span;\r\n}\r\n\r\nvoid calcBasisValues(in float u, in int degree, in highp float knots[MAX_DEGREE*2+1], out highp float basisValues[MAX_DEGREE+1], out highp float bvD[MAX_DEGREE+1]) {\r\n  \r\n  highp vec2 savedTemp;\r\n  highp float left[MAX_DEGREE+1];\r\n  highp float right[MAX_DEGREE+1];\r\n\r\n  //Basis[0] is always 1.0\r\n  basisValues[0] = 1.0;\r\n  // Calculate basis values\r\n  for (int i=1; i<=degree; i++) {\r\n    left[i] = u - knots[degree+1-i];\r\n    right[i] = knots[degree+i] - u;\r\n\r\n    savedTemp.x = 0.0;\r\n    for (int j=0; j<i; j++) {\r\n      float rv = right[j+1];\r\n      float lv = left[i-j];\r\n      savedTemp.y = basisValues[j] / (rv + lv);\r\n      basisValues[j] = savedTemp.x + rv * savedTemp.y;\r\n      savedTemp.x = lv * savedTemp.y;\r\n    }\r\n    basisValues[i] = savedTemp.x;\r\n\r\n    // Calculate N' if on second to last iteration\r\n    if (i == degree-1 || degree == 1) {\r\n      savedTemp.x = 0.0;\r\n      //Loop through all basis values\r\n      for (int j=0; j<degree; j++) {\r\n        // Calculate a temp variable\r\n        int jr_z = j + 1;\r\n        //Calculate right side\r\n        float kp_0 = knots[jr_z + degree];\r\n        float kp_1 = knots[jr_z];\r\n        savedTemp.y = (float(degree) * basisValues[j]) / (kp_0 - kp_1);\r\n        // Calculate derivative value\r\n        bvD[j] = savedTemp.x - savedTemp.y;\r\n        // Swap right side to left\r\n        savedTemp.x = savedTemp.y;\r\n      }\r\n      //Save the last der-basis\r\n      bvD[degree] = savedTemp.x;\r\n    }\r\n  }\r\n}\r\n\r\n#else\r\n\r\n// http://read.pudn.com/downloads134/sourcecode/math/569665/nurbsR2006b/findspan.c__.htm\r\n// Note: I have found the 'early outs' in the Three code to be more correct\r\n// https://github.com/mrdoob/three.js/blob/b8d8a8625465bd634aa68e5846354d69f34d2ff5/examples/js/curves/NURBSUtils.js\r\nint findSpan(float u, in int degree, in int numKnots, int kpOff, inout GLSLBinReader r, sampler2D t, bool periodic) {\r\n  \r\n  // early outs\r\n  int n = numKnots - degree - 1;\r\n  if(u >= kp(n, r, t, kpOff))\r\n    return n-1;\r\n  if(u <= kp(degree, r, t, kpOff)) {\r\n    return degree;\r\n  }\r\n\r\n  // Linear Search...\r\n#ifdef ENABLE_ES3\r\n  int i = degree; \r\n  for (; i<n; i++){\r\n#else\r\n  // Note: loop values must be constant.\r\n  // Loops start at 1 because that is the minimum degree for a curve.\r\n  for (int i = 1; i<MAX_KNOTS; i++){\r\n    if(i >= degree && i < numKnots-1){\r\n#endif\r\n    if (u < kp(i+1, r, t, kpOff)){\r\n      return i;\r\n    }\r\n#ifndef ENABLE_ES3\r\n  }\r\n#endif\r\n  }\r\n\r\n  return i;\r\n}\r\n\r\n\r\nvoid calcBasisValues(in float u, in int span, int degree, int kpOff, int numKnots, inout GLSLBinReader r, sampler2D t, out highp float basisValues[MAX_DEGREE+1], out highp float bvD[MAX_DEGREE+1]) {\r\n  \r\n  highp vec2 savedTemp;\r\n  highp float left[MAX_DEGREE+1];\r\n  highp float right[MAX_DEGREE+1];\r\n\r\n  // Basis[0] is always 1.0\r\n  basisValues[0] = 1.0;\r\n  // Calculate basis values\r\n#ifdef ENABLE_ES3\r\n  for (int i=1; i<=degree; i++) {\r\n#else\r\n  for (int i=1; i<MAX_DEGREE; i++) {\r\n    if(i > degree) // i<=degree\r\n      break;\r\n#endif\r\n    left[i] = u - kp(span+1-i, r, t, kpOff);\r\n    right[i] = kp(span+i, r, t, kpOff) - u;\r\n\r\n    savedTemp.x = 0.0;\r\n#ifdef ENABLE_ES3\r\n    for (int j=0; j<i; j++) {\r\n#else\r\n    for (int j=0; j<MAX_DEGREE; j++) {\r\n      if(j >= i) // j < i\r\n        break;\r\n#endif\r\n      float rv = right[j+1];\r\n      float lv = left[i-j];\r\n      savedTemp.y = basisValues[j] / (rv + lv);\r\n      basisValues[j] = savedTemp.x + rv * savedTemp.y;\r\n      savedTemp.x = lv * savedTemp.y;\r\n    }\r\n    basisValues[i] = savedTemp.x;\r\n    \r\n    // Calculate N' if on second to last iteration\r\n    if (i == degree-1 || degree == 1) {\r\n      savedTemp.x = 0.0;\r\n      // Loop through all basis values\r\n#ifdef ENABLE_ES3\r\n      for (int j=0; j<degree; j++) {\r\n#else\r\n      for (int j=0; j<MAX_DEGREE; j++) {\r\n        if(j >= degree) // j < degree\r\n          break;\r\n#endif\r\n        // Calculate a temp variable\r\n        int jr_z = span - degree + j + 1;\r\n        // Calculate right side\r\n        float kp_0 = kp(jr_z + degree, r, t, kpOff);\r\n        float kp_1 = kp(jr_z, r, t, kpOff);\r\n        savedTemp.y = (float(degree) * basisValues[j]) / (kp_0 - kp_1);\r\n        // Calculate derivative value\r\n        bvD[j] = savedTemp.x - savedTemp.y;\r\n        // Swap right side to left\r\n        savedTemp.x = savedTemp.y;\r\n      }\r\n      // Save the last der-basis\r\n#ifdef ENABLE_ES3\r\n      bvD[degree] = savedTemp.x;\r\n#else\r\n      if(degree == 1)\r\n        bvD[1] = savedTemp.x;\r\n      else if(degree == 2)\r\n        bvD[2] = savedTemp.x;\r\n      else if(degree == 3)\r\n        bvD[3] = savedTemp.x;\r\n      else if(degree == 4)\r\n        bvD[4] = savedTemp.x;\r\n      else if(degree == 5)\r\n        bvD[5] = savedTemp.x;\r\n      else if(degree == 6)\r\n        bvD[6] = savedTemp.x;\r\n      else if(degree == 7)\r\n        bvD[7] = savedTemp.x;\r\n      else if(degree == 8)\r\n        bvD[8] = savedTemp.x;\r\n      else if(degree == 9)\r\n        bvD[9] = savedTemp.x;\r\n      else if(degree == 10)\r\n        bvD[10] = savedTemp.x;\r\n      else if(degree == 11)\r\n        bvD[11] = savedTemp.x;\r\n      else if(degree == 12)\r\n        bvD[12] = savedTemp.x;\r\n      else if(degree == 13)\r\n        bvD[13] = savedTemp.x;\r\n      else if(degree == 14)\r\n        bvD[14] = savedTemp.x;\r\n      else if(degree == 15)\r\n        bvD[15] = savedTemp.x;\r\n#endif\r\n    }\r\n  }\r\n}\r\n\r\n\r\n#endif\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBSCurves.glsl',\r\n  `\r\n\r\nstruct NURBSCurveData {\r\n  vec2 domain;\r\n  bool periodic;\r\n  int degree;\r\n  int numCPs;\r\n  int numKnots;\r\n\r\n  int cpStart;\r\n  int kpStart;\r\n};\r\n\r\nvoid loadNURBSCurve3dData(inout GLSLBinReader reader, sampler2D texture, out NURBSCurveData result) {\r\n\r\n  result.domain.x = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.degree = GLSLBinReader_readUInt(reader, texture);\r\n\r\n  result.numCPs = GLSLBinReader_readUInt(reader, texture);\r\n  result.numKnots = GLSLBinReader_readUInt(reader, texture);\r\n  int flags = GLSLBinReader_readUInt(reader, texture);\r\n  result.periodic = testFlag(flags, CURVE_FLAG_PERIODIC);\r\n\r\n  result.cpStart = 2*4; // 2 RGBA pixels of data before the knot values start.\r\n  result.kpStart = result.cpStart + (result.numCPs*4);\r\n}\r\n\r\nvec4 curve_cp3d(int u, inout GLSLBinReader r, NURBSCurveData d, sampler2D t) {\r\n  int index = u * 4;\r\n  return GLSLBinReader_readVec4(r, t, d.cpStart + index);\r\n}\r\n\r\n// https://github.com/akshatamohanty/wildcat-cad/blob/650e18d665ccde3dbc4c78029e35c38951581c92/Source/Geometry/Shaders/ns23_default_plM.fsh\r\n// https://github.com/mrdoob/three.js/blob/6c7f000734f8579da37fb39e5c2e9e5e2dfb14f8/examples/js/curves/NURBSUtils.js\r\n\r\n/*\r\n  Calculate rational B-Spline curve point. See The NURBS Book, page 134, algorithm A4.3.\r\n*/\r\nPosNorm calcNURBSCurve3dPoint(float param, inout GLSLBinReader r, sampler2D t) {\r\n\r\n  NURBSCurveData d;\r\n  loadNURBSCurve3dData(r, t, d);\r\n\r\n  float u = d.domain.x + param * ( d.domain.y - d.domain.x ); // linear mapping param->u\r\n  //if(d.periodic)\r\n  //    u = wrap(u, kp(0, r, t, d.kpStart), kp(d.numKnots-1, r, t, d.kpStart));\r\n \r\n  float bv[MAX_DEGREE+1];\r\n  float bvds[MAX_DEGREE+1];\r\n\r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n  highp float knots[MAX_DEGREE*2+1];\r\n  int span = findSpan(u, d.degree, d.numKnots, d.kpStart, r, t, knots);\r\n  //return PosNorm(vec3(span, knots[d.degree], knots[d.degree+1]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  //return PosNorm(vec3(knots[d.degree-1], knots[d.degree], knots[d.degree+1]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  //return PosNorm(vec3(knots[d.degree+1], knots[d.degree+2], knots[d.degree+3]), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n\r\n  calcBasisValues(u, d.degree, knots, bv, bvds);\r\n  // return PosNorm(vec3(bv[0], bv[1], bv[2]), vec3(bv[3], bv[4], bv[5]), CURVE_TYPE_NURBS_CURVE);\r\n#else\r\n  int span = findSpan(u, d.degree, d.numKnots, d.kpStart, r, t, d.periodic);\r\n  // return PosNorm(vec3(float(span)), vec3(1.0), CURVE_TYPE_NURBS_CURVE);\r\n  // return PosNorm(vec3(kp(span-1, r, t, d.kpStart), kp(span-0, r, t, d.kpStart), kp(span+1, r, t, d.kpStart)), vec3(0.0), CURVE_TYPE_NURBS_CURVE);\r\n\r\n  // Invalid knot vectors exist where all the values are identical.\r\n  if (kp(span, r, t, d.kpStart) == kp(span+1, r, t, d.kpStart)) {\r\n    for(int x=0; x <= d.degree; x++)\r\n      bv[x] = 0.0;\r\n    bv[d.degree] = 1.0;\r\n  }\r\n  else {\r\n    calcBasisValues(u, span, d.degree, d.kpStart, d.numKnots, r, t, bv, bvds);\r\n  }\r\n  // return PosNorm(vec3(bv[0], bv[1], bv[2]), vec3(bv[3], bv[4], bv[5]), CURVE_TYPE_NURBS_CURVE);\r\n#endif\r\n\r\n\r\n  float w = 0.0;\r\n  vec3 pos = vec3(0.0);\r\n  vec3 tangent = vec3(0.0);\r\n\r\n  int cv0 = (span - d.degree);\r\n#ifdef ENABLE_ES3\r\n  for(int x=0; x <= d.degree; x++) {\r\n#else\r\n  for(int x=0; x < MAX_DEGREE; x++) {\r\n    if(x > d.degree) // x<=degree\r\n      break;\r\n#endif\r\n    int index = cv0 + x;\r\n    vec4 pt = curve_cp3d(index, r, d, t);\r\n\r\n    if(d.degree < 3) {\r\n      // Rhino style evaluation....\r\n      highp float bvw = bv[x];\r\n      pos += pt.xyz * bvw;\r\n      w += pt.w * bvw;\r\n    }\r\n    else {\r\n      // Tiny NURBS/CADEx style evaluation....\r\n      highp float bvw = pt.w * bv[x];\r\n      pos += pt.xyz * bvw;\r\n      w += bvw;\r\n    }\r\n\r\n    tangent += pt.xyz * bvds[x];\r\n  }\r\n\r\n  pos /= w;\r\n\r\n\r\n  // Calc tangent\r\n  if(d.degree == 1){\r\n    vec3 pt0 = curve_cp3d(cv0, r, d, t).xyz;\r\n    vec3 pt1 = curve_cp3d(cv0+1, r, d, t).xyz;\r\n    tangent = pt1 - pt0;\r\n  }\r\n  else {\r\n    if (length(tangent) < 0.05) {\r\n\r\n      float spanLerp = u - knots[span];\r\n      float spanRange = knots[span+1] - knots[span];\r\n      int cv = int(floor((spanLerp / spanRange) * float(d.degree-1)));\r\n\r\n      vec3 pt0 = curve_cp3d(cv, r, d, t).xyz;\r\n      vec3 pt1 = curve_cp3d(cv+1, r, d, t).xyz;\r\n      tangent = pt1 - pt0;\r\n    }\r\n  }\r\n\r\n  return PosNorm(pos, normalize(tangent), CURVE_TYPE_NURBS_CURVE);\r\n}\r\n\r\n\r\n\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\nshaderLibrary.setShaderModule(\r\n  'GLSLNURBSSurfaces.glsl',\r\n  `\r\n\r\nstruct NURBSSurfaceData {\r\n  box2 domain;\r\n  bool periodicU;\r\n  bool periodicV;\r\n  int degreeU;\r\n  int degreeV;\r\n  int numCPsU;\r\n  int numCPsV;\r\n  int numKnotsU;\r\n  int numKnotsV;\r\n\r\n  int cpStart;\r\n  int kpUStart;\r\n  int kpVStart;\r\n};\r\n\r\nvoid loadNURBSSurfaceData(inout GLSLBinReader reader, sampler2D texture, out NURBSSurfaceData result) {\r\n\r\n  result.domain.p0.x = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.p0.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.domain.p1.x = GLSLBinReader_readFloat(reader, texture);\r\n\r\n  result.domain.p1.y = GLSLBinReader_readFloat(reader, texture);\r\n  result.degreeU = GLSLBinReader_readInt(reader, texture);\r\n  if(result.degreeU > MAX_DEGREE)\r\n    result.degreeU = MAX_DEGREE;\r\n  result.degreeV = GLSLBinReader_readInt(reader, texture);\r\n  if(result.degreeV > MAX_DEGREE)\r\n    result.degreeV = MAX_DEGREE;\r\n  result.numCPsU = GLSLBinReader_readInt(reader, texture);\r\n\r\n  result.numCPsV = GLSLBinReader_readInt(reader, texture);\r\n  result.numKnotsU = GLSLBinReader_readInt(reader, texture);\r\n  result.numKnotsV = GLSLBinReader_readInt(reader, texture);\r\n  int flags = GLSLBinReader_readInt(reader, texture);\r\n  result.periodicU = testFlag(flags, SURFACE_FLAG_PERIODIC_U);\r\n  result.periodicV = testFlag(flags, SURFACE_FLAG_PERIODIC_V);\r\n\r\n  result.cpStart  = 3*4; // 3 RGBA pixels of data before the knot values start.\r\n  result.kpUStart = result.cpStart + (result.numCPsU*result.numCPsV*4);\r\n  result.kpVStart = result.kpUStart + result.numKnotsU;\r\n}\r\n\r\nvec4 surface_cp(int u, int v, inout GLSLBinReader r, NURBSSurfaceData d, sampler2D t) {\r\n  int index = (u + (v * d.numCPsU)) * 4;\r\n  return GLSLBinReader_readVec4(r, t, d.cpStart + index);\r\n}\r\n\r\n/*\r\n  Calculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\r\n*/\r\nPosNorm calcNURBSSurfacePoint(vec2 params, inout GLSLBinReader r, sampler2D t) {\r\n\r\n  vec3 tmp;\r\n  NURBSSurfaceData d;\r\n  loadNURBSSurfaceData(r, t, d);\r\n\r\n  // ///////////////////////////////////////\r\n  // // vec3 cp_pos = vec3(params.x + float(d.degreeU), params.y + float(d.degreeV), 0.0 );\r\n  // vec3 cp_pos = vec3(params.x + float(d.numCPsU), params.y + float(d.numCPsV), 0.0 );\r\n  // return PosNorm(cp_pos, tmp);\r\n  // ///////////////////////////////////////\r\n\r\n  // ///////////////////////////////////////\r\n  // int knot_x = int(params.x * float(d.numCPsU-1));\r\n  // int knot_y = int(params.y * float(d.numCPsV-1));\r\n  // vec4 cp_pos = surface_cp(knot_x, knot_y, r, d, t);\r\n  // return PosNorm(cp_pos.xyz, tmp);\r\n  // ///////////////////////////////////////\r\n\r\n  vec2 uv = mapDomain(d.domain, params); // linear mapping params -> uv\r\n  float u = uv.x;\r\n  float v = uv.y;\r\n\r\n  highp float basisValuesU[MAX_DEGREE+1];\r\n  highp float basisValuesV[MAX_DEGREE+1];\r\n  highp float bvdsU[MAX_DEGREE+1];\r\n  highp float bvdsV[MAX_DEGREE+1];\r\n  \r\n#ifdef EXPORT_KNOTS_AS_DELTAS\r\n  highp float knotsU[MAX_DEGREE*2+1];\r\n  highp float knotsV[MAX_DEGREE*2+1];\r\n  int spanU = findSpan(u, d.degreeU, d.numKnotsU, d.kpUStart, r, t, knotsU);\r\n  int spanV = findSpan(v, d.degreeV, d.numKnotsV, d.kpVStart, r, t, knotsV);\r\n  calcBasisValues(u, d.degreeU, knotsU, basisValuesU, bvdsU);\r\n  calcBasisValues(v, d.degreeV, knotsV, basisValuesV, bvdsV);\r\n\r\n#else\r\n  int spanU = findSpan(u, d.degreeU, d.numKnotsU, d.kpUStart, r, t, d.periodicU);\r\n  int spanV = findSpan(v, d.degreeV, d.numKnotsV, d.kpVStart, r, t, d.periodicV);\r\n\r\n  calcBasisValues(u, spanU, d.degreeU, d.kpUStart, d.numKnotsU, r, t, basisValuesU, bvdsU);\r\n  calcBasisValues(v, spanV, d.degreeV, d.kpVStart, d.numKnotsV, r, t, basisValuesV, bvdsV);\r\n#endif\r\n\r\n  // ///////////////////////////////////////\r\n  // return PosNorm(vec3(knotsV[11], knotsV[12], knotsV[13]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(knotsV[14], knotsV[15], knotsV[16]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(knotsV[17], knotsV[18], knotsV[19]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // return PosNorm(vec3(basisValuesU[0], basisValuesU[1], basisValuesU[2]), tmp, SURFACE_TYPE_NURBS_SURFACE);\r\n  // ///////////////////////////////////////\r\n\r\n  ivec2 indices;\r\n  highp float w = 0.0;\r\n  highp vec3 pos = vec3(0.0);\r\n  highp vec3 tangentU = vec3(0.0);\r\n  highp vec3 tangentV = vec3(0.0);\r\n  int cvU0 = (spanU - d.degreeU);\r\n  int cvV0 = (spanV - d.degreeV);\r\n#ifdef ENABLE_ES3\r\n  for(int y=0; y <= d.degreeV; y++) {\r\n#else\r\n  for(int y=0; y < MAX_DEGREE; y++) {\r\n     if(y > d.degreeV) // y<=degree\r\n         break;\r\n#endif\r\n    indices.y = cvV0 + y;\r\n\r\n#ifdef ENABLE_ES3\r\n    for(int x=0; x <= d.degreeU; x++) {\r\n#else\r\n    for(int x=0; x < MAX_DEGREE; x++) {\r\n      if(x > d.degreeU) // x<=degree\r\n        break;\r\n#endif\r\n      indices.x = cvU0 + x;\r\n      \r\n      vec4 cv = surface_cp(indices.x, indices.y, r, d, t);\r\n      vec3 pt = cv.xyz;\r\n      float weight = cv.w;\r\n\r\n      float bvU = basisValuesU[x];\r\n      float bvV = basisValuesV[y];\r\n\r\n// #define USE_RHNIO_EVALUATION_MATH 1\r\n#ifdef USE_RHNIO_EVALUATION_MATH\r\n      // Rhino style evaluation....\r\n      float bvw = bvU * bvV;\r\n      pos += pt * bvw;\r\n      w += weight * bvw;\r\n#else\r\n      // Tiny NURBS/CADEx style evaluation....\r\n      highp float bvw = weight * bvU * bvV;\r\n      pos += pt * bvw;\r\n      w += bvw;\r\n#endif\r\n        \r\n      float bvdU = bvdsU[x];\r\n      float bvdV = bvdsV[y];\r\n\r\n      tangentU += pt * bvdU * bvV;\r\n      tangentV += pt * bvU * bvdV;\r\n    }\r\n  }\r\n\r\n  pos /= w;\r\n\r\n  ///////////////////////////////////////////////////////\r\n  // Calculate normal.\r\n  float spanRangeU = knotsU[d.degreeU + 1] - knotsU[d.degreeU];\r\n  float spanRangeV = knotsV[d.degreeV + 1] - knotsV[d.degreeV];\r\n  float eqKnotRangeU = ( d.domain.p1.x - d.domain.p0.x ) / float(d.numKnotsU);\r\n  float eqKnotRangeV = ( d.domain.p1.y - d.domain.p0.y ) / float(d.numKnotsV);\r\n  \r\n  \r\n  if (spanRangeU / eqKnotRangeU < 0.01) { \r\n    // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n    // we have span segment which has close to zero delta, and \r\n    // so the normals are broken. We want to advace along the \r\n    // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n    // length of the span rather than when we have a pinched corner, \r\n    // where we move along the toher direction.\r\n    // console.log(v, 'spanRangeU:', spanRangeU, ' eqKnotRangeU:', eqKnotRangeU, spanRangeU / eqKnotRangeU)\r\n\r\n    int cvU = cvU0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvU = cvU0 + d.degreeU - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the U range, then \r\n      // we will grab the next in the row. \r\n      cvU = cvU0 + 1;\r\n    }\r\n\r\n    float spanLerpV = (u - knotsV[d.degreeV]) / spanRangeV;\r\n    int cvV = cvV0 + int(floor(spanLerpV * float(d.degreeV)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU+1, cvV, r, d, t).xyz;\r\n\r\n    tangentU = pt1 - pt0;\r\n  } else if (length(tangentU) < 0.001) {\r\n    // Note: on values to big, we get false positives.\r\n    // See: 2_SR00404681_1_RI510090.CATPart.zcad\r\n    // long narrow nurbs surface above the tail light.\r\n    // Reduced from 0.05 to 0.001 fixed it.\r\n\r\n    // The derivative in the V direction is zero, \r\n    // so we calculate the linear derivative for the next control points along.\r\n    \r\n    int cvV;\r\n    if (spanV > d.degreeV) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvV = cvV0 + d.degreeV - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the V range, then \r\n      // we will grab the next in the row. \r\n      cvV = cvV0 + 1;\r\n    }\r\n    \r\n    float spanLerpU = (u - knotsU[d.degreeU]) / spanRangeU;\r\n    int cvU = cvU0 + int(floor(spanLerpU * float(d.degreeU)));\r\n    \r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU+1, cvV, r, d, t).xyz;\r\n\r\n    tangentU = pt1 - pt0;\r\n  }\r\n\r\n  if (spanRangeV / eqKnotRangeV < 0.01) {\r\n    // In some cases (COOLANT_INLET_PORT_01.ipt_faceWithBlackEdge.)\r\n    // we have span segment which has close to zero delta, and \r\n    // so the normals are broken. We want to advace along the \r\n    // e.g. [0, 0, 0, 0.00001, 1, 3, 3, 3]\r\n    // length of the span rather than when we have a pinched corner, \r\n    // where we move along the toher direction.\r\n    // console.log(v, 'spanRangeV:', spanRangeV, ' eqKnotRangeV:', eqKnotRangeV, spanRangeV / eqKnotRangeV)\r\n\r\n    int cvV = cvV0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvV = cvV0 + d.degreeV - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the V range, then \r\n      // we will grab the next in the row. \r\n      cvV = cvV0 + 1;\r\n    }\r\n\r\n    float spanLerpU = (u - knotsU[d.degreeU]) / spanRangeU;\r\n    int cvU = cvU0 + int(floor(spanLerpU * float(d.degreeU)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU, cvV+1, r, d, t).xyz;\r\n\r\n    tangentV = pt1 - pt0;\r\n    \r\n  } else if (length(tangentV) < 0.001) { \r\n    // Note: on values to big, we get false positives.\r\n    // See: 2_SR00404681_1_RI510090.CATPart.zcad\r\n    // long narrow nurbs surface above the tail light.\r\n    // Reduced from 0.05 to 0.001 fixed it.\r\n\r\n    // The derivative in the V direction is close to zero, \r\n    // so we calculate the linear derivative for the next control points along.\r\n\r\n    int cvU = cvU0;\r\n    if (v > d.domain.p1.y - 0.0001) {\r\n      // If at the end then we grab the end of the pevious row.\r\n      cvU = cvU0 + d.degreeU - 2;\r\n    } else {\r\n      // if the broken normal is at the start of the U range, then\r\n      // we will grab the next in the row.\r\n      cvU = cvU0 + 1;\r\n    }\r\n\r\n    float spanLerpV = (u - knotsV[d.degreeV]) / spanRangeV;\r\n    int cvV = cvV0 + int(floor(spanLerpV * float(d.degreeV)));\r\n\r\n    vec3 pt0 = surface_cp(cvU, cvV, r, d, t).xyz;\r\n    vec3 pt1 = surface_cp(cvU, cvV+1, r, d, t).xyz;\r\n\r\n    tangentV = pt1 - pt0;\r\n  }\r\n\r\n  // vec3 normal = tangentV;\r\n  // Note: in the gear_box_final_asm.zcad. the nurbs surfaces were all flipped\r\n  // This is only apparent in cut-away scenes, which the gearbox demo is.\r\n  // vec3 normal = normalize(cross(tangentV, tangentU));\r\n  vec3 normal = normalize(cross(tangentU, tangentV));\r\n\r\n  return PosNorm(pos, normal, SURFACE_TYPE_NURBS_SURFACE);\r\n}\r\n\r\n`\r\n)\r\n","/* eslint-disable camelcase */\r\nimport { GLShader, shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nimport './GLSLBinReader.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADCurves.js'\r\nimport './GLSLCADSurfaces.js'\r\nimport './GLSLNURBS.js'\r\nimport './GLSLNURBSCurves.js'\r\nimport './GLSLNURBSSurfaces.js'\r\n\r\nconst GLEvaluateCADSurfaceShader_VERTEX_SHADER = shaderLibrary.parseShader(\r\n  'GLEvaluateCADSurfaceShader.vertexShader',\r\n  `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute float surfaceId;\r\n\r\nuniform sampler2D surfaceAtlasLayoutTexture;\r\nuniform ivec2 surfaceAtlasLayoutTextureSize;\r\n\r\nuniform ivec2 surfacesAtlasTextureSize;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n/* VS Outputs */\r\nvarying float v_surfaceId;      // flat\r\nvarying vec3 v_geomDataCoords;  // flat\r\nvarying vec2 v_patchSize;       // flat\r\nvarying vec2 v_vertexCoord;\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  GLSLBinReader reader;\r\n  GLSLBinReader_init(reader, surfaceAtlasLayoutTextureSize, 32);\r\n  vec4 patchCoords = GLSLBinReader_readVec4(reader, surfaceAtlasLayoutTexture, int(surfaceId)*8);\r\n  vec4 surfaceDataCoords = GLSLBinReader_readVec4(reader, surfaceAtlasLayoutTexture, (int(surfaceId)*8)+4);\r\n\r\n  vec2 patchPos = patchCoords.xy;\r\n  v_patchSize = patchCoords.zw;\r\n\r\n  v_surfaceId = surfaceId;\r\n  v_geomDataCoords = surfaceDataCoords.xyz;\r\n  v_vertexCoord = (positions.xy + 0.5) * v_patchSize;\r\n\r\n  vec2 pos = (patchPos + v_vertexCoord) / vec2(surfacesAtlasTextureSize);\r\n  gl_Position = vec4((pos - 0.5) * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceFragmentShader.glsl',\r\n  `\r\n\r\nstruct PosNorm {\r\n  vec3 pos;\r\n  vec3 normal;\r\n  int geomType;\r\n};\r\n\r\n/* VS Outputs */\r\nvarying float v_surfaceId;      // flat\r\nvarying vec3 v_geomDataCoords;  // flat\r\nvarying vec2 v_patchSize;       // flat\r\nvarying vec2 v_vertexCoord;\r\n\r\nuniform sampler2D surfaceDataTexture;\r\nuniform ivec2 surfaceDataTextureSize;\r\nuniform int writeNormals;\r\n\r\nvec2 initReader(inout GLSLBinReader reader) {\r\n\r\n  // compute exact xy coords per pixel by rounding the vertex coord to the nearest integer and then dividing my patch size.\r\n  // The interpollated xy coords from the quad are not exact because the quad must cover the pixels with some margin.\r\n\r\n  vec2 params = vec2(floor(v_vertexCoord.x), floor(v_vertexCoord.y));\r\n  if(v_patchSize.x > 1.0)\r\n    params.x /= v_patchSize.x - 1.0;\r\n  if(v_patchSize.y > 1.0)\r\n    params.y /= v_patchSize.y - 1.0;\r\n\r\n  ivec4 region = ivec4(0, 0, surfaceDataTextureSize.x, surfaceDataTextureSize.y);\r\n  ivec2 start = ivec2(v_geomDataCoords.xy);\r\n  int flags = int(v_geomDataCoords.z);\r\n  if(testFlag(flags, SURFACE_FLAG_FLIPPED_UV))  {\r\n    float tmp = params.x;\r\n    params.x = params.y;\r\n    params.y = tmp;\r\n  }\r\n\r\n  GLSLBinReader_init(reader, surfaceDataTextureSize, region, start, 32);\r\n\r\n  return params;\r\n}\r\n\r\n\r\nstruct box2 {\r\n  vec2 p0;\r\n  vec2 p1;\r\n};\r\n\r\nbox2 loadBox2(inout GLSLBinReader reader, sampler2D texture) {\r\n  box2 domain;\r\n  domain.p0.x = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p0.y = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p1.x = GLSLBinReader_readFloat(reader, texture);\r\n  domain.p1.y = GLSLBinReader_readFloat(reader, texture);\r\n  return domain;\r\n}\r\n\r\nvec2 mapDomain(box2 domain, vec2 params) {\r\n  return domain.p0 + params * ( domain.p1 - domain.p0 );\r\n}\r\n\r\n\r\n`\r\n)\r\n\r\n/** Class representing a GL evaluate simple CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateSimpleCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate simple CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateSimpleCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLCADSimpleSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_PLANE) {\r\n    posNorm = calcPlaneSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_POLY_PLANE) {\r\n    posNorm = calcPolyPlaneSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_FAN) {\r\n    posNorm = calcFanSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_CONE) {\r\n    posNorm = calcConeSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_CYLINDER) {\r\n    posNorm = calcCylinderSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_SPHERE) {\r\n    posNorm = calcSphereSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_TORUS) {\r\n    posNorm = calcTorusSurfacePoint(params, reader, texture);\r\n  }\r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n  // gl_FragData[0] = vec4(posNorm.pos, 1.0);\r\n  // gl_FragData[1] = vec4(posNorm.normal, 1.0);\r\n\r\n  // fragColor.r = v_geomDataCoords.x;\r\n  // fragColor.g = v_geomDataCoords.y;\r\n  // fragColor.r = floor(v_vertexCoord.x);\r\n  // fragColor.g = floor(v_vertexCoord.y);\r\n  // fragColor.b = v_patchSize.x;\r\n  // fragColor.a = v_patchSize.y;\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\n/** Class representing a GL evaluate compound CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateCompoundCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate compound CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateCompoundCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\nuniform sampler2D curveTangentsTexture;\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\nvec3 getCurveVertex(ivec2 curvePatchCoords, int vertexCoord) {\r\n  return fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(curvePatchCoords.x + vertexCoord, curvePatchCoords.y)).rgb;\r\n}\r\n\r\nvec3 getCurveTangent(ivec2 curvePatchCoords, int vertexCoord) {\r\n  return fetchTexel(curveTangentsTexture, curvesAtlasTextureSize, ivec2(curvePatchCoords.x + vertexCoord, curvePatchCoords.y)).rgb;\r\n}\r\n\r\nPosNorm evalCADCurve3d(int curveId, float u) {\r\n\r\n  GLSLBinReader curveLayoutDataReader;\r\n  GLSLBinReader_init(curveLayoutDataReader, curvesAtlasLayoutTextureSize, 32);\r\n  ivec4 curvePatch = ivec4(GLSLBinReader_readVec4(curveLayoutDataReader, curvesAtlasLayoutTexture, curveId * 8));\r\n\r\n  float t = float(curvePatch.z - 1) * u;\r\n  int vertexId0 = min(int(floor(t + 0.5)), curvePatch.z - 1);\r\n  // int vertexId1 = floor(t) + 1.0;\r\n  // float lerp = t - floor(t);\r\n\r\n  vec3 p0 = getCurveVertex(curvePatch.xy, vertexId0);\r\n  // vec3 p1 = getCurveVertex(curvePatch.xy, vertexId1);\r\n  vec3 t0 = getCurveTangent(curvePatch.xy, vertexId0);\r\n  // vec3 t1 = getCurveTangent(curvePatch.xy, vertexId1);\r\n\r\n  PosNorm res;\r\n  res.pos = p0;//mix(p0, p1, lerp);\r\n  res.normal = normalize(t0);//mix(t0, t1, lerp));\r\n  res.geomType = 0;\r\n\r\n  // res.pos.x = u;\r\n  // res.pos.y = float(curveId);\r\n  // res.pos.x = float(curvePatch.x);\r\n  // res.pos.y = float(curvePatch.y);\r\n  // res.pos.z = float(curvePatch.z);\r\n  return res;\r\n}\r\n\r\n\r\n<%include file=\"GLSLCADCompoundSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_LINEAR_EXTRUSION) {\r\n    posNorm = calcLinearExtrusionSurfacePoint(params, reader, texture);\r\n  } else if(geomType == SURFACE_TYPE_REVOLUTION) {\r\n    posNorm = calcRevolutionSurfacePoint(params, reader, texture, false);\r\n  } else if(geomType == SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN) {\r\n    posNorm = calcRevolutionSurfacePoint(params, reader, texture, true);\r\n  } \r\n  \r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\n/** Class representing a GL evaluate NURBS CAD surface shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLEvaluateNURBSCADSurfaceShader extends GLShader {\r\n  /**\r\n   * Create a GL evaluate NURBS CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = GLEvaluateCADSurfaceShader_VERTEX_SHADER\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLEvaluateNURBSCADSurfaceShader.fragmentShader',\r\n      `\r\n// #extension GL_EXT_draw_buffers : require\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n<%include file=\"GLSLCADSurfaceFragmentShader.glsl\"/>\r\n\r\n<%include file=\"GLSLNURBS.glsl\"/>\r\n<%include file=\"GLSLNURBSSurfaces.glsl\"/>\r\n\r\nPosNorm evalCADSurfaces(vec2 params, inout GLSLBinReader reader, sampler2D texture) {\r\n  // Evaluate the surface per vertex\r\n  int geomType = GLSLBinReader_readInt(reader, texture);\r\n\r\n  PosNorm posNorm;\r\n  if(geomType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    posNorm = calcNURBSSurfacePoint(params, reader, texture);\r\n  }\r\n  \r\n  return posNorm;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n  \r\n  GLSLBinReader reader;\r\n  vec2 xy = initReader(reader);\r\n  PosNorm posNorm = evalCADSurfaces(xy, reader, surfaceDataTexture);\r\n\r\n  if(writeNormals == 1) {\r\n    fragColor = vec4(posNorm.normal, float(posNorm.geomType));\r\n  }\r\n  else {\r\n    fragColor = vec4(posNorm.pos, float(posNorm.geomType));\r\n  }\r\n\r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nexport { GLEvaluateSimpleCADSurfaceShader, GLEvaluateCompoundCADSurfaceShader, GLEvaluateNURBSCADSurfaceShader }\r\n","import { EventEmitter, GLFbo, GLTexture2D } from '@zeainc/zea-engine'\r\nimport { valuesPerSurfaceLibraryLayoutItem } from './CADConstants.js'\r\nimport { BinReader } from './Math/BinReader.js'\r\n\r\nimport {\r\n  GLEvaluateSimpleCADSurfaceShader,\r\n  GLEvaluateCompoundCADSurfaceShader,\r\n  GLEvaluateNURBSCADSurfaceShader,\r\n} from './GLEvaluateCADSurfaceShader.js'\r\n\r\n/** Class representing a GL surface library.\r\n * @ignore\r\n */\r\nclass GLSurfaceLibrary extends EventEmitter {\r\n  /**\r\n   * Create a GL surface library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} surfacesLibrary - The surfacesLibrary value.\r\n   * @param {any} glCurveLibrary - The glCurveLibrary value.\r\n   */\r\n  constructor(gl, cadpassdata, surfacesLibrary, glCurveLibrary, version) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__surfacesLibrary = surfacesLibrary\r\n    this.__glCurveLibrary = glCurveLibrary\r\n    this.cadDataVersion = version\r\n\r\n    const surfacesDataBuffer = this.__surfacesLibrary.getSurfaceBuffer()\r\n    const surfaceTexSize = Math.sqrt(surfacesDataBuffer.byteLength / 8)\r\n\r\n    this.__surfaceDataTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'HALF_FLOAT',\r\n      width: surfaceTexSize,\r\n      height: surfaceTexSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: new Uint16Array(surfacesDataBuffer),\r\n    })\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.evaluateSurfaceShaders = []\r\n    this.__surfaceDrawSets = {}\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Surfaces\r\n\r\n  /**\r\n   * The drawSurfaceData method.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawSurfaceData() {\r\n    const renderstate = {}\r\n    if (!this.__surfaceDataTexture || !this.__cadpassdata.debugTrimSetsShader.bind(renderstate)) return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__surfaceDataTexture.bindToUniform(renderstate, renderstate.unifs.trimSetAtlasTexture)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The evaluateSurfaces method.\r\n   * @param {any} surfacesEvalAttrs - The surfacesEvalAttrs param.\r\n   * @param {any} surfacesAtlasLayout - The surfacesAtlasLayout param.\r\n   * @param {any} surfaceAtlasLayoutTextureSize - The surfaceAtlasLayoutTextureSize param.\r\n   * @param {any} surfacesAtlasTextureDim - The surfacesAtlasTextureDim param.\r\n   * @return {any} - The return value.\r\n   */\r\n  evaluateSurfaces(surfacesEvalAttrs, surfacesAtlasLayout, surfaceAtlasLayoutTextureSize, surfacesAtlasTextureDim) {\r\n    // console.log(\"evaluateSurfaces\");\r\n    const t0 = performance.now()\r\n\r\n    const totalSurfaceCount = surfacesAtlasLayout.length / valuesPerSurfaceLibraryLayoutItem\r\n    if (totalSurfaceCount == 0) return\r\n    const gl = this.__gl\r\n\r\n    {\r\n      this.__surfaceAtlasLayoutTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfaceAtlasLayoutTextureSize[0],\r\n        height: surfaceAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: surfacesAtlasLayout,\r\n      })\r\n    }\r\n\r\n    if (!this.__surfacesAtlasTexture) {\r\n      this.__surfacesAtlasTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfacesAtlasTextureDim[0],\r\n        height: surfacesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__surfacesFbo = new GLFbo(gl, this.__surfacesAtlasTexture)\r\n      this.__surfacesFbo.setClearColor([0, 0, 0, 0])\r\n      this.__surfacesFbo.bindAndClear()\r\n\r\n      this.__normalsTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: surfacesAtlasTextureDim[0],\r\n        height: surfacesAtlasTextureDim[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__normalsFbo = new GLFbo(gl, this.__normalsTexture)\r\n      this.__normalsFbo.setClearColor([0, 0, 0, 0])\r\n      this.__normalsFbo.bindAndClear()\r\n    } else if (\r\n      this.__surfacesAtlasTexture.width != surfacesAtlasTextureDim[0] ||\r\n      this.__surfacesAtlasTexture.height != surfacesAtlasTextureDim[1]\r\n    ) {\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__surfacesAtlasTexture.resize(surfacesAtlasTextureDim[0], surfacesAtlasTextureDim[1], true)\r\n      this.__surfacesFbo.resize() // hack to rebind the texture. Refactor the way textures are resized.\r\n    }\r\n\r\n    const renderstate = {}\r\n\r\n    // /////////////////////////////////////////////\r\n    // Precompile shaders.\r\n    const shaderopts = { directives: [...gl.shaderopts.directives] }\r\n\r\n    if (this.cadDataVersion.compare([0, 0, 6]) >= 0) {\r\n      shaderopts.directives.push('#define EXPORT_KNOTS_AS_DELTAS 1')\r\n    }\r\n    if (this.cadDataVersion.compare([0, 0, 26]) > 0) {\r\n      shaderopts.directives.push('#define INTS_PACKED_AS_2FLOAT16 1')\r\n    }\r\n\r\n    surfacesEvalAttrs.forEach((attr, category) => {\r\n      if (!this.evaluateSurfaceShaders[category]) {\r\n        let shader\r\n        switch (category) {\r\n          case 0:\r\n            shader = new GLEvaluateSimpleCADSurfaceShader(gl)\r\n            break\r\n          case 1:\r\n            shader = new GLEvaluateCompoundCADSurfaceShader(gl)\r\n            break\r\n          case 2:\r\n            shader = new GLEvaluateNURBSCADSurfaceShader(gl)\r\n            break\r\n        }\r\n        shader.compileForTarget(undefined, shaderopts)\r\n        this.evaluateSurfaceShaders[category] = shader\r\n      }\r\n      this.evaluateSurfaceShaders[category].bind(renderstate)\r\n      this.__cadpassdata.glplanegeom.bind(renderstate)\r\n\r\n      const unifs = renderstate.unifs\r\n      const attrs = renderstate.attrs\r\n\r\n      this.__surfaceAtlasLayoutTexture.bindToUniform(renderstate, unifs.surfaceAtlasLayoutTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceAtlasLayoutTextureSize.location,\r\n        this.__surfaceAtlasLayoutTexture.width,\r\n        this.__surfaceAtlasLayoutTexture.height\r\n      )\r\n\r\n      gl.uniform2i(\r\n        unifs.surfacesAtlasTextureSize.location,\r\n        this.__surfacesAtlasTexture.width,\r\n        this.__surfacesAtlasTexture.height\r\n      )\r\n\r\n      this.__surfaceDataTexture.bindToUniform(renderstate, unifs.surfaceDataTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceDataTextureSize.location,\r\n        this.__surfaceDataTexture.width,\r\n        this.__surfaceDataTexture.height\r\n      )\r\n\r\n      // For the linear and radial loft.\r\n      if (unifs.curveTangentsTexture) this.__glCurveLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      const buffer = gl.createBuffer()\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n      gl.bufferData(gl.ARRAY_BUFFER, attr, gl.STATIC_DRAW)\r\n\r\n      this.__bindAttr(attrs.surfaceId.location, 1, gl.FLOAT, 4, 0)\r\n\r\n      // //////////////////////////////////////////////\r\n      // Bind each Fbo and render separately.\r\n      // Bizzarly, this has turned out to be much faster\r\n      // than using mutiple render targets...\r\n      this.__surfacesFbo.bind()\r\n      gl.uniform1i(unifs.writeNormals.location, 0)\r\n      this.__cadpassdata.glplanegeom.drawInstanced(attr.length)\r\n\r\n      this.__normalsFbo.bind()\r\n      gl.uniform1i(unifs.writeNormals.location, 1)\r\n      this.__cadpassdata.glplanegeom.drawInstanced(attr.length)\r\n      // //////////////////////////////////////////////\r\n\r\n      gl.deleteBuffer(buffer)\r\n    })\r\n    this.__surfacesFbo.unbind()\r\n\r\n    this.__surfacesAtlasLayout = surfacesAtlasLayout\r\n    // console.log(\"----------------------------------\");\r\n    // // console.log(surfacesAtlasLayout);\r\n    const logSurfaceData = (surfaceId) => {\r\n      this.__surfacesFbo.bindForReading()\r\n      const layout = [\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 0],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 1],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 2],\r\n        surfacesAtlasLayout[surfaceId * valuesPerSurfaceLibraryLayoutItem + 3],\r\n      ]\r\n      console.log('----------------------------------')\r\n      console.log(\r\n        'logSurfaceData ' + surfaceId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3]\r\n      )\r\n      const pixels = new Float32Array(layout[2] * 4)\r\n      for (let i = 0; i < layout[3]; i++) {\r\n        gl.readPixels(layout[0], layout[1] + i, layout[2], 1, gl.RGBA, gl.FLOAT, pixels)\r\n        for (let j = 0; j < layout[2]; j++) {\r\n          console.log(i, j, ':', pixels[j * 4 + 0], pixels[j * 4 + 1], pixels[j * 4 + 2], pixels[j * 4 + 3])\r\n          break\r\n        }\r\n        // console.log(i+\":\" + pixels);\r\n      }\r\n    }\r\n    // logSurfaceData(9628)\r\n    // console.log(\"----------------------------------\");\r\n\r\n    const t = performance.now() - t0\r\n    // console.log(\"evaluateSurfaces - Done:\", t);\r\n\r\n    return t\r\n  }\r\n\r\n  /**\r\n   * The logSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   */\r\n  logSurfaceData(surfaceId) {\r\n    // const layout = [\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 0],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 1],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 2],\r\n    //   this.__surfacesAtlasLayout[(surfaceId * valuesPerSurfaceLibraryLayoutItem) + 3]];\r\n\r\n    // console.log(\"logGeomData \" + surfaceId + \":[\" + layout[0] +\",\"+ layout[1] + \"] detail :\" + layout[2] +\"x\"+ layout[3]);\r\n\r\n    const surfacesDataBuffer = this.__surfacesLibrary.getSurfaceBuffer()\r\n    const surfacesDataReader = new BinReader(surfacesDataBuffer)\r\n    surfacesDataReader.seek(8 + surfaceId * (8 /* num values per item*/ * 2) /* bpc*/ + 2 /* addr*/ * 2 /* bpc*/)\r\n\r\n    const detailU = surfacesDataReader.loadFloat16()\r\n    const detailV = surfacesDataReader.loadFloat16()\r\n    const sizeU = surfacesDataReader.loadFloat16()\r\n    const sizeV = surfacesDataReader.loadFloat16()\r\n    const trimSetIndex = surfacesDataReader.loadFloat16()\r\n    console.log(\r\n      'logGeomData ' +\r\n        surfaceId +\r\n        ' detailU:[' +\r\n        detailU +\r\n        ',' +\r\n        detailV +\r\n        '] sizeU [' +\r\n        sizeU +\r\n        ',' +\r\n        sizeV +\r\n        '] trimSetIndex:' +\r\n        trimSetIndex\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The drawSurfaceAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawSurfaceAtlas(renderstate) {\r\n    if (!this.__normalsTexture || !this.__cadpassdata.debugTrimSetsShader.bind(renderstate)) return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__normalsTexture.bindToUniform(renderstate, renderstate.unifs.trimSetAtlasTexture)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The bindSurfacesData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindSurfacesData(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    this.__surfaceDataTexture.bindToUniform(renderstate, unifs.surfaceDataTexture)\r\n    gl.uniform2i(\r\n      unifs.surfaceDataTextureSize.location,\r\n      this.__surfaceDataTexture.width,\r\n      this.__surfaceDataTexture.height\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The bindSurfacesAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - returns true if the atlass was bound.\r\n   */\r\n  bindSurfacesAtlas(renderstate) {\r\n    if (!this.__surfacesAtlasTexture) return false\r\n    const unifs = renderstate.unifs\r\n    this.__surfacesAtlasTexture.bindToUniform(renderstate, unifs.surfacesAtlasTexture)\r\n    const gl = this.__gl\r\n    if (unifs.normalsTexture) this.__normalsTexture.bindToUniform(renderstate, unifs.normalsTexture)\r\n    if (unifs.surfacesAtlasTextureSize)\r\n      gl.uniform2i(\r\n        unifs.surfacesAtlasTextureSize.location,\r\n        this.__surfacesAtlasTexture.width,\r\n        this.__surfacesAtlasTexture.height\r\n      )\r\n\r\n    if (unifs.numSurfacesInLibrary) {\r\n      gl.uniform1i(unifs.numSurfacesInLibrary.location, this.__surfacesLibrary.getNumSurfaces())\r\n    }\r\n\r\n    if (unifs.surfaceAtlasLayoutTexture) {\r\n      this.__surfaceAtlasLayoutTexture.bindToUniform(renderstate, unifs.surfaceAtlasLayoutTexture)\r\n      gl.uniform2i(\r\n        unifs.surfaceAtlasLayoutTextureSize.location,\r\n        this.__surfaceAtlasLayoutTexture.width,\r\n        this.__surfaceAtlasLayoutTexture.height\r\n      )\r\n    }\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId) {\r\n    return this.__surfacesLibrary.getSurfaceData(surfaceId)\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__surfaceDataTexture.destroy()\r\n    if (this.__surfacesAtlasTexture) {\r\n      this.__surfacesAtlasTexture.destroy()\r\n      this.__normalsTexture.destroy()\r\n      this.__surfacesFbo.destroy()\r\n      this.__normalsFbo.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLSurfaceLibrary }\r\n","import { Float32, Plane, Mesh, GLMesh } from '@zeainc/zea-engine'\r\n\r\nimport { numValuesPerTrimSetCurveRef } from './CADConstants.js'\r\n\r\n/** This class abstracts the rendering of a collection of geometries to screen.\r\n * @extends Mesh\r\n * @ignore\r\n */\r\nclass Fan extends Mesh {\r\n  /**\r\n   * Create a fan.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super()\r\n    this.__detail = detail\r\n    this.addVertexAttribute('vertexIds', Float32)\r\n    this.__rebuild()\r\n  }\r\n\r\n  /**\r\n   * The __rebuild method.\r\n   * @private\r\n   */\r\n  __rebuild() {\r\n    this.setNumVertices(this.__detail + 2)\r\n    this.setFaceCounts([this.__detail])\r\n\r\n    for (let i = 0; i < this.__detail; i++) {\r\n      this.setFaceVertexIndices(i, [0, i + 1, i + 2])\r\n    }\r\n    const vertexIds = this.getVertexAttribute('vertexIds')\r\n    for (let i = 0; i <= vertexIds.length; i++) {\r\n      vertexIds.setFloat32Value(i, i)\r\n    }\r\n  }\r\n}\r\n\r\n/** Class representing a strip.\r\n * @extends Plane\r\n * @ignore\r\n */\r\nclass Strip extends Plane {\r\n  /**\r\n   * Create a strip.\r\n   * @param {number} detail - The detail value.\r\n   */\r\n  constructor(detail = 1) {\r\n    super(1, 2, detail, 1, false, false)\r\n  }\r\n\r\n  /**\r\n   * The __resize method.\r\n   * @private\r\n   */\r\n  __resize() {\r\n    const sizeX = this.__sizeXParam.getValue()\r\n    const sizeY = this.__sizeYParam.getValue()\r\n    const detailX = this.__detailXParam.getValue()\r\n    const detailY = this.__detailYParam.getValue()\r\n    const positions = this.getVertexAttribute('positions')\r\n    let voff = 0\r\n    for (let i = 0; i <= detailY; i++) {\r\n      const y = (i / detailY - 0.5) * sizeY\r\n      for (let j = 0; j <= detailX; j++) {\r\n        const x = j\r\n        positions.getValueRef(voff).set(x, y, 0.0)\r\n        voff++\r\n      }\r\n    }\r\n    this.setBoundingBoxDirty()\r\n  }\r\n}\r\n\r\nconst __cache = {}\r\n\r\n/** Class representing a GL trim curve draw set.\r\n * @ignore\r\n */\r\nclass GLTrimCurveDrawSet {\r\n  /**\r\n   * Create a GL trim curve draw set.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} detail - The detail value.\r\n   * @param {any} trimCurvesDataArray - The trimCurvesDataArray value.\r\n   */\r\n  constructor(gl, detail, trimCurvesDataArray) {\r\n    this.__gl = gl\r\n    this.__detail = detail\r\n\r\n    if (!__cache[detail]) {\r\n      __cache[detail] = {\r\n        glfangeom: new GLMesh(gl, new Fan(detail)),\r\n        glstripgeom: new GLMesh(gl, new Strip(detail)),\r\n      }\r\n    }\r\n    this.__glfangeom = __cache[detail].glfangeom\r\n    this.__glstripgeom = __cache[detail].glstripgeom\r\n\r\n    this.__buffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, trimCurvesDataArray, gl.STATIC_DRAW)\r\n\r\n    this.__drawCount = trimCurvesDataArray.length / numValuesPerTrimSetCurveRef\r\n  }\r\n\r\n  /**\r\n   * The bindAttr method.\r\n   * @param {any} location - The location param.\r\n   * @param {any} channels - The channels param.\r\n   * @param {any} type - The type param.\r\n   * @param {any} stride - The stride param.\r\n   * @param {any} offset - The offset param.\r\n   */\r\n  bindAttr(location, channels, type, stride, offset) {\r\n    if (location < 0) return\r\n    const gl = this.__gl\r\n    gl.enableVertexAttribArray(location)\r\n    gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n    gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n  }\r\n\r\n  // ////////////////////////////////////\r\n  // Drawing\r\n\r\n  /**\r\n   * The setBuffer method.\r\n   */\r\n  setBuffer() {}\r\n\r\n  /**\r\n   * The drawFans method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawFans(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    this.__glfangeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    this.bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 0)\r\n    this.bindAttr(attrs.data0.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 4)\r\n    this.bindAttr(attrs.data1.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 8)\r\n    this.bindAttr(attrs.data2.location, 2, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 12)\r\n\r\n    gl.uniform1i(unifs.numCurveVertices.location, this.__detail + 1)\r\n\r\n    this.__glfangeom.drawInstanced(this.__drawCount)\r\n  }\r\n\r\n  /**\r\n   * The drawStrips method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawStrips(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    this.__glstripgeom.bind(renderstate)\r\n\r\n    const unifs = renderstate.unifs\r\n    const attrs = renderstate.attrs\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.__buffer)\r\n    this.bindAttr(attrs.patchCoords.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 0)\r\n    this.bindAttr(attrs.data0.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 4)\r\n    this.bindAttr(attrs.data1.location, 4, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 8)\r\n    this.bindAttr(attrs.data2.location, 2, gl.FLOAT, numValuesPerTrimSetCurveRef * 4, 4 * 12)\r\n\r\n    gl.uniform1i(unifs.numCurveVertices.location, this.__detail + 1)\r\n\r\n    this.__glstripgeom.drawInstanced(this.__drawCount)\r\n  }\r\n\r\n  /**\r\n   * The cleanup method.\r\n   */\r\n  cleanup() {\r\n    // this.__gl.deleteBuffer(this.__buffer);\r\n  }\r\n}\r\n\r\nexport { GLTrimCurveDrawSet }\r\n","/* eslint-disable camelcase */\r\nimport { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL draw trim curve fans shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDrawTrimCurveFansShader extends GLShader {\r\n  /**\r\n   * Create a GL draw trim curve fans shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveFansShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute float vertexIds;\r\ninstancedattribute vec4 patchCoords;         // instanced attribute..\r\ninstancedattribute vec4 data0;     // instanced attribute..\r\ninstancedattribute vec4 data1;     // instanced attribute..\r\ninstancedattribute vec2 data2;     // instanced attribute..\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\n\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nuniform int numCurveVertices;\r\n\r\nstruct CurveRef {\r\n  int curveId;\r\n  vec2 tr;\r\n  mat2 mat;\r\n  int flags;\r\n\r\n  ivec2 addr;\r\n  int numCurveVertices;\r\n\r\n};\r\n\r\nvec2 getCurveVertex(in CurveRef curveRef, int vertexId) {\r\n    if(curveRef.flags != 0)\r\n      vertexId = curveRef.numCurveVertices - vertexId - 1;\r\n    return curveRef.tr + curveRef.mat * fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(curveRef.addr.x + vertexId, curveRef.addr.y)).rg;\r\n}\r\n\r\n\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D trimSetTexture;\r\nuniform ivec2 trimSetTextureSize;\r\n\r\n\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nCurveRef getCurveRef(inout GLSLBinReader trimsetDataReader, in int curveRefStart, inout GLSLBinReader curvesAtlasLayoutDataReader) {\r\n\r\n  CurveRef curveRef;\r\n\r\n  // Get the Curve Id from the trimSet Atlas\r\n  curveRef.curveId = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, curveRefStart + 0);\r\n\r\n  // Get the Xfo for the curve\r\n  curveRef.tr = vec2(\r\n    GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 1), \r\n    GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 2)\r\n    );\r\n  curveRef.mat = mat2(\r\n    vec2(\r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 3), \r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 4)\r\n    ),\r\n    vec2(\r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 5), \r\n      GLSLBinReader_readFloat(trimsetDataReader, trimSetTexture, curveRefStart + 6)\r\n    ));\r\n\r\n  // Get the flags for the curve\r\n  curveRef.flags = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, curveRefStart + 7);\r\n\r\n\r\n  curveRef.addr = ivec2(\r\n    GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 0), \r\n    GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 1)\r\n    );\r\n  curveRef.numCurveVertices = GLSLBinReader_readInt(curvesAtlasLayoutDataReader, curvesAtlasLayoutTexture, (curveRef.curveId * 8) + 2);\r\n\r\n  return curveRef;\r\n}\r\n\r\n\r\n\r\nvoid main(void) {\r\n\r\n  vec2 pos;\r\n  int vertexId = ftoi(vertexIds);\r\n  if(vertexId == 0) {\r\n    pos = (patchCoords.xy + patchCoords.zw * 0.5) / vec2(trimSetAtlasTextureSize);\r\n  }\r\n  else {\r\n    vertexId--;\r\n\r\n    CurveRef curveRef;\r\n    curveRef.tr = data0.xy;\r\n    curveRef.mat = mat2(data0.zw, data1.xy);\r\n    curveRef.flags = ftoi(data2.x);\r\n\r\n    curveRef.addr = ivec2(ftoi(data1.z), ftoi(data1.w));\r\n    curveRef.numCurveVertices = numCurveVertices;\r\n\r\n    //////////////////////////////////////////////\r\n    pos = getCurveVertex(curveRef, vertexId);\r\n\r\n    /*\r\n    //////////////////////////////////////////////\r\n    \r\n    int loopStartPos = ftoi(data0.x);\r\n    int curveIndexWithLoop = ftoi(data0.y);\r\n\r\n    GLSLBinReader trimsetDataReader;\r\n    GLSLBinReader_init(trimsetDataReader, trimSetTextureSize, 16);\r\n    int numCurves = GLSLBinReader_readInt(trimsetDataReader, trimSetTexture, loopStartPos);\r\n\r\n    GLSLBinReader curvesAtlasLayoutDataReader;\r\n    GLSLBinReader_init(curvesAtlasLayoutDataReader, curvesAtlasLayoutTextureSize, 32);\r\n\r\n    CurveRef curveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (curveIndexWithLoop * 8), curvesAtlasLayoutDataReader);\r\n    pos = getCurveVertex( curveRef, vertexId );\r\n\r\n\r\n    // Tranform the curve points by the xfo2d to put it into the coords of the trim set.\r\n    Xfo2d xfo2d = Xfo2d(data0.xy, data1.x, data0.zw);\r\n    pos = Xfo2D_transformVec2(xfo2d, pos);\r\n\r\n\r\n    //////////////////////////////////\r\n    // Due to the reduced precision we use to store our data\r\n    // we get cracks in the trim textures. To fix this we weld\r\n    // the end points of the trim curves here.\r\n    // For each end point of a curve, we find the joining end point \r\n    // and average their positions.\r\n\r\n    if(vertexId == 0) {\r\n      // Lookup the vertex of the previous curve.\r\n      int prevCurveIndexWithinLoop = curveIndexWithLoop - 1;\r\n      if(prevCurveIndexWithinLoop < 0)\r\n        prevCurveIndexWithinLoop += numCurves;\r\n      CurveRef prevCurveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (prevCurveIndexWithinLoop * 8), curvesAtlasLayoutDataReader);\r\n\r\n      // Get the end of the previous curve.\r\n      vec2 prevCurveEndPos = getCurveVertex( prevCurveRef, prevCurveRef.numCurveVertices-1 );\r\n\r\n      pos = (pos + prevCurveEndPos) * 0.5;\r\n    }\r\n    else if(vertexId == numCurveVertices-1) {\r\n      // Lookup the vertex of the next curve.\r\n      int nextCurveIndexWithinLoop = curveIndexWithLoop + 1;\r\n      if(nextCurveIndexWithinLoop >= numCurves)\r\n        nextCurveIndexWithinLoop = 0;\r\n      CurveRef nextCurveRef = getCurveRef(trimsetDataReader, loopStartPos + 1 + (nextCurveIndexWithinLoop * 8), curvesAtlasLayoutDataReader);\r\n\r\n      // Get the start of the next curve.\r\n      vec2 nextCurveEndPos = getCurveVertex( nextCurveRef, 0 );\r\n      pos = (pos + nextCurveEndPos) * 0.5;\r\n    }\r\n\r\n    */\r\n    //////////////////////////////////////////////\r\n\r\n\r\n    // Now transform the trim set into the coords of the full texture.\r\n    pos = (patchCoords.xy + (pos * patchCoords.zw));\r\n    pos /= vec2(trimSetAtlasTextureSize);\r\n  }\r\n\r\n  // transform the position into clip space.\r\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0), 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveFansShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    fragColor = vec4(1.0/255.0,0.0,0.0,1.0);\r\n    \r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawTrimCurveFansShader', GLDrawTrimCurveFansShader)\r\n\r\nexport { GLDrawTrimCurveFansShader }\r\n","/* eslint-disable camelcase */\r\nimport { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL flatten trim sets shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLFlattenTrimSetsShader extends GLShader {\r\n  /**\r\n   * Create a GL flatten trim sets shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLFlattenTrimSetsShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\nvoid main()\r\n{\r\n    v_texCoord = (positions.xy + 0.5);\r\n    gl_Position =  vec4(positions.xy * 2.0, 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLFlattenTrimSetsShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n\r\n// returns true if the texel will be kept\r\n// When the fans are rendered, the pixels are acumulated. \r\n// An even number means that the pixel should be discarded\r\n// and an odd number mean the pixel should be kept.\r\nbool sampleAtlas(vec2 offset){\r\n    return mod(texture2D(trimSetAtlasTexture, v_texCoord + (offset / vec2(trimSetAtlasTextureSize))).r * 255.0, 2.0) > 0.5;\r\n}\r\n\r\nint scoreAtlas(vec2 offset){\r\n  if(sampleAtlas(offset))\r\n    return 1;\r\n  else\r\n    return 0;\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n  // if(sampleAtlas(vec2(0.0, 0.0))){\r\n  //   fragColor = vec4(1.0, 0.5, 0.5, 1.0);\r\n  // }\r\n  // else{\r\n  //   fragColor = vec4(0.0, 0.5, 0.5, 1.0);\r\n  // }\r\n  \r\n  // Smoothing. Look at neighboring pixels to see\r\n  // if we should fill in the gaps. Due to floating\r\n  // point issues, we see random pixels floating\r\n  // in the air that shold have been trimmed by the\r\n  // fan. If a point \r\n  int score = scoreAtlas(vec2(-1.0, 0.0)) + \r\n              scoreAtlas(vec2(-1.0,-1.0)) + \r\n              scoreAtlas(vec2( 0.0,-1.0)) + \r\n              scoreAtlas(vec2( 1.0,-1.0)) + \r\n              scoreAtlas(vec2( 1.0, 0.0)) + \r\n              scoreAtlas(vec2( 1.0, 1.0)) + \r\n              scoreAtlas(vec2( 0.0, 1.0)) + \r\n              scoreAtlas(vec2(-1.0, 1.0));\r\n\r\n  float r = 0.0;\r\n  if(sampleAtlas(vec2(0.0, 0.0))){\r\n    if(score >= 4) // corner verts have a score of 3\r\n      r = 1.0;\r\n    else\r\n      r = 0.0;\r\n  }\r\n  else{\r\n    if(score < 4) \r\n      r = 0.0;\r\n    else\r\n      r = 1.0;\r\n  }\r\n  fragColor = vec4(r, r, 0.0, 0.0);\r\n  \r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nRegistry.register('GLFlattenTrimSetsShader', GLFlattenTrimSetsShader)\r\n\r\nexport { GLFlattenTrimSetsShader }\r\n","/* eslint-disable camelcase */\r\nimport { GLShader, shaderLibrary, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL draw trim curve strips shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDrawTrimCurveStripsShader extends GLShader {\r\n  /**\r\n   * Create a GL draw trim curve strips shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.__shaderStages['VERTEX_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveStripsShader.vertexShader',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\ninstancedattribute vec4 patchCoords;         // instanced attribute..\r\ninstancedattribute vec4 data0;     // instanced attribute..\r\ninstancedattribute vec4 data1;     // instanced attribute..\r\ninstancedattribute vec3 data2;     // instanced attribute..\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLMath.glsl\"/>\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nuniform int numCurveVertices;\r\nuniform float stripWidth;\r\n\r\nvec2 getCurveVertex(int vertexId, int flags) {\r\n  if(flags != 0)\r\n    vertexId = numCurveVertices - vertexId - 1;\r\n  return fetchTexel(curvesAtlasTexture, trimSetAtlasTextureSize, ivec2(int(data1.z) + vertexId, int(data1.w))).rg;\r\n}\r\n\r\n#define M_PI 3.1415926535897932384626433832795\r\n\r\n/* VS Outputs */\r\nvarying float v_curveIndexWithinLoop;\r\nvarying float v_gradient;\r\n\r\nvoid main(void) {\r\n\r\n  int vertexId = ftoi(positions.x);\r\n  float side = positions.y < 0.0 ? -1.0 : 1.0;\r\n  mat2 rot = mat2(data0.zw, data1.xy);\r\n  int curveRefFlags = ftoi(data2.x);\r\n  int curveIndexWithinLoop = ftoi(data2.y);\r\n  v_curveIndexWithinLoop = float(curveIndexWithinLoop);\r\n\r\n  // Tranform the curve points by the mat2 to put it into the coords of the trim set.\r\n  vec2 pos = data0.xy + (rot * getCurveVertex(vertexId, curveRefFlags));\r\n\r\n  //////////////////////////////////////////////\r\n  vec2 curveTangent;\r\n  if(vertexId > 0) {\r\n    vec2 posPrev = data0.xy + (rot * getCurveVertex(vertexId-1, curveRefFlags));\r\n    curveTangent += pos - posPrev;\r\n  }\r\n  if(vertexId < numCurveVertices-1) {\r\n    vec2 posNext = data0.xy + (rot * getCurveVertex(vertexId+1, curveRefFlags));\r\n    curveTangent += posNext - pos;\r\n  }\r\n  curveTangent = normalize(curveTangent);\r\n  vec2 curveNormal = vec2(-curveTangent.y, curveTangent.x);\r\n\r\n  // Fatten the strip\r\n  pos += (curveNormal * side * stripWidth) / patchCoords.zw;\r\n\r\n  //////////////////////////////////////////////\r\n  // Extend the strip by one pixel at each end.\r\n  if(vertexId == 0) {\r\n    pos -= curveTangent * (stripWidth / patchCoords.zw) * 0.5;\r\n  }\r\n  else if(vertexId == numCurveVertices-1) {\r\n    pos += curveTangent * (stripWidth / patchCoords.zw) * 0.5;\r\n  }\r\n  //////////////////////////////////////////////\r\n\r\n  // Now transform the trim set into the coords of the full texture.\r\n  pos = (patchCoords.xy + (pos * patchCoords.zw));\r\n  pos /= vec2(trimSetAtlasTextureSize);\r\n\r\n  // transform the position into clip space.\r\n  gl_Position = vec4((pos * 2.0) - 1.0, 0.0, 1.0);\r\n  \r\n\r\n  // The gradient should run 0.0 ... 1.0 from one side of the strip to the other.\r\n  // The side value ranges from -1.0 to +1.0\r\n\r\n  v_gradient = (side + 1.0) / 2.0;\r\n  // v_gradient = 1.0;\r\n\r\n  // Note: this causes the trim edge to move slightly to grow.\r\n  // This fills in slight gaps betwen trimmed surfaces.\r\n  // This causes lots of atrifacts on some thin surfaces\r\n  // On Mordacious, this causese many artifacts at the border of surfaces.\r\n  // v_gradient = (v_gradient * 1.1) + 0.05;\r\n  // v_gradient = (v_gradient * 1.2) + 0.1;\r\n  // v_gradient = (v_gradient * 1.5) + 0.25;\r\n  // v_gradient = (v_gradient * 2.0) + 0.5;\r\n  // v_gradient = (v_gradient * 2.0) + 1.0;\r\n}\r\n`\r\n    )\r\n\r\n    this.__shaderStages['FRAGMENT_SHADER'] = shaderLibrary.parseShader(\r\n      'GLDrawTrimCurveStripsShader.fragmentShader',\r\n      `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n\r\nuniform int flatten;\r\n\r\n/* VS Outputs */\r\nvarying float v_curveIndexWithinLoop;\r\nvarying float v_gradient;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n  // Initially a build up the data around the edges by rasterizing a full color pixel,\r\n  // followed by a subtractive pass that cuts down the borders\r\n  //\r\n  // Initially, after the fans are rasterized \r\n  //     ----\r\n  //  .  |  .\r\n  //  .  |  .\r\n  //     ----\r\n  //\r\n  // Becomes \r\n  //  -------\r\n  //  .     .\r\n  //  .     .\r\n  //  -------\r\n  //\r\n  // Becomes \r\n  //    . ---\r\n  //    ./     \r\n  //   /. \r\n  //  -------\r\n  // After the subtraction pass\r\n\r\n\r\n  \r\n  if (flatten > 0) {\r\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n  } else {\r\n    int curveIndexWithinLoop = ftoi(v_curveIndexWithinLoop);\r\n    if (curveIndexWithinLoop % 2 == 0) {\r\n      fragColor = vec4(v_gradient, 1.0, 1.0, 1.0);\r\n    }\r\n    else {\r\n      fragColor = vec4(1.0, v_gradient, 1.0, 1.0);\r\n    }\r\n  }\r\n    \r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawTrimCurveStripsShader', GLDrawTrimCurveStripsShader)\r\n\r\nexport { GLDrawTrimCurveStripsShader }\r\n","/* eslint-disable camelcase */\r\nimport { GLShader } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL debug trim sets shader.\r\n * @extends GLShader\r\n * @ignore\r\n */\r\nclass GLDebugTrimSetsShader extends GLShader {\r\n  /**\r\n   * Create a GL debug trim sets shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.setShaderStage(\r\n      'VERTEX_SHADER',\r\n      `\r\nprecision highp float;\r\n\r\nattribute vec4 positions;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\nvoid main()\r\n{\r\n    v_texCoord = (positions.xy + 0.5);\r\n    gl_Position =  vec4(positions.xy * 2.0, 0.0, 1.0);\r\n    // gl_Position =  vec4(positions.xy + vec2(-0.5, 0.5), 0.0, 1.0);\r\n}\r\n`\r\n    )\r\n    this.setShaderStage(\r\n      'FRAGMENT_SHADER',\r\n      `\r\nprecision highp float;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\n\r\n/* VS Outputs */\r\nvarying vec2 v_texCoord;\r\n \r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n  vec4 fragColor;\r\n#endif\r\n\r\n  vec4 col = texture2D(trimSetAtlasTexture, v_texCoord);\r\n  vec3 rgb = col.rgb / col.a;\r\n  fragColor = vec4(rgb,1.0);\r\n  \r\n#ifndef ENABLE_ES3\r\n  gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n    )\r\n  }\r\n}\r\n\r\nexport { GLDebugTrimSetsShader }\r\n","import { GLFbo, GLTexture2D } from '@zeainc/zea-engine'\r\nimport { GLTrimCurveDrawSet } from './GLTrimCurveDrawSet.js'\r\n\r\nimport { GLDrawTrimCurveFansShader } from './GLDrawTrimCurveFansShader.js'\r\nimport { GLFlattenTrimSetsShader } from './GLFlattenTrimSetsShader.js'\r\nimport { GLDrawTrimCurveStripsShader } from './GLDrawTrimCurveStripsShader.js'\r\nimport { GLDebugTrimSetsShader } from './GLDebugTrimSetsShader.js'\r\n\r\n/** Class representing a GL trim set library.\r\n * @ignore\r\n */\r\nclass GLTrimSetLibrary {\r\n  /**\r\n   * Create a GL trim set library.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   * @param {any} trimSetLibrary - The trimSetLibrary value.\r\n   * @param {any} glCurvesLibrary - The glCurvesLibrary value.\r\n   */\r\n  constructor(gl, cadpassdata, trimSetLibrary, glCurvesLibrary) {\r\n    this.__gl = gl\r\n    this.__cadpassdata = cadpassdata\r\n    this.__trimSetLibrary = trimSetLibrary\r\n    this.__glCurvesLibrary = glCurvesLibrary\r\n\r\n    const trimSetsBuffer = this.__trimSetLibrary.getBinaryBuffer()\r\n    const trimSetsTexSize = Math.sqrt(trimSetsBuffer.byteLength / 8)\r\n    this.__trimSetsTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'HALF_FLOAT',\r\n      width: trimSetsTexSize,\r\n      height: trimSetsTexSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: new Uint16Array(trimSetsBuffer)\r\n    })\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.__trimCurveDrawSets = {}\r\n  }\r\n\r\n  // /////////////////////////////////////////////////////////////\r\n  // Trim Sets\r\n\r\n  /**\r\n   * The evaluateTrimSets method.\r\n   * @param {any} trimCurveDrawSets - The trimCurveDrawSets param.\r\n   * @param {any} trimSetAtlasTextureSize - The trimSetAtlasTextureSize param.\r\n   * @param {any} trimSetsAtlasLayoutData - The trimSetsAtlasLayoutData param.\r\n   * @param {any} trimSetsAtlasLayoutTextureSize - The trimSetsAtlasLayoutTextureSize param.\r\n   */\r\n  evaluateTrimSets(\r\n    trimCurveDrawSets,\r\n    trimSetAtlasTextureSize,\r\n    trimSetsAtlasLayoutData,\r\n    trimSetsAtlasLayoutTextureSize\r\n  ) {\r\n    // console.log(\"evaluateTrimSets:\" + trimSetAtlasTextureSize);\r\n    const gl = this.__gl\r\n\r\n    {\r\n      this.__trimSetsAtlasLayoutTexture = new GLTexture2D(this.__gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width: trimSetsAtlasLayoutTextureSize[0],\r\n        height: trimSetsAtlasLayoutTextureSize[1],\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n        data: trimSetsAtlasLayoutData\r\n      })\r\n    }\r\n\r\n    if (!this.__trimSetAtlasTexture) {\r\n      this.__trimSetAtlasTextureSize = trimSetAtlasTextureSize\r\n\r\n      if (\r\n        this.__trimSetAtlasTextureSize[0] > this.__cadpassdata.maxTexSize ||\r\n        this.__trimSetAtlasTextureSize[1] > this.__cadpassdata.maxTexSize\r\n      ) {\r\n        console.warn(\r\n          'trimSetAtlas  is too big to fit in a texture. The image will be downsized:' +\r\n            this.__trimSetAtlasTextureSize +\r\n            ' maxTexSize:' +\r\n            this.__cadpassdata.maxTexSize\r\n        )\r\n      }\r\n\r\n      this.__trimSetAtlasMaskTexture = new GLTexture2D(gl, {\r\n        format: gl.name == 'webgl2' ? 'RG' : 'RGBA',\r\n        type: 'UNSIGNED_BYTE',\r\n        width: Math.min(this.__trimSetAtlasTextureSize[0], this.__cadpassdata.maxTexSize),\r\n        height: Math.min(this.__trimSetAtlasTextureSize[1], this.__cadpassdata.maxTexSize),\r\n        filter: 'NEAREST'\r\n      })\r\n      this.__trimSetAtlasMaskFbo = new GLFbo(gl, this.__trimSetAtlasMaskTexture)\r\n      this.__trimSetAtlasMaskFbo.setClearColor([0, 0, 0, 0])\r\n\r\n      // Multi-channel signed distance field\r\n      // https://steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\r\n      // See: 4.3\r\n      const format = gl.name == 'webgl2' ? 'RG' : 'RGBA'\r\n      const filter = 'LINEAR'\r\n\r\n      this.__trimSetAtlasTexture = new GLTexture2D(gl, {\r\n        format,\r\n        type: 'UNSIGNED_BYTE',\r\n        width: Math.min(this.__cadpassdata.maxTexSize, this.__trimSetAtlasTextureSize[0]),\r\n        height: Math.min(this.__cadpassdata.maxTexSize, this.__trimSetAtlasTextureSize[1]),\r\n        magFilter: filter,\r\n        minFilter: filter\r\n      })\r\n\r\n      this.__trimSetAtlasFbo = new GLFbo(gl, this.__trimSetAtlasTexture)\r\n      this.__trimSetAtlasFbo.setClearColor([0, 0, 0, 0])\r\n    } else if (\r\n      this.__trimSetAtlasTexture.width != trimSetAtlasTextureSize[0] ||\r\n      this.__trimSetAtlasTexture.height != trimSetAtlasTextureSize[1]\r\n    ) {\r\n      this.__trimSetAtlasTextureSize = trimSetAtlasTextureSize\r\n\r\n      // Copy the previous image into a new one, and then destroy the prvious.\r\n      this.__trimSetAtlasTexture.resize(trimSetAtlasTextureSize[0], trimSetAtlasTextureSize[1], true)\r\n      this.__trimSetAtlasFbo.resize() // hack to rebind the texture. Refactor the way textures are resized.\r\n\r\n      // this.__trimSetAtlasFbo.bind();\r\n    }\r\n\r\n    const renderstate = {}\r\n\r\n    // ////////////////////////////////////////////////\r\n    // Render the mask aread using fans\r\n\r\n    if (!this.trimCurveFansShader) {\r\n      this.trimCurveFansShader = new GLDrawTrimCurveFansShader(gl)\r\n      this.flattenTrimSetsShader = new GLFlattenTrimSetsShader(gl)\r\n      this.trimCurveStripsShader = new GLDrawTrimCurveStripsShader(gl)\r\n      this.debugTrimSetsShader = new GLDebugTrimSetsShader(gl)\r\n    }\r\n\r\n    this.__trimSetAtlasMaskFbo.bindAndClear()\r\n\r\n    {\r\n      // / Setup additive blending so that all rendering passes accumulate into the same Fbo.\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.FUNC_ADD)\r\n      gl.blendFunc(gl.ONE, gl.ONE)\r\n\r\n      this.trimCurveFansShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n\r\n      this.__glCurvesLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      gl.uniform2i(\r\n        unifs.trimSetAtlasTextureSize.location,\r\n        this.__trimSetAtlasTextureSize[0],\r\n        this.__trimSetAtlasTextureSize[1]\r\n      )\r\n\r\n      // For vertex welding (Not yet implemented)\r\n      if (unifs.trimSetTexture) {\r\n        this.__trimSetsTexture.bindToUniform(renderstate, unifs.trimSetTexture)\r\n        if (unifs.trimSetTextureSize)\r\n          gl.uniform2i(unifs.trimSetTextureSize.location, this.__trimSetsTexture.width, this.__trimSetsTexture.height)\r\n\r\n        this.__trimSetsAtlasLayoutTexture.bindToUniform(renderstate, unifs.curvesAtlasLayoutTexture)\r\n        if (unifs.curvesAtlasLayoutTextureSize)\r\n          gl.uniform2i(\r\n            unifs.curvesAtlasLayoutTextureSize.location,\r\n            this.__trimSetsAtlasLayoutTexture.width,\r\n            this.__trimSetsAtlasLayoutTexture.height\r\n          )\r\n      }\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(this.__gl, detail, trimCurveDrawSets[key])\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawFans(renderstate)\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    // ////////////////////////////////////////////////////\r\n    // Render the float texture as a signed distance field\r\n\r\n    this.__trimSetAtlasFbo.bindAndClear()\r\n\r\n    // if(false)\r\n    {\r\n      // /////////////////////////\r\n      // Flatten the fans texture\r\n      this.flattenTrimSetsShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n      this.__trimSetAtlasMaskTexture.bindToUniform(renderstate, unifs.trimSetAtlasTexture)\r\n      if (unifs.trimSetAtlasTextureSize)\r\n        this.__gl.uniform2i(\r\n          unifs.trimSetAtlasTextureSize.location,\r\n          this.__trimSetAtlasTextureSize[0],\r\n          this.__trimSetAtlasTextureSize[1]\r\n        )\r\n      this.__cadpassdata.glplanegeom.bind(renderstate)\r\n      this.__cadpassdata.glplanegeom.draw()\r\n    }\r\n\r\n    // //////////////////////////////////////\r\n    // Draw the Strips to clean up the edges\r\n    // if(false)\r\n    {\r\n      this.trimCurveStripsShader.bind(renderstate)\r\n      const unifs = renderstate.unifs\r\n\r\n      this.__glCurvesLibrary.bindCurvesAtlas(renderstate)\r\n\r\n      gl.uniform2i(\r\n        unifs.trimSetAtlasTextureSize.location,\r\n        this.__trimSetAtlasTextureSize[0],\r\n        this.__trimSetAtlasTextureSize[1]\r\n      )\r\n      gl.uniform1f(unifs.stripWidth.location, 1.25)\r\n\r\n      // Initially a build up the data around the edges by rasterizing a full color pixel,\r\n      // followed by a subtractive pass that cuts down the borders\r\n      //\r\n      // Initially, after the fans are rasterized.\r\n      //     ----\r\n      //  .  |  .\r\n      //  .  |  .\r\n      //     ----\r\n      //\r\n      // Becomes\r\n      //  -------\r\n      //  .     .\r\n      //  .     .\r\n      //  -------\r\n      //\r\n      // Becomes\r\n      //    . ---\r\n      //    ./\r\n      //   /.\r\n      //  -------\r\n      // After the subtraction pass\r\n      gl.uniform1i(unifs.flatten.location, 1)\r\n      gl.disable(gl.BLEND)\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(this.__gl, detail, trimCurveDrawSets[key])\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawStrips(renderstate)\r\n      }\r\n\r\n      // Now subtract the gradient.\r\n      gl.uniform1i(unifs.flatten.location, 0)\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.MIN)\r\n      gl.blendFunc(gl.ONE, gl.ONE)\r\n\r\n      for (const key in trimCurveDrawSets) {\r\n        const detail = parseInt(key)\r\n        if (detail < 0) continue\r\n        let trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n        if (!trimCurveDrawSet) {\r\n          trimCurveDrawSet = new GLTrimCurveDrawSet(this.__gl, detail, trimCurveDrawSets[key])\r\n          this.__trimCurveDrawSets[key] = trimCurveDrawSet\r\n        }\r\n        trimCurveDrawSet.drawStrips(renderstate)\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    for (const key in trimCurveDrawSets) {\r\n      const trimCurveDrawSet = this.__trimCurveDrawSets[key]\r\n      if (trimCurveDrawSet) trimCurveDrawSet.cleanup()\r\n    }\r\n\r\n    this.__trimSetsAtlasLayoutData = trimSetsAtlasLayoutData\r\n    // console.log(\"----------------------------------\");\r\n    // const st_x = Math.round(trimSetAtlasTextureSize[0] / 2)\r\n    // const st_y = trimSetAtlasTextureSize[0] - 4;; //Math.round(trimSetAtlasTextureSize[1] / 2)\r\n    // gl.finish();\r\n    // this.logTrimSet(0);\r\n\r\n    gl.finish()\r\n  }\r\n\r\n  /**\r\n   * The logTrimSetMask method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   */\r\n  logTrimSetMask(trimSetId) {\r\n    const gl = this.__gl\r\n    this.__trimSetAtlasMaskFbo.bind()\r\n    const layout = [\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 0],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 1],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 2],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 3]\r\n    ]\r\n    console.log('logTrimSetMask ' + trimSetId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3])\r\n    const pixels = new Uint8Array(layout[2] * 4)\r\n    for (let i = 0; i < layout[3]; i++) {\r\n      gl.readPixels(\r\n        layout[0],\r\n        layout[1] + i,\r\n        layout[2],\r\n        1,\r\n        gl.name == 'webgl2' ? gl.RED : gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        pixels\r\n      )\r\n      let line = i + ' '\r\n      for (let j = 0; j < layout[2]; j++) {\r\n        // line += (pixels[j * 4] % 2 == 0 ? '-' : '*');\r\n        line += pixels[j * 4]\r\n      }\r\n      console.log(line)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The logTrimSet method.\r\n   * @param {any} trimSetId - The trimSetId param.\r\n   */\r\n  logTrimSet(trimSetId) {\r\n    const gl = this.__gl\r\n    this.__trimSetAtlasFbo.bind()\r\n    const layout = [\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 0],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 1],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 2],\r\n      this.__trimSetsAtlasLayoutData[trimSetId * 4 + 3]\r\n    ]\r\n    console.log('logTrimSet ' + trimSetId + ':[' + layout[0] + ',' + layout[1] + ']:' + layout[2] + 'x' + layout[3])\r\n    const pixels = new Uint16Array(layout[2] * 4)\r\n    for (let i = 0; i < layout[3]; i++) {\r\n      gl.readPixels(layout[0], layout[1] + i, layout[2], 1, gl.RGBA, gl.HALF_FLOAT, pixels)\r\n      let line = i + ' '\r\n      for (let j = 0; j < layout[2]; j++) {\r\n        // line += (pixels[j * 4] % 2 == 0 ? '-' : '*');\r\n        line += pixels[j * 4]\r\n      }\r\n      console.log(line)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindTrimSetAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindTrimSetAtlas(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    const { trimSetAtlasTexture, trimSetAtlasTextureSize } = unifs\r\n    if (this.__trimSetAtlasTexture && trimSetAtlasTexture) {\r\n      this.__trimSetAtlasTexture.bindToUniform(renderstate, trimSetAtlasTexture)\r\n      if (trimSetAtlasTextureSize) {\r\n        gl.uniform2i(\r\n          trimSetAtlasTextureSize.location,\r\n          this.__trimSetAtlasTextureSize[0],\r\n          this.__trimSetAtlasTextureSize[1]\r\n        )\r\n      }\r\n\r\n      if (this.ext_filter_anisotropic) {\r\n        // Disable anisotropic filtering on this texture.\r\n        gl.texParameterf(gl.TEXTURE_2D, this.ext_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, 1.0)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindTrimSetAtlasLayout method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  bindTrimSetAtlasLayout(renderstate) {\r\n    // During debugging, we disable trim sets.\r\n    if (!this.__trimSetsAtlasLayoutTexture) return\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    this.__trimSetsAtlasLayoutTexture.bindToUniform(renderstate, unifs.trimSetsAtlasLayoutTexture)\r\n    gl.uniform2i(\r\n      unifs.trimSetsAtlasLayoutTextureSize.location,\r\n      this.__trimSetsAtlasLayoutTexture.width,\r\n      this.__trimSetsAtlasLayoutTexture.height\r\n    )\r\n  }\r\n\r\n  /**\r\n   * The drawTrimSets method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {boolean} - The return value.\r\n   */\r\n  drawTrimSets(renderstate) {\r\n    if (!this.__trimSetAtlasTexture || !this.debugTrimSetsShader.bind(renderstate)) return false\r\n    // this.bindTrimSetAtlas(renderstate);\r\n\r\n    this.__trimSetAtlasTexture.bindToUniform(renderstate, renderstate.unifs.trimSetAtlasTexture)\r\n    this.__cadpassdata.glplanegeom.bind(renderstate)\r\n    this.__cadpassdata.glplanegeom.draw()\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__trimSetsTexture.destroy()\r\n    if (this.__trimSetsAtlasLayoutTexture) {\r\n      this.__trimSetsAtlasLayoutTexture.destroy()\r\n      this.__trimSetAtlasMaskTexture.destroy()\r\n      this.__trimSetAtlasMaskFbo.destroy()\r\n      this.__trimSetAtlasTexture.destroy()\r\n      this.__trimSetAtlasFbo.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLTrimSetLibrary }\r\n","/* eslint-disable require-jsdoc */\r\nimport { EventEmitter } from '@zeainc/zea-engine'\r\nimport './CADBody.js'\r\n\r\nimport { floatsPerSceneBody, BODY_FLAG_CUTAWAY, BODY_FLAG_INVISIBLE } from './CADConstants.js'\r\n\r\n/** Class representing a GLCADBody.\r\n * @ignore\r\n */\r\nexport class GLCADBody extends EventEmitter {\r\n  constructor(cadBody, bodyId) {\r\n    super()\r\n    this.cadBody = cadBody\r\n    this.bodyId = bodyId\r\n    this.flags = 0\r\n\r\n    this.dirtyValues = new Set()\r\n  }\r\n\r\n  bind(\r\n    cadpassdata,\r\n    sceneBodyItemData,\r\n    cadBodyTextureData,\r\n    bodyItemDataChanged,\r\n    highlightedBodies,\r\n    highlightChangeBatch,\r\n    pushhighlightChangeBatchToWorker\r\n  ) {\r\n    this.cadBodyTextureData = cadBodyTextureData\r\n\r\n    const cadBodyDescAddr = this.cadBody.getBodyDataTexelCoords()\r\n\r\n    // const offset = bodyId * floatsPerSceneBody\r\n    if (!this.cadBody.isVisible()) this.flags |= BODY_FLAG_INVISIBLE\r\n\r\n    if (this.cadBody.isCutawayEnabled && this.cadBody.isCutawayEnabled()) {\r\n      this.flags |= BODY_FLAG_CUTAWAY\r\n    }\r\n\r\n    const material = this.cadBody.getMaterial()\r\n\r\n    const shaderId = cadpassdata.genShaderID(material.getShaderName())\r\n    // console.log('Shader:' + material.getShaderName() + ':' + shaderId);\r\n    let glmaterialcoords = material.getMetadata('glmaterialcoords')\r\n    if (!glmaterialcoords) {\r\n      glmaterialcoords = cadpassdata.materialLibrary.addMaterial(material)\r\n    }\r\n\r\n    sceneBodyItemData[0] = this.cadBody.getBodyDescId()\r\n    sceneBodyItemData[1] = shaderId\r\n\r\n    cadBodyTextureData[0] = this.cadBody.getBodyDescId()\r\n    cadBodyTextureData[1] = this.flags\r\n    cadBodyTextureData[2] = cadBodyDescAddr.x\r\n    cadBodyTextureData[3] = cadBodyDescAddr.y\r\n\r\n    cadBodyTextureData[4] = glmaterialcoords.x\r\n    cadBodyTextureData[5] = glmaterialcoords.y\r\n\r\n    this.visibilityChanged = () => {\r\n      // TODO: Actually modify the draw sets for each visibility chage.\r\n      // It should be similar to hilight changes.\r\n      const visibile = this.cadBody.isVisible()\r\n      if (!visibile) {\r\n        if ((this.flags & BODY_FLAG_INVISIBLE) == 0) {\r\n          this.flags |= BODY_FLAG_INVISIBLE\r\n          this.cadBodyTextureData[1] = this.flags\r\n          bodyItemDataChanged(this.bodyId)\r\n        }\r\n      } else {\r\n        if ((this.flags & BODY_FLAG_INVISIBLE) != 0) {\r\n          this.flags &= ~BODY_FLAG_INVISIBLE\r\n          this.cadBodyTextureData[1] = this.flags\r\n          bodyItemDataChanged(this.bodyId)\r\n        }\r\n      }\r\n    }\r\n    this.cadBody.on('visibilityChanged', this.visibilityChanged)\r\n\r\n    this.materialChanged = () => {\r\n      const material = this.cadBody.getMaterial()\r\n      let glmaterialcoords = material.getMetadata('glmaterialcoords')\r\n      if (!glmaterialcoords) {\r\n        glmaterialcoords = cadpassdata.materialLibrary.addMaterial(material)\r\n      }\r\n      cadBodyTextureData[4] = glmaterialcoords.x\r\n      cadBodyTextureData[5] = glmaterialcoords.y\r\n      bodyItemDataChanged(this.bodyId)\r\n    }\r\n    this.cadBody.getParameter('Material').on('valueChanged', this.materialChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Body Xfo\r\n    this.globalXfoParam = this.cadBody.getParameter('GlobalXfo')\r\n    this.updateXfo()\r\n    this.globalXfoChanged = () => {\r\n      bodyItemDataChanged(this.bodyId)\r\n      this.dirtyValues.add('Xfo')\r\n    }\r\n    this.globalXfoParam.on('valueChanged', this.globalXfoChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Highlight\r\n    if (this.cadBody.isHighlighted()) {\r\n      this.updateHighlightColor()\r\n      highlightedBodies.push(this.bodyId)\r\n    }\r\n\r\n    this.highlightChanged = () => {\r\n      if (!highlightChangeBatch.dirty) {\r\n        setTimeout(pushhighlightChangeBatchToWorker, 1)\r\n        highlightChangeBatch.dirty = true\r\n      }\r\n      const highlighted = this.cadBody.isHighlighted()\r\n      if (highlighted) {\r\n        this.dirtyValues.add('Highlight')\r\n        bodyItemDataChanged(this.bodyId)\r\n        if (highlightedBodies.indexOf(this.bodyId) == -1) {\r\n          highlightedBodies.push(this.bodyId)\r\n\r\n          // Note: filter out highlight/unhighlight in a single update.\r\n          const indexInSelChangeSet = highlightChangeBatch.unhighlightedBodyIds.indexOf(this.bodyId)\r\n          if (indexInSelChangeSet != -1) {\r\n            highlightChangeBatch.unhighlightedBodyIds.splice(indexInSelChangeSet, 1)\r\n          } else {\r\n            highlightChangeBatch.highlightedBodyIds.push(this.bodyId)\r\n          }\r\n        }\r\n      } else {\r\n        const index = highlightedBodies.indexOf(this.bodyId)\r\n        if (index != -1) {\r\n          highlightedBodies.splice(index, 1)\r\n\r\n          // Note: filter out highlight/unhighlight in a single update.\r\n          const indexInSelChangeSet = highlightChangeBatch.highlightedBodyIds.indexOf(this.bodyId)\r\n          if (indexInSelChangeSet != -1) {\r\n            highlightChangeBatch.highlightedBodyIds.splice(indexInSelChangeSet, 1)\r\n          } else {\r\n            highlightChangeBatch.unhighlightedBodyIds.push(this.bodyId)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.cadBody.on('highlightChanged', this.highlightChanged)\r\n\r\n    // /////////////////////////////////\r\n    // Body Cut Plane\r\n    this.updateCutaway()\r\n    this.cutAwayChangedId = this.cadBody.on('cutAwayChanged', () => {\r\n      bodyItemDataChanged(this.bodyId)\r\n      this.dirtyValues.add('Cutaway')\r\n    })\r\n  }\r\n\r\n  updateCutaway() {\r\n    const cpoff = 24\r\n    if (this.cadBody.isCutawayEnabled()) {\r\n      if (!(this.flags & BODY_FLAG_CUTAWAY)) {\r\n        this.flags |= BODY_FLAG_CUTAWAY\r\n        this.cadBodyTextureData[1] = this.flags\r\n      }\r\n\r\n      const cutPlane = this.cadBody.getCutVector()\r\n      const cutPlaneDist = this.cadBody.getCutDist()\r\n      this.cadBodyTextureData[cpoff + 0] = cutPlane.x\r\n      this.cadBodyTextureData[cpoff + 1] = cutPlane.y\r\n      this.cadBodyTextureData[cpoff + 2] = cutPlane.z\r\n      this.cadBodyTextureData[cpoff + 3] = cutPlaneDist\r\n    } else {\r\n      if (this.flags & BODY_FLAG_CUTAWAY) {\r\n        this.flags &= ~BODY_FLAG_CUTAWAY\r\n        this.cadBodyTextureData[1] = this.flags\r\n      }\r\n    }\r\n  }\r\n\r\n  updateHighlightColor() {\r\n    const highlight = this.cadBody.getHighlight()\r\n    if (highlight) {\r\n      const hoff = 20\r\n      this.cadBodyTextureData[hoff + 0] = highlight.r\r\n      this.cadBodyTextureData[hoff + 1] = highlight.g\r\n      this.cadBodyTextureData[hoff + 2] = highlight.b\r\n      this.cadBodyTextureData[hoff + 3] = highlight.a\r\n    }\r\n  }\r\n\r\n  updateXfo() {\r\n    const bodyXfo = this.globalXfoParam.getValue()\r\n\r\n    const off = 8\r\n    this.cadBodyTextureData[off + 0] = bodyXfo.tr.x\r\n    this.cadBodyTextureData[off + 1] = bodyXfo.tr.y\r\n    this.cadBodyTextureData[off + 2] = bodyXfo.tr.z\r\n    // this.cadBodyTextureData[off + 3]\r\n    this.cadBodyTextureData[off + 4] = bodyXfo.ori.x\r\n    this.cadBodyTextureData[off + 5] = bodyXfo.ori.y\r\n    this.cadBodyTextureData[off + 6] = bodyXfo.ori.z\r\n    this.cadBodyTextureData[off + 7] = bodyXfo.ori.w\r\n    this.cadBodyTextureData[off + 8] = bodyXfo.sc.x\r\n    this.cadBodyTextureData[off + 9] = bodyXfo.sc.y\r\n    this.cadBodyTextureData[off + 10] = bodyXfo.sc.z\r\n  }\r\n\r\n  updateCadBodyTex() {\r\n    this.dirtyValues.forEach((key) => {\r\n      if (key == 'Xfo') this.updateXfo()\r\n      else if (key == 'Highlight') this.updateHighlightColor()\r\n      else if (key == 'Cutaway') this.updateCutaway()\r\n    })\r\n    this.dirtyValues.clear()\r\n  }\r\n\r\n  destroy() {\r\n    this.cadBody.off('visibilityChanged', this.visibilityChanged)\r\n    if (this.cadBody.cutAwayChanged) {\r\n      this.cadBody.off('cutAwayChanged', this.cutAwayChangedId)\r\n    } else {\r\n      const cutParam = this.cadBody.getParameter('CutawayEnabled')\r\n      if (cutParam) {\r\n        cutParam.off('valueChanged', this.cutAwayEnabledId)\r\n      }\r\n    }\r\n    this.cadBody.getParameter('Material').off('valueChanged', this.materialChanged)\r\n    this.cadBody.getParameter('GlobalXfo').off('valueChanged', this.globalXfoChanged)\r\n    this.cadBody.off('highlightChanged', this.highlightChanged)\r\n  }\r\n}\r\n","const kIsNodeJS = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';\nconst kRequire = kIsNodeJS && typeof module.require === 'function' ? module.require : null; // eslint-disable-line\n\nexport function createInlineWorkerFactory(fn, sourcemap = null) {\n    const source = fn.toString();\n    const start = source.indexOf('\\n', 10) + 1;\n    const end = source.indexOf('}', source.length - 1);\n    const body = source.substring(start, end) + (sourcemap ? `\\/\\/# sourceMappingURL=${sourcemap}` : '');\n    const blankPrefixLength = body.search(/\\S/);\n    const lines = body.split('\\n').map(line => line.substring(blankPrefixLength) + '\\n');\n\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        const concat = lines.join('\\n');\n        return function WorkerFactory(options) {\n            return new Worker(concat, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob(lines, { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function createURLWorkerFactory(url) {\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(url, options);\n        };\n    }\n    /* browser */\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n\nexport function browserDecodeBase64(base64, enableUnicode) {\n    const binaryString = atob(base64);\n    if (enableUnicode) {\n        const binaryView = new Uint8Array(binaryString.length);\n        Array.prototype.forEach.call(binaryView, (el, idx, arr) => {\n            arr[idx] = binaryString.charCodeAt(idx);\n        });\n        return String.fromCharCode.apply(null, new Uint16Array(binaryView.buffer));\n    }\n    return binaryString;\n}\n\nexport function nodeDecodeBase64(base64, enableUnicode) {\n    return Buffer.from(base64, 'base64').toString(enableUnicode ? 'utf16' : 'utf8');\n}\n\nexport function createBase64WorkerFactory(base64, sourcemap = null, enableUnicode = false) {\n    const source = kIsNodeJS ? nodeDecodeBase64(base64, enableUnicode) : browserDecodeBase64(base64, enableUnicode);\n    const start = source.indexOf('\\n', 10) + 1;\n    const body = source.substring(start) + (sourcemap ? `\\/\\/# sourceMappingURL=${sourcemap}` : '');\n\n    if (kRequire) {\n        /* node.js */\n        const Worker = kRequire('worker_threads').Worker; // eslint-disable-line\n        return function WorkerFactory(options) {\n            return new Worker(body, Object.assign({}, options, { eval: true }));\n        };\n    }\n\n    /* browser */\n    const blob = new Blob([body], { type: 'application/javascript' });\n    const url = URL.createObjectURL(blob);\n    return function WorkerFactory(options) {\n        return new Worker(url, options);\n    };\n}\n","import { EventEmitter, Vec3, GLTexture2D, MathFunctions } from '@zeainc/zea-engine'\r\nimport { CADBody } from './CADBody.js'\r\nimport { GLSurfaceDrawSet } from './GLSurfaceDrawSet.js'\r\nimport { GLCurveDrawSet } from './GLCurveDrawSet.js'\r\nimport { GLCurveLibrary } from './GLCurveLibrary.js'\r\nimport { GLSurfaceLibrary } from './GLSurfaceLibrary.js'\r\nimport { GLTrimSetLibrary } from './GLTrimSetLibrary.js'\r\nimport { GLCADBody } from './GLCADBody.js'\r\n\r\nimport {\r\n  pixelsPerDrawItem, // The number of RGBA pixels per draw item.\r\n  drawItemShaderAttribsStride,\r\n  floatsPerSceneBody,\r\n} from './CADConstants.js'\r\n\r\n// [bodyDescId, surfaceId, cadBodyDesc.xy], [glmaterialcoords.xy][tr-xyz], [ori], [sc], [highlight], [cutPlane]\r\nconst pixelsPerCADBody = 7\r\n\r\nimport GLCADAssetWorker from 'web-worker:./GLCADAssetWorker.js'\r\n// import {\r\n//   GLCADAssetWorker_onmessage\r\n// } from './GLCADAssetWorker.js';\r\n\r\n/**  Class representing a GL CAD asset.\r\n * @ignore\r\n */\r\nclass GLCADAsset extends EventEmitter {\r\n  /**\r\n   * Create a GL CAD asset.\r\n   * @param {any} gl - The gl value.\r\n   * @param {any} assetId - The assetId value.\r\n   * @param {any} cadAsset - The cadAsset value.\r\n   * @param {any} cadpassdata - The cadpassdata value.\r\n   */\r\n  constructor(gl, assetId, cadAsset, cadpassdata) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__assetId = assetId\r\n    this.__cadAsset = cadAsset\r\n    this.__numSurfaces = cadAsset.getSurfaceLibrary().getNumSurfaces()\r\n    this.__numBodies = cadAsset.getBodyLibrary().getNumBodies()\r\n    this.__numMaterials = cadAsset.getMaterialLibrary().getNumMaterials()\r\n    this.__numHighlightedGeoms = 0\r\n    this.__ready = false\r\n\r\n    this.__visible = this.__cadAsset.isVisible()\r\n    this.__assetVisibilityChanged = this.__assetVisibilityChanged.bind(this)\r\n    this.__cadAsset.on('visibilityChanged', this.__assetVisibilityChanged)\r\n\r\n    const updateDisplayEdges = () => {\r\n      this.displayEdges = this.__cadAsset.getParameter('DisplayEdges').getValue()\r\n      if (this.displayEdges) cadpassdata.incDisplayEdges()\r\n      else cadpassdata.decDisplayEdges()\r\n    }\r\n    updateDisplayEdges()\r\n    this.displayEdgesChangedId = this.__cadAsset.getParameter('DisplayEdges').on('valueChanged', updateDisplayEdges)\r\n\r\n    const updateEdgeColor = () => {\r\n      this.edgeColor = this.__cadAsset.getParameter('EdgeColor').getValue().asArray()\r\n      this.emit('updated')\r\n    }\r\n    updateEdgeColor()\r\n    this.edgesColorChangedId = this.__cadAsset.getParameter('EdgeColor').on('valueChanged', updateEdgeColor)\r\n\r\n    this.__cadpassdata = cadpassdata\r\n\r\n    this.__curveLibrary = new GLCurveLibrary(\r\n      gl,\r\n      cadpassdata,\r\n      this.__cadAsset.getSurfaceLibrary(),\r\n      cadAsset.getVersion()\r\n    )\r\n    this.__surfaceLibrary = new GLSurfaceLibrary(\r\n      gl,\r\n      cadpassdata,\r\n      this.__cadAsset.getSurfaceLibrary(),\r\n      this.__curveLibrary,\r\n      cadAsset.getVersion()\r\n    )\r\n    const trimSetsBuffer = this.__cadAsset.getTrimSetLibrary().getBinaryBuffer()\r\n    if (trimSetsBuffer && trimSetsBuffer.byteLength > 8) {\r\n      this.__trimSetLibrary = new GLTrimSetLibrary(\r\n        gl,\r\n        cadpassdata,\r\n        this.__cadAsset.getTrimSetLibrary(),\r\n        this.__curveLibrary\r\n      )\r\n    }\r\n\r\n    {\r\n      const bodyLibraryBuffer = this.__cadAsset.getBodyLibrary().getBinaryBuffer()\r\n      if (bodyLibraryBuffer) {\r\n        const bodyTexSize = Math.sqrt(bodyLibraryBuffer.byteLength / 16) // RGBA32 pixels\r\n        this.__bodyDescTexture = new GLTexture2D(gl, {\r\n          format: 'RGBA',\r\n          type: 'FLOAT',\r\n          width: bodyTexSize,\r\n          height: bodyTexSize,\r\n          filter: 'NEAREST',\r\n          wrap: 'CLAMP_TO_EDGE',\r\n          mipMapped: false,\r\n          data: new Float32Array(bodyLibraryBuffer),\r\n        })\r\n      }\r\n    }\r\n\r\n    this.__bindAttr = (location, channels, type, stride, offset, instanced = true) => {\r\n      gl.enableVertexAttribArray(location)\r\n      gl.vertexAttribPointer(location, channels, gl.FLOAT, false, stride, offset)\r\n      if (instanced) gl.vertexAttribDivisor(location, 1) // This makes it instanced\r\n    }\r\n\r\n    this.__trimCurveDrawSets = {}\r\n    this.__surfaceDrawSets = {}\r\n    this.__curveDrawSets = {}\r\n\r\n    // ////////////////////////////////////////////////\r\n\r\n    this.loadWorker()\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __assetVisibilityChanged() {\r\n    this.__visible = this.__cadAsset.isVisible()\r\n    this.emit('updated')\r\n  }\r\n\r\n  /**\r\n   * The getCADAsset method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCADAsset() {\r\n    return this.__cadAsset\r\n  }\r\n\r\n  /**\r\n   * The getNumSurfaces method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumSurfaces() {\r\n    return this.__numSurfaces\r\n  }\r\n\r\n  /**\r\n   * The getNumBodies method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumBodies() {\r\n    return this.__numBodies\r\n  }\r\n\r\n  /**\r\n   * The getNumMaterials method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getNumMaterials() {\r\n    return this.__numMaterials\r\n  }\r\n\r\n  /**\r\n   * The incHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  incHighlightedCount(count) {\r\n    this.__numHighlightedGeoms += count\r\n    this.__cadpassdata.incHighlightedCount(count)\r\n  }\r\n\r\n  /**\r\n   * The decHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  decHighlightedCount(count) {\r\n    this.__numHighlightedGeoms -= count\r\n    this.__cadpassdata.decHighlightedCount(count)\r\n  }\r\n\r\n  /**\r\n   * The loadWorker method.\r\n   */\r\n  loadWorker() {\r\n    const numBodyItems = this.__cadAsset.getNumBodyItems()\r\n    if (numBodyItems == 0) return\r\n\r\n    // let tmp = 0;\r\n    // this.__cadAsset.traverse((treeItem) => {\r\n    //     if (treeItem instanceof CADBody) {\r\n    //       console.log(treeItem.getPath())\r\n    //       tmp++;\r\n    //       return false;\r\n    //     } else\r\n    //       return true;\r\n    // });\r\n    // if(numBodyItems != tmp){\r\n    //   console.log(\"numBodyItems\", numBodyItems, tmp)\r\n    //   numBodyItems = tmp;\r\n    // }\r\n\r\n    // Only support power 2 textures. Else we get strange corruption on some GPUs\r\n    // in some scenes.\r\n    let cadBodiesTextureSize = MathFunctions.nextPow2(Math.round(Math.sqrt(numBodyItems * pixelsPerCADBody) + 0.5))\r\n    // Size should be a multiple of pixelsPerCADBody, so each geom item is always contiguous\r\n    // in memory. (makes updating a lot easier. See __updateItemInstanceData below)\r\n    if (cadBodiesTextureSize % pixelsPerCADBody != 0)\r\n      cadBodiesTextureSize += pixelsPerCADBody - (cadBodiesTextureSize % pixelsPerCADBody)\r\n\r\n    this.cadBodiesTextureData = new Float32Array(cadBodiesTextureSize * cadBodiesTextureSize * 4) // 4==RGBA pixels.\r\n\r\n    // Calculate the entroid to offset all the Xfo values.\r\n    // This is to work around an issue on Mobile GPUs where\r\n    // the fragment shader stage only supports Flaot16 operations.\r\n    // The Matrix calculated in the DrawItems shader contains artifacts\r\n    // because of the low precision.\r\n    // If the asset is invisible when loaded, then the bbox is\r\n    // not valid and the centroid becomes NaN\r\n    const assetBBox = this.__cadAsset.getParameter('BoundingBox').getValue()\r\n    // this.__assetCentroid = assetBBox.center()\r\n    // if (\r\n    //   Number.isNaN(this.__assetCentroid.x) ||\r\n    //   Number.isNaN(this.__assetCentroid.y) ||\r\n    //   Number.isNaN(this.__assetCentroid.z)\r\n    // ) {\r\n    this.__assetCentroid = new Vec3()\r\n    // }\r\n\r\n    const sceneBodyItemsData = new Float32Array(numBodyItems * floatsPerSceneBody)\r\n\r\n    let index = 0\r\n    this.__cadBodies = []\r\n    const highlightedBodies = []\r\n\r\n    const highlightChangeBatch = {\r\n      highlightedBodyIds: [],\r\n      unhighlightedBodyIds: [],\r\n      dirty: false,\r\n    }\r\n    const pushhighlightChangeBatchToWorker = () => {\r\n      this.__postMessageToWorker({\r\n        eventType: 'bodyHighlightChanged',\r\n        highlightedBodyIds: highlightChangeBatch.highlightedBodyIds,\r\n        unhighlightedBodyIds: highlightChangeBatch.unhighlightedBodyIds,\r\n      })\r\n      highlightChangeBatch.highlightedBodyIds = []\r\n      highlightChangeBatch.unhighlightedBodyIds = []\r\n      highlightChangeBatch.dirty = false\r\n    }\r\n\r\n    this.__dirtyBodyIndices = []\r\n    const bodyItemDataChanged = (bodyId) => {\r\n      if (this.__dirtyBodyIndices.indexOf(bodyId) == -1) {\r\n        this.__dirtyBodyIndices.push(bodyId)\r\n        this.emit('updated')\r\n      }\r\n    }\r\n\r\n    const bindCADBody = (cadBody) => {\r\n      const bodyId = index\r\n      if (bodyId >= numBodyItems) return\r\n\r\n      // Data passed to the web worker to help setup layout.\r\n      const sceneBodyItemDataByteOffset = bodyId * floatsPerSceneBody * 4 /*bytes/channel*/\r\n      const sceneBodyItemData = new Float32Array(\r\n        sceneBodyItemsData.buffer,\r\n        sceneBodyItemDataByteOffset,\r\n        floatsPerSceneBody\r\n      )\r\n\r\n      const cadBodyTextureDataByteOffset = bodyId * pixelsPerCADBody * 4 /*channels/pixel*/ * 4 /*bytes/channel*/\r\n      const cadBodyTextureData = new Float32Array(\r\n        this.cadBodiesTextureData.buffer,\r\n        cadBodyTextureDataByteOffset,\r\n        pixelsPerCADBody * 4 /*channels/pixel*/\r\n      )\r\n\r\n      const glCADBody = new GLCADBody(cadBody, bodyId)\r\n      glCADBody.bind(\r\n        this.__cadpassdata,\r\n        sceneBodyItemData,\r\n        cadBodyTextureData,\r\n        bodyItemDataChanged,\r\n        highlightedBodies,\r\n        highlightChangeBatch,\r\n        pushhighlightChangeBatchToWorker\r\n      )\r\n\r\n      this.__cadBodies.push(glCADBody)\r\n      index++\r\n    }\r\n\r\n    this.__cadAsset.traverse((treeItem) => {\r\n      if (treeItem instanceof CADBody) {\r\n        bindCADBody(treeItem)\r\n        return false\r\n      } else {\r\n        return true\r\n      }\r\n    })\r\n\r\n    ////////////////////////////////////////\r\n    // Greate the GLTexture.\r\n    const gl = this.__gl\r\n    this.__cadBodiesTexture = new GLTexture2D(gl, {\r\n      format: 'RGBA',\r\n      type: 'FLOAT',\r\n      width: cadBodiesTextureSize,\r\n      height: cadBodiesTextureSize,\r\n      filter: 'NEAREST',\r\n      wrap: 'CLAMP_TO_EDGE',\r\n      mipMapped: false,\r\n      data: this.cadBodiesTextureData,\r\n    })\r\n\r\n    ////////////////////////////////////////\r\n    // Detail Factor\r\n    // The detail factor is used to convert surface 'cost'\r\n    // to a given tesselation level.\r\n    // Here we start with a given tesselation desired for a\r\n    // circle the size of the asset bounding box.\r\n    // We calculate the cost of the circle (curvature * length^2)\r\n    const unitsScale = this.__cadAsset.getUnitsConversion()\r\n    const assetBBoxRadius = (assetBBox.size() * 0.5) / unitsScale\r\n\r\n    //////////////////////\r\n    // Calculate a detail value for a circle enclosing our bbox.\r\n    const lod = this.__cadAsset.lod\r\n    const detail = 128 * Math.pow(2, lod)\r\n    // Calculate the arc angle for a cricle subdivided to the detail level\r\n    const arcAngle = (Math.PI * 2.0) / detail\r\n    // Calculate the deviation to the circle at the middle of the arc.\r\n    const errorTolerance = assetBBoxRadius - assetBBoxRadius * Math.cos(arcAngle / 2)\r\n\r\n    // The smallest area of a drawn item.\r\n    // The renderer will skip any surfaces smaller than this item.\r\n    const surfaceAreaThreshold = 0 //Math.PI * (assetBBoxRadius * assetBBoxRadius * 0.000000005 * Math.pow(2, lod))\r\n    // Note: on the hospital sprinker system we get the following values on the GTX laptop.\r\n    // assetBBoxRadius: 67447  surfaceAreaThreshold: 285\r\n    // Skipping about 30 surfaces.\r\n\r\n    console.log(\r\n      'assetBBoxRadius:',\r\n      assetBBoxRadius,\r\n      ' errorTolerance:',\r\n      errorTolerance,\r\n      ' surfaceAreaThreshold:',\r\n      surfaceAreaThreshold\r\n    )\r\n\r\n    ////////////////////////////////////////\r\n    const curvesDataBuffer = this.__cadAsset.getSurfaceLibrary().getCurveBuffer()\r\n    const surfacesDataBuffer = this.__cadAsset.getSurfaceLibrary().getSurfaceBuffer()\r\n    const cadDataVersion = this.__cadAsset.getVersion()\r\n\r\n    const trimSetsBuffer = this.__cadAsset.getTrimSetLibrary().getBinaryBuffer()\r\n    let trimTexelSize = -1\r\n    if (trimSetsBuffer) {\r\n      const numAssets = this.__cadpassdata.assetCount\r\n      trimTexelSize = this.__cadAsset.getTrimSetLibrary().getTexelSize(lod, numAssets)\r\n      // const mult = Math.pow(2, this.__cadAsset.getLOD());\r\n      // trimTexelSize = this.__cadAsset.getTrimTexelSize() * mult;\r\n    }\r\n\r\n    const bodyLibraryBufferToc = this.__cadAsset.getBodyLibrary().getToc()\r\n    const bodyLibraryBuffer = this.__cadAsset.getBodyLibrary().getBinaryBuffer()\r\n\r\n    const transferables = [surfacesDataBuffer, bodyLibraryBufferToc, bodyLibraryBuffer]\r\n    if (trimSetsBuffer) transferables.push(trimSetsBuffer)\r\n\r\n    const assemblyData = {\r\n      eventType: 'loadAssembly',\r\n      assetId: this.__assetId,\r\n      curvesDataBuffer,\r\n      surfacesDataBuffer,\r\n      cadDataVersion,\r\n      trimSetsBuffer,\r\n      lod: this.__cadAsset.getLOD(),\r\n      maxTexSize: this.__cadpassdata.maxTexSize / 2,\r\n      errorTolerance,\r\n      surfaceAreaThreshold,\r\n      trimTexelSize,\r\n      sceneBodyItemsData,\r\n      bodyLibraryBufferToc,\r\n      bodyLibraryBuffer,\r\n      highlightedBodies,\r\n    }\r\n    this.__postMessageToWorker(assemblyData, transferables)\r\n  }\r\n\r\n  updateBodyTexture(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    const texId = this.__gl.TEXTURE0 + renderstate.boundTextures + 1\r\n    gl.activeTexture(texId)\r\n    gl.bindTexture(gl.TEXTURE_2D, this.__cadBodiesTexture.glTex)\r\n    const size = this.__cadBodiesTexture.width\r\n    for (let i = 0; i < this.__dirtyBodyIndices.length; i++) {\r\n      const bodyId = this.__dirtyBodyIndices[i]\r\n      const yoffset = Math.floor((bodyId * pixelsPerCADBody) / size)\r\n      const xoffset = (bodyId * pixelsPerCADBody) % size\r\n\r\n      const glCADBody = this.__cadBodies[bodyId]\r\n      glCADBody.updateCadBodyTex()\r\n\r\n      const width = pixelsPerCADBody\r\n      const height = 1\r\n\r\n      const cadBodyTextureDataByteOffset = bodyId * pixelsPerCADBody * 4 /*channels/pixel*/ * 4 /*bytes/channel*/\r\n      const cadBodyTextureData = new Float32Array(\r\n        this.cadBodiesTextureData.buffer,\r\n        cadBodyTextureDataByteOffset,\r\n        pixelsPerCADBody * 4 /*channels/pixel*/\r\n      )\r\n      this.__cadBodiesTexture.populate(cadBodyTextureData, width, height, xoffset, yoffset, false)\r\n    }\r\n    gl.bindTexture(gl.TEXTURE_2D, null)\r\n\r\n    this.__dirtyBodyIndices = []\r\n  }\r\n\r\n  /**\r\n   * The __postMessageToWorker method.\r\n   * @param {any} data - The data param.\r\n   * @param {any} transferables - The transferables param.\r\n   * @private\r\n   */\r\n  __postMessageToWorker(data, transferables) {\r\n    // if(this.__cadpassdata.debugMode) {\r\n    //   setTimeout(()=>{\r\n    //     GLCADAssetWorker_onmessage(data, this.__onWorkerMessage.bind(this));\r\n    //   },100);\r\n    // }\r\n    // else\r\n    {\r\n      if (!this.__worker) this.__worker = new GLCADAssetWorker()\r\n      this.__worker.onmessage = (event) => {\r\n        this.__onWorkerMessage(event.data) // loading done...\r\n      }\r\n      this.__worker.postMessage(data, this.__cadpassdata.debugMode ? [] : transferables)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The __onWorkerMessage method.\r\n   * @param {any} data - The data param.\r\n   * @private\r\n   */\r\n  __onWorkerMessage(data) {\r\n    switch (data.eventType) {\r\n      case 'loadAssetDone':\r\n        console.log('Layout Asset:', this.getCADAsset().getName(), data.profiling)\r\n\r\n        // ///////////////////////////////\r\n        // Curves, Surfaces and Trim Sets\r\n\r\n        // this.__gl.finish();\r\n\r\n        if (data.curvesAtlasLayout) {\r\n          this.__curveLibrary.evaluateCurves(\r\n            data.curvesAtlasLayout,\r\n            data.numCurves,\r\n            data.curvesAtlasLayoutTextureSize,\r\n            data.curvesAtlasTextureDim\r\n          )\r\n        }\r\n\r\n        // Note: rollup is generating radom problems in production builds\r\n        // values are getting assigned classes. The profiling values here\r\n        // become assigned class definitions, which then cause crashes or\r\n        // garbage logging\r\n        // Here, if we bundle the values into an object, then its ok.\r\n        // This is probably due to the use to WebWorkers this this file.\r\n        // We should try updating rollup and see if these hacks can be\r\n        // removed.\r\n        const values = {}\r\n\r\n        if (data.surfacesEvalAttrs) {\r\n          values.surfaceEvalTime = this.__surfaceLibrary.evaluateSurfaces(\r\n            data.surfacesEvalAttrs,\r\n            data.surfacesAtlasLayout,\r\n            data.surfacesAtlasLayoutTextureSize,\r\n            data.surfacesAtlasTextureDim\r\n          )\r\n        }\r\n\r\n        if (data.trimCurveDrawSets && data.trimSetAtlasTextureSize[0] > 0 && data.trimSetAtlasTextureSize[1] > 0) {\r\n          this.__trimSetLibrary.evaluateTrimSets(\r\n            data.trimCurveDrawSets,\r\n            data.trimSetAtlasTextureSize,\r\n            data.trimSetsAtlasLayoutData,\r\n            data.trimSetsAtlasLayoutTextureSize\r\n          )\r\n        }\r\n\r\n        // ///////////////////////////////\r\n        // Draw Items\r\n\r\n        this.__bodyAtlasDim = data.bodyAtlasDim\r\n        // this.updateDrawItems(data.evalDrawItemShaderAttribs)\r\n        this.updateDrawSets(values, data.surfaceDrawSets, data.curveDrawSets)\r\n        this.__ready = true\r\n\r\n        this.emit('loaded', {\r\n          numSurfaces: data.profiling.numSurfaces,\r\n          numSurfaceInstances: data.profiling.numSurfaceInstances,\r\n          surfaceEvalTime: values.surfaceEvalTime,\r\n          numBodies: data.profiling.numBodies,\r\n          numMaterials: this.__numMaterials,\r\n          numTriangles: values.numTriangles,\r\n          numDrawSets: values.numDrawSets,\r\n        })\r\n        this.emit('updated')\r\n        break\r\n      case 'highlightedSurfaceDrawSetsChanged':\r\n        for (const drawSetKey in data.highlightedSurfaceDrawSets) {\r\n          const drawSet = this.__surfaceDrawSets[drawSetKey]\r\n          if (!drawSet) {\r\n            console.warn('Selecting invalid items:', drawSetKey)\r\n            continue\r\n          }\r\n          drawSet.setDrawItems(data.highlightedSurfaceDrawSets[drawSetKey], 1)\r\n        }\r\n        this.incHighlightedCount(data.numHighlighted)\r\n        this.decHighlightedCount(data.numUnhighlighted)\r\n        this.emit('updated')\r\n        break\r\n    }\r\n\r\n    // if (data.lodChanges.length != 0){\r\n    //     const eachLODChange = (change)=>{\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setLod(change.lod - 1);\r\n    //     }\r\n    //     // console.log(\"lodChanges:\" + data.lodChanges.length)\r\n    //     data.lodChanges.forEach(eachLODChange);\r\n    // }\r\n    // if (data.becomingInvisible.length != 0 || data.becomingVisible.length != 0){\r\n    //     const eachBecomingInvisibleChange = (change)=>{\r\n    //         // console.log(\"BecomingInvisible:\" + change.bodyIndex + \":\" + change.surfaceIndex);\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setInvisible();\r\n    //     }\r\n    //     // console.log(\"becomingInvisible:\" + data.becomingInvisible.length)\r\n    //     data.becomingInvisible.forEach(eachBecomingInvisibleChange);\r\n\r\n    //     const eachBecomingVisibleChange = (change)=>{\r\n    //         // console.log(\"BecomingVisible:\" + change.bodyIndex + \":\" + change.surfaceIndex);\r\n    //         const glsurfacedrawItem = this.__glbodyItems[change.bodyIndex].glsurfacedrawItems[change.surfaceIndex];\r\n    //         glsurfacedrawItem.setVisible();\r\n    //     }\r\n    //     // console.log(\"becomingVisible:\" + data.becomingVisible.length)\r\n    //     data.becomingVisible.forEach(eachBecomingVisibleChange);\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * The updateDrawItems method.\r\n   * @param {any} evalDrawItemShaderAttribs - The evalDrawItemShaderAttribs param.\r\n   */\r\n  updateDrawSets(values, surfaceDrawSets, curveDrawSets) {\r\n    values.numTriangles = 0\r\n    values.numDrawSets = 0\r\n\r\n    if (surfaceDrawSets) {\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const drawSetKey in surfaceDrawSets) {\r\n        let drawSet = this.__surfaceDrawSets[drawSetKey]\r\n        // Note: on initialization, there are no draw sets, so\r\n        // we always construct the draw set here.\r\n        if (!drawSet) {\r\n          const parts = drawSetKey.split('x')\r\n          const detailX = parseInt(parts[0])\r\n          const detailY = parseInt(parts[1])\r\n          drawSet = new GLSurfaceDrawSet(this.__gl, detailX, detailY)\r\n          this.__surfaceDrawSets[drawSetKey] = drawSet\r\n        }\r\n\r\n        const drawSetData = surfaceDrawSets[drawSetKey]\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const subSetKey in drawSetData) {\r\n          const drawItemsData = drawSetData[subSetKey]\r\n          values.numTriangles += drawSet.addDrawItems(drawItemsData, subSetKey)\r\n        }\r\n\r\n        values.numDrawSets++\r\n      }\r\n    }\r\n    if (curveDrawSets) {\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const drawSetKey in curveDrawSets) {\r\n        let drawSet = this.__curveDrawSets[drawSetKey]\r\n        // Note: on initialization, there are no draw sets, so\r\n        // we always construct the draw set here.\r\n        if (!drawSet) {\r\n          const detail = parseInt(drawSetKey)\r\n          drawSet = new GLCurveDrawSet(this.__gl, detail)\r\n          this.__curveDrawSets[drawSetKey] = drawSet\r\n        }\r\n\r\n        const drawSetData = curveDrawSets[drawSetKey]\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const subSetKey in drawSetData) {\r\n          const drawItemsData = drawSetData[subSetKey]\r\n          drawSet.addDrawItems(drawItemsData, subSetKey)\r\n        }\r\n\r\n        values.numDrawSets++\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The bindDrawItemsAtlas method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n\r\n  bindDrawItemsAtlas(renderstate) {\r\n    this.__drawItemsTarget.bindColorTexture(renderstate, renderstate.unifs.drawItemsTexture)\r\n    // this.__drawItemsTexture.bindToUniform(renderstate, renderstate.unifs.drawItemsTexture);\r\n    if (renderstate.unifs.vert_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(\r\n        renderstate.unifs.vert_drawItemsTextureSize.location,\r\n        this.__bodyAtlasDim[0],\r\n        this.__bodyAtlasDim[1]\r\n      )\r\n    }\r\n    if (renderstate.unifs.frag_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(\r\n        renderstate.unifs.frag_drawItemsTextureSize.location,\r\n        this.__bodyAtlasDim[0],\r\n        this.__bodyAtlasDim[1]\r\n      )\r\n    }\r\n  }\r\n\r\n  bind(renderstate) {\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n\r\n    // console.log(\"bind:\", Object.keys(unifs))\r\n\r\n    // this.bindDrawItemsAtlas(renderstate)\r\n    // if (unifs.drawItemsTexture) {\r\n    //   this.__drawItemsTarget.bindColorTexture(\r\n    //     renderstate,\r\n    //     unifs.drawItemsTexture\r\n    //   )\r\n    // }\r\n\r\n    if (unifs.vert_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(unifs.vert_drawItemsTextureSize.location, this.__bodyAtlasDim[0], this.__bodyAtlasDim[1])\r\n    }\r\n    if (unifs.frag_drawItemsTextureSize) {\r\n      this.__gl.uniform2i(unifs.frag_drawItemsTextureSize.location, this.__bodyAtlasDim[0], this.__bodyAtlasDim[1])\r\n    }\r\n\r\n    if (unifs.bodyDescTexture) {\r\n      this.__bodyDescTexture.bindToUniform(renderstate, unifs.bodyDescTexture)\r\n      gl.uniform2i(unifs.bodyDescTextureSize.location, this.__bodyDescTexture.width, this.__bodyDescTexture.height)\r\n      if (unifs.bodyDescTextureSize_frag) {\r\n        gl.uniform2i(\r\n          unifs.bodyDescTextureSize_frag.location,\r\n          this.__bodyDescTexture.width,\r\n          this.__bodyDescTexture.height\r\n        )\r\n      }\r\n    }\r\n\r\n    if (unifs.cadBodiesTexture) {\r\n      this.__cadBodiesTexture.bindToUniform(renderstate, unifs.cadBodiesTexture)\r\n      if (unifs.cadBodiesTextureSize_vert)\r\n        gl.uniform1i(unifs.cadBodiesTextureSize_vert.location, this.__cadBodiesTexture.width)\r\n      if (unifs.cadBodiesTextureSize_frag)\r\n        gl.uniform1i(unifs.cadBodiesTextureSize_frag.location, this.__cadBodiesTexture.width)\r\n    }\r\n\r\n    // if (unifs.cutNormal) {\r\n    //   gl.uniform3fv(unifs.cutNormal.location, this.__cutNormal.asArray())\r\n    //   gl.uniform1f(unifs.planeDist.location, this.__cutDist)\r\n    //   if (unifs.cutColor) {\r\n    //     gl.uniform4fv(unifs.cutColor.location, this.__cutColor.asArray())\r\n    //   }\r\n    // }\r\n\r\n    if (unifs.assetCentroid) {\r\n      gl.uniform3fv(unifs.assetCentroid.location, this.__assetCentroid.asArray())\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  draw(renderstate) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    if (this.__dirtyBodyIndices.length > 0) {\r\n      this.updateBodyTexture(renderstate)\r\n    }\r\n\r\n    this.bind(renderstate)\r\n\r\n    if (!this.__surfaceLibrary.bindSurfacesAtlas(renderstate)) {\r\n      renderstate.boundTextures = boundTextures\r\n      return\r\n    }\r\n\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, renderstate.shaderId)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawHighlightedGeoms method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawHighlightedGeoms(renderstate) {\r\n    if (!this.__visible || this.__numHighlightedGeoms == 0) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    // Now draw the highlight outline.\r\n    const highlightOutlineID = 1\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, highlightOutlineID)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawNormals method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} shaderKey - The shaderKey param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawNormals(renderstate, shaderKey) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.drawNormals(renderstate, shaderKey)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawEdges method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @param {any} shaderKey - The shaderKey param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawEdges(renderstate, shaderKey) {\r\n    if (!this.__visible || !this.__ready || !this.displayEdges) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n    if (this.__dirtyBodyIndices.length > 0) {\r\n      this.updateBodyTexture(renderstate)\r\n    }\r\n\r\n    this.bind(renderstate)\r\n    this.__curveLibrary.bindCurvesAtlas(renderstate)\r\n\r\n    const gl = this.__gl\r\n    gl.uniform4fv(renderstate.unifs.edgeColor.location, this.edgeColor)\r\n\r\n    for (const key in this.__curveDrawSets) {\r\n      const drawSet = this.__curveDrawSets[key]\r\n      drawSet.draw(renderstate, shaderKey)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The drawGeomData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawGeomData(renderstate) {\r\n    if (!this.__visible || !this.__ready) return false\r\n\r\n    const boundTextures = renderstate.boundTextures\r\n\r\n    this.bind(renderstate)\r\n\r\n    this.__surfaceLibrary.bindSurfacesAtlas(renderstate)\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.bindTrimSetAtlasLayout(renderstate)\r\n      this.__trimSetLibrary.bindTrimSetAtlas(renderstate)\r\n    }\r\n\r\n    const gl = this.__gl\r\n    const assetIndexUnif = renderstate.unifs.assetIndex\r\n    if (assetIndexUnif) {\r\n      gl.uniform1i(assetIndexUnif.location, this.__assetId)\r\n    }\r\n\r\n    for (const key in this.__surfaceDrawSets) {\r\n      // console.log(\"draw:\" + key)\r\n      const drawSet = this.__surfaceDrawSets[key]\r\n      drawSet.draw(renderstate, renderstate.shaderId)\r\n    }\r\n\r\n    renderstate.boundTextures = boundTextures\r\n  }\r\n\r\n  /**\r\n   * The getGeomItem method.\r\n   * @param {any} bodyId - The bodyId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getGeomItem(bodyId) {\r\n    return this.__cadBodies[bodyId].cadBody\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} surfaceId - The surfaceId param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getSurfaceData(surfaceId) {\r\n    return this.__cadAsset.getSurfaceLibrary().getSurfaceData(surfaceId)\r\n  }\r\n\r\n  /**\r\n   * The getSurfaceData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawSurfaceAtlas(renderstate) {\r\n    if (this.__surfaceLibrary) this.__surfaceLibrary.drawSurfaceAtlas(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The drawTrimSets method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   */\r\n  drawTrimSets(renderstate) {\r\n    if (this.__trimSetLibrary) this.__trimSetLibrary.drawTrimSets(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The destroy method.\r\n   */\r\n  destroy() {\r\n    this.__cadAsset.off('visibilityChanged', this.__assetVisibilityChanged)\r\n\r\n    this.__cadBodiesTexture.destroy()\r\n\r\n    this.__cadBodies.forEach((glCADBody) => glCADBody.destroy())\r\n    this.__cadBodies = []\r\n    this.__curveLibrary.destroy()\r\n    this.__surfaceLibrary.destroy()\r\n\r\n    if (this.__trimSetLibrary) {\r\n      this.__trimSetLibrary.destroy()\r\n    }\r\n\r\n    for (const drawSetKey in this.__surfaceDrawSets) {\r\n      let drawSet = this.__surfaceDrawSets[drawSetKey]\r\n      drawSet.destroy()\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCADAsset }\r\n","import { EventEmitter, GrowingPacker, GLTexture2D, Registry } from '@zeainc/zea-engine'\r\n\r\n/** Class representing a GL CAD material library.\r\n * @ignore\r\n */\r\nclass GLCADMaterialLibrary extends EventEmitter {\r\n  /**\r\n   * Create a GL CAD material library.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super()\r\n    this.__gl = gl\r\n    this.__materialDatas = []\r\n    this.__dirtyIndices = []\r\n    this.__numItems = 0\r\n    this.__materialPacker = new GrowingPacker(256, 256)\r\n\r\n    this.__needsUpload = false\r\n  }\r\n\r\n  /**\r\n   * The addMaterial method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  addMaterial(material) {\r\n    if (material.getMetadata('glmaterialcoords')) {\r\n      return\r\n    }\r\n\r\n    this.__numItems++\r\n\r\n    const coords = this.__materialPacker.addBlock({ w: 2, h: 1 })\r\n    const materialId = this.__materialDatas.length\r\n    this.__materialDatas.push({\r\n      material,\r\n      coords,\r\n    })\r\n\r\n    material.on('parameterValueChanged', () => {\r\n      // this.__renderer.requestRedraw();\r\n      this.__dirtyIndices.push(materialId)\r\n      this.emit('updated')\r\n    })\r\n\r\n    material.setMetadata('glmaterialcoords', coords)\r\n\r\n    this.__dirtyIndices.push(materialId)\r\n\r\n    return coords\r\n  }\r\n\r\n  /**\r\n   * The needsUpload method.\r\n   * @return {any} - The return value.\r\n   */\r\n  needsUpload() {\r\n    return this.__dirtyIndices.length > 0\r\n  }\r\n\r\n  /**\r\n   * The uploadMaterials method.\r\n   */\r\n  uploadMaterials() {\r\n    const gl = this.__gl\r\n    const width = this.__materialPacker.root.w\r\n    const height = this.__materialPacker.root.h\r\n    // console.log('Num Used Materials:' + this.__numItems, width, height)\r\n    if (!this.__materialsTexture) {\r\n      this.__materialsTexture = new GLTexture2D(gl, {\r\n        format: 'RGBA',\r\n        type: 'FLOAT',\r\n        width,\r\n        height,\r\n        filter: 'NEAREST',\r\n        wrap: 'CLAMP_TO_EDGE',\r\n        mipMapped: false,\r\n      })\r\n      this.__materialsTexture.clear()\r\n    } else if (this.__materialsTexture.width != width || this.__materialsTexture.height != height) {\r\n      throw new Error('Cannot resize here. Need a resize the preserves the data.')\r\n      this.__materialsTexture.resize(width, height)\r\n      this.__dirtyIndices = Array(this.__bodyDrawItems.length)\r\n        .fill()\r\n        .map((v, i) => i)\r\n    }\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, this.__materialsTexture.glTex)\r\n    const typeId = this.__materialsTexture.getTypeID()\r\n    const formatId = this.__materialsTexture.getFormatID()\r\n\r\n    const eachMaterial = (value) => {\r\n      const materialData = this.__materialDatas[value]\r\n      const material = materialData.material\r\n\r\n      let shaderClass = Registry.getBlueprint(material.getShaderName())\r\n      if (!shaderClass || !shaderClass.getPackedMaterialData) {\r\n        shaderClass = Registry.getBlueprint('GLDrawCADSurfaceShader')\r\n      }\r\n\r\n      const matData = shaderClass.getPackedMaterialData(material)\r\n\r\n      const width = matData.length / 4 // 4==RGBA pixels.\r\n      const height = 1\r\n\r\n      const coords = materialData.coords\r\n      if (typeId == gl.FLOAT) {\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, coords.x, coords.y, width, height, formatId, typeId, matData)\r\n      } else {\r\n        const unit16s = Math.convertFloat32ArrayToUInt16Array(matData)\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, coords.x, coords.y, width, height, formatId, typeId, unit16s)\r\n      }\r\n    }\r\n    this.__dirtyIndices.forEach(eachMaterial)\r\n    this.__dirtyIndices = []\r\n    gl.bindTexture(gl.TEXTURE_2D, null)\r\n  }\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate) {\r\n    if (!this.__materialsTexture) return false\r\n\r\n    const gl = this.__gl\r\n    const unifs = renderstate.unifs\r\n    if (unifs.materialsTexture) this.__materialsTexture.bindToUniform(renderstate, unifs.materialsTexture)\r\n    if (unifs.materialsTextureSize)\r\n      gl.uniform2i(unifs.materialsTextureSize.location, this.__materialsTexture.width, this.__materialsTexture.height)\r\n    return true\r\n  }\r\n}\r\nexport { GLCADMaterialLibrary }\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADConstants.glsl',\r\n  `\r\n  const int SURFACE_FLAG_PERIODIC_U = 1; // 1<<0;\r\n  const int SURFACE_FLAG_PERIODIC_V = 2; // 1<<1;\r\n  const int SURFACE_FLAG_UNUSED2 = 4; // 1<<2;\r\n  const int SURFACE_FLAG_UNUSED3 = 8; // 1<<3;\r\n  const int SURFACE_FLAG_FLIPPED_NORMAL = 16; // 1<<4\r\n  const int SURFACE_FLAG_FLIPPED_UV = 32; // 1<<5\r\n  const int SURFACE_FLAG_COST_IS_DETAIL_U = 64; // 1<<6;\r\n  const int SURFACE_FLAG_COST_IS_DETAIL_V = 128; // 1<<7;\r\n\r\n  const int BODY_FLAG_CUTAWAY = 256; // 1<<8\r\n  const int BODY_FLAG_INVISIBLE = 512; // 1<<9\r\n\r\n  const int CURVE_FLAG_PERIODIC = 1; // 1<<0;\r\n  const int CURVE_FLAG_UNUSED2 = 4; // 1<<2;\r\n  const int CURVE_FLAG_COST_IS_DETAIL = 8;//1<<3;\r\n\r\n\r\n  const int SURFACE_TYPE_PLANE = 0;\r\n  const int SURFACE_TYPE_CONE = 1;\r\n  const int SURFACE_TYPE_CYLINDER = 2;\r\n  const int SURFACE_TYPE_SPHERE = 3;\r\n  const int SURFACE_TYPE_TORUS = 4;\r\n  const int SURFACE_TYPE_LINEAR_EXTRUSION = 5;\r\n  const int SURFACE_TYPE_REVOLUTION = 6;\r\n  const int SURFACE_TYPE_BEZIER_SURFACE = 7;\r\n  const int SURFACE_TYPE_NURBS_SURFACE = 8;\r\n  const int SURFACE_TYPE_OFFSET_SURFACE = 9;\r\n  const int SURFACE_TYPE_TRIMMED_RECT_SURFACE = 10;\r\n\r\n  const int SURFACE_TYPE_POLY_PLANE = 14;\r\n  const int SURFACE_TYPE_FAN = 15;\r\n  const int SURFACE_TYPE_REVOLUTION_FLIPPED_DOMAIN = 16;\r\n\r\n\r\n  const int CURVE_TYPE_LINE = 20;\r\n  const int CURVE_TYPE_CIRCLE = 21;\r\n  const int CURVE_TYPE_ELIPSE = 22;\r\n  // const int CURVE_TYPE_HYPERBOLA = 23;\r\n  // const int CURVE_TYPE_PARABOLA = 24;\r\n  // const int CURVE_TYPE_BEZIERCURVE = 25;\r\n  const int CURVE_TYPE_NURBS_CURVE = 26;\r\n  // const int CURVE_TYPE_OFFSET_CURVE = 27;\r\n  // const int CURVE_TYPE_TRIMMED_CURVE = 28;\r\n\r\n\r\n  const int geomLibraryHeaderSize = 4; // 2 pixels at the start of the GeomLibrary and CurveLibrary\r\n\r\n  // [bodyDescId, surfaceId, cadBodyDesc.xy], [glmaterialcoords.xy][tr-xyz], [ori], [sc], [highlight], [cutPlane]\r\n  const int pixelsPerCADBody = 7;\r\n`\r\n)\r\n","import { shaderLibrary } from '@zeainc/zea-engine'\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADGeomDrawing.vertexShader.glsl',\r\n  `\r\n\r\n\r\nuniform sampler2D cadBodiesTexture;\r\nuniform int cadBodiesTextureSize_vert;\r\n  \r\nvec4 getCADBodyPixel(int cadBodyId, int pixelOffset) {\r\n  int offset = cadBodyId * pixelsPerCADBody;\r\n  ivec2 start;\r\n  start.y += offset / cadBodiesTextureSize_vert;\r\n  start.x = imod(offset, cadBodiesTextureSize_vert);\r\n  return fetchTexel(cadBodiesTexture, ivec2(cadBodiesTextureSize_vert), ivec2(start.x + pixelOffset, start.y));\r\n}\r\n\r\n<%include file=\"GLSLMath.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\n\r\nconst int pixelsPerDrawItem = 10; // The number of RGBA pixels per draw item.\r\nconst int valuesPerSurfaceTocItem = 9;\r\nconst int bytesPerValue = 4; // 32 bit floats\r\n\r\n// Before enabling this, enable the 2nd vertex attribute (drawItemTexAddr)\r\n// in the Draw shader and in the GLDrawSet, and in the GLCADAssetWorker\r\n#define CALC_GLOBAL_XFO_DURING_DRAW\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\nmat4 getCADBodyMatrix(int cadBodyId) {\r\n  vec3 body_tr = getCADBodyPixel(cadBodyId, 2).rgb;\r\n  vec4 body_ori = normalize(getCADBodyPixel(cadBodyId, 3));\r\n  vec3 body_sc = getCADBodyPixel(cadBodyId, 4).rgb;\r\n  Xfo bodyXfo = Xfo(body_tr, body_ori, body_sc);\r\n  return xfo_toMat4(bodyXfo);\r\n  // return mat4(1.0);\r\n}\r\n\r\nuniform sampler2D bodyDescTexture;\r\nuniform ivec2 bodyDescTextureSize;\r\n\r\nGLSLBinReader setupBodyDescReader(ivec2 bodyDescAddr) {\r\n  GLSLBinReader bodyDescReader;\r\n  ivec4 region = ivec4(0, 0, bodyDescTextureSize.x, bodyDescTextureSize.y);\r\n  ivec2 start = ivec2(bodyDescAddr.x, bodyDescAddr.y);\r\n  GLSLBinReader_init(bodyDescReader, bodyDescTextureSize, region, start, 32);\r\n  return bodyDescReader;\r\n}\r\n\r\nXfo getDrawItemXfo(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  GLSLBinReader bodyDescReader = setupBodyDescReader(bodyDescAddr);\r\n  \r\n  // Skip over the bbox, numSurfaces and then to the current surface data.  \r\n  #ifdef ENABLE_BODY_EDGES\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (1/*numCurves*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/));\r\n  #else\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/));\r\n  #endif\r\n  #ifdef ENABLE_PER_FACE_COLORS\r\n  offsetOfItemRef += drawItemIndexInBody * 4/*color*/; // Skip over the color.\r\n  #endif\r\n  \r\n  vec3 surface_tr = vec3(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+1),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+2),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+3)\r\n    );\r\n\r\n  vec4 surface_ori = normalize(vec4(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+4),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+5),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+6),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+7)\r\n    ));\r\n\r\n  vec3 surface_sc = vec3(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+8),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+9),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+10)\r\n  );\r\n\r\n  Xfo surfaceXfo = Xfo(surface_tr, surface_ori, surface_sc);\r\n  return surfaceXfo;\r\n\r\n}\r\nmat4 getDrawItemMatrix(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  return xfo_toMat4(getDrawItemXfo(bodyDescAddr, drawItemIndexInBody));\r\n  // return mat4(1.0);\r\n}\r\n\r\n#else // CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\nuniform sampler2D drawItemsTexture;\r\nuniform ivec2 vert_drawItemsTextureSize;\r\n\r\n// The Draw Items texture is laid out with 8 pixels per draw item.\r\nvec4 getDrawItemData(int offset) {\r\n  return fetchTexel(drawItemsTexture, vert_drawItemsTextureSize, ivec2(ftoi(drawItemTexAddr.x) + offset, ftoi(drawItemTexAddr.y)));\r\n}\r\n\r\nmat4 getModelMatrix() {\r\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\r\n  vec4 col0 = getDrawItemData(0);\r\n  vec4 col1 = getDrawItemData(1);\r\n  vec4 col2 = getDrawItemData(2);\r\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\r\n  return transpose(result);\r\n}\r\n\r\n#endif // CALC_GLOBAL_XFO_DURING_DRAW\r\n\r\n  `\r\n)\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceDrawing.vertexShader.glsl',\r\n  `\r\n  \r\n<%include file=\"GLSLCADGeomDrawing.vertexShader.glsl\"/>\r\n\r\n\r\n// GEOM\r\nuniform sampler2D surfaceAtlasLayoutTexture;\r\nuniform ivec2 surfaceAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D surfacesAtlasTexture;\r\nuniform ivec2 surfacesAtlasTextureSize;\r\nuniform sampler2D normalsTexture;\r\n\r\nvec4 getSurfaceVertex(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n  return fetchTexel(surfacesAtlasTexture, surfacesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y)));\r\n}\r\n\r\nvec3 getSurfaceNormal(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n  return fetchTexel(normalsTexture, surfacesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y))).rgb;\r\n}\r\n\r\n`\r\n)\r\n\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADGeomDrawing.fragmentShader.glsl',\r\n  `\r\n  uniform sampler2D cadBodiesTexture;\r\n  uniform int cadBodiesTextureSize_frag;\r\n  \r\n  vec4 getCADBodyPixel(int cadBodyId, int pixelOffset) {\r\n    \r\n    int offset = cadBodyId * pixelsPerCADBody;\r\n    ivec2 start;\r\n    start.y += offset / cadBodiesTextureSize_frag;\r\n    start.x = imod(offset, cadBodiesTextureSize_frag);\r\n  \r\n    return fetchTexel(cadBodiesTexture, ivec2(cadBodiesTextureSize_frag), ivec2(start.x + pixelOffset, start.y));\r\n  }\r\n  \r\n  // Is this still used?\r\n  uniform sampler2D drawItemsTexture;\r\n  uniform ivec2 frag_drawItemsTextureSize;\r\n  // The Draw Items texture is laid out with 8 pixels per draw item.\r\n  vec4 getDrawItemData(int offset) {\r\n    return fetchTexel(drawItemsTexture, frag_drawItemsTextureSize, ivec2(ftoi(v_drawCoords.x) + offset, ftoi(v_drawCoords.y)));\r\n  }\r\n  \r\n  \r\n\r\n//////////////////////////////////////////////\r\n// Cutaways\r\n\r\n<%include file=\"cutaways.glsl\"/>\r\n\r\n// bool applyCutaway(int cadBodyId, int flags) {\r\n//   if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n//     vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n//     vec3 cutNormal = cadBodyPixel6.xyz;\r\n//     float cutPlaneDist = cadBodyPixel6.w;\r\n//     if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n//         discard;\r\n//     }\r\n//     return true;\r\n//   }\r\n//   return false;\r\n// }\r\n\r\n// int applyCutaway(int flags, bool backFacing, vec3 cutColor, inout vec4 fragColor) {\r\n//   bool cut = testFlag(flags, BODY_FLAG_CUTAWAY);\r\n//   if(cut){\r\n//     if(cutaway(v_worldPos, cutNormal, planeDist)) {\r\n//       return 1;\r\n//     }\r\n//     if(backFacing){\r\n//       fragColor = vec4(cutColor, 1.0);\r\n//       return 2;\r\n//     }\r\n//   }\r\n//   return 0;\r\n// }\r\n  `\r\n)\r\nshaderLibrary.setShaderModule(\r\n  'GLSLCADSurfaceDrawing.fragmentShader.glsl',\r\n  `\r\n  \r\n<%include file=\"GLSLCADGeomDrawing.fragmentShader.glsl\"/>\r\n\r\n\r\nuniform sampler2D materialsTexture;\r\nuniform ivec2 materialsTextureSize;\r\n\r\nvec4 getMaterialValue(vec2 materialCoords, int valueIndex) {\r\n  return fetchTexel(materialsTexture, materialsTextureSize, ivec2(ftoi(materialCoords.x) + valueIndex, ftoi(materialCoords.y)));\r\n}\r\n\r\n\r\n//////////////////////////////////////////////\r\n// Surface Colors\r\n\r\nuniform sampler2D bodyDescTexture;\r\nuniform ivec2 bodyDescTextureSize_frag;\r\n\r\nGLSLBinReader setupBodyDescReader(ivec2 bodyDescAddr) {\r\n  GLSLBinReader bodyDescReader;\r\n  ivec4 region = ivec4(0, 0, bodyDescTextureSize_frag.x, bodyDescTextureSize_frag.y);\r\n  ivec2 start = ivec2(bodyDescAddr.x, bodyDescAddr.y);\r\n  GLSLBinReader_init(bodyDescReader, bodyDescTextureSize_frag, region, start, 32);\r\n  return bodyDescReader;\r\n}\r\n\r\nvec4 getDrawItemColor(ivec2 bodyDescAddr, int drawItemIndexInBody) {\r\n  GLSLBinReader bodyDescReader = setupBodyDescReader(bodyDescAddr);\r\n  \r\n  #ifdef ENABLE_BODY_EDGES\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (1/*numCurves*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/ + 4/*color*/));\r\n  #else\r\n  int offsetOfItemRef = (6/*bbox*/) + (1/*numSurfaces*/) + (drawItemIndexInBody * (1/*id*/ + 10/*xfo*/ + 4/*color*/));\r\n  #endif\r\n\r\n  vec4 color = vec4(\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+11),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+12),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+13),\r\n    GLSLBinReader_readFloat(bodyDescReader, bodyDescTexture, offsetOfItemRef+14)\r\n  );\r\n\r\n  return color;\r\n}\r\n\r\n//////////////////////////////////////////////\r\n// Trimming\r\nuniform sampler2D trimSetsAtlasLayoutTexture;\r\nuniform ivec2 trimSetsAtlasLayoutTextureSize;\r\n\r\nuniform sampler2D trimSetAtlasTexture;\r\nuniform ivec2 trimSetAtlasTextureSize;\r\n\r\nbool applyTrim(vec4 trimPatchQuad, inout vec3 trimCoords, int flags) {\r\n  if(trimPatchQuad.z > 0.0 && trimPatchQuad.w > 0.0){\r\n    // Remove cobwebs along borders.\r\n    // Tis appears to eliminate cobwebs along borders of trim sets. \r\n    // It does indicate that a math eror exists somewhere else\r\n    // that we would get cobwebs here.\r\n    // To repro, load Dead Eye Bearing and zoom out.\r\n    if (v_textureCoord.x < 0.0 || v_textureCoord.x >= 1.0 || v_textureCoord.y < 0.0 || v_textureCoord.y >= 1.0)\r\n      return true;\r\n\r\n    trimCoords.xy = trimPatchQuad.xy + (trimPatchQuad.zw * v_textureCoord);\r\n\r\n    vec2 trimUv = (trimCoords.xy) / vec2(trimSetAtlasTextureSize);\r\n    vec4 trimTexel = texture2D(trimSetAtlasTexture, trimUv);\r\n\r\n    trimCoords.z = max(trimTexel.r, trimTexel.g);\r\n    \r\n    if (trimTexel.r < 0.5 || trimTexel.g < 0.5) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  else {\r\n    // This is a non-trimmed surface, so return false.\r\n    trimCoords = vec3(-1.0);\r\n    return false;\r\n  }\r\n}\r\n\r\n\r\n`\r\n)\r\n","import { GLShader } from '@zeainc/zea-engine'\n/** Class representing a GL CAD shader.\n * @extends GLShader\n * @ignore\n */\nclass GLCADShader extends GLShader {\n  /**\n   * Create a GL CAD shader.\n   * @param {any} gl - The gl value.\n   */\n  constructor(gl) {\n    super(gl)\n    this.stack = [{}]\n  }\n\n  /**\n   * The setPreprocessorValue method.\n   * @param {any} name - The name param.\n   */\n  setPreprocessorValue(name) {\n    this.getState()[name] = name\n  }\n\n  /**\n   * The clearPreprocessorValue method.\n   * @param {any} name - The name param.\n   */\n  clearPreprocessorValue(name) {\n    delete this.getState()[name]\n  }\n\n  /**\n   * The getState method.\n   * @return {any} - The return value.\n   */\n  getState() {\n    return this.stack[this.stack.length - 1]\n  }\n\n  /**\n   * The pushState method.\n   */\n  pushState() {\n    this.stack.push(Object.assign({}, this.getState()))\n  }\n\n  /**\n   * The popState method.\n   */\n  popState() {\n    this.stack.pop()\n    this.applyOptions()\n  }\n\n  /**\n   * The applyOptions method.\n   */\n  applyOptions() {\n    const directives = [...this.__gl.shaderopts.directives]\n    const state = this.getState()\n    for (const key in state) {\n      directives.push(state[key])\n    }\n    const defines = directives.join('\\n') + '\\n'\n    this.__key = defines\n    this.compileForTarget(this.__key, {\n      directives,\n    })\n  }\n\n  /**\n   * The bind method.\n   * @param {any} renderstate - The renderstate param.\n   * @return {any} - The return value.\n   */\n  bind(renderstate) {\n    return super.bind(renderstate, this.__key)\n  }\n}\n\nexport { GLCADShader }\n","import { shaderLibrary, GLShader, Registry } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADSurfaceNormalsShader_VERTEX_SHADER = `\r\nprecision highp float;\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // (DrawItemData Coords (x, y) \r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform ivec2 quadDetail;\r\nuniform vec3 assetCentroid;\r\nuniform float normalLength;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.vertexShader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int surfaceId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n\r\n    vec2 texCoords = positions.xy + 0.5;\r\n    \r\n    v_drawCoords = drawCoords;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int cadBodyFlags = ftoi(cadBodyPixel0.g);\r\n    \r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(cadBodyFlags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    // if(v_surfaceType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    //     // int drawItemIndexInBody = int(metadata.b+0.5);\r\n    //     int sideLen = int(ceil(sqrt(float(numSurfacesInLibrary))));\r\n    //     int x = drawItemIndexInBody % sideLen;\r\n    //     int y = drawItemIndexInBody / sideLen;\r\n    //     modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n    //                     0.0, 1.0, 0.0, 0.0, \r\n    //                     0.0, 0.0, 1.0, 0.0,  \r\n    //                     float(x), float(y), 0.0, 1.0);\r\n    // }\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    mat4 surfaceMat = getDrawItemMatrix(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * surfaceMat;\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n    mat4 viewProjectionMatrix = projectionMatrix * viewMatrix;\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader surfaceLayoutDataReader;\r\n    GLSLBinReader_init(surfaceLayoutDataReader, surfaceAtlasLayoutTextureSize, 16);\r\n    vec4 surfaceDataAddr = GLSLBinReader_readVec4(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8);\r\n    int surfaceFlags = GLSLBinReader_readInt(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8 + 6);\r\n\r\n    bool isFan = int(quadDetail.y) == 0;\r\n    vec2 vertexCoords = texCoords * (isFan ? vec2(quadDetail) + vec2(1.0, 1.0) : vec2(quadDetail));\r\n\r\n    vec3 normal = getSurfaceNormal(surfaceDataAddr.xy, vertexCoords);\r\n    vec4 pos = vec4(getSurfaceVertex(surfaceDataAddr.xy, vertexCoords).rgb, 1.0);\r\n\r\n    bool flippedNormal = testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    if(flippedNormal){\r\n        normal = -normal;\r\n    }\r\n  \r\n    vec4 worldPos = modelMatrix * pos;\r\n    vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\r\n\r\n    // if (positions.z > 0.5)\r\n    //   worldPos = vec4(vec3(0.0), 1.0);\r\n    worldPos += vec4(worldNormal * positions.z * normalLength, 0.0);\r\n    \r\n    gl_Position = viewProjectionMatrix * worldPos;\r\n\r\n    \r\n    v_textureCoord = texCoords;\r\n    if(testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_UV))\r\n        v_textureCoord = vec2(v_textureCoord.y, v_textureCoord.x);\r\n\r\n    // v_textureCoord.y = 1.0 - v_textureCoord.y; // Flip y\r\n}`\r\n\r\nconst FRAGMENT_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform color BaseColor;\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    vec4 baseColor      = vec4(1.0,0.0,0.0,1.0);\r\n\r\n//#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(baseColor.rgb);\r\n//#endif\r\n\r\n}\r\n`\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface normals shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceNormalsShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw CAD surface normals shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.setShaderStage('VERTEX_SHADER', GLDrawCADSurfaceNormalsShader_VERTEX_SHADER)\r\n    this.setShaderStage('FRAGMENT_SHADER', FRAGMENT_SHADER)\r\n    this.nonSelectable = true\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    return paramDescs\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADSurfaceNormalsShader', GLDrawCADSurfaceNormalsShader)\r\n\r\nexport { GLDrawCADSurfaceNormalsShader_VERTEX_SHADER, GLDrawCADSurfaceNormalsShader }\r\n","/* eslint-disable camelcase */\r\nimport { Color, Registry } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADSurfaceShader_VERTEX_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // body ID, Surface index in Body, Surface Id, TrimSet Id\r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 cameraMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform ivec2 quadDetail;\r\nuniform vec3 assetCentroid;\r\n\r\n// #define DEBUG_SURFACES\r\nuniform int numSurfacesInLibrary;\r\n\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.vertexShader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying vec3 v_bodyDescAddr;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int surfaceId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n\r\n    vec2 texCoords = positions.xy + 0.5;\r\n    \r\n    v_drawCoords = drawCoords;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int cadBodyFlags = ftoi(cadBodyPixel0.g);\r\n    \r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(cadBodyFlags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    // if(v_surfaceType == SURFACE_TYPE_NURBS_SURFACE) {\r\n    //     // int drawItemIndexInBody = int(metadata.b+0.5);\r\n    //     int sideLen = int(ceil(sqrt(float(numSurfacesInLibrary))));\r\n    //     int x = drawItemIndexInBody % sideLen;\r\n    //     int y = drawItemIndexInBody / sideLen;\r\n    //     modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n    //                     0.0, 1.0, 0.0, 0.0, \r\n    //                     0.0, 0.0, 1.0, 0.0,  \r\n    //                     float(x), float(y), 0.0, 1.0);\r\n    // }\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    v_bodyDescAddr.xy = vec2(float(bodyDescAddr.x), float(bodyDescAddr.y));\r\n    v_bodyDescAddr.z = float(drawItemIndexInBody);\r\n    mat4 surfaceMat = getDrawItemMatrix(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * surfaceMat;\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader surfaceLayoutDataReader;\r\n    GLSLBinReader_init(surfaceLayoutDataReader, surfaceAtlasLayoutTextureSize, 16);\r\n    vec4 surfaceDataAddr = GLSLBinReader_readVec4(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8);\r\n    int surfaceFlags = GLSLBinReader_readInt(surfaceLayoutDataReader, surfaceAtlasLayoutTexture, surfaceId * 8 + 6);\r\n\r\n    bool isFan = int(quadDetail.y) == 0;\r\n    vec2 vertexCoords = texCoords * (isFan ? vec2(quadDetail) + vec2(1.0, 1.0) : vec2(quadDetail));\r\n    vec4 surfaceVertex = getSurfaceVertex(surfaceDataAddr.xy, vertexCoords);\r\n    v_surfaceType = surfaceVertex.a;\r\n    vec3 normal  = getSurfaceNormal(surfaceDataAddr.xy, vertexCoords);\r\n    vec4 pos     = vec4(surfaceVertex.rgb, 1.0);\r\n    \r\n    bool flippedNormal = testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    if(flippedNormal)\r\n        normal = -normal;\r\n\r\n    vec4 viewPos = modelViewMatrix * pos;\r\n    v_viewPos    = viewPos.xyz;\r\n    v_worldPos   = (modelMatrix * pos).xyz;\r\n    gl_Position  = projectionMatrix * viewPos;\r\n    v_viewNormal = normalMatrix * normal;\r\n\r\n    v_quadDetail = vec2(quadDetail);\r\n\r\n    {\r\n        // Pull back facing vertices towards us ever so slightly...\r\n        // This is to avoid z-fighting that occurs wehn we see the inside\r\n        // of a surface that is resting on another surface.\r\n        vec3 worldNormal = normalize(mat3(cameraMatrix) * v_viewNormal);\r\n\r\n        vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(-v_viewPos));\r\n        float ndotv = dot(worldNormal, viewVector);\r\n        bool backFacing = ndotv <= 0.0;\r\n        if (backFacing) {\r\n            // Pull backfacing vertices towards us ever so slightly...\r\n            gl_Position.z *= 0.99999;\r\n        }\r\n    }\r\n\r\n    if(isFan) {\r\n        // We are drawing a Fan surface, so the uv coords\r\n        // simply come from the vertex positions.\r\n        v_textureCoord = positions.xy;\r\n    }\r\n    else {\r\n        v_textureCoord = texCoords;\r\n        if(testFlag(surfaceFlags, SURFACE_FLAG_FLIPPED_UV)) {\r\n            v_textureCoord = vec2(v_textureCoord.y, v_textureCoord.x);\r\n            v_quadDetail = vec2(v_quadDetail.y, v_quadDetail.x);\r\n        }\r\n\r\n        // v_textureCoord.y = 1.0 - v_textureCoord.y; // Flip y\r\n    }\r\n}`\r\n\r\nconst GLDrawCADSurfaceShader_FRAGMENT_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"math/constants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GGX_Specular.glsl\"/>\r\n<%include file=\"PBRSurfaceRadiance.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nuniform bool headLighting;\r\nuniform bool displayWireframes;\r\nuniform bool displayEdges;\r\n\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\nuniform float exposure;\r\n#endif\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying vec3 v_bodyDescAddr;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\nvec3 getDebugColor(int id){\r\n    \r\n    int sel = int(round(mod(float(id), 14.0)));\r\n    \r\n    if(sel==0)\r\n        return vec3(0.0, 1.0, 1.0);\r\n    else if (sel==1)\r\n        return vec3(0.0, 1.0, 0.0);\r\n    else if (sel==2)\r\n        return vec3(1.0, 0.0, 1.0);\r\n    else if (sel==3)\r\n        return vec3(0.75, 0.75, 0.0);\r\n    else if (sel==4)\r\n        return vec3(0.0, 0.75, 0.75);\r\n    else if (sel==5)\r\n        return vec3(0.75, 0.0, 0.75);\r\n    else if (sel==6)\r\n        return vec3(0.45, 0.95, 0.0);\r\n    else if (sel==7)\r\n        return vec3(0.0, 0.45, 0.95);\r\n    else if (sel==8)\r\n        return vec3(0.95, 0.0, 0.45);\r\n    else if (sel==9)\r\n        return vec3(0.95, 0.45, 0.0);\r\n    else if (sel==10)\r\n        return vec3(0.0, 0.95, 0.45);\r\n    else if (sel==11)\r\n        return vec3(0.45, 0.0, 0.95);\r\n    else if (sel==12)\r\n        return vec3(0.45, 0.45, 0.95);\r\n    else if (sel==13)\r\n        return vec3(0.0, 0.0, 0.45);\r\n    else if (sel==14)\r\n        return vec3(0.0, 0.45, 0.45);\r\n    else if (sel==15)\r\n        return vec3(0.45, 0.0, 0.45);\r\n    else return vec3(0.2, 0.2, 0.2);\r\n}\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n// const float gridSize = 0.02;\r\nconst float gridSize = 0.2;\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n    \r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n    vec2 materialCoords = cadBodyPixel1.xy;\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    ///////////////////////////////////////////\r\n    // Normal\r\n\r\n    vec3 normal = normalize(mat3(cameraMatrix) * v_viewNormal);\r\n    vec3 viewNormal = normalize(v_viewNormal);\r\n\r\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(-v_viewPos));\r\n    bool backFacing = dot(normal, viewVector) <= 0.0;\r\n    if(backFacing){\r\n        normal = -normal;\r\n        viewNormal = -viewNormal;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Material\r\n\r\n    vec4 matValue0 = getMaterialValue(materialCoords, 0);\r\n\r\n    MaterialParams material;\r\n\r\n    /////////////////\r\n    bool clayRendering = false;\r\n    \r\n    material.baseColor             = matValue0.rgb;\r\n    material.opacity               = matValue0.a;\r\n    \r\n    /////////////////\r\n    // Face color\r\n#ifdef ENABLE_PER_FACE_COLORS\r\n    vec4 faceColor = getDrawItemColor(ftoi(v_bodyDescAddr.xy), ftoi(v_bodyDescAddr.z));\r\n    material.baseColor = mix(material.baseColor, faceColor.rgb, faceColor.a);\r\n#endif\r\n\r\n    if(clayRendering) {\r\n        material.baseColor          = vec3(0.45, 0.26, 0.13);\r\n        material.opacity            = 1.0;\r\n    } \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    // if (applyCutaway(cadBodyId, flags)) {\r\n    //     discard;\r\n    //     return;\r\n    // }\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = normalize(cadBodyPixel6.xyz);\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n            return;\r\n        }\r\n        // If we are not cutaway, but we can see a back facing face\r\n        // then set the normal to the cut plane do the lighting is flat.\r\n        if (backFacing){\r\n            normal = cutNormal;\r\n        }\r\n    }\r\n\r\n    /////////////////\r\n    // Debug backFacing\r\n    // if(backFacing) {\r\n    //     material.baseColor = mix(material.baseColor, vec3(1.0, 0.0, 0.0), 0.5);\r\n    // }\r\n\r\n    /////////////////\r\n    // Debug materialId\r\n#ifdef DEBUG_MATERIALID\r\n    {\r\n        material.baseColor = vec3(float(int(materialCoords.x) % 5)/5.0, float(int(materialCoords.y) % 5)/5.0, 0.0);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug bodyId\r\n#ifdef DEBUG_BODYID\r\n    {\r\n        material.baseColor       = getDebugColor(cadBodyId);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug drawItemIndexInBody\r\n#ifdef DEBUG_SURFACEID\r\n    {\r\n        material.baseColor       = getDebugColor(drawItemIndexInBody);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // Debug surface Type\r\n#ifdef DEBUG_SURFACETYPE\r\n    {\r\n        material.baseColor       = getDebugColor(v_surfaceType);\r\n    }\r\n#endif\r\n\r\n    /////////////////\r\n    // bool flippedNormal = testFlag(flags, SURFACE_FLAG_FLIPPED_NORMAL);\r\n    // if(flippedNormal) {\r\n    //    material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // }\r\n\r\n    // if (backFacing) {\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // }\r\n\r\n    /////////////////\r\n    // Debug UV layout.\r\n    // {\r\n    //     material.baseColor = vec3(v_textureCoord.x);\r\n    //     // material.baseColor.r = mix(0.0, 1.0, v_textureCoord.x);\r\n    //     // material.baseColor.g = mix(0.0, 1.0, v_textureCoord.y);\r\n    // }\r\n\r\n    /////////////////\r\n    // if(testFlag(flags, SURFACE_FLAG_FLIPPED_UV)){\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,1,1), 0.5);\r\n    // }\r\n\r\n    /////////////////\r\n    // if(v_quadDetail.x > 512.0 || v_quadDetail.y > 512.0){\r\n    //     material.baseColor = mix(material.baseColor, vec3(1,0,0), 0.75);\r\n    // } else {\r\n    //     // discard;\r\n    // }\r\n    \r\n    /////////////////\r\n    // Debug trim texture.\r\n#ifdef DEBUG_TRIMTEXELS\r\n    if(trimCoords.x >= 0.0) {\r\n        // trimCoords = (trimPatchQuad.xy + 0.5) + ((trimPatchQuad.zw - 0.5) * v_textureCoord);\r\n        trimCoords.xy = trimPatchQuad.xy + (trimPatchQuad.zw * v_textureCoord);\r\n        vec2 trimUv = (trimCoords.xy) / vec2(trimSetAtlasTextureSize);\r\n        vec4 trimTexel = texture2D(trimSetAtlasTexture, trimUv);\r\n\r\n        vec2 texelOffset = trimCoords.xy - (floor(trimCoords.xy) + 0.5);\r\n        float texelDist = length(texelOffset);\r\n        \r\n        material.baseColor = trimTexel.rgb * texelDist;\r\n\r\n        // if (trimTexel.r > 0.5 && trimTexel.g > 0.5) {\r\n        //     material.baseColor = vec3(0,0,0);\r\n        // }\r\n\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), texelDist);\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), trimCoords.z);\r\n        // material.baseColor = mix(material.baseColor, vec3(0,0,0), (trimCoords.z < 0.5) ? 1.0 : 0.0);\r\n\r\n        // if(trimCoords.z < 0.5) {\r\n        //     material.baseColor = mix(material.baseColor, vec3(0,0,0), 0.1);\r\n        // }\r\n        // else{\r\n        //     float total = floor(trimCoords.x) +\r\n        //                   floor(trimCoords.y);\r\n        //     if(mod(total,2.0)==0.0)\r\n        //         material.baseColor = mix(material.baseColor, vec3(0,0,0), 0.25);\r\n        //     else\r\n        //         material.baseColor = mix(material.baseColor, vec3(1,1,1), 0.25);\r\n        // }\r\n    }\r\n#endif\r\n\r\n\r\n    \r\n    //////////////////////////////////////////////\r\n    // Transparency\r\n    // Simple screen door transparency.\r\n    // float threshold = gridSize * opacity * (1.0 - (v_viewPos.z / 300.0));\r\n    // // if(mod(v_viewPos.x / v_viewPos.z, gridSize) > threshold || mod(v_viewPos.y/v_viewPos.z, gridSize) > threshold)// || mod(v_viewPos.z, gridSize) > threshold)\r\n    // if(mod(abs(v_worldPos.x), gridSize) > threshold || mod(abs(v_worldPos.y), gridSize) > threshold || mod(abs(v_worldPos.z), gridSize) > threshold)\r\n    //     discard;\r\n\r\n\r\n    ///////////////////////////////////////////\r\n    // Lighting\r\n    vec3 radiance;\r\n\r\n    vec4 matValue1;\r\n    if(clayRendering)\r\n        matValue1          = vec4(0.0, 0.9, 0.1, 0.0);\r\n    else\r\n        matValue1          = getMaterialValue(materialCoords, 1);\r\n\r\n    material.metallic       = matValue1.r;\r\n    material.roughness      = matValue1.g;\r\n    material.reflectance    = matValue1.b;\r\n    material.emission       = matValue1.a;\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n    fragColor = pbrSurfaceRadiance(material, normal, viewVector);\r\n\r\n    /////////////////////////////\r\n    // fragColor = vec4(material.baseColor, 1.0);\r\n    // fragColor = vec4( normalize(viewNormal), 1.0);\r\n    // fragColor = vec4( normalize(normal), 1.0);\r\n\r\n    // fragColor = vec4(sampleEnvMap(viewNormal, material.roughness), 1.0);;\r\n    \r\n    ////////////////////\r\n    {\r\n        // vec4 wireColor = vec4(0.1, 0.1, 0.1, 1.0);\r\n        //vec4 wireColor = vec4(0.6, 0.6, 0.6, 1.0);\r\n        vec4 wireColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n        \r\n        vec2 vertexCoords = v_textureCoord * v_quadDetail;\r\n        vec2 vcD = fwidth(vertexCoords);\r\n        vec2 vcW = fract(vertexCoords);\r\n\r\n        bool isFan = v_quadDetail.y < 0.5;\r\n        if(displayWireframes) {\r\n            if (isFan) {\r\n\r\n            } else {\r\n        \r\n                float lerpVal = smoothstep(0.0, vcD.x, vcW.x) * smoothstep(1.0, 1.0 - vcD.x, vcW.x) * smoothstep(0.0, vcD.y, vcW.y) * smoothstep(1.0, 1.0 - vcD.y, vcW.y);\r\n                \r\n                // Display a thin line at 50% opacity.\r\n                fragColor = mix(fragColor, wireColor, (1.0-smoothstep(0.0, 0.5, lerpVal)) * 0.5 );\r\n        \r\n                //fragColor = mix(fragColor, wireColor, (mod(vertexCoords.x, 2.0) < 1.0) ? 0.5 : 0.0 );\r\n            }\r\n        }\r\n    }\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\r\n#endif\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceShader extends GLCADShader {\r\n  /*\r\n   * Create a GL draw CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n    this.setShaderStage('VERTEX_SHADER', GLDrawCADSurfaceShader_VERTEX_SHADER)\r\n    this.setShaderStage('FRAGMENT_SHADER', GLDrawCADSurfaceShader_FRAGMENT_SHADER)\r\n  }\r\n\r\n  /**\r\n   * The bind method.\r\n   * @param {object} renderstate - The object tracking the current state of the renderer\r\n   * @param {string} key - The key value.\r\n   * @return {any} - The return value.\r\n   */\r\n  bind(renderstate, key) {\r\n    super.bind(renderstate, key)\r\n\r\n    const gl = this.__gl\r\n    if (renderstate.envMap) {\r\n      renderstate.envMap.bind(renderstate)\r\n    }\r\n\r\n    const { exposure } = renderstate.unifs\r\n    if (exposure) {\r\n      gl.uniform1f(exposure.location, renderstate.exposure)\r\n    }\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    paramDescs.push({\r\n      name: 'EmissiveStrength',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Metallic',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Roughness',\r\n      defaultValue: 0.25,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Normal',\r\n      defaultValue: new Color(0.0, 0.0, 0.0),\r\n    })\r\n    paramDescs.push({\r\n      name: 'TexCoordScale',\r\n      defaultValue: 1.0,\r\n      texturable: false,\r\n    })\r\n    // F0 = reflectance and is a physical property of materials\r\n    // It also has direct relation to IOR so we need to dial one or the other\r\n    // For simplicity sake, we don't need to touch this value as metalic can dictate it\r\n    // such that non metallic is mostly around (0.01-0.025) and metallic around (0.7-0.85)\r\n    paramDescs.push({\r\n      name: 'Reflectance',\r\n      defaultValue: 0.025,\r\n    })\r\n    return paramDescs\r\n  }\r\n\r\n  /**\r\n   * The getPackedMaterialData method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getPackedMaterialData(material) {\r\n    const matData = new Float32Array(8)\r\n    const baseColor = material.getParameter('BaseColor').getValue()\r\n    matData[0] = baseColor.r\r\n    matData[1] = baseColor.g\r\n    matData[2] = baseColor.b\r\n    matData[3] = baseColor.a\r\n    if (material.getParameter('EmissiveStrength')) {\r\n      matData[4] = material.getParameter('Metallic').getValue()\r\n      matData[5] = material.getParameter('Roughness').getValue()\r\n      matData[6] = material.getParameter('Reflectance').getValue()\r\n      matData[7] = material.getParameter('EmissiveStrength').getValue()\r\n    } else {\r\n      matData[5] = 1.0\r\n    }\r\n    return matData\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawCADSurfaceShader', GLDrawCADSurfaceShader)\r\n\r\nexport { GLDrawCADSurfaceShader_VERTEX_SHADER, GLDrawCADSurfaceShader_FRAGMENT_SHADER, GLDrawCADSurfaceShader }\r\n","/* eslint-disable camelcase */\r\nimport { GLDrawCADSurfaceShader_VERTEX_SHADER } from './GLDrawCADSurfaceShader.js'\r\n\r\nconst FRAGMENT_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nuniform int passIndex;\r\nuniform int assetIndex;\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int surfaceIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    float dist = length(v_viewPos);\r\n\r\n    int passAndAssetIndex = passIndex + (assetIndex * 64);\r\n\r\n    fragColor.r = float(passAndAssetIndex);\r\n    fragColor.g = float(cadBodyId);\r\n    fragColor.b = float(surfaceIndexInBody);\r\n    fragColor.a = dist;\r\n    \r\n    // fragColor.b = float(v_surfaceType);\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface geom data shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADSurfaceGeomDataShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw CAD surface geom data shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.setShaderStage('VERTEX_SHADER', GLDrawCADSurfaceShader_VERTEX_SHADER)\r\n    this.setShaderStage('FRAGMENT_SHADER', FRAGMENT_SHADER)\r\n\r\n    this.nonSelectable = true\r\n  }\r\n}\r\n\r\nexport { GLDrawCADSurfaceGeomDataShader }\r\n","import { shaderLibrary, Registry } from '@zeainc/zea-engine'\r\nimport { GLDrawCADSurfaceShader_VERTEX_SHADER } from './GLDrawCADSurfaceShader.js'\r\n\r\nconst FRAGMENT_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLBinReader.glsl\"/>\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\nvarying vec3 v_viewNormal;\r\nvarying vec2 v_textureCoord;\r\nvarying float v_surfaceType;\r\nvarying vec2 v_quadDetail;\r\n\r\n<%include file=\"GLSLCADSurfaceDrawing.fragmentShader.glsl\"/>\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n    \r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int surfaceIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int surfaceId = int(floor(v_drawCoords.b + 0.5));\r\n    int trimSetId = int(floor(v_drawCoords.a + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Trimming\r\n    vec4 trimPatchQuad;\r\n    vec3 trimCoords;\r\n    if(trimSetId >= 0) {\r\n        GLSLBinReader trimsetLayoutDataReader;\r\n        GLSLBinReader_init(trimsetLayoutDataReader, trimSetsAtlasLayoutTextureSize, 16);\r\n        trimPatchQuad = GLSLBinReader_readVec4(trimsetLayoutDataReader, trimSetsAtlasLayoutTexture, trimSetId*4);\r\n\r\n        if(applyTrim(trimPatchQuad, trimCoords, flags)){\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n    \r\n    vec4 highlightColor = getCADBodyPixel(cadBodyId, 5);\r\n    fragColor = highlightColor;\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw selected CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawSelectedCADSurfaceShader extends GLCADShader {\r\n  /**\r\n   * Create a GL draw selected CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.setShaderStage('VERTEX_SHADER', GLDrawCADSurfaceShader_VERTEX_SHADER)\r\n    this.setShaderStage('FRAGMENT_SHADER', FRAGMENT_SHADER)\r\n    this.nonSelectable = true\r\n  }\r\n}\r\n\r\nRegistry.register('GLDrawSelectedCADSurfaceShader', GLDrawSelectedCADSurfaceShader)\r\n\r\nexport { GLDrawSelectedCADSurfaceShader }\r\n","/* eslint-disable camelcase */\r\nimport { Color } from '@zeainc/zea-engine'\r\nimport './GLSLCADConstants.js'\r\nimport './GLSLMath.js'\r\nimport './GLSLCADSurfaceDrawing.js'\r\n\r\nconst GLDrawCADCurveShader_VERTEX_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n<%include file=\"stack-gl/transpose.glsl\"/>\r\n<%include file=\"stack-gl/inverse.glsl\"/>\r\n\r\nattribute vec3 positions;\r\ninstancedattribute vec4 drawCoords;  // body ID, Surface index in Body, Surface Id, TrimSet Id\r\n// instancedattribute vec2 drawItemTexAddr;  // Address of the data in the draw item texture. (mat4)\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 cameraMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform int edgeDetail;\r\nuniform vec3 assetCentroid;\r\n\r\n\r\n// #define DEBUG_SURFACES\r\nuniform int numCurvesInLibrary;\r\n\r\n\r\n<%include file=\"GLSLCADGeomDrawing.vertexShader.glsl\"/>\r\n\r\n// GEOM\r\nuniform sampler2D curvesAtlasLayoutTexture;\r\nuniform ivec2 curvesAtlasLayoutTextureSize;\r\n\r\n\r\nuniform sampler2D curvesAtlasTexture;\r\nuniform ivec2 curvesAtlasTextureSize;\r\n// uniform sampler2D normalsTexture;\r\n\r\nvec3 getCurveVertex(ivec2 addr, int vertexId) {\r\n  return fetchTexel(curvesAtlasTexture, curvesAtlasTextureSize, ivec2(addr.x + vertexId, addr.y)).rgb;\r\n}\r\n\r\n// vec3 getCurveTangent(vec2 surfacePatchCoords, vec2 vertexCoord) {\r\n//   return fetchTexel(normalsTexture, curvesAtlasTextureSize, ivec2(ftoi(surfacePatchCoords.x + vertexCoord.x), ftoi(surfacePatchCoords.y + vertexCoord.y))).rgb;\r\n// }\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\n\r\nvoid main(void) {\r\n    int cadBodyId = ftoi(drawCoords.r);\r\n    int drawItemIndexInBody = ftoi(drawCoords.g);\r\n    int curveId = ftoi(drawCoords.b);\r\n    int trimSetId = ftoi(drawCoords.a);\r\n    v_drawCoords = drawCoords;\r\n\r\n    vec2 texCoords = positions.xy;\r\n\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    vec4 cadBodyPixel1 = getCADBodyPixel(cadBodyId, 1);\r\n\r\n    // int bodyDescId = ftoi(cadBodyPixel0.r);\r\n    int flags = ftoi(cadBodyPixel0.g);\r\n\r\n    // vec4 metadata = getDrawItemData(0);\r\n    // ivec4 curveAtlasCoords = ftoi(getDrawItemData(2));\r\n    // int flags = int(floor(metadata.a + 0.5));\r\n\r\n    //////////////////////////////////////////////\r\n    // Visibility\r\n    if(testFlag(flags, BODY_FLAG_INVISIBLE)) {\r\n        gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n        return;\r\n    }\r\n\r\n    //////////////////////////////////////////////\r\n    // Transforms\r\n#ifdef DEBUG_SURFACES\r\n    mat4 modelMatrix = mat4(1.0);\r\n    int numCurvesInLibrary = 15;\r\n    // int sideLen = int(ceil(sqrt(float(numCurvesInLibrary))));\r\n    // int x = curveId % sideLen;\r\n    // int y = curveId / sideLen;\r\n    modelMatrix = mat4(1.0, 0.0, 0.0, 0.0, \r\n                    0.0, 1.0, 0.0, 0.0, \r\n                    0.0, 0.0, 1.0, 0.0,  \r\n                    float(curveId), float(0), 0.0, 1.0);\r\n#else\r\n\r\n#ifdef CALC_GLOBAL_XFO_DURING_DRAW\r\n    mat4 bodyMat = getCADBodyMatrix(cadBodyId);\r\n    ivec2 bodyDescAddr = ftoi(cadBodyPixel0.ba);\r\n    mat4 curveMat = getDrawItemMatrix(bodyDescAddr, drawItemIndexInBody);\r\n    mat4 modelMatrix = bodyMat * curveMat;\r\n\r\n    // v_sc = surfaceXfo.sc;\r\n    //if (v_sc.z > 0.0) {\r\n    //  gl_Position = vec4(-3.0, -3.0, -3.0, 1.0);;\r\n    //  return;\r\n    //}\r\n#else\r\n    mat4 modelMatrix = getModelMatrix();\r\n    // Note: on mobile GPUs, we get only FP16 math in the\r\n    // fragment shader, causing inaccuracies in modelMatrix\r\n    // calculation. By offsetting the data to the origin\r\n    // we calculate a modelMatrix in the asset space, and\r\n    //  then add it back on during final drawing.\r\n    // modelMatrix[3][0] += assetCentroid.x;\r\n    // modelMatrix[3][1] += assetCentroid.y;\r\n    // modelMatrix[3][2] += assetCentroid.z;\r\n#endif\r\n#endif\r\n    // modelMatrix = mat4(0.001, 0.0, 0.0, 0.0, \r\n    //   0.0, 0.001, 0.0, 0.0, \r\n    //   0.0, 0.0, 0.001, 0.0,  \r\n    //   0.0, 0.0, 0.0, 1.0);\r\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\r\n\r\n    //////////////////////////////////////////////\r\n    // Vertex Attributes\r\n    \r\n    GLSLBinReader curvesLayoutDataReader;\r\n    GLSLBinReader_init(curvesLayoutDataReader, curvesAtlasLayoutTextureSize, 16);\r\n    vec4 curveDataAddr = GLSLBinReader_readVec4(curvesLayoutDataReader, curvesAtlasLayoutTexture, curveId * 8);\r\n\r\n    int vertexId = int(positions.x * float(edgeDetail));\r\n    vec4 pos     = vec4(getCurveVertex(ftoi(curveDataAddr.xy), vertexId), 1.0);\r\n    // vec4 pos     = vec4(positions * float(edgeDetail), 1.0);\r\n\r\n    // if (vertexId == 0)\r\n    //   pos = vec4(vec3(0.0), 1.0);\r\n\r\n    vec4 viewPos = modelViewMatrix * pos;\r\n    v_viewPos    = viewPos.xyz;\r\n    v_worldPos   = (modelMatrix * pos).xyz;\r\n    gl_Position  = projectionMatrix * viewPos;\r\n\r\n    {\r\n        // Pull edge vertices towards us ever so slightly...\r\n        gl_Position.z *= 0.99999;\r\n    }\r\n}`\r\n\r\nconst GLDrawCADCurveShader_FRAGMENT_SHADER = `\r\nprecision highp float;\r\n\r\n<%include file=\"math/constants.glsl\"/>\r\n<%include file=\"GLSLUtils.glsl\"/>\r\n<%include file=\"stack-gl/gamma.glsl\"/>\r\n<%include file=\"materialparams.glsl\"/>\r\n<%include file=\"GGX_Specular.glsl\"/>\r\n<%include file=\"PBRSurfaceRadiance.glsl\"/>\r\n\r\n<%include file=\"GLSLCADConstants.glsl\"/>\r\n\r\nuniform mat4 cameraMatrix;\r\n\r\nuniform bool headLighting;\r\nuniform bool displayWireframes;\r\nuniform bool displayEdges;\r\nuniform vec4 edgeColor;\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\nuniform float exposure;\r\nuniform float gamma;\r\n#endif\r\n\r\nvarying vec4 v_drawCoords;\r\nvarying vec3 v_viewPos;\r\nvarying vec3 v_worldPos;\r\n\r\n<%include file=\"GLSLCADGeomDrawing.fragmentShader.glsl\"/>\r\n\r\nvec3 getDebugColor(int id){\r\n    \r\n  int sel = int(round(mod(float(id), 14.0)));\r\n  \r\n  if(sel==0)\r\n      return vec3(0.0, 1.0, 1.0);\r\n  else if (sel==1)\r\n      return vec3(0.0, 1.0, 0.0);\r\n  else if (sel==2)\r\n      return vec3(1.0, 0.0, 1.0);\r\n  else if (sel==3)\r\n      return vec3(0.75, 0.75, 0.0);\r\n  else if (sel==4)\r\n      return vec3(0.0, 0.75, 0.75);\r\n  else if (sel==5)\r\n      return vec3(0.75, 0.0, 0.75);\r\n  else if (sel==6)\r\n      return vec3(0.45, 0.95, 0.0);\r\n  else if (sel==7)\r\n      return vec3(0.0, 0.45, 0.95);\r\n  else if (sel==8)\r\n      return vec3(0.95, 0.0, 0.45);\r\n  else if (sel==9)\r\n      return vec3(0.95, 0.45, 0.0);\r\n  else if (sel==10)\r\n      return vec3(0.0, 0.95, 0.45);\r\n  else if (sel==11)\r\n      return vec3(0.45, 0.0, 0.95);\r\n  else if (sel==12)\r\n      return vec3(0.45, 0.45, 0.95);\r\n  else if (sel==13)\r\n      return vec3(0.0, 0.0, 0.45);\r\n  else if (sel==14)\r\n      return vec3(0.0, 0.45, 0.45);\r\n  else if (sel==15)\r\n      return vec3(0.45, 0.0, 0.45);\r\n  else return vec3(0.2, 0.2, 0.2);\r\n}\r\n\r\n#ifdef ENABLE_ES3\r\nout vec4 fragColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n#ifndef ENABLE_ES3\r\n    vec4 fragColor;\r\n#endif\r\n\r\n    int cadBodyId = int(floor(v_drawCoords.r + 0.5));\r\n    int drawItemIndexInBody = int(floor(v_drawCoords.g + 0.5));\r\n    int curveId = int(floor(v_drawCoords.b + 0.5));\r\n\r\n    // TODO: pass as varying from pixel shader.\r\n    vec4 cadBodyPixel0 = getCADBodyPixel(cadBodyId, 0);\r\n    int flags = int(floor(cadBodyPixel0.g + 0.5));\r\n            \r\n\r\n    //////////////////////////////////////////////\r\n    // Cutaways\r\n    if (testFlag(flags, BODY_FLAG_CUTAWAY)) {\r\n        vec4 cadBodyPixel6 = getCADBodyPixel(cadBodyId, 6);\r\n        vec3 cutNormal = cadBodyPixel6.xyz;\r\n        float cutPlaneDist = cadBodyPixel6.w;\r\n        if (cutaway(v_worldPos, cutNormal, cutPlaneDist)) {\r\n            discard;\r\n            return;\r\n        }\r\n    }\r\n\r\n    fragColor = edgeColor;\r\n\r\n    // fragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    // if (v_sc.x < 0.0) {\r\n    //   fragColor.r = 1.0;\r\n    // }\r\n    // if (v_sc.y < 0.0) {\r\n    //   fragColor.g = 1.0;\r\n    // }\r\n    // if (v_sc.z < 0.0) {\r\n    //   fragColor.b = 1.0;\r\n    // }\r\n\r\n    /////////////////\r\n    // Debug drawItemIndexInBody\r\n    // {\r\n    //   fragColor.rgb = mix(vec3(1.,1.,1.), getDebugColor(drawItemIndexInBody), float(drawItemIndexInBody)/5.0);\r\n    // }\r\n\r\n#ifdef ENABLE_INLINE_GAMMACORRECTION\r\n    fragColor.rgb = toGamma(fragColor.rgb * exposure, gamma);\r\n#endif\r\n\r\n#ifndef ENABLE_ES3\r\n    gl_FragColor = fragColor;\r\n#endif\r\n}\r\n`\r\n\r\nimport { GLCADShader } from './GLCADShader.js'\r\n\r\n/** Class representing a GL draw CAD surface shader.\r\n * @extends GLCADShader\r\n * @ignore\r\n */\r\nclass GLDrawCADCurveShader extends GLCADShader {\r\n  /*\r\n   * Create a GL draw CAD surface shader.\r\n   * @param {any} gl - The gl value.\r\n   */\r\n  constructor(gl) {\r\n    super(gl)\r\n\r\n    this.setShaderStage('VERTEX_SHADER', GLDrawCADCurveShader_VERTEX_SHADER)\r\n    this.setShaderStage('FRAGMENT_SHADER', GLDrawCADCurveShader_FRAGMENT_SHADER)\r\n  }\r\n\r\n  /**\r\n   * The getParamDeclarations method.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getParamDeclarations() {\r\n    const paramDescs = super.getParamDeclarations()\r\n    paramDescs.push({\r\n      name: 'BaseColor',\r\n      defaultValue: new Color(1.0, 1.0, 0.5),\r\n    })\r\n    paramDescs.push({\r\n      name: 'EmissiveStrength',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Metallic',\r\n      defaultValue: 0.0,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Roughness',\r\n      defaultValue: 0.25,\r\n    })\r\n    paramDescs.push({\r\n      name: 'Normal',\r\n      defaultValue: new Color(0.0, 0.0, 0.0),\r\n    })\r\n    paramDescs.push({\r\n      name: 'TexCoordScale',\r\n      defaultValue: 1.0,\r\n      texturable: false,\r\n    })\r\n    // F0 = reflectance and is a physical property of materials\r\n    // It also has direct relation to IOR so we need to dial one or the other\r\n    // For simplicity sake, we don't need to touch this value as metalic can dictate it\r\n    // such that non metallic is mostly around (0.01-0.025) and metallic around (0.7-0.85)\r\n    paramDescs.push({\r\n      name: 'Reflectance',\r\n      defaultValue: 0.025,\r\n    })\r\n    return paramDescs\r\n  }\r\n\r\n  /**\r\n   * The getPackedMaterialData method.\r\n   * @param {any} material - The material param.\r\n   * @return {any} - The return value.\r\n   */\r\n  static getPackedMaterialData(material) {\r\n    const matData = new Float32Array(8)\r\n    const baseColor = material.getParameter('BaseColor').getValue()\r\n    matData[0] = baseColor.r\r\n    matData[1] = baseColor.g\r\n    matData[2] = baseColor.b\r\n    matData[3] = baseColor.a\r\n    if (material.getParameter('EmissiveStrength')) {\r\n      matData[4] = material.getParameter('Metallic').getValue()\r\n      matData[5] = material.getParameter('Roughness').getValue()\r\n      matData[6] = material.getParameter('Reflectance').getValue()\r\n      matData[7] = material.getParameter('EmissiveStrength').getValue()\r\n    } else {\r\n      matData[5] = 1.0\r\n    }\r\n    return matData\r\n  }\r\n}\r\n\r\nexport { GLDrawCADCurveShader }\r\n","import { SystemDesc, GLMesh, Plane, GLPass, Registry } from '@zeainc/zea-engine'\r\nimport { CADAsset } from './CADAsset.js'\r\nimport { GLCADAsset } from './GLCADAsset.js'\r\nimport { GLCADMaterialLibrary } from './GLCADMaterialLibrary.js'\r\n\r\nimport { GLDrawCADSurfaceNormalsShader } from './GLDrawCADSurfaceNormalsShader.js'\r\nimport { GLDrawCADSurfaceGeomDataShader } from './GLDrawCADSurfaceGeomDataShader.js'\r\nimport { GLDrawSelectedCADSurfaceShader } from './GLDrawSelectedCADSurfaceShader.js'\r\nimport { GLDrawCADCurveShader } from './GLDrawCADCurveShader.js'\r\n\r\n/**\r\n * Class representing a GL CAD pass.\r\n *\r\n * **Events**\r\n * * **updated**\r\n * @extends GLPass\r\n */\r\nclass GLCADPass extends GLPass {\r\n  /**\r\n   * Create a GL CAD pass.\r\n   * @param {boolean} debugMode - If true, then puts the GLCADPass rendering into debug mode.\r\n   */\r\n  constructor(debugMode = false) {\r\n    super()\r\n    this.debugMode = debugMode\r\n    this.headLighting = false\r\n    this.displayWireframes = false\r\n    this.displaySurfaces = true\r\n    this.__displayEdges = 0\r\n    this.displayNormals = false\r\n    this.normalLength = 0.002 // 2cm\r\n    this.debugTrimTex = false\r\n    this.debugSurfaceAtlas = false\r\n    this.debugAssetId = 0\r\n    this.pbrEnabled = false\r\n    this.__assets = []\r\n    this.__loadQueue = 0\r\n\r\n    this.__numHighlightedGeoms = 0\r\n\r\n    // Note: fist id reserved for selectionOutlineID = 1\r\n    // See 'draw()' below.\r\n    this.__shaderCount = 2\r\n    this.__shaderKeys = {}\r\n    this.__shaderOptsStack = [{}]\r\n\r\n    this.__profiling = {\r\n      numSurfaces: 0,\r\n      numSurfaceInstances: 0,\r\n      surfaceEvalTime: 0,\r\n      numBodies: 0,\r\n      numMaterials: 0,\r\n      numTriangles: 0,\r\n      numDrawSets: 0,\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  get displayEdges() {\r\n    return this.__displayEdges > 0\r\n  }\r\n\r\n  // eslint-disable-next-line require-jsdoc\r\n  set displayEdges(val) {\r\n    if (val == true) this.__displayEdges++\r\n    else this.__displayEdges--\r\n    this.emit('updated')\r\n  }\r\n\r\n  /**\r\n   * The init method.\r\n   * @param {any} renderer - The renderer param.\r\n   * @param {any} passIndex - The passIndex param.\r\n   */\r\n  init(renderer, passIndex) {\r\n    super.init(renderer, passIndex)\r\n\r\n    this.__dataLoadStartTime = performance.now()\r\n\r\n    const gl = renderer.gl\r\n\r\n    const materialLibrary = new GLCADMaterialLibrary(gl)\r\n    materialLibrary.on('updated', () => this.emit('updated'))\r\n\r\n    // Note: The crappy browsers don't support GLSL binary caching, so\r\n    // load times get quite long as we wait for the big shaders to compile.\r\n\r\n    if (gl.name != 'webgl2') {\r\n      this.setShaderPreprocessorValue('#extension GL_OES_standard_derivatives : enable')\r\n    }\r\n\r\n    if (this.debugMode) {\r\n      this.setShaderPreprocessorValue('#define DEBUG_MODE')\r\n    }\r\n\r\n    this.setShaderPreprocessorValue('#define ENABLE_TRIMMING')\r\n    this.setShaderPreprocessorValue('#define ENABLE_INLINE_GAMMACORRECTION')\r\n\r\n    this.__cadpassdata = {\r\n      debugMode: this.debugMode,\r\n      assetCount: 0,\r\n      materialLibrary,\r\n\r\n      glplanegeom: new GLMesh(gl, new Plane(1.0, 1.0, 1, 1)),\r\n      maxTexSize: SystemDesc.gpuDesc.maxTextureSize,\r\n\r\n      incHighlightedCount: this.incHighlightedCount.bind(this),\r\n      decHighlightedCount: this.decHighlightedCount.bind(this),\r\n\r\n      incDisplayEdges: () => {\r\n        this.__displayEdges++\r\n        this.emit('updated')\r\n      },\r\n      decDisplayEdges: () => {\r\n        this.__displayEdges--\r\n        this.emit('updated')\r\n      },\r\n      genShaderID: (shaderName) => {\r\n        if (shaderName == 'SimpleSurfaceShader' || shaderName == 'StandardSurfaceShader') {\r\n          shaderName = 'GLDrawCADSurfaceShader'\r\n        }\r\n        if (!(shaderName in this.__shaderKeys)) {\r\n          const shaderClass = Registry.getBlueprint(shaderName)\r\n          if (!shaderClass || !shaderClass.getPackedMaterialData) {\r\n            return this.__cadpassdata.genShaderID('GLDrawCADSurfaceShader')\r\n          }\r\n          const shader = this.applyOptsToShader(Registry.constructClass(shaderName, gl))\r\n\r\n          const id = this.__shaderCount\r\n          this.__shaderKeys[shaderName] = {\r\n            id,\r\n            shader,\r\n          }\r\n          this.__shaderCount++\r\n          return id\r\n        }\r\n        return this.__shaderKeys[shaderName].id\r\n      },\r\n    }\r\n\r\n    this.__decrementLoadQueue = () => {\r\n      this.__loadQueue--\r\n      if (this.__loadQueue == 0) {\r\n        // console.log('===All Assets Loaded===')\r\n        // console.log('Total Load Time:' + (performance.now() - this.__gpuLoadStartTime) / 1000)\r\n        this.__profiling.numTriangles = this.__profiling.numTriangles / 1000000\r\n        // console.log(this.__profiling)\r\n\r\n        this.emit('updated')\r\n      }\r\n    }\r\n\r\n    // collector.registerSceneItemFilter((treeItem, rargs) => {\r\n    //   if (treeItem instanceof CADAsset) {\r\n    //     this.__loadQueue++;\r\n    //     const cadAsset = treeItem;\r\n    //     cadAsset.on('loaded', () => {\r\n    //       this.addCADAsset(treeItem);\r\n    //     });\r\n    //     rargs.continueInSubTree = true;\r\n    //     return true;\r\n    //   }\r\n    // });\r\n  }\r\n\r\n  /**\r\n   * The itemAddedToScene method is called on each pass when a new item\r\n   * is added to the scene, and the renderer must decide how to render it.\r\n   * It allows Passes to select geometries to handle the drawing of.\r\n   * @param {TreeItem} treeItem - The treeItem value.\r\n   * @param {object} rargs - Extra return values are passed back in this object.\r\n   * The object contains a parameter 'continueInSubTree', which can be set to false,\r\n   * so the subtree of this node will not be traversed after this node is handled.\r\n   * @return {Boolean} - The return value.\r\n   */\r\n  itemAddedToScene(treeItem, rargs) {\r\n    if (treeItem instanceof CADAsset) {\r\n      const cadAsset = treeItem\r\n      this.__loadQueue++\r\n      this.__cadpassdata.assetCount++\r\n\r\n      if (cadAsset.isLoaded()) {\r\n        if (cadAsset.getSurfaceLibrary().getNumSurfaces() > 0) {\r\n          this.addCADAsset(cadAsset)\r\n        } else {\r\n          this.__decrementLoadQueue()\r\n        }\r\n      } else {\r\n        cadAsset.once('loaded', () => {\r\n          if (cadAsset.getSurfaceLibrary().getNumSurfaces() > 0) this.addCADAsset(cadAsset)\r\n          else {\r\n            this.__decrementLoadQueue()\r\n          }\r\n        })\r\n      }\r\n      rargs.continueInSubTree = true\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * The itemRemovedFromScene method is called on each pass when aa item\r\n   * is removed to the scene, and the pass must handle cleaning up any resources.\r\n   * @param {TreeItem} treeItem - The treeItem value.\r\n   * @param {object} rargs - Extra return values are passed back in this object.\r\n   * @return {Boolean} - The return value.\r\n   */\r\n  itemRemovedFromScene(treeItem, rargs) {\r\n    if (treeItem instanceof CADAsset) {\r\n      this.removeCADAsset(treeItem)\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * The getShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getShaderPreprocessorValue(name) {\r\n    return this.getShaderState()[name]\r\n  }\r\n\r\n  /**\r\n   * The setShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @param {boolean} apply - The apply param.\r\n   */\r\n  setShaderPreprocessorValue(name, apply = true) {\r\n    if (!name.startsWith('#')) name = '#define ' + name\r\n\r\n    this.getShaderState()[name] = name\r\n\r\n    // Now update any shaders already consturcted.\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.setPreprocessorValue) {\r\n        shaderReg.shader.setPreprocessorValue(name)\r\n        if (apply) shaderReg.shader.applyOptions()\r\n      }\r\n    }\r\n\r\n    if (this.__drawSelectedCADSurfaceShader) {\r\n      this.__drawSelectedCADSurfaceShader.setPreprocessorValue(name)\r\n      if (apply) this.__drawSelectedCADSurfaceShader.applyOptions()\r\n    }\r\n    if (this.__drawCADSurfaceGeomDataShader) {\r\n      this.__drawCADSurfaceGeomDataShader.setPreprocessorValue(name)\r\n      if (apply) this.__drawCADSurfaceGeomDataShader.applyOptions()\r\n    }\r\n    if (this.__renderer) this.__renderer.requestRedraw()\r\n  }\r\n\r\n  /**\r\n   * The clearShaderPreprocessorValue method.\r\n   * @param {any} name - The name param.\r\n   * @param {boolean} apply - The apply param.\r\n   */\r\n  clearShaderPreprocessorValue(name, apply = true) {\r\n    delete this.getShaderState()[name]\r\n\r\n    // Now update any shaders already consturcted.\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.clearPreprocessorValue) {\r\n        shaderReg.shader.clearPreprocessorValue(name)\r\n        if (apply) shaderReg.shader.applyOptions()\r\n      }\r\n    }\r\n    if (this.__renderer) this.__renderer.requestRedraw()\r\n  }\r\n\r\n  /**\r\n   * Applies shader options to the compiled shaders, recompiling if necessary.\r\n   * @param {Shader} shader - The shader.\r\n   * @return {Shader} - The updated shader\r\n   */\r\n  applyOptsToShader(shader) {\r\n    if (shader.setPreprocessorValue) {\r\n      // Initialise the shaders.\r\n      const opts = this.getShaderState()\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const key in opts) shader.setPreprocessorValue(key)\r\n      shader.applyOptions()\r\n    }\r\n    return shader\r\n  }\r\n\r\n  /**\r\n   * The getShaderState method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getShaderState() {\r\n    return this.__shaderOptsStack[this.__shaderOptsStack.length - 1]\r\n  }\r\n\r\n  /**\r\n   * The pushShaderState method.\r\n   */\r\n  pushShaderState() {\r\n    this.__shaderOptsStack.push(Object.assign({}, this.getShaderState()))\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.pushState) {\r\n        shaderReg.shader.pushState()\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The popShaderState method.\r\n   */\r\n  popShaderState() {\r\n    this.__shaderOptsStack.pop()\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.popState) shaderReg.shader.popState()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The startPresenting method.\r\n   */\r\n  startPresenting() {\r\n    if (SystemDesc.deviceCategory != 'High') {\r\n      this.pushShaderState()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The stopPresenting method.\r\n   */\r\n  stopPresenting() {\r\n    if (SystemDesc.deviceCategory != 'High') {\r\n      this.popShaderState()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneNormalParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneNormalParam() {\r\n    return this.__cutPlaneNormalParam\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneDistParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneDistParam() {\r\n    return this.__cutDistParam\r\n  }\r\n\r\n  /**\r\n   * The getCutPlaneColorParam method.\r\n   * @return {any} - The return value.\r\n   */\r\n  getCutPlaneColorParam() {\r\n    return this.__cutPlaneColorParam\r\n  }\r\n\r\n  /**\r\n   * The incHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  incHighlightedCount(count) {\r\n    this.__numHighlightedGeoms += count\r\n  }\r\n\r\n  /**\r\n   * The decHighlightedCount method.\r\n   * @param {any} count - The count param.\r\n   */\r\n  decHighlightedCount(count) {\r\n    this.__numHighlightedGeoms -= count\r\n  }\r\n\r\n  /**\r\n   * The addCADAsset method is an internal method called when new CADAsset\r\n   * items are discovered in the tree.\r\n   * @param {CADAsset} cadAsset - The cadAsset tree item.\r\n   */\r\n  addCADAsset(cadAsset) {\r\n    this.__gl.finish()\r\n    const assetId = this.__assets.length\r\n\r\n    if (assetId == 0) {\r\n      this.__gpuLoadStartTime = performance.now()\r\n    }\r\n\r\n    if (cadAsset.getVersion().compare([0, 0, 26]) > 0) {\r\n      this.setShaderPreprocessorValue('#define INTS_PACKED_AS_2FLOAT16')\r\n    }\r\n    if (cadAsset.getVersion().compare([0, 0, 29]) >= 0) {\r\n      this.setShaderPreprocessorValue('#define ENABLE_PER_FACE_COLORS')\r\n    }\r\n    if (cadAsset.getVersion().compare([1, 0, 5]) >= 0) {\r\n      this.setShaderPreprocessorValue('#define ENABLE_BODY_EDGES')\r\n    }\r\n\r\n    const glcadAsset = new GLCADAsset(this.__gl, assetId, cadAsset, this.__cadpassdata)\r\n\r\n    glcadAsset.once('loaded', (assetStats) => {\r\n      this.__profiling.numSurfaces += assetStats.numSurfaces\r\n      this.__profiling.numSurfaceInstances += assetStats.numSurfaceInstances\r\n      this.__profiling.surfaceEvalTime += assetStats.surfaceEvalTime\r\n      this.__profiling.numBodies += assetStats.numBodies\r\n      this.__profiling.numMaterials += assetStats.numMaterials\r\n      this.__profiling.numTriangles += assetStats.numTriangles\r\n      this.__profiling.numDrawSets += assetStats.numDrawSets\r\n\r\n      this.__decrementLoadQueue()\r\n    })\r\n\r\n    glcadAsset.on('updated', () => this.emit('updated'))\r\n\r\n    this.__assets.push(glcadAsset)\r\n  }\r\n\r\n  /**\r\n   * The removeCADAsset method.\r\n   * @param {CADAsset} asset - The cadAsset to remove.\r\n   */\r\n  removeCADAsset(asset) {\r\n    this.__assets = this.__assets.filter((glcadAsset) => {\r\n      if (glcadAsset.getCADAsset() == asset) {\r\n        glcadAsset.destroy()\r\n        return false\r\n      }\r\n      return true\r\n    })\r\n    this.emit('updated')\r\n  }\r\n\r\n  /**\r\n   * The getGLCADAsset method.\r\n   * @param {number} index - The index of the cadAsset to retrieve.\r\n   * @return {CADAsset} - The return value.\r\n   */\r\n  getGLCADAsset(index) {\r\n    return this.__assets[index]\r\n  }\r\n\r\n  /**\r\n   * The draw method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  draw(renderstate) {\r\n    const gl = this.__gl\r\n\r\n    if (this.__profiling.numBodies == 0) return\r\n    if (SystemDesc.isIOSDevice) {\r\n      throw new Error('The ZeaCAD cannot be supported on iOS due to no ability to render to a FLOAT framebuffer.')\r\n    }\r\n\r\n    if (this.debugTrimTex) {\r\n      if (this.__assets.length > this.debugAssetId) this.__assets[this.debugAssetId].drawTrimSets(renderstate)\r\n    }\r\n    if (this.debugSurfaceAtlas) {\r\n      if (this.__assets.length > this.debugAssetId) this.__assets[this.debugAssetId].drawSurfaceAtlas(renderstate)\r\n      return\r\n    }\r\n\r\n    if (this.displaySurfaces) {\r\n      if (!this.pbrEnabled && renderstate.envMap) {\r\n        // If an env map is detected, automatically enable PBR rendering.\r\n        this.setShaderPreprocessorValue('#define ENABLE_PBR')\r\n        this.pbrEnabled = true\r\n      }\r\n\r\n      if (this.__cadpassdata.materialLibrary.needsUpload()) this.__cadpassdata.materialLibrary.uploadMaterials()\r\n\r\n      // eslint-disable-next-line guard-for-in\r\n      for (const shaderKey in this.__shaderKeys) {\r\n        const shaderReg = this.__shaderKeys[shaderKey]\r\n        shaderReg.shader.bind(renderstate)\r\n        renderstate.shaderId = shaderReg.id\r\n\r\n        if (!this.__cadpassdata.materialLibrary.bind(renderstate)) {\r\n          return false\r\n        }\r\n\r\n        if (renderstate.unifs.headLighting) {\r\n          gl.uniform1i(renderstate.unifs.headLighting.location, this.headLighting)\r\n        }\r\n        if (renderstate.unifs.displayWireframes) {\r\n          gl.uniform1i(renderstate.unifs.displayWireframes.location, this.displayWireframes)\r\n        }\r\n\r\n        const boundTextures = renderstate.boundTextures\r\n        for (const asset of this.__assets) {\r\n          asset.draw(renderstate)\r\n          renderstate.boundTextures = boundTextures\r\n        }\r\n\r\n        shaderReg.shader.unbind(renderstate)\r\n      }\r\n    }\r\n\r\n    if (this.displayNormals) {\r\n      if (!this.__drawCADSurfaceNormalsShader) {\r\n        this.__drawCADSurfaceNormalsShader = this.applyOptsToShader(new GLDrawCADSurfaceNormalsShader(gl))\r\n      }\r\n      if (!this.__drawCADSurfaceNormalsShader.bind(renderstate)) return false\r\n\r\n      gl.uniform1f(renderstate.unifs.normalLength.location, this.normalLength)\r\n      const id = this.__shaderKeys.GLDrawCADSurfaceShader.id\r\n      const boundTextures = renderstate.boundTextures\r\n      for (const asset of this.__assets) {\r\n        asset.drawNormals(renderstate, id)\r\n        renderstate.boundTextures = boundTextures\r\n      }\r\n    }\r\n\r\n    if (this.__displayEdges > 0) {\r\n      if (!this.__drawCADCurvesShader) {\r\n        this.__drawCADCurvesShader = this.applyOptsToShader(new GLDrawCADCurveShader(gl))\r\n      }\r\n      if (!this.__drawCADCurvesShader.bind(renderstate)) return false\r\n\r\n      gl.uniform4f(renderstate.unifs.edgeColor.location, 0.1, 0.1, 0.1, 1)\r\n\r\n      gl.enable(gl.BLEND)\r\n      gl.blendEquation(gl.FUNC_ADD)\r\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA) // For add\r\n\r\n      const boundTextures = renderstate.boundTextures\r\n      for (const asset of this.__assets) {\r\n        asset.drawEdges(renderstate, 0)\r\n        renderstate.boundTextures = boundTextures\r\n      }\r\n\r\n      gl.disable(gl.BLEND)\r\n    }\r\n\r\n    // To debug the highlight buffer, enable this line.\r\n    // It will draw the highlight buffer directly to the screen.\r\n    // this.drawHighlightedGeoms(renderstate)\r\n  }\r\n\r\n  /**\r\n   * The drawHighlightedGeoms method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawHighlightedGeoms(renderstate) {\r\n    if (this.__numHighlightedGeoms == 0) return false\r\n    const gl = this.__gl\r\n    if (!this.__drawSelectedCADSurfaceShader) {\r\n      this.__drawSelectedCADSurfaceShader = this.applyOptsToShader(new GLDrawSelectedCADSurfaceShader(gl))\r\n    }\r\n    if (!this.__drawSelectedCADSurfaceShader.bind(renderstate)) {\r\n      return false\r\n    }\r\n    for (const asset of this.__assets) {\r\n      asset.drawHighlightedGeoms(renderstate)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The drawGeomData method.\r\n   * @param {any} renderstate - The renderstate param.\r\n   * @return {any} - The return value.\r\n   */\r\n  drawGeomData(renderstate) {\r\n    if (this.__profiling.numBodies == 0) return\r\n    if (SystemDesc.isIOSDevice) {\r\n      throw new Error('The ZeaCAD cannot be supported on iOS due to no ability to render to a FLOAT framebuffer.')\r\n    }\r\n\r\n    const gl = this.__gl\r\n    if (!this.__drawCADSurfaceGeomDataShader) {\r\n      this.__drawCADSurfaceGeomDataShader = this.applyOptsToShader(new GLDrawCADSurfaceGeomDataShader(gl))\r\n    }\r\n    if (!this.__drawCADSurfaceGeomDataShader.bind(renderstate)) {\r\n      return false\r\n    }\r\n\r\n    gl.disable(gl.BLEND)\r\n    gl.disable(gl.CULL_FACE)\r\n    gl.enable(gl.DEPTH_TEST)\r\n    gl.depthFunc(gl.LESS)\r\n    gl.depthMask(true)\r\n\r\n    const passIndexUnif = renderstate.unifs.passIndex\r\n    if (passIndexUnif) {\r\n      gl.uniform1i(passIndexUnif.location, this.passIndex)\r\n    }\r\n\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const shaderKey in this.__shaderKeys) {\r\n      const shaderReg = this.__shaderKeys[shaderKey]\r\n      if (shaderReg.shader.nonSelectable) continue\r\n\r\n      renderstate.shaderId = shaderReg.id\r\n      for (const asset of this.__assets) {\r\n        asset.drawGeomData(renderstate)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The getGeomItemAndDist method.\r\n   * @param {any} geomData - The geomData param.\r\n   * @return {any} - The return value.\r\n   */\r\n  getGeomItemAndDist(geomData) {\r\n    const assetId = Math.round(geomData[0] / 64)\r\n    const geomId = Math.round(geomData[1])\r\n    const dist = geomData[3]\r\n    const geomItem = this.__assets[assetId].getGeomItem(geomId)\r\n\r\n    // console.log(this.__assets[assetId].getSurfaceData(geomId))\r\n\r\n    return {\r\n      geomItem,\r\n      dist,\r\n    }\r\n  }\r\n}\r\n\r\nexport { GLCADPass }\r\n"],"names":["Lines","BinReader","Vec2","Vec4","Box2","Vec3","Quat","Plane","Material","Color","SystemDesc","Box3","Xfo","BaseGeomItem","MaterialParameter","ColorParameter","TreeItem","GeomItem","Registry","AssetItem","FilePathParameter","BooleanParameter","Version","AssetLoadContext","resourceLoader","Parameter","Vec3Parameter","Mesh","GLMesh","GLLines","SubSet","__cache","GLShader","shaderLibrary","GLTexture2D","GLRenderTarget","EventEmitter","GLFbo","Fan","Float32","MathFunctions","GLCADAssetWorker","GrowingPacker","FRAGMENT_SHADER","GLPass"],"mappings":"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CAAuC;EAC7C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;AACL;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;EACtE,MAAM,yCAAyC;EAC/C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;AACAf,oBAAQ,CAAC,QAAQ,CAAC,0BAA0B,EAAE,wBAAwB;;EC7JtE;EACA;EACA;EACA,MAAM,cAAc,CAAC;EACrB;EACA;EACA;EACA;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE,WAAW,EAAE,eAAe,EAAE,OAAO,EAAE;EACzD,IAAI,IAAI,CAAC,IAAI,GAAG,GAAE;EAClB,IAAI,IAAI,CAAC,aAAa,GAAG,YAAW;EACpC,IAAI,IAAI,CAAC,iBAAiB,GAAG,gBAAe;EAC5C,IAAI,IAAI,CAAC,cAAc,GAAG,QAAO;AACjC;EACA,IAAI,MAAM,gBAAgB,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C,MAAM,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,GAAE;EAChC,KAAK;EACL,IAAI,OAAO,MAAM;EACjB,GAAG;AACH;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA,EAAE,QAAQ,CAAC,MAAM,EAAE;EACnB,IAAI,MAAM,IAAI,GAAG,IAAI,CAAC,YAAY,GAAG,OAAM;EAC3C,IAAI,IAAI,IAAI,IAAI,CAAC,EAAE,IAAI,CAAC,YAAY,IAAI,MAAM,GAAG,KAAI;EACrD,GAAG;EACH;;AC9ZAF,yBAAa,CAAC,eAAe;EAC7B,EAAE,oBAAoB;EACtB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ACjQAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,eAAe;EACjB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ACnJAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,oBAAoB;EACtB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ACxEAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,4BAA4B;EAC9B,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,EAAC;AACD;AACAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,8BAA8B;EAChC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ACrUAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,gBAAgB;EAClB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ACvOAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,sBAAsB;EACxB,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;AC5IAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,wBAAwB;EAC1B,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;ECjSA;AAUA;EACA,MAAM,wCAAwC,GAAGA,uBAAa,CAAC,WAAW;EAC1E,EAAE,yCAAyC;EAC3C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,EAAC;AACD;AACAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,mCAAmC;EACrC,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,EAAC;AACD;EACA;EACA;EACA;EACA;EACA,MAAM,gCAAgC,SAASD,kBAAQ,CAAC;EACxD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,yCAAwC;AACnF;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGC,uBAAa,CAAC,WAAW;EACtE,MAAM,iDAAiD;EACvD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;EACA;EACA;EACA;EACA;EACA,MAAM,kCAAkC,SAASD,kBAAQ,CAAC;EAC1D;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,yCAAwC;AACnF;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGC,uBAAa,CAAC,WAAW;EACtE,MAAM,mDAAmD;EACzD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;EACA;EACA;EACA;EACA;EACA,MAAM,+BAA+B,SAASD,kBAAQ,CAAC;EACvD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AA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,wCAAwC;EAC9C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;AACL;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;EACtE,MAAM,0CAA0C;EAChD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;AACAf,oBAAQ,CAAC,QAAQ,CAAC,2BAA2B,EAAE,yBAAyB;;ECvNxE;AAEA;EACA;EACA;EACA;EACA;EACA,MAAM,uBAAuB,SAASc,kBAAQ,CAAC;EAC/C;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGC,uBAAa,CAAC,WAAW;EACpE,MAAM,sCAAsC;EAC5C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;AACL;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;EACtE,MAAM,wCAAwC;EAC9C,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;AACAf,oBAAQ,CAAC,QAAQ,CAAC,yBAAyB,EAAE,uBAAuB;;ECnHpE;AAEA;EACA;EACA;EACA;EACA;EACA,MAAM,2BAA2B,SAASc,kBAAQ,CAAC;EACnD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAGC,uBAAa,CAAC,WAAW;EACpE,MAAM,0CAA0C;EAChD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;AACL;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAGA,uBAAa,CAAC,WAAW;EACtE,MAAM,4CAA4C;EAClD,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,GAAG;EACH,CAAC;AACD;AACAf,oBAAQ,CAAC,QAAQ,CAAC,6BAA6B,EAAE,2BAA2B;;ECpL5E;AAEA;EACA;EACA;EACA;EACA;EACA,MAAM,qBAAqB,SAASc,kBAAQ,CAAC;EAC7C;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc;EACvB,MAAM,eAAe;EACrB,MAAM,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,MAAK;EACL,IAAI,IAAI,CAAC,cAA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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC;EACH,EAAC;AACDA,yBAAa,CAAC,eAAe;EAC7B,EAAE,yCAAyC;EAC3C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD,EAAC;AACD;AACAA,yBAAa,CAAC,eAAe;EAC7B,EAAE,wCAAwC;EAC1C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC;EACH,EAAC;AACDA,yBAAa,CAAC,eAAe;EAC7B,EAAE,2CAA2C;EAC7C,EAAE,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EACD;;EC9RA;EACA;EACA;EACA;EACA,MAAM,WAAW,SAASD,kBAAQ,CAAC;EACnC;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;EACb,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,EAAC;EACrB,GAAG;AACH;EACA;EACA;EACA;EACA;EACA,EAAE,oBAAoB,CAAC,IAAI,EAAE;EAC7B,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,GAAG,KAAI;EAChC,GAAG;AACH;EACA;EACA;EACA;EACA;EACA,EAAE,sBAAsB,CAAC,IAAI,EAAE;EAC/B,IAAI,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAC;EAChC,GAAG;AACH;EACA;EACA;EACA;EACA;EACA,EAAE,QAAQ,GAAG;EACb,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;EAC5C,GAAG;AACH;EACA;EACA;EACA;EACA,EAAE,SAAS,GAAG;EACd,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,EAAC;EACvD,GAAG;AACH;EACA;EACA;EACA;EACA,EAAE,QAAQ,GAAG;EACb,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,GAAE;EACpB,IAAI,IAAI,CAAC,YAAY,GAAE;EACvB,GAAG;AACH;EACA;EACA;EACA;EACA,EAAE,YAAY,GAAG;EACjB,IAAI,MAAM,UAAU,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,EAAC;EAC3D,IAAI,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,GAAE;EACjC,IAAI,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;EAC7B,MAAM,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAC;EACjC,KAAK;EACL,IAAI,MAAM,OAAO,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,KAAI;EAChD,IAAI,IAAI,CAAC,KAAK,GAAG,QAAO;EACxB,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE;EACtC,MAAM,UAAU;EAChB,KAAK,EAAC;EACN,GAAG;AACH;EACA;EACA;EACA;EACA;EACA;EACA,EAAE,IAAI,CAAC,WAAW,EAAE;EACpB,IAAI,OAAO,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC;EAC9C,GAAG;EACH;;ECzEA,MAAM,2CAA2C,GAAG,CAAC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;AACF;EACA,MAAM,eAAe,GAAG,CAAC;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AAGD;EACA;EACA;EACA;EACA;EACA,MAAM,6BAA6B,SAAS,WAAW,CAAC;EACxD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,2CAA2C,EAAC;EACrF,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,eAAe,EAAC;EAC3D,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;EAC7B,GAAG;AACH;EACA;EACA;EACA;EACA;EACA,EAAE,OAAO,oBAAoB,GAAG;EAChC,IAAI,MAAM,UAAU,GAAG,KAAK,CAAC,oBAAoB,GAAE;EACnD,IAAI,UAAU,CAAC,IAAI,CAAC;EACpB,MAAM,IAAI,EAAE,WAAW;EACvB,MAAM,YAAY,EAAE,IAAI,KAAK,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;EAC5C,KAAK,EAAC;EACN,IAAI,OAAO,UAAU;EACrB,GAAG;EACH,CAAC;AACD;AACAd,oBAAQ,CAAC,QAAQ,CAAC,+BAA+B,EAAE,6BAA6B;;EC5OhF;AAKA;EACA,MAAM,oCAAoC,GAAG,CAAC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;AACF;EACA,MAAM,sCAAsC,GAAG,CAAC;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AAGD;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AY,CAAC,kBAAkB,CAAC,CAAC,QAAQ,GAAE;EACvE,KAAK,MAAM;EACX,MAAM,OAAO,CAAC,CAAC,CAAC,GAAG,IAAG;EACtB,KAAK;EACL,IAAI,OAAO,OAAO;EAClB,GAAG;EACH,CAAC;AACD;AACAS,oBAAQ,CAAC,QAAQ,CAAC,wBAAwB,EAAE,sBAAsB;;EClmBlE;AAEA;EACA,MAAMyB,iBAAe,GAAG,CAAC;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AAGD;EACA;EACA;EACA;EACA;EACA,MAAM,8BAA8B,SAAS,WAAW,CAAC;EACzD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,oCAAoC,EAAC;EAC9E,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAEA,iBAAe,EAAC;AAC3D;EACA,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;EAC7B,GAAG;EACH;;ECrGA,MAAMA,iBAAe,GAAG,CAAC;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AAGD;EACA;EACA;EACA;EACA;EACA,MAAM,8BAA8B,SAAS,WAAW,CAAC;EACzD;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,oCAAoC,EAAC;EAC9E,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAEA,iBAAe,EAAC;EAC3D,IAAI,IAAI,CAAC,aAAa,GAAG,KAAI;EAC7B,GAAG;EACH,CAAC;AACD;AACAzB,oBAAQ,CAAC,QAAQ,CAAC,gCAAgC,EAAE,8BAA8B;;EChGlF;AAKA;EACA,MAAM,kCAAkC,GAAG,CAAC;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;AACF;EACA,MAAM,oCAAoC,GAAG,CAAC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AAGD;EACA;EACA;EACA;EACA;EACA,MAAM,oBAAoB,SAAS,WAAW,CAAC;EAC/C;EACA;EACA;EACA;EACA,EAAE,WAAW,CAAC,EAAE,EAAE;EAClB,IAAI,KAAK,CAAC,EAAE,EAAC;AACb;EACA,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,kCAAkC,EAAC;EAC5E,IAAI,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,oCAAoC,EAAC;EAChF,GAAG;AACH;EACA;EACA;EACA;EACA;EACA,EAAE,OAAO,oBAAoB,GAAG;EAChC,IAAI,MAAM,UAAU,GAAG,KAAK,CAAC,oBAAoB,GAAE;EACnD,IAAI,UAAU,CAAC,IAAI,CAAC;EACpB,MAAM,IAAI,EAAE,WAAW;EACvB,MAAM,YAAY,EAAE,IAAIT,eAAK,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;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"}